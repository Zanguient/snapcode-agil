!function(e){"use strict";var t=e.document,n=function(e){return t.getElementById(e)},a=e.sessionStorage,i=function(){return e.Blob},l=n("canvas"),o=n("canvas-options"),r=n("canvas-filename"),s=n("canvas-clear"),h=n("text"),u=n("text-options"),d=n("text-filename"),m=n("html"),p=n("html-options"),c=n("html-filename"),f=l.getContext("2d"),v=!1,g=a.x_points||[],x=a.y_points||[],E=a.drag_points||[],y=function(e,t,n){g.push(e),x.push(t),E.push(n)},_=function(){l.width=l.width,f.lineWidth=6,f.lineJoin="round",f.strokeStyle="#000000";for(var e=0,t=g.length;e<t;e++)f.beginPath(),e&&E[e]?f.moveTo(g[e-1],x[e-1]):f.moveTo(g[e]-1,x[e]),f.lineTo(g[e],x[e]),f.closePath(),f.stroke()},w=function(){v=!1},L=t.implementation;l.width=500,l.height=300,"string"==typeof g&&(g=JSON.parse(g)),"string"==typeof x&&(x=JSON.parse(x)),"string"==typeof E&&(E=JSON.parse(E)),a.canvas_filename&&(r.value=a.canvas_filename),a.text&&(h.value=a.text),a.text_filename&&(d.value=a.text_filename),a.html&&(m.innerHTML=a.html),a.html_filename&&(c.value=a.html_filename),v=!0,_(),v=!1,s.addEventListener("click",function(){l.width=l.width,g.length=x.length=E.length=0},!1),l.addEventListener("mousedown",function(e){e.preventDefault(),v=!0,y(e.pageX-l.offsetLeft,e.pageY-l.offsetTop,!1),_()},!1),l.addEventListener("mousemove",function(e){v&&(y(e.pageX-l.offsetLeft,e.pageY-l.offsetTop,!0),_())},!1),l.addEventListener("mouseup",w,!1),l.addEventListener("mouseout",w,!1),o.addEventListener("submit",function(e){e.preventDefault(),l.toBlob(function(e){saveAs(e,(r.value||r.placeholder)+".png")},"image/png")},!1),u.addEventListener("submit",function(e){e.preventDefault();var n=i();saveAs(new n([h.value||h.placeholder],{type:"text/plain;charset="+t.characterSet}),(d.value||d.placeholder)+".txt")},!1),p.addEventListener("submit",function(e){e.preventDefault();var n=i(),a=new XMLSerializer,l=function(e){var t=L.createDocumentType("html",null,null),n=L.createDocument("http://www.w3.org/1999/xhtml","html",t),a=n.documentElement,i=a.appendChild(n.createElement("head")),l=i.appendChild(n.createElement("meta")),o=i.appendChild(n.createElement("title")),r=a.appendChild(n.createElement("body")),s=0,h=e.childNodes.length;for(l.setAttribute("charset",e.ownerDocument.characterSet);s<h;s++)r.appendChild(n.importNode(e.childNodes.item(s),!0));var u=function(e){for(var t,n,a="h6 h5 h4 h3 h2 h1".split(" "),i=a.length;i--;)for(var l=0,o=(t=e.getElementsByTagName(a[i])).length;l<o;l++)if(n=t[l].textContent.trim())return n}(n);return u&&o.appendChild(n.createTextNode(u)),n}(m);saveAs(new n([a.serializeToString(l)],{type:"application/xhtml+xml;charset="+t.characterSet}),(c.value||c.placeholder)+".xhtml")},!1),e.addEventListener("unload",function(){a.x_points=JSON.stringify(g),a.y_points=JSON.stringify(x),a.drag_points=JSON.stringify(E),a.canvas_filename=r.value,a.text=h.value,a.text_filename=d.value,a.html=m.innerHTML,a.html_filename=c.value},!1)}(self);