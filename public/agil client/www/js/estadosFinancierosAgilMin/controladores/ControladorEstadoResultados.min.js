angular.module("agil.controladores").controller("ControladorEstadoResultados",function(G,o,e,n,a,_,r,t,i,c,u){G.usuario=JSON.parse(o.usuario),G.inicio=function(){G.obtenerTiposPeriodos(),G.obtenerGestiones(),G.obtenerTiposCuenta(),G.obtenerConfiguracionImpresion(),G.obtenerGestionesImpresion()},G.$on("$viewContentLoaded",function(){resaltarPestaña(e.path().substring(1)),G.buscarAplicacion(G.usuario.aplicacionesUsuario,e.path().substring(1)),_.stop()}),G.obtenerTiposPeriodos=function(){_.start(),t("EEFF_TP").then(function(o){G.TiposPeriodos=o,_.stop()})},G.obtenerGestiones=function(){_.start(),t("GTN").then(function(o){G.gestiones=o.clases,_.stop()})},G.obtenerConfiguracionImpresion=function(){i(G.usuario.id_empresa).then(function(o){G.configuracionImpresion=o,G.configuracionImpresion.bimonetario=!0,G.configuracionImpresion.tioPeriodo="",G.configuracionImpresion.gestion="",G.configuracionImpresion.gestion_fin="",G.configuracionImpresion.mes="",G.configuracionImpresion.fecha_inicio=null,G.configuracionImpresion.fecha_fin=null,_.stop()})},G.cargarFechasFiltro=function(o){"FECHAS"==o&&setTimeout(function(){aplicarDatePickers()},300)},G.obtenerTiposCuenta=function(){_.start(),t("TCC").then(function(o){G.cuentaTipos=[{id:0,nombre:"PREESTABLECIDO"}],G.cuentaTipos=G.cuentaTipos.concat(o.clases),_.stop()})},G.obtenerGestionesImpresion=function(){_.start(),G.gestionesEF=[],u(G.usuario.id_empresa).then(function(o){_.stop(),o.forEach(function(o){o.habilitado&&(G.fechasImpresion=o)})})},G.generarPdfBalanceGeneral=function(){_.start(),G.configuracionImpresion.fecha_inicio&&(G.configuracionImpresion.inicio2=new Date(G.convertirFecha(G.configuracionImpresion.fecha_inicio)),G.configuracionImpresion.fin2=new Date(G.convertirFecha(G.configuracionImpresion.fecha_fin))),G.configuracionImpresion.fechasImpresion=G.fechasImpresion,c(G.configuracionImpresion,G.usuario.id_empresa).then(function(r){r.monedaCambio?G.moneda=r.monedaCambio:G.moneda={ufv:"--",dolar:"--"};var t=0,i=0;r.cuentasSubGrupoEstadoResultado.forEach(function(o,e,n){for(var a=0;a<o.cuentasEstadoResultado.length;a++){o.cuentasEstadoResultado[a];"INGRESO"==o.clasificacion.nombre.toUpperCase()?t+=o.cuentasEstadoResultado[a].saldo:i+=o.cuentasEstadoResultado[a].saldo}});if("COMPARATIVO"!=G.configuracionImpresion.tipoPeriodo.nombre){var o=G.configuracionImpresion.bimonetario?400:530;"PREESTABLECIDO"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarPdfPreestablecido(r,o,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion,r.cuentasSubGrupoEstadoResultado,t,i):"GENERICA"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarPdfPreestablecido(r,o,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion,r.cuentasSubGrupoEstadoResultado,t,i):"GRUPO"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarPdfGrupo(r,o,r.cuentasSubGrupoEstadoResultado,t,i):"SUB GRUPO"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarPdfsubGrupo(r,o,r.cuentasSubGrupoEstadoResultado,t,i):"APROPIACION"==G.configuracionImpresion.tipo_cuenta.nombre&&G.generarPdfApropiacion(r,o,r.cuentasSubGrupoEstadoResultado,t,i)}else{var c=[],u=[],s=[],m=[],d=[],g=[],f=[];r.primero.cuentasGrupo.forEach(function(o,e,n){var a={};a.primerAno=o,c.push(a),e===n.length-1&&r.segundo.cuentasGrupo.forEach(function(o,e,n){for(var a=0;a<c.length;a++){var r=c[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasSubGrupo.forEach(function(o,e,n){var a={};a.primerAno=o,u.push(a),e===n.length-1&&r.segundo.cuentasSubGrupo.forEach(function(o,e,n){for(var a=0;a<u.length;a++){var r=u[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasGenericas.forEach(function(o,e,n){var a={};a.primerAno=o,s.push(a),e===n.length-1&&r.segundo.cuentasGenericas.forEach(function(o,e,n){for(var a=0;a<s.length;a++){var r=s[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasApropiacion.forEach(function(o,e,n){var a={};a.primerAno=o,m.push(a),e===n.length-1&&r.segundo.cuentasApropiacion.forEach(function(o,e,n){for(var a=0;a<m.length;a++){var r=m[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasSubGrupoFijo.forEach(function(o,e,n){var a={};a.primerAno=o,d.push(a),e===n.length-1&&r.segundo.cuentasSubGrupoFijo.forEach(function(o,e,n){for(var a=0;a<d.length;a++){var r=d[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasGenericasFijo.forEach(function(o,e,n){var a={};a.primerAno=o,g.push(a),e===n.length-1&&r.segundo.cuentasGenericasFijo.forEach(function(o,e,n){for(var a=0;a<g.length;a++){var r=g[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasApropiacionFijo.forEach(function(o,e,n){var a={};a.primerAno=o,f.push(a),e===n.length-1&&r.segundo.cuentasApropiacionFijo.forEach(function(o,e,n){for(var a=0;a<f.length;a++){var r=f[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})});o=G.configuracionImpresion.bimonetario?290:310;"PREESTABLECIDO"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarPdfComprobantePreestablecido(r,o,c,u,s,m,d,g,f):"GENERICA"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarPdfComprobantePreestablecido(r,o,c,u,s,cuentasApropiacioncuentasSubGrupoFijo,g,f):"GRUPO"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarPdfComparativoGrupo(r,o,c,u,s,cuentasApropiacioncuentasSubGrupoFijo,g,f):"SUB GRUPO"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarPdfComparativosubGrupo(r,o,c,u,s,cuentasApropiacioncuentasSubGrupoFijo,g,f):"APROPIACION"==G.configuracionImpresion.tipo_cuenta.nombre&&G.generarPdfComparativoApropiacion(r,o,c,u,s,cuentasApropiacioncuentasSubGrupoFijo,g,f),_.stop()}})},G.generarExelBalanceGeneral=function(){_.start(),G.configuracionImpresion.fecha_inicio&&(G.configuracionImpresion.inicio2=new Date(G.convertirFecha(G.configuracionImpresion.fecha_inicio)),G.configuracionImpresion.fin2=new Date(G.convertirFecha(G.configuracionImpresion.fecha_fin))),G.configuracionImpresion.fechasImpresion=G.fechasImpresion,c(G.configuracionImpresion,G.usuario.id_empresa).then(function(r){r.monedaCambio?G.moneda=r.monedaCambio:G.moneda={ufv:"--",dolar:"--"},r.arregloActivos=[],r.arregloActivosFijos=[],r.arregloPasivos=[],r.arregloPatrimonio=[],r.arregloIngreso=[],r.arregloEgreso=[],r.arregleCostos=[];if("COMPARATIVO"!=G.configuracionImpresion.tipoPeriodo.nombre){r.arregloPasivos=r.arregloPasivos.concat(r.arregloPatrimonio);var o=G.configuracionImpresion.bimonetario?400:530;"PREESTABLECIDO"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarExelAPreestablecido(r,o,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion):"GENERICA"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarExelAPreestablecido(r,o,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion):"GRUPO"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarExelGrupo(r,o,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion):"SUB GRUPO"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarExelSubGrupo(r,o,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion):"APROPIACION"==G.configuracionImpresion.tipo_cuenta.nombre&&G.generarExelApropiacion(r,o,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion)}else{var t=[],i=[],c=[],u=[],s=[],m=[],d=[];r.primero.cuentasGrupo.forEach(function(o,e,n){var a={};a.primerAno=o,t.push(a),e===n.length-1&&r.segundo.cuentasGrupo.forEach(function(o,e,n){for(var a=0;a<t.length;a++){var r=t[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasSubGrupo.forEach(function(o,e,n){var a={};a.primerAno=o,i.push(a),e===n.length-1&&r.segundo.cuentasSubGrupo.forEach(function(o,e,n){for(var a=0;a<i.length;a++){var r=i[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasGenericas.forEach(function(o,e,n){var a={};a.primerAno=o,c.push(a),e===n.length-1&&r.segundo.cuentasGenericas.forEach(function(o,e,n){for(var a=0;a<c.length;a++){var r=c[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasApropiacion.forEach(function(o,e,n){var a={};a.primerAno=o,u.push(a),e===n.length-1&&r.segundo.cuentasApropiacion.forEach(function(o,e,n){for(var a=0;a<u.length;a++){var r=u[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasSubGrupoFijo.forEach(function(o,e,n){var a={};a.primerAno=o,s.push(a),e===n.length-1&&r.segundo.cuentasSubGrupoFijo.forEach(function(o,e,n){for(var a=0;a<s.length;a++){var r=s[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasGenericasFijo.forEach(function(o,e,n){var a={};a.primerAno=o,m.push(a),e===n.length-1&&r.segundo.cuentasGenericasFijo.forEach(function(o,e,n){for(var a=0;a<m.length;a++){var r=m[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasApropiacionFijo.forEach(function(o,e,n){var a={};a.primerAno=o,d.push(a),e===n.length-1&&r.segundo.cuentasApropiacionFijo.forEach(function(o,e,n){for(var a=0;a<d.length;a++){var r=d[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})});o=G.configuracionImpresion.bimonetario?290:310;"PREESTABLECIDO"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarExelComprobantePreestablecido(r,o,t,i,c,u,s,m,d):"GENERICA"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarExelComprobantePreestablecido(r,o,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,d):"GRUPO"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarExelComparativoGrupo(r,o,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,d):"SUB GRUPO"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarExelComparativosubGrupo(r,o,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,d):"APROPIACION"==G.configuracionImpresion.tipo_cuenta.nombre&&G.generarExelComparativoApropiacion(r,o,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,d),_.stop()}})},G.generarWordBalanceGeneral=function(){_.start(),G.configuracionImpresion.fecha_inicio&&(G.configuracionImpresion.inicio2=new Date(G.convertirFecha(G.configuracionImpresion.fecha_inicio)),G.configuracionImpresion.fin2=new Date(G.convertirFecha(G.configuracionImpresion.fecha_fin))),G.configuracionImpresion.fechasImpresion=G.fechasImpresion,c(G.configuracionImpresion,G.usuario.id_empresa).then(function(r){if(r.monedaCambio?G.moneda=r.monedaCambio:G.moneda={ufv:"--",dolar:"--"},"COMPARATIVO"!=G.configuracionImpresion.tipoPeriodo.nombre){var o=G.configuracionImpresion.bimonetario?400:530;"PREESTABLECIDO"==G.configuracionImpresion.tipo_cuenta.nombre?G.descargarArchivo(G.generarWordPreestablecido(r,o,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion),"reporte-balance-general.doc"):"GENERICA"==G.configuracionImpresion.tipo_cuenta.nombre?G.descargarArchivo(G.generarWordPreestablecido(r,o,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion),"reporte-balance-general.doc"):"GRUPO"==G.configuracionImpresion.tipo_cuenta.nombre?G.descargarArchivo(G.generarWordGrupo(r,o,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion),"reporte-balance-general.doc"):"SUB GRUPO"==G.configuracionImpresion.tipo_cuenta.nombre?G.descargarArchivo(G.generarWordSubGrupo(r,o,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion),"reporte-balance-general.doc"):"APROPIACION"==G.configuracionImpresion.tipo_cuenta.nombre&&G.descargarArchivo(G.generarWordApropiacion(r,o,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion),"reporte-balance-general.doc")}else{var t=[],i=[],c=[],u=[],s=[],m=[],d=[];r.primero.cuentasGrupo.forEach(function(o,e,n){var a={};a.primerAno=o,t.push(a),e===n.length-1&&r.segundo.cuentasGrupo.forEach(function(o,e,n){for(var a=0;a<t.length;a++){var r=t[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasSubGrupo.forEach(function(o,e,n){var a={};a.primerAno=o,i.push(a),e===n.length-1&&r.segundo.cuentasSubGrupo.forEach(function(o,e,n){for(var a=0;a<i.length;a++){var r=i[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasGenericas.forEach(function(o,e,n){var a={};a.primerAno=o,c.push(a),e===n.length-1&&r.segundo.cuentasGenericas.forEach(function(o,e,n){for(var a=0;a<c.length;a++){var r=c[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasApropiacion.forEach(function(o,e,n){var a={};a.primerAno=o,u.push(a),e===n.length-1&&r.segundo.cuentasApropiacion.forEach(function(o,e,n){for(var a=0;a<u.length;a++){var r=u[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasSubGrupoFijo.forEach(function(o,e,n){var a={};a.primerAno=o,s.push(a),e===n.length-1&&r.segundo.cuentasSubGrupoFijo.forEach(function(o,e,n){for(var a=0;a<s.length;a++){var r=s[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasGenericasFijo.forEach(function(o,e,n){var a={};a.primerAno=o,m.push(a),e===n.length-1&&r.segundo.cuentasGenericasFijo.forEach(function(o,e,n){for(var a=0;a<m.length;a++){var r=m[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),r.primero.cuentasApropiacionFijo.forEach(function(o,e,n){var a={};a.primerAno=o,d.push(a),e===n.length-1&&r.segundo.cuentasApropiacionFijo.forEach(function(o,e,n){for(var a=0;a<d.length;a++){var r=d[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})});o=G.configuracionImpresion.bimonetario?290:310;"PREESTABLECIDO"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarWordComprobantePreestablecido(r,o,t,i,c,u,s,m,d):"GENERICA"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarWordComprobantePreestablecido(r,o,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,d):"GRUPO"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarWordComparativoGrupo(r,o,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,d):"SUB GRUPO"==G.configuracionImpresion.tipo_cuenta.nombre?G.generarWordComparativosubGrupo(r,o,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,d):"APROPIACION"==G.configuracionImpresion.tipo_cuenta.nombre&&G.generarWordComparativoApropiacion(r,o,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,d),_.stop()}})},G.generarPdfApropiacion=function(o,e,n,a,r,t){var i=new PDFDocument({size:"letter",margin:10}),c=i.pipe(blobStream()),u=a.length+r.length+t.length,s=130,m=0,d=G.configuracionImpresion.usar_empesar_numeracion?G.configuracionImpresion.empesar_numeracion:1,g=G.configuracionImpresion.usar_empesar_numeracion?G.configuracionImpresion.empesar_numeracion-1+Math.ceil(u/28):Math.ceil(u/28),f=0;G.dibujarCabeceraPDFEstadoResultado(i,d,g,"ACTIVO"),i.font("Helvetica",8);for(var p=0;p<a.length&&m<=28;p++)if(cuenta=a[p],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){28==m&&(i.addPage({margin:0,bufferPages:!0}),s=140,m=0,d+=1,G.dibujarCabeceraPDFEstadoResultado(i,d,g,"ACTIVO"),i.font("Helvetica",8)),i.text(cuenta.nombre,30,s),s+=20,m++;for(var l=0;l<r.length&&m<=28;l++){cuenta3=r[l];var b=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==b){if(t.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e})){i.text(cuenta3.nombre,40,s),s+=20,m++;for(var A=0;A<t.length&&m<=28;A++){cuenta2=t[A];b=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==b){i.text(cuenta2.nombre,60,s),i.text(number_format(cuenta2.saldo,2),e,s);var v=cuenta2.saldo/G.moneda.dolar;G.configuracionImpresion.bimonetario&&i.text(number_format(v,2),e+130,s),cuenta.total+=cuenta2.saldo,f+=cuenta2.saldo,s+=20,28==++m&&(i.addPage({margin:0,bufferPages:!0}),s=140,m=0,d+=1,G.dibujarCabeceraPDFEstadoResultado(i,d,g,"ACTIVO"),i.font("Helvetica",8))}else 28==m&&(i.addPage({margin:0,bufferPages:!0}),s=140,m=0,d+=1,G.dibujarCabeceraPDFEstadoResultado(i,d,g,"ACTIVO"),i.font("Helvetica",8))}}}else 28==m&&(i.addPage({margin:0,bufferPages:!0}),s=140,m=0,d+=1,G.dibujarCabeceraPDFEstadoResultado(i,d,g,"ACTIVO"),i.font("Helvetica",8))}i.text("TOTAL "+cuenta.nombre,90,s),i.text(number_format(cuenta.total,2),e,s);var I=cuenta.total/G.moneda.dolar;G.configuracionImpresion.bimonetario&&i.text(number_format(I,2),e+130,s),s+=20,m++,p===a.length-1&&G.DibujarFijoApropiacion(o,f,i,s,m,d,g,28,e)}else p===a.length-1&&G.DibujarFijoApropiacion(o,f,i,s,m,d,g,28,e);G.configuracionImpresion.usar_firma_uno&&(i.text(G.configuracionImpresion.firma_uno,170,720),i.text(G.configuracionImpresion.cargo_uno,170,730)),G.configuracionImpresion.usar_firma_dos&&(i.text(G.configuracionImpresion.firma_dos,370,720),i.text(G.configuracionImpresion.cargo_dos,370,730)),i.end(),c.on("finish",function(){var o=c.toBlobURL("application/pdf");window.open(o,"_blank","location=no")}),_.stop()},G.DibujarFijoApropiacion=function(o,e,n,a,r,t,i,c,u){if("COMPARATIVO"!=G.configuracionImpresion.tipoPeriodo.nombre){n.font("Helvetica",8);for(var s=0;s<o.cuentasSubGrupoFijo.length&&r<=c;s++)if(cuenta=o.cuentasSubGrupoFijo[s],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8)),n.text(cuenta.nombre,30,a),a+=20,r++;for(var m=0;m<o.cuentasGenericasFijo.length&&r<=c;m++)if(cuenta3=o.cuentasGenericasFijo[m],"3"===cuenta3.tipoCuenta.nombre_corto){var d=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==d){if(o.cuentasApropiacionFijo.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e})){n.text(cuenta3.nombre,40,a),a+=20,r++;for(var g=0;g<o.cuentasApropiacionFijo.length&&r<=c;g++)if(cuenta2=o.cuentasApropiacionFijo[g],"4"===cuenta2.tipoCuenta.nombre_corto){d=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==d){n.text(cuenta2.nombre,60,a),n.text(number_format(cuenta2.saldo,2),u-80,a);var f=cuenta2.saldo/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text(number_format(f,2),u+65,a),a+=20,r++;for(var p=0;p<o.cuentasApropiacionFijo.length&&r<=c;p++)if(cuenta5=o.cuentasApropiacionFijo[p],"4"===cuenta5.tipoCuenta.nombre_corto){d=String(cuenta5.codigo).substr(4);if(String(cuenta2.codigo).substr(4)==d&&"Pasivo"===cuenta5.clasificacion.nombre){n.text(cuenta5.nombre,60,a),n.text("("+number_format(cuenta5.saldo,2)+")",u-80,a);var l=cuenta2.saldo-cuenta5.saldo;n.text(number_format(l,2),u,a);f=cuenta5.saldo/G.moneda.dolar;var b=l/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text(number_format(f,2),u+65,a),G.configuracionImpresion.bimonetario&&n.text(number_format(b,2),u+130,a),cuenta.total+=l,e+=l,a+=20,++r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8));r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8));n.text("TOTAL "+cuenta.nombre,90,a),n.text(number_format(cuenta.total,2),u,a);var A=cuenta.total/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text(number_format(A,2),u+130,a),a+=20,r++,s===o.cuentasSubGrupoFijo.length-1&&G.dibujarPatrimonio(o,e,n,a,r,t,i,c,u)}else s===o.cuentasSubGrupoFijo.length-1&&G.dibujarPatrimonio(o,e,n,a,r,t,i,c,u)}},G.DibujarFijoPreestablecido=function(o,e,n,a,r,t,i,c,u){n.font("Helvetica",8);for(var s=0;s<o.cuentasSubGrupoFijo.length&&r<=c;s++)if(cuenta=o.cuentasSubGrupoFijo[s],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8)),n.text(cuenta.nombre,30,a),a+=20,r++;for(var m=0;m<o.cuentasGenericasFijo.length&&r<=c;m++)if(cuenta3=o.cuentasGenericasFijo[m],cuenta3.total=0,"3"===cuenta3.tipoCuenta.nombre_corto){var d=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==d){if(o.cuentasApropiacionFijo.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e})){n.text(cuenta3.nombre,40,a),a+=20,r++;for(var g=0;g<o.cuentasGenericasFijo.length&&r<=c;g++){cuenta6=o.cuentasGenericasFijo[g],cuenta6.total=0;d=String(cuenta6.codigo).substr(3);if(String(cuenta3.codigo).substr(3)==d&&"Pasivo"===cuenta6.clasificacion.nombre&&(n.text(cuenta6.nombre,40,a),a+=20,r++),g==o.cuentasGenericasFijo.length-1){for(var f=0;f<o.cuentasApropiacionFijo.length&&r<=c;f++)if(cuenta2=o.cuentasApropiacionFijo[f],"4"===cuenta2.tipoCuenta.nombre_corto){d=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==d){cuenta3.total+=cuenta2.saldo;for(var p=cuenta2.saldo/G.moneda.dolar,l=0;l<o.cuentasApropiacionFijo.length&&r<=c;l++)if(cuenta5=o.cuentasApropiacionFijo[l],"4"===cuenta5.tipoCuenta.nombre_corto){d=String(cuenta5.codigo).substr(4);if(String(cuenta2.codigo).substr(4)==d&&"Pasivo"===cuenta5.clasificacion.nombre){cuenta6.total+=cuenta5.saldo;var b=cuenta2.saldo-cuenta5.saldo;p=cuenta5.saldo/G.moneda.dolar,G.moneda.dolar;cuenta.total+=b,e+=b,r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8));r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8));n.text(number_format(cuenta3.total,2),u-80,a-40);p=cuenta3.total/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text(number_format(p,2),u+65,a-40),n.text("("+number_format(cuenta6.total,2)+")",u-80,a-20);p=cuenta6.total/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text("("+number_format(p,2)+")",u+65,a-20);var A=cuenta3.total-cuenta6.total,v=A/G.moneda.dolar;n.text(number_format(A,2),u,a-20),G.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a-20)}}}}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8));n.text("TOTAL "+cuenta.nombre,90,a),n.text(number_format(cuenta.total,2),u,a);var I=cuenta.total/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text(number_format(I,2),u+130,a),a+=20,r++,s===o.cuentasSubGrupoFijo.length-1&&G.dibujarPatrimonioPredefinido(o,e,n,a,r,t,i,c,u)}else s===o.cuentasSubGrupoFijo.length-1&&G.dibujarPatrimonioPredefinido(o,e,n,a,r,t,i,c,u)},G.DibujarFijoComparativoPreestablecido=function(o,e,n,a,r,t,i,c,u,s,m,d,g,f,p,l){n.font("Helvetica",8);for(var b=0;b<f.length&&r<=c;b++)if(cuenta=f[b],cuenta.primerAno.total=0,cuenta.segundoAno.total=0,"Activo"===cuenta.primerAno.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8)),n.text(cuenta.primerAno.nombre,30,a),a+=20,r++;for(var A=0;A<p.length&&r<=c;A++){cuenta3=p[A],cuenta3.primerAno.total=0,cuenta3.segundoAno.total=0;var v=String(cuenta3.primerAno.codigo).substr(0,3);if(cuenta.primerAno.codigo==v){if(l.some(function(o){var e=String(o.primerAno.codigo).substr(0,5);return cuenta3.primerAno.codigo==e})){n.text(cuenta3.primerAno.nombre,40,a),a+=20,r++;for(var I=0;I<p.length&&r<=c;I++){cuenta6=p[I],cuenta6.primerAno.total=0,cuenta6.segundoAno.total=0;v=String(cuenta6.primerAno.codigo).substr(3);if(String(cuenta3.primerAno.codigo).substr(3)==v&&"Pasivo"===cuenta6.primerAno.clasificacion.nombre&&(n.text(cuenta6.primerAno.nombre,40,a),a+=20,r++),I==p.length-1){for(var P=0;P<l.length&&r<=c;P++)if(cuenta2=l[P],"4"===cuenta2.primerAno.tipoCuenta.nombre_corto){v=String(cuenta2.primerAno.codigo).substr(0,5);if(cuenta3.primerAno.codigo==v){cuenta3.primerAno.total+=cuenta2.primerAno.saldo,cuenta3.segundoAno.total+=cuenta2.segundoAno.saldo;for(var h=0;h<l.length&&r<=c;h++)if(cuenta5=l[h],"4"===cuenta5.primerAno.tipoCuenta.nombre_corto){v=String(cuenta5.primerAno.codigo).substr(4);if(String(cuenta2.primerAno.codigo).substr(4)==v&&"Pasivo"===cuenta5.primerAno.clasificacion.nombre){cuenta6.primerAno.total+=cuenta5.primerAno.saldo,cuenta6.segundoAno.total+=cuenta5.segundoAno.saldo;var _=cuenta2.primerAno.saldo-cuenta5.primerAno.saldo,S=cuenta2.segundoAno.saldo-cuenta5.segundoAno.saldo;cuenta.primerAno.total+=_,e.totalActivosPrimerAnio+=_,cuenta.segundoAno.total+=S,e.totalActivosSegundoAnio+=S,r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8));r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8));n.text(cuenta3.primerAno.total.toFixed(2),u-80,a-40),n.text(cuenta3.segundoAno.total.toFixed(2),u+130,a-40);cuenta3.primerAno.total,G.moneda.dolar;n.text("("+cuenta6.primerAno.total.toFixed(2)+")",u-80,a-20),n.text("("+cuenta6.segundoAno.total.toFixed(2)+")",u+130,a-20);cuenta6.primerAno.total,G.moneda.dolar;var x=(E=cuenta3.primerAno.total-cuenta6.primerAno.total)/G.moneda.dolar;n.text(number_format(E,2),u,a-20),G.configuracionImpresion.bimonetario&&n.text(number_format(x,2),u+80,a-20);var E;x=(E=cuenta3.segundoAno.total-cuenta6.segundoAno.total)/G.moneda.dolar;n.text(number_format(E,2),u+180,a-20),G.configuracionImpresion.bimonetario&&n.text(number_format(x,2),u+260,a-20)}}}}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}n.text("TOTAL "+cuenta.primerAno.nombre,90,a),n.text(number_format(cuenta.primerAno.total,2),u,a);var C=cuenta.primerAno.total/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text(number_format(C,2),u+80,a),n.text(number_format(cuenta.segundoAno.total,2),u+180,a);C=cuenta.segundoAno.total/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text(number_format(C,2),u+260,a),a+=20,r++,b===f.length-1&&G.dibujarPatrimonioComparativoPredefinido(o,e,n,a,r,t,i,c,u,s,m,d,g)}else b===f.length-1&&G.dibujarPatrimonioComparativoPredefinido(o,e,n,a,r,t,i,c,u,s,m,d,g)},G.DibujarFijoSubGrupo=function(o,e,n,a,r,t,i,c,u){if("COMPARATIVO"!=G.configuracionImpresion.tipoPeriodo.nombre){n.font("Helvetica",8);for(var s=0;s<o.cuentasSubGrupoFijo.length&&r<=c;s++)if(cuenta=o.cuentasSubGrupoFijo[s],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8)),n.text(cuenta.nombre,30,a),a+=20,r++;for(var m=0;m<o.cuentasGenericasFijo.length&&r<=c;m++){cuenta3=o.cuentasGenericasFijo[m],cuenta3.total=0;var d=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==d){if(o.cuentasApropiacionFijo.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e}))for(var g=0;g<o.cuentasGenericasFijo.length&&r<=c;g++){cuenta6=o.cuentasGenericasFijo[g],cuenta6.total=0;d=String(cuenta6.codigo).substr(3),String(cuenta3.codigo).substr(3);if(g==o.cuentasGenericasFijo.length-1)for(var f=0;f<o.cuentasApropiacionFijo.length&&r<=c;f++){cuenta2=o.cuentasApropiacionFijo[f];d=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==d){cuenta3.total+=cuenta2.saldo;for(var p=0;p<o.cuentasApropiacionFijo.length&&r<=c;p++){cuenta5=o.cuentasApropiacionFijo[p];d=String(cuenta5.codigo).substr(4);if(String(cuenta2.codigo).substr(4)==d&&"Pasivo"===cuenta5.clasificacion.nombre){cuenta6.total+=cuenta5.saldo;var l=cuenta2.saldo-cuenta5.saldo;cuenta.total+=l,e+=l}}}}}}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8))}n.text("TOTAL "+cuenta.nombre,90,a),n.text(number_format(cuenta.total,2),u,a);var b=cuenta.total/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text(number_format(b,2),u+130,a),a+=20,r++,s===o.cuentasSubGrupoFijo.length-1&&G.dibujarPatrimonioSubGrupo(o,e,n,a,r,t,i,c,u)}else s===o.cuentasSubGrupoFijo.length-1&&G.dibujarPatrimonioSubGrupo(o,e,n,a,r,t,i,c,u)}},G.DibujarFijoGrupo=function(o,e,n,a,r,t,i,c,u){if("COMPARATIVO"!=G.configuracionImpresion.tipoPeriodo.nombre){n.font("Helvetica",8);for(var s=0;s<o.cuentasSubGrupoFijo.length&&r<=c;s++)if(cuenta=o.cuentasSubGrupoFijo[s],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8));for(var m=0;m<o.cuentasGenericasFijo.length&&r<=c;m++){cuenta3=o.cuentasGenericasFijo[m],cuenta3.total=0;var d=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==d&&o.cuentasApropiacionFijo.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e}))for(var g=0;g<o.cuentasGenericasFijo.length&&r<=c;g++){cuenta6=o.cuentasGenericasFijo[g],cuenta6.total=0;d=String(cuenta6.codigo).substr(3);if(String(cuenta3.codigo).substr(3)==d&&cuenta6.clasificacion.nombre,g==o.cuentasGenericasFijo.length-1)for(var f=0;f<o.cuentasApropiacionFijo.length&&r<=c;f++){cuenta2=o.cuentasApropiacionFijo[f];d=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==d){cuenta3.total+=cuenta2.saldo;cuenta2.saldo,G.moneda.dolar;for(var p=0;p<o.cuentasApropiacionFijo.length&&r<=c;p++){cuenta5=o.cuentasApropiacionFijo[p];d=String(cuenta5.codigo).substr(4);if(String(cuenta2.codigo).substr(4)==d&&"Pasivo"===cuenta5.clasificacion.nombre){cuenta6.total+=cuenta5.saldo;var l=cuenta2.saldo-cuenta5.saldo;cuenta.total+=l,e+=l}}}}}}n.text("TOTAL "+cuenta.nombre,90,a),n.text(number_format(cuenta.total,2),u,a);var b=cuenta.total/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text(number_format(b,2),u+130,a),a+=20,r++,s===o.cuentasSubGrupoFijo.length-1&&G.dibujarPatrimonioGrupo(o,e,n,a,r,t,i,c,u)}else s===o.cuentasSubGrupoFijo.length-1&&G.dibujarPatrimonioGrupo(o,e,n,a,r,t,i,c,u)}},G.dibujarPatrimonio=function(o,e,n,a,r,t,i,c,u){if("COMPARATIVO"!=G.configuracionImpresion.tipoPeriodo.nombre){var s=0;n.font("Helvetica-Bold",8),n.text("TOTAL Gastos de Operación :  ",30,a),n.text(number_format(e,2),u,a);var m=e/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text(number_format(m,2),u+130,a),a+=20,n.text("PASIVO Y PATRIMONIO",0,a,{align:"center"}),a+=20;for(var d=0;d<o.cuentasSubGrupo.length&&r<=c;d++){var g=o.cuentasSubGrupo[d];if("Pasivo"===g.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8)),n.text(g.nombre,30,a),a+=20,r++;for(var f=g.total=0;f<o.cuentasGenericas.length&&r<=c;f++){var p=o.cuentasGenericas[f];if("3"===p.tipoCuenta.nombre_corto){var l=String(p.codigo).substr(0,3);if(g.codigo==l){if(o.cuentasApropiacion.some(function(o){var e=String(o.codigo).substr(0,5);return p.codigo==e})){n.text(p.nombre,40,a),a+=20,r++;for(var b=0;b<o.cuentasApropiacion.length&&r<=c;b++){var A=o.cuentasApropiacion[b];if("4"===A.tipoCuenta.nombre_corto){l=String(A.codigo).substr(0,5);if(p.codigo==l){n.text(A.nombre,60,a),n.text(number_format(A.saldo,2),u,a);var v=A.saldo/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a),g.total+=A.saldo,s+=A.saldo,a+=20,++r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}}}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}n.text("TOTAL "+g.nombre,90,a),n.text(number_format(g.total,2),u,a);v=Math.round(g.total/G.moneda.dolar*1e4)/1e4;G.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a),a+=20,r++}if(d===o.cuentasSubGrupo.length-1){n.font("Helvetica-Bold",8),n.text("TOTAL PASIVO:  ",30,a),n.text(number_format(s,2),u,a);v=Math.round(s/G.moneda.dolar*1e4)/1e4;G.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a)}}}},G.dibujarPatrimonioComparativoPredefinido=function(o,e,n,a,r,t,i,c,u,s,m,d,g){var f={totalPasivoPrimerAnio:0,totalPasivoSegundoAnio:0};n.font("Helvetica-Bold",8),n.text("TOTAL ACTIVOS  ",30,a),n.text(number_format(e.totalActivosPrimerAnio,2),u,a);var p=e.totalActivosPrimerAnio/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text(number_format(p,2),u+130,a),a+=20,r++,n.text("PASIVO Y PATRIMONIO",0,a,{align:"center"}),r++,a+=20;for(var l=0;l<m.length&&r<=c;l++){n.font("Helvetica",8);var b=m[l];if("Pasivo"===b.primerAno.clasificacion.nombre||"Capital"==b.primerAno.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8)),n.text(b.primerAno.nombre,30,a),b.primerAno.total=0,a+=20,r++;for(var A=b.segundoAno.total=0;A<d.length&&r<=c;A++){var v=d[A],I=String(v.primerAno.codigo).substr(0,3);if(b.primerAno.codigo==I){if(g.some(function(o){var e=String(o.primerAno.codigo).substr(0,5);return v.primerAno.codigo==e})){n.text(v.primerAno.nombre,40,a),v.primerAno.total=0,v.primerAno.totalSus=0,v.segundoAno.total=0;for(var P=v.segundoAno.totalSus=0;P<g.length&&r<=c;P++){var h=g[P];if("4"===h.primerAno.tipoCuenta.nombre_corto){I=String(h.primerAno.codigo).substr(0,5);v.primerAno.codigo==I&&(v.primerAno.total+=h.primerAno.saldo,v.primerAno.totalSus+=h.primerAno.saldo/G.moneda.dolar,b.primerAno.total+=h.primerAno.saldo,v.segundoAno.total+=h.segundoAno.saldo,v.segundoAno.totalSus+=h.segundoAno.saldo/G.moneda.dolar,b.segundoAno.total+=h.segundoAno.saldo,f.totalPasivoPrimerAnio+=h.primerAno.saldo,f.totalPasivoSegundoAnio+=h.segundoAno.saldo),r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}n.text(v.primerAno.total,u,a),G.configuracionImpresion.bimonetario&&n.text(number_format(v.primerAno.totalSus,2),u+80,a),n.text(v.segundoAno.total,u+180,a),G.configuracionImpresion.bimonetario&&n.text(number_format(v.segundoAno.totalSus,2),u+260,a),a+=20,r++}}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}n.text("TOTAL "+b.primerAno.nombre,90,a),n.text(number_format(b.primerAno.total,2),u,a),n.text(number_format(b.segundoAno.total,2),u+180,a);var _=Math.round(b.primerAno.total/G.moneda.dolar*1e4)/1e4;G.configuracionImpresion.bimonetario&&n.text(number_format(_,2),u+80,a);_=Math.round(b.segundoAno.total/G.moneda.dolar*1e4)/1e4;G.configuracionImpresion.bimonetario&&n.text(number_format(_,2),u+260,a),a+=20,r++}if(l===m.length-1){n.font("Helvetica-Bold",8),n.text("TOTAL PASIVO:  ",30,a),n.text(number_format(f.totalPasivoPrimerAnio,2),u,a);_=Math.round(f.totalPasivoPrimerAnio/G.moneda.dolar*1e4)/1e4;G.configuracionImpresion.bimonetario&&n.text(number_format(_,2),u+80,a),n.text(number_format(f.totalPasivoSegundoAnio,2),u+180,a);_=Math.round(f.totalPasivoSegundoAnio/G.moneda.dolar*1e4)/1e4;G.configuracionImpresion.bimonetario&&n.text(number_format(_,2),u+260,a)}}},G.dibujarIngresoEgresoPredefinido=function(o,e,n,a,r,t,i,c,u){var s=0;n.font("Helvetica-Bold",8),n.text("TOTAL GASTOS DE OPERACIÓN  ",30,a),n.text(number_format(e,2),u,a);var m=e/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text(number_format(m,2),u+130,a),a+=20,r++,n.text("Otro Ingresos y Egresos:",30,a),a+=20,r++;for(var d=0;d<o.cuentasSubGrupoIngresoEgreso.length&&r<=c;d++){n.font("Helvetica",8);var g=o.cuentasSubGrupoIngresoEgreso[d];r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFBalanceGeneral(n,t,i,"Otros ingresos y Egresos:"),n.font("Helvetica",8)),n.text(g.nombre,30,a),a+=20,r++;for(var f=g.total=0;f<o.cuentasGenericasIngresoEgreso.length&&r<=c;f++){var p=o.cuentasGenericasIngresoEgreso[f],l=String(p.codigo).substr(0,3);if(g.codigo==l){if(o.cuentasApropiacionIngresoEgreso.some(function(o){var e=String(o.codigo).substr(0,5);return p.codigo==e})){n.text(p.nombre,40,a),p.total=0;for(var b=p.totalSus=0;b<o.cuentasApropiacionIngresoEgreso.length&&r<=c;b++){var A=o.cuentasApropiacionIngresoEgreso[b];l=String(A.codigo).substr(0,5);p.codigo==l&&(p.total+=A.saldo,p.totalSus+=A.saldo/G.moneda.dolar,g.total+=A.saldo,s+=A.saldo),r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFBalanceGeneral(n,t,i,"Otros ingresos y Egresos:"),n.font("Helvetica",8))}n.text(p.total,u,a),G.configuracionImpresion.bimonetario&&n.text(number_format(p.totalSus,2),u+130,a),a+=20,r++}}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFBalanceGeneral(n,t,i,"Otros ingresos y Egresos:"),n.font("Helvetica",8))}n.text("TOTAL "+g.nombre,90,a),n.text(number_format(g.total,2),u,a);var v=Math.round(g.total/G.moneda.dolar*1e4)/1e4;if(G.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a),a+=20,r++,d===o.cuentasSubGrupoIngresoEgreso.length-1){n.font("Helvetica-Bold",8),n.text("TOTAL Otros ingresos y Egresos:  ",30,a),n.text(number_format(s,2),u,a);v=Math.round(s/G.moneda.dolar*1e4)/1e4;G.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a)}}},G.dibujarPatrimonioSubGrupo=function(o,e,n,a,r,t,i,c,u){if("COMPARATIVO"!=G.configuracionImpresion.tipoPeriodo.nombre){var s=0;n.font("Helvetica-Bold",8),n.text("TOTAL ACTIVOS  ",30,a),n.text(number_format(e,2),u,a);var m=e/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text(number_format(m,2),u+130,a),a+=20,r++,n.text("PASIVO Y PATRIMONIO",0,a,{align:"center"}),a+=20,r++;for(var d=0;d<o.cuentasSubGrupo.length&&r<=c;d++){n.font("Helvetica",8);var g=o.cuentasSubGrupo[d];if("Pasivo"===g.clasificacion.nombre||"Capital"==g.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8)),n.text(g.nombre,30,a),g.total=0;for(var f=g.totalSus=0;f<o.cuentasGenericas.length&&r<=c;f++){var p=o.cuentasGenericas[f];if("3"===p.tipoCuenta.nombre_corto){var l=String(p.codigo).substr(0,3);if(g.codigo==l&&o.cuentasApropiacion.some(function(o){var e=String(o.codigo).substr(0,5);return p.codigo==e}))for(var b=0;b<o.cuentasApropiacion.length&&r<=c;b++){var A=o.cuentasApropiacion[b];if("4"===A.tipoCuenta.nombre_corto){l=String(A.codigo).substr(0,5);p.codigo==l&&(g.totalSus+=A.saldo/G.moneda.dolar,g.total+=A.saldo,s+=A.saldo)}}}}n.text(g.total,u,a),G.configuracionImpresion.bimonetario&&n.text(number_format(g.totalSus,2),u+130,a),a+=20,r++,n.text("TOTAL "+g.nombre,90,a),n.text(number_format(g.total,2),u,a);var v=Math.round(g.total/G.moneda.dolar*1e4)/1e4;G.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a),a+=20,r++}if(d===o.cuentasSubGrupo.length-1){n.font("Helvetica-Bold",8),n.text("TOTAL PASIVO:  ",30,a),n.text(number_format(s,2),u,a);v=Math.round(s/G.moneda.dolar*1e4)/1e4;G.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a)}}}},G.dibujarPatrimonioGrupo=function(o,e,n,a,r,t,i,c,u){if("COMPARATIVO"!=G.configuracionImpresion.tipoPeriodo.nombre){var s=0;n.font("Helvetica-Bold",8),n.text("TOTAL ACTIVOS  ",30,a),n.text(number_format(e,2),u,a);var m=e/G.moneda.dolar;G.configuracionImpresion.bimonetario&&n.text(number_format(m,2),u+130,a),a+=20,r++,n.text("PASIVO Y PATRIMONIO",0,a,{align:"center"}),a+=20,r++;for(var d=0;d<o.cuentasGrupo.length&&r<=c;d++){if(cuenta=o.cuentasGrupo[d],cuenta.total=0,cuenta.totalSus=0,"Pasivo"===cuenta.clasificacion.nombre||"Capital"===cuenta.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,G.dibujarCabeceraPDFEstadoResultado(n,t,i,"ACTIVO"),n.font("Helvetica",8)),n.text(cuenta.nombre,30,a);for(var g=0;g<o.cuentasSubGrupo.length&&r<=c;g++)if(cuenta4=o.cuentasSubGrupo[g],"2"===cuenta4.tipoCuenta.nombre_corto){var f=String(cuenta4.codigo).substr(0,1);if(cuenta.codigo==f)for(var p=0;p<o.cuentasGenericas.length&&r<=c;p++)if(cuenta3=o.cuentasGenericas[p],"3"===cuenta3.tipoCuenta.nombre_corto){f=String(cuenta3.codigo).substr(0,3);if(cuenta4.codigo==f&&o.cuentasApropiacion.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e}))for(var l=0;l<o.cuentasApropiacion.length&&r<=c;l++)if(cuenta2=o.cuentasApropiacion[l],"4"===cuenta2.tipoCuenta.nombre_corto){f=String(cuenta2.codigo).substr(0,5);cuenta3.codigo==f&&(cuenta.total+=cuenta2.saldo,cuenta.totalSus+=cuenta2.saldo,s+=cuenta2.saldo)}}}n.text(cuenta.total,u,a),G.configuracionImpresion.bimonetario&&n.text(number_format(cuenta.totalSus,2),u+130,a),a+=20,r++,n.text("TOTAL "+cuenta.nombre,90,a),n.text(number_format(cuenta.total,2),u,a);var b=Math.round(cuenta.total/G.moneda.dolar*1e4)/1e4;G.configuracionImpresion.bimonetario&&n.text(number_format(b,2),u+130,a),a+=20,r++}if(d===o.cuentasGrupo.length-1){n.font("Helvetica-Bold",8),n.text("TOTAL PASIVO:  ",30,a),n.text(number_format(s,2),u,a);b=Math.round(s/G.moneda.dolar*1e4)/1e4;G.configuracionImpresion.bimonetario&&n.text(number_format(b,2),u+130,a)}}}},G.generarPdfPreComparativo=function(o,e,n,a,r,t,i,c,u){},G.generarPdfGrupo=function(o,e,n,a,r,t){if("COMPARATIVO"!=G.configuracionImpresion.tipoPeriodo.nombre){var i=new PDFDocument({size:"letter",margin:10}),c=i.pipe(blobStream()),u=[],s=[],m=130,d=0,g=G.configuracionImpresion.usar_empesar_numeracion?G.configuracionImpresion.empesar_numeracion:1,f=G.configuracionImpresion.usar_empesar_numeracion?G.configuracionImpresion.empesar_numeracion-1+Math.ceil((u.length+s.length)/28):Math.ceil((u.length+s.length)/28),p=0;G.dibujarCabeceraPDFEstadoResultado(i,g,f,"ACTIVO"),i.font("Helvetica",8);for(var l=0;l<n.length&&d<=28;l++)if(cuenta=n[l],cuenta.total=0,cuenta.totalSus=0,"Activo"===cuenta.clasificacion.nombre){28==d&&(i.addPage({margin:0,bufferPages:!0}),m=140,d=0,g+=1,G.dibujarCabeceraPDFEstadoResultado(i,g,f,"ACTIVO"),i.font("Helvetica",8)),i.text(cuenta.nombre,30,m);for(var b=0;b<a.length&&d<=28;b++)if(cuenta4=a[b],"2"===cuenta4.tipoCuenta.nombre_corto){var A=String(cuenta4.codigo).substr(0,1);if(cuenta.codigo==A)for(var v=0;v<r.length&&d<=28;v++)if(cuenta3=r[v],"3"===cuenta3.tipoCuenta.nombre_corto){A=String(cuenta3.codigo).substr(0,3);if(cuenta4.codigo==A&&t.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e}))for(var I=0;I<t.length&&d<=28;I++)if(cuenta2=t[I],"4"===cuenta2.tipoCuenta.nombre_corto){A=String(cuenta2.codigo).substr(0,5);cuenta3.codigo==A&&(cuenta.total+=cuenta2.saldo,cuenta.totalSus+=cuenta2.saldo,p+=cuenta2.saldo)}}}G.configuracionImpresion.bimonetario&&i.text(number_format(cuenta.totalSus,2),e+130,m),i.text(number_format(cuenta.total,2),e,m),m+=20,d++,i.text("TOTAL "+cuenta.nombre,90,m),i.text(number_format(cuenta.total,2),e,m);var P=cuenta.total/G.moneda.dolar;G.configuracionImpresion.bimonetario&&i.text(number_format(P,2),e+130,m),m+=20,d++,l===n.length-1&&G.DibujarFijoGrupo(o,p,i,m,d,g,f,28,e)}else l===n.length-1&&G.DibujarFijoGrupo(o,p,i,m,d,g,f,28,e);G.configuracionImpresion.usar_firma_uno&&(i.text(G.configuracionImpresion.firma_uno,170,720),i.text(G.configuracionImpresion.cargo_uno,170,730)),G.configuracionImpresion.usar_firma_dos&&(i.text(G.configuracionImpresion.firma_dos,370,720),i.text(G.configuracionImpresion.cargo_dos,370,730)),i.end(),c.on("finish",function(){var o=c.toBlobURL("application/pdf");window.open(o,"_blank","location=no")}),_.stop()}},G.generarPdfsubGrupo=function(o,e,n,a,r,t){if("COMPARATIVO"!=G.configuracionImpresion.tipoPeriodo.nombre){var i=new PDFDocument({size:"letter",margin:10}),c=i.pipe(blobStream()),u=[],s=[],m=130,d=0,g=G.configuracionImpresion.usar_empesar_numeracion?G.configuracionImpresion.empesar_numeracion:1,f=G.configuracionImpresion.usar_empesar_numeracion?G.configuracionImpresion.empesar_numeracion-1+Math.ceil((u.length+s.length)/28):Math.ceil((u.length+s.length)/28),p=0;G.dibujarCabeceraPDFEstadoResultado(i,g,f,"ACTIVO"),i.font("Helvetica",8);for(var l=0;l<a.length&&d<=28;l++)if(cuenta=a[l],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){28==d&&(i.addPage({margin:0,bufferPages:!0}),m=140,d=0,g+=1,G.dibujarCabeceraPDFEstadoResultado(i,g,f,"ACTIVO"),i.font("Helvetica",8)),i.text(cuenta.nombre,30,m);for(var b=0;b<r.length&&d<=28;b++)if(cuenta3=r[b],"3"===cuenta3.tipoCuenta.nombre_corto){var A=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==A&&t.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e}))for(var v=0;v<t.length&&d<=28;v++)if(cuenta2=t[v],"4"===cuenta2.tipoCuenta.nombre_corto){A=String(cuenta2.codigo).substr(0,5);cuenta3.codigo==A&&(cuenta.total+=cuenta2.saldo,cuenta.totalSus+=cuenta2.saldo,p+=cuenta2.saldo)}}G.configuracionImpresion.bimonetario&&i.text(number_format(cuenta.totalSus,2),e+130,m),i.text(number_format(cuenta.total,2),e,m),m+=20,d++,i.text("TOTAL "+cuenta.nombre,90,m),i.text(number_format(cuenta.total,2),e,m);var I=cuenta.total/G.moneda.dolar;G.configuracionImpresion.bimonetario&&i.text(number_format(I,2),e+130,m),m+=20,d++,l===a.length-1&&G.DibujarFijoSubGrupo(o,p,i,m,d,g,f,28,e)}else l===a.length-1&&G.DibujarFijoSubGrupo(o,p,i,m,d,g,f,28,e);G.configuracionImpresion.usar_firma_uno&&(i.text(G.configuracionImpresion.firma_uno,170,720),i.text(G.configuracionImpresion.cargo_uno,170,730)),G.configuracionImpresion.usar_firma_dos&&(i.text(G.configuracionImpresion.firma_dos,370,720),i.text(G.configuracionImpresion.cargo_dos,370,730)),i.end(),c.on("finish",function(){var o=c.toBlobURL("application/pdf");window.open(o,"_blank","location=no")}),_.stop()}},G.generarPdfPreestablecido=function(o,e,n,a,r,t,i,c,u){var s=new PDFDocument({size:"letter",margin:10}),m=s.pipe(blobStream()),d=130,g=0,f=G.configuracionImpresion.usar_empesar_numeracion?G.configuracionImpresion.empesar_numeracion:1,p=G.configuracionImpresion.usar_empesar_numeracion?G.configuracionImpresion.empesar_numeracion-1+Math.ceil(20/28):Math.ceil(20/28),l=0;G.dibujarCabeceraPDFEstadoResultado(s,f,p,""),s.font("Helvetica",8),s.text("VENTAS  ",40,115),s.text(c.toFixed(2),500,115),s.text("COSTO DE VENTAS  ",40,125),s.text(u.toFixed(2),500,125),s.text("UTILIDAD BRUTA SOBRE VENTAS",40,135);var b=c-u;s.text(b.toFixed(2),500,135),s.text("TOTAL  ",70,145),s.font("Helvetica-Bold",8),s.text("Gastos de Operación :",30,155),s.font("Helvetica",8);s.text((0).toFixed(2),500,155),d+=40;for(var A=0;A<a.length&&g<=28;A++)if(cuenta=a[A],cuenta.total=0,"EGRESO"===cuenta.clasificacion.nombre.toUpperCase()){28==g&&(s.addPage({margin:0,bufferPages:!0}),d=140,g=0,f+=1,G.dibujarCabeceraPDFEstadoResultado(s,f,p,"Gastos de Operación :"),s.font("Helvetica",8)),s.text(cuenta.nombre,30,d),d+=20,g++;for(var v=0;v<r.length&&g<=28;v++){cuenta3=r[v];var I=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==I){if(t.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e})){s.text(cuenta3.nombre,40,d),cuenta3.total=0;for(var P=cuenta3.totalSus=0;P<t.length&&g<=28;P++){cuenta2=t[P];I=String(cuenta2.codigo).substr(0,5);cuenta3.codigo==I&&(cuenta3.totalSus+=cuenta2.saldo/G.moneda.dolar,cuenta3.total+=cuenta2.saldo,cuenta.total+=cuenta2.saldo,l+=cuenta2.saldo),28==g&&(s.addPage({margin:0,bufferPages:!0}),d=140,g=0,f+=1,G.dibujarCabeceraPDFEstadoResultado(s,f,p,"Gastos de Operación :"),s.font("Helvetica",8))}G.configuracionImpresion.bimonetario&&s.text(number_format(cuenta3.totalSus,2),e+130,d),s.text(number_format(cuenta3.total,2),e,d),d+=20,g++}}else 28==g&&(s.addPage({margin:0,bufferPages:!0}),d=140,g=0,f+=1,G.dibujarCabeceraPDFEstadoResultado(s,f,p,"Gastos de Operación :"),s.font("Helvetica",8))}s.text("TOTAL "+cuenta.nombre,90,d),s.text(number_format(cuenta.total,2),e,d);var h=cuenta.total/G.moneda.dolar;G.configuracionImpresion.bimonetario&&s.text(number_format(h,2),e+130,d),d+=20,g++,A===a.length-1&&G.dibujarIngresoEgresoPredefinido(o,l,s,d,g,f,p,28,e)}else A===a.length-1&&G.dibujarIngresoEgresoPredefinido(o,l,s,d,g,f,p,28,e);G.configuracionImpresion.usar_firma_uno&&(s.text(G.configuracionImpresion.firma_uno,170,720),s.text(G.configuracionImpresion.cargo_uno,170,730)),G.configuracionImpresion.usar_firma_dos&&(s.text(G.configuracionImpresion.firma_dos,370,720),s.text(G.configuracionImpresion.cargo_dos,370,730)),s.end(),m.on("finish",function(){var o=m.toBlobURL("application/pdf");window.open(o,"_blank","location=no")}),_.stop()},G.generarPdfComprobantePreestablecido=function(o,e,n,a,r,t,i,c,u){var s=new PDFDocument({size:"letter",margin:10}),m=s.pipe(blobStream()),d=a.length+r.length,g=130,f=0,p=G.configuracionImpresion.usar_empesar_numeracion?G.configuracionImpresion.empesar_numeracion:1,l=G.configuracionImpresion.usar_empesar_numeracion?G.configuracionImpresion.empesar_numeracion-1+Math.ceil(d/28):Math.ceil(d/28),b={totalActivosPrimerAnio:0,totalActivosSegundoAnio:0};G.dibujarCabeceraPDFEstadoResultado(s,p,l,"ACTIVO"),s.font("Helvetica",8);for(var A=0;A<a.length&&f<=28;A++)if(cuenta=a[A],cuenta.total=0,"Activo"===cuenta.primerAno.clasificacion.nombre){28==f&&(s.addPage({margin:0,bufferPages:!0}),g=140,f=0,p+=1,G.dibujarCabeceraPDFEstadoResultado(s,p,l,"ACTIVO"),s.font("Helvetica",8)),s.text(cuenta.primerAno.nombre,30,g),cuenta.primerAno.total=0,cuenta.primerAno.totalSus=0,cuenta.segundoAno.total=0,g+=20,f++;for(var v=cuenta.segundoAno.totalSus=0;v<r.length&&f<=28;v++)if(cuenta3=r[v],"3"===cuenta3.primerAno.tipoCuenta.nombre_corto){var I=String(cuenta3.primerAno.codigo).substr(0,3);if(cuenta.primerAno.codigo==I){if(t.some(function(o){var e=String(o.primerAno.codigo).substr(0,5);return cuenta3.primerAno.codigo==e})){s.text(cuenta3.primerAno.nombre,40,g),cuenta3.primerAno.total=0,cuenta3.primerAno.totalSus=0,cuenta3.segundoAno.total=0;for(var P=cuenta3.segundoAno.totalSus=0;P<t.length&&f<=28;P++)if(cuenta2=t[P],"4"===cuenta2.primerAno.tipoCuenta.nombre_corto){I=String(cuenta2.primerAno.codigo).substr(0,5);cuenta3.primerAno.codigo==I&&(cuenta3.primerAno.totalSus+=cuenta2.primerAno.saldo/G.moneda.dolar,cuenta3.segundoAno.totalSus+=cuenta2.segundoAno.saldo/G.moneda.dolar,cuenta3.primerAno.total+=cuenta2.primerAno.saldo,cuenta.primerAno.total+=cuenta2.primerAno.saldo,cuenta3.segundoAno.total+=cuenta2.segundoAno.saldo,cuenta.segundoAno.total+=cuenta2.segundoAno.saldo,b.totalActivosPrimerAnio+=cuenta2.primerAno.saldo,b.totalActivosSegundoAnio+=cuenta2.segundoAno.saldo),28==f&&(s.addPage({margin:0,bufferPages:!0}),g=140,f=0,p+=1,G.dibujarCabeceraPDFEstadoResultado(s,p,l,"ACTIVO"),s.font("Helvetica",8))}else 28==f&&(s.addPage({margin:0,bufferPages:!0}),g=140,f=0,p+=1,G.dibujarCabeceraPDFEstadoResultado(s,p,l,"ACTIVO"),s.font("Helvetica",8));G.configuracionImpresion.bimonetario&&s.text(number_format(cuenta3.primerAno.totalSus,2),e+80,g),s.text(number_format(cuenta3.primerAno.total,2),e+180,g),G.configuracionImpresion.bimonetario&&s.text(number_format(cuenta3.segundoAno.totalSus,2),e+260,g),s.text(number_format(cuenta3.segundoAno.total,2),e,g),g+=20,f++}}else 28==f&&(s.addPage({margin:0,bufferPages:!0}),g=140,f=0,p+=1,G.dibujarCabeceraPDFEstadoResultado(s,p,l,"ACTIVO"),s.font("Helvetica",8))}else 28==f&&(s.addPage({margin:0,bufferPages:!0}),g=140,f=0,p+=1,G.dibujarCabeceraPDFEstadoResultado(s,p,l,"ACTIVO"),s.font("Helvetica",8));s.text("TOTAL "+cuenta.primerAno.nombre,90,g),s.text(number_format(cuenta.primerAno.total,2),e,g),s.text(number_format(cuenta.segundoAno.total,2),e+180,g);var h=cuenta.primerAno.total/G.moneda.dolar;G.configuracionImpresion.bimonetario&&s.text(number_format(h,2),e+80,g);h=cuenta.segundoAno.total/G.moneda.dolar;G.configuracionImpresion.bimonetario&&s.text(number_format(h,2),e+260,g),g+=20,f++,A===a.length-1&&G.DibujarFijoComparativoPreestablecido(o,b,s,g,f,p,l,28,e,n,a,r,t,i,c,u)}else A===a.length-1&&G.DibujarFijoComparativoPreestablecido(o,b,s,g,f,p,l,28,e,n,a,r,t,i,c,u);G.configuracionImpresion.usar_firma_uno&&(s.text(G.configuracionImpresion.firma_uno,170,720),s.text(G.configuracionImpresion.cargo_uno,170,730)),G.configuracionImpresion.usar_firma_dos&&(s.text(G.configuracionImpresion.firma_dos,370,720),s.text(G.configuracionImpresion.cargo_dos,370,730)),s.end(),m.on("finish",function(){var o=m.toBlobURL("application/pdf");window.open(o,"_blank","location=no")}),_.stop()},G.dibujarCabeceraPDFEstadoResultado=function(o,e,n,a){if(o.font("Helvetica-Bold",8),o.text(G.usuario.empresa.razon_social,40,30,{width:220}),o.text("DE : ",40,40),o.text("NIT : ",40,50),o.text(G.usuario.empresa.direccion,40,60,{width:220}),o.text(G.usuario.empresa.nit,55,50),o.font("Helvetica-Bold",12),o.text("ESTADO DE RESULTADOS",0,75,{align:"center"}),o.font("Helvetica-Bold",8),"GES"==G.configuracionImpresion.tipoPeriodo.nombre_corto){var r=(new Date).getFullYear(),t=(new Date).getMonth(),i=new Date(r,t-1,0).getDate();G.configuracionImpresion.gestion.nombre<r?o.text("Al 31 de Diciembre de "+G.configuracionImpresion.gestion.nombre,0,85,{align:"center"}):o.text("Al "+i+" de "+G.meses[t].nombre+" de "+G.configuracionImpresion.gestion.nombre,0,85,{align:"center"})}else if("MES"==G.configuracionImpresion.tipoPeriodo.nombre_corto)o.text(G.configuracionImpresion.mes.nombre+" de "+G.configuracionImpresion.gestion.nombre,0,85,{align:"center"});else if("FECHAS"==G.configuracionImpresion.tipoPeriodo.nombre_corto){var c=new Date(G.convertirFecha(G.configuracionImpresion.fecha_inicio)),u=new Date(G.convertirFecha(G.configuracionImpresion.fecha_fin));o.text("Desde el "+c.getDate()+" de "+G.meses[c.getMonth()].nombre+" "+c.getFullYear()+" al "+u.getDate()+" de "+G.meses[u.getMonth()].nombre+" de "+u.getFullYear(),0,85,{align:"center"})}else"COMP"==G.configuracionImpresion.tipoPeriodo.nombre_corto&&o.text("Gestión "+G.configuracionImpresion.gestion.nombre+"- Gestión "+G.configuracionImpresion.gestion_fin.nombre,0,85,{align:"center"});G.configuracionImpresion.bimonetario?(o.text("Expresado en Bolivianos y Dólares",0,95,{align:"center"}),"COMPARATIVO"!=G.configuracionImpresion.tipoPeriodo.nombre||(o.text(G.configuracionImpresion.gestion.nombre,340,115),o.text(G.configuracionImpresion.gestion_fin.nombre,525,115))):o.text("Expresado en Bolivianos",0,95,{align:"center"}),o.font("Helvetica-Bold",8),o.text(a,30,145),o.font("Helvetica",8),"SAD"==G.configuracionImpresion.tipoNumeracion.nombre_corto?o.text("PÁGINA "+e,540,740):"SAI"==G.configuracionImpresion.tipoNumeracion.nombre_corto?o.text("PÁGINA "+e,0,740,{align:"center"}):"SSD"==G.configuracionImpresion.tipoNumeracion.nombre_corto?o.text("PÁGINA "+e,540,20):"PPD"==G.configuracionImpresion.tipoNumeracion.nombre_corto?o.text("PÁGINA "+e+" DE "+n,520,740):"PPC"==G.configuracionImpresion.tipoNumeracion.nombre_corto?o.text("PÁGINA "+e+" DE "+n,0,740,{align:"center"}):"PPSD"==G.configuracionImpresion.tipoNumeracion.nombre_corto&&o.text("PÁGINA "+e+" DE "+n,520,20),o.font("Helvetica",5),o.text(G.configuracionImpresion.usar_frase_pie_pagina?G.configuracionImpresion.frase_pie_pagina+", ":"",40,740),o.text((G.configuracionImpresion.usar_lugar_emision?G.configuracionImpresion.lugar_emision+", ":"")+(G.configuracionImpresion.usar_fecha_emision?G.fechaATexto(G.configuracionImpresion.fecha_emision):""),40,750)},G.generarExcelBalanceGeneral=function(o){c(G.configuracionImpresion,G.usuario.id_empresa).then(function(o){G.Cuentas=o.cuentas;for(var e=[["","","ESTADO CUENTAS PROVEEDOR"],["Deudor :"+proveedor.razon_social],["Fecha","N Recibo","Descripción","monto","total","total General"]],n=0,a=0;a<proveedor.compras.length;a++){var r=[];n+=proveedor.compras[a].saldo,proveedor.compras[a].fecha=new Date(proveedor.compras[a].fecha),r.push(proveedor.compras[a].fecha.getDate()+"/"+(proveedor.compras[a].fecha.getMonth()+1)+"/"+proveedor.compras[a].fecha.getFullYear()),r.push(proveedor.compras[a].id_movimiento),null==proveedor.compras[a].factura?r.push("PROFORMA"):r.push("factura : "+proveedor.compras[a].factura),r.push(proveedor.compras[a].saldo),r.push(n),r.push(n),e.push(r)}var t="SheetJS",i=new Workbook,c=sheet_from_array_of_arrays(e);i.SheetNames.push(t),i.Sheets[t]=c;var u=XLSX.write(i,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(u)],{type:"application/octet-stream"}),"REPORTE-ESTADO-CUENTA-PROVEEDOR.xlsx"),_.stop()})},G.dibujarCabeceraExelBalanceGeneral=function(){var o="",e="";if("GES"==G.configuracionImpresion.tipoPeriodo.nombre_corto){var n=(new Date).getFullYear(),a=(new Date).getMonth(),r=new Date(n,a-1,0).getDate();o=G.configuracionImpresion.gestion.nombre<n?"Al 31 de Diciembre de "+G.configuracionImpresion.gestion.nombre:"Al "+r+" de "+G.meses[a].nombre+" de "+G.configuracionImpresion.gestion.nombre}else if("MES"==G.configuracionImpresion.tipoPeriodo.nombre_corto)o=G.configuracionImpresion.mes.nombre+" de "+G.configuracionImpresion.gestion.nombre;else if("FECHAS"==G.configuracionImpresion.tipoPeriodo.nombre_corto){var t=new Date(G.convertirFecha(G.configuracionImpresion.fecha_inicio)),i=new Date(G.convertirFecha(G.configuracionImpresion.fecha_fin));o="Desde el "+t.getDate()+" de "+G.meses[t.getMonth()].nombre+" "+t.getFullYear()+" al "+i.getDate()+" de "+G.meses[i.getMonth()].nombre+" de "+i.getFullYear()}else"COMP"==G.configuracionImpresion.tipoPeriodo.nombre_corto&&(o="Gestión "+G.configuracionImpresion.gestion.nombre+"- Gestión "+G.configuracionImpresion.gestion_fin.nombre);if(G.configuracionImpresion.bimonetario){e="Expresado en Bolivianos y Dólares";var c=["GRUPO","SUB GRUPO","GENERICO","APROPIACION","","BOLIVIANOS","","DOLARES"]}else{c=["GRUPO","SUB GRUPO","GENERICO","APROPIACION","","BOLIVIANOS"];e="Expresado en Bolivianos"}return[["","","","BALANCE GENERAL"],["","","",o],["","","",e],c]},G.generarExelApropiacion=function(o,e,n,a,r,t){for(var i=G.dibujarCabeceraExelBalanceGeneral(),c=0;c<a.length;c++){var u=[];if(cuenta=a[c],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){u.push(""),u.push(cuenta.nombre),i.push(u);for(var s=0;s<r.length;s++){u=[],cuenta3=r[s];var m=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==m&&t.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e})){u.push(""),u.push(""),u.push(cuenta3.nombre),i.push(u);for(var d=0;d<t.length;d++){u=[],cuenta2=t[d];m=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==m){u.push(""),u.push(""),u.push(""),u.push(cuenta2.nombre),u.push(""),u.push(number_format(cuenta2.saldo,2));var g=cuenta2.saldo/G.moneda.dolar;G.configuracionImpresion.bimonetario&&u.push(""),u.push(number_format(g,2)),cuenta.total+=cuenta2.saldo,cuenta2.saldo,i.push(u)}}}}u=[],a.length}else a.length}G.configuracionImpresion.usar_firma_uno,G.configuracionImpresion.usar_firma_dos;var f="SheetJS",p=new Workbook,l=sheet_from_array_of_arrays(i);p.SheetNames.push(f),p.Sheets[f]=l;var b=XLSX.write(p,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(b)],{type:"application/octet-stream"}),"REPORTE-BALANCE-GENERAL.xlsx"),_.stop()},G.descargarArchivo=function(o,a){var e=new FileReader;e.onload=function(o){var e=document.createElement("a");e.href=o.target.result,e.target="_blank",e.download=a||"archivo.dat";var n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(n),(window.URL||window.webkitURL).revokeObjectURL(e.href)},e.readAsDataURL(o)},G.dibujarCabeceraWordBalanceGeneral=function(){var o="",e="";if("GES"==G.configuracionImpresion.tipoPeriodo.nombre_corto){var n=(new Date).getFullYear(),a=(new Date).getMonth(),r=new Date(n,a-1,0).getDate();o=G.configuracionImpresion.gestion.nombre<n?"Al 31 de Diciembre de "+G.configuracionImpresion.gestion.nombre:"Al "+r+" de "+G.meses[a].nombre+" de "+G.configuracionImpresion.gestion.nombre}else if("MES"==G.configuracionImpresion.tipoPeriodo.nombre_corto)o=G.configuracionImpresion.mes.nombre+" de "+G.configuracionImpresion.gestion.nombre;else if("FECHAS"==G.configuracionImpresion.tipoPeriodo.nombre_corto){var t=new Date(G.convertirFecha(G.configuracionImpresion.fecha_inicio)),i=new Date(G.convertirFecha(G.configuracionImpresion.fecha_fin));o="Desde el "+t.getDate()+" de "+G.meses[t.getMonth()].nombre+" "+t.getFullYear()+" al "+i.getDate()+" de "+G.meses[i.getMonth()].nombre+" de "+i.getFullYear()}else"COMP"==G.configuracionImpresion.tipoPeriodo.nombre_corto&&(o="Gestión "+G.configuracionImpresion.gestion.nombre+"- Gestión "+G.configuracionImpresion.gestion_fin.nombre);if(G.configuracionImpresion.bimonetario){e="Expresado en Bolivianos y Dólares"}else{e="Expresado en Bolivianos"}return"\t\t\t\t\tBALANCE GENERAL\r\n\t\t\t\t\t"+o+"\r\n\t\t\t\t"+e+"\r\n"},G.generarWordApropiacion=function(o,e,n,a,r,t){var i=G.dibujarCabeceraWordBalanceGeneral(),c=[];c.push(i);G.dibujarCabeceraExelBalanceGeneral();for(var u=a.length+r.length+t.length,s=0,m=(G.configuracionImpresion.usar_empesar_numeracion&&G.configuracionImpresion.empesar_numeracion,G.configuracionImpresion.usar_empesar_numeracion?(G.configuracionImpresion.empesar_numeracion,Math.ceil(u/51)):Math.ceil(u/51),0);m<a.length&&s<=51;m++)if(cuenta=a[m],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){51==s&&(s=0,1,c.push(i)),c.push(cuenta.nombre+"\r\n"),s++;for(var d=0;d<r.length&&s<=51;d++){cuenta3=r[d];var g=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==g&&t.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e})){c.push("\t"),c.push(cuenta3.nombre+"\r\n"),51==++s&&(s=0,1,c.push(i));for(var f=0;f<t.length&&s<=51;f++){cuenta2=t[f];g=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==g){c.push("\t\t"),22<cuenta2.nombre.length?(text1=String(cuenta2.nombre).substr(0,22),text2=String(cuenta2.nombre).substr(22),c.push(text1),c.push("\n\r\t\t"),s++,c.push(text2)):c.push(cuenta2.nombre),c.push("\t"),c.push(number_format(cuenta2.saldo,2));var p=cuenta2.saldo/G.moneda.dolar;G.configuracionImpresion.bimonetario&&c.push("\t\t"+number_format(p,2)),cuenta.total+=cuenta2.saldo,cuenta2.saldo,c.push("\r\n"),51==++s&&(s=0,1,c.push(i))}}}}c.push("\t"),c.push("TOTAL "+cuenta.nombre),c.push("\t\t\t\t"),c.push(number_format(cuenta.total,2));var l=cuenta.total/G.moneda.dolar;G.configuracionImpresion.bimonetario&&c.push("\t\t\t\t"),c.push(number_format(l,2)),a.length}else a.length;return G.configuracionImpresion.usar_firma_uno,G.configuracionImpresion.usar_firma_dos,_.stop(),new Blob(c,{type:"text/plain"})},G.$on("$routeChangeStart",function(o,e){}),G.inicio()});