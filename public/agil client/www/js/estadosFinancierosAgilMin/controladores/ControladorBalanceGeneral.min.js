angular.module("agil.controladores").controller("ControladorBalanceGeneral",function(O,e,o,n,a,_,r,t,i,c,u){O.usuario=JSON.parse(e.usuario),O.inicio=function(){O.obtenerTiposPeriodos(),O.obtenerGestiones(),O.obtenerTiposCuenta(),O.obtenerConfiguracionImpresion(),O.obtenerGestionesImpresion()},O.$on("$viewContentLoaded",function(){resaltarPesta√±a(o.path().substring(1)),O.buscarAplicacion(O.usuario.aplicacionesUsuario,o.path().substring(1)),_.stop()}),O.obtenerTiposPeriodos=function(){_.start(),t("EEFF_TP").then(function(e){O.TiposPeriodos=e,_.stop()})},O.obtenerGestiones=function(){_.start(),t("GTN").then(function(e){O.gestiones=e.clases,_.stop()})},O.obtenerConfiguracionImpresion=function(){i(O.usuario.id_empresa).then(function(e){O.configuracionImpresion=e,O.configuracionImpresion.bimonetario=!0,O.configuracionImpresion.tioPeriodo="",O.configuracionImpresion.gestion="",O.configuracionImpresion.gestion_fin="",O.configuracionImpresion.mes="",O.configuracionImpresion.fecha_inicio=null,O.configuracionImpresion.fecha_fin=null,_.stop()})},O.cargarFechasFiltro=function(e){"FECHAS"==e&&setTimeout(function(){aplicarDatePickers()},300)},O.obtenerTiposCuenta=function(){_.start(),t("TCC").then(function(e){O.cuentaTipos=[{id:0,nombre:"PREESTABLECIDO"}],O.cuentaTipos=O.cuentaTipos.concat(e.clases),_.stop()})},O.obtenerGestionesImpresion=function(){_.start(),O.gestionesEF=[],u(O.usuario.id_empresa).then(function(e){_.stop(),e.forEach(function(e){e.habilitado&&(O.fechasImpresion=e)})})},O.generarPdfBalanceGeneral=function(){_.start(),O.configuracionImpresion.fecha_inicio&&(O.configuracionImpresion.inicio2=new Date(O.convertirFecha(O.configuracionImpresion.fecha_inicio)),O.configuracionImpresion.fin2=new Date(O.convertirFecha(O.configuracionImpresion.fecha_fin))),O.configuracionImpresion.fechasImpresion=O.fechasImpresion,c(O.configuracionImpresion,O.usuario.id_empresa).then(function(r){r.monedaCambio?O.moneda=r.monedaCambio:O.moneda={ufv:"--",dolar:"--"},r.arregloActivos=[],r.arregloActivosFijos=[],r.arregloPasivos=[],r.arregloPatrimonio=[],r.arregloIngreso=[],r.arregloEgreso=[],r.arregleCostos=[];if("COMPARATIVO"!=O.configuracionImpresion.tipoPeriodo.nombre){r.arregloPasivos=r.arregloPasivos.concat(r.arregloPatrimonio);var e=O.configuracionImpresion.bimonetario?400:530;"PREESTABLECIDO"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarPdfPreestablecido(r,e,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion):"GENERICA"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarPdfPreestablecido(r,e,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion):"GRUPO"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarPdfGrupo(r,e,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion):"SUB GRUPO"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarPdfsubGrupo(r,e,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion):"APROPIACION"==O.configuracionImpresion.tipo_cuenta.nombre&&O.generarPdfApropiacion(r,e,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion)}else{var t=[],i=[],c=[],u=[],s=[],m=[],f=[];r.primero.cuentasGrupo.forEach(function(e,o,n){var a={};a.primerAno=e,t.push(a),o===n.length-1&&r.segundo.cuentasGrupo.forEach(function(e,o,n){for(var a=0;a<t.length;a++){var r=t[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasSubGrupo.forEach(function(e,o,n){var a={};a.primerAno=e,i.push(a),o===n.length-1&&r.segundo.cuentasSubGrupo.forEach(function(e,o,n){for(var a=0;a<i.length;a++){var r=i[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasGenericas.forEach(function(e,o,n){var a={};a.primerAno=e,c.push(a),o===n.length-1&&r.segundo.cuentasGenericas.forEach(function(e,o,n){for(var a=0;a<c.length;a++){var r=c[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasApropiacion.forEach(function(e,o,n){var a={};a.primerAno=e,u.push(a),o===n.length-1&&r.segundo.cuentasApropiacion.forEach(function(e,o,n){for(var a=0;a<u.length;a++){var r=u[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasSubGrupoFijo.forEach(function(e,o,n){var a={};a.primerAno=e,s.push(a),o===n.length-1&&r.segundo.cuentasSubGrupoFijo.forEach(function(e,o,n){for(var a=0;a<s.length;a++){var r=s[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasGenericasFijo.forEach(function(e,o,n){var a={};a.primerAno=e,m.push(a),o===n.length-1&&r.segundo.cuentasGenericasFijo.forEach(function(e,o,n){for(var a=0;a<m.length;a++){var r=m[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasApropiacionFijo.forEach(function(e,o,n){var a={};a.primerAno=e,f.push(a),o===n.length-1&&r.segundo.cuentasApropiacionFijo.forEach(function(e,o,n){for(var a=0;a<f.length;a++){var r=f[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})});e=O.configuracionImpresion.bimonetario?290:310;"PREESTABLECIDO"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarPdfComprobantePreestablecido(r,e,t,i,c,u,s,m,f):"GENERICA"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarPdfComprobantePreestablecido(r,e,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,f):"GRUPO"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarPdfComparativoGrupo(r,e,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,f):"SUB GRUPO"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarPdfComparativosubGrupo(r,e,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,f):"APROPIACION"==O.configuracionImpresion.tipo_cuenta.nombre&&O.generarPdfComparativoApropiacion(r,e,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,f),_.stop()}})},O.generarExelBalanceGeneral=function(){_.start(),O.configuracionImpresion.fecha_inicio&&(O.configuracionImpresion.inicio2=new Date(O.convertirFecha(O.configuracionImpresion.fecha_inicio)),O.configuracionImpresion.fin2=new Date(O.convertirFecha(O.configuracionImpresion.fecha_fin))),O.configuracionImpresion.fechasImpresion=O.fechasImpresion,c(O.configuracionImpresion,O.usuario.id_empresa).then(function(r){r.monedaCambio?O.moneda=r.monedaCambio:O.moneda={ufv:"--",dolar:"--"},r.arregloActivos=[],r.arregloActivosFijos=[],r.arregloPasivos=[],r.arregloPatrimonio=[],r.arregloIngreso=[],r.arregloEgreso=[],r.arregleCostos=[];if("COMPARATIVO"!=O.configuracionImpresion.tipoPeriodo.nombre){r.arregloPasivos=r.arregloPasivos.concat(r.arregloPatrimonio);var e=O.configuracionImpresion.bimonetario?400:530;"PREESTABLECIDO"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarExelAPreestablecido(r,e,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion):"GENERICA"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarExelAPreestablecido(r,e,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion):"GRUPO"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarExelGrupo(r,e,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion):"SUB GRUPO"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarExelSubGrupo(r,e,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion):"APROPIACION"==O.configuracionImpresion.tipo_cuenta.nombre&&O.generarExelApropiacion(r,e,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion)}else{var t=[],i=[],c=[],u=[],s=[],m=[],f=[];r.primero.cuentasGrupo.forEach(function(e,o,n){var a={};a.primerAno=e,t.push(a),o===n.length-1&&r.segundo.cuentasGrupo.forEach(function(e,o,n){for(var a=0;a<t.length;a++){var r=t[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasSubGrupo.forEach(function(e,o,n){var a={};a.primerAno=e,i.push(a),o===n.length-1&&r.segundo.cuentasSubGrupo.forEach(function(e,o,n){for(var a=0;a<i.length;a++){var r=i[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasGenericas.forEach(function(e,o,n){var a={};a.primerAno=e,c.push(a),o===n.length-1&&r.segundo.cuentasGenericas.forEach(function(e,o,n){for(var a=0;a<c.length;a++){var r=c[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasApropiacion.forEach(function(e,o,n){var a={};a.primerAno=e,u.push(a),o===n.length-1&&r.segundo.cuentasApropiacion.forEach(function(e,o,n){for(var a=0;a<u.length;a++){var r=u[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasSubGrupoFijo.forEach(function(e,o,n){var a={};a.primerAno=e,s.push(a),o===n.length-1&&r.segundo.cuentasSubGrupoFijo.forEach(function(e,o,n){for(var a=0;a<s.length;a++){var r=s[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasGenericasFijo.forEach(function(e,o,n){var a={};a.primerAno=e,m.push(a),o===n.length-1&&r.segundo.cuentasGenericasFijo.forEach(function(e,o,n){for(var a=0;a<m.length;a++){var r=m[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasApropiacionFijo.forEach(function(e,o,n){var a={};a.primerAno=e,f.push(a),o===n.length-1&&r.segundo.cuentasApropiacionFijo.forEach(function(e,o,n){for(var a=0;a<f.length;a++){var r=f[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})});e=O.configuracionImpresion.bimonetario?290:310;"PREESTABLECIDO"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarExelComprobantePreestablecido(r,e,t,i,c,u,s,m,f):"GENERICA"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarExelComprobantePreestablecido(r,e,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,f):"GRUPO"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarExelComparativoGrupo(r,e,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,f):"SUB GRUPO"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarExelComparativosubGrupo(r,e,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,f):"APROPIACION"==O.configuracionImpresion.tipo_cuenta.nombre&&O.generarExelComparativoApropiacion(r,e,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,f),_.stop()}})},O.generarWordBalanceGeneral=function(){_.start(),O.configuracionImpresion.fecha_inicio&&(O.configuracionImpresion.inicio2=new Date(O.convertirFecha(O.configuracionImpresion.fecha_inicio)),O.configuracionImpresion.fin2=new Date(O.convertirFecha(O.configuracionImpresion.fecha_fin))),O.configuracionImpresion.fechasImpresion=O.fechasImpresion,c(O.configuracionImpresion,O.usuario.id_empresa).then(function(r){if(r.monedaCambio?O.moneda=r.monedaCambio:O.moneda={ufv:"--",dolar:"--"},"COMPARATIVO"!=O.configuracionImpresion.tipoPeriodo.nombre){var e=O.configuracionImpresion.bimonetario?400:530;"PREESTABLECIDO"==O.configuracionImpresion.tipo_cuenta.nombre?O.descargarArchivo(O.generarWordPreestablecido(r,e,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion),"reporte-balance-general.doc"):"GENERICA"==O.configuracionImpresion.tipo_cuenta.nombre?O.descargarArchivo(O.generarWordPreestablecido(r,e,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion),"reporte-balance-general.doc"):"GRUPO"==O.configuracionImpresion.tipo_cuenta.nombre?O.descargarArchivo(O.generarWordGrupo(r,e,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion),"reporte-balance-general.doc"):"SUB GRUPO"==O.configuracionImpresion.tipo_cuenta.nombre?O.descargarArchivo(O.generarWordSubGrupo(r,e,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion),"reporte-balance-general.doc"):"APROPIACION"==O.configuracionImpresion.tipo_cuenta.nombre&&O.descargarArchivo(O.generarWordApropiacion(r,e,r.cuentasGrupo,r.cuentasSubGrupo,r.cuentasGenericas,r.cuentasApropiacion),"reporte-balance-general.doc")}else{var t=[],i=[],c=[],u=[],s=[],m=[],f=[];r.primero.cuentasGrupo.forEach(function(e,o,n){var a={};a.primerAno=e,t.push(a),o===n.length-1&&r.segundo.cuentasGrupo.forEach(function(e,o,n){for(var a=0;a<t.length;a++){var r=t[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasSubGrupo.forEach(function(e,o,n){var a={};a.primerAno=e,i.push(a),o===n.length-1&&r.segundo.cuentasSubGrupo.forEach(function(e,o,n){for(var a=0;a<i.length;a++){var r=i[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasGenericas.forEach(function(e,o,n){var a={};a.primerAno=e,c.push(a),o===n.length-1&&r.segundo.cuentasGenericas.forEach(function(e,o,n){for(var a=0;a<c.length;a++){var r=c[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasApropiacion.forEach(function(e,o,n){var a={};a.primerAno=e,u.push(a),o===n.length-1&&r.segundo.cuentasApropiacion.forEach(function(e,o,n){for(var a=0;a<u.length;a++){var r=u[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasSubGrupoFijo.forEach(function(e,o,n){var a={};a.primerAno=e,s.push(a),o===n.length-1&&r.segundo.cuentasSubGrupoFijo.forEach(function(e,o,n){for(var a=0;a<s.length;a++){var r=s[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasGenericasFijo.forEach(function(e,o,n){var a={};a.primerAno=e,m.push(a),o===n.length-1&&r.segundo.cuentasGenericasFijo.forEach(function(e,o,n){for(var a=0;a<m.length;a++){var r=m[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),r.primero.cuentasApropiacionFijo.forEach(function(e,o,n){var a={};a.primerAno=e,f.push(a),o===n.length-1&&r.segundo.cuentasApropiacionFijo.forEach(function(e,o,n){for(var a=0;a<f.length;a++){var r=f[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})});e=O.configuracionImpresion.bimonetario?290:310;"PREESTABLECIDO"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarWordComprobantePreestablecido(r,e,t,i,c,u,s,m,f):"GENERICA"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarWordComprobantePreestablecido(r,e,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,f):"GRUPO"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarWordComparativoGrupo(r,e,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,f):"SUB GRUPO"==O.configuracionImpresion.tipo_cuenta.nombre?O.generarWordComparativosubGrupo(r,e,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,f):"APROPIACION"==O.configuracionImpresion.tipo_cuenta.nombre&&O.generarWordComparativoApropiacion(r,e,t,i,c,cuentasApropiacioncuentasSubGrupoFijo,m,f),_.stop()}})},O.generarPdfApropiacion=function(e,o,n,a,r,t){var i=new PDFDocument({size:"letter",margin:10}),c=i.pipe(blobStream()),u=a.length+r.length+t.length,s=130,m=0,f=O.configuracionImpresion.usar_empesar_numeracion?O.configuracionImpresion.empesar_numeracion:1,g=O.configuracionImpresion.usar_empesar_numeracion?O.configuracionImpresion.empesar_numeracion-1+Math.ceil(u/28):Math.ceil(u/28),l=0;O.dibujarCabeceraPDFBalanceGeneral(i,f,g,"ACTIVO"),i.font("Helvetica",8);for(var p=0;p<a.length&&m<=28;p++)if(cuenta=a[p],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){28==m&&(i.addPage({margin:0,bufferPages:!0}),s=140,m=0,f+=1,O.dibujarCabeceraPDFBalanceGeneral(i,f,g,"ACTIVO"),i.font("Helvetica",8)),i.text(cuenta.nombre,30,s),s+=20,m++;for(var d=0;d<r.length&&m<=28;d++){cuenta3=r[d];var b=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==b){if(t.some(function(e){var o=String(e.codigo).substr(0,5);return cuenta3.codigo==o})){i.text(cuenta3.nombre,40,s),s+=20,m++;for(var A=0;A<t.length&&m<=28;A++){cuenta2=t[A];b=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==b){i.text(cuenta2.nombre,60,s),i.text(number_format(cuenta2.saldo,2),o,s);var v=cuenta2.saldo/O.moneda.dolar;O.configuracionImpresion.bimonetario&&i.text(number_format(v,2),o+130,s),cuenta.total+=cuenta2.saldo,l+=cuenta2.saldo,s+=20,28==++m&&(i.addPage({margin:0,bufferPages:!0}),s=140,m=0,f+=1,O.dibujarCabeceraPDFBalanceGeneral(i,f,g,"ACTIVO"),i.font("Helvetica",8))}else 28==m&&(i.addPage({margin:0,bufferPages:!0}),s=140,m=0,f+=1,O.dibujarCabeceraPDFBalanceGeneral(i,f,g,"ACTIVO"),i.font("Helvetica",8))}}}else 28==m&&(i.addPage({margin:0,bufferPages:!0}),s=140,m=0,f+=1,O.dibujarCabeceraPDFBalanceGeneral(i,f,g,"ACTIVO"),i.font("Helvetica",8))}i.text("TOTAL "+cuenta.nombre,90,s),i.text(number_format(cuenta.total,2),o,s);var P=cuenta.total/O.moneda.dolar;O.configuracionImpresion.bimonetario&&i.text(number_format(P,2),o+130,s),s+=20,m++,p===a.length-1&&O.DibujarFijoApropiacion(e,l,i,s,m,f,g,28,o)}else p===a.length-1&&O.DibujarFijoApropiacion(e,l,i,s,m,f,g,28,o);O.configuracionImpresion.usar_firma_uno&&(i.text(O.configuracionImpresion.firma_uno,170,720),i.text(O.configuracionImpresion.cargo_uno,170,730)),O.configuracionImpresion.usar_firma_dos&&(i.text(O.configuracionImpresion.firma_dos,370,720),i.text(O.configuracionImpresion.cargo_dos,370,730)),i.end(),c.on("finish",function(){var e=c.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),_.stop()},O.DibujarFijoApropiacion=function(e,o,n,a,r,t,i,c,u){if("COMPARATIVO"!=O.configuracionImpresion.tipoPeriodo.nombre){n.font("Helvetica",8);for(var s=0;s<e.cuentasSubGrupoFijo.length&&r<=c;s++)if(cuenta=e.cuentasSubGrupoFijo[s],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8)),n.text(cuenta.nombre,30,a),a+=20,r++;for(var m=0;m<e.cuentasGenericasFijo.length&&r<=c;m++)if(cuenta3=e.cuentasGenericasFijo[m],"3"===cuenta3.tipoCuenta.nombre_corto){var f=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==f){if(e.cuentasApropiacionFijo.some(function(e){var o=String(e.codigo).substr(0,5);return cuenta3.codigo==o})){n.text(cuenta3.nombre,40,a),a+=20,r++;for(var g=0;g<e.cuentasApropiacionFijo.length&&r<=c;g++)if(cuenta2=e.cuentasApropiacionFijo[g],"4"===cuenta2.tipoCuenta.nombre_corto){f=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==f){n.text(cuenta2.nombre,60,a),n.text(number_format(cuenta2.saldo,2),u-80,a);var l=cuenta2.saldo/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text(number_format(l,2),u+65,a),a+=20,r++;for(var p=0;p<e.cuentasApropiacionFijo.length&&r<=c;p++)if(cuenta5=e.cuentasApropiacionFijo[p],"4"===cuenta5.tipoCuenta.nombre_corto){f=String(cuenta5.codigo).substr(4);if(String(cuenta2.codigo).substr(4)==f&&"Pasivo"===cuenta5.clasificacion.nombre){n.text(cuenta5.nombre,60,a),n.text("("+number_format(cuenta5.saldo,2)+")",u-80,a);var d=cuenta2.saldo-cuenta5.saldo;n.text(number_format(d,2),u,a);l=cuenta5.saldo/O.moneda.dolar;var b=d/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text(number_format(l,2),u+65,a),O.configuracionImpresion.bimonetario&&n.text(number_format(b,2),u+130,a),cuenta.total+=d,o+=d,a+=20,++r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8));r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8));n.text("TOTAL "+cuenta.nombre,90,a),n.text(number_format(cuenta.total,2),u,a);var A=cuenta.total/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text(number_format(A,2),u+130,a),a+=20,r++,s===e.cuentasSubGrupoFijo.length-1&&O.dibujarPatrimonio(e,o,n,a,r,t,i,c,u)}else s===e.cuentasSubGrupoFijo.length-1&&O.dibujarPatrimonio(e,o,n,a,r,t,i,c,u)}},O.DibujarFijoPreestablecido=function(e,o,n,a,r,t,i,c,u){n.font("Helvetica",8);for(var s=0;s<e.cuentasSubGrupoFijo.length&&r<=c;s++)if(cuenta=e.cuentasSubGrupoFijo[s],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8)),n.text(cuenta.nombre,30,a),a+=20,r++;for(var m=0;m<e.cuentasGenericasFijo.length&&r<=c;m++)if(cuenta3=e.cuentasGenericasFijo[m],cuenta3.total=0,"3"===cuenta3.tipoCuenta.nombre_corto){var f=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==f){if(e.cuentasApropiacionFijo.some(function(e){var o=String(e.codigo).substr(0,5);return cuenta3.codigo==o})){n.text(cuenta3.nombre,40,a),a+=20,r++;for(var g=0;g<e.cuentasGenericasFijo.length&&r<=c;g++){cuenta6=e.cuentasGenericasFijo[g],cuenta6.total=0;f=String(cuenta6.codigo).substr(3);if(String(cuenta3.codigo).substr(3)==f&&"Pasivo"===cuenta6.clasificacion.nombre&&(n.text(cuenta6.nombre,40,a),a+=20,r++),g==e.cuentasGenericasFijo.length-1){for(var l=0;l<e.cuentasApropiacionFijo.length&&r<=c;l++)if(cuenta2=e.cuentasApropiacionFijo[l],"4"===cuenta2.tipoCuenta.nombre_corto){f=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==f){cuenta3.total+=cuenta2.saldo;for(var p=cuenta2.saldo/O.moneda.dolar,d=0;d<e.cuentasApropiacionFijo.length&&r<=c;d++)if(cuenta5=e.cuentasApropiacionFijo[d],"4"===cuenta5.tipoCuenta.nombre_corto){f=String(cuenta5.codigo).substr(4);if(String(cuenta2.codigo).substr(4)==f&&"Pasivo"===cuenta5.clasificacion.nombre){cuenta6.total+=cuenta5.saldo;var b=cuenta2.saldo-cuenta5.saldo;p=cuenta5.saldo/O.moneda.dolar,O.moneda.dolar;cuenta.total+=b,o+=b,r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8));r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8));n.text(number_format(cuenta3.total,2),u-80,a-40);p=cuenta3.total/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text(number_format(p,2),u+65,a-40),n.text("("+number_format(cuenta6.total,2)+")",u-80,a-20);p=cuenta6.total/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text("("+number_format(p,2)+")",u+65,a-20);var A=cuenta3.total-cuenta6.total,v=A/O.moneda.dolar;n.text(number_format(A,2),u,a-20),O.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a-20)}}}}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8));n.text("TOTAL "+cuenta.nombre,90,a),n.text(number_format(cuenta.total,2),u,a);var P=cuenta.total/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text(number_format(P,2),u+130,a),a+=20,r++,s===e.cuentasSubGrupoFijo.length-1&&O.dibujarPatrimonioPredefinido(e,o,n,a,r,t,i,c,u)}else s===e.cuentasSubGrupoFijo.length-1&&O.dibujarPatrimonioPredefinido(e,o,n,a,r,t,i,c,u)},O.DibujarFijoComparativoPreestablecido=function(e,o,n,a,r,t,i,c,u,s,m,f,g,l,p,d){n.font("Helvetica",8);for(var b=0;b<l.length&&r<=c;b++)if(cuenta=l[b],cuenta.primerAno.total=0,cuenta.segundoAno.total=0,"Activo"===cuenta.primerAno.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8)),n.text(cuenta.primerAno.nombre,30,a),a+=20,r++;for(var A=0;A<p.length&&r<=c;A++){cuenta3=p[A],cuenta3.primerAno.total=0,cuenta3.segundoAno.total=0;var v=String(cuenta3.primerAno.codigo).substr(0,3);if(cuenta.primerAno.codigo==v){if(d.some(function(e){var o=String(e.primerAno.codigo).substr(0,5);return cuenta3.primerAno.codigo==o})){n.text(cuenta3.primerAno.nombre,40,a),a+=20,r++;for(var P=0;P<p.length&&r<=c;P++){cuenta6=p[P],cuenta6.primerAno.total=0,cuenta6.segundoAno.total=0;v=String(cuenta6.primerAno.codigo).substr(3);if(String(cuenta3.primerAno.codigo).substr(3)==v&&"Pasivo"===cuenta6.primerAno.clasificacion.nombre&&(n.text(cuenta6.primerAno.nombre,40,a),a+=20,r++),P==p.length-1){for(var I=0;I<d.length&&r<=c;I++)if(cuenta2=d[I],"4"===cuenta2.primerAno.tipoCuenta.nombre_corto){v=String(cuenta2.primerAno.codigo).substr(0,5);if(cuenta3.primerAno.codigo==v){cuenta3.primerAno.total+=cuenta2.primerAno.saldo,cuenta3.segundoAno.total+=cuenta2.segundoAno.saldo;for(var h=0;h<d.length&&r<=c;h++)if(cuenta5=d[h],"4"===cuenta5.primerAno.tipoCuenta.nombre_corto){v=String(cuenta5.primerAno.codigo).substr(4);if(String(cuenta2.primerAno.codigo).substr(4)==v&&"Pasivo"===cuenta5.primerAno.clasificacion.nombre){cuenta6.primerAno.total+=cuenta5.primerAno.saldo,cuenta6.segundoAno.total+=cuenta5.segundoAno.saldo;var _=cuenta2.primerAno.saldo-cuenta5.primerAno.saldo,G=cuenta2.segundoAno.saldo-cuenta5.segundoAno.saldo;cuenta.primerAno.total+=_,o.totalActivosPrimerAnio+=_,cuenta.segundoAno.total+=G,o.totalActivosSegundoAnio+=G,r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8));r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8));n.text(cuenta3.primerAno.total.toFixed(2),u-80,a-40),n.text(cuenta3.segundoAno.total.toFixed(2),u+130,a-40);cuenta3.primerAno.total,O.moneda.dolar;n.text("("+cuenta6.primerAno.total.toFixed(2)+")",u-80,a-20),n.text("("+cuenta6.segundoAno.total.toFixed(2)+")",u+130,a-20);cuenta6.primerAno.total,O.moneda.dolar;var S=(x=cuenta3.primerAno.total-cuenta6.primerAno.total)/O.moneda.dolar;n.text(number_format(x,2),u,a-20),O.configuracionImpresion.bimonetario&&n.text(number_format(S,2),u+80,a-20);var x;S=(x=cuenta3.segundoAno.total-cuenta6.segundoAno.total)/O.moneda.dolar;n.text(number_format(x,2),u+180,a-20),O.configuracionImpresion.bimonetario&&n.text(number_format(S,2),u+260,a-20)}}}}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}n.text("TOTAL "+cuenta.primerAno.nombre,90,a),n.text(number_format(cuenta.primerAno.total,2),u,a);var C=cuenta.primerAno.total/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text(number_format(C,2),u+80,a),n.text(number_format(cuenta.segundoAno.total,2),u+180,a);C=cuenta.segundoAno.total/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text(number_format(C,2),u+260,a),a+=20,r++,b===l.length-1&&O.dibujarPatrimonioComparativoPredefinido(e,o,n,a,r,t,i,c,u,s,m,f,g)}else b===l.length-1&&O.dibujarPatrimonioComparativoPredefinido(e,o,n,a,r,t,i,c,u,s,m,f,g)},O.DibujarFijoSubGrupo=function(e,o,n,a,r,t,i,c,u){if("COMPARATIVO"!=O.configuracionImpresion.tipoPeriodo.nombre){n.font("Helvetica",8);for(var s=0;s<e.cuentasSubGrupoFijo.length&&r<=c;s++)if(cuenta=e.cuentasSubGrupoFijo[s],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8)),n.text(cuenta.nombre,30,a),a+=20,r++;for(var m=0;m<e.cuentasGenericasFijo.length&&r<=c;m++){cuenta3=e.cuentasGenericasFijo[m],cuenta3.total=0;var f=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==f){if(e.cuentasApropiacionFijo.some(function(e){var o=String(e.codigo).substr(0,5);return cuenta3.codigo==o}))for(var g=0;g<e.cuentasGenericasFijo.length&&r<=c;g++){cuenta6=e.cuentasGenericasFijo[g],cuenta6.total=0;f=String(cuenta6.codigo).substr(3),String(cuenta3.codigo).substr(3);if(g==e.cuentasGenericasFijo.length-1)for(var l=0;l<e.cuentasApropiacionFijo.length&&r<=c;l++){cuenta2=e.cuentasApropiacionFijo[l];f=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==f){cuenta3.total+=cuenta2.saldo;for(var p=0;p<e.cuentasApropiacionFijo.length&&r<=c;p++){cuenta5=e.cuentasApropiacionFijo[p];f=String(cuenta5.codigo).substr(4);if(String(cuenta2.codigo).substr(4)==f&&"Pasivo"===cuenta5.clasificacion.nombre){cuenta6.total+=cuenta5.saldo;var d=cuenta2.saldo-cuenta5.saldo;cuenta.total+=d,o+=d}}}}}}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8))}n.text("TOTAL "+cuenta.nombre,90,a),n.text(number_format(cuenta.total,2),u,a);var b=cuenta.total/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text(number_format(b,2),u+130,a),a+=20,r++,s===e.cuentasSubGrupoFijo.length-1&&O.dibujarPatrimonioSubGrupo(e,o,n,a,r,t,i,c,u)}else s===e.cuentasSubGrupoFijo.length-1&&O.dibujarPatrimonioSubGrupo(e,o,n,a,r,t,i,c,u)}},O.DibujarFijoGrupo=function(e,o,n,a,r,t,i,c,u){if("COMPARATIVO"!=O.configuracionImpresion.tipoPeriodo.nombre){n.font("Helvetica",8);for(var s=0;s<e.cuentasSubGrupoFijo.length&&r<=c;s++)if(cuenta=e.cuentasSubGrupoFijo[s],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8));for(var m=0;m<e.cuentasGenericasFijo.length&&r<=c;m++){cuenta3=e.cuentasGenericasFijo[m],cuenta3.total=0;var f=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==f&&e.cuentasApropiacionFijo.some(function(e){var o=String(e.codigo).substr(0,5);return cuenta3.codigo==o}))for(var g=0;g<e.cuentasGenericasFijo.length&&r<=c;g++){cuenta6=e.cuentasGenericasFijo[g],cuenta6.total=0;f=String(cuenta6.codigo).substr(3);if(String(cuenta3.codigo).substr(3)==f&&cuenta6.clasificacion.nombre,g==e.cuentasGenericasFijo.length-1)for(var l=0;l<e.cuentasApropiacionFijo.length&&r<=c;l++){cuenta2=e.cuentasApropiacionFijo[l];f=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==f){cuenta3.total+=cuenta2.saldo;cuenta2.saldo,O.moneda.dolar;for(var p=0;p<e.cuentasApropiacionFijo.length&&r<=c;p++){cuenta5=e.cuentasApropiacionFijo[p];f=String(cuenta5.codigo).substr(4);if(String(cuenta2.codigo).substr(4)==f&&"Pasivo"===cuenta5.clasificacion.nombre){cuenta6.total+=cuenta5.saldo;var d=cuenta2.saldo-cuenta5.saldo;cuenta.total+=d,o+=d}}}}}}n.text("TOTAL "+cuenta.nombre,90,a),n.text(number_format(cuenta.total,2),u,a);var b=cuenta.total/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text(number_format(b,2),u+130,a),a+=20,r++,s===e.cuentasSubGrupoFijo.length-1&&O.dibujarPatrimonioGrupo(e,o,n,a,r,t,i,c,u)}else s===e.cuentasSubGrupoFijo.length-1&&O.dibujarPatrimonioGrupo(e,o,n,a,r,t,i,c,u)}},O.dibujarPatrimonio=function(e,o,n,a,r,t,i,c,u){if("COMPARATIVO"!=O.configuracionImpresion.tipoPeriodo.nombre){var s=0;n.font("Helvetica-Bold",8),n.text("TOTAL ACTIVOS  ",30,a),n.text(number_format(o,2),u,a);var m=o/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text(number_format(m,2),u+130,a),a+=20,n.text("PASIVO Y PATRIMONIO",0,a,{align:"center"}),a+=20;for(var f=0;f<e.cuentasSubGrupo.length&&r<=c;f++){var g=e.cuentasSubGrupo[f];if("Pasivo"===g.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8)),n.text(g.nombre,30,a),a+=20,r++;for(var l=g.total=0;l<e.cuentasGenericas.length&&r<=c;l++){var p=e.cuentasGenericas[l];if("3"===p.tipoCuenta.nombre_corto){var d=String(p.codigo).substr(0,3);if(g.codigo==d){if(e.cuentasApropiacion.some(function(e){var o=String(e.codigo).substr(0,5);return p.codigo==o})){n.text(p.nombre,40,a),a+=20,r++;for(var b=0;b<e.cuentasApropiacion.length&&r<=c;b++){var A=e.cuentasApropiacion[b];if("4"===A.tipoCuenta.nombre_corto){d=String(A.codigo).substr(0,5);if(p.codigo==d){n.text(A.nombre,60,a),n.text(number_format(A.saldo,2),u,a);var v=A.saldo/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a),g.total+=A.saldo,s+=A.saldo,a+=20,++r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}}}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}n.text("TOTAL "+g.nombre,90,a),n.text(number_format(g.total,2),u,a);v=Math.round(g.total/O.moneda.dolar*1e4)/1e4;O.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a),a+=20,r++}if(f===e.cuentasSubGrupo.length-1){n.font("Helvetica-Bold",8),n.text("TOTAL PASIVO:  ",30,a),n.text(number_format(s,2),u,a);v=Math.round(s/O.moneda.dolar*1e4)/1e4;O.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a)}}}},O.dibujarPatrimonioComparativoPredefinido=function(e,o,n,a,r,t,i,c,u,s,m,f,g){var l={totalPasivoPrimerAnio:0,totalPasivoSegundoAnio:0};n.font("Helvetica-Bold",8),n.text("TOTAL ACTIVOS  ",30,a),n.text(number_format(o.totalActivosPrimerAnio,2),u,a);var p=o.totalActivosPrimerAnio/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text(number_format(p,2),u+130,a),a+=20,r++,n.text("PASIVO Y PATRIMONIO",0,a,{align:"center"}),r++,a+=20;for(var d=0;d<m.length&&r<=c;d++){n.font("Helvetica",8);var b=m[d];if("Pasivo"===b.primerAno.clasificacion.nombre||"Capital"==b.primerAno.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8)),n.text(b.primerAno.nombre,30,a),b.primerAno.total=0,a+=20,r++;for(var A=b.segundoAno.total=0;A<f.length&&r<=c;A++){var v=f[A],P=String(v.primerAno.codigo).substr(0,3);if(b.primerAno.codigo==P){if(g.some(function(e){var o=String(e.primerAno.codigo).substr(0,5);return v.primerAno.codigo==o})){n.text(v.primerAno.nombre,40,a),v.primerAno.total=0,v.primerAno.totalSus=0,v.segundoAno.total=0;for(var I=v.segundoAno.totalSus=0;I<g.length&&r<=c;I++){var h=g[I];if("4"===h.primerAno.tipoCuenta.nombre_corto){P=String(h.primerAno.codigo).substr(0,5);v.primerAno.codigo==P&&(v.primerAno.total+=h.primerAno.saldo,v.primerAno.totalSus+=h.primerAno.saldo/O.moneda.dolar,b.primerAno.total+=h.primerAno.saldo,v.segundoAno.total+=h.segundoAno.saldo,v.segundoAno.totalSus+=h.segundoAno.saldo/O.moneda.dolar,b.segundoAno.total+=h.segundoAno.saldo,l.totalPasivoPrimerAnio+=h.primerAno.saldo,l.totalPasivoSegundoAnio+=h.segundoAno.saldo),r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}n.text(v.primerAno.total,u,a),O.configuracionImpresion.bimonetario&&n.text(number_format(v.primerAno.totalSus,2),u+80,a),n.text(v.segundoAno.total,u+180,a),O.configuracionImpresion.bimonetario&&n.text(number_format(v.segundoAno.totalSus,2),u+260,a),a+=20,r++}}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}n.text("TOTAL "+b.primerAno.nombre,90,a),n.text(number_format(b.primerAno.total,2),u,a),n.text(number_format(b.segundoAno.total,2),u+180,a);var _=Math.round(b.primerAno.total/O.moneda.dolar*1e4)/1e4;O.configuracionImpresion.bimonetario&&n.text(number_format(_,2),u+80,a);_=Math.round(b.segundoAno.total/O.moneda.dolar*1e4)/1e4;O.configuracionImpresion.bimonetario&&n.text(number_format(_,2),u+260,a),a+=20,r++}if(d===m.length-1){n.font("Helvetica-Bold",8),n.text("TOTAL PASIVO:  ",30,a),n.text(number_format(l.totalPasivoPrimerAnio,2),u,a);_=Math.round(l.totalPasivoPrimerAnio/O.moneda.dolar*1e4)/1e4;O.configuracionImpresion.bimonetario&&n.text(number_format(_,2),u+80,a),n.text(number_format(l.totalPasivoSegundoAnio,2),u+180,a);_=Math.round(l.totalPasivoSegundoAnio/O.moneda.dolar*1e4)/1e4;O.configuracionImpresion.bimonetario&&n.text(number_format(_,2),u+260,a)}}},O.dibujarPatrimonioPredefinido=function(e,o,n,a,r,t,i,c,u){var s=0;n.font("Helvetica-Bold",8),n.text("TOTAL ACTIVOS  ",30,a),n.text(number_format(o,2),u,a);var m=o/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text(number_format(m,2),u+130,a),a+=20,r++,n.text("PASIVO Y PATRIMONIO",0,a,{align:"center"}),a+=20,r++;for(var f=0;f<e.cuentasSubGrupo.length&&r<=c;f++){n.font("Helvetica",8);var g=e.cuentasSubGrupo[f];if("Pasivo"===g.clasificacion.nombre||"Capital"==g.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8)),n.text(g.nombre,30,a),a+=20,r++;for(var l=g.total=0;l<e.cuentasGenericas.length&&r<=c;l++){var p=e.cuentasGenericas[l];if("3"===p.tipoCuenta.nombre_corto){var d=String(p.codigo).substr(0,3);if(g.codigo==d){if(e.cuentasApropiacion.some(function(e){var o=String(e.codigo).substr(0,5);return p.codigo==o})){n.text(p.nombre,40,a),p.total=0;for(var b=p.totalSus=0;b<e.cuentasApropiacion.length&&r<=c;b++){var A=e.cuentasApropiacion[b];if("4"===A.tipoCuenta.nombre_corto){d=String(A.codigo).substr(0,5);p.codigo==d&&(p.total+=A.saldo,p.totalSus+=A.saldo/O.moneda.dolar,g.total+=A.saldo,s+=A.saldo),r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}n.text(p.total,u,a),O.configuracionImpresion.bimonetario&&n.text(number_format(p.totalSus,2),u+130,a),a+=20,r++}}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}else r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8))}n.text("TOTAL "+g.nombre,90,a),n.text(number_format(g.total,2),u,a);var v=Math.round(g.total/O.moneda.dolar*1e4)/1e4;O.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a),a+=20,r++}if(f===e.cuentasSubGrupo.length-1){n.font("Helvetica-Bold",8),n.text("TOTAL PASIVO:  ",30,a),n.text(number_format(s,2),u,a);v=Math.round(s/O.moneda.dolar*1e4)/1e4;O.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a)}}},O.dibujarPatrimonioSubGrupo=function(e,o,n,a,r,t,i,c,u){if("COMPARATIVO"!=O.configuracionImpresion.tipoPeriodo.nombre){var s=0;n.font("Helvetica-Bold",8),n.text("TOTAL ACTIVOS  ",30,a),n.text(number_format(o,2),u,a);var m=o/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text(number_format(m,2),u+130,a),a+=20,r++,n.text("PASIVO Y PATRIMONIO",0,a,{align:"center"}),a+=20,r++;for(var f=0;f<e.cuentasSubGrupo.length&&r<=c;f++){n.font("Helvetica",8);var g=e.cuentasSubGrupo[f];if("Pasivo"===g.clasificacion.nombre||"Capital"==g.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"PASIVO Y PATRIMONIO"),n.font("Helvetica",8)),n.text(g.nombre,30,a),g.total=0;for(var l=g.totalSus=0;l<e.cuentasGenericas.length&&r<=c;l++){var p=e.cuentasGenericas[l];if("3"===p.tipoCuenta.nombre_corto){var d=String(p.codigo).substr(0,3);if(g.codigo==d&&e.cuentasApropiacion.some(function(e){var o=String(e.codigo).substr(0,5);return p.codigo==o}))for(var b=0;b<e.cuentasApropiacion.length&&r<=c;b++){var A=e.cuentasApropiacion[b];if("4"===A.tipoCuenta.nombre_corto){d=String(A.codigo).substr(0,5);p.codigo==d&&(g.totalSus+=A.saldo/O.moneda.dolar,g.total+=A.saldo,s+=A.saldo)}}}}n.text(g.total,u,a),O.configuracionImpresion.bimonetario&&n.text(number_format(g.totalSus,2),u+130,a),a+=20,r++,n.text("TOTAL "+g.nombre,90,a),n.text(number_format(g.total,2),u,a);var v=Math.round(g.total/O.moneda.dolar*1e4)/1e4;O.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a),a+=20,r++}if(f===e.cuentasSubGrupo.length-1){n.font("Helvetica-Bold",8),n.text("TOTAL PASIVO:  ",30,a),n.text(number_format(s,2),u,a);v=Math.round(s/O.moneda.dolar*1e4)/1e4;O.configuracionImpresion.bimonetario&&n.text(number_format(v,2),u+130,a)}}}},O.dibujarPatrimonioGrupo=function(e,o,n,a,r,t,i,c,u){if("COMPARATIVO"!=O.configuracionImpresion.tipoPeriodo.nombre){var s=0;n.font("Helvetica-Bold",8),n.text("TOTAL ACTIVOS  ",30,a),n.text(number_format(o,2),u,a);var m=o/O.moneda.dolar;O.configuracionImpresion.bimonetario&&n.text(number_format(m,2),u+130,a),a+=20,r++,n.text("PASIVO Y PATRIMONIO",0,a,{align:"center"}),a+=20,r++;for(var f=0;f<e.cuentasGrupo.length&&r<=c;f++){if(cuenta=e.cuentasGrupo[f],cuenta.total=0,cuenta.totalSus=0,"Pasivo"===cuenta.clasificacion.nombre||"Capital"===cuenta.clasificacion.nombre){r==c&&(n.addPage({margin:0,bufferPages:!0}),a=140,r=0,t+=1,O.dibujarCabeceraPDFBalanceGeneral(n,t,i,"ACTIVO"),n.font("Helvetica",8)),n.text(cuenta.nombre,30,a);for(var g=0;g<e.cuentasSubGrupo.length&&r<=c;g++)if(cuenta4=e.cuentasSubGrupo[g],"2"===cuenta4.tipoCuenta.nombre_corto){var l=String(cuenta4.codigo).substr(0,1);if(cuenta.codigo==l)for(var p=0;p<e.cuentasGenericas.length&&r<=c;p++)if(cuenta3=e.cuentasGenericas[p],"3"===cuenta3.tipoCuenta.nombre_corto){l=String(cuenta3.codigo).substr(0,3);if(cuenta4.codigo==l&&e.cuentasApropiacion.some(function(e){var o=String(e.codigo).substr(0,5);return cuenta3.codigo==o}))for(var d=0;d<e.cuentasApropiacion.length&&r<=c;d++)if(cuenta2=e.cuentasApropiacion[d],"4"===cuenta2.tipoCuenta.nombre_corto){l=String(cuenta2.codigo).substr(0,5);cuenta3.codigo==l&&(cuenta.total+=cuenta2.saldo,cuenta.totalSus+=cuenta2.saldo,s+=cuenta2.saldo)}}}n.text(cuenta.total,u,a),O.configuracionImpresion.bimonetario&&n.text(number_format(cuenta.totalSus,2),u+130,a),a+=20,r++,n.text("TOTAL "+cuenta.nombre,90,a),n.text(number_format(cuenta.total,2),u,a);var b=Math.round(cuenta.total/O.moneda.dolar*1e4)/1e4;O.configuracionImpresion.bimonetario&&n.text(number_format(b,2),u+130,a),a+=20,r++}if(f===e.cuentasGrupo.length-1){n.font("Helvetica-Bold",8),n.text("TOTAL PASIVO:  ",30,a),n.text(number_format(s,2),u,a);b=Math.round(s/O.moneda.dolar*1e4)/1e4;O.configuracionImpresion.bimonetario&&n.text(number_format(b,2),u+130,a)}}}},O.generarPdfPreComparativo=function(e,o,n,a,r,t,i,c,u){},O.generarPdfGrupo=function(e,o,n,a,r,t){if("COMPARATIVO"!=O.configuracionImpresion.tipoPeriodo.nombre){var i=new PDFDocument({size:"letter",margin:10}),c=i.pipe(blobStream()),u=[],s=[],m=130,f=0,g=O.configuracionImpresion.usar_empesar_numeracion?O.configuracionImpresion.empesar_numeracion:1,l=O.configuracionImpresion.usar_empesar_numeracion?O.configuracionImpresion.empesar_numeracion-1+Math.ceil((u.length+s.length)/28):Math.ceil((u.length+s.length)/28),p=0;O.dibujarCabeceraPDFBalanceGeneral(i,g,l,"ACTIVO"),i.font("Helvetica",8);for(var d=0;d<n.length&&f<=28;d++)if(cuenta=n[d],cuenta.total=0,cuenta.totalSus=0,"Activo"===cuenta.clasificacion.nombre){28==f&&(i.addPage({margin:0,bufferPages:!0}),m=140,f=0,g+=1,O.dibujarCabeceraPDFBalanceGeneral(i,g,l,"ACTIVO"),i.font("Helvetica",8)),i.text(cuenta.nombre,30,m);for(var b=0;b<a.length&&f<=28;b++)if(cuenta4=a[b],"2"===cuenta4.tipoCuenta.nombre_corto){var A=String(cuenta4.codigo).substr(0,1);if(cuenta.codigo==A)for(var v=0;v<r.length&&f<=28;v++)if(cuenta3=r[v],"3"===cuenta3.tipoCuenta.nombre_corto){A=String(cuenta3.codigo).substr(0,3);if(cuenta4.codigo==A&&t.some(function(e){var o=String(e.codigo).substr(0,5);return cuenta3.codigo==o}))for(var P=0;P<t.length&&f<=28;P++)if(cuenta2=t[P],"4"===cuenta2.tipoCuenta.nombre_corto){A=String(cuenta2.codigo).substr(0,5);cuenta3.codigo==A&&(cuenta.total+=cuenta2.saldo,cuenta.totalSus+=cuenta2.saldo,p+=cuenta2.saldo)}}}O.configuracionImpresion.bimonetario&&i.text(number_format(cuenta.totalSus,2),o+130,m),i.text(number_format(cuenta.total,2),o,m),m+=20,f++,i.text("TOTAL "+cuenta.nombre,90,m),i.text(number_format(cuenta.total,2),o,m);var I=cuenta.total/O.moneda.dolar;O.configuracionImpresion.bimonetario&&i.text(number_format(I,2),o+130,m),m+=20,f++,d===n.length-1&&O.DibujarFijoGrupo(e,p,i,m,f,g,l,28,o)}else d===n.length-1&&O.DibujarFijoGrupo(e,p,i,m,f,g,l,28,o);O.configuracionImpresion.usar_firma_uno&&(i.text(O.configuracionImpresion.firma_uno,170,720),i.text(O.configuracionImpresion.cargo_uno,170,730)),O.configuracionImpresion.usar_firma_dos&&(i.text(O.configuracionImpresion.firma_dos,370,720),i.text(O.configuracionImpresion.cargo_dos,370,730)),i.end(),c.on("finish",function(){var e=c.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),_.stop()}},O.generarPdfsubGrupo=function(e,o,n,a,r,t){if("COMPARATIVO"!=O.configuracionImpresion.tipoPeriodo.nombre){var i=new PDFDocument({size:"letter",margin:10}),c=i.pipe(blobStream()),u=[],s=[],m=130,f=0,g=O.configuracionImpresion.usar_empesar_numeracion?O.configuracionImpresion.empesar_numeracion:1,l=O.configuracionImpresion.usar_empesar_numeracion?O.configuracionImpresion.empesar_numeracion-1+Math.ceil((u.length+s.length)/28):Math.ceil((u.length+s.length)/28),p=0;O.dibujarCabeceraPDFBalanceGeneral(i,g,l,"ACTIVO"),i.font("Helvetica",8);for(var d=0;d<a.length&&f<=28;d++)if(cuenta=a[d],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){28==f&&(i.addPage({margin:0,bufferPages:!0}),m=140,f=0,g+=1,O.dibujarCabeceraPDFBalanceGeneral(i,g,l,"ACTIVO"),i.font("Helvetica",8)),i.text(cuenta.nombre,30,m);for(var b=0;b<r.length&&f<=28;b++)if(cuenta3=r[b],"3"===cuenta3.tipoCuenta.nombre_corto){var A=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==A&&t.some(function(e){var o=String(e.codigo).substr(0,5);return cuenta3.codigo==o}))for(var v=0;v<t.length&&f<=28;v++)if(cuenta2=t[v],"4"===cuenta2.tipoCuenta.nombre_corto){A=String(cuenta2.codigo).substr(0,5);cuenta3.codigo==A&&(cuenta.total+=cuenta2.saldo,cuenta.totalSus+=cuenta2.saldo,p+=cuenta2.saldo)}}O.configuracionImpresion.bimonetario&&i.text(number_format(cuenta.totalSus,2),o+130,m),i.text(number_format(cuenta.total,2),o,m),m+=20,f++,i.text("TOTAL "+cuenta.nombre,90,m),i.text(number_format(cuenta.total,2),o,m);var P=cuenta.total/O.moneda.dolar;O.configuracionImpresion.bimonetario&&i.text(number_format(P,2),o+130,m),m+=20,f++,d===a.length-1&&O.DibujarFijoSubGrupo(e,p,i,m,f,g,l,28,o)}else d===a.length-1&&O.DibujarFijoSubGrupo(e,p,i,m,f,g,l,28,o);O.configuracionImpresion.usar_firma_uno&&(i.text(O.configuracionImpresion.firma_uno,170,720),i.text(O.configuracionImpresion.cargo_uno,170,730)),O.configuracionImpresion.usar_firma_dos&&(i.text(O.configuracionImpresion.firma_dos,370,720),i.text(O.configuracionImpresion.cargo_dos,370,730)),i.end(),c.on("finish",function(){var e=c.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),_.stop()}},O.generarPdfPreestablecido=function(e,o,n,a,r,t){var i=new PDFDocument({size:"letter",margin:10}),c=i.pipe(blobStream()),u=a.length+r.length,s=130,m=0,f=O.configuracionImpresion.usar_empesar_numeracion?O.configuracionImpresion.empesar_numeracion:1,g=O.configuracionImpresion.usar_empesar_numeracion?O.configuracionImpresion.empesar_numeracion-1+Math.ceil(u/28):Math.ceil(u/28),l=0;O.dibujarCabeceraPDFBalanceGeneral(i,f,g,"ACTIVO"),i.font("Helvetica",8);for(var p=0;p<a.length&&m<=28;p++)if(cuenta=a[p],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){28==m&&(i.addPage({margin:0,bufferPages:!0}),s=140,m=0,f+=1,O.dibujarCabeceraPDFBalanceGeneral(i,f,g,"ACTIVO"),i.font("Helvetica",8)),i.text(cuenta.nombre,30,s),s+=20,m++;for(var d=0;d<r.length&&m<=28;d++)if(cuenta3=r[d],"3"===cuenta3.tipoCuenta.nombre_corto){var b=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==b){if(t.some(function(e){var o=String(e.codigo).substr(0,5);return cuenta3.codigo==o})){i.text(cuenta3.nombre,40,s),cuenta3.total=0;for(var A=cuenta3.totalSus=0;A<t.length&&m<=28;A++)if(cuenta2=t[A],"4"===cuenta2.tipoCuenta.nombre_corto){b=String(cuenta2.codigo).substr(0,5);cuenta3.codigo==b&&(cuenta3.totalSus+=cuenta2.saldo/O.moneda.dolar,cuenta3.total+=cuenta2.saldo,cuenta.total+=cuenta2.saldo,l+=cuenta2.saldo),28==m&&(i.addPage({margin:0,bufferPages:!0}),s=140,m=0,f+=1,O.dibujarCabeceraPDFBalanceGeneral(i,f,g,"ACTIVO"),i.font("Helvetica",8))}else 28==m&&(i.addPage({margin:0,bufferPages:!0}),s=140,m=0,f+=1,O.dibujarCabeceraPDFBalanceGeneral(i,f,g,"ACTIVO"),i.font("Helvetica",8));O.configuracionImpresion.bimonetario&&i.text(number_format(cuenta3.totalSus,2),o+130,s),i.text(number_format(cuenta3.total,2),o,s),s+=20,m++}}else 28==m&&(i.addPage({margin:0,bufferPages:!0}),s=140,m=0,f+=1,O.dibujarCabeceraPDFBalanceGeneral(i,f,g,"ACTIVO"),i.font("Helvetica",8))}else 28==m&&(i.addPage({margin:0,bufferPages:!0}),s=140,m=0,f+=1,O.dibujarCabeceraPDFBalanceGeneral(i,f,g,"ACTIVO"),i.font("Helvetica",8));i.text("TOTAL "+cuenta.nombre,90,s),i.text(number_format(cuenta.total,2),o,s);var v=cuenta.total/O.moneda.dolar;O.configuracionImpresion.bimonetario&&i.text(number_format(v,2),o+130,s),s+=20,m++,p===a.length-1&&O.DibujarFijoPreestablecido(e,l,i,s,m,f,g,28,o)}else p===a.length-1&&O.DibujarFijoPreestablecido(e,l,i,s,m,f,g,28,o);O.configuracionImpresion.usar_firma_uno&&(i.text(O.configuracionImpresion.firma_uno,170,720),i.text(O.configuracionImpresion.cargo_uno,170,730)),O.configuracionImpresion.usar_firma_dos&&(i.text(O.configuracionImpresion.firma_dos,370,720),i.text(O.configuracionImpresion.cargo_dos,370,730)),i.end(),c.on("finish",function(){var e=c.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),_.stop()},O.generarPdfComprobantePreestablecido=function(e,o,n,a,r,t,i,c,u){var s=new PDFDocument({size:"letter",margin:10}),m=s.pipe(blobStream()),f=a.length+r.length,g=130,l=0,p=O.configuracionImpresion.usar_empesar_numeracion?O.configuracionImpresion.empesar_numeracion:1,d=O.configuracionImpresion.usar_empesar_numeracion?O.configuracionImpresion.empesar_numeracion-1+Math.ceil(f/28):Math.ceil(f/28),b={totalActivosPrimerAnio:0,totalActivosSegundoAnio:0};O.dibujarCabeceraPDFBalanceGeneral(s,p,d,"ACTIVO"),s.font("Helvetica",8);for(var A=0;A<a.length&&l<=28;A++)if(cuenta=a[A],cuenta.total=0,"Activo"===cuenta.primerAno.clasificacion.nombre){28==l&&(s.addPage({margin:0,bufferPages:!0}),g=140,l=0,p+=1,O.dibujarCabeceraPDFBalanceGeneral(s,p,d,"ACTIVO"),s.font("Helvetica",8)),s.text(cuenta.primerAno.nombre,30,g),cuenta.primerAno.total=0,cuenta.primerAno.totalSus=0,cuenta.segundoAno.total=0,g+=20,l++;for(var v=cuenta.segundoAno.totalSus=0;v<r.length&&l<=28;v++)if(cuenta3=r[v],"3"===cuenta3.primerAno.tipoCuenta.nombre_corto){var P=String(cuenta3.primerAno.codigo).substr(0,3);if(cuenta.primerAno.codigo==P){if(t.some(function(e){var o=String(e.primerAno.codigo).substr(0,5);return cuenta3.primerAno.codigo==o})){s.text(cuenta3.primerAno.nombre,40,g),cuenta3.primerAno.total=0,cuenta3.primerAno.totalSus=0,cuenta3.segundoAno.total=0;for(var I=cuenta3.segundoAno.totalSus=0;I<t.length&&l<=28;I++)if(cuenta2=t[I],"4"===cuenta2.primerAno.tipoCuenta.nombre_corto){P=String(cuenta2.primerAno.codigo).substr(0,5);cuenta3.primerAno.codigo==P&&(cuenta3.primerAno.totalSus+=cuenta2.primerAno.saldo/O.moneda.dolar,cuenta3.segundoAno.totalSus+=cuenta2.segundoAno.saldo/O.moneda.dolar,cuenta3.primerAno.total+=cuenta2.primerAno.saldo,cuenta.primerAno.total+=cuenta2.primerAno.saldo,cuenta3.segundoAno.total+=cuenta2.segundoAno.saldo,cuenta.segundoAno.total+=cuenta2.segundoAno.saldo,b.totalActivosPrimerAnio+=cuenta2.primerAno.saldo,b.totalActivosSegundoAnio+=cuenta2.segundoAno.saldo),28==l&&(s.addPage({margin:0,bufferPages:!0}),g=140,l=0,p+=1,O.dibujarCabeceraPDFBalanceGeneral(s,p,d,"ACTIVO"),s.font("Helvetica",8))}else 28==l&&(s.addPage({margin:0,bufferPages:!0}),g=140,l=0,p+=1,O.dibujarCabeceraPDFBalanceGeneral(s,p,d,"ACTIVO"),s.font("Helvetica",8));O.configuracionImpresion.bimonetario&&s.text(number_format(cuenta3.primerAno.totalSus,2),o+80,g),s.text(number_format(cuenta3.primerAno.total,2),o+180,g),O.configuracionImpresion.bimonetario&&s.text(number_format(cuenta3.segundoAno.totalSus,2),o+260,g),s.text(number_format(cuenta3.segundoAno.total,2),o,g),g+=20,l++}}else 28==l&&(s.addPage({margin:0,bufferPages:!0}),g=140,l=0,p+=1,O.dibujarCabeceraPDFBalanceGeneral(s,p,d,"ACTIVO"),s.font("Helvetica",8))}else 28==l&&(s.addPage({margin:0,bufferPages:!0}),g=140,l=0,p+=1,O.dibujarCabeceraPDFBalanceGeneral(s,p,d,"ACTIVO"),s.font("Helvetica",8));s.text("TOTAL "+cuenta.primerAno.nombre,90,g),s.text(number_format(cuenta.primerAno.total,2),o,g),s.text(number_format(cuenta.segundoAno.total,2),o+180,g);var h=cuenta.primerAno.total/O.moneda.dolar;O.configuracionImpresion.bimonetario&&s.text(number_format(h,2),o+80,g);h=cuenta.segundoAno.total/O.moneda.dolar;O.configuracionImpresion.bimonetario&&s.text(number_format(h,2),o+260,g),g+=20,l++,A===a.length-1&&O.DibujarFijoComparativoPreestablecido(e,b,s,g,l,p,d,28,o,n,a,r,t,i,c,u)}else A===a.length-1&&O.DibujarFijoComparativoPreestablecido(e,b,s,g,l,p,d,28,o,n,a,r,t,i,c,u);O.configuracionImpresion.usar_firma_uno&&(s.text(O.configuracionImpresion.firma_uno,170,720),s.text(O.configuracionImpresion.cargo_uno,170,730)),O.configuracionImpresion.usar_firma_dos&&(s.text(O.configuracionImpresion.firma_dos,370,720),s.text(O.configuracionImpresion.cargo_dos,370,730)),s.end(),m.on("finish",function(){var e=m.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),_.stop()},O.dibujarCabeceraPDFBalanceGeneral=function(e,o,n,a){if(e.font("Helvetica-Bold",8),e.text(O.usuario.empresa.razon_social,40,30,{width:220}),e.text("DE : ",40,40),e.text("NIT : ",40,50),e.text(O.usuario.empresa.direccion,40,60,{width:220}),e.text(O.usuario.empresa.nit,55,50),e.font("Helvetica-Bold",12),e.text("BALANCE GENERAL",0,75,{align:"center"}),e.font("Helvetica-Bold",8),"GES"==O.configuracionImpresion.tipoPeriodo.nombre_corto){var r=(new Date).getFullYear(),t=(new Date).getMonth(),i=new Date(r,t-1,0).getDate();O.configuracionImpresion.gestion.nombre<r?e.text("Al 31 de Diciembre de "+O.configuracionImpresion.gestion.nombre,0,85,{align:"center"}):e.text("Al "+i+" de "+O.meses[t].nombre+" de "+O.configuracionImpresion.gestion.nombre,0,85,{align:"center"})}else if("MES"==O.configuracionImpresion.tipoPeriodo.nombre_corto)e.text(O.configuracionImpresion.mes.nombre+" de "+O.configuracionImpresion.gestion.nombre,0,85,{align:"center"});else if("FECHAS"==O.configuracionImpresion.tipoPeriodo.nombre_corto){var c=new Date(O.convertirFecha(O.configuracionImpresion.fecha_inicio)),u=new Date(O.convertirFecha(O.configuracionImpresion.fecha_fin));e.text("Desde el "+c.getDate()+" de "+O.meses[c.getMonth()].nombre+" "+c.getFullYear()+" al "+u.getDate()+" de "+O.meses[u.getMonth()].nombre+" de "+u.getFullYear(),0,85,{align:"center"})}else"COMP"==O.configuracionImpresion.tipoPeriodo.nombre_corto&&e.text("Gesti√≥n "+O.configuracionImpresion.gestion.nombre+"- Gesti√≥n "+O.configuracionImpresion.gestion_fin.nombre,0,85,{align:"center"});O.configuracionImpresion.bimonetario?(e.text("Expresado en Bolivianos y D√≥lares",0,95,{align:"center"}),"COMPARATIVO"!=O.configuracionImpresion.tipoPeriodo.nombre?(e.text("Bolivianos",400,115),e.text("Dolares",520,115)):(e.text(O.configuracionImpresion.gestion.nombre,340,115),e.text("Bolivianos",290,125),e.text("Dolares",370,125),e.text(O.configuracionImpresion.gestion_fin.nombre,525,115),e.text("Bolivianos",473,125),e.text("Dolares",553,125))):e.text("Expresado en Bolivianos",0,95,{align:"center"}),e.text(a,0,105,{align:"center"}),"SAD"==O.configuracionImpresion.tipoNumeracion.nombre_corto?e.text("P√ÅGINA "+o,540,740):"SAI"==O.configuracionImpresion.tipoNumeracion.nombre_corto?e.text("P√ÅGINA "+o,0,740,{align:"center"}):"SSD"==O.configuracionImpresion.tipoNumeracion.nombre_corto?e.text("P√ÅGINA "+o,540,20):"PPD"==O.configuracionImpresion.tipoNumeracion.nombre_corto?e.text("P√ÅGINA "+o+" DE "+n,520,740):"PPC"==O.configuracionImpresion.tipoNumeracion.nombre_corto?e.text("P√ÅGINA "+o+" DE "+n,0,740,{align:"center"}):"PPSD"==O.configuracionImpresion.tipoNumeracion.nombre_corto&&e.text("P√ÅGINA "+o+" DE "+n,520,20),e.font("Helvetica",5),e.text(O.configuracionImpresion.usar_frase_pie_pagina?O.configuracionImpresion.frase_pie_pagina+", ":"",40,740),e.text((O.configuracionImpresion.usar_lugar_emision?O.configuracionImpresion.lugar_emision+", ":"")+(O.configuracionImpresion.usar_fecha_emision?O.fechaATexto(O.configuracionImpresion.fecha_emision):""),40,750)},O.generarExcelBalanceGeneral=function(e){c(O.configuracionImpresion,O.usuario.id_empresa).then(function(e){O.Cuentas=e.cuentas;for(var o=[["","","ESTADO CUENTAS PROVEEDOR"],["Deudor :"+proveedor.razon_social],["Fecha","N Recibo","Descripci√≥n","monto","total","total General"]],n=0,a=0;a<proveedor.compras.length;a++){var r=[];n+=proveedor.compras[a].saldo,proveedor.compras[a].fecha=new Date(proveedor.compras[a].fecha),r.push(proveedor.compras[a].fecha.getDate()+"/"+(proveedor.compras[a].fecha.getMonth()+1)+"/"+proveedor.compras[a].fecha.getFullYear()),r.push(proveedor.compras[a].id_movimiento),null==proveedor.compras[a].factura?r.push("PROFORMA"):r.push("factura : "+proveedor.compras[a].factura),r.push(proveedor.compras[a].saldo),r.push(n),r.push(n),o.push(r)}var t="SheetJS",i=new Workbook,c=sheet_from_array_of_arrays(o);i.SheetNames.push(t),i.Sheets[t]=c;var u=XLSX.write(i,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(u)],{type:"application/octet-stream"}),"REPORTE-ESTADO-CUENTA-PROVEEDOR.xlsx"),_.stop()})},O.dibujarCabeceraExelBalanceGeneral=function(){var e="",o="";if("GES"==O.configuracionImpresion.tipoPeriodo.nombre_corto){var n=(new Date).getFullYear(),a=(new Date).getMonth(),r=new Date(n,a-1,0).getDate();e=O.configuracionImpresion.gestion.nombre<n?"Al 31 de Diciembre de "+O.configuracionImpresion.gestion.nombre:"Al "+r+" de "+O.meses[a].nombre+" de "+O.configuracionImpresion.gestion.nombre}else if("MES"==O.configuracionImpresion.tipoPeriodo.nombre_corto)e=O.configuracionImpresion.mes.nombre+" de "+O.configuracionImpresion.gestion.nombre;else if("FECHAS"==O.configuracionImpresion.tipoPeriodo.nombre_corto){var t=new Date(O.convertirFecha(O.configuracionImpresion.fecha_inicio)),i=new Date(O.convertirFecha(O.configuracionImpresion.fecha_fin));e="Desde el "+t.getDate()+" de "+O.meses[t.getMonth()].nombre+" "+t.getFullYear()+" al "+i.getDate()+" de "+O.meses[i.getMonth()].nombre+" de "+i.getFullYear()}else"COMP"==O.configuracionImpresion.tipoPeriodo.nombre_corto&&(e="Gesti√≥n "+O.configuracionImpresion.gestion.nombre+"- Gesti√≥n "+O.configuracionImpresion.gestion_fin.nombre);if(O.configuracionImpresion.bimonetario){o="Expresado en Bolivianos y D√≥lares";var c=["GRUPO","SUB GRUPO","GENERICO","APROPIACION","","BOLIVIANOS","","DOLARES"]}else{c=["GRUPO","SUB GRUPO","GENERICO","APROPIACION","","BOLIVIANOS"];o="Expresado en Bolivianos"}return[["","","","BALANCE GENERAL"],["","","",e],["","","",o],c]},O.generarExelApropiacion=function(e,o,n,a,r,t){for(var i=O.dibujarCabeceraExelBalanceGeneral(),c=0;c<a.length;c++){var u=[];if(cuenta=a[c],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){u.push(""),u.push(cuenta.nombre),i.push(u);for(var s=0;s<r.length;s++){u=[],cuenta3=r[s];var m=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==m&&t.some(function(e){var o=String(e.codigo).substr(0,5);return cuenta3.codigo==o})){u.push(""),u.push(""),u.push(cuenta3.nombre),i.push(u);for(var f=0;f<t.length;f++){u=[],cuenta2=t[f];m=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==m){u.push(""),u.push(""),u.push(""),u.push(cuenta2.nombre),u.push(""),u.push(number_format(cuenta2.saldo,2));var g=cuenta2.saldo/O.moneda.dolar;O.configuracionImpresion.bimonetario&&u.push(""),u.push(number_format(g,2)),cuenta.total+=cuenta2.saldo,cuenta2.saldo,i.push(u)}}}}u=[],a.length}else a.length}O.configuracionImpresion.usar_firma_uno,O.configuracionImpresion.usar_firma_dos;var l="SheetJS",p=new Workbook,d=sheet_from_array_of_arrays(i);p.SheetNames.push(l),p.Sheets[l]=d;var b=XLSX.write(p,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(b)],{type:"application/octet-stream"}),"REPORTE-BALANCE-GENERAL.xlsx"),_.stop()},O.descargarArchivo=function(e,a){var o=new FileReader;o.onload=function(e){var o=document.createElement("a");o.href=e.target.result,o.target="_blank",o.download=a||"archivo.dat";var n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});o.dispatchEvent(n),(window.URL||window.webkitURL).revokeObjectURL(o.href)},o.readAsDataURL(e)},O.dibujarCabeceraWordBalanceGeneral=function(){var e="",o="";if("GES"==O.configuracionImpresion.tipoPeriodo.nombre_corto){var n=(new Date).getFullYear(),a=(new Date).getMonth(),r=new Date(n,a-1,0).getDate();e=O.configuracionImpresion.gestion.nombre<n?"Al 31 de Diciembre de "+O.configuracionImpresion.gestion.nombre:"Al "+r+" de "+O.meses[a].nombre+" de "+O.configuracionImpresion.gestion.nombre}else if("MES"==O.configuracionImpresion.tipoPeriodo.nombre_corto)e=O.configuracionImpresion.mes.nombre+" de "+O.configuracionImpresion.gestion.nombre;else if("FECHAS"==O.configuracionImpresion.tipoPeriodo.nombre_corto){var t=new Date(O.convertirFecha(O.configuracionImpresion.fecha_inicio)),i=new Date(O.convertirFecha(O.configuracionImpresion.fecha_fin));e="Desde el "+t.getDate()+" de "+O.meses[t.getMonth()].nombre+" "+t.getFullYear()+" al "+i.getDate()+" de "+O.meses[i.getMonth()].nombre+" de "+i.getFullYear()}else"COMP"==O.configuracionImpresion.tipoPeriodo.nombre_corto&&(e="Gesti√≥n "+O.configuracionImpresion.gestion.nombre+"- Gesti√≥n "+O.configuracionImpresion.gestion_fin.nombre);if(O.configuracionImpresion.bimonetario){o="Expresado en Bolivianos y D√≥lares"}else{o="Expresado en Bolivianos"}return"\t\t\t\t\tBALANCE GENERAL\r\n\t\t\t\t\t"+e+"\r\n\t\t\t\t"+o+"\r\n"},O.generarWordApropiacion=function(e,o,n,a,r,t){var i=O.dibujarCabeceraWordBalanceGeneral(),c=[];c.push(i);O.dibujarCabeceraExelBalanceGeneral();for(var u=a.length+r.length+t.length,s=0,m=(O.configuracionImpresion.usar_empesar_numeracion&&O.configuracionImpresion.empesar_numeracion,O.configuracionImpresion.usar_empesar_numeracion?(O.configuracionImpresion.empesar_numeracion,Math.ceil(u/51)):Math.ceil(u/51),0);m<a.length&&s<=51;m++)if(cuenta=a[m],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){51==s&&(s=0,1,c.push(i)),c.push(cuenta.nombre+"\r\n"),s++;for(var f=0;f<r.length&&s<=51;f++){cuenta3=r[f];var g=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==g&&t.some(function(e){var o=String(e.codigo).substr(0,5);return cuenta3.codigo==o})){c.push("\t"),c.push(cuenta3.nombre+"\r\n"),51==++s&&(s=0,1,c.push(i));for(var l=0;l<t.length&&s<=51;l++){cuenta2=t[l];g=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==g){c.push("\t\t"),22<cuenta2.nombre.length?(text1=String(cuenta2.nombre).substr(0,22),text2=String(cuenta2.nombre).substr(22),c.push(text1),c.push("\n\r\t\t"),s++,c.push(text2)):c.push(cuenta2.nombre),c.push("\t"),c.push(number_format(cuenta2.saldo,2));var p=cuenta2.saldo/O.moneda.dolar;O.configuracionImpresion.bimonetario&&c.push("\t\t"+number_format(p,2)),cuenta.total+=cuenta2.saldo,cuenta2.saldo,c.push("\r\n"),51==++s&&(s=0,1,c.push(i))}}}}c.push("\t"),c.push("TOTAL "+cuenta.nombre),c.push("\t\t\t\t"),c.push(number_format(cuenta.total,2));var d=cuenta.total/O.moneda.dolar;O.configuracionImpresion.bimonetario&&c.push("\t\t\t\t"),c.push(number_format(d,2)),a.length}else a.length;return O.configuracionImpresion.usar_firma_uno,O.configuracionImpresion.usar_firma_dos,_.stop(),new Blob(c,{type:"text/plain"})},O.$on("$routeChangeStart",function(e,o){}),O.inicio()});