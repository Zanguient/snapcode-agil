angular.module("agil.controladores").controller("ControladorBalaceComprobacionSumaSaldo",function(h,o,e,n,r,i,I,a,c,t,s,u,p,m,f){h.usuario=JSON.parse(o.usuario),h.inicio=function(){h.obtenerTiposPeriodos(),h.obtenerGestiones(),h.obtenerTiposCuenta(),h.obtenerConfiguracionImpresion(),h.obtenerGestionesImpresion()},h.$on("$viewContentLoaded",function(){resaltarPestaña(e.path().substring(1)),h.buscarAplicacion(h.usuario.aplicacionesUsuario,e.path().substring(1)),I.stop()}),h.obtenerTiposPeriodos=function(){I.start(),c("EEFF_TP").then(function(o){h.TiposPeriodos=o,h.TiposPeriodos.clases.forEach(function(o,e,n){"COMPARATIVO"===o.nombre&&h.TiposPeriodos.clases.splice(e,1)}),I.stop()})},h.obtenerGestiones=function(){I.start(),c("GTN").then(function(o){h.gestiones=o.clases,I.stop()})},h.obtenerConfiguracionImpresion=function(){t(h.usuario.id_empresa).then(function(o){h.configuracionImpresion=o,h.configuracionImpresion.bimonetario=!0,h.configuracionImpresion.tioPeriodo="",h.configuracionImpresion.gestion="",h.configuracionImpresion.gestion_fin="",h.configuracionImpresion.mes="",h.configuracionImpresion.fecha_inicio=null,h.configuracionImpresion.fecha_fin=null,I.stop()})},h.cargarFechasFiltro=function(o){"FECHAS"==o&&setTimeout(function(){aplicarDatePickers()},300)},h.obtenerTiposCuenta=function(){I.start(),c("TCC").then(function(o){h.cuentaTipos=[{id:0,nombre:"PREESTABLECIDO"}],h.cuentaTipos=h.cuentaTipos.concat(o.clases),I.stop()})},h.obtenerGestionesImpresion=function(){I.start(),h.gestionesEF=[],u(h.usuario.id_empresa).then(function(o){I.stop(),o.forEach(function(o){o.habilitado&&(h.fechasImpresion=o)})})},h.generarPdfBalanceComprobacionSS=function(){h.configuracionImpresion.fecha_inicio&&(h.configuracionImpresion.inicio2=new Date(h.convertirFecha(h.configuracionImpresion.fecha_inicio)),h.configuracionImpresion.fin2=new Date(h.convertirFecha(h.configuracionImpresion.fecha_fin))),h.configuracionImpresion.fechasImpresion=h.fechasImpresion,f(h.configuracionImpresion,h.usuario.id_empresa).then(function(o){console.log("los datos para PDF yeeeee ",o);var e=h.configuracionImpresion.bimonetario?400:530;h.generarPdfApropiacion(o,e),I.stop()})},h.generarExelBalanceGeneral=function(){I.start(),h.configuracionImpresion.fecha_inicio&&(h.configuracionImpresion.inicio2=new Date(h.convertirFecha(h.configuracionImpresion.fecha_inicio)),h.configuracionImpresion.fin2=new Date(h.convertirFecha(h.configuracionImpresion.fecha_fin))),h.configuracionImpresion.fechasImpresion=h.fechasImpresion,s(h.configuracionImpresion,h.usuario.id_empresa).then(function(i){i.monedaCambio?h.moneda=i.monedaCambio:h.moneda={ufv:"--",dolar:"--"},i.arregloActivos=[],i.arregloActivosFijos=[],i.arregloPasivos=[],i.arregloPatrimonio=[],i.arregloIngreso=[],i.arregloEgreso=[],i.arregleCostos=[];if("COMPARATIVO"!=h.configuracionImpresion.tipoPeriodo.nombre){i.arregloPasivos=i.arregloPasivos.concat(i.arregloPatrimonio);var o=h.configuracionImpresion.bimonetario?400:530;"PREESTABLECIDO"==h.configuracionImpresion.tipo_cuenta.nombre?h.generarExelAPreestablecido(i,o,i.cuentasGrupo,i.cuentasSubGrupo,i.cuentasGenericas,i.cuentasApropiacion):"GENERICA"==h.configuracionImpresion.tipo_cuenta.nombre?h.generarExelAPreestablecido(i,o,i.cuentasGrupo,i.cuentasSubGrupo,i.cuentasGenericas,i.cuentasApropiacion):"GRUPO"==h.configuracionImpresion.tipo_cuenta.nombre?h.generarExelGrupo(i,o,i.cuentasGrupo,i.cuentasSubGrupo,i.cuentasGenericas,i.cuentasApropiacion):"SUB GRUPO"==h.configuracionImpresion.tipo_cuenta.nombre?h.generarExelSubGrupo(i,o,i.cuentasGrupo,i.cuentasSubGrupo,i.cuentasGenericas,i.cuentasApropiacion):"APROPIACION"==h.configuracionImpresion.tipo_cuenta.nombre&&h.generarExelApropiacion(i,o,i.cuentasGrupo,i.cuentasSubGrupo,i.cuentasGenericas,i.cuentasApropiacion)}else{var a=[],c=[],t=[],s=[],u=[],p=[],m=[];i.primero.cuentasGrupo.forEach(function(o,e,n){var r={};r.primerAno=o,a.push(r),e===n.length-1&&i.segundo.cuentasGrupo.forEach(function(o,e,n){for(var r=0;r<a.length;r++){var i=a[r];i.primerAno.id==o.id&&(i.segundoAno=o)}})}),i.primero.cuentasSubGrupo.forEach(function(o,e,n){var r={};r.primerAno=o,c.push(r),e===n.length-1&&i.segundo.cuentasSubGrupo.forEach(function(o,e,n){for(var r=0;r<c.length;r++){var i=c[r];i.primerAno.id==o.id&&(i.segundoAno=o)}})}),i.primero.cuentasGenericas.forEach(function(o,e,n){var r={};r.primerAno=o,t.push(r),e===n.length-1&&i.segundo.cuentasGenericas.forEach(function(o,e,n){for(var r=0;r<t.length;r++){var i=t[r];i.primerAno.id==o.id&&(i.segundoAno=o)}})}),i.primero.cuentasApropiacion.forEach(function(o,e,n){var r={};r.primerAno=o,s.push(r),e===n.length-1&&i.segundo.cuentasApropiacion.forEach(function(o,e,n){for(var r=0;r<s.length;r++){var i=s[r];i.primerAno.id==o.id&&(i.segundoAno=o)}})}),i.primero.cuentasSubGrupoFijo.forEach(function(o,e,n){var r={};r.primerAno=o,u.push(r),e===n.length-1&&i.segundo.cuentasSubGrupoFijo.forEach(function(o,e,n){for(var r=0;r<u.length;r++){var i=u[r];i.primerAno.id==o.id&&(i.segundoAno=o)}})}),i.primero.cuentasGenericasFijo.forEach(function(o,e,n){var r={};r.primerAno=o,p.push(r),e===n.length-1&&i.segundo.cuentasGenericasFijo.forEach(function(o,e,n){for(var r=0;r<p.length;r++){var i=p[r];i.primerAno.id==o.id&&(i.segundoAno=o)}})}),i.primero.cuentasApropiacionFijo.forEach(function(o,e,n){var r={};r.primerAno=o,m.push(r),e===n.length-1&&i.segundo.cuentasApropiacionFijo.forEach(function(o,e,n){for(var r=0;r<m.length;r++){var i=m[r];i.primerAno.id==o.id&&(i.segundoAno=o)}})});o=h.configuracionImpresion.bimonetario?290:310;"PREESTABLECIDO"==h.configuracionImpresion.tipo_cuenta.nombre?h.generarExelComprobantePreestablecido(i,o,a,c,t,s,u,p,m):"GENERICA"==h.configuracionImpresion.tipo_cuenta.nombre?h.generarExelComprobantePreestablecido(i,o,a,c,t,cuentasApropiacioncuentasSubGrupoFijo,p,m):"GRUPO"==h.configuracionImpresion.tipo_cuenta.nombre?h.generarExelComparativoGrupo(i,o,a,c,t,cuentasApropiacioncuentasSubGrupoFijo,p,m):"SUB GRUPO"==h.configuracionImpresion.tipo_cuenta.nombre?h.generarExelComparativosubGrupo(i,o,a,c,t,cuentasApropiacioncuentasSubGrupoFijo,p,m):"APROPIACION"==h.configuracionImpresion.tipo_cuenta.nombre&&h.generarExelComparativoApropiacion(i,o,a,c,t,cuentasApropiacioncuentasSubGrupoFijo,p,m),I.stop()}})},h.generarWordBalanceGeneral=function(){I.start(),h.configuracionImpresion.fecha_inicio&&(h.configuracionImpresion.inicio2=new Date(h.convertirFecha(h.configuracionImpresion.fecha_inicio)),h.configuracionImpresion.fin2=new Date(h.convertirFecha(h.configuracionImpresion.fecha_fin))),h.configuracionImpresion.fechasImpresion=h.fechasImpresion,s(h.configuracionImpresion,h.usuario.id_empresa).then(function(i){if(i.monedaCambio?h.moneda=i.monedaCambio:h.moneda={ufv:"--",dolar:"--"},"COMPARATIVO"!=h.configuracionImpresion.tipoPeriodo.nombre){var o=h.configuracionImpresion.bimonetario?400:530;"PREESTABLECIDO"==h.configuracionImpresion.tipo_cuenta.nombre?h.descargarArchivo(h.generarWordPreestablecido(i,o,i.cuentasGrupo,i.cuentasSubGrupo,i.cuentasGenericas,i.cuentasApropiacion),"reporte-balance-general.doc"):"GENERICA"==h.configuracionImpresion.tipo_cuenta.nombre?h.descargarArchivo(h.generarWordPreestablecido(i,o,i.cuentasGrupo,i.cuentasSubGrupo,i.cuentasGenericas,i.cuentasApropiacion),"reporte-balance-general.doc"):"GRUPO"==h.configuracionImpresion.tipo_cuenta.nombre?h.descargarArchivo(h.generarWordGrupo(i,o,i.cuentasGrupo,i.cuentasSubGrupo,i.cuentasGenericas,i.cuentasApropiacion),"reporte-balance-general.doc"):"SUB GRUPO"==h.configuracionImpresion.tipo_cuenta.nombre?h.descargarArchivo(h.generarWordSubGrupo(i,o,i.cuentasGrupo,i.cuentasSubGrupo,i.cuentasGenericas,i.cuentasApropiacion),"reporte-balance-general.doc"):"APROPIACION"==h.configuracionImpresion.tipo_cuenta.nombre&&h.descargarArchivo(h.generarWordApropiacion(i,o,i.cuentasGrupo,i.cuentasSubGrupo,i.cuentasGenericas,i.cuentasApropiacion),"reporte-balance-general.doc")}else{var a=[],c=[],t=[],s=[],u=[],p=[],m=[];i.primero.cuentasGrupo.forEach(function(o,e,n){var r={};r.primerAno=o,a.push(r),e===n.length-1&&i.segundo.cuentasGrupo.forEach(function(o,e,n){for(var r=0;r<a.length;r++){var i=a[r];i.primerAno.id==o.id&&(i.segundoAno=o)}})}),i.primero.cuentasSubGrupo.forEach(function(o,e,n){var r={};r.primerAno=o,c.push(r),e===n.length-1&&i.segundo.cuentasSubGrupo.forEach(function(o,e,n){for(var r=0;r<c.length;r++){var i=c[r];i.primerAno.id==o.id&&(i.segundoAno=o)}})}),i.primero.cuentasGenericas.forEach(function(o,e,n){var r={};r.primerAno=o,t.push(r),e===n.length-1&&i.segundo.cuentasGenericas.forEach(function(o,e,n){for(var r=0;r<t.length;r++){var i=t[r];i.primerAno.id==o.id&&(i.segundoAno=o)}})}),i.primero.cuentasApropiacion.forEach(function(o,e,n){var r={};r.primerAno=o,s.push(r),e===n.length-1&&i.segundo.cuentasApropiacion.forEach(function(o,e,n){for(var r=0;r<s.length;r++){var i=s[r];i.primerAno.id==o.id&&(i.segundoAno=o)}})}),i.primero.cuentasSubGrupoFijo.forEach(function(o,e,n){var r={};r.primerAno=o,u.push(r),e===n.length-1&&i.segundo.cuentasSubGrupoFijo.forEach(function(o,e,n){for(var r=0;r<u.length;r++){var i=u[r];i.primerAno.id==o.id&&(i.segundoAno=o)}})}),i.primero.cuentasGenericasFijo.forEach(function(o,e,n){var r={};r.primerAno=o,p.push(r),e===n.length-1&&i.segundo.cuentasGenericasFijo.forEach(function(o,e,n){for(var r=0;r<p.length;r++){var i=p[r];i.primerAno.id==o.id&&(i.segundoAno=o)}})}),i.primero.cuentasApropiacionFijo.forEach(function(o,e,n){var r={};r.primerAno=o,m.push(r),e===n.length-1&&i.segundo.cuentasApropiacionFijo.forEach(function(o,e,n){for(var r=0;r<m.length;r++){var i=m[r];i.primerAno.id==o.id&&(i.segundoAno=o)}})});o=h.configuracionImpresion.bimonetario?290:310;"PREESTABLECIDO"==h.configuracionImpresion.tipo_cuenta.nombre?h.generarWordComprobantePreestablecido(i,o,a,c,t,s,u,p,m):"GENERICA"==h.configuracionImpresion.tipo_cuenta.nombre?h.generarWordComprobantePreestablecido(i,o,a,c,t,cuentasApropiacioncuentasSubGrupoFijo,p,m):"GRUPO"==h.configuracionImpresion.tipo_cuenta.nombre?h.generarWordComparativoGrupo(i,o,a,c,t,cuentasApropiacioncuentasSubGrupoFijo,p,m):"SUB GRUPO"==h.configuracionImpresion.tipo_cuenta.nombre?h.generarWordComparativosubGrupo(i,o,a,c,t,cuentasApropiacioncuentasSubGrupoFijo,p,m):"APROPIACION"==h.configuracionImpresion.tipo_cuenta.nombre&&h.generarWordComparativoApropiacion(i,o,a,c,t,cuentasApropiacioncuentasSubGrupoFijo,p,m),I.stop()}})},h.generarPdfApropiacion=function(o,e){var n=new PDFDocument({size:"letter",margin:10}),r=n.pipe(blobStream()),i=o.cuentas.length,a=130,c=0,t=h.configuracionImpresion.usar_empesar_numeracion?h.configuracionImpresion.empesar_numeracion:1,s=h.configuracionImpresion.usar_empesar_numeracion?h.configuracionImpresion.empesar_numeracion-1+Math.ceil(i/28):Math.ceil(i/28),u=0;h.dibujarCabeceraPDFBalanceGeneral(n,t,s,"ACTIVO"),n.font("Helvetica",8);for(var p=0;p<o.cuentas.length;p++){if(n.text(o.cuentas[p].cuenta.nombre,60,a),n.text(o.cuentas[p].debe_bs,300,a),n.text(o.cuentas[p].haber_bs,370,a),o.cuentas[p].debe_bs>o.cuentas[p].haber_bs){var m=o.cuentas[p].debe_bs-o.cuentas[p].haber_bs;n.text(m.toFixed(2),440,a)}else{m=o.cuentas[p].haber_bs-o.cuentas[p].debe_bs;n.text(m.toFixed(2),510,a)}n.rect(50,a-7,0,20).stroke(),n.rect(285,a-7,0,20).stroke(),n.rect(50,a-7,235,20).dash(1,{space:10}).stroke(),n.rect(365,a-7,0,20).dash(1,{space:0}).stroke(),n.rect(435,a-7,0,20).stroke(),n.rect(505,a-7,0,20).stroke(),n.rect(570,a-7,0,20).stroke(),20,a+=20,28==(c+=1)&&(n.rect(50,a-7,520,0).stroke(),n.addPage({margin:0,bufferPages:!0}),a=130,c=0,t+=1,h.dibujarCabeceraPDFBalanceGeneral(n,t,s,"ACTIVO"),n.font("Helvetica",8)),u+=1,s==t&&o.cuentas.length==u&&n.rect(50,a-7,520,0).stroke()}h.configuracionImpresion.usar_firma_uno&&(n.text(h.configuracionImpresion.firma_uno,170,720),n.text(h.configuracionImpresion.cargo_uno,170,730)),h.configuracionImpresion.usar_firma_dos&&(n.text(h.configuracionImpresion.firma_dos,370,720),n.text(h.configuracionImpresion.cargo_dos,370,730)),n.end(),r.on("finish",function(){var o=r.toBlobURL("application/pdf");window.open(o,"_blank","location=no")}),I.stop()},h.dibujarCabeceraPDFBalanceGeneral=function(o,e,n,r){if(o.font("Helvetica-Bold",8),o.text(h.usuario.empresa.razon_social,40,30,{width:220}),o.text("DE : ",40,40),o.text("NIT : ",40,50),o.text(h.usuario.empresa.direccion,40,60,{width:220}),o.text(h.usuario.empresa.nit,55,50),o.font("Helvetica-Bold",12),o.text("BALANCE DE COMPROBACIÓN DE SUMAS Y SALDOS",0,75,{align:"center"}),o.font("Helvetica-Bold",8),"GES"==h.configuracionImpresion.tipoPeriodo.nombre_corto){var i=(new Date).getFullYear(),a=(new Date).getMonth(),c=new Date(i,a-1,0).getDate();h.configuracionImpresion.gestion.nombre<i?o.text("Al 31 de Diciembre de "+h.configuracionImpresion.gestion.nombre,0,85,{align:"center"}):o.text("Al "+c+" de "+h.meses[a].nombre+" de "+h.configuracionImpresion.gestion.nombre,0,85,{align:"center"})}else if("MES"==h.configuracionImpresion.tipoPeriodo.nombre_corto)o.text(h.configuracionImpresion.mes.nombre+" de "+h.configuracionImpresion.gestion.nombre,0,85,{align:"center"});else if("FECHAS"==h.configuracionImpresion.tipoPeriodo.nombre_corto){var t=new Date(h.convertirFecha(h.configuracionImpresion.fecha_inicio)),s=new Date(h.convertirFecha(h.configuracionImpresion.fecha_fin));o.text("Desde el "+t.getDate()+" de "+h.meses[t.getMonth()].nombre+" "+t.getFullYear()+" al "+s.getDate()+" de "+h.meses[s.getMonth()].nombre+" de "+s.getFullYear(),0,85,{align:"center"})}else"COMP"==h.configuracionImpresion.tipoPeriodo.nombre_corto&&o.text("Gestión "+h.configuracionImpresion.gestion.nombre+"- Gestión "+h.configuracionImpresion.gestion_fin.nombre,0,85,{align:"center"});o.text("Expresado en Bolivianos",0,95,{align:"center"}),o.rect(50,103,520,20).stroke(),o.text("DEBE",300,115),o.text("HABER",370,115),o.text("DEUDOR",440,115),o.text("ACREEDOR",510,115),"SAD"==h.configuracionImpresion.tipoNumeracion.nombre_corto?o.text("PÁGINA "+e,540,740):"SAI"==h.configuracionImpresion.tipoNumeracion.nombre_corto?o.text("PÁGINA "+e,0,740,{align:"center"}):"SSD"==h.configuracionImpresion.tipoNumeracion.nombre_corto?o.text("PÁGINA "+e,540,20):"PPD"==h.configuracionImpresion.tipoNumeracion.nombre_corto?o.text("PÁGINA "+e+" DE "+n,520,740):"PPC"==h.configuracionImpresion.tipoNumeracion.nombre_corto?o.text("PÁGINA "+e+" DE "+n,0,740,{align:"center"}):"PPSD"==h.configuracionImpresion.tipoNumeracion.nombre_corto&&o.text("PÁGINA "+e+" DE "+n,520,20),o.font("Helvetica",5),o.text(h.configuracionImpresion.usar_frase_pie_pagina?h.configuracionImpresion.frase_pie_pagina+", ":"",40,740),o.text((h.configuracionImpresion.usar_lugar_emision?h.configuracionImpresion.lugar_emision+", ":"")+(h.configuracionImpresion.usar_fecha_emision?h.fechaATexto(h.configuracionImpresion.fecha_emision):""),40,750)},h.generarExcelBalanceGeneral=function(o){s(h.configuracionImpresion,h.usuario.id_empresa).then(function(o){h.Cuentas=o.cuentas;for(var e=[["","","ESTADO CUENTAS PROVEEDOR"],["Deudor :"+proveedor.razon_social],["Fecha","N Recibo","Descripción","monto","total","total General"]],n=0,r=0;r<proveedor.compras.length;r++){var i=[];n+=proveedor.compras[r].saldo,proveedor.compras[r].fecha=new Date(proveedor.compras[r].fecha),i.push(proveedor.compras[r].fecha.getDate()+"/"+(proveedor.compras[r].fecha.getMonth()+1)+"/"+proveedor.compras[r].fecha.getFullYear()),i.push(proveedor.compras[r].id_movimiento),null==proveedor.compras[r].factura?i.push("PROFORMA"):i.push("factura : "+proveedor.compras[r].factura),i.push(proveedor.compras[r].saldo),i.push(n),i.push(n),e.push(i)}var a="SheetJS",c=new Workbook,t=sheet_from_array_of_arrays(e);c.SheetNames.push(a),c.Sheets[a]=t;var s=XLSX.write(c,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(s)],{type:"application/octet-stream"}),"REPORTE-ESTADO-CUENTA-PROVEEDOR.xlsx"),I.stop()})},h.dibujarCabeceraExelBalanceGeneral=function(){var o="",e="";if("GES"==h.configuracionImpresion.tipoPeriodo.nombre_corto){var n=(new Date).getFullYear(),r=(new Date).getMonth(),i=new Date(n,r-1,0).getDate();o=h.configuracionImpresion.gestion.nombre<n?"Al 31 de Diciembre de "+h.configuracionImpresion.gestion.nombre:"Al "+i+" de "+h.meses[r].nombre+" de "+h.configuracionImpresion.gestion.nombre}else if("MES"==h.configuracionImpresion.tipoPeriodo.nombre_corto)o=h.configuracionImpresion.mes.nombre+" de "+h.configuracionImpresion.gestion.nombre;else if("FECHAS"==h.configuracionImpresion.tipoPeriodo.nombre_corto){var a=new Date(h.convertirFecha(h.configuracionImpresion.fecha_inicio)),c=new Date(h.convertirFecha(h.configuracionImpresion.fecha_fin));o="Desde el "+a.getDate()+" de "+h.meses[a.getMonth()].nombre+" "+a.getFullYear()+" al "+c.getDate()+" de "+h.meses[c.getMonth()].nombre+" de "+c.getFullYear()}else"COMP"==h.configuracionImpresion.tipoPeriodo.nombre_corto&&(o="Gestión "+h.configuracionImpresion.gestion.nombre+"- Gestión "+h.configuracionImpresion.gestion_fin.nombre);if(h.configuracionImpresion.bimonetario){e="Expresado en Bolivianos y Dólares";var t=["GRUPO","SUB GRUPO","GENERICO","APROPIACION","","BOLIVIANOS","","DOLARES"]}else{t=["GRUPO","SUB GRUPO","GENERICO","APROPIACION","","BOLIVIANOS"];e="Expresado en Bolivianos"}return[["","","","BALANCE GENERAL"],["","","",o],["","","",e],t]},h.generarExelApropiacion=function(o,e,n,r,i,a){for(var c=h.dibujarCabeceraExelBalanceGeneral(),t=0;t<r.length;t++){var s=[];if(cuenta=r[t],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){s.push(""),s.push(cuenta.nombre),c.push(s);for(var u=0;u<i.length;u++){s=[],cuenta3=i[u];var p=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==p&&a.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e})){s.push(""),s.push(""),s.push(cuenta3.nombre),c.push(s);for(var m=0;m<a.length;m++){s=[],cuenta2=a[m];p=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==p){s.push(""),s.push(""),s.push(""),s.push(cuenta2.nombre),s.push(""),s.push(number_format(cuenta2.saldo,2));var f=cuenta2.saldo/h.moneda.dolar;h.configuracionImpresion.bimonetario&&s.push(""),s.push(number_format(f,2)),cuenta.total+=cuenta2.saldo,cuenta2.saldo,c.push(s)}}}}s=[],r.length}else r.length}h.configuracionImpresion.usar_firma_uno,h.configuracionImpresion.usar_firma_dos;var g="SheetJS",l=new Workbook,d=sheet_from_array_of_arrays(c);l.SheetNames.push(g),l.Sheets[g]=d;var b=XLSX.write(l,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(b)],{type:"application/octet-stream"}),"REPORTE-BALANCE-GENERAL.xlsx"),I.stop()},h.descargarArchivo=function(o,r){var e=new FileReader;e.onload=function(o){var e=document.createElement("a");e.href=o.target.result,e.target="_blank",e.download=r||"archivo.dat";var n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(n),(window.URL||window.webkitURL).revokeObjectURL(e.href)},e.readAsDataURL(o)},h.dibujarCabeceraWordBalanceGeneral=function(){var o="",e="";if("GES"==h.configuracionImpresion.tipoPeriodo.nombre_corto){var n=(new Date).getFullYear(),r=(new Date).getMonth(),i=new Date(n,r-1,0).getDate();o=h.configuracionImpresion.gestion.nombre<n?"Al 31 de Diciembre de "+h.configuracionImpresion.gestion.nombre:"Al "+i+" de "+h.meses[r].nombre+" de "+h.configuracionImpresion.gestion.nombre}else if("MES"==h.configuracionImpresion.tipoPeriodo.nombre_corto)o=h.configuracionImpresion.mes.nombre+" de "+h.configuracionImpresion.gestion.nombre;else if("FECHAS"==h.configuracionImpresion.tipoPeriodo.nombre_corto){var a=new Date(h.convertirFecha(h.configuracionImpresion.fecha_inicio)),c=new Date(h.convertirFecha(h.configuracionImpresion.fecha_fin));o="Desde el "+a.getDate()+" de "+h.meses[a.getMonth()].nombre+" "+a.getFullYear()+" al "+c.getDate()+" de "+h.meses[c.getMonth()].nombre+" de "+c.getFullYear()}else"COMP"==h.configuracionImpresion.tipoPeriodo.nombre_corto&&(o="Gestión "+h.configuracionImpresion.gestion.nombre+"- Gestión "+h.configuracionImpresion.gestion_fin.nombre);if(h.configuracionImpresion.bimonetario){e="Expresado en Bolivianos y Dólares"}else{e="Expresado en Bolivianos"}return"\t\t\t\t\tBALANCE GENERAL\r\n\t\t\t\t\t"+o+"\r\n\t\t\t\t"+e+"\r\n"},h.generarWordApropiacion=function(o,e,n,r,i,a){var c=h.dibujarCabeceraWordBalanceGeneral(),t=[];t.push(c);h.dibujarCabeceraExelBalanceGeneral();for(var s=r.length+i.length+a.length,u=0,p=(h.configuracionImpresion.usar_empesar_numeracion&&h.configuracionImpresion.empesar_numeracion,h.configuracionImpresion.usar_empesar_numeracion?(h.configuracionImpresion.empesar_numeracion,Math.ceil(s/51)):Math.ceil(s/51),0);p<r.length&&u<=51;p++)if(cuenta=r[p],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){51==u&&(u=0,1,t.push(c)),t.push(cuenta.nombre+"\r\n"),u++;for(var m=0;m<i.length&&u<=51;m++){cuenta3=i[m];var f=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==f&&a.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e})){t.push("\t"),t.push(cuenta3.nombre+"\r\n"),51==++u&&(u=0,1,t.push(c));for(var g=0;g<a.length&&u<=51;g++){cuenta2=a[g];f=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==f){t.push("\t\t"),22<cuenta2.nombre.length?(text1=String(cuenta2.nombre).substr(0,22),text2=String(cuenta2.nombre).substr(22),t.push(text1),t.push("\n\r\t\t"),u++,t.push(text2)):t.push(cuenta2.nombre),t.push("\t"),t.push(number_format(cuenta2.saldo,2));var l=cuenta2.saldo/h.moneda.dolar;h.configuracionImpresion.bimonetario&&t.push("\t\t"+number_format(l,2)),cuenta.total+=cuenta2.saldo,cuenta2.saldo,t.push("\r\n"),51==++u&&(u=0,1,t.push(c))}}}}t.push("\t"),t.push("TOTAL "+cuenta.nombre),t.push("\t\t\t\t"),t.push(number_format(cuenta.total,2));var d=cuenta.total/h.moneda.dolar;h.configuracionImpresion.bimonetario&&t.push("\t\t\t\t"),t.push(number_format(d,2)),r.length}else r.length;return h.configuracionImpresion.usar_firma_uno,h.configuracionImpresion.usar_firma_dos,I.stop(),new Blob(t,{type:"text/plain"})},h.$on("$routeChangeStart",function(o,e){}),h.inicio()});