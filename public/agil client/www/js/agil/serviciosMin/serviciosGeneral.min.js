angular.module("agil.servicios").factory("Diccionario",[function(){return{MOV_ING:"MOVING",MOV_EGR:"MOVEGR",ING_INV_INICIAL:"III",EGRE_FACTURACION:"FACT",EGRE_PRE_FACTURACION:"PREFACT",EGRE_BAJA:"BAJA",EGRE_PROFORMA:"PFR",EGRE_TRASPASO:"TRAS",EGRE_AJUSTE:"AJU",EGRE_COTIZACION:"COT",FACT_IMPRESION_VACIA:"VAC",FACT_IMPRESION_COMPLETA:"COMPL",FACT_IMPRESION_SEMICOMPLETA:"SEMICOMPL",FACT_PAPEL_OFICIO:"OFICIO",FACT_PAPEL_CARTA:"CARTA",FACT_PAPEL_MEDIOOFICIO:"MEDOFI",FACT_PAPEL_ROLLO:"ROLLO",FACT_PAPEL_CUARTOCARTA:"CARTACUARTO",TIPO_PAGO_CREDITO:"CREDITO",TIPO_PAGO_CONTADO:"CONTADO",CENTRO_COSTO_ALMACEN:"ALMACEN",ROL_ADMINISTRADOR:"ADMINISTRADOR",ROL_VENDEDOR:"VENDEDOR",ROL_OPERADOR:"OPERADOR",DIA_LUNES:"LUN19",DIA_MARTES:"MAR19",DIA_MIERCOLES:"MIE19",DIA_JUEVES:"JUE19",DIA_VIERNES:"VIE19",DIA_SABADO:"SAB19",DIA_DOMINGO:"DOM19",USUARIO_SUPERADMIN:"SUPER-ADMINISTRADOR",MENU_RUTAS:"RUTAS",MENU_SEGUIMIENTOAPP:"SEGUIMIENTO APP",MENU_APPMOVIL:"APP MOVIL",MENU_PANTALLACLIENTE:"PANTALLA CLIENTE",MENU_PANTALLADESPACHO:"PANTALLA DESPACHO",TIPO_PRODUCTO_BASE:"PBASE",TIPO_PRODUCTO_INTER:"PINTER",TIPO_PRODUCTO_FINAL:"PFINAL",DESTINO_CIERRE_BANCO:"DBANCO",DESTINO_CIERRE_CAJA:"CAJA",DESTINO_CIERRE_SIGUIENTETURNO:"SIGUIENTETURNO",ESTADO_MESA_OCUPADO:"OCU",ESTADO_MESA_DISPONIBLE:"DIS",ESTADO_MESA_RESERVADO:"RE",MENU_MESAS:"MESAS",MENU_PLAN_CUENTAS:"PLAN CUENTAS",MENU_COMPROBANTES:"COMPROBANTES",MENU_MEDICO:"PACIENTES",IVA_DF:"IVA DF",IVA_CF:"IVA CF",IT:"IT",IT_POR_PAGAR:"IT POR PAGAR",CAJA_BANCOS:"CAJA/BANCOS",COMPROBANTE_INGRESO:"INGRESO",COMPROBANTE_EGRESO:"EGRESO",COMPROBANTE_TRASPASO:"TRASPASO",COMPROBANTE_CAJA_CHICA:"CAJA CHICA",MENU_VEHICULOS:"VEHICULOS",MENU_PROFORMAS:"PROFORMAS",MENU_USUARIO:"USUARIOS",MENU_EMPRESA:"EMPRESAS",MENU_VENTA:"VENTAS",MENU_COMPRA:"COMPRAS",MENU_CONFIGURACION:"CONFIGURACIONES",MENU_REPORTE:"REPORTES",MENU_LIBRO_COMPRA:"LIBRO DE COMPRAS",MENU_LIBRO_VENTAS:"LIBRO DE VENTAS",MENU_REPORTE_VENTAS:"REPORTE DE VENTAS",MENU_REPORTE_COMPRAS:"REPORTE DE COMPRAS",MENU_ESTADO_RESULTADOS:"ESTADO DE RESULTADOS NO CONTABLE",MENU_ALMACEN:"ALMACENES",MENU_CERT_COD_CONTROL:"CERT. COD. DE CONTROL",MENU_ESTADO_CUENTAS_CLIENTES:"ESTADO DE CUENTAS CLIENTES",MENU_ESTADO_CUENTAS_PROVEEDORES:"ESTADO DE CUENTAS PROVEEDORES",MENU_PANTALLA:"PANTALLAS",MENU_DESPACHO:"DESPACHOS",MENU_CONCEPTO:"CONCEPTOS",MENU_DOSIFICACION:"DOSIFICACIONES",TIPO_CORRELATIVO_CLIENTES:"CORRELATIVO CLIENTES",TIPO_CORRELATIVO_DESTINOS:"CORRELATIVO DESTINOS",MOVING_INVENTARIO_INICIAL:"INGRESO POR INVENTARIO INICIAL",MOVING_POR_TRASPASO:"INGRESO POR TRASPASO",MOVING_POR_DEVOLUCION:"INGRESO POR DEVOLUCIÓN",MOVING_DIARIO:"INGRESO DIARIO",MOVING_POR_AJUSTE:"INGRESO POR AJUSTE",MOVING_POR_IMPORTACION:"INGRESO POR IMPORTACIÓN",MOVING_POR_RETENCION_SERVICIOS:"INGRESO POR RETENCIONES DE SERVICIOS",MOVING_POR_RETENCION_BIENES:"INGRESO POR RETENCIONES DE BIENES",MOVING_POR_COMPRA_SIN_FACTURA:"INGRESO POR COMPRA S/F",IT_RETENCION_BIEN:"IT RETENCION BIEN ALMACEN",IUE_RETENCION_BIEN:"IUE RETENCION BIEN ALMACEN",CUENTA_ALMACEN_RETENCION_BIEN:"CUENTA ALMACEN RETENCION BIEN",CUENTA_GASTO_RETENCION_BIEN:"CUENTA GASTO RETENCION BIEN",IT_RETENCION_BIEN_GASTO:"IT RETENCION BIEN GASTO",IUE_RETENCION_BIEN_GASTO:"IUE RETENCION BIEN GASTO",CUENTA_RETENCION_SERVICIO:"CUENTA RETENCION SERVICIO",IT_RETENCION_SERVICIO:"IT RETENCION SERVICIO",IUE_RETENCION_SERVICIO:"IUE RETENCION SERVICIO",CC_ESTADO_PROCESADO:"PROCESADO",CC_ESTADO_DESEMBOLSADO:"DESEMBOLSADO",CC_ESTADO_VERIFICADO:"VERIFICADO",CC_ESTADO_PENDIENTE:"PENDIENTE",CC_ESTADO_AUTORIZADO:"AUTORIZADO",CC_ESTADO_ANULADO:"ANULADO",CC_MOV_ANTICIPO:"ANTICIPO",EGRE_SERVICIO:"SERV"}}]).factory("VerificarDescuentos",[function(){return function(e){var t=!1;if(void 0!==e)for(var o=0;o<e.length;o++)(0<e[o].descuento||0<e[o].recargo||0<e[o].ice||0<e[o].excento)&&(t=!0);return t}}]).factory("NuevoComprobante",["blockUI","AsignarComprobanteFavorito","LibroMayorCuenta","ComprobanteRevisarPaginador","NuevoComprobanteContabilidad","ListaCuentasComprobanteContabilidad","ActualizarComprobanteContabilidad","ImprimirComprobante","DatosComprobante",function(e,A,C,O,v,I,h,D,T){return function(t,o,a,n,e,i,r,c,l,s,u,d,f,m,x){e&&(E=A(e)).then(function(e){t(e.mensaje),o.getSearch("",a)});if(i&&i.asiento.id)return E=C(i.asiento.id,i.fechaInicio,i.fechaFin);if(r)return o.filter.inicio,o.filter.fin,null==o.filter.inicio&&(o.filter.inicio=0,o.filter.fin=0),0!=o.filter.inicio&&(o.filter.inicio=new Date(c(a.inicio)),o.filter.fin=new Date(c(a.fin))),E=O(o);if(s){var p=new Date;if(s.fechaActual=new Date,s.id){for(s.importe=0,s.abierto=!1,g=0;g<s.asientosContables.length;g++)0!=(_=s.asientosContables[g]).activo&&""!=_.debe_bs&&(s.importe=Math.round(1e4*(s.importe+_.debe_bs))/1e4);s.fecha=new Date(c(s.fecha)),s.fecha.setHours(p.getHours()),s.fecha.setMinutes(p.getMinutes()),h.update({id_comprobante:s.id},s,function(e){d(n.id_empresa),f(n.id_empresa),t(e.mensaje),l(),m()}),console.log("falta agregar el put para guardar")}else{for(var g=0;g<s.asientosContables.length;g++){var _;0!=(_=s.asientosContables[g]).activo&&""!=_.debe_bs&&(s.importe=Math.round(1e4*(s.importe+_.debe_bs))/1e4)}s.fecha=new Date(c(s.fecha)),s.fecha.setHours(p.getHours()),s.fecha.setMinutes(p.getMinutes()),v.save(s,function(e){d(n.id_empresa),f(n.id_empresa),t(e.mensaje),T(e.comprobante.id).then(function(e){e.comprobante.importe_literal=e.importeLiteral,D(e.comprobante,!1,n,x)}),m(),l()})}}if(u&&""!=u&&null!=u){var E=I(n.id_empresa,u);return console.log(E),E}}}]).factory("ImprimirComprobante",["blockUI","DibujarCabeceraComprobante","Diccionario","DibujarCabeceraFacturaNVCartaOficio","DibujarCabeceraFacturaNVmedioOficio","$timeout",function(U,H,e,t,o,B){return function(F,N,P,S){var R=[],M=[],w={calculo:0,monto:0,texto1:"",texto2:"",texto3:"",cant:0},L={calculo:0,monto:0,texto1:"",texto2:"",texto3:"",cant:0};F.asientosContables.forEach(function(e,t,o){if(0!=e.debe_bs?R.push(e):M.push(e),e.cuenta.especifica&&(e.cuenta.tipo_especifica?(L.monto+=e.debe_bs,L.texto1=e.cuenta.especificaTexto1.nombre_corto,L.texto2=e.cuenta.especificaTexto2.nombre_corto,L.texto3=e.cuenta.especificaTexto3.nombre_corto,L.cant++,L.calculo=100*L.monto/13,L.calculo=S(L.calculo,2)):(w.monto+=e.haber_bs,w.texto1=e.cuenta.especificaTexto1.nombre_corto,w.texto2=e.cuenta.especificaTexto2.nombre_corto,w.texto3=e.cuenta.especificaTexto3.nombre_corto,w.cant++,w.calculo=100*w.monto/13,w.calculo=S(w.calculo,2))),t===o.length-1){var a=R.concat(M),n=new PDFDocument({compress:!1,size:[612,792],margin:10}),i=n.pipe(blobStream());n.font("Helvetica",8);var r=160,c=0,l=1,s=Math.ceil(a.length/19),u=0,d=0,f=0,m=0,x=new Date;if(N){H(n,N,P,F,l,s,L,w);for(var p=0;p<a.length&&c<=19;p++){e=a[p],n.rect(390,r,0,30).stroke(),n.rect(440,r,0,30).stroke(),n.rect(490,r,0,30).stroke(),n.rect(540,r,0,30).stroke(),n.font("Helvetica",7),n.text(e.cuenta.codigo,28,r+5),n.font("Helvetica-Bold",7),e.cuenta.tipoAuxiliar&&n.text(e.cuentaAux.nombre,28,r+13,{width:80}),n.font("Helvetica-Bold",7),n.text(e.cuenta.nombre,120,r+5,{width:190,underline:!0}),n.font("Helvetica",7),n.text(e.glosa,125,r+13,{width:190}),e.centroCosto&&n.text(e.centroCosto.nombre,310,r+5),n.text("",350,r+5);var g=S(e.debe_bs,2),_=S(e.haber_bs,2);"0.00"!=g&&n.text(g,395,r+5),"0.00"!=_&&n.text(_,445,r+5);var E=S(e.debe_sus,2),A=S(e.haber_sus,2);"0.00"!=E&&n.text(E,500,r+5),"0.00"!=_&&n.text(A,545,r+5),u+=0+e.debe_bs,d+=0+e.haber_bs,f+=0+e.debe_sus,m+=0+e.haber_sus,r+=30,19<++c&&(n.addPage({size:[612,792],margin:10}),r=160,c=0,H(n,N,P,F,l+=1,s,L,w))}n.font("Helvetica-Bold",7),n.text("SUMA TOTAL:",330,r+5),u=S(u,2),d=S(d,2),n.text(u,395,r+5),n.text(d,445,r+5),m=S(m,2),f=S(f,2),n.text(f,500,r+5),n.text(m,545,r+5),n.rect(20,r,571,0).stroke(),n.rect(20,r+20,571,0).stroke(),n.rect(390,r,0,20).stroke(),n.rect(440,r,0,20).stroke(),n.rect(490,r,0,20).stroke(),n.rect(540,r,0,20).stroke()}else{for(H(n,N,P,F,l,s,L,w),p=0;p<a.length&&c<=19;p++)e=a[p],n.rect(450,r,0,30).stroke(),n.rect(520,r,0,30).stroke(),n.font("Helvetica",7),n.text(e.cuenta.codigo,38,r+5),n.font("Helvetica-Bold",7),e.cuenta.tipoAuxiliar&&e.cuentaAux&&n.text(e.cuentaAux.nombre,38,r+13,{width:80}),n.font("Helvetica-Bold",7),n.text(e.cuenta.nombre,130,r+5,{width:190,underline:!0}),n.font("Helvetica",7),n.text(e.glosa,135,r+13,{width:190}),e.centroCosto&&n.text(e.centroCosto.nombre,340,r+5),n.text("",380,r+5),g=S(e.debe_bs,2),_=S(e.haber_bs,2),"0.00"!=g&&n.text(g,470,r+5),"0.00"!=_&&n.text(_,540,r+5),u+=0+e.debe_bs,d+=0+e.haber_bs,r+=30,19<++c&&(n.rect(450,r,0,2).stroke(),n.rect(520,r,0,2).stroke(),n.addPage({size:[612,792],margin:10}),r=160,c=0,H(n,N,P,F,l+=1,s,L,w));n.font("Helvetica-Bold",7),n.text("SUMA TOTAL:",390,r+5),n.font("Helvetica",7),u=S(u,2),d=S(d,2),n.text(u,470,r+5),n.text(d,540,r+5),n.rect(20,r,571,0).stroke(),n.rect(20,r+20,571,0).stroke(),n.font("Helvetica-Bold",7),n.rect(450,r,0,20).stroke(),n.rect(520,r,0,20).stroke()}if(n.text("Son:",38,r+25),n.font("Helvetica",7),n.text(F.importe_literal,60,r+25),n.rect(20,r+40,571,0).stroke(),"TRASPASO"==F.tipoComprobante.nombre){n.rect(20,720,571,0).stroke(),n.font("Helvetica-Bold",7),n.text("Preparado por:",38,725),n.font("Helvetica",7),n.text(P.persona.nombre_completo,38,735),n.rect(200,720,0,42).stroke();var C=(v=new Date(F.fecha_creacion)).getMonth()+1;(I=v.getMinutes())<10&&(I="0"+v.getMinutes()),(h=v.getHours())<10&&(h="0"+v.getHours()),(D=v.getSeconds())<10&&(D="0"+v.getSeconds()),C<10?n.text(+v.getDate()+"/0"+C+"/"+v.getFullYear()+"         "+h+":"+I+":"+D,58,752):n.text(+v.getDate()+"/"+C+"/"+v.getFullYear()+"         "+h+":"+I+":"+D,58,752);var O=x.getMonth()+1;(T=x.getMinutes())<10&&(T="0"+x.getMinutes()),(b=x.getHours())<10&&(b="0"+x.getHours()),(V=x.getSeconds())<10&&(V="0"+x.getSeconds()),O<10?n.text("IMP.:"+x.getDate()+"/0"+O+"/"+x.getFullYear()+"         "+b+":"+T+":"+V,38,765):n.text("IMP.:"+x.getDate()+"/"+O+"/"+x.getFullYear()+"         "+b+":"+T+":"+V,38,765),n.text("Revisado",290,752),n.text("Autorizado",480,752),n.rect(410,720,0,42).stroke(),n.rect(20,750,571,0).stroke()}else{var v,I,h,D,T,b,V;n.rect(20,720,571,0).stroke(),n.font("Helvetica-Bold",7),n.text("Preparado por:",38,725),n.font("Helvetica",7),n.text(P.persona.nombre_completo,38,735),n.rect(200,720,0,42).stroke(),C=(v=new Date(F.fecha_creacion)).getMonth()+1,(I=v.getMinutes())<10&&(I="0"+v.getMinutes()),(h=v.getHours())<10&&(h="0"+v.getHours()),(D=v.getSeconds())<10&&(D="0"+v.getSeconds()),C<10?n.text(+v.getDate()+"/0"+C+"/"+v.getFullYear()+"         "+h+":"+I+":"+D,58,752):n.text(+v.getDate()+"/"+C+"/"+v.getFullYear()+"         "+h+":"+I+":"+D,58,752),O=x.getMonth()+1,(T=x.getMinutes())<10&&(T="0"+x.getMinutes()),(b=x.getHours())<10&&(b="0"+x.getHours()),(V=x.getSeconds())<10&&(V="0"+x.getSeconds()),O<10?n.text("IMP.:"+x.getDate()+"/0"+O+"/"+x.getFullYear()+"         "+b+":"+T+":"+V,38,765):n.text("IMP.:"+x.getDate()+"/"+O+"/"+x.getFullYear()+"         "+b+":"+T+":"+V,38,765),n.text("Revisado",240,752),n.text("Autorizado",350,752),n.text("Recibio conforme:",425,740),n.text("CI:",425,752),n.rect(310,720,0,42).stroke(),n.rect(420,720,0,42).stroke(),n.rect(20,750,571,0).stroke()}n.end(),i.on("finish",function(){var e=i.toBlobURL("application/pdf"),t=window.open(e,"_blank","location=no");B(function(){t.print()},500)}),U.stop()}})}}]).factory("DibujarCabeceraComprobante",[function(){return function(e,t,o,a,n,i,r,c){var l,s=new Date(a.fecha);console.log(o),t?(e.rect(20,30,571,732).stroke(),e.font("Helvetica-Bold",8),e.text(o.empresa.razon_social,25,35),e.text("SISTEMA DE CONTABILIDAD.",25,50),e.text("NIT: ",25,65),e.font("Helvetica",8),e.text(o.empresa.nit+".",50,65),e.font("Helvetica-Bold",14),e.text("COMPROBANTE DE "+a.tipoComprobante.nombre,0,75,{align:"center"}),e.font("Helvetica",8),e.text(n+" de: "+i,545,35),e.font("Helvetica-Bold",8),e.text("Gestión: "+s.getFullYear(),515,50),e.font("Helvetica-Bold",12),e.text("N°: ",535,65),e.font("Helvetica",12),e.text(a.numero,555,65),e.rect(20,90,571,0).stroke(),e.font("Helvetica",8),e.text(a.gloza,68,105),e.font("Helvetica-Bold",8),(l=s.getMonth()+1)<10?e.text("Fecha: "+s.getDate()+"/0"+l+"/"+s.getFullYear(),500,95):e.text("Fecha: "+s.getDate()+"/"+l+"/"+s.getFullYear(),500,95),e.text("T. Cambio: ",500,105),e.font("Helvetica",8),e.text(a.tipoCambio.dolar,545,105),0<r.cant&&0==c.cant&&e.text(r.texto1+" "+r.monto+"    "+r.texto2+" "+r.calculo+"    "+r.texto3+" "+r.cant,400,120),0<c.cant&&0==r.cant&&e.text(c.texto1+" "+c.monto+"    "+c.texto2+" "+c.calculo+"    "+c.texto3+" "+c.cant,400,120),0<c.cant&&0<r.cant&&e.text(c.texto1+" "+c.monto+"    "+c.texto2+" "+c.calculo+"    "+c.texto3+" "+c.cant+"     "+r.texto1+" "+r.monto+"    "+r.texto2+" "+r.calculo+"    "+r.texto3+" "+r.cant,350,120),e.font("Helvetica-Bold",8),e.rect(20,130,571,0).stroke(),e.font("Helvetica-Bold",8),e.text("Cuenta",45,145),e.text("Descripcion/Glosa",140,145),e.text("C.Costo",310,145),e.text("ref",350,145),e.rect(20,160,571,0).stroke(),e.rect(390,130,0,30).stroke(),e.rect(440,145,0,15).stroke(),e.rect(390,145,200,0).stroke(),e.text("BOLIVIANOS",415,137),e.text("Debe",405,150),e.text("Haber",455,150),e.rect(490,130,0,30).stroke(),e.rect(540,145,0,15).stroke(),e.text("DOLARES",520,137),e.text("Debe",505,150),e.text("Haber",550,150)):(e.rect(20,30,571,732).stroke(),e.font("Helvetica-Bold",8),e.text(o.empresa.razon_social,25,35),e.text("SISTEMA DE CONTABILIDAD.",25,50),e.text("NIT: ",25,65),e.font("Helvetica",8),e.text(o.empresa.nit+".",50,65),e.font("Helvetica-Bold",14),e.text("COMPROBANTE DE "+a.tipoComprobante.nombre,0,75,{align:"center"}),e.font("Helvetica",8),e.text(n+" de: "+i,545,35),e.font("Helvetica-Bold",8),e.text("Gestión: "+s.getFullYear(),515,50),e.font("Helvetica-Bold",12),e.text("N°: ",535,65),e.font("Helvetica",12),e.text(a.numero,555,65),e.rect(20,90,571,0).stroke(),e.font("Helvetica",8),e.text(a.gloza,38,105),e.font("Helvetica-Bold",8),(l=s.getMonth()+1)<10?e.text("Fecha: "+s.getDate()+"/0"+l+"/"+s.getFullYear(),500,95):e.text("Fecha: "+s.getDate()+"/"+l+"/"+s.getFullYear(),500,95),e.text("T. Cambio: ",500,105),e.font("Helvetica",8),e.text(a.tipoCambio.dolar,545,105),0<r.cant&&0==c.cant&&e.text(r.texto1+" "+r.monto+"    "+r.texto2+" "+r.calculo+"    "+r.texto3+" "+r.cant,400,120),0<c.cant&&0==r.cant&&e.text(c.texto1+" "+c.monto+"    "+c.texto2+" "+c.calculo+"    "+c.texto3+" "+c.cant,400,120),0<c.cant&&0<r.cant&&e.text(c.texto1+" "+c.monto+"    "+c.texto2+" "+c.calculo+"    "+c.texto3+" "+c.cant+"     "+r.texto1+" "+r.monto+"    "+r.texto2+" "+r.calculo+"    "+r.texto3+" "+r.cant,350,120),e.font("Helvetica-Bold",8),e.rect(20,130,571,0).stroke(),e.text("Cuenta",50,145),e.text("Descripcion/Glosa",150,145),e.text("C.Costo",340,145),e.text("ref",405,145),e.text("BOLIVIANOS",500,135),e.rect(450,145,140,0).stroke(),e.rect(20,160,571,0).stroke(),e.rect(450,130,0,30).stroke(),e.rect(520,145,0,15).stroke(),e.text("Debe",475,150),e.text("Haber",545,150))}}]).factory("ComprasComprobante",["$resource",function(e){return e(restServer+"comprasComprobante")}]).factory("CuentasAuxiliares",["$resource",function(e){return e(restServer+"cuentas-auxiliares/empresa/:id_empresa/tipo/:tipo")}]).factory("ListasCuentasAuxiliares",["CuentasAuxiliares","$q",function(a,n){return function(e,t){var o=n.defer();return a.query({id_empresa:e,tipo:t},function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise}}]).factory("ComprobanteTotalGeneral",["$resource",function(e){return e(restServer+"comprobantes/totalGeneral/empresa/:id_empresa")}]).factory("ComprobanteTotalGeneralEmpresa",["ComprobanteTotalGeneral","$q",function(o,a){return function(e){var t=a.defer();return o.get({id_empresa:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}}]).factory("ComprobanteRevisarDatosPaginador",["$resource",function(e){return e(restServer+"comprobantes/empresa/:id_empresa/pagina/:pagina/items-pagina/:items_pagina/fecha-inicio/:inicio/fecha-fin/:fin/columna/:columna/direccion/:direccion/busqueda/:texto_busqueda")}]).factory("ComprobanteRevisarPaginador",["ComprobanteRevisarDatosPaginador","$q",function(o,a){return function(e){var t=a.defer();return o.get({id_empresa:e.filter.empresa,pagina:e.currentPage,items_pagina:e.itemsPerPage,inicio:e.filter.inicio,fin:e.filter.fin,columna:e.column,direccion:e.direction,texto_busqueda:e.search},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}}]).factory("CuentasComprobanteContabilidad",["$resource",function(e){return e(restServer+"comprobante-cuenta/empresa/:id_empresa/busqueda/:buscar",{id_empresa:"@id_empresa",buscar:"@buscar"},{update:{method:"PUT"}})}]).factory("ListaCuentasComprobanteContabilidad",["CuentasComprobanteContabilidad","$q",function(a,n){return function(e,t){var o=n.defer();return a.query({id_empresa:e,buscar:t},function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise}}]).factory("ComprobanteEmpresaPaginador",["$resource",function(e){return e(restServer+"comprobantes/empresa/:id_empresa/pagina/:pagina/items-pagina/:items_pagina/fecha-inicio/:inicio/fecha-fin/:fin/columna/:columna/direccion/:direccion/monto/:monto/tipo-comprobante/:tipo_comprobante/sucursal/:sucursal/usuario/:usuario/numero/:numero/busqueda/:busqueda")}]).factory("ComprobantePaginador",["ComprobanteEmpresaPaginador","$q",function(o,a){return function(e){null==e.filter.monto&&(e.filter.monto=0),null==e.filter.tipo_comprobante&&(e.filter.tipo_comprobante=0),null==e.filter.sucursal&&(e.filter.sucursal=0),null==e.filter.usuario&&(e.filter.usuario=0),null==e.filter.numero&&(e.filter.numero=0);var t=a.defer();return o.get({id_empresa:e.filter.empresa,pagina:e.currentPage,items_pagina:e.itemsPerPage,inicio:e.filter.inicio,fin:e.filter.fin,columna:e.column,direccion:e.direction,monto:e.filter.monto,tipo_comprobante:e.filter.tipo_comprobante,sucursal:e.filter.sucursal,usuario:e.filter.usuario,numero:e.filter.numero,busqueda:e.search},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}}]).factory("LibroMayor",["$resource",function(e){return e(restServer+"/comprobante-cuenta/:id_cuenta/periodo/:inicio/:fin")}]).factory("LibroMayorCuenta",["LibroMayor","$q",function(n,i){return function(e,t,o){var a=i.defer();return n.get({id_cuenta:e,inicio:t,fin:o},function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise}}]).factory("ComprobanteFavorito",["$resource",function(e){return e(restServer+"comprobante-contabilidad/favorito/:id_comprobante",{id_comprobante:"@id_comprobante"},{update:{method:"PUT"}})}]).factory("AsignarComprobanteFavorito",["ComprobanteFavorito","$q",function(o,a){return function(e){var t=a.defer();return o.update({id_comprobante:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}}]).factory("AsientosComprobanteContabilidad",["$resource",function(e){return e(restServer+"comprobante-cuenta/asientos/:id_cuenta",{id_cuenta:"@id_cuenta"},{update:{method:"PUT"}})}]).factory("FormatoImpresion",["$resource",function(e){return e(restServer+"tipos/:nombre_corto",{nombre_corto:"@nombre_corto"},{update:{method:"PUT"}})}]).factory("IdsFormatoImpresion",["FormatoImpresion","$q",function(e,o){return function(){var t=o.defer();return e.get({nombre_corto:"FORM_IMP_FAC"},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}}]).factory("ListaAsientosComprobanteContabilidad",["AsientosComprobanteContabilidad","$q",function(o,a){return function(e){var t=a.defer();return o.query({id_cuenta:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}}]).factory("NuevoComprobanteContabilidad",["$resource",function(e){return e(restServer+"comprobante-contabolidad",{update:{method:"PUT"}})}]).factory("ActualizarComprobanteContabilidad",["$resource",function(e){return e(restServer+"comprobante-contabolidad/:id_comprobante",{id_comprobante:"@id_comprobante"},{update:{method:"PUT"}})}]).factory("DatosComprobante",["ActualizarComprobanteContabilidad","$q",function(o,a){return function(e){var t=a.defer();return o.get({id_comprobante:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}}]).factory("EliminarComprobante",["ActualizarComprobanteContabilidad","$q",function(o,a){return function(e){var t=a.defer();return o.save({id_comprobante:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}}]).factory("ImprimirSalida",["Diccionario","ImprimirFactura","ImprimirProforma","ImprimirNotaBaja","ImprimirNotaTraspaso","ImprimirServicio",function(i,r,c,l,s,u){return function(e,t,o,a,n){e==i.EGRE_FACTURACION?r(t,o,a):e==i.EGRE_PROFORMA?c(t,o,a,n):e==i.EGRE_BAJA?l(t,a):e==i.EGRE_TRASPASO?s(t,a):e==i.EGRE_SERVICIO&&u(t,o,a)}}]).factory("ImprimirFactura",["Diccionario","ImprimirFacturaCartaOficio","ImprimirFacturaCartaOficioSinFormato","ImprimirPedido","ImprimirFacturaRollo","$timeout",function(l,s,e,u,d,f){return function(e,t,o,a){var n,i,r;if(e.configuracion.formatoColor=e.configuracion.formatoColorFactura,e.configuracion.formatoPapel=e.configuracion.formatoPapelFactura,e.configuracion.color1=e.configuracion.color_cabecera_factura,e.configuracion.color2=e.configuracion.color_detalle_factura,e.configuracion.nota=e.configuracion.nota_factura_bien?e.configuracion.nota_factura_bien:"",e.configuracion.tamanoPapelFactura.nombre_corto==l.FACT_PAPEL_OFICIO)n=[612,936],e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_VACIA?s(e,n,!0,!1,!1,o):e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_COMPLETA?s(e,n,!1,!0,!1,o):e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_SEMICOMPLETA&&s(e,n,!1,!1,!0);else if(e.configuracion.tamanoPapelFactura.nombre_corto==l.FACT_PAPEL_CARTA)n=[612,792],e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_VACIA?s(e,n,!0,!1,!1,o):e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_COMPLETA?s(e,n,!1,!0,!1,o):e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_SEMICOMPLETA&&s(e,n,!1,!1,!0,o);else if(e.configuracion.tamanoPapelFactura.nombre_corto==l.FACT_PAPEL_MEDIOOFICIO)n=[612,468],e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_VACIA?s(e,n,!0,!1,!1,o):e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_COMPLETA?s(e,n,!1,!0,!1,o):e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_SEMICOMPLETA&&s(e,n,!1,!1,!0,o);else if(e.configuracion.tamanoPapelFactura.nombre_corto==l.FACT_PAPEL_ROLLO){if(n=[227,e.detallesVenta.length<=2?610:610+20*(e.detallesVenta.length-2)],t&&!e.configuracion.imprimir_al_guardar){if(o.empresa.usar_pedidos){var c=230+20*e.detallesVenta.length;i=new PDFDocument({compress:!1,size:[227,c],margins:{top:10,bottom:10,left:20,right:20}}),r=i.pipe(blobStream()),u(e,t,i,r,c,o,!1)}}else i=new PDFDocument({compress:!1,size:n,margins:{top:0,bottom:0,left:20,right:20}}),r=i.pipe(blobStream()),d(e,n,i,r,o),o.empresa.usar_pedidos&&(c=230+20*e.detallesVenta.length,i.addPage({size:[227,c],margins:{top:10,bottom:10,left:20,right:20}}),u(e,t,i,r,c,o,!1));i&&r&&(i.end(),r.on("finish",function(){var e=r.toBlobURL("application/pdf"),t=window.open(e,"_blank","location=no");f(function(){t.print()},500)}))}}}]).factory("ImprimirServicio",["Diccionario","ImprimirFacturaCartaOficio","ImprimirFacturaCartaOficioSinFormato","ImprimirPedido","ImprimirFacturaRollo","$timeout",function(c,l,e,s,u,d){return function(e,t,o){var a,n,i;if(e.configuracion.formatoColor=e.configuracion.formatoColorFacturaServicio,e.configuracion.formatoPapel=e.configuracion.formatoPapelFacturaServicio,e.configuracion.color1=e.configuracion.color_cabecera_factura_servicio,e.configuracion.color2=e.configuracion.color_detalle_factura_servicio,e.configuracion.nota=e.configuracion.nota_factura_servicio?e.configuracion.nota_factura_servicio:"",e.configuracion.tamanoPapelFacturaServicio.nombre_corto==c.FACT_PAPEL_OFICIO)a=[612,936],e.configuracion.impresionFactura.nombre_corto==c.FACT_IMPRESION_VACIA?l(e,a,!0,!1,!1,o):e.configuracion.impresionFactura.nombre_corto==c.FACT_IMPRESION_COMPLETA?l(e,a,!1,!0,!1,o):e.configuracion.impresionFactura.nombre_corto==c.FACT_IMPRESION_SEMICOMPLETA&&l(e,a,!1,!1,!0);else if(e.configuracion.tamanoPapelFacturaServicio.nombre_corto==c.FACT_PAPEL_CARTA)a=[612,792],e.configuracion.impresionFactura.nombre_corto==c.FACT_IMPRESION_VACIA?l(e,a,!0,!1,!1,o):e.configuracion.impresionFactura.nombre_corto==c.FACT_IMPRESION_COMPLETA?l(e,a,!1,!0,!1,o):e.configuracion.impresionFactura.nombre_corto==c.FACT_IMPRESION_SEMICOMPLETA&&l(e,a,!1,!1,!0,o);else if(e.configuracion.tamanoPapelFacturaServicio.nombre_corto==c.FACT_PAPEL_MEDIOOFICIO)a=[612,468],e.configuracion.impresionFactura.nombre_corto==c.FACT_IMPRESION_VACIA?l(e,a,!0,!1,!1,o):e.configuracion.impresionFactura.nombre_corto==c.FACT_IMPRESION_COMPLETA?l(e,a,!1,!0,!1,o):e.configuracion.impresionFactura.nombre_corto==c.FACT_IMPRESION_SEMICOMPLETA&&l(e,a,!1,!1,!0,o);else if(e.configuracion.tamanoPapelFacturaServicio.nombre_corto==c.FACT_PAPEL_ROLLO){if(a=[227,e.detallesVenta.length<=2?610:610+20*(e.detallesVenta.length-2)],t&&!e.configuracion.imprimir_al_guardar){if(o.empresa.usar_pedidos){var r=230+20*e.detallesVenta.length;n=new PDFDocument({compress:!1,size:[227,r],margins:{top:10,bottom:10,left:20,right:20}}),i=n.pipe(blobStream()),s(e,t,n,i,r,o,!1)}}else n=new PDFDocument({compress:!1,size:a,margins:{top:0,bottom:0,left:20,right:20}}),i=n.pipe(blobStream()),u(e,a,n,i,o),o.empresa.usar_pedidos&&(r=230+20*e.detallesVenta.length,n.addPage({size:[227,r],margins:{top:10,bottom:10,left:20,right:20}}),s(e,t,n,i,r,o,!1));n&&i&&(n.end(),i.on("finish",function(){var e=i.toBlobURL("application/pdf"),t=window.open(e,"_blank","location=no");d(function(){t.print()},500)}))}}}]).factory("ImprimirFacturaCartaOficio",["blockUI","VerificarDescuentos","Diccionario","DibujarCabeceraFacturaNVCartaOficio","DibujarCabeceraFacturaNVmedioOficio","$timeout",function(v,I,h,D,T,b){return function(e,t,o,a,n,i){var r=new PDFDocument({compress:!1,size:t,margin:10}),c=r.pipe(blobStream());if(e.configuracion.usar_pf){var l=0;e.configuracion.tamanoPapelFactura.nombre_corto==h.FACT_PAPEL_OFICIO?l=19:e.configuracion.tamanoPapelFactura.nombre_corto==h.FACT_PAPEL_CARTA?l=16:e.configuracion.tamanoPapelFactura.nombre_corto==h.FACT_PAPEL_MEDIOOFICIO&&(l=3);var s=240,u=0,d=1,f=Math.ceil(e.detallesVenta.length/l);D(r,o,a,e,t,d,f,i);for(var m=0;m<e.detallesVenta.length&&u<=l;m++){if(r.font("Helvetica",8),e.detallesVenta[m].producto){e.detallesVenta[m].fecha_vencimiento=new Date(e.detallesVenta[m].fecha_vencimiento);var x=e.detallesVenta[m].fecha_vencimiento.getDate()+"/"+(e.detallesVenta[m].fecha_vencimiento.getMonth()+1)+"/"+e.detallesVenta[m].fecha_vencimiento.getFullYear().toString().substring(2);r.text(e.detallesVenta[m].producto.codigo,55,s,{width:70}),r.text(e.detallesVenta[m].cantidad,135,s),r.text(e.detallesVenta[m].producto.unidad_medida,160,s-3,{width:43});var p=(C=e.detallesVenta[m].producto.nombre.length)<=24?s:24<C&&C<=60?s-4:s-11;r.text(e.detallesVenta[m].producto.nombre,198,p,{width:130}),e.con_vencimiento&&(r.text(x,340,s),r.text(e.detallesVenta[m].lote,380,s)),r.text(e.detallesVenta[m].precio_unitario.toFixed(2),410,s),r.text(e.detallesVenta[m].total.toFixed(2),530,s),(a||o)&&"FORM_C_MAR"==e.configuracion.formatoPapel.nombre_corto&&r.rect(50,s-15,520,30).stroke()}else e.detallesVenta[m].servicio&&(e.detallesVenta[m].fecha_vencimiento=new Date(e.detallesVenta[m].fecha_vencimiento),x=e.detallesVenta[m].fecha_vencimiento.getDate()+"/"+(e.detallesVenta[m].fecha_vencimiento.getMonth()+1)+"/"+e.detallesVenta[m].fecha_vencimiento.getFullYear().toString().substring(2),r.text(e.detallesVenta[m].servicio.codigo,55,s,{width:70}),r.text(e.detallesVenta[m].cantidad,130,s),p=(C=e.detallesVenta[m].servicio.nombre.length)<=24?s:24<C&&C<=60?s-4:s-11,r.text(e.detallesVenta[m].servicio.nombre,198,p,{width:130}),e.con_vencimiento&&(r.text(x,340,s),r.text(e.detallesVenta[m].lote,380,s)),r.text(e.detallesVenta[m].importe.toFixed(2),450,s),r.text(e.detallesVenta[m].total.toFixed(2),530,s),(a||o)&&"FORM_C_MAR"==e.configuracion.formatoPapel.nombre_corto&&r.rect(50,s-15,520,30).stroke());s+=30,++u==l&&(r.addPage({size:t,margin:10}),s=240,u=0,D(r,o,a,e,t,d+=1,f,i))}(a||o)&&(r.font("Helvetica-Bold",8),r.text("TOTAL",485,s)),r.font("Helvetica",8),r.text(e.total.toFixed(2),530,s),r.text("SON : "+e.numero_literal,55,s),(a||o)&&r.rect(50,s-15,520,30).stroke();var g=new Date,_=g.getMinutes();_<10&&(_="0"+_),r.text("usuario : "+i.nombre_usuario,55,s+20),r.text("fecha : "+g.getDate()+"/"+(g.getMonth()+1)+"/"+g.getFullYear()+"  "+g.getHours()+":"+_,180,s+20)}else{var E=document.getElementById("qr-code"),A=I(e.detallesVenta);for(r.font("Helvetica",8),l=0,e.configuracion.tamanoPapelFactura.nombre_corto==h.FACT_PAPEL_OFICIO?l=19:e.configuracion.tamanoPapelFactura.nombre_corto==h.FACT_PAPEL_CARTA?l=16:e.configuracion.tamanoPapelFactura.nombre_corto==h.FACT_PAPEL_MEDIOOFICIO&&(l=3),void 0!==e.detallesVenta?e.detallesVenta:e.detallesProformas,s=240,u=0,d=1,f=Math.ceil(e.detallesVenta.length/l),T(r,o,a,e,t,d,f,i,h),m=0;m<e.detallesVenta.length&&u<=l;m++){if(r.font("Helvetica",8),e.detallesVenta[m].producto)A?(r.text(e.detallesVenta[m].producto.codigo,55,s),r.text(e.detallesVenta[m].cantidad,115,s),r.text(e.detallesVenta[m].producto.unidad_medida,140,s),r.text(e.detallesVenta[m].producto.nombre,180,s-6,{width:120}),r.text(e.detallesVenta[m].precio_unitario.toFixed(2),300,s),r.text(e.detallesVenta[m].importe.toFixed(2),335,s),r.text(e.detallesVenta[m].tipo_descuento?"%":"Bs",385,s-10),r.text(e.detallesVenta[m].descuento.toFixed(2),385,s),r.text(e.detallesVenta[m].tipo_recargo?"%":"Bs",420,s-10),r.text(e.detallesVenta[m].recargo.toFixed(2),420,s),r.text(e.detallesVenta[m].ice.toFixed(2),455,s),r.text(e.detallesVenta[m].excento.toFixed(2),490,s)):(r.text(e.detallesVenta[m].producto.codigo,55,s),r.text(e.detallesVenta[m].cantidad,110,s),r.text(e.detallesVenta[m].producto.unidad_medida,165,s),p=(C=e.detallesVenta[m].producto.nombre.length)<=45?s:45<C&&C<=90?s-4:s-11,r.text(e.detallesVenta[m].producto.nombre,220,p,{width:225}),r.text(e.detallesVenta[m].precio_unitario.toFixed(2),450,s)),r.text(e.detallesVenta[m].total.toFixed(2),520,s);else if(e.movimiento&&(e.movimientoServicio=e.movimiento.nombre_corto==h.EGRE_SERVICIO?e.movimiento:null),e.movimientoServicio)e.detallesVenta[m].fecha_vencimiento=new Date(e.detallesVenta[m].fecha_vencimiento),x=e.detallesVenta[m].fecha_vencimiento.getDate()+"/"+(e.detallesVenta[m].fecha_vencimiento.getMonth()+1)+"/"+e.detallesVenta[m].fecha_vencimiento.getFullYear().toString().substring(2),A?(p=(C=e.detallesVenta[m].observaciones.length)<=24?s:24<C&&C<=60?s-4:s-11,r.text(e.detallesVenta[m].observaciones,55,p,{width:300}),r.text(e.detallesVenta[m].importe.toFixed(2),335,s),r.text(e.detallesVenta[m].descuento.toFixed(2),385,s),r.text(e.detallesVenta[m].recargo.toFixed(2),420,s),r.text(e.detallesVenta[m].ice.toFixed(2),455,s),r.text(e.detallesVenta[m].excento.toFixed(2),490,s)):(p=(C=e.detallesVenta[m].observaciones.length)<=24?s:24<C&&C<=60?s-4:s-11,r.text(e.detallesVenta[m].observaciones,55,p,{width:400}),r.text(e.detallesVenta[m].importe.toFixed(2),450,s)),r.text(e.detallesVenta[m].total.toFixed(2),530,s),(a||o)&&"FORM_C_MAR"==e.configuracion.formatoPapel.nombre_corto&&r.rect(50,s-15,520,30).stroke();else if(A)r.text(e.detallesVenta[m].servicio.codigo,55,s),r.text(e.detallesVenta[m].cantidad,115,s),r.text(e.detallesVenta[m].observaciones,180,s-6,{width:120}),r.text(e.detallesVenta[m].precio_unitario.toFixed(2),300,s),r.text(e.detallesVenta[m].importe.toFixed(2),335,s),r.text(e.detallesVenta[m].total.toFixed(2),520,s);else{var C;r.text(e.detallesVenta[m].servicio.codigo,55,s),r.text(e.detallesVenta[m].cantidad,110,s),p=(C=e.detallesVenta[m].servicio.nombre.length)<=45?s:45<C&&C<=90?s-4:s-11,r.text(e.detallesVenta[m].observaciones,220,p,{width:225}),r.text(e.detallesVenta[m].precio_unitario.toFixed(2),450,s),r.text(e.detallesVenta[m].total.toFixed(2),520,s)}(a||o)&&"FORM_C_MAR"==e.configuracion.formatoPapel.nombre_corto&&r.rect(50,s-15,520,30).stroke(),s+=30,l<++u&&(r.addPage({size:t,margin:10}),s=240,u=0,T(r,o,a,e,t,d+=1,f,i,h))}(a||o)&&(r.font("Helvetica-Bold",8),r.text("TOTAL",455,s)),r.font("Helvetica",8),r.text(e.total.toFixed(2),520,s),r.text("SON : "+e.numero_literal,55,s),r.text("CÓDIGO DE CONTROL : "+e.codigo_control,55,s+30),e.fecha_limite_emision=new Date(e.fecha_limite_emision),r.text("FECHA LÍMITE DE EMISIÓN: "+e.fecha_limite_emision.getDate()+"/"+(e.fecha_limite_emision.getMonth()+1)+"/"+e.fecha_limite_emision.getFullYear(),55,s+60),(a||o)&&(r.rect(50,s-15,520,30).stroke(),r.rect(50,s+25,400,20).stroke(),r.rect(50,s+55,400,20).stroke()),qr.canvas({canvas:E,value:i.empresa.nit+"|"+e.factura+"|"+e.autorizacion+"|"+e.fechaTexto+"|"+e.total.toFixed(2)+"|"+e.total.toFixed(2)+"|"+e.codigo_control+"|"+e.cliente.nit+"|0|0|0|0"},function(){});var O=E.toDataURL("image/png");r.image(O,470,s+20,{width:70,height:70}),(a||o)&&(r.text(e.configuracion.nota,50,t[1]-80),r.text(void 0!==e.pieFactura&&null!==e.pieFactura?e.pieFactura.nombre:"",50,t[1]-60),r.text('"ESTA FACTURA CONTRIBUYE AL DESARROLLO DEL PAIS. EL USO ILICITO DE ESTA SERA SANCIONADO DE ACUERDO A LEY"',50,t[1]-40))}r.end(),c.on("finish",function(){var e=c.toBlobURL("application/pdf"),t=window.open(e,"_blank","location=no");b(function(){t.print()},500)}),v.stop()}}]).factory("DibujarCabeceraFacturaNVCartaOficio",[function(){return function(e,t,o,a,n,i,r,c){if(a.configuracion.usar_pf){if(t){100<c.empresa.imagen.length&&e.image(c.empresa.imagen,60,40,{fit:[65,65]}),e.font("Helvetica-Bold",8),e.text(c.empresa.razon_social.toUpperCase(),60,105),e.font("Helvetica",7),e.text(a.sucursal.nombre.toUpperCase(),60,113);var l=(u=a.sucursal.direccion.length)<=45?129:45<u&&u<=90?139:145;e.text(a.sucursal.direccion.toUpperCase(),60,121);var s=(null!=a.sucursal.telefono1?a.sucursal.telefono1:"")+(null!=a.sucursal.telefono2?"-"+a.sucursal.telefono2:"")+(null!=a.sucursal.telefono3?"-"+a.sucursal.telefono3:"");e.text("TELF.: "+s,60,l),e.text("COCHABAMBA - BOLIVIA",60,l+8)}e.font("Helvetica-Bold",16),e.text(a.configuracion.tituloFactura.nombre.toUpperCase(),250,90),e.font("Helvetica-Bold",8),(o||t)&&(e.rect(380,40,190,50).stroke(),e.text("NIT : ",400,50),e.text("Nota No : ",400,60)),e.text(c.empresa.nit,500,50),e.text(a.factura,500,60),(o||t)&&(e.rect(50,160,520,40).stroke(),e.text("FECHA : ",60,165),e.text("SEÑOR(ES) : ",60,175),e.text("NIT : ",360,165)),e.text(a.fecha_factura?a.fecha_factura:a.fechaTexto,120,165),e.text(a.cliente.razon_social,120,175),e.text(a.cliente.nit,400,165),(o||t)&&(e.rect(50,200,520,25).stroke(),e.text("CODIGO",55,210,{width:70}),e.text("CANT.",125,210),a.detallesVenta[0].producto&&e.text("UNIDAD",155,210),e.text("DETALLE",198,210),a.con_vencimiento&&(e.text("VENC.",340,210),e.text("LOTE",380,210)),a.detallesVenta[0].producto&&e.text("P.UNIT.",410,210),e.text("TOTAL",530,210)),e.font("Helvetica",7),e.text("PÁGINA "+i+" DE "+r,500,n[1]-60)}else{var u;if(t)100<c.empresa.imagen.length&&e.image(c.empresa.imagen,60,40,{fit:[65,65]}),e.font("Helvetica-Bold",8),e.text(c.empresa.razon_social.toUpperCase(),60,105),e.font("Helvetica",7),e.text(a.sucursal.nombre.toUpperCase(),60,113),l=(u=a.sucursal.direccion.length)<=45?129:45<u&&u<=90?139:145,e.text(a.sucursal.direccion.toUpperCase(),60,121),s=(null!=a.sucursal.telefono1?a.sucursal.telefono1:"")+(null!=a.sucursal.telefono2?"-"+a.sucursal.telefono2:"")+(null!=a.sucursal.telefono3?"-"+a.sucursal.telefono3:""),e.text("TELF.: "+s,60,l),e.text("COCHABAMBA - BOLIVIA",60,l+8);e.font("Helvetica-Bold",16),e.text(a.configuracion.tituloFactura.nombre.toUpperCase(),250,90),e.font("Helvetica-Bold",8),e.text(a.actividad.nombre,380,95,{width:200}),(o||t)&&(e.rect(380,40,190,50).stroke(),e.text("NIT : ",390,50),e.text("FACTURA No : ",390,60),e.text("AUTORIZACIÓN No : ",390,70)),e.text(c.empresa.nit,500,50),e.text(a.factura,500,60),e.text(a.autorizacion,500,70),(o||t)&&(e.rect(50,160,520,40).stroke(),e.text("FECHA : ",60,165),e.text("SEÑOR(ES) : ",60,175),e.text("NIT : ",360,165)),e.text(a.fecha_factura?a.fecha_factura:a.fechaTexto,120,165),e.text(a.cliente.razon_social,120,175),e.text(a.cliente.nit,400,165),(o||t)&&(e.rect(50,200,520,25).stroke(),e.text("CODIGO",55,210,{width:70}),e.text("CANT.",125,210),a.detallesVenta[0].producto&&e.text("UNIDAD",155,210),e.text("DETALLE",198,210),a.con_vencimiento&&(e.text("VENC.",340,210),e.text("LOTE",380,210)),a.detallesVenta[0].producto&&e.text("P.UNIT.",410,210),e.text("IMP.",450,210),a.detallesVenta[0].producto&&e.text("DESC.",490,210),e.text("TOTAL",530,210)),e.font("Helvetica",7),e.text("PÁGINA "+i+" DE "+r,500,n[1]-60)}}}]).factory("ImprimirFacturaCartaOficioSinFormato",["blockUI","VerificarDescuentos","Diccionario","DibujarCabeceraFacturaNVCartaOficioSinFormato","DibujarCabeceraFacturaNVmedioOficio","$timeout",function(v,I,h,D,T,b){return function(e,t,o,a,n,i){var r=new PDFDocument({compress:!1,size:t,margin:10}),c=r.pipe(blobStream());if(e.configuracion.usar_pf){var l=0;e.configuracion.tamanoPapelFactura.nombre_corto==h.FACT_PAPEL_OFICIO?l=19:e.configuracion.tamanoPapelFactura.nombre_corto==h.FACT_PAPEL_CARTA?l=32:e.configuracion.tamanoPapelFactura.nombre_corto==h.FACT_PAPEL_MEDIOOFICIO&&(l=3);var s=240,u=0,d=1,f=Math.ceil(e.detallesVenta.length/l);D(r,o,a,e,t,d,f,i);for(var m=0;m<e.detallesVenta.length&&u<=l;m++){if(r.font("Helvetica",8),e.detallesVenta[m].producto){e.detallesVenta[m].fecha_vencimiento=new Date(e.detallesVenta[m].fecha_vencimiento);var x=e.detallesVenta[m].fecha_vencimiento.getDate()+"/"+(e.detallesVenta[m].fecha_vencimiento.getMonth()+1)+"/"+e.detallesVenta[m].fecha_vencimiento.getFullYear().toString().substring(2);r.text(e.detallesVenta[m].producto.codigo,55,s,{width:70}),r.text(e.detallesVenta[m].cantidad,135,s),r.text(e.detallesVenta[m].producto.unidad_medida,180,s-3,{width:43});var p=(C=e.detallesVenta[m].producto.nombre.length)<=27?s:27<C&&C<=63?s-4:s-11;r.text(e.detallesVenta[m].producto.nombre,240,p,{width:250}),e.con_vencimiento&&(r.text(x,340,s),r.text(e.detallesVenta[m].lote,380,s)),r.text(e.detallesVenta[m].precio_unitario.toFixed(2),505,s),r.text(e.detallesVenta[m].total.toFixed(2),560,s)}else e.detallesVenta[m].fecha_vencimiento=new Date(e.detallesVenta[m].fecha_vencimiento),x=e.detallesVenta[m].fecha_vencimiento.getDate()+"/"+(e.detallesVenta[m].fecha_vencimiento.getMonth()+1)+"/"+e.detallesVenta[m].fecha_vencimiento.getFullYear().toString().substring(2),r.text(e.detallesVenta[m].servicio.codigo,55,s,{width:70}),r.text(e.detallesVenta[m].cantidad,130,s),p=(C=e.detallesVenta[m].observaciones.length)<=24?s:24<C&&C<=60?s-4:s-11,r.text(e.detallesVenta[m].observaciones,198,p,{width:130}),e.con_vencimiento&&(r.text(x,340,s),r.text(e.detallesVenta[m].lote,380,s)),r.text(e.detallesVenta[m].importe.toFixed(2),450,s),r.text(e.detallesVenta[m].total.toFixed(2),580,s);s+=15,++u==l&&(r.addPage({size:t,margin:10}),s=240,u=0,D(r,o,a,e,t,d+=1,f,i))}(a||o)&&(r.font("Helvetica-Bold",8),r.text("TOTAL",500,s)),r.font("Helvetica",8),r.text(e.total.toFixed(2),560,s),r.text("SON : "+e.numero_literal,55,s),(a||o)&&r.rect(50,s-5,545,15).stroke();var g=new Date,_=g.getMinutes();_<10&&(_="0"+_),r.text("usuario : "+i.nombre_usuario,55,s+20),r.text("fecha : "+g.getDate()+"/"+(g.getMonth()+1)+"/"+g.getFullYear()+"  "+g.getHours()+":"+_,180,s+20)}else{var E=document.getElementById("qr-code"),A=I(e.detallesVenta);for(r.font("Helvetica",8),l=0,e.configuracion.tamanoPapelFactura.nombre_corto==h.FACT_PAPEL_OFICIO?l=19:e.configuracion.tamanoPapelFactura.nombre_corto==h.FACT_PAPEL_CARTA?l=32:e.configuracion.tamanoPapelFactura.nombre_corto==h.FACT_PAPEL_MEDIOOFICIO&&(l=3),void 0!==e.detallesVenta?e.detallesVenta:e.detallesProformas,s=240,u=0,d=1,f=Math.ceil(e.detallesVenta.length/l),T(r,o,a,e,t,d,f,i,h),m=0;m<e.detallesVenta.length&&u<=l;m++){if(r.font("Helvetica",8),e.detallesVenta[m].producto)A?(r.text(e.detallesVenta[m].producto.codigo,55,s),r.text(e.detallesVenta[m].cantidad,115,s),r.text(e.detallesVenta[m].producto.unidad_medida,140,s),r.text(e.detallesVenta[m].producto.nombre,180,s-6,{width:120}),r.text(e.detallesVenta[m].precio_unitario.toFixed(2),300,s),r.text(e.detallesVenta[m].importe.toFixed(2),335,s),r.text(e.detallesVenta[m].tipo_descuento?"%":"Bs",385,s-10),r.text(e.detallesVenta[m].descuento.toFixed(2),385,s),r.text(e.detallesVenta[m].tipo_recargo?"%":"Bs",420,s-10),r.text(e.detallesVenta[m].recargo.toFixed(2),420,s),r.text(e.detallesVenta[m].ice.toFixed(2),455,s),r.text(e.detallesVenta[m].excento.toFixed(2),490,s)):(r.text(e.detallesVenta[m].producto.codigo,55,s),r.text(e.detallesVenta[m].cantidad,110,s),r.text(e.detallesVenta[m].producto.unidad_medida,165,s),p=(C=e.detallesVenta[m].producto.nombre.length)<=45?s:45<C&&C<=90?s-4:s-11,r.text(e.detallesVenta[m].producto.nombre,220,p,{width:225}),r.text(e.detallesVenta[m].precio_unitario.toFixed(2),450,s)),r.text(e.detallesVenta[m].total.toFixed(2),520,s);else if(e.movimiento&&(e.movimientoServicio=e.movimiento.nombre_corto==h.EGRE_SERVICIO?e.movimiento:null),e.movimientoServicio)e.detallesVenta[m].fecha_vencimiento=new Date(e.detallesVenta[m].fecha_vencimiento),x=e.detallesVenta[m].fecha_vencimiento.getDate()+"/"+(e.detallesVenta[m].fecha_vencimiento.getMonth()+1)+"/"+e.detallesVenta[m].fecha_vencimiento.getFullYear().toString().substring(2),A?(p=(C=e.detallesVenta[m].observaciones.length)<=24?s:24<C&&C<=60?s-4:s-11,r.text(e.detallesVenta[m].observaciones,55,p,{width:300}),r.text(e.detallesVenta[m].importe.toFixed(2),335,s),r.text(e.detallesVenta[m].descuento.toFixed(2),385,s),r.text(e.detallesVenta[m].recargo.toFixed(2),420,s),r.text(e.detallesVenta[m].ice.toFixed(2),455,s),r.text(e.detallesVenta[m].excento.toFixed(2),490,s)):(p=(C=e.detallesVenta[m].observaciones.length)<=24?s:24<C&&C<=60?s-4:s-11,r.text(e.detallesVenta[m].observaciones,55,p,{width:400}),r.text(e.detallesVenta[m].importe.toFixed(2),450,s)),r.text(e.detallesVenta[m].total.toFixed(2),530,s),(a||o)&&r.rect(50,s-15,520,30).stroke();else if(A)r.text(e.detallesVenta[m].servicio.codigo,55,s),r.text(e.detallesVenta[m].cantidad,115,s),r.text(e.detallesVenta[m].observaciones,180,s-6,{width:120}),r.text(e.detallesVenta[m].precio_unitario.toFixed(2),300,s),r.text(e.detallesVenta[m].importe.toFixed(2),335,s),r.text(e.detallesVenta[m].total.toFixed(2),520,s);else{var C;r.text(e.detallesVenta[m].servicio.codigo,55,s),r.text(e.detallesVenta[m].cantidad,110,s),p=(C=e.detallesVenta[m].observaciones.length)<=45?s:45<C&&C<=90?s-4:s-11,r.text(e.detallesVenta[m].observaciones,220,p,{width:225}),r.text(e.detallesVenta[m].precio_unitario.toFixed(2),450,s),r.text(e.detallesVenta[m].total.toFixed(2),520,s)}(a||o)&&r.rect(50,s-15,520,30).stroke(),s+=30,l<++u&&(r.addPage({size:t,margin:10}),s=240,u=0,T(r,o,a,e,t,d+=1,f,i,h))}(a||o)&&(r.font("Helvetica-Bold",8),r.text("TOTAL",455,s)),r.font("Helvetica",8),r.text(e.total.toFixed(2),520,s),r.text("SON : "+e.numero_literal,55,s),r.text("CÓDIGO DE CONTROL : "+e.codigo_control,55,s+30),e.fecha_limite_emision=new Date(e.fecha_limite_emision),r.text("FECHA LÍMITE DE EMISIÓN: "+e.fecha_limite_emision.getDate()+"/"+(e.fecha_limite_emision.getMonth()+1)+"/"+e.fecha_limite_emision.getFullYear(),55,s+60),(a||o)&&(r.rect(50,s-15,520,30).stroke(),r.rect(50,s+25,400,20).stroke(),r.rect(50,s+55,400,20).stroke()),qr.canvas({canvas:E,value:i.empresa.nit+"|"+e.factura+"|"+e.autorizacion+"|"+e.fechaTexto+"|"+e.total.toFixed(2)+"|"+e.total.toFixed(2)+"|"+e.codigo_control+"|"+e.cliente.nit+"|0|0|0|0"},function(){});var O=E.toDataURL("image/png");r.image(O,470,s+20,{width:70,height:70}),(a||o)&&(r.text(void 0!==e.pieFactura&&null!==e.pieFactura?e.pieFactura.nombre:"",50,t[1]-60),r.text('"ESTA FACTURA CONTRIBUYE AL DESARROLLO DEL PAIS. EL USO ILICITO DE ESTA SERA SANCIONADO DE ACUERDO A LEY"',50,t[1]-40))}r.end(),c.on("finish",function(){var e=c.toBlobURL("application/pdf"),t=window.open(e,"_blank","location=no");b(function(){t.print()},500)}),v.stop()}}]).factory("DibujarCabeceraFacturaNVCartaOficioSinFormato",[function(){return function(e,t,o,a,n,i,r,c){if(a.configuracion.usar_pf){if(t){100<c.empresa.imagen.length&&e.image(c.empresa.imagen,60,40,{fit:[65,65]}),e.font("Helvetica-Bold",8),e.text(c.empresa.razon_social.toUpperCase(),60,105),e.font("Helvetica",7),e.text(a.sucursal.nombre.toUpperCase(),60,113);var l=(u=a.sucursal.direccion.length)<=45?129:45<u&&u<=90?139:145;e.text(a.sucursal.direccion.toUpperCase(),60,120,{width:150});var s=(null!=a.sucursal.telefono1?a.sucursal.telefono1:"")+(null!=a.sucursal.telefono2?"-"+a.sucursal.telefono2:"")+(null!=a.sucursal.telefono3?"-"+a.sucursal.telefono3:"");e.text("TELF.: "+s,60,l),l+=11,e.font("Helvetica-Bold").text("COCHABAMBA - BOLIVIA",60,l)}e.font("Helvetica-Bold",16),e.text(a.configuracion.tituloFactura.nombre.toUpperCase(),250,90),e.font("Helvetica-Bold",10),(o||t)&&(e.text("NIT : ",410,50),e.text("Nota No : ",410,60)),e.text(c.empresa.nit,500,50),e.font("Helvetica-Bold",13),e.text(a.factura,500,60),e.font("Helvetica-Bold",10),(o||t)&&(e.text("FECHA : ",60,165),e.text("SEÑOR(ES) : ",60,175),e.text("NIT : ",470,165)),e.text(a.fecha_factura?a.fecha_factura:a.fechaTexto,120,165),e.text(a.cliente.razon_social,130,175),e.text(a.cliente.nit,530,165),(o||t)&&(e.rect(50,200,545,25).stroke(),e.text("CODIGO",55,210,{width:70}),e.text("CANT.",125,210),a.detallesVenta[0].producto&&e.text("UNIDAD",175,210),e.text("DETALLE",250,210),a.con_vencimiento&&(e.text("VENC.",340,210),e.text("LOTE",380,210)),a.detallesVenta[0].producto&&e.text("P.UNIT.",500,210),e.text("TOTAL",555,210)),e.font("Helvetica",7),e.text("PÁGINA "+i+" DE "+r,500,n[1]-60)}else{var u;if(t)100<c.empresa.imagen.length&&e.image(c.empresa.imagen,60,40,{fit:[65,65]}),e.font("Helvetica-Bold",8),e.text(c.empresa.razon_social.toUpperCase(),60,105),e.font("Helvetica",7),e.text(a.sucursal.nombre.toUpperCase(),60,113),l=(u=a.sucursal.direccion.length)<=45?129:45<u&&u<=90?139:145,e.text(a.sucursal.direccion.toUpperCase(),60,120,{width:150}),s=(null!=a.sucursal.telefono1?a.sucursal.telefono1:"")+(null!=a.sucursal.telefono2?"-"+a.sucursal.telefono2:"")+(null!=a.sucursal.telefono3?"-"+a.sucursal.telefono3:""),e.text("TELF.: "+s,60,l),l+=11,e.font("Helvetica-Bold").text("COCHABAMBA - BOLIVIA",60,l);e.font("Helvetica-Bold",16),e.text(a.configuracion.tituloFactura.nombre.toUpperCase(),250,90),e.font("Helvetica-Bold",8),e.text(a.actividad.nombre,380,95,{width:200}),(o||t)&&(e.text("NIT : ",390,50),e.text("FACTURA No : ",390,60),e.text("AUTORIZACIÓN No : ",390,70)),e.text(c.empresa.nit,500,50),e.text(a.factura,500,60),e.text(a.autorizacion,500,70),(o||t)&&(e.text("FECHA : ",60,165),e.text("SEÑOR(ES) : ",60,175),e.text("NIT : ",360,165)),e.text(a.fecha_factura?a.fecha_factura:a.fechaTexto,120,165),e.text(a.cliente.razon_social,130,175),e.text(a.cliente.nit,410,165),(o||t)&&(e.text("CODIGO",55,210,{width:70}),e.text("CANT.",125,210),a.detallesVenta[0].producto&&e.text("UNIDAD",155,210),e.text("DETALLE",198,210),a.con_vencimiento&&(e.text("VENC.",340,210),e.text("LOTE",380,210)),a.detallesVenta[0].producto&&e.text("P.UNIT.",410,210),e.text("TOTAL",530,210)),e.font("Helvetica",7),e.text("PÁGINA "+i+" DE "+r,500,n[1]-60)}}}]).factory("DibujarCabeceraFacturaNVmedioOficio",["VerificarDescuentos",function(g){return function(e,t,o,a,n,i,r,c,l){if(a.configuracion.usar_pf){if(t){100<c.empresa.imagen.length&&e.image(c.empresa.imagen,60,40,{fit:[70,70]}),e.font("Helvetica-Bold",8);var s=(m=c.empresa.razon_social.length+30)<=35?105:36<m&&m<=72?95:85;e.text(c.empresa.razon_social.toUpperCase(),60,s,{width:170}),e.font("Helvetica",7),e.text(a.sucursal.nombre.toUpperCase(),60,113),s=(m=a.sucursal.direccion.length)<=45?129:45<m&&m<=90?139:145,e.text(a.sucursal.direccion.toUpperCase(),60,121,{width:200});var u=(null!=a.sucursal.telefono1?a.sucursal.telefono1:"")+(null!=a.sucursal.telefono2?"-"+a.sucursal.telefono2:"")+(null!=a.sucursal.telefono3?"-"+a.sucursal.telefono3:"");e.text("TELF.: "+u,60,s),e.text("COCHABAMBA - BOLIVIA",60,s+6)}e.font("Helvetica-Bold",16),e.text(a.configuracion.tituloFactura.nombre.toUpperCase(),250,100),e.font("Helvetica-Bold",8),(o||t)&&("FORM_C_MAR"==a.configuracion.formatoPapel.nombre_corto&&e.rect(380,40,190,50).stroke(),e.text("NIT : ",390,50),e.text("NOTA No : ",390,60)),e.text(c.empresa.nit,500,50),e.text(a.factura,500,60),e.text(a.autorizacion,500,70),(o||t)&&(e.rect(50,160,520,40).stroke(),e.text("FECHA : ",60,165),e.text("SEÑOR(ES) : ",60,175),e.text("NIT : ",360,165)),e.text(a.fecha_factura?a.fecha_factura:a.fechaTexto,120,165),e.text(a.cliente.razon_social,120,175),e.text(a.cliente.nit,400,165),(o||t)&&(e.rect(50,200,520,25).stroke(),(p=g(a.detallesVenta))?(e.text("CODIGO",55,210),e.text("CANT.",110,210),e.text("DETALLE",160,210),e.text("P. UNIT.",300,210),e.text("IMPORTE",335,210),a.detallesVenta[0].producto&&(e.text("UNID.",140,210),e.text("DESC.",385,210),e.text("REC.",420,210),e.text("ICE",455,210),e.text("EXC.",490,210))):(e.text("CODIGO",55,210),e.text("CANTIDAD",110,210),a.detallesVenta[0].producto&&e.text("UNIDAD",165,210),e.text("DETALLE",220,210),e.text("P.UNIT.",450,210)),e.text("TOTAL",520,210))}else{if(t){var d=80;100<c.empresa.imagen.length&&(e.image(c.empresa.imagen,60,40,{fit:[65,65]}),d=c.altura_imagen);var f=d<=1.95?d+85:105;e.font("Helvetica-Bold",8),s=(m=c.empresa.razon_social.length)<=35?f+11:f+20,e.text(c.empresa.razon_social.toUpperCase(),60,f,{width:170}),e.font("Helvetica",7),e.text(a.sucursal.nombre.toUpperCase(),60,s);var m,x=(m=a.sucursal.direccion.length)<=35?s+9:s+18;e.text(a.sucursal.direccion.toUpperCase(),60,s+9,{width:200}),u=(null!=a.sucursal.telefono1?a.sucursal.telefono1:"")+(null!=a.sucursal.telefono2?"-"+a.sucursal.telefono2:"")+(null!=a.sucursal.telefono3?"-"+a.sucursal.telefono3:""),e.text("TELF.: "+u,60,x+9),e.text("COCHABAMBA - BOLIVIA",60,x+18)}if(e.font("Helvetica-Bold",16),e.text(a.configuracion.tituloFactura.nombre.toUpperCase(),250,100),e.font("Helvetica-Bold",8),e.text(a.actividad.nombre,380,105,{width:200}),(o||t)&&("FORM_C_MAR"==a.configuracion.formatoPapel.nombre_corto&&("FORM_S_COL"==a.configuracion.formatoColor.nombre_corto?e.rect(380,40,190,50).stroke():e.rect(380,40,190,50).fillAndStroke(a.configuracion.color1,"black").fillColor("black").stroke()),e.text("NIT : ",390,50),e.text("FACTURA No : ",390,60),e.text("AUTORIZACIÓN No : ",390,70)),e.text(c.empresa.nit,500,50),e.text(a.factura,500,60),e.text(a.autorizacion,500,70),(o||t)&&("FORM_S_COL"==a.configuracion.formatoColor.nombre_corto?e.rect(50,160,520,40).stroke():e.rect(50,160,520,40).fillAndStroke(a.configuracion.color1,"black").fillColor("black").stroke(),e.text("FECHA : ",60,165),e.text("SEÑOR(ES) : ",60,175),e.text("NIT : ",360,165)),e.text(a.fecha_factura?a.fecha_factura:a.fechaTexto,120,165),e.text(a.cliente.razon_social,120,175),e.text(a.cliente.nit,400,165),o||t){"FORM_S_COL"==a.configuracion.formatoColor.nombre_corto?e.rect(50,200,520,25).stroke():e.rect(50,200,520,25).fillAndStroke(a.configuracion.color2,"black").fillColor("white").stroke();var p=g(a.detallesVenta);a.movimiento&&(a.movimientoServicio=a.movimiento.nombre_corto==l.EGRE_SERVICIO?a.movimiento:null),a.movimientoServicio?p?(e.text("DETALLE",55,210),e.text("IMPORTE",335,210),e.text("DESC.",385,210),e.text("REC.",420,210),e.text("ICE",455,210),e.text("EXC.",490,210)):(e.text("DETALLE",55,210),e.text("IMPORTE",450,210)):p?(e.text("CODIGO",55,210),e.text("CANT.",110,210),e.text("DETALLE",160,210),e.text("P. UNIT.",300,210),e.text("IMPORTE",335,210),a.detallesVenta[0].producto&&(e.text("UNID.",140,210),e.text("DESC.",385,210),e.text("REC.",420,210),e.text("ICE",455,210),e.text("EXC.",490,210))):(e.text("CODIGO",55,210),e.text("CANTIDAD",110,210),a.detallesVenta[0].producto&&e.text("UNIDAD",165,210),e.text("DETALLE",220,210),e.text("P.UNIT.",450,210)),e.text("TOTAL",520,210),e.fillColor("black")}}}}]).factory("ImprimirPedido",[function(){return function(e,t,o,a,n,i,r){for(var c=0;c<e.sucursal.copias_impresion_pedido;c++){0!=c&&o.addPage({size:[227,n],margins:{top:10,bottom:10,left:20,right:20}}),o.font("Helvetica-Bold",12),r&&o.text("PARA LLEVAR¡¡¡",{align:"center"}),o.font("Helvetica-Bold",14),o.text("Nro. Pedido : "+e.pedido,{align:"left"}),o.font("Helvetica",12),o.text(e.sucursal.frase_pedido+" : "+e.factura,{align:"left"}),o.moveDown(.4),o.text("Cliente : "+e.cliente.razon_social,{align:"left"}),o.moveDown(.4),o.text("NIT/CI : "+e.cliente.nit,{align:"left"}),o.moveDown(.4),o.text("Total Transacción : "+e.total.toFixed(2),{align:"left"}),o.moveDown(.2),o.text("---------------------------------------------",{align:"center"}),o.moveDown(.2),o.text("Cant.   Producto         Subtotal",{align:"left"}),o.moveDown(.2),o.text("---------------------------------------------",{align:"center"}),o.moveDown(.4);var l=o.y;o.fontSize(10);for(var s=0;s<e.detallesVenta.length;s++)o.text(e.detallesVenta[s].cantidad,20,l),e.detallesVenta[s].producto?(40<e.detallesVenta[s].producto.nombre.length&&o.fontSize(9),o.text(e.detallesVenta[s].producto.nombre,50,l,{width:90}),o.text(e.detallesVenta[s].total.toFixed(2),150,l)):(40<e.detallesVenta[s].servicio.nombre.length&&o.fontSize(9),o.text(e.detallesVenta[s].servicio.nombre,50,l,{width:90}),o.text(e.detallesVenta[s].total?e.detallesVenta[s].total.toFixed(2):e.detallesVenta[s].importe.toFixed(2),150,l)),o.fontSize(10),l+=20;o.moveDown(4),o.x=0;var u=new Date,d=u.getMinutes();d<10&&(d="0"+d),o.text(" Fecha : "+u.getDate()+"/"+(u.getMonth()+1)+"/"+u.getFullYear()+"  "+u.getHours()+":"+d+"  ",{align:"center"})}if(e.sucursal.imprimir_pedido_corto){for(o.addPage({size:[227,n],margins:{top:10,bottom:10,left:20,right:20}}),o.font("Helvetica-Bold",12),r&&o.text("PARA LLEVAR¡¡¡",{align:"center"}),o.font("Helvetica-Bold",14),o.text(i.empresa.razon_social,{align:"left"}),o.x,l=o.y,o.text("Nro. Pedido : ",20,l,{align:"left"}),o.font("Helvetica-Bold",22),o.text(e.pedido,120,l-5),o.font("Helvetica",12),o.x=20,l=o.y,o.text("Cant.   Producto         Subtotal",{align:"left"}),l=o.y,o.fontSize(10),s=0;s<e.detallesVenta.length;s++)o.text(e.detallesVenta[s].cantidad,20,l),e.detallesVenta[s].producto?(40<e.detallesVenta[s].producto.nombre.length&&o.fontSize(9),o.text(e.detallesVenta[s].producto.nombre,50,l,{width:90}),o.text(e.detallesVenta[s].total.toFixed(2),150,l)):(40<e.detallesVenta[s].servicio.nombre.length&&o.fontSize(9),o.text(e.detallesVenta[s].servicio.nombre,50,l,{width:90}),o.text(e.detallesVenta[s].total?e.detallesVenta[s].total.toFixed(2):e.detallesVenta[s].importe.toFixed(2),150,l)),o.fontSize(10),l+=20;o.moveDown(4),o.x=0,o.text("Gracias por su preferencia",{align:"center"})}}}]).factory("ImprimirFacturaRollo",["blockUI",function(g){return function(e,t,o,a,n){if(e.configuracion.usar_pf){var i=document.getElementById("qr-code");o.moveDown(2),o.font("Helvetica-Bold",8),o.text(n.empresa.razon_social.toUpperCase(),{align:"center"}),o.moveDown(.4),o.font("Helvetica",7),o.text(e.sucursal.nombre.toUpperCase(),{align:"center"}),o.moveDown(.4),o.text(e.sucursal.direccion.toUpperCase(),{align:"center"}),o.moveDown(.4);var r=(null!=e.sucursal.telefono1?e.sucursal.telefono1:"")+(null!=e.sucursal.telefono2?"-"+e.sucursal.telefono2:"")+(null!=e.sucursal.telefono3?"-"+e.sucursal.textlefono3:"");o.text("TELF.: "+r,{align:"center"}),o.moveDown(.4),o.text("COCHABAMBA - BOLIVIA",{align:"center"}),o.moveDown(.5),o.font("Helvetica-Bold",8),o.text("PROFORMA NV",{align:"center"}),o.font("Helvetica",7),o.moveDown(.4),o.text("------------------------------------",{align:"center"}),o.moveDown(.4),o.text("Nro.  "+e.factura,{align:"center"}),o.moveDown(.4),o.text("------------------------------------",{align:"center"}),o.moveDown(.4),o.text(e.tipoPago.nombre_corto,{align:"center"}),o.moveDown(.4),o.text("------------------------------------",{align:"center"}),o.moveDown(.6),o.text("FECHA : "+e.fechaTexto,{align:"left"}),o.moveDown(.4),o.text("SEÑOR(ES) : "+e.cliente.razon_social,{align:"left"}),o.moveDown(.4),o.text("NIT/CI : "+e.cliente.nit,{align:"left"}),o.moveDown(.4),o.text("---------------------------------------------------------------------------------",{align:"center"}),o.moveDown(.2),o.text("CANT   CONCEPTO                                   P. UNIT.    SUBTOTAL",{align:"left"}),o.moveDown(.2),o.text("---------------------------------------------------------------------------------",{align:"center"}),o.moveDown(.4);for(var c=o.y,l=0,s=0,u=0,d=0,f=0;f<e.detallesVenta.length;f++)o.text(e.detallesVenta[f].cantidad,15,c),e.detallesVenta[f].producto?(40<e.detallesVenta[f].producto.nombre.length&&o.fontSize(6),o.text(e.detallesVenta[f].producto.nombre,35,c,{width:100})):(40<e.detallesVenta[f].servicio.nombre.length&&o.fontSize(6),o.text(e.detallesVenta[f].servicio.nombre,35,c,{width:100})),o.fontSize(7),o.text(e.detallesVenta[f].precio_unitario.toFixed(2),145,c),o.text(e.detallesVenta[f].importe.toFixed(2),180,c),l+=e.detallesVenta[f].tipo_descuento?e.detallesVenta[f].importe*(e.detallesVenta[f].descuento/100):e.detallesVenta[f].descuento,s+=e.detallesVenta[f].tipo_recargo?e.detallesVenta[f].importe*(e.detallesVenta[f].recargo/100):e.detallesVenta[f].recargo,u+=e.detallesVenta[f].ice,d+=e.detallesVenta[f].excento,c+=20;o.text("--------------",10,c,{align:"right"}),o.moveDown(.4),o.text("IMPORTE TOTAL Bs.              "+e.importe.toFixed(2),{align:"right"}),o.moveDown(.3),0<l&&o.text("DESCUENTO Bs.              "+l.toFixed(2),{align:"right"}),o.moveDown(.3),0<s&&o.text("RECARGO Bs.              "+s.toFixed(2),{align:"right"}),o.moveDown(.3),0<u&&o.text("ICE Bs.              "+u.toFixed(2),{align:"right"}),o.moveDown(.3),0<d&&o.text("EXCENTO Bs.              "+d.toFixed(2),{align:"right"}),o.moveDown(.3),o.text("TOTAL Bs.              "+e.total.toFixed(2),{align:"right"}),o.moveDown(.4),o.moveDown(.4),o.text("SON: "+e.numero_literal,{align:"left"}),o.moveDown(.6),(x=(m=new Date).getMinutes())<10&&(x="0"+x),o.text("usuario : "+n.nombre_usuario,0,c+205,{align:"right"}),o.moveDown(.4),o.text("fecha : "+m.getDate()+"/"+(m.getMonth()+1)+"/"+m.getFullYear()+"  "+m.getHours()+":"+x,10,c+215,{align:"right"})}else{for(i=document.getElementById("qr-code"),o.moveDown(1),100<n.empresa.imagen.length&&o.image(n.empresa.imagen,75,o.y,{align:"center",fit:[75,75]}),o.y=40,o.moveDown(2),o.font("Helvetica-Bold",8),o.text(n.empresa.razon_social.toUpperCase(),35,o.y,{align:"center",width:150}),o.moveDown(.4),o.font("Helvetica",7),o.text(e.sucursal.nombre.toUpperCase(),{align:"center"}),o.moveDown(.4),o.text(e.sucursal.direccion.toUpperCase(),{align:"center"}),o.moveDown(.4),r=(null!=e.sucursal.telefono1?e.sucursal.telefono1:"")+(null!=e.sucursal.telefono2?"-"+e.sucursal.telefono2:"")+(null!=e.sucursal.telefono3?"-"+e.sucursal.telefono3:""),o.text("TELF.: "+r,{align:"center"}),o.moveDown(.4),o.text("COCHABAMBA - BOLIVIA",{align:"center"}),o.moveDown(.5),o.font("Helvetica-Bold",8),o.text(e.configuracion.tituloFactura.nombre.toUpperCase(),{align:"center"}),o.font("Helvetica",7),o.moveDown(.4),o.text("------------------------------------",{align:"center"}),o.moveDown(.4),o.text("NIT: "+n.empresa.nit,{align:"center"}),o.moveDown(.4),o.text("FACTURA No: "+e.factura,{align:"center"}),o.moveDown(.4),o.text("AUTORIZACIÓN No: "+e.autorizacion,{align:"center"}),o.moveDown(.4),o.text("------------------------------------",{align:"center"}),o.moveDown(.4),o.text(e.actividad.nombre,{align:"center",width:150}),o.x=20,o.moveDown(.6),o.text("FECHA : "+e.fechaTexto,{align:"left"}),o.moveDown(.4),o.text("SEÑOR(ES) : "+e.cliente.razon_social,{align:"left"}),o.moveDown(.4),o.text("NIT/CI : "+e.cliente.nit,{align:"left"}),o.moveDown(.4),o.text("--------------------------------------------------------------------------------",{align:"center"}),o.moveDown(.2),o.text("CANT   CONCEPTO                    P. UNIT.    SUBTOTAL",{align:"left"}),o.moveDown(.2),o.text("--------------------------------------------------------------------------------",{align:"center"}),o.moveDown(.4),c=o.y,f=d=u=s=l=0;f<e.detallesVenta.length;f++)o.text(e.detallesVenta[f].cantidad,20,c),e.detallesVenta[f].producto?(40<e.detallesVenta[f].producto.nombre.length&&o.fontSize(6),o.text(e.detallesVenta[f].producto.nombre,40,c,{width:100}),o.fontSize(7),o.text(e.detallesVenta[f].precio_unitario.toFixed(2),150,c),o.text(e.detallesVenta[f].importe.toFixed(2),175,c),l+=e.detallesVenta[f].tipo_descuento?e.detallesVenta[f].importe*(e.detallesVenta[f].descuento/100):e.detallesVenta[f].descuento,s+=e.detallesVenta[f].tipo_recargo?e.detallesVenta[f].importe*(e.detallesVenta[f].recargo/100):e.detallesVenta[f].recargo,u+=e.detallesVenta[f].ice,d+=e.detallesVenta[f].excento):(40<e.detallesVenta[f].servicio.nombre.length&&o.fontSize(6),o.text(e.detallesVenta[f].servicio.nombre,40,c,{width:100}),o.fontSize(7),o.text(e.detallesVenta[f].precio_unitario.toFixed(2),150,c),o.text(e.detallesVenta[f].importe.toFixed(2),175,c)),c+=20;o.x=20,o.text("--------------",{align:"right"}),o.moveDown(.4),o.text("IMPORTE TOTAL Bs.         "+e.importe.toFixed(2),90,o.y),o.moveDown(.3),0<l&&o.text("DESCUENTO Bs.              "+l.toFixed(2),97,o.y),o.moveDown(.3),0<s&&o.text("RECARGO Bs.              "+s.toFixed(2),105,o.y),o.moveDown(.3),0<u&&o.text("ICE Bs.              "+u.toFixed(2),128,o.y),o.moveDown(.3),0<d&&o.text("EXCENTO Bs.              "+d.toFixed(2),107,o.y),o.moveDown(.3),o.text("TOTAL Bs.         "+e.total.toFixed(2),124,o.y),o.x=20,o.moveDown(.4),o.moveDown(.4),o.text("SON: "+e.numero_literal,{align:"left"}),o.moveDown(.6),o.text("CÓDIGO DE CONTROL: "+e.codigo_control,{align:"center"}),o.moveDown(.4),e.fecha_limite_emision=new Date(e.fecha_limite_emision),o.text("FECHA LÍMITE DE EMISIÓN: "+e.fecha_limite_emision.getDate()+"/"+(e.fecha_limite_emision.getMonth()+1)+"/"+e.fecha_limite_emision.getFullYear(),{align:"center"}),o.moveDown(.4),qr.canvas({canvas:i,value:n.empresa.nit+"|"+e.factura+"|"+e.autorizacion+"|"+e.fechaTexto+"|"+e.total.toFixed(2)+"|"+e.total.toFixed(2)+"|"+e.codigo_control+"|"+e.cliente.nit+"|0|0|0|0"},function(){});var m,x,p=i.toDataURL("image/png");o.image(p,70,o.y,{width:85,height:85}),o.moveDown(.4),o.text(e.pieFactura?e.pieFactura.nombre:"",{align:"center",width:150}),o.moveDown(.6),o.text('"ESTA FACTURA CONTRIBUYE AL DESARROLLO DEL PAIS. EL USO ILICITO DE ESTA SERA SANCIONADO DE ACUERDO A LEY"',{align:"center",width:150}),o.moveDown(.4),(x=(m=new Date).getMinutes())<10&&(x="0"+x),o.text("  Usuario : "+n.nombre_usuario+" -- Fecha : "+m.getDate()+"/"+(m.getMonth()+1)+"/"+m.getFullYear()+"  "+m.getHours()+":"+x+"  ",{align:"center"})}g.stop()}}]).factory("ImprimirProforma",["Diccionario","ImprimirProformaCartaOficio","ImprimirPedido","ImprimirProformaRollo","$timeout",function(l,s,u,d,f){return function(e,t,o,a){var n,i,r;if(e.configuracion.tamanoPapelNotaVenta.nombre_corto==l.FACT_PAPEL_OFICIO)n=[612,936],e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_VACIA?s(e,n,!0,!1,!1,o):e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_COMPLETA?s(e,n,!1,!0,!1,o):e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_SEMICOMPLETA&&s(e,n,!1,!1,!0,o);else if(e.configuracion.tamanoPapelNotaVenta.nombre_corto==l.FACT_PAPEL_CARTA)n=[612,792],e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_VACIA?s(e,n,!0,!1,!1,o):e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_COMPLETA?s(e,n,!1,!0,!1,o):e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_SEMICOMPLETA&&s(e,n,!1,!1,!0,o);else if(e.configuracion.tamanoPapelNotaVenta.nombre_corto==l.FACT_PAPEL_MEDIOOFICIO)n=[612,468],e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_VACIA?s(e,n,!0,!1,!1,o):e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_COMPLETA?s(e,n,!1,!0,!1,o):e.configuracion.impresionFactura.nombre_corto==l.FACT_IMPRESION_SEMICOMPLETA&&s(e,n,!1,!1,!0,o);else if(e.configuracion.tamanoPapelNotaVenta.nombre_corto==l.FACT_PAPEL_ROLLO){if(n=[227,e.detallesVenta.length<=2?400:400+20*(e.detallesVenta.length-2)],t&&!e.configuracion.imprimir_al_guardar){if(o.empresa.usar_pedidos){var c=230+20*e.detallesVenta.length;i=new PDFDocument({compress:!1,size:[227,c],margins:{top:10,bottom:10,left:20,right:20}}),r=i.pipe(blobStream()),u(e,t,i,r,c,o,a)}}else i=new PDFDocument({compress:!1,size:n,margins:{top:0,bottom:0,left:20,right:20}}),r=i.pipe(blobStream()),d(e,n,i,r,o),o.empresa.usar_pedidos&&(c=230+20*e.detallesVenta.length,i.addPage({size:[227,c],margins:{top:10,bottom:10,left:20,right:20}}),u(e,t,i,r,c,o,a));i&&r&&(i.end(),r.on("finish",function(){var e=r.toBlobURL("application/pdf"),t=window.open(e,"_blank","location=no");f(function(){t.print()},500)}))}}}]).factory("ImprimirProformaCartaOficio",["Diccionario","$timeout","blockUI","VerificarDescuentos","DibujarCabeceraProformaNVmedioOficio",function(_,E,A,C,O){return function(e,t,o,a,n,i){var r=new PDFDocument({compress:!1,size:t,margin:10}),c=r.pipe(blobStream()),l=C(e.detallesVenta);r.font("Helvetica",8);var s=0;e.configuracion.tamanoPapelNotaVenta.nombre_corto==_.FACT_PAPEL_OFICIO?s=19:e.configuracion.tamanoPapelNotaVenta.nombre_corto==_.FACT_PAPEL_CARTA?s=16:e.configuracion.tamanoPapelNotaVenta.nombre_corto==_.FACT_PAPEL_MEDIOOFICIO&&(s=3);var u=240,d=0,f=1,m=Math.ceil(e.detallesVenta.length/s);O(r,o,a,e,t,f,m,i),r.font("Helvetica",7);for(var x=0;x<e.detallesVenta.length&&d<=s;x++)e.detallesVenta[x].fecha_vencimiento=new Date(e.detallesVenta[x].fecha_vencimiento),l?(r.text(e.detallesVenta[x].producto.codigo,55,u,{width:50}),r.text(e.detallesVenta[x].cantidad,105,u),r.text(e.detallesVenta[x].producto.unidad_medida,120,u,{width:40}),r.text(e.detallesVenta[x].producto.nombre,160,u-9,{width:80}),i.empresa.usar_vencimientos&&e.con_vencimiento&&(r.text(e.detallesVenta[x].fecha_vencimiento.getDate()+"/"+(e.detallesVenta[x].fecha_vencimiento.getMonth()+1)+"/"+e.detallesVenta[x].fecha_vencimiento.getFullYear(),245,u),r.text(e.detallesVenta[x].lote,285,u)),r.text(e.detallesVenta[x].precio_unitario.toFixed(2),310,u),r.text(e.detallesVenta[x].importe.toFixed(2),345,u),r.text(e.detallesVenta[x].descuento?e.detallesVenta[x].descuento.toFixed(2):0,395,u),r.text(e.detallesVenta[x].recargo.toFixed(2),430,u),r.text(e.detallesVenta[x].ice.toFixed(2),465,u),r.text(e.detallesVenta[x].excento.toFixed(2),500,u),r.text(e.detallesVenta[x].total.toFixed(2),530,u)):(r.text(e.detallesVenta[x].producto.codigo,55,u),r.text(e.detallesVenta[x].cantidad,130,u),r.text(e.detallesVenta[x].producto.unidad_medida,160,u),r.text(e.detallesVenta[x].producto.nombre,200,u-9,{width:150}),i.empresa.usar_vencimientos&&e.con_vencimiento&&(r.text(e.detallesVenta[x].fecha_vencimiento.getDate()+"/"+(e.detallesVenta[x].fecha_vencimiento.getMonth()+1)+"/"+e.detallesVenta[x].fecha_vencimiento.getFullYear(),360,u),r.text(e.detallesVenta[x].lote,415,u)),r.text(e.detallesVenta[x].precio_unitario.toFixed(2),460,u),r.text(e.detallesVenta[x].total.toFixed(2),520,u)),(a||o)&&r.rect(50,u-15,520,30).stroke(),u+=30,++d==s&&(r.addPage({size:t,margin:10}),u=240,d=0,O(r,o,a,e,t,f+=1,m,i));(a||o)&&(r.font("Helvetica-Bold",7),r.text("TOTAL",455,u-5)),r.font("Helvetica",7),r.text(e.total.toFixed(2),520,u-5),r.text("SON : "+e.numero_literal,55,u-5),(a||o)&&r.rect(50,u-15,520,20).stroke(),r.moveDown(2);var p=new Date,g=p.getMinutes();g<10&&(g="0"+g),r.text("  Usuario : "+i.nombre_usuario+" -- Fecha : "+p.getDate()+"/"+(p.getMonth()+1)+"/"+p.getFullYear()+"  "+p.getHours()+":"+g+"  ",{align:"center"}),r.end(),c.on("finish",function(){var e=c.toBlobURL("application/pdf"),t=window.open(e,"_blank","location=no");E(function(){t.print()},500)}),A.stop()}}]).factory("DibujarCabeceraProformaNVmedioOficio",["VerificarDescuentos",function(s){return function(e,t,o,a,n,i,r,c){if(t){100<c.empresa.imagen.length&&e.image(c.empresa.imagen,60,50,{fit:[75,75]}),e.font("Helvetica-Bold",8),e.text(c.empresa.razon_social.toUpperCase(),150,60),e.font("Helvetica",7),e.text(a.sucursal.nombre.toUpperCase(),150,70),e.text(a.sucursal.direccion.toUpperCase(),150,80);var l=(null!=a.sucursal.telefono1?a.sucursal.telefono1:"")+(null!=a.sucursal.telefono2?"-"+a.sucursal.telefono2:"")+(null!=a.sucursal.telefono3?"-"+a.sucursal.telefono3:"");e.text("TELF.: "+l,150,90),e.text("COCHABAMBA - BOLIVIA",150,100)}e.font("Helvetica-Bold",16),e.text("PROFORMA Nº "+a.factura,200,125),e.font("Helvetica-Bold",8),(o||t)&&(e.rect(50,150,520,50).stroke(),e.text("FECHA : ",60,165),e.text("SEÑOR(ES) : ",60,175),e.text("NIT : ",360,165)),e.font("Helvetica",8),e.text(a.fecha_factura?a.fecha_factura:a.fechaTexto,120,165),e.text(a.cliente.razon_social,120,175),e.text(a.cliente.nit,400,165),e.font("Helvetica-Bold",7),(o||t)&&(e.rect(50,200,520,25).stroke(),s(a.detallesVenta)?(e.text("CODIGO",55,210),e.text("CANT.",100,210),e.text("UNID.",130,210),e.text("DETALLE",160,210),c.empresa.usar_vencimientos&&a.con_vencimiento&&(e.text("VENC.",245,210),e.text("LOTE.",280,210)),e.text("P. UNIT.",310,210),e.text("IMPORTE",345,210),e.text("DESC.",395,210),e.text("REC.",430,210),e.text("ICE",465,210),e.text("EXC.",500,210),e.text("TOTAL",530,210)):(e.text("CODIGO",55,210),e.text("CANTIDAD",120,210),e.text("UNIDAD",165,210),e.text("DETALLE",200,210),c.empresa.usar_vencimientos&&a.con_vencimiento&&(e.text("VENC.",360,210),e.text("LOTE.",415,210)),e.text("P.UNIT.",460,210),e.text("TOTAL",520,210)))}}]).factory("ImprimirProformaRollo",["blockUI",function(x){return function(e,t,o,a,n){o.moveDown(2),o.font("Helvetica-Bold",8),o.text(n.empresa.razon_social.toUpperCase(),{align:"center"}),o.moveDown(.4),o.font("Helvetica",7),o.text(e.sucursal.nombre.toUpperCase(),{align:"center"}),o.moveDown(.4),o.text(e.sucursal.direccion.toUpperCase(),{align:"center"}),o.moveDown(.4);var i=(null!=e.sucursal.telefono1?e.sucursal.telefono1:"")+(null!=e.sucursal.telefono2?"-"+e.sucursal.telefono2:"")+(null!=e.sucursal.telefono3?"-"+e.sucursal.telefono3:"");o.text("TELF.: "+i,{align:"center"}),o.moveDown(.4),o.text("COCHABAMBA - BOLIVIA",{align:"center"}),o.moveDown(.5),o.font("Helvetica-Bold",8),o.text("PROFORMA Nº "+e.factura,{align:"center"}),o.font("Helvetica",7),o.moveDown(.4),o.text("------------------------------------",{align:"center"}),o.moveDown(.4),o.moveDown(.4),o.moveDown(.4),o.moveDown(.4),o.text("------------------------------------",{align:"center"}),o.moveDown(.4),o.moveDown(.6),o.text("FECHA : "+e.fechaTexto,{align:"left"}),o.moveDown(.4),o.text("SEÑOR(ES) : "+e.cliente.razon_social,{align:"left"}),o.moveDown(.4),o.text("NIT/CI : "+e.cliente.nit,{align:"left"}),o.moveDown(.4),o.text("---------------------------------------------------------------------------------",{align:"center"}),o.moveDown(.2),o.text("CANT   CONCEPTO                                   P. UNIT.    SUBTOTAL",{align:"left"}),o.moveDown(.2),o.text("---------------------------------------------------------------------------------",{align:"center"}),o.moveDown(.4);for(var r=o.y,c=0,l=0,s=0,u=0,d=0;d<e.detallesVenta.length;d++)o.text(e.detallesVenta[d].cantidad,15,r),40<e.detallesVenta[d].producto.nombre.length&&o.fontSize(6),o.text(e.detallesVenta[d].producto.nombre,35,r,{width:100}),o.fontSize(7),o.text(e.detallesVenta[d].precio_unitario.toFixed(2),145,r),o.text(e.detallesVenta[d].importe.toFixed(2),180,r),c+=e.detallesVenta[d].tipo_descuento?e.detallesVenta[d].importe*(e.detallesVenta[d].descuento/100):e.detallesVenta[d].descuento,l+=e.detallesVenta[d].tipo_recargo?e.detallesVenta[d].importe*(e.detallesVenta[d].recargo/100):e.detallesVenta[d].recargo,s+=e.detallesVenta[d].ice,u+=e.detallesVenta[d].excento,r+=20;o.text("--------------",10,r,{align:"right"}),o.moveDown(.4),o.text("IMPORTE TOTAL Bs.              "+e.importe.toFixed(2),{align:"right"}),o.moveDown(.3),0<c&&o.text("DESCUENTO Bs.              "+c.toFixed(2),{align:"right"}),o.moveDown(.3),0<l&&o.text("RECARGO Bs.              "+l.toFixed(2),{align:"right"}),o.moveDown(.3),0<s&&o.text("ICE Bs.              "+s.toFixed(2),{align:"right"}),o.moveDown(.3),0<u&&o.text("EXCENTO Bs.              "+u.toFixed(2),{align:"right"}),o.moveDown(.3),o.text("TOTAL Bs.              "+e.total.toFixed(2),{align:"right"}),o.moveDown(.4),o.moveDown(.4),o.text("SON: "+e.numero_literal,{align:"left"}),o.moveDown(.6),o.moveDown(.4),o.moveDown(.4),o.moveDown(.4),o.moveDown(.4);var f=new Date,m=f.getMinutes();m<10&&(m="0"+m),o.text("  Usuario : "+n.nombre_usuario+" -- Fecha : "+f.getDate()+"/"+(f.getMonth()+1)+"/"+f.getFullYear()+"  "+f.getHours()+":"+m+"  ",{align:"center"}),x.stop()}}]).factory("ImprimirNotaBaja",["blockUI","Diccionario","ImprimirNotaBajaCartaOficio","ImprimirNotaBajaRollo",function(i,r,c,l){return function(e,t){var o;if(i.start(),e.configuracion.tamanoPapelNotaBaja.nombre_corto==r.FACT_PAPEL_OFICIO)papel=[612,936],o=23,c(e,papel,o,t);else if(e.configuracion.tamanoPapelNotaBaja.nombre_corto==r.FACT_PAPEL_CARTA)papel=[612,792],o=20,c(e,papel,o,t);else if(e.configuracion.tamanoPapelNotaBaja.nombre_corto==r.FACT_PAPEL_MEDIOOFICIO)papel=[612,468],o=10,c(e,papel,o,t);else if(e.configuracion.tamanoPapelNotaBaja.nombre_corto==r.FACT_PAPEL_ROLLO){var a,n=e.detallesVenta.length;a=n<=2?440:440+30*(n-2),papel=[227,a],l(e,papel,t)}}}]).factory("ImprimirNotaBajaCartaOficio",["blockUI","VerificarDescuentos","DibujarCabeceraPDFBaja",function(_,E,A){return function(e,t,o,a){var n=new PDFDocument({compress:!1,size:t,margin:0}),i=n.pipe(blobStream()),r=E(e.detallesVenta);n.font("Helvetica",7);var c=0,l=140,s=0,u=1,d=Math.ceil(e.detallesVenta.length/o);A(n,1,d,e,r,a);for(var f=0;f<e.detallesVenta.length&&s<=o;f++){if(r)n.text(e.detallesVenta[f].producto.codigo,55,l),n.text(e.detallesVenta[f].cantidad,110),n.text(e.detallesVenta[f].producto.unidad_medida,135,l),n.text(e.detallesVenta[f].producto.nombre,170,l-6,{width:120}),n.text(e.detallesVenta[f].producto.precio_unitario.toFixed(2),300,l),n.text(e.detallesVenta[f].importe.toFixed(2),335,l),n.text(e.detallesVenta[f].descuento.toFixed(2),385,l),n.text(e.detallesVenta[f].recargo.toFixed(2),420,l),n.text(e.detallesVenta[f].ice.toFixed(2),455,l),n.text(e.detallesVenta[f].excento.toFixed(2),490,l),n.text(e.detallesVenta[f].total.toFixed(2),520,l);else{n.text(e.detallesVenta[f].producto.codigo,55,l,{width:60}),n.text(e.detallesVenta[f].cantidad,130,l,{width:70}),n.text(e.detallesVenta[f].producto.unidad_medida,153,l);var m=e.detallesVenta[f].producto.nombre.length,x=m<=30?l:40<m&&m<=75?l:l-7;if(a.empresa.usar_vencimientos){n.font("Helvetica",6),n.text(e.detallesVenta[f].producto.nombre,205,x,{width:160});var p=new Date(e.detallesVenta[f].inventario.fecha_vencimiento);n.font("Helvetica",7),n.text(p.getDate()+"/"+(p.getMonth()+1)+"/"+p.getFullYear(),375,l),n.text(e.detallesVenta[f].inventario.lote,435,l)}else n.text(e.detallesVenta[f].producto.nombre,210,x,{width:250});n.text(e.detallesVenta[f].producto.precio_unitario.toFixed(2),470,l),n.text(e.detallesVenta[f].total.toFixed(2),520,l)}if(n.rect(50,l-15,520,30).stroke(),l+=30,++s==o&&(c+=s)!=e.detallesVenta.length){var g=new Date;e.fecha=new Date(e.fecha),n.font("Helvetica",5),n.text("EMISIÓN: "+e.fecha.getDate()+"/"+(e.fecha.getMonth()+1)+"/"+e.fecha.getFullYear(),200,l),n.text("IMPRESIÓN: "+g.getDate()+"/"+(g.getMonth()+1)+"/"+g.getFullYear(),260,l),n.text("USUARIO: "+a.persona.nombre_completo,55,l),n.text(u+" de "+d,540,l-10),n.addPage({margin:0,bufferPages:!0}),l=140,s=0,u+=1,A(n,1,d,e,r,a)}}n.font("Helvetica-Bold",7),n.text("TOTAL",465,l-5),n.font("Helvetica",7),n.text(e.total.toFixed(2),520,l-5),n.rect(50,l-15,520,20).stroke();g=new Date;e.fecha=new Date(e.fecha),n.font("Helvetica",5),n.text("EMISIÓN: "+e.fecha.getDate()+"/"+(e.fecha.getMonth()+1)+"/"+e.fecha.getFullYear(),200,l+10),n.text("IMPRESIÓN: "+g.getDate()+"/"+(g.getMonth()+1)+"/"+g.getFullYear(),260,l+10),n.text("USUARIO: "+a.persona.nombre_completo,55,l+10),d<u||n.text(u+" de "+d,540,l+10),n.end(),i.on("finish",function(){var e=i.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),_.stop()}}]).factory("DibujarCabeceraPDFBaja",[function(){return function(e,t,o,a,n,i){e.font("Helvetica-Bold",7),e.text(i.empresa.razon_social,55,55),e.text("SUCURSAL: ",55,65),e.text("DIRECCIÓN: ",55,75);var r=(null!=a.sucursal.telefono1?a.sucursal.telefono1:"")+(null!=a.sucursal.telefono2?"-"+a.sucursal.telefono2:"")+(null!=a.sucursal.telefono3?"-"+a.sucursal.telefono3:"");e.text("TELF.: ",55,85),e.font("Helvetica",7),e.text(a.sucursal.nombre,105,65),e.text(a.sucursal.direccion,105,75),e.text(r,85,85),e.font("Helvetica-Bold",15),e.text("NOTA DE BAJA",0,65,{align:"center"}),e.font("Helvetica-Bold",7),a.fecha=new Date(a.fecha),e.font("Helvetica",11),e.text("Fecha: "+a.fecha.getDate()+"/"+(a.fecha.getMonth()+1)+"/"+a.fecha.getFullYear(),0,85,{align:"center"}),e.font("Helvetica-Bold",7),e.text("NRO. : "+a.factura,450,75),e.rect(50,40,520,60).stroke(),e.rect(50,100,520,25).stroke(),n?(e.text("CODIGO",55,110),e.text("CANT.",105,110),e.text("UNID.",135,110),e.text("DETALLE",170,110),e.text("P. UNIT.",300,110),e.text("IMPORTE",335,110),e.text("DESC.",385,110),e.text("REC.",420,110),e.text("ICE",455,110),e.text("EXC.",490,110)):(e.text("CODIGO",55,110),e.text("CANTIDAD",115,110),e.text("UNIDAD",160,110),i.empresa.usar_vencimientos?(e.text("DETALLE",210,110),e.text("FECHA VENC.",370,110),e.text("LOTE",430,110)):e.text("DETALLE",210,110),e.text("P.UNIT.",470,110)),e.text("TOTAL",520,110)}}]).factory("ImprimirNotaBajaRollo",["blockUI","VerificarDescuentos",function(u,d){return function(e,t,o){var a=new PDFDocument({compress:!1,size:t,margins:{top:10,bottom:10,left:10,right:20}}),n=a.pipe(blobStream());d(e.detallesVenta);a.moveDown(2),a.font("Helvetica-Bold",8),a.text(o.empresa.razon_social.toUpperCase(),{align:"center"}),a.moveDown(.4),a.font("Helvetica",7),a.text(e.sucursal.nombre.toUpperCase(),{align:"center"}),a.moveDown(.4),a.text(e.sucursal.direccion.toUpperCase(),{align:"center"});var i=(null!=e.sucursal.telefono1?e.sucursal.telefono1:"")+(null!=e.sucursal.telefono2?"-"+e.sucursal.telefono2:"")+(null!=e.sucursal.telefono3?"-"+e.sucursal.telefono3:"");a.moveDown(.4),a.text("TELF.: "+i,{align:"center"}),a.moveDown(.4),a.text("COCHABAMBA - BOLIVIA",{align:"center"}),a.moveDown(.5),a.font("Helvetica-Bold",8),a.text("NOTA DE BAJA",{align:"center"}),e.fecha=new Date(e.fecha),a.font("Helvetica",8),a.text("Fecha: "+e.fecha.getDate()+"/"+(e.fecha.getMonth()+1)+"/"+e.fecha.getFullYear(),{align:"center"}),a.font("Helvetica-Bold",8),a.moveDown(.4),a.text("------------------------------------",{align:"center"}),a.moveDown(.4),a.font("Helvetica-Bold",7);var r=165;a.moveDown(.4),a.text("COD.",10,145),a.text("CANT.",35,145),a.text("DETALL.",60,145),a.text("F. VENC.",128,145),a.text("LOTE",162,145),a.text("TOTAL",183,145),a.moveDown(.4);for(var c=0;c<e.detallesVenta.length;c++){a.font("Helvetica",7),a.moveDown(.4),a.text(e.detallesVenta[c].producto.codigo,10,r,{width:25}),a.text(e.detallesVenta[c].cantidad,38,r),a.text(e.detallesVenta[c].producto.nombre,57,r,{width:70});var l=new Date(e.detallesVenta[c].inventario.fecha_vencimiento);console.log((new Date).getFullYear().toString().substr(-2)),a.text(l.getDate()+"/"+(l.getMonth()+1)+"/"+l.getFullYear().toString().substr(-2),128,r),a.text(e.detallesVenta[c].inventario.lote,164,r),a.text(e.detallesVenta[c].total.toFixed(2),187,r,{width:100}),r+=30}var s=new Date;e.fecha=new Date(e.fecha),a.moveDown(.4),a.font("Helvetica",6),a.text("EMISIÓN: "+e.fecha.getDate()+"/"+(e.fecha.getMonth()+1)+"/"+e.fecha.getFullYear(),150,r+190),a.text("IMPRESIÓN: "+s.getDate()+"/"+(s.getMonth()+1)+"/"+s.getFullYear(),15,r+200),a.text("USUARIO: "+o.persona.nombre_completo,15,r+190),a.end(),n.on("finish",function(){var e=n.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),u.stop()}}]).factory("ImprimirNotaTraspaso",["Diccionario","blockUI","ImprimirNotaTraspasoCartaOficio","ImprimirNotaTraspasoRollo",function(n,i,r,c){return function(e,t){if(i.start(),e.configuracion.tamanoPapelNotaTraspaso.nombre_corto==n.FACT_PAPEL_OFICIO)papel=[612,936],itemsPorPagina=19,r(e,papel,itemsPorPagina,t);else if(e.configuracion.tamanoPapelNotaTraspaso.nombre_corto==n.FACT_PAPEL_CARTA)papel=[612,792],itemsPorPagina=16,r(e,papel,itemsPorPagina,t);else if(e.configuracion.tamanoPapelNotaTraspaso.nombre_corto==n.FACT_PAPEL_MEDIOOFICIO)papel=[612,468],itemsPorPagina=9,r(e,papel,itemsPorPagina,t);else if(e.configuracion.tamanoPapelNotaTraspaso.nombre_corto==n.FACT_PAPEL_ROLLO){var o,a=e.detallesVenta.length;o=a<=2?440:440+30*(a-2),papel=[227,o],c(e,papel,t)}}}]).factory("ImprimirNotaTraspasoCartaOficio",["blockUI","VerificarDescuentos","DibujarCabeceraPDFTraspaso",function(_,E,A){return function(e,t,o,a){var n=new PDFDocument({compress:!1,size:t,margin:0}),i=n.pipe(blobStream()),r=E(e.detallesVenta);n.font("Helvetica",8);var c,l,s=150,u=0,d=1,f=Math.ceil(e.detallesVenta.length/o),m=0;A(n,1,f,e,r,a);for(var x=0;x<e.detallesVenta.length&&u<=o;x++){if(r)n.font("Helvetica",7),l=(c=e.detallesVenta[x].producto.codigo.length)<=15?s:15<c&&c<=15?s-4:s-11,n.text(e.detallesVenta[x].producto.codigo,55,l,{width:40}),n.text(e.detallesVenta[x].cantidad,110,s),n.text(e.detallesVenta[x].producto.unidad_medida,135,s),n.text(e.detallesVenta[x].producto.nombre,170,s-6,{width:130}),n.text(e.detallesVenta[x].producto.precio_unitario.toFixed(2),300,s),n.text(e.detallesVenta[x].importe.toFixed(2),335,s),n.text(e.detallesVenta[x].descuento.toFixed(2),385,s),n.text(e.detallesVenta[x].recargo.toFixed(2),420,s),n.text(e.detallesVenta[x].ice.toFixed(2),455,s),n.text(e.detallesVenta[x].excento.toFixed(2),490,s),n.text(e.detallesVenta[x].total.toFixed(2),520,s);else{if(n.font("Helvetica",7),l=(c=e.detallesVenta[x].producto.codigo.length)<=15?s:15<c&&c<=15?s-4:s-11,n.font("Helvetica",6),n.text(e.detallesVenta[x].producto.codigo,55,l,{width:70}),n.font("Helvetica",7),n.text(e.detallesVenta[x].cantidad,135,s),n.text(e.detallesVenta[x].producto.unidad_medida,160,s),l=(c=e.detallesVenta[x].producto.nombre.length)<=25?s:25<c&&c<=40?s-4:s-11,a.empresa.usar_vencimientos){if(n.font("Helvetica",6),n.text(e.detallesVenta[x].producto.nombre,210,l,{width:175}),n.font("Helvetica",7),e.detallesVenta[x].inventario){var p=new Date(e.detallesVenta[x].inventario.fecha_vencimiento);n.text(p.getDate()+"/"+(p.getMonth()+1)+"/"+p.getFullYear(),390,s),n.text(e.detallesVenta[x].inventario.lote,455,s)}}else n.text(e.detallesVenta[x].producto.nombre,210,l,{width:250});n.text(e.detallesVenta[x].producto.precio_unitario.toFixed(2),490,s),n.text(e.detallesVenta[x].total.toFixed(2),530,s)}if(n.rect(50,s-15,520,30).stroke(),s+=30,++u==o&&(m+=u)!=e.detallesVenta.length){var g=new Date;e.fecha=new Date(e.fecha),n.font("Helvetica",6),n.text("EMISIÓN: "+e.fecha.getDate()+"/"+(e.fecha.getMonth()+1)+"/"+e.fecha.getFullYear(),200,s-10),n.text("IMPRESIÓN: "+g.getDate()+"/"+(g.getMonth()+1)+"/"+g.getFullYear(),260,s-10),n.text("USUARIO: "+a.persona.nombre_completo,55,s-10),n.text(d+" de "+f,540,s-10),n.addPage({margin:0,bufferPages:!0}),s=140,u=0,A(n,d+=1,f,e,r,a),n.font("Helvetica",8)}}n.font("Helvetica-Bold",8),n.text("TOTAL",465,s-5),n.font("Helvetica",8),n.text(e.total.toFixed(2),520,s-5),n.rect(50,s-15,520,20).stroke(),n.text("------------------------------------------",180,s+80),n.text("------------------------------------------",340,s+80),n.text("ENTREGA CONFORME",190,s+90),n.text("RECIBO CONFORME",350,s+90);g=new Date;e.fecha=new Date(e.fecha),n.font("Helvetica",6),n.text("EMISIÓN: "+e.fecha.getDate()+"/"+(e.fecha.getMonth()+1)+"/"+e.fecha.getFullYear(),200,s+10),n.text("IMPRESIÓN: "+g.getDate()+"/"+(g.getMonth()+1)+"/"+g.getFullYear(),260,s+10),n.text("USUARIO: "+a.persona.nombre_completo,55,s+10),f<d||n.text(d+" de "+f,540,s+10),n.end(),i.on("finish",function(){var e=i.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),_.stop()}}]).factory("DibujarCabeceraPDFTraspaso",[function(){return function(e,t,o,a,n,i){e.rect(50,40,520,70).stroke(),e.rect(50,110,520,25).stroke(),e.font("Helvetica-Bold",7),e.text(i.empresa.razon_social,55,55),e.text("SUCURSAL: ",55,65),e.text("DIRECCIÓN: ",55,75);var r=(null!=a.sucursal.telefono1?a.sucursal.telefono1:"")+(null!=a.sucursal.telefono2?"-"+a.sucursal.telefono2:"")+(null!=a.sucursal.telefono3?"-"+a.sucursal.telefono3:"");e.text("TELF.: ",55,95),e.font("Helvetica",8),e.text(a.sucursal.nombre,105,65),e.text(a.sucursal.direccion,105,75,{width:120}),e.text(r,85,95),e.font("Helvetica-Bold",15),e.text("NOTA DE TRASPASO",0,60,{align:"center"}),e.font("Helvetica-Bold",7),e.text("DE SUCURSAL: "+a.sucursal.nombre+" A "+a.sucursalDestino.nombre,0,78,{align:"center"}),e.text("NRO. : "+a.factura,450,75),n?(e.text("CODIGO",55,120),e.text("CANT.",105,120),e.text("UNID.",135,120),e.text("DETALLE",170,120),e.text("P. UNIT.",300,120),e.text("IMPORTE",335,120),e.text("DESC.",385,120),e.text("REC.",420,120),e.text("ICE",455,120),e.text("EXC.",490,120),e.text("TOTAL",520,120)):(e.text("CODIGO",55,120),e.text("CANT.",128,120),e.text("UNID.",165,120),i.empresa.usar_vencimientos?(e.text("DETALLE",210,120,{width:110}),e.text("FECHA VENC.",380,120),e.text("LOTE",450,120)):e.text("DETALLE",190,120,{width:250}),e.text("P.UNIT.",490,120),e.text("TOTAL",530,120))}}]).factory("ImprimirNotaTraspasoRollo",["blockUI","VerificarDescuentos",function(f,m){return function(e,t,o){var a=new PDFDocument({compress:!1,size:t,margins:{top:10,bottom:10,left:10,right:20}}),n=a.pipe(blobStream());m(e.detallesVenta);a.moveDown(2),a.font("Helvetica-Bold",8),a.text(o.empresa.razon_social.toUpperCase(),{align:"center"}),a.moveDown(.4),a.font("Helvetica",7),a.text(e.sucursal.nombre.toUpperCase(),{align:"center"}),a.moveDown(.4),a.text(e.sucursal.direccion.toUpperCase(),{align:"center"});var i=(null!=e.sucursal.telefono1?e.sucursal.telefono1:"")+(null!=e.sucursal.telefono2?"-"+e.sucursal.telefono2:"")+(null!=e.sucursal.telefono3?"-"+e.sucursal.telefono3:"");a.moveDown(.4),a.text("TELF.: "+i,{align:"center"}),a.moveDown(.4),a.text("COCHABAMBA - BOLIVIA",{align:"center"}),a.moveDown(.5),a.font("Helvetica-Bold",8),a.text("NOTA DE TRASPASO ",{align:"center"}),a.text("DE SUCURSAL: "+e.sucursal.nombre+" A "+e.sucursalDestino.nombre,{align:"center"}),a.font("Helvetica-Bold",8),a.moveDown(.4),a.text("------------------------------------",{align:"center"}),a.moveDown(.4),a.font("Helvetica-Bold",7);var r,c,l=160;a.moveDown(.4),a.text("COD.",10,145),a.text("CANT.",35,145),a.text("DETALL.",60,145),a.text("F. VENC.",128,145),a.text("LOTE",162,145),a.text("TOTAL",183,145),a.moveDown(.4);for(var s=0;s<e.detallesVenta.length;s++){if(a.font("Helvetica",7),c=(r=e.detallesVenta[s].producto.codigo.length)<=15?l:15<r&&r<=15?l-4:l-11,a.moveDown(.4),a.text(e.detallesVenta[s].producto.codigo,10,c,{width:25}),a.text(e.detallesVenta[s].cantidad,38,l),a.text(e.detallesVenta[s].producto.nombre,57,l,{width:70}),e.detallesVenta[s].inventario){var u=new Date(e.detallesVenta[s].inventario.fecha_vencimiento);console.log((new Date).getFullYear().toString().substr(-2)),a.text(u.getDate()+"/"+(u.getMonth()+1)+"/"+u.getFullYear().toString().substr(-2),128,l),a.text(e.detallesVenta[s].inventario.lote,164,l)}a.text(e.detallesVenta[s].total.toFixed(2),187,l,{width:100}),l+=30}var d=new Date;e.fecha=new Date(e.fecha),a.font("Helvetica-Bold",8),a.x=10,a.text("   -----------------------------                 --------------------------",0,l+130,{align:"center"}),a.text("   ENTREGUE CONFORME          RECIBI CONFORME",{align:"center"}),a.moveDown(.4),a.font("Helvetica",6),a.text("EMISIÓN: "+e.fecha.getDate()+"/"+(e.fecha.getMonth()+1)+"/"+e.fecha.getFullYear(),150,l+190),a.text("IMPRESIÓN: "+d.getDate()+"/"+(d.getMonth()+1)+"/"+d.getFullYear(),15,l+200),a.text("USUARIO: "+o.persona.nombre_completo,15,l+190),a.end(),n.on("finish",function(){var e=n.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),f.stop()}}]).factory("ImprimirPdfAlertaDespacho",["blockUI","DibujarCabeceraPDFAlertaDespacho",function(f,m){return function(e,t,o,a){f.start();var n=new PDFDocument({compress:!1,size:"letter",margin:10}),i=n.pipe(blobStream()),r=130,c=0,l=1,s=Math.ceil(e.length/24);m(n,1,s,e,t,o,a),n.font("Helvetica",8);for(var u=0;u<e.length&&c<=24;u++){var d=e[u];n.text(u+1,45,r),n.text(d.despacho.usuario.persona.nombre_completo,70,r,{width:100}),n.text(d.despacho.cliente.razon_social,190,r,{width:100}),n.text(d.producto.nombre,300,r,{width:110}),n.text(d.cantidad,420,r,{width:50}),n.text(d.cantidad_despacho,460,r,{width:50}),n.text(d.cantidad-d.cantidad_despacho,500,r,{width:50}),n.text("Bs. "+d.servicio_transporte+".-",545,r,{width:80}),r+=25,24==++c&&(n.addPage({margin:0,bufferPages:!0}),r=130,c=0,m(n,l+=1,s,e,t,o,a),n.font("Helvetica",8))}n.end(),i.on("finish",function(){var e=i.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),f.stop()}}]).factory("ImprimirPdfDespachos",["blockUI","DibujarCabeceraPDFDespacho",function(m,x){return function(e,t,o){m.start();var a=new PDFDocument({compress:!1,size:"letter",margin:10}),n=a.pipe(blobStream()),i=0,r=0,c=130,l=0,s=1,u=Math.ceil(e.length/24);x(a,1,u,e,t,o),a.font("Helvetica",8);for(var d=0;d<e.length&&l<=24;d++){var f=e[d];a.text(d+1,45,c),a.text(f.despacho.usuario.persona.nombre_completo,70,c,{width:100}),a.text(f.despacho.cliente.razon_social,190,c,{width:100}),a.text(f.producto.nombre,320,c,{width:110}),a.text(f.cantidad,440,c,{width:50}),a.text("Bs. "+f.servicio_transporte+".-",500,c,{width:80}),c+=25,24==++l&&(a.addPage({margin:0,bufferPages:!0}),c=130,l=0,x(a,s+=1,u,e,t,o),a.font("Helvetica",8)),i+=f.cantidad,r+=f.servicio_transporte}a.font("Helvetica-Bold",8),a.text("TOTALES:",350,c,{width:80}),a.text(i,440,c,{width:80}),a.text("Bs. "+r+".-",500,c,{width:80}),a.end(),n.on("finish",function(){var e=n.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),m.stop()}}]).factory("ExportarExelAlarmasDespachos",["blockUI",function(_){return res=function(e,t,o){var a="Todos",n="Todos";""!=t.empleado&&(a=e[0].despacho.usuario.persona.nombre_completo),""!=t.razon_social&&(n=e[0].despacho.cliente.razon_social);for(var i=[["","","REPORTE DE PEDIDOS "],["Vendedor :"+a],["Cliente :"+n],["Nro","Vendedor","Cliente","Direccion","Razón social","Fecha","Producto","Cant.","Desp.","Saldo","S. Transp."]],r=0;r<e.length;r++){var c=e[r];c.despacho.usuario.persona.nombre_completo;var l=[];l.push(r+1),l.push(c.despacho.usuario.persona.nombre_completo),l.push(c.despacho.cliente.razon_social),l.push(c.despacho.destino.direccion),l.push(c.despacho.cliente_razon.razon_social);var s=new Date(c.despacho.fecha),u=10<=s.getDate()?s.getDate():"0"+s.getDate(),d=10<=s.getMonth()?s.getMonth()+1:"0"+(s.getMonth()+1);l.push(u+"/"+d+"/"+s.getFullYear()),l.push(c.producto.nombre),l.push(c.cantidad),l.push(c.cantidad_despacho);var f=c.cantidad-c.cantidad_despacho;l.push(f),l.push(c.servicio_transporte),i.push(l)}var m="SheetJS",x=new Workbook,p=sheet_from_array_of_arrays(i);x.SheetNames.push(m),x.Sheets[m]=p;var g=XLSX.write(x,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(g)],{type:"application/octet-stream"}),"REPORTE-PEDIDOS.xlsx"),_.stop()},res}]).factory("ExportarExelDespachos",["blockUI",function(_){return res=function(e,t,o){for(var a=[["","","REPORTE DE DESPACHOS "],["cod. dest","Destino","Direccion","Cod Cliente","Cliente","cod dest.factura","Razón social","NIT","Vendedor","Nro. pedido","F. Pedido","Factura SAP","fecha fact.","No. Despacho","fecha desp.","Transportista","doc. Cobranza","Fecha Pago","Cod. prodcuto","Producto","cant. pedido","cant. Despacho","P/U","Total","Costo Transportista","Grupo de Estibaje","Tipo de Estibaje","Costo Estibaje","Precio Transporte","Total Pedido"]],n=0;n<e.length;n++){var i=e[n],r=[];r.push(null!=i.despacho.destino?i.despacho.destino.codigo:""),r.push(null!=i.despacho.destino?i.despacho.destino.destino:"Sin destino"),r.push(null!=i.despacho.destino?i.despacho.destino.direccion:"Sin direccion"),r.push(i.despacho.cliente.codigo),r.push(i.despacho.cliente.razon_social),r.push(null!=i.despacho.cliente_razon?i.despacho.cliente_razon.codigo_sap:""),r.push(null!=i.despacho.cliente_razon?i.despacho.cliente_razon.razon_social:""),r.push(null!=i.despacho.cliente_razon?i.despacho.cliente_razon.nit:""),r.push(i.despacho.usuario.persona.nombre_completo);var c=new Date(i.despacho.fecha);10<=c.getDate()?c.getDate():c.getDate(),10<=c.getMonth()?c.getMonth():c.getMonth();r.push(i.despacho.id),r.push(new Date(i.despacho.fecha)),r.push(i.factura),r.push(new Date(i.fecha_factura)),r.push(i.numero_correlativo);var l=new Date(i.fecha);10<=l.getDate()?l.getDate():l.getDate(),10<=l.getMonth()+1?l.getMonth():l.getMonth();r.push(new Date(i.fecha)),r.push(i.transportista.persona.nombre_completo),r.push(""),r.push(""),r.push(i.producto.codigo),r.push(i.producto.nombre),r.push(i.cantidad),r.push(i.cantidad_despacho),r.push(i.precio_unitario);var s=i.precio_unitario*i.cantidad_despacho;r.push(s);var u=i.transportista.costo_transporte*i.cantidad_despacho;r.push(u),r.push(i.grupo_estibaje.nombre),r.push(i.estibaje.nombre);var d=i.estibaje.costo*i.cantidad_despacho;r.push(d),r.push(i.servicio_transporte);var f=i.servicio_transporte+s;r.push(f),r.push(null!=i.despacho.cliente_razon?i.despacho.cliente_razon.codigo_sap:""),a.push(r)}var m="SheetJS",x=new Workbook,p=sheet_from_array_of_arrays(a);x.SheetNames.push(m),x.Sheets[m]=p;var g=XLSX.write(x,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(g)],{type:"application/octet-stream"}),"REPORTE-DESPACHOS.xlsx"),_.stop()},res}]).factory("DibujarCabeceraPDFAlertaDespacho",[function(){return res=function(e,t,o,a,n,i,r){var c={inicio:n.inicio,fin:n.fin};if(e.font("Helvetica-Bold",12),e.text("REPORTE DE PEDIDOS",0,25,{align:"center"}),e.font("Helvetica",12),c.inicio&&c.fin){c.inicio=new Date(r(c.inicio)),c.fin=new Date(r(c.fin));var l=c.inicio.getMonth()+1<10?"0"+(c.inicio.getMonth()+1):c.inicio.getMonth()+1,s=c.inicio.getDate()<10?"0"+c.inicio.getDate():c.inicio.getDate(),u=c.fin.getMonth()+1<10?"0"+(c.fin.getMonth()+1):c.fin.getMonth()+1,d=c.fin.getDate()<10?"0"+c.fin.getDate():c.fin.getDate();e.text(s+"/"+l+"/"+c.inicio.getFullYear()+" AL "+d+"/"+u+"/"+c.fin.getFullYear(),0,45,{align:"center"})}e.font("Helvetica-Bold",8),e.text("PÁGINA "+t+" DE "+o,0,740,{align:"center"});var f="Todos",m="Todos";""!=c.empleado&&(f=a[0].despacho.usuario.persona.nombre_completo),""!=c.razon_social&&(m=a[0].despacho.cliente.razon_social),e.font("Helvetica-Bold",8),e.text("Vendedor : "+f,45,80),e.text("Cliente : "+m,245,80),e.font("Helvetica",8),e.font("Helvetica-Bold",8),e.text("Nro.",45,110),e.text("Vendedor",80,110,{width:50}),e.text("Cliente",200,110,{width:60}),e.text("Producto",300,110,{width:50}),e.text("Cant.",420,110,{width:50}),e.text("desp.",460,110,{width:50}),e.text("saldo",500,110,{width:50}),e.text("S. Transp.",545,110,{width:80}),e.font("Helvetica",8);var x=new Date;e.text("USUARIO: "+i.persona.nombre_completo+" fecha "+x.getDate()+"/"+(x.getMonth()+1)+"/"+x.getFullYear()+"Hrs."+x.getHours()+":"+x.getMinutes(),15,765)},res}]).factory("DibujarCabeceraPDFDespacho",[function(){return res=function(e,t,o,a,n,i){if(e.font("Helvetica-Bold",12),e.text("REPORTE DE PEDIDOS",0,25,{align:"center"}),e.font("Helvetica",12),n.inicio&&n.fin){var r=n.inicio.getMonth()+1<10?"0"+(n.inicio.getMonth()+1):n.inicio.getMonth()+1,c=n.inicio.getDate()<10?"0"+n.inicio.getDate():n.inicio.getDate(),l=n.fin.getMonth()+1<10?"0"+(n.fin.getMonth()+1):n.fin.getMonth()+1,s=n.fin.getDate()<10?"0"+n.fin.getDate():n.fin.getDate();e.text(c+"/"+r+"/"+n.inicio.getFullYear()+" AL "+s+"/"+l+"/"+n.fin.getFullYear(),0,45,{align:"center"})}e.font("Helvetica-Bold",8),e.text("PÁGINA "+t+" DE "+o,0,740,{align:"center"});e.font("Helvetica-Bold",8),e.text("Vendedor : Todos",45,80),e.text("Cliente : Todos",245,80),e.font("Helvetica",8),e.font("Helvetica-Bold",8),e.text("Nro.",45,110),e.text("Vendedor",80,110,{width:50}),e.text("Cliente",200,110,{width:60}),e.text("Producto",320,110,{width:50}),e.text("Cant.",440,110,{width:50}),e.text("S. Transp.",500,110,{width:80}),e.font("Helvetica",8);var u=new Date;e.text("USUARIO: "+i.persona.nombre_completo+" fecha "+u.getDate()+"/"+(u.getMonth()+1)+"/"+u.getFullYear()+"Hrs."+u.getHours()+":"+u.getMinutes(),15,765)},res}]);