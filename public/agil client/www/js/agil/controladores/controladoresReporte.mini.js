angular.module("agil.controladores").controller("ControladorEstadoCuentasProveedores",["$scope","$localStorage","$location","$templateCache","$route","blockUI","$timeout","uiGmapGoogleMapApi","$cordovaGeolocation","ReportEstadoCuentasProveedoresDatos","InventariosCosto",function(e,t,a,o,n,r,i,s,c,l,u){r.start(),e.usuario=JSON.parse(t.usuario),e.inicio=function(){e.proveedores=l.show({id_empresa:e.usuario.id_empresa}),setTimeout(function(){ejecutarScriptsTabla("tabla-estadoCuentaProveedores",10)},2e3),s.then(function(t){e.map={center:{latitude:-17.403800007775388,longitude:-66.11349012184144},zoom:17,bounds:{northeast:{latitude:-17.403800007775388,longitude:-66.11349012184144}}},e.options={scrollwheel:!1,mapTypeId:google.maps.MapTypeId.SATELLITE}})},e.$on("$viewContentLoaded",function(){resaltarPestaña(a.path().substring(1)),ejecutarScriptsProveedor("modal-wizard-proveedor","modal-wizard-proveedor-vista","dialog-eliminar-proveedor","modal-wizard-container-proveedor-edicion","modal-wizard-container-proveedor-vista"),e.buscarAplicacion(e.usuario.aplicacionesUsuario,a.path().substring(1)),r.stop()}),e.generarPdfEstadoCuentasProveedor=function(t){r.start();var a=new PDFDocument({size:"letter",margin:10}),o=a.pipe(blobStream()),n=0,i=120,s=0,c=1,l=Math.ceil(t.compras.length/33);e.dibujarCabeceraPDFEstadoCuentasProveedor(a,1,l,t),a.font("Helvetica",8);for(var u=0;u<t.compras.length&&s<=33;u++)a.rect(30,i-10,555,20).stroke(),t.compras[u].fecha=new Date(t.compras[u].fecha),a.text(t.compras[u].fecha.getDate()+"/"+(t.compras[u].fecha.getMonth()+1)+"/"+t.compras[u].fecha.getFullYear(),45,i),a.text(t.compras[u].id_movimiento,170,i,{width:45,align:"right"}),null==t.compras[u].factura?a.text("PROFORMA",240,i):a.text("Factura nro. "+t.compras[u].factura,240,i),a.text(t.compras[u].saldo,445,i,{width:50,align:"right"}),n+=t.compras[u].saldo,a.text(n,500,i,{width:50,align:"right"}),i+=20,33==++s&&(a.addPage({margin:0,bufferPages:!0}),i=120,s=0,c+=1,e.dibujarCabeceraPDFEstadoCuentasProveedor(a,c,l,Proveedor),a.font("Helvetica",8));a.rect(30,i-10,555,20).stroke(),a.font("Helvetica-Bold",8),a.text("Total General",350,i),a.text(n,446,i,{width:50,align:"right"}),a.end(),o.on("finish",function(){var e=o.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),r.stop()},e.generarExcelEstadoCuentasProveedor=function(e){for(var t=[["","","ESTADO CUENTAS PROVEEDOR"],["Deudor :"+e.razon_social],["Fecha","N Recibo","Descripción","monto","total","total General"]],a=0,o=0;o<e.compras.length;o++){var n=[];a+=e.compras[o].saldo,e.compras[o].fecha=new Date(e.compras[o].fecha),n.push(e.compras[o].fecha.getDate()+"/"+(e.compras[o].fecha.getMonth()+1)+"/"+e.compras[o].fecha.getFullYear()),n.push(e.compras[o].id_movimiento),null==e.compras[o].factura?n.push("PROFORMA"):n.push("factura : "+e.compras[o].factura),n.push(e.compras[o].saldo),n.push(a),n.push(a),t.push(n)}var i="SheetJS",s=new Workbook,c=sheet_from_array_of_arrays(t);s.SheetNames.push(i),s.Sheets[i]=c;var l=XLSX.write(s,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(l)],{type:"application/octet-stream"}),"REPORTE-ESTADO-CUENTA-PROVEEDOR.xlsx"),r.stop()},e.dibujarCabeceraPDFEstadoCuentasProveedor=function(e,t,a,o){e.font("Helvetica-Bold",12),e.text("ESTADO DE CUENTAS",0,25,{align:"center"}),e.font("Helvetica-Bold",8),e.text("PÁGINA "+t+" DE "+a,0,740,{align:"center"}),e.rect(30,50,555,30).stroke(),e.font("Helvetica-Bold",8),e.text("Acreedor : ",45,60),e.font("Helvetica",8),e.text(o.razon_social,140,60),e.rect(30,80,555,30).stroke(),e.font("Helvetica-Bold",8),e.text("Fecha",45,90),e.text("Nro. Recibo",170,90,{width:50}),e.text("Descripción",240,90,{width:60}),e.text("Monto",470,90,{width:50}),e.text("Total",530,90,{width:50}),e.font("Helvetica",8)},e.inicio()}]).controller("ControladorEstadoCuentasClientes",["$scope","$window","$localStorage","$location","$templateCache","$route","blockUI","$timeout","Paginator","uiGmapGoogleMapApi","$cordovaGeolocation","ReportEstadoCuentasClientesDatos","InventariosCosto","ReporteClientesPaginador",function(e,t,a,o,n,r,i,s,c,l,u,p,d,h){i.start(),e.idModalTablaEstadoCuenta="tabla-estado-cuenta",e.usuario=JSON.parse(a.usuario),e.inicio=function(){e.obtenerClientes(),l.then(function(t){e.map={center:{latitude:-17.403800007775388,longitude:-66.11349012184144},zoom:17,bounds:{northeast:{latitude:-17.403800007775388,longitude:-66.11349012184144}}},e.options={scrollwheel:!1,mapTypeId:google.maps.MapTypeId.SATELLITE}})},e.$on("$viewContentLoaded",function(){ejecutarScriptsCliente(e.idModalTablaEstadoCuenta),i.stop()}),e.obtenerClientes=function(){e.paginator=c(),e.paginator.column="codigo",e.paginator.callBack=e.obtenerLista,e.filtro={empresa:e.usuario.id_empresa,cuentas_liquidadas:0},e.paginator.getSearch("",e.filtro,null)},e.obtenerLista=function(){i.start(),h(e.paginator).then(function(t){e.paginator.setPages(t.paginas),e.clientes=t.clientes,i.stop()})},e.generarExcelEstadoCuentasClientesSeleccionados=function(t){for(var a=[],o=0;o<t.length;o++)(a=a.concat(e.generarExcelCliente(t[o],0))).push([]);var n="SheetJS",r=new Workbook,s=sheet_from_array_of_arrays(a);r.SheetNames.push(n),r.Sheets[n]=s;var c=XLSX.write(r,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(c)],{type:"application/octet-stream"}),"REPORTE-ESTADO-CUENTA-CLIENTES.xlsx"),i.stop()},e.generarExcelCliente=function(e,t){for(var a=[["","","ESTADO CUENTAS CLIENTE"],["Deudor :"+e.razon_social],["Fecha","N Recibo","Descripción","monto","total","total General"]],o=0,n=0;n<e.ventas.length;n++){var r=[];if(o+=e.ventas[n].saldo,e.ventas[n].fecha=new Date(e.ventas[n].fecha),r.push(e.ventas[n].fecha.getDate()+"/"+(e.ventas[n].fecha.getMonth()+1)+"/"+e.ventas[n].fecha.getFullYear()),r.push(e.ventas[n].id_movimiento),"FACT"!=e.ventas[n].movimiento.clase.nombre_corto?r.push("PROFORMA :"+e.ventas[n].factura):r.push("Factura : "+e.ventas[n].factura),r.push(e.ventas[n].saldo),r.push(o),r.push(o),a.push(r),0!=t&&0!=e.ventas[n].pagosVenta.length)for(var i=0;i<e.ventas[n].pagosVenta.length;i++){var s=[];date=new Date(e.ventas[n].pagosVenta[i].createdAt),s.push(""),s.push(date.getDate()+"/"+(date.getMonth()+1)+"/"+date.getFullYear()),s.push(e.ventas[n].pagosVenta[i].numero_documento),s.push("Pago a/c Factura nro.  "+e.ventas[n].factura+"("+e.ventas[n].pagosVenta[i].total+" -)"),s.push(e.ventas[n].pagosVenta[i].total),a.push(s)}}return a},e.verificarPulso=function(t,a){13===t.keyCode&&e.buscarClientes(1,e.itemsPorPagina,a)},e.generarPdfEstadoCuentasCliente=function(t,a){i.start();var o=new PDFDocument({size:"letter",margin:10}),n=o.pipe(blobStream()),r=0,s=120,c=0,l=1,u=Math.ceil(t.ventas.length/33);e.dibujarCabeceraPDFEstadoCuentasCliente(o,1,u,t),o.font("Helvetica",8);for(var p=0;p<t.ventas.length&&c<=33;p++){if(o.rect(30,s-10,555,20).stroke(),t.ventas[p].fecha=new Date(t.ventas[p].fecha),o.text(t.ventas[p].fecha.getDate()+"/"+(t.ventas[p].fecha.getMonth()+1)+"/"+t.ventas[p].fecha.getFullYear(),45,s),o.text(t.ventas[p].id_movimiento,170,s,{width:45,align:"right"}),"FACT"!=t.ventas[p].movimiento.clase.nombre_corto?o.text("PROFORMA nro. "+t.ventas[p].factura+"  (Bs. "+t.ventas[p].total+")",240,s):o.text("Factura nro. "+t.ventas[p].factura+" (Bs. "+t.ventas[p].total+")",240,s),o.text(t.ventas[p].saldo,475,s,{width:50,align:"right"}),o.text(t.ventas[p].fecha_vencimiento.getDate()+"/"+(t.ventas[p].fecha_vencimiento.getMonth()+1)+"/"+t.ventas[p].fecha_vencimiento.getFullYear(),425,s,{width:50,align:"right"}),r+=t.ventas[p].saldo,o.text(r,530,s,{width:50,align:"right"}),0!=a&&0!=t.ventas[p].pagosVenta.length)for(var d=0;d<t.ventas[p].pagosVenta.length;d++)s+=20,o.rect(30,s-10,0,20).stroke(),o.rect(585,s-10,0,20).stroke(),date=new Date(t.ventas[p].pagosVenta[d].createdAt),o.text(date.getDate()+"/"+(date.getMonth()+1)+"/"+date.getFullYear(),100,s,{width:50,align:"right"}),o.text(t.ventas[p].pagosVenta[d].numero_documento,170,s,{width:50,align:"right"}),"FACT"!=t.ventas[p].movimiento.clase.nombre_corto?o.text("Pago a/c Proforma nro.  "+t.ventas[p].factura+" ("+t.ventas[p].pagosVenta[d].total+" -)  (Bs. "+t.ventas[p].pagosVenta[d].monto_pagado+")",240,s):o.text("Pago a/c Factura nro.  "+t.ventas[p].factura+" ("+t.ventas[p].pagosVenta[d].total+" -)  (Bs. "+t.ventas[p].pagosVenta[d].monto_pagado+")",240,s),o.text(t.ventas[p].pagosVenta[d].total,475,s,{width:50,align:"right"});s+=20,33==++c&&(o.addPage({margin:0,bufferPages:!0}),s=120,c=0,l+=1,e.dibujarCabeceraPDFEstadoCuentasCliente(o,l,u,t),o.font("Helvetica",8))}o.rect(30,s-10,555,20).stroke(),o.font("Helvetica-Bold",8),o.text("Total General",380,s),o.text(r,475,s,{width:50,align:"right"});var h=new Date;o.font("Helvetica",6),o.text("EMISIÓN: "+h.getDate()+"/"+(h.getMonth()+1)+"/"+h.getFullYear(),180,s+15),o.text("IMPRESIÓN: "+h.getDate()+"/"+(h.getMonth()+1)+"/"+h.getFullYear(),240,s+15),o.text("USUARIO: "+e.usuario.persona.nombre_completo,35,s+15),l>u||o.text(l+" de "+u,560,s+15),o.end(),n.on("finish",function(){var e=n.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),i.stop()},e.generarExcelEstadoCuentasCliente=function(t,a){var o=e.generarExcelCliente(t,a),n="SheetJS",r=new Workbook,s=sheet_from_array_of_arrays(o);r.SheetNames.push(n),r.Sheets[n]=s;var c=XLSX.write(r,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(c)],{type:"application/octet-stream"}),"REPORTE-ESTADO-CUENTA-CLIENTES.xlsx"),i.stop()},e.click=function(){setTimeout(function(){angular.element(document.getElementsByClassName("verDetallePago")).triggerHandler("click")},0)},e.dibujarCabeceraPDFEstadoCuentasCliente=function(t,a,o,n){t.font("Helvetica-Bold",8),t.text(e.usuario.empresa.razon_social,35,10),t.font("Helvetica",8),t.text(e.usuario.empresa.direccion,35,20);var r=(null!=e.usuario.empresa.telefono1?e.usuario.empresa.telefono1:"")+(null!=e.usuario.empresa.telefono2?"-"+e.usuario.empresa.telefono2:"")+(null!=e.usuario.empresa.telefono3?"-"+e.usuario.empresa.telefono3:"");t.text("TELF. :"+r,35,30),t.text("COCHABAMBA - BOLIVIA ",35,40),t.font("Helvetica",8),t.font("Helvetica-Bold",12),t.text("ESTADO DE CUENTAS",0,25,{align:"center"}),t.font("Helvetica-Bold",8),t.text("PÁGINA "+a+" DE "+o,0,740,{align:"center"}),t.rect(30,50,555,30).stroke(),t.font("Helvetica-Bold",8),t.text("Deudor : ",45,60),t.font("Helvetica",8),t.text(n.razon_social,140,60),t.rect(30,80,555,30).stroke(),t.font("Helvetica-Bold",8),t.text("Fecha",45,90),t.text("Nro. Recibo",170,90,{width:50}),t.text("Descripción",240,90,{width:60}),t.text("F.Venc",440,90,{width:50}),t.text("Saldo",500,90,{width:50}),t.text("Total",560,90,{width:50}),t.font("Helvetica",8)},e.abrirEstadoCuentaCliente=function(t){e.totalPagado=0;for(var a=0;a<t.ventas.length;a++){var o=new Date(t.ventas[a].fecha);t.ventas[a].totalgeneral=0,t.ventas[a].totalPago=0,t.ventas[a].totalgeneral=0==a?t.ventas[a].totalgeneral+t.ventas[a].saldo:t.ventas[a-1].totalgeneral+t.ventas[a].saldo;for(var n=0;n<t.ventas[a].pagosVenta.length;n++)t.ventas[a].pagosVenta[n].total=t.ventas[a].pagosVenta[n].saldo_anterior-t.ventas[a].pagosVenta[n].monto_pagado,t.ventas[a].totalPago=t.ventas[a].totalPago+t.ventas[a].pagosVenta[n].monto_pagado;t.ventas[a].fecha_vencimiento=e.sumaFecha(t.ventas[a].dias_credito,o)}a=t.ventas.length-1;e.totalgeneral=0,e.totalgeneral=t.ventas[a].totalgeneral,e.clienteVentas=t,e.abrirPopup(e.idModalTablaEstadoCuenta)},e.verDetallePagos=function(e){"none"==$("#"+e.id_movimiento).css("display")?$("#"+e.id_movimiento).css("display",""):$("#"+e.id_movimiento).css("display","none")},e.cerrarEstadoCuentaCliente=function(){e.cerrarPopup(e.idModalTablaEstadoCuenta)},e.abrirPopup=function(e){abrirPopup(e)},e.cerrarPopup=function(e){ocultarPopup(e)},e.eliminarPopup=function(e){eliminarPopup(e)},e.imprimirRecibo=function(t,a){i.start();var o=new PDFDocument({size:[227,353],margin:10}),n=o.pipe(blobStream());o.moveDown(2),o.font("Helvetica-Bold",8),o.text(e.usuario.empresa.razon_social.toUpperCase(),{align:"center"}),o.moveDown(.4),o.font("Helvetica",7),o.text(a.almacen.sucursal.nombre.toUpperCase(),{align:"center"}),o.moveDown(.4),o.text(a.almacen.sucursal.direccion.toUpperCase(),{align:"center"}),o.moveDown(.4);var r=(null!=a.almacen.sucursal.telefono1?a.almacen.sucursal.telefono1:"")+(null!=a.almacen.sucursal.telefono2?"-"+a.almacen.sucursal.telefono2:"")+(null!=a.almacen.sucursal.telefono3?"-"+a.almacen.sucursal.telefono3:"");o.text("TELF.: "+r,{align:"center"}),o.moveDown(.4),o.text("COCHABAMBA - BOLIVIA",{align:"center"}),o.moveDown(.5),o.font("Helvetica-Bold",8),o.text("RECIBO",{align:"center"}),o.font("Helvetica",7),o.moveDown(.4),o.text("------------------------------------",{align:"center"}),o.moveDown(.4),o.text(t.numero_documento,{align:"center"}),o.moveDown(.4),o.moveDown(.4),o.text("------------------------------------",{align:"center"}),o.moveDown(.4),o.moveDown(.6);var s=new Date;o.text("FECHA : "+s.getDate()+"/"+(s.getMonth()+1)+"/"+s.getFullYear(),{align:"left"}),o.moveDown(.4),o.text("He recibido de : "+e.clienteVentas.razon_social,{align:"left"}),o.moveDown(.4),o.text("---------------------------------------------------------------------------------",{align:"center"}),o.moveDown(.2),o.text("CONCEPTO",{align:"left"}),o.moveDown(.2),o.text("---------------------------------------------------------------------------------",{align:"center"}),o.moveDown(.4),a.fecha=new Date(a.fecha),o.text("Fecha: "+a.fecha.getDate()+"/"+(a.fecha.getMonth()+1)+"/"+a.fecha.getFullYear(),15,210);var c=a.movimiento.clase.nombre_corto==e.diccionario.EGRE_FACTURACION?"Factura nro. "+a.factura:"Proforma nro. "+a.factura;o.text(c,105,210,{width:100}),o.text("Saldo Bs "+t.saldo_anterior+".-",105,220,{width:100}),o.text("Bs "+t.monto_pagado+".-",170,210,{width:100}),o.text("--------------",10,230,{align:"right"}),o.moveDown(.3),o.text("TOTAL Bs.              "+t.monto_pagado,{align:"right"}),o.moveDown(.4),o.moveDown(.4),o.moveDown(.6),o.moveDown(.4),o.moveDown(.4),o.moveDown(.4),o.moveDown(.4),o.moveDown(.4),o.moveDown(.4),o.moveDown(.4),o.moveDown(.4),o.moveDown(.4),o.moveDown(.4),o.moveDown(.4),o.moveDown(.4),o.moveDown(.4),o.text("-------------------------                       -------------------------",{align:"center"}),o.text("ENTREGUE CONFORME            RECIBI CONFORME",{align:"center"}),o.end(),n.on("finish",function(){var e=n.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),i.stop()},e.$on("$routeChangeStart",function(t,a){e.eliminarPopup(e.idModalTablaEstadoCuenta)}),e.inicio()}]).controller("ControladorLibroVentas",["$scope","$localStorage","$location","$templateCache","$route","blockUI","ClasesTipo","ReporteLibroVentasDatos",function(e,t,a,o,n,r,i,s){e.usuario=JSON.parse(t.usuario),e.inicio=function(){e.obtenerGestiones(),e.obtenerMovimientosEgreso()},e.obtenerGestiones=function(){r.start(),i("GTN").then(function(t){e.gestiones=t.clases,r.stop()})},e.obtenerMovimientosEgreso=function(){r.start(),i("MOVEGR").then(function(t){e.movimientosEgreso=t.clases,r.stop()})},e.generarTXTLibroVentas=function(t){r.start(),s(e.usuario.id_empresa,t.gestion,t.mes.split("-")[0]).then(function(e){for(var a=e.ventas,o="",n=0;n<a.length;n++)a[n].fecha=new Date(a[n].fecha),o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=o+a[n].fecha.getDate()+"/"+(a[n].fecha.getMonth()+1)+"/"+a[n].fecha.getFullYear()+"|")+a[n].factura+"|")+a[n].autorizacion+"|")+(a[n].activa?"V":"A")+"|")+a[n].cliente.nit+"|")+a[n].cliente.razon_social+"|")+a[n].importe+"|")+0+"|")+0+"|")+0+"|")+a[n].importe+"|")+0+"|")+a[n].total+"|")+Math.round(.13*a[n].total*100)/100+"|",o+=a[n].codigo_control,o+="\n";var i=new Blob([o.replace(/\n/g,"\r\n")],{type:"text/plain"});saveAs(i,"ventas_"+t.mes.split("-")[0]+t.gestion+"_"+e.empresa.nit+".txt"),r.stop()})},e.generarExcelLibroVentas=function(t){r.start(),s(e.usuario.id_empresa,t.gestion,t.mes.split("-")[0]).then(function(e){for(var t=e.ventas,a=[["N°","FECHA DE LA FACTURA","N° DE LA FACTURA","N° DE AUTORIZACION","ESTADO","NIT/CI CLIENTE","NOMBRE O RAZON SOCIAL","IMPORTE TOTAL DE LA VENTA","IMPORTE ICE/IEHD/TASAS","EXPORTACIONES Y OPERACIONES EXENTAS","VENTAS GRAVADAS A TASA CERO","SUBTOTAL","DESCUENTOS, BONIFICACIONES Y REBAJAS OBTENIDAS","IMPORTE BASE PARA DEBITO FISCAL","DEBITO FISCAL","CODIGO DE CONTROL"]],o=0,n=0,i=0,s=0,c=0,l=0,u=0,p=0,d=0;d<t.length;d++){var h=[];t[d].fecha=new Date(t[d].fecha),h.push(d+1),h.push(t[d].fecha.getDate()+"/"+(t[d].fecha.getMonth()+1)+"/"+t[d].fecha.getFullYear()),h.push(t[d].factura),h.push(t[d].autorizacion?t[d].autorizacion:""),h.push(t[d].activa?"V":"A"),h.push(t[d].cliente.nit),h.push(t[d].cliente.razon_social),h.push(t[d].importe),h.push(0),h.push(0),h.push(0),h.push(t[d].importe),h.push(0),h.push(t[d].total),h.push(Math.round(.13*t[d].total*100)/100),h.push(t[d].codigo_control?t[d].codigo_control:""),o+=t[d].importe,n=0,i=0,s=0,c+=t[d].importe,l+=0,u+=t[d].total,p+=Math.round(.13*t[d].total*100)/100,a.push(h),d+1==t.length&&((h=[]).push(""),h.push(""),h.push(""),h.push(""),h.push(""),h.push(""),h.push("TOTALES"),h.push(Math.round(100*o)/100),h.push(Math.round(100*n)/100),h.push(Math.round(100*i)/100),h.push(Math.round(100*s)/100),h.push(Math.round(100*c)/100),h.push(Math.round(100*l)/100),h.push(Math.round(100*u)/100),h.push(Math.round(100*p)/100),a.push(h))}var m="SheetJS",v=new Workbook,f=sheet_from_array_of_arrays(a);v.SheetNames.push(m),v.Sheets[m]=f;var g=XLSX.write(v,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(g)],{type:"application/octet-stream"}),"LIBRO-VENTAS.xlsx"),r.stop()})},e.generarPdfLibroVentas=function(t){r.start(),s(e.usuario.id_empresa,t.gestion,t.mes.split("-")[0],t.movimiento).then(function(a){var o=a.ventas,n=new PDFDocument({compress:!1,margin:10,layout:"landscape"}),i=n.pipe(blobStream());e.dibujarCabeceraPDFLibroVentas(n,a,t,1),n.font("Helvetica",8);for(var s=170,c=0,l=1,u=0,p=0,d=0,h=0,m=0,v=0,f=0,g=0,x=0,b=0,E=0,A=0,C=0,D=0,S=0,O=0,T=0;T<o.length&&c<=12;T++)n.rect(40,s-10,720,30).stroke(),o[T].fecha=new Date(o[T].fecha),n.text(T+1,45,s),n.text(o[T].fecha.getDate()+"/"+(o[T].fecha.getMonth()+1)+"/"+o[T].fecha.getFullYear(),65,s),n.text(o[T].factura,110,s),n.text(o[T].autorizacion,145,s),n.text(o[T].activa?"V":"A",210,s),n.text(o[T].cliente.nit,235,s),n.text(o[T].cliente.razon_social,283,s-6,{width:100}),n.text(o[T].importe,385,s),n.text(0,430,s),n.text(0,465,s),n.text(0,507,s),n.text(o[T].importe,540,s),n.text(0,580,s),n.text(o[T].total,615,s),n.text(Math.round(.13*o[T].total*100)/100,650,s),n.text(o[T].codigo_control,685,s),s+=30,x+=o[T].importe,b=0,E=0,A=0,C+=o[T].importe,D+=0,S+=o[T].total,O+=Math.round(.13*o[T].total*100)/100,u+=o[T].importe,p=0,d=0,h=0,m+=o[T].importe,v+=0,f+=o[T].total,g+=Math.round(.13*o[T].total*100)/100,12!=++c&&T+1!=o.length||(n.font("Helvetica-Bold",8),n.text("SUBTOTALES",283,s),n.text(Math.round(100*x)/100,385,s),n.text(Math.round(100*b)/100,430,s),n.text(Math.round(100*E)/100,465,s),n.text(Math.round(100*A)/100,507,s),n.text(Math.round(100*C)/100,540,s),n.text(Math.round(100*D)/100,580,s),n.text(Math.round(100*S)/100,615,s),n.text(Math.round(100*O)/100,650,s),n.rect(40,s-10,720,30).stroke(),n.font("Helvetica",8),x=0,sumaSubImporteNo=0,C=0,D=0,S=0,O=0,T+1==o.length?(n.font("Helvetica-Bold",8),n.text("TOTALES",283,s+30),n.text(Math.round(100*u)/100,385,s+30),n.text(Math.round(100*p)/100,430,s+30),n.text(Math.round(100*d)/100,465,s+30),n.text(Math.round(100*h)/100,507,s+30),n.text(Math.round(100*m)/100,540,s+30),n.text(Math.round(100*v)/100,580,s+30),n.text(Math.round(100*f)/100,615,s+30),n.text(Math.round(100*g)/100,650,s+30),n.rect(40,s-10+30,720,30).stroke(),n.font("Helvetica",8)):(n.addPage({margin:0,bufferPages:!0,layout:"landscape"}),s=170,c=0,l+=1,e.dibujarCabeceraPDFLibroVentas(n,a,t,l),n.font("Helvetica",8)));n.end(),i.on("finish",function(){var e=i.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),r.stop()})},e.dibujarCabeceraPDFLibroVentas=function(e,t,a,o){e.font("Helvetica-Bold",12),e.text("LIBRO DE VENTAS IVA ESTÁNDAR",0,25,{align:"center"}),e.font("Helvetica-Bold",8),e.text("FOLIO "+o,720,25),e.rect(40,60,720,40).stroke(),e.text("PERIÓDO FISCAL : ",65,70),e.text("NOMBRE O RAZÓN SOCIAL : ",65,85),e.text("NIT : ",440,85),e.font("Helvetica",8),e.text("AÑO "+a.gestion,140,70),e.text("MES "+a.mes.split("-")[1],200,70),e.text(t.empresa.razon_social,195,85),e.text(t.empresa.nit,460,85),e.rect(40,100,720,60).stroke(),e.font("Helvetica-Bold",8),e.text("Nº",45,110),e.text("Fecha de la Factura",65,110,{width:40}),e.text("Nº de la Factura",110,110,{width:50}),e.text("Nº de Autorización",145,110,{width:50}),e.text("Estado",205,110,{width:35}),e.text("NIT / CI Cliente",235,110,{width:50}),e.text("Nombre o Razón Social",280,110),e.text("Importe Total de la Venta",385,110,{width:35}),e.text("Importe ICE IE HD/T",425,110,{width:35}),e.text("Exp. y Op. exentas",460,110,{width:42}),e.text("Ventas grabadas a Tasa Cero",502,110,{width:42}),e.text("Subtotal",540,110,{width:40}),e.text("Desc., Bonif. y Rebajas",575,110,{width:42}),e.text("Importe Base para Débito Fiscal",615,110,{width:35}),e.text("Débito Fiscal I.V.A.",650,110,{width:35}),e.text("Código de Control",685,110)},e.inicio()}]).controller("ControladorLibroCompras",["$scope","$localStorage","$location","$templateCache","$route","blockUI","ClasesTipo","ReporteLibroComprasDatos",function(e,t,a,o,n,r,i,s){e.usuario=JSON.parse(t.usuario),e.inicio=function(){e.obtenerGestiones()},e.obtenerGestiones=function(){r.start(),i("GTN").then(function(t){e.gestiones=t.clases,r.stop()})},e.generarTXTLibroCompras=function(t){r.start(),s(e.usuario.id_empresa,t.gestion,t.mes.split("-")[0]).then(function(a){for(var o=a.compras,n="",i=1,s=0;s<o.length;s++){if(o[s].movimiento.clase.nombre!==e.diccionario.MOVING_POR_COMPRA_SIN_FACTURA&&o[s].movimiento.clase.nombre!==e.diccionario.MOVING_POR_RETENCION_BIENES)o[s].fecha=new Date(o[s].fecha),n=(n=(n=(n=(n=(n+="1|")+i+"|")+(o[s].fecha.getDate()<10?"0"+o[s].fecha.getDate():o[s].fecha.getDate())+"/"+(o[s].fecha.getMonth()+1<10?"0"+(o[s].fecha.getMonth()+1):o[s].fecha.getMonth()+1)+"/"+o[s].fecha.getFullYear()+"|")+o[s].proveedor.nit+"|")+o[s].proveedor.razon_social+"|")+o[s].factura+"|",n=(n=(n=(n=(n=(n=(n=(n=(n+="0|")+o[s].autorizacion+"|")+o[s].importe+"|")+0+"|")+o[s].importe+"|")+(o[s].descuento-o[s].recargo+o[s].ice+o[s].excento)+"|")+o[s].total+"|")+Math.round(.13*o[s].total*100)/100+"|")+o[s].codigo_control+"|",n+="1\n",i++}var c=new Blob([n.replace(/\n/g,"\r\n")],{type:"text/plain"});saveAs(c,"compras_"+t.mes.split("-")[0]+t.gestion+"_"+a.empresa.nit+".txt"),r.stop()})},e.generarExcelLibroCompras=function(t){r.start(),s(e.usuario.id_empresa,t.gestion,t.mes.split("-")[0]).then(function(t){for(var a=t.compras,o=[["N°","FECHA DE LA FACTURA O DUI","NIT PROVEEDOR","NOMBRE Y APELLIDOS/RAZON SOCIAL","N° DE LA FACTURA","N° DE DUI","N° DE AUTORIZACION","IMPORTE TOTAL DE LA COMPRA","IMPORTE NO SUJETO A CREDITO FISCAL","SUBTOTAL","DESCUENTOS, BONIFICACIONES Y REBAJAS OBTENIDAS","IMPORTE BASE PARA CREDITO FISCAL","CREDITO FISCAL","CODIGO DE CONTROL","TIPO DE COMPRA"]],n=0,i=0,s=0,c=0,l=0,u=0,p=1,d=0;d<a.length;d++){var h=[];if(a[d].movimiento.clase.nombre!==e.diccionario.MOVING_POR_COMPRA_SIN_FACTURA&&a[d].movimiento.clase.nombre!==e.diccionario.MOVING_POR_RETENCION_BIENES){a[d].fecha=new Date(a[d].fecha),h.push(p),h.push(a[d].fecha.getDate()+"/"+(a[d].fecha.getMonth()+1)+"/"+a[d].fecha.getFullYear()),h.push(a[d].proveedor.nit),h.push(a[d].proveedor.razon_social),h.push(a[d].factura),h.push(0),h.push(a[d].autorizacion),h.push(a[d].importe),h.push(0),h.push(a[d].importe);var m=a[d].descuento-a[d].recargo+a[d].ice+a[d].excento;h.push(m),h.push(a[d].total),h.push(Math.round(.13*a[d].total*100)/100),h.push(a[d].codigo_control),h.push(1),n+=a[d].importe,i=0,s+=a[d].importe,c+=m,l+=a[d].total,u+=Math.round(.13*a[d].total*100)/100,o.push(h),d+1==a.length&&((h=[]).push(""),h.push(""),h.push(""),h.push(""),h.push(""),h.push(""),h.push("TOTALES"),h.push(Math.round(100*n)/100),h.push(Math.round(100*i)/100),h.push(Math.round(100*s)/100),h.push(Math.round(100*c)/100),h.push(Math.round(100*l)/100),h.push(Math.round(100*u)/100),o.push(h)),p++}}var v="SheetJS",f=new Workbook,g=sheet_from_array_of_arrays(o);f.SheetNames.push(v),f.Sheets[v]=g;var x=XLSX.write(f,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(x)],{type:"application/octet-stream"}),"LIBRO-COMPRAS.xlsx"),r.stop()})},e.generarPdfLibroCompras=function(t){r.start(),s(e.usuario.id_empresa,t.gestion,t.mes.split("-")[0]).then(function(a){var o=a.compras,n=new PDFDocument({margin:10,layout:"landscape"}),i=n.pipe(blobStream());e.dibujarCabeceraPDFLibroCompras(n,a,t,1),n.font("Helvetica",8);for(var s=1,c=170,l=0,u=1,p=0,d=0,h=0,m=0,v=0,f=0,g=0,x=0,b=0,E=0,A=0,C=0,D=0;D<o.length&&l<=12;D++)if(o[D].movimiento.clase.nombre!==e.diccionario.MOVING_POR_COMPRA_SIN_FACTURA&&o[D].movimiento.clase.nombre!==e.diccionario.MOVING_POR_RETENCION_BIENES){n.rect(40,c-10,720,30).stroke(),o[D].fecha=new Date(o[D].fecha),n.text(s,45,c),n.text(o[D].fecha.getDate()+"/"+(o[D].fecha.getMonth()+1)+"/"+o[D].fecha.getFullYear(),65,c),n.text(o[D].proveedor.nit,110,c),n.text(o[D].proveedor.razon_social,165,c-6,{width:100}),n.text(o[D].factura,275,c),n.text(0,320,c),n.text(o[D].autorizacion,335,c),n.text(o[D].importe,410,c),n.text(0,450,c),n.text(o[D].importe,480,c);var S=o[D].descuento-o[D].recargo+o[D].ice+o[D].excento;n.text(S,520,c),n.text(o[D].total,565,c),n.text(Math.round(.13*o[D].total*100)/100,605,c),n.text(o[D].codigo_control,640,c),n.text(1,740,c),c+=30,g+=o[D].importe,x=0,b+=o[D].importe,E+=S,A+=o[D].total,C+=Math.round(.13*o[D].total*100)/100,p+=o[D].importe,d=0,h+=o[D].importe,m+=S,v+=o[D].total,f+=Math.round(.13*o[D].total*100)/100,12!=++l&&D+1!=o.length||(n.font("Helvetica-Bold",8),n.text("SUBTOTALES",320,c),n.text(Math.round(100*g)/100,400,c),n.text(Math.round(100*x)/100,450,c),n.text(Math.round(100*b)/100,480,c),n.text(Math.round(100*E)/100,520,c),n.text(Math.round(100*A)/100,565,c),n.text(Math.round(100*C)/100,605,c),n.rect(40,c-10,720,30).stroke(),n.font("Helvetica",8),g=0,x=0,b=0,E=0,A=0,C=0,D+1==o.length?(n.font("Helvetica-Bold",8),n.text("TOTALES",320,c+30),n.text(Math.round(100*p)/100,400,c+30),n.text(Math.round(100*d)/100,450,c+30),n.text(Math.round(100*h)/100,480,c+30),n.text(Math.round(100*m)/100,520,c+30),n.text(Math.round(100*v)/100,565,c+30),n.text(Math.round(100*f)/100,605,c+30),n.rect(40,c-10+30,720,30).stroke(),n.font("Helvetica",8)):(n.addPage({margin:0,bufferPages:!0,layout:"landscape"}),c=170,l=0,u+=1,e.dibujarCabeceraPDFLibroCompras(n,a,t,u),n.font("Helvetica",8))),s++}n.end(),i.on("finish",function(){var e=i.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),r.stop()})},e.dibujarCabeceraPDFLibroCompras=function(e,t,a,o){e.font("Helvetica-Bold",12),e.text("LIBRO DE COMPRAS IVA ESTÁNDAR",0,25,{align:"center"}),e.font("Helvetica-Bold",8),e.text("FOLIO "+o,720,25),e.rect(40,60,720,40).stroke(),e.text("PERIÓDO FISCAL : ",65,70),e.text("NOMBRE O RAZÓN SOCIAL : ",65,85),e.text("NIT : ",440,85),e.font("Helvetica",8),e.text("AÑO "+a.gestion,140,70),e.text("MES "+a.mes.split("-")[1],200,70),e.text(t.empresa.razon_social,195,85),e.text(t.empresa.nit,460,85),e.rect(40,100,720,60).stroke(),e.font("Helvetica-Bold",8),e.text("Nº",45,110),e.text("Fecha de la Factura o DUI",65,110,{width:40}),e.text("NIT Proveedor",110,110,{width:50}),e.text("Nombre o Razón Social",165,110),e.text("Nº de la Factura",275,110,{width:50}),e.text("Nº de DUI",320,110,{width:30}),e.text("Nº de Autorización",345,110,{width:50}),e.text("Importe Total de la Compra",400,110,{width:35}),e.text("Importe No Sujeto a Crédito Fiscal",440,110,{width:35}),e.text("Subtotal",480,110),e.text("Descuentos, Bonificaciones y Rebajas",520,110,{width:40}),e.text("Importe Base para Crédito Fiscal",565,110,{width:35}),e.text("Crédito Fiscal I.V.A.",605,110,{width:35}),e.text("Código de Control",640,110),e.text("Tipo de Compra",720,110,{width:35})},e.inicio()}]).controller("ControladorReporteAlmacenes",["$scope","$window","$localStorage","$location","$templateCache","$route","blockUI","InventariosCosto","InventarioPaginadorAlmacen","InventarioReporteAlmacen",function(e,t,a,o,n,r,i,s,c,l){e.usuario=JSON.parse(a.usuario),e.inicio=function(){e.sucursales=e.obtenerSucursales(),e.reporte={},e.itemsPorPagina=10,e.paginaActual=1,e.columna="cantidad",e.direccion="asc",e.textoBusqueda="",e.reporte.sucursal=1==e.sucursales.length?e.sucursales[0]:null,1==e.sucursales.length&&(e.obtenerAlmacenes(e.sucursales[0].id),e.reporte.almacen=1==e.almacenes.length?e.almacenes[0]:null)},e.obtenerAlmacenes=function(t){if(e.almacenes=[],void 0!==t&&null!==t){var a=$.grep(e.sucursales,function(e){return e.id==t})[0];e.almacenes=e.almacenes.concat(a.almacenes),e.reporte.almacen=1==e.almacenes.length?e.almacenes[0]:null}e.obtenerInventarios()},e.obtenerSucursales=function(){for(var t=[],a=0;a<e.usuario.sucursalesUsuario.length;a++)t.push(e.usuario.sucursalesUsuario[a].sucursal);return t},e.establecerAlmacenBusqueda=function(t){e.almacenBusqueda=t.almacen,e.sucursalBusqueda=t.sucursal,e.obtenerInventarios()},e.obtenerInventarios=function(){e.abs=t.Math.abs,void 0!==e.reporte.sucursal&&null!==e.reporte.sucursal?(e.sucursalBusqueda=e.reporte.sucursal,void 0!==e.reporte.almacen&&e.reporte.almacen?(e.almacenBusqueda=e.reporte.almacen,e.buscarInventarios(e.sucursalBusqueda.id,e.almacenBusqueda.id,e.paginaActual,e.itemsPorPagina,e.textoBusqueda,e.columna,e.direccion)):e.buscarInventarios(e.sucursalBusqueda.id,0,e.paginaActual,e.itemsPorPagina,e.textoBusqueda,e.columna,e.direccion)):(1==e.sucursales.length&&(e.reporte.sucursal=1==e.sucursales.length?e.sucursales[0]:null,1==e.sucursales.length&&(e.obtenerAlmacenes(e.sucursales[0].id),e.reporte.almacen=2==e.almacenes.length?e.almacenes[1]:null)),e.buscarInventarios(e.sucursalBusqueda.id,e.almacenBusqueda.id,e.paginaActual,e.itemsPorPagina,e.textoBusqueda,e.columna,e.direccion))},e.clasificarColumna=function(t){e.columna==t?"asc"==e.direccion?(e.direccion="desc",$("#"+t).removeClass("fa-caret-up"),$("#"+t).addClass("fa-caret-down")):(e.direccion="asc",$("#"+t).removeClass("fa-caret-down"),$("#"+t).addClass("fa-caret-up")):(e.direccion="asc",$(".sort").removeClass("fa-caret-up"),$(".sort").removeClass("fa-caret-down"),$(".sort").addClass("fa-sort"),$("#"+t).addClass("fa-caret-up"),$("#"+t).removeClass("fa-sort")),e.columna=t,void 0!==e.reporte.sucursal?(void 0!==e.reporte.almacen?e.almacenBusqueda=e.reporte.almacen:e.almacenBusqueda={id:0},e.buscarInventarios(e.reporte.sucursal.id,e.almacenBusqueda.id,e.paginaActual,e.itemsPorPagina,e.textoBusqueda,e.columna,e.direccion)):e.reporte.sucursal},e.buscarInventarios=function(t,a,o,n,r,s,l){i.start(),e.itemsPorPagina="TODOS"!==n?n:0,void 0!=t&&null!=t||(t=0),void 0!=a&&null!=a||(a=0),""==r||null==r?r=0:e.textoBusqueda=r,"todos"==n&&(n=e.inventarios.length*e.inventarios.paginas),e.paginaActual=o!=e.paginaActual?o:1,c(e.usuario.id_empresa,t,a,e.paginaActual,n,r,s,l,e.usuario.id).then(function(t){var a=t.inventario;e.paginas=[];for(var o=1;o<=t.paginas;o++)e.paginas.push(o);e.inventarios=a,e.inventarios.paginas=t.paginas,i.stop()}).catch(function(t){var a=void 0!==t.stack&&null!==t.stack?t.stack:void 0!==t.data&&null!==t.data?t.data:void 0!==t.message&&null!==t.message?t.message:" Error desconocido al buscar inventarios en reportes almacen,";e.mostrarMensaje("ERROR. "+a),i.stop()})},e.generarPdfAlmacenes=function(t){if(i.start(),t.solo_pagina_actual){var a=e.inventarios,o=new PDFDocument({margin:10,compress:!1}),n=o.pipe(blobStream()),r=0,s=90,c=0,u=1,p=Math.ceil(a.length/33);e.dibujarCabeceraPDFAlmacenes(o,1,p),o.font("Helvetica",7);for(var d=0;d<a.length&&c<=33;d++){var h,m;if(o.rect(30,s-10,555,20).stroke(),o.text(a[d].codigo,35,s),o.text(a[d].cantidad,110,s),o.text(a[d].unidad_medida,160,s),e.usuario.empresa.usar_vencimientos?(a[d].nombre.length>35?o.text(a[d].nombre,210,s-6,{width:170}):o.text(a[d].nombre,210,s,{width:170}),a[d].fecha_vencimiento=new Date(a[d].fecha_vencimiento),o.text(a[d].fecha_vencimiento.getDate()+"/"+(a[d].fecha_vencimiento.getMonth()+1)+"/"+a[d].fecha_vencimiento.getFullYear(),380,s),o.text(null==a[d].lote?"No definido.":a[d].lote,430,s)):o.text(a[d].nombre,210,s),o.text(a[d].costo_unitario.toFixed(2),470,s),o.text(a[d].costo_total.toFixed(2),530,s),s+=20,c++,r+=a[d].costo_total,33==c)(m=(h=new Date).getMinutes())<10&&(m="0"+m),o.text("USUARIO: "+e.usuario.nombre_usuario,45,s),o.text("EMISIÓN : "+h.getDate()+"/"+(h.getMonth()+1)+"/"+h.getFullYear()+" Hr. "+h.getHours()+":"+m,450,s),o.addPage({margin:0,bufferPages:!0}),s=90,c=0,u+=1,e.dibujarCabeceraPDFAlmacenes(o,u,p),o.font("Helvetica",7)}o.rect(30,s-10,555,20).stroke(),o.font("Helvetica-Bold",8),o.text("Total General",400,s),o.text(Math.round(100*r)/100,530,s),(m=(h=new Date).getMinutes())<10&&(m="0"+m),o.font("Helvetica",7),o.text("USUARIO: "+e.usuario.nombre_usuario,45,s+20),o.text("EMISIÓN : "+h.getDate()+"/"+(h.getMonth()+1)+"/"+h.getFullYear()+" Hr. "+h.getHours()+":"+m,450,s+20),o.end(),n.on("finish",function(){var e=n.toBlobURL("application/pdf");window.open(e,"_blank","location=no")})}else{l(e.usuario.id_empresa,t.sucursal.id,null!==t.almacen&&void 0!==t.almacen&&0!==t.almacen?t.almacen.id:0,e.usuario.id).then(function(t){var a=t.inventario,o=new PDFDocument({margin:10,compress:!1}),n=o.pipe(blobStream()),r=0,i=90,s=0,c=1,l=Math.ceil(a.length/33);e.dibujarCabeceraPDFAlmacenes(o,1,l),o.font("Helvetica",7);for(var u=0;u<a.length&&s<=33;u++){var p,d;if(o.rect(30,i-10,555,20).stroke(),o.text(a[u].codigo,35,i),o.text(a[u].cantidad,110,i),o.text(a[u].unidad_medida,160,i),e.usuario.empresa.usar_vencimientos?(a[u].nombre.length>35?o.text(a[u].nombre,210,i-6,{width:170}):o.text(a[u].nombre,210,i,{width:170}),a[u].fecha_vencimiento=new Date(a[u].fecha_vencimiento),o.text(a[u].fecha_vencimiento.getDate()+"/"+(a[u].fecha_vencimiento.getMonth()+1)+"/"+a[u].fecha_vencimiento.getFullYear(),380,i),o.text(null==a[u].lote?"No definido.":a[u].lote,430,i)):o.text(a[u].nombre,210,i),o.text(a[u].costo_unitario.toFixed(2),470,i),o.text(a[u].costo_total.toFixed(2),530,i),i+=20,s++,r+=a[u].costo_total,33==s)(d=(p=new Date).getMinutes())<10&&(d="0"+d),o.text("USUARIO: "+e.usuario.nombre_usuario,45,i),o.text("EMISIÓN : "+p.getDate()+"/"+(p.getMonth()+1)+"/"+p.getFullYear()+" Hr. "+p.getHours()+":"+d,450,i),o.addPage({margin:0,bufferPages:!0}),i=90,s=0,c+=1,e.dibujarCabeceraPDFAlmacenes(o,c,l),o.font("Helvetica",7)}o.rect(30,i-10,555,20).stroke(),o.font("Helvetica-Bold",8),o.text("Total General",400,i),o.text(Math.round(100*r)/100,530,i),(d=(p=new Date).getMinutes())<10&&(d="0"+d),o.font("Helvetica",7),o.text("USUARIO: "+e.usuario.nombre_usuario,45,i+20),o.text("EMISIÓN : "+p.getDate()+"/"+(p.getMonth()+1)+"/"+p.getFullYear()+" Hr. "+p.getHours()+":"+d,450,i+20),o.end(),n.on("finish",function(){var e=n.toBlobURL("application/pdf");window.open(e,"_blank","location=no")})})}i.stop()},e.generarExcelAlmacenes=function(t){if(i.start(),t.solo_pagina_actual){for(var a=e.inventarios,o=[["Código","Nombre","Unidad de Medida","Precio Unitario","Descripción","Inventario Mínimo","Grupo","Sub-Grupo","Carac. Esp. 1","Carac. Esp. 2","Codigo de fabrica","Cant.","Costo Unitario","Total General","Fecha Vencimiento","Lote","Sucursal","Almacen"]],n=0;n<a.length;n++){a[n].fecha_vencimiento=a[n].fecha_vencimiento?new Date(a[n].fecha_vencimiento):null;var r=[];r.push(a[n].codigo),r.push(a[n].nombre),r.push(a[n].unidad_medida),r.push(a[n].precio_unitario),r.push(a[n].descripcion),r.push(a[n].inventario_minimo),r.push(a[n].grupo),r.push(a[n].subgrupo),r.push(a[n].caracteristica_especial1),r.push(a[n].caracteristica_especial2),r.push(a[n].codigo_fabrica),r.push(a[n].cantidad),r.push(a[n].costo_unitario),r.push(a[n].costo_total),r.push(a[n].fecha_vencimiento),r.push(a[n].lote),r.push(a[n].nombre_sucursal),r.push(a[n].nombre_almacen),o.push(r)}var s="SheetJS",c=new Workbook,u=sheet_from_array_of_arrays(o);c.SheetNames.push(s),c.Sheets[s]=u;var p=XLSX.write(c,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(p)],{type:"application/octet-stream"}),"REPORTE-ALMACENES.xlsx")}else{l(e.usuario.id_empresa,t.sucursal.id,t.almacen&&null!==t.almacen&&0!==t.almacen?t.almacen.id:0,e.usuario.id).then(function(e){for(var t=e.inventario,a=[["Código","Nombre","Unidad de Medida","Precio Unitario","Descripción","Inventario Mínimo","Grupo","Sub-Grupo","Carac. Esp. 1","Carac. Esp. 2","Codigo de fabrica","Cant.","Costo Unitario","Total General","Fecha Vencimiento","Lote","Sucursal","Almacen"]],o=0;o<t.length;o++){t[o].fecha_vencimiento=t[o].fecha_vencimiento?new Date(t[o].fecha_vencimiento):null;var n=[];n.push(t[o].codigo),n.push(t[o].nombre),n.push(t[o].unidad_medida),n.push(t[o].precio_unitario),n.push(t[o].descripcion),n.push(t[o].inventario_minimo),n.push(t[o].grupo),n.push(t[o].subgrupo),n.push(t[o].caracteristica_especial1),n.push(t[o].caracteristica_especial2),n.push(t[o].codigo_fabrica),n.push(t[o].cantidad),n.push(t[o].costo_unitario),n.push(t[o].costo_total),n.push(t[o].fecha_vencimiento),n.push(t[o].lote),n.push(t[o].nombre_sucursal),n.push(t[o].nombre_almacen),a.push(n)}var r="SheetJS",i=new Workbook,s=sheet_from_array_of_arrays(a);i.SheetNames.push(r),i.Sheets[r]=s;var c=XLSX.write(i,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(c)],{type:"application/octet-stream"}),"REPORTE-ALMACENES.xlsx")})}i.stop()},e.dibujarCabeceraPDFAlmacenes=function(t,a,o){t.font("Helvetica-Bold",12),t.text("REPORTE ALMACENES",0,25,{align:"center"}),t.font("Helvetica-Bold",10),t.text("SUCURSAL:"+e.reporte.sucursal.nombre+" - ALMACEN:"+(null!==e.reporte.almacen&&void 0!==e.reporte.almacen&&0!==e.reporte.almacen?e.reporte.almacen.nombre:"TODOS LOS ALMACENES"),0,38,{align:"center"}),t.font("Helvetica-Bold",8),t.text("PÁGINA "+a+" DE "+o,0,750,{align:"center"}),t.rect(30,50,555,30).stroke(),t.font("Helvetica-Bold",8),t.text("Código",45,60),t.text("Cant.",110,60,{width:50}),t.text("Unid.",160,60,{width:50}),t.text("Descripción",210,60,{width:170}),e.usuario.empresa.usar_vencimientos&&(t.text("Venc.",380,60),t.text("Lote",430,60)),t.text("Costo Unitario",470,60,{width:50}),t.text("Total General",530,60,{width:50})},e.inicio()}]).controller("ControladorVentasMensuales",["$scope","$localStorage","$location","$templateCache","$route","blockUI","ClasesTipo","ReporteVentasMensualesDatos",function(e,t,a,o,n,r,i,s){e.usuario=JSON.parse(t.usuario),e.inicio=function(){e.obtenerGestiones(),e.sucursales=e.obtenerSucursales(),e.reporte={},e.reporte.sucursal=1==e.sucursales.length?e.sucursales[0]:null,ejecutarScriptsVentasMensuales()},e.obtenerSucursales=function(){var t=[];e.usuario.sucursalesUsuario.length>1&&t.push({id:0,nombre:"TODOS"});for(var a=0;a<e.usuario.sucursalesUsuario.length;a++)t.push(e.usuario.sucursalesUsuario[a].sucursal);return t},e.obtenerGestiones=function(){r.start(),i("GTN").then(function(t){e.gestiones=t.clases,r.stop()})},e.generarExcelVentasMensuales=function(t){r.start(),inicio=new Date(e.convertirFecha(t.fechaInicioTexto)),fin=new Date(e.convertirFecha(t.fechaFinTexto)),s(e.usuario.id_empresa,t.sucursal.id,inicio,fin).then(function(t){var a=JSON.parse(t.detallesVenta);console.log("ventasssss ===== ",a);var o=[["FECHA DE LA FACTURA","N° DE LA FACTURA","N° DE AUTORIZACION","NIT/CI CLIENTE","NOMBRE O RAZON SOCIAL","UBICACION CLIENTE","CODIGO","DETALLE","UNIDAD","GRUPO","CANTIDAD","PU","TOTAL","IMPORTE ICE/IEHD/TASAS","EXPORTACIONES Y OPERACIONES EXENTAS","VENTAS GRAVADAS A TASA CERO","SUBTOTAL","DESCUENTOS, BONIFICACIONES Y REBAJAS OBTENIDAS","IMPORTE BASE PARA DEBITO FISCAL","DEBITO FISCAL","SUCURSAL","USUARIO","TIPO DE PAGO"]];e.usuario.empresa.usar_vencimientos&&(o[0].push("FECHA VENCIMIENTO"),o[0].push("LOTE")),o[0].push("VENDEDOR");for(var n=0;n<a.length;n++){var i=[];a[n].venta.fecha=new Date(a[n].venta.fecha),i.push(a[n].venta.fecha),i.push(a[n].venta.factura),i.push(a[n].venta.autorizacion),i.push(a[n].venta.cliente.nit),i.push(a[n].venta.cliente.razon_social),i.push(a[n].venta.cliente.ubicacion_geografica),i.push(a[n].producto.codigo),i.push(a[n].producto.nombre),i.push(a[n].producto.unidad_medida),a[n].producto.grupo?i.push(a[n].producto.grupo.nombre):i.push(""),i.push(a[n].cantidad),i.push(a[n].precio_unitario),i.push(a[n].importe),i.push(a[n].ice),i.push(0),i.push(0),i.push(a[n].importe-a[n].ice);var s=a[n].importe-a[n].ice-a[n].excento+a[n].recargo;i.push(s),i.push(a[n].total),i.push(Math.round(.13*a[n].total*100)/100),i.push(a[n].venta.almacen.sucursal.nombre),i.push(a[n].venta.usuario.nombre_usuario),i.push(a[n].venta.tipoPago.nombre),e.usuario.empresa.usar_vencimientos&&(a[n].inventario?(a[n].inventario.fecha_vencimiento=new Date(a[n].inventario.fecha_vencimiento),i.push(a[n].inventario.fecha_vencimiento),i.push(a[n].inventario.lote)):null!=a[n].lote?(a[n].fecha_vencimiento=new Date(a[n].fecha_vencimiento),i.push(a[n].fecha_vencimiento),i.push(a[n].lote)):(i.push(""),i.push(""))),i.push(a[n].venta.vendedor?a[n].venta.vendedor.persona.nombre_completo:""),o.push(i)}var c="SheetJS",l=new Workbook,u=sheet_from_array_of_arrays(o);l.SheetNames.push(c),l.Sheets[c]=u;var p=XLSX.write(l,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(p)],{type:"application/octet-stream"}),"VENTAS-MENSUALES.xlsx"),r.stop()})},e.generarPdfVentasMensuales=function(t){r.start(),inicio=new Date(e.convertirFecha(t.fechaInicioTexto)),fin=new Date(e.convertirFecha(t.fechaFinTexto)),s(e.usuario.id_empresa,t.sucursal.id,inicio,fin).then(function(a){var o=JSON.parse(a.detallesVenta),n=new PDFDocument({compress:!1,margin:10}),i=n.pipe(blobStream());n.font("Helvetica",8);var s=150,c=0,l=1;e.dibujarCabeceraPDFVentasMensuales(n,a,t,l);for(var u=0;u<o.length&&c<=15;u++)n.rect(40,s-10,540,40).stroke(),n.font("Helvetica",8),o[u].venta.fecha=new Date(o[u].venta.fecha),n.text(o[u].venta.fecha.getDate()+"/"+(o[u].venta.fecha.getMonth()+1)+"/"+o[u].venta.fecha.getFullYear().toString().substr(-2),45,s),n.text(o[u].venta.factura?o[u].venta.factura:"",80,s),n.font("Helvetica",7),n.text(o[u].venta.cliente.razon_social,115,s-2,{width:80}),n.text(o[u].producto.nombre,205,s-2,{width:80}),n.font("Helvetica",8),n.text(o[u].cantidad,300,s,{width:50}),n.text(o[u].producto.unidad_medida,330,s,{width:50}),e.usuario.empresa.usar_vencimientos&&o[u].inventario&&(o[u].inventario.fecha_vencimiento=new Date(o[u].inventario.fecha_vencimiento),n.text(o[u].inventario.fecha_vencimiento.getDate()+"/"+(o[u].inventario.fecha_vencimiento.getMonth()+1)+"/"+o[u].inventario.fecha_vencimiento.getFullYear().toString().substr(-2),385,s),n.text(o[u].inventario.lote,435,s)),n.text(o[u].descuento,475,s),n.text(o[u].recargo,505,s),n.text(o[u].total,535,s),s+=40,15!=++c&&u+1!=o.length||u+1==o.length||(n.addPage({margin:0,bufferPages:!0}),s=150,c=0,l+=1,e.dibujarCabeceraPDFVentasMensuales(n,a,t,l),n.font("Helvetica",8));var p=new Date,d=p.getMinutes();d<10&&(d="0"+d),n.text("USUARIO: "+e.usuario.nombre_usuario,45,s),n.text("IMPRESION : "+p.getDate()+"/"+(p.getMonth()+1)+"/"+p.getFullYear()+" Hr. "+p.getHours()+":"+d,175,s),n.end(),i.on("finish",function(){var e=i.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),r.stop()})},e.dibujarCabeceraPDFVentasMensuales=function(e,t,a,o){e.font("Helvetica-Bold",12),e.text("REPORTE DE VENTAS",0,25,{align:"center"}),e.font("Helvetica",8),e.text("Desde  "+a.fechaInicioTexto,-70,40,{align:"center"}),e.text("Hasta "+a.fechaFinTexto,70,40,{align:"center"}),e.text("FOLIO "+o,550,25),e.rect(40,60,540,40).stroke(),e.font("Helvetica-Bold",8),e.text("NOMBRE O RAZÓN SOCIAL : ",65,75),e.text("NIT : ",440,75),e.font("Helvetica",8),e.text(t.empresa.razon_social,195,75),e.text(t.empresa.nit,460,75),e.rect(40,100,540,40).stroke(),e.font("Helvetica-Bold",8),e.text("Fecha",45,110,{width:40}),e.text("Nº De Nota",80,110,{width:30}),e.text("Cliente",115,110),e.text("Producto",205,110),e.text("Cant.",290,110),e.text("Unidad",330,110),e.text("Fecha Venc",385,110,{width:30}),e.text("Lote",435,110,{width:35}),e.text("Desc.",470,110),e.text("Rec.",500,110),e.text("Total",535,110)},e.inicio()}]).controller("ControladorEstadoResultadosNoContable",["$scope","$localStorage","$location","$templateCache","$route","blockUI","GastosVariosLista","ReporteEstadoResultadosNoContableDatos",function(e,t,a,o,n,r,i,s){e.usuario=JSON.parse(t.usuario),e.idModalGastos="dialog-gastos",e.$on("$viewContentLoaded",function(){resaltarPestaña(a.path().substring(1)),ejecutarScriptsEstadoResultadosNoContable(e.idModalGastos),e.buscarAplicacion(e.usuario.aplicacionesUsuario,a.path().substring(1)),r.stop()}),e.abrirPopupGastos=function(){e.gasto=null,e.abrirPopup(e.idModalGastos)},e.cerrarPopupGastos=function(){e.cerrarPopup(e.idModalGastos)},e.inicio=function(){},e.generarEstadoResultadosNoContable=function(t,a,o){e.cerrarPopupGastos(),r.start(),a=new Date(e.convertirFecha(a)),o=new Date(e.convertirFecha(o));var n=s(e.usuario.id_empresa,a,o);n.then(function(s){(n=i(e.usuario.id_empresa,a,o)).then(function(a){for(var o=0,n=0,i=0,c=0,l=0,u=0,p=0,d=0,h=0,m=0,v=0;v<s.length;v++)if(s[v].movimiento){if(s[v].movimiento.clase.nombre_corto==e.diccionario.EGRE_FACTURACION||s[v].movimiento.clase.nombre_corto==e.diccionario.EGRE_PROFORMA){s[v].movimiento.clase.nombre_corto==e.diccionario.EGRE_FACTURACION?(h+=.87*s[v].total,o+=.87*s[v].total,null!=s[v].tipoPago&&(s[v].tipoPago.nombre==e.diccionario.TIPO_PAGO_CREDITO?(i+=.87*s[v].total,l+=.87*s[v].total):s[v].tipoPago.nombre==e.diccionario.TIPO_PAGO_CONTADO&&(c+=.87*s[v].total,d+=.87*s[v].total))):(h+=s[v].total,o+=s[v].total,null!=s[v].tipoPago&&(s[v].tipoPago.nombre==e.diccionario.TIPO_PAGO_CREDITO?(i+=s[v].total,l+=s[v].total):s[v].tipoPago.nombre==e.diccionario.TIPO_PAGO_CONTADO&&(c+=s[v].total,d+=s[v].total)));for(var f=0;f<s[v].movimiento.detallesMovimiento.length;f++)m+=s[v].movimiento.detallesMovimiento[f].total}}else h+=.87*s[v].total,n+=.87*s[v].total,null!=s[v].tipoPago&&(s[v].tipoPago.nombre==e.diccionario.TIPO_PAGO_CREDITO?(i+=.87*s[v].total,p+=.87*s[v].total):s[v].tipoPago.nombre==e.diccionario.TIPO_PAGO_CONTADO&&(c+=.87*s[v].total,u+=.87*s[v].total));h=Math.round(100*h)/100,m=Math.round(100*m)/100,o=Math.round(100*o)/100,n=Math.round(100*n)/100,l=Math.round(100*l)/100,u=Math.round(100*u)/100,p=Math.round(100*p)/100,d=Math.round(100*d)/100;var g=Math.round(100*(h-m))/100,x=0;for(v=0;v<a.length;v++)for(f=0;f<a[v].detallesCompra.length;f++)x+=a[v].detallesCompra[f].total;var b=g-(x=Math.round(100*(x-.13*x))/100+t),E=new PDFDocument({margin:10}),A=E.pipe(blobStream()),C=e.filtro.fechaInicioTexto,D=e.filtro.fechaFinTexto;E.font("Helvetica-Bold",16),E.text("ESTADO DE RESULTADOS NO CONTABLE",0,60,{align:"center"}),E.font("Helvetica-Bold",10),E.text("Desde "+C+" al "+D,0,80,{align:"center"}),E.font("Helvetica-Bold",8),E.text("VENTAS",100,100),E.text(h,300,100),E.font("Helvetica",8),E.text("PRODUCTO",100,110),E.text(o,170,110),E.text("SERVICIO",100,120),E.text(n,170,120),E.font("Helvetica-Bold",8),E.text("COSTO DE VENTAS",100,200),E.text(m,300,200),E.text("UTILIDAD BRUTA EN VENTAS",100,250),E.text(g,300,250),E.text("GASTOS",100,300),E.text(x,300,300),E.font("Helvetica-Bold",8),E.text("VENTAS CONTADO",150,130),E.text(Math.round(100*c)/100,250,130),E.font("Helvetica",8),E.text("PRODUCTOS",150,140),E.text(d,250,140),E.text("SERVICIOS",150,150),E.text(u,250,150),E.font("Helvetica-Bold",8),E.text("VENTAS CREDITO",150,160),E.text(Math.round(100*i)/100,250,160),E.font("Helvetica",8),E.text("PRODUCTOS",150,170),E.text(l,250,170),E.text("SERVICIOS",150,180),E.text(p,250,180),E.font("Helvetica-Bold",8);var S=330,O=0;for(v=0;v<a.length;v++){E.text(a[v].nombre,130,S),O=0;for(f=0;f<a[v].detallesCompra.length;f++)O+=a[v].detallesCompra[f].total;E.text(Math.round(100*(O-.13*O))/100,280,S),S+=25}E.text("OTROS GASTOS",130,S),E.text(t,280,S),E.font("Helvetica-Bold",8);var T=b>=0?"UTILIDAD DEL PERIODO":"PÉRDIDA DEL PERIODO";E.text(T,100,S+25),E.text(b,300,S+25),E.end(),A.on("finish",function(){var e=A.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),r.stop()})})},e.generarExcelAlmacenes=function(){r.start(),InventariosCosto(e.usuario.id_empresa).then(function(e){for(var t=[["Código","Cant.","Unid.","Descripción","Costo Unitario","Total General"]],a=0;a<e.length;a++){var o=[];o.push(e[a].producto.codigo),o.push(e[a].cantidad),o.push(e[a].producto.unidad_medida),o.push(e[a].producto.nombre),o.push(e[a].costo_unitario),o.push(e[a].costo_total),t.push(o)}var n="SheetJS",i=new Workbook,s=sheet_from_array_of_arrays(t);i.SheetNames.push(n),i.Sheets[n]=s;var c=XLSX.write(i,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(c)],{type:"application/octet-stream"}),"REPORTE-ALMACENES.xlsx"),r.stop()})},e.dibujarCabeceraPDFAlmacenes=function(e,t,a){e.font("Helvetica-Bold",12),e.text("REPORTE ALMACENES",0,25,{align:"center"}),e.font("Helvetica-Bold",8),e.text("PÁGINA "+t+" DE "+a,0,750,{align:"center"}),e.rect(30,50,555,30).stroke(),e.font("Helvetica-Bold",8),e.text("Código",45,60),e.text("Cant.",110,60,{width:50}),e.text("Unid.",160,60,{width:50}),e.text("Descripción",210,60,{width:300}),e.text("Costo Unitario",470,60,{width:50}),e.text("Total General",530,60,{width:50})},e.inicio()}]).controller("ControladorComprasMensuales",["$scope","$localStorage","$location","$templateCache","$route","blockUI","ClasesTipo","ReporteComprasMensualesDatos",function(e,t,a,o,n,r,i,s){e.usuario=JSON.parse(t.usuario),e.inicio=function(){e.obtenerGestiones(),e.sucursales=e.obtenerSucursales(),e.reporte={},e.reporte.sucursal=1==e.sucursales.length?e.sucursales[0]:null,ejecutarScriptsVentasMensuales()},e.obtenerSucursales=function(){var t=[];e.usuario.sucursalesUsuario.length>1&&t.push({id:0,nombre:"TODOS"});for(var a=0;a<e.usuario.sucursalesUsuario.length;a++)t.push(e.usuario.sucursalesUsuario[a].sucursal);return t},e.obtenerGestiones=function(){r.start(),i("GTN").then(function(t){e.gestiones=t.clases,r.stop()})},e.generarExcelComprasMensuales=function(t){r.start(),inicio=new Date(e.convertirFecha(t.fechaInicioTexto)),fin=new Date(e.convertirFecha(t.fechaFinTexto)),s(e.usuario.id_empresa,t.sucursal.id,inicio,fin).then(function(t){for(var a=t.detallesCompra,o=[["FECHA DE LA FACTURA","N° DE LA FACTURA","N° DE AUTORIZACION","NIT/CI CLIENTE","NOMBRE O RAZON SOCIAL","CODIGO","DETALLE","UNIDAD","GRUPO","CANTIDAD","PU","TOTAL","IMPORTE ICE/IEHD/TASAS","EXENTOS","SUBTOTAL","DESCUENTOS, BONIFICACIONES Y REBAJAS OBTENIDAS","IMPORTE BASE PARA DEBITO FISCAL","CREDITO FISCAL","FECHA DE VENCIMIENTO","LOTE","SUCURSAL","USUARIO","CENTRO DE COSTOS"]],n=0;n<a.length;n++){var i=[];a[n].compra.fecha=new Date(a[n].compra.fecha),i.push(a[n].compra.fecha),i.push(a[n].compra.factura),i.push(a[n].compra.autorizacion),i.push(a[n].compra.proveedor.nit),i.push(a[n].compra.proveedor.razon_social),i.push(a[n].producto.codigo),i.push(a[n].producto.nombre),i.push(a[n].producto.unidad_medida),a[n].producto.grupo?i.push(a[n].producto.grupo.nombre):i.push(""),i.push(a[n].cantidad),i.push(a[n].costo_unitario),i.push(a[n].importe),i.push(a[n].ice),i.push(a[n].excento),i.push(a[n].importe-a[n].ice);var s=a[n].importe-a[n].ice-a[n].excento+a[n].recargo;i.push(s),i.push(a[n].total),i.push(Math.round(.13*a[n].total*100)/100),a[n].inventario?(i.push(new Date(a[n].inventario.fecha_vencimiento)),i.push(a[n].inventario.lote)):(i.push(""),i.push("")),console.log(n),i.push(a[n].compra.almacen.sucursal?a[n].compra.almacen.sucursal.nombre:""),i.push(e.usuario.nombre_usuario),i.push(a[n].centroCosto.nombre_corto),o.push(i)}var c="SheetJS",l=new Workbook,u=sheet_from_array_of_arrays(o);l.SheetNames.push(c),l.Sheets[c]=u;var p=XLSX.write(l,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(p)],{type:"application/octet-stream"}),"COMPRAS-MENSUALES.xlsx"),r.stop()})},e.generarPdfComprasMensuales=function(t){r.start(),inicio=new Date(e.convertirFecha(t.fechaInicioTexto)),fin=new Date(e.convertirFecha(t.fechaFinTexto)),s(e.usuario.id_empresa,t.sucursal.id,inicio,fin).then(function(a){var o=a.detallesCompra,n=new PDFDocument({margin:10}),i=n.pipe(blobStream());n.font("Helvetica",8);var s=150,c=0,l=1;e.dibujarCabeceraPDFcomprasMensuales(n,a,t,l);for(var u=0;u<o.length&&c<=15;u++)n.rect(40,s-10,540,40).stroke(),o[u].compra.fecha=new Date(o[u].compra.fecha),n.text(o[u].compra.fecha.getDate()+"/"+(o[u].compra.fecha.getMonth()+1)+"/"+o[u].compra.fecha.getFullYear(),45,s),n.text(o[u].compra.factura?o[u].compra.factura:"",90,s),n.text(o[u].compra.proveedor?o[u].compra.proveedor.razon_social:"",135,s-6,{width:80}),console.log(u),n.text(o[u].producto?o[u].producto.nombre:o[u].servicio?o[u].servicio.nombre:"",225,s-6,{width:80}),n.text(o[u].producto?o[u].producto.unidad_medida:"",300,s,{width:50}),o[u].inventario&&(o[u].inventario.fecha_vencimiento=new Date(o[u].inventario.fecha_vencimiento),n.text(o[u].inventario.fecha_vencimiento.getDate()+"/"+(o[u].inventario.fecha_vencimiento.getMonth()+1)+"/"+o[u].inventario.fecha_vencimiento.getFullYear(),345,s),n.text(o[u].inventario.lote,405,s)),n.text(o[u].descuento,445,s),n.text(o[u].recargo,495,s),n.text(o[u].total,535,s),s+=40,15!=++c&&u+1!=o.length||u+1==o.length||(n.addPage({margin:0,bufferPages:!0}),s=150,c=0,l+=1,e.dibujarCabeceraPDFcomprasMensuales(n,a,t,l),n.font("Helvetica",8));var p=new Date,d=p.getMinutes();d<10&&(d="0"+d),n.text("USUARIO: "+e.usuario.nombre_usuario,45,s),n.text("IMPRESION : "+p.getDate()+"/"+(p.getMonth()+1)+"/"+p.getFullYear()+" Hr. "+p.getHours()+":"+d,175,s),n.end(),i.on("finish",function(){var e=i.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),r.stop()})},e.dibujarCabeceraPDFcomprasMensuales=function(e,t,a,o){e.font("Helvetica-Bold",12),e.text("REPORTE DE COMPRAS",0,25,{align:"center"}),e.font("Helvetica",8),e.text("Desde  "+a.fechaInicioTexto,-70,40,{align:"center"}),e.text("Hasta "+a.fechaFinTexto,70,40,{align:"center"}),e.text("FOLIO "+o,550,25),e.rect(40,60,540,40).stroke(),e.font("Helvetica-Bold",8),e.text("NOMBRE O RAZÓN SOCIAL : ",65,75),e.text("NIT : ",440,75),e.font("Helvetica",8),e.text(t.empresa.razon_social,195,75),e.text(t.empresa.nit,460,75),e.rect(40,100,540,40).stroke(),e.font("Helvetica-Bold",8),e.text("Fecha",45,110,{width:40}),e.text("Nº De Nota",80,110),e.text("Proveedor",135,110),e.text("Producto",225,110),e.text("Unidad",300,110),e.text("Fecha Venc",345,110),e.text("Lote",405,110,{width:35}),e.text("Descuento",440,110),e.text("Recargo",490,110),e.text("Total",535,110),e.font("Helvetica",8)},e.inicio()}]);