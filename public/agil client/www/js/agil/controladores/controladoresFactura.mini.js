angular.module("agil.controladores").controller("ControladorFacturas",["$scope","$localStorage","$location","$templateCache","$route","blockUI","ConfiguracionesFactura","ConfiguracionGeneralFacturaDato","ClasesTipo","ConfiguracionFacturaSucursal","ConfiguracionFacturaEmpresa",function(o,a,n,i,r,t,e,c,u,s,l){t.start(),o.idModalWizardConfiguracionEdicion="modal-wizard-configuracion-edicion",o.idModalWizardConfiguracionGeneralEdicion="modal-wizard-configuracion-general-edicion",o.idModalContenedorConfiguracionEdicion="modal-wizard-container-configuracion-edicion",o.idModalContenedorConfiguracionGeneralEdicion="modal-wizard-container-configuracion-general-edicion",o.usuario=JSON.parse(a.usuario),o.obtenerImpresionesFactura=function(){t.start(),u("IMPFACT").then(function(a){o.impresionesFactura=a.clases,t.stop()})},o.obtenerTiposFacturacion=function(){t.start(),u("TIPOFACT").then(function(a){o.tiposFacturacion=a.clases,t.stop()})},o.obtenerTamanosPapelFactura=function(){t.start(),u("TAMPAPFACT").then(function(a){o.tamanosPapelFactura=a.clases,t.stop()})},o.obtenerTitulosFactura=function(){t.start(),u("TITFACT").then(function(a){o.titulosFactura=a.clases,t.stop()})},o.obtenerSubtitulosFactura=function(){t.start(),u("SUBTITFACT").then(function(a){o.subTitulosFactura=a.clases,t.stop()})},o.obtenerPiesFactura=function(){t.start(),u("PIÉFACT").then(function(a){o.piesFactura=a.clases,t.stop()})},o.obtenerFormatoFactura=function(){t.start(),u("FORM_IMP_FAC").then(function(a){o.formatosFactura=a.clases,t.stop()})},o.obtenerTipoConfigFactura=function(){t.start(),u("CONF_FORM").then(function(a){o.tiposConfiguraciones=a.clases,t.stop()})},o.obtenerFormatoFacturaColor=function(){t.start(),u("FORM_IMP_FAC_COL").then(function(a){o.formatosFacturaColor=a.clases,t.stop()})},o.obtenerConfiguracionesFactura=function(){t.start(),e(o.usuario.id_empresa).then(function(a){o.sucursales=a,t.stop()})},o.obtenerConfiguracionGeneralFactura=function(){t.start(),c(o.usuario.id_empresa).then(function(a){o.configuracion_general=a,console.log(o.configuracion_general),t.stop()})},o.$on("$routeChangeStart",function(a,n){o.eliminarPopup(o.idModalWizardConfiguracionEdicion),o.eliminarPopup(o.idModalWizardConfiguracionGeneralEdicion)}),o.inicio=function(){o.obtenerConfiguracionesFactura(),o.obtenerConfiguracionGeneralFactura(),o.obtenerImpresionesFactura(),o.obtenerTiposFacturacion(),o.obtenerTamanosPapelFactura(),o.obtenerTitulosFactura(),o.obtenerSubtitulosFactura(),o.obtenerPiesFactura(),o.obtenerFormatoFactura(),o.obtenerFormatoFacturaColor(),o.obtenerTipoConfigFactura(),setTimeout(function(){ejecutarScriptsTabla("tabla-configuraciones",7),ejecutarScriptsTabla("tabla-configuracion-general",7)},2e3)},o.$on("$viewContentLoaded",function(){resaltarPestaña(n.path().substring(1)),ejecutarScriptsConfiguracionFactura(o.idModalWizardConfiguracionEdicion,o.idModalContenedorConfiguracionEdicion,o.idModalWizardConfiguracionGeneralEdicion,o.idModalContenedorConfiguracionGeneralEdicion),o.buscarAplicacion(o.usuario.aplicacionesUsuario,n.path().substring(1)),t.stop()}),o.cerrarPopPupEdicion=function(){o.cerrarPopup(o.idModalWizardConfiguracionEdicion)},o.cerrarPopPupEdicionGeneral=function(){o.cerrarPopup(o.idModalWizardConfiguracionGeneralEdicion)},o.modificarConfiguracionSucursal=function(a){o.sucursal=a,o.abrirPopup(o.idModalWizardConfiguracionEdicion)},o.modificarConfiguracionGeneralFactura=function(a){o.abrirPopup(o.idModalWizardConfiguracionGeneralEdicion)},o.guardarConfiguracion=function(a){"Siguiente"!=$("#siguiente").text().trim()&&(t.start(),s.update({id_configuracion:a.configuracionFactura.id},a,function(a){t.stop(),o.cerrarPopPupEdicion(),o.mostrarMensaje(a.mensaje),o.recargarItemsTabla()}))},o.guardarConfiguracionGeneral=function(a){console.log($("#siguiente-g").text().trim()),"Siguiente"!=$("#siguiente-g").text().trim()&&(t.start(),l.update({id_configuracion:a.id},a,function(a){t.stop(),o.cerrarPopPupEdicionGeneral(),o.mostrarMensaje(a.mensaje),o.recargarItemsTabla()}))},o.inicio()}]);