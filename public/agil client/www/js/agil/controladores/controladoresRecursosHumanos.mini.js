angular.module("agil.controladores").controller("ControladorRecursosHumanos",["$scope","$sce","$localStorage","$location","$templateCache","$route","blockUI","ListaDatosGenero","NuevoRecursoHumano","RecursosHumanosPaginador","Paginator","FieldViewer","EmpleadoEmpresa","obtenerEmpleadoRh","UsuarioRecursosHUmanosActivo","Prerequisito","ListaDatosPrerequisito","Prerequisitos","ListaPrerequisitosPaciente","ActualizarPrerequisito","UsuarioRecursosHumanosFicha","ClasesTipo","Clases","Paises","CrearEmpleadoFicha","EliminarOtroSeguroRh","EliminarFamiliarRh","PrerequisitoPaciente","PrerequisitosHistorial","UsuarioRhHistorialFicha","ObtenerEmpleadoHojaVida","GuardarEmpleadoHojaVida","CrearPrestamo","ObtenerListaPrestamo","CrearRolTurno","CrearPagoPrestamo","VerificarUsuarioEmpresa","EditarPrestamo","ListaEmpleadosRrhh","CrearHorasExtra","HistorialHorasExtra","ListaRolTurnos","ValidarCodigoCuentaEmpleado","$timeout","DatosCapacidadesImpresion","NuevoAnticipoEmpleado","ListaAnticiposEmpleado","CrearNuevosAnticiposEmpleados","ActualizarAnticipoEmpleado","NuevaAusenciaEmpleado","HistorialEmpleadoAusencias","HistorialEmpresaEmpleadosAusencias","NuevaVacacionEmpleado","HistorialEmpleadoVacaciones","HistorialEmpresaVacaciones","NuevoFeriado","ListaFeriados","GuardarClasesAusencias","Tipos","ListaBancos","ConfiguracionesVacacion","HistorialGestionesVacacion","GuardarTr3","ListaTr3Empresa","GuardarHistorialVacacion","CrearBeneficioSocial","ListaBeneficiosEmpleado","GuardarBitacoraFicha","VerBitacoraFicha","ObtenerFiniquitoEmpleado","ClasesTipoEmpresa","GuardarConfiguracionRopaCargo","ListaConfiguracionRopaCargo","DatosReporteConfiguracionRopa","FichasEmpleadoEmpresa","ListaCargosEmpleado","ListaRopaTrabajoProductos","GuardarDotacionRopa","ListaDotacionRopa","EliminarDotacionRopa","ListaDotacionRopaEmpresa","ActualizarDotacionRopa","FamiliaresEmpleadoEmpresa","ListaRolTurnosEmpresa","ClasesEmpresa","ListaChoferesViaje","GuardarViajeRrhh","ListaViajeRrhh","ListaRolTurnosCalendario","ViajeRrhhLista","BeneficioEmpresa","GuardarConductoresEmpresa","ListaHijosEmpleadosEmpresa","GuardarImportacionFichaEmpleados","GuardarImportacionRolTurnoEmpleados","PrerequisitosSave",function(a,e,o,i,t,n,r,c,s,l,d,p,u,f,m,h,g,b,v,_,D,E,A,R,M,x,P,T,j,H,C,w,S,V,F,I,O,N,B,L,q,Y,y,k,G,U,z,J,X,W,K,Q,Z,aa,ea,oa,ia,ta,na,ra,ca,sa,la,da,pa,ua,fa,ma,ha,ga,ba,va,_a,Da,Ea,Aa,Ra,Ma,xa,Pa,Ta,ja,Ha,Ca,wa,Sa,Va,Fa,Ia,Oa,Na,Ba,La,qa,Ya,ya){a.usuario=JSON.parse(o.usuario),a.idModalPrerequisitos="dialog-pre-requisitos",a.idModalEmpleado="dialog-empleado",a.idModalwizardContainerEmpleado="modal-wizard-empleado-container",a.idModalDepartamentoEstado="dialog-departamento-estado",a.idModalProvincia="dialog-provincia",a.idModalLocalidad="dialog-localidad",a.idImputContrato="id-contrato",a.idModalHojaVida="modal-hoja-vida",a.idModalwizardContainerHojaVida="modal-wizard-hoja-vida-container",a.idModalNuevoFamiliar="dialog-nuevo-familiar",a.idModalHistorialContrato="dialog-historial-contrato",a.idModalBeneficiosSociales="modal-beneficios-sociales",a.idModalDetalleVacaciones="dialog-detalle-vacaciones",a.idModalBitacoraFicha="dialog-bitacora-ficha",a.idModalAnticipoExtraordinario="dialog-anticipo-extraordinario",a.idModalNuevoPrestamo="dialog-nuevo-prestamo",a.idModalAusenciasVacaciones="dialog-ausencias-vacaciones",a.idTabAusenciasVacaciones="tab-ausencias-vacaciones",a.idModalTipoBaja="dialog-tipo-baja",a.idModalFeriados="dialog-feriados",a.idModalHitorialVacaciones="dialog-historial-vacaciones",a.idModalCompensacion="dialog-compesacion",a.idModalHistorialAusencias="dialog-historial-ausencias",a.idModalHistorialAusenciaMedica="dialog-historial-ausencia-medica",a.idModalTipoAusencia="dialog-tipo-ausencia",a.idModalRolTurnos="dialog-rol-turnos",a.idModalHistorialTurnos="dialog-historial-turnos",a.idModalHorasExtras="dialog-horas-extras",a.idModalHistorialHorasExtras="dialog-historial-horas-extras",a.idModalAnticipoRegular="dialog-anticipo-regular",a.idModalPrestamosPersonal="dialog-prestamos-personal",a.idModalAdvertencia="dialog-advertencia",a.idModalPretamosNuevoTodos="dialog-nuevo-prestamo-todos",a.idModalReporteHijos="dialog-reporte-hijos",a.idModalReporteVeneficios="dialog-reporte-beneficios-sociales",a.idModalPagoPrestamo="dialog-pago-prestamo",a.idModalReporteVacaciones="dialog-reporte-vacaciones",a.idModalReporteBajasMedicas="dialog-reporte-bajas-medicas",a.idModalReporteRolTurnos="dialog-reporte-rol-turnos",a.idModalReporteTurnosDetallado="dialog-reporte-turnos-detallado",a.idModalViajes="dialog-viajes",a.idModalVisita="dialog-visita",a.idModalVisitaSalida="dialog-visita-salida",a.idModalVehiculosViaje="dialog-vehiculos-viaje",a.idModalConductoresViaje="dialog-conductores-viaje",a.idModalHistorialViajes="dialog-historial-viajes",a.idModalReporteAusencias="dialog-reporte-ausencias",a.idModalCertificado="dialog-certificado",a.idModalRhNuevo="dialog-rh-nuevo",a.idModalWizardRhNuevo="modal-wizard-rh-container",a.idImagenUsuario="imagen-persona",a.idEliminarUsuarioRh="dialog-eliminar-usuarioRh",a.idEliminarSeguroEmpleado="dialog-eliminar-seguro",a.idEliminarFamiliarEmpleado="dialog-eliminar-familiar",a.idModalWizardRhVista="dialog-rh-vista",a.idModalContenedorRhVista="modal-wizard-container-rh-vista",a.idModalDialogPrerequisitoNuevo="dialog-pre-requisito-nuevo",a.idModalHistorialPrerequisito="dialog-historico-preRequisito",a.idModalEditarPrerequisito="dialog-editar-preRequisito",a.idModalDialogConfirmacionEntregaAdelantado="dialog-entrega-adelantada-prerequisito",a.IdEntregaPrerequisito="dialog-entrega-preRequisito",a.IdModalVerificarCuenta="modal-verificar-cuenta",a.IdModalVerificarCuentaRrhh="modal-verificar-cuenta-Rrhh",a.idModalImpresionHojaVida="dialog-impresion-hoja-vida",a.idModalNuevoAnticipoRegularTodos="dialog-nuevo-anticipo-regular-todos",a.idModalTr3BancoMsc="modal-tr3-banco-msc",a.idModalTr3BancoUnion="modal-tr3-banco-union",a.idModalHistorialTr3="modal-historial-tr3",a.idModalConfirmarDesabilitacion="modal-confirmar-desabilitacion",a.idModalReingresoEmpleado="modal-reingreso-empleado",a.idModalHistorialBeneficios="dialog-historial-beneficio_social",a.idModalConfiguracionRopaDeTrabajo="dialog-configuracion-ropa-trabajo",a.idModalReporteRopaDeTrabajo="dialog-reporte-ropa-trabajo",a.idmodalWizardContainerConfiguracionRopaTrabajo="modal-wizard-container-configuracion-ropa-trabajo",a.idModalRopaTrabajo="dialog-ropa-trabajo",a.idModalNuevaRopaTrabajo="dialog-nueva-ropa-trabajo",a.idModalItemsNuevaRopaTrabajo="dialog-items-nueva-ropa-trabajo",a.idModalEliminarRopaTrabajo="dialog-eliminar-ropa-trabajo",a.idModalConceptoEdicion="dialog-conceptos",a.idModalDesabilitarPasajero="dialog-motivo-desabilitar-viajero",a.idModalCerrarRolDeTurno="modal-cerrar-rol-de-turno",a.idModalHistorialGestionesVacaciones="dialog-historial-gestiones-vacaciones",a.idModalTipoImportacionRol="dialog-tipo-importacion-rol",a.$on("$viewContentLoaded",function(){resaltarPestaña(i.path().substring(1)),ejecutarScriptsRecursosHumanos(a.idModalPrerequisitos,a.idModalEmpleado,a.idModalwizardContainerEmpleado,a.idModalDepartamentoEstado,a.idModalProvincia,a.idModalLocalidad,a.idImputContrato,a.idModalHojaVida,a.idModalwizardContainerHojaVida,a.idModalNuevoFamiliar,a.idModalHistorialContrato,a.idModalBeneficiosSociales,a.idModalDetalleVacaciones,a.idModalBitacoraFicha,a.idModalAnticipoExtraordinario,a.idModalNuevoPrestamo,a.idModalAusenciasVacaciones,a.idTabAusenciasVacaciones,a.idModalTipoBaja,a.idModalFeriados,a.idModalHitorialVacaciones,a.idModalCompensacion,a.idModalHistorialAusencias,a.idModalHistorialAusenciaMedica,a.idModalTipoAusencia,a.idModalRolTurnos,a.idModalHistorialTurnos,a.idModalHorasExtras,a.idModalHistorialHorasExtras,a.idModalAnticipoRegular,a.idModalPrestamosPersonal,a.idModalAdvertencia,a.idModalPretamosNuevoTodos,a.idModalReporteHijos,a.idModalReporteVeneficios,a.idModalPagoPrestamo,a.idModalReporteVacaciones,a.idModalReporteBajasMedicas,a.idModalReporteRolTurnos,a.idModalReporteTurnosDetallado,a.idModalViajes,a.idModalVisita,a.idModalVehiculosViaje,a.idModalHistorialViajes,a.idModalReporteAusencias,a.idModalCertificado,a.idModalRhNuevo,a.idModalWizardRhNuevo,a.idImagenUsuario,a.idEliminarUsuarioRh,a.idModalWizardRhVista,a.idModalContenedorRhVista,a.idModalDialogPrerequisitoNuevo,a.idEliminarSeguroEmpleado,a.idEliminarFamiliarEmpleado,a.idModalHistorialPrerequisito,a.idModalEditarPrerequisito,a.idModalDialogConfirmacionEntregaAdelantado,a.IdEntregaPrerequisito,a.IdModalVerificarCuenta,a.idModalImpresionHojaVida,a.idModalNuevoAnticipoRegularTodos,a.idModalTr3BancoMsc,a.idModalTr3BancoUnion,a.idModalHistorialTr3,a.IdModalVerificarCuentaRrhh,a.idModalConfirmarDesabilitacion,a.idModalReingresoEmpleado,a.idModalHistorialBeneficios,a.idModalConfiguracionRopaDeTrabajo,a.idModalReporteRopaDeTrabajo,a.idmodalWizardContainerConfiguracionRopaTrabajo,a.idModalRopaTrabajo,a.idModalNuevaRopaTrabajo,a.idModalItemsNuevaRopaTrabajo,a.idModalEliminarRopaTrabajo,a.idModalConceptoEdicion,a.idModalVisitaSalida,a.idModalDesabilitarPasajero,a.idModalCerrarRolDeTurno,a.idModalConductoresViaje,a.idModalHistorialGestionesVacaciones,a.idModalTipoImportacionRol),a.buscarAplicacion(a.usuario.aplicacionesUsuario,i.path().substring(1)),a.obtenerColumnasAplicacion(),r.stop()}),a.$on("$routeChangeStart",function(e,o){a.eliminarPopup(a.idModalEmpleado),a.eliminarPopup(a.idModalDepartamentoEstado),a.eliminarPopup(a.idModalProvincia),a.eliminarPopup(a.idModalLocalidad),a.eliminarPopup(a.idModalHojaVida),a.eliminarPopup(a.idModalNuevoFamiliar),a.eliminarPopup(a.idModalHistorialContrato),a.eliminarPopup(a.idModalBeneficiosSociales),a.eliminarPopup(a.idModalDetalleVacaciones),a.eliminarPopup(a.idModalBitacoraFicha),a.eliminarPopup(a.idModalAnticipoExtraordinario),a.eliminarPopup(a.idModalNuevoPrestamo),a.eliminarPopup(a.idModalAusenciasVacaciones),a.eliminarPopup(a.idModalTipoBaja),a.eliminarPopup(a.idModalFeriados),a.eliminarPopup(a.idModalHitorialVacaciones),a.eliminarPopup(a.idModalCompensacion),a.eliminarPopup(a.idModalHistorialAusencias),a.eliminarPopup(a.idModalHistorialAusenciaMedica),a.eliminarPopup(a.idModalTipoAusencia),a.eliminarPopup(a.idModalRolTurnos),a.eliminarPopup(a.idModalHistorialTurnos),a.eliminarPopup(a.idModalHorasExtras),a.eliminarPopup(a.idModalHistorialHorasExtras),a.eliminarPopup(a.idModalAnticipoRegular),a.eliminarPopup(a.idModalPrestamosPersonal),a.eliminarPopup(a.idModalAdvertencia),a.eliminarPopup(a.idModalPretamosNuevoTodos),a.eliminarPopup(a.idModalReporteHijos),a.eliminarPopup(a.idModalReporteVeneficios),a.eliminarPopup(a.idModalPagoPrestamo),a.eliminarPopup(a.idModalReporteVacaciones),a.eliminarPopup(a.idModalReporteBajasMedicas),a.eliminarPopup(a.idModalReporteRolTurnos),a.eliminarPopup(a.idModalReporteTurnosDetallado),a.eliminarPopup(a.idModalViajes),a.eliminarPopup(a.idModalVisita),a.eliminarPopup(a.idModalVehiculosViaje),a.eliminarPopup(a.idModalHistorialViajes),a.eliminarPopup(a.idModalReporteAusencias),a.eliminarPopup(a.idModalCertificado),a.eliminarPopup(a.idModalPrerequisitos),a.eliminarPopup(a.idModalRhNuevo),a.eliminarPopup(a.idModalWizardRhVista),a.eliminarPopup(a.idModalDialogPrerequisitoNuevo),a.eliminarPopup(a.idEliminarFamiliarEmpleado),a.eliminarPopup(a.idEliminarSeguroEmpleado),a.eliminarPopup(a.idModalHistorialPrerequisito),a.eliminarPopup(a.idModalEditarPrerequisito),a.eliminarPopup(a.idModalDialogConfirmacionEntregaAdelantado),a.eliminarPopup(a.IdEntregaPrerequisito),a.eliminarPopup(a.IdModalVerificarCuenta),a.eliminarPopup(a.idModalImpresionHojaVida),a.eliminarPopup(a.idModalNuevoAnticipoRegularTodos),a.eliminarPopup(a.idEliminarUsuarioRh),a.eliminarPopup(a.idModalTr3BancoMsc),a.eliminarPopup(a.idModalTr3BancoUnion),a.eliminarPopup(a.idModalHistorialTr3),a.eliminarPopup(a.IdModalVerificarCuentaRrhh),a.eliminarPopup(a.idModalConfirmarDesabilitacion),a.eliminarPopup(a.idModalReingresoEmpleado),a.eliminarPopup(a.idModalHistorialBeneficios),a.eliminarPopup(a.idModalConfiguracionRopaDeTrabajo),a.eliminarPopup(a.idModalReporteRopaDeTrabajo),a.eliminarPopup(a.idModalRopaTrabajo),a.eliminarPopup(a.idModalNuevaRopaTrabajo),a.eliminarPopup(a.idModalItemsNuevaRopaTrabajo),a.eliminarPopup(a.idModalEliminarRopaTrabajo),a.eliminarPopup(a.idModalConceptoEdicion),a.eliminarPopup(a.idModalVisitaSalida),a.eliminarPopup(a.idModalDesabilitarPasajero),a.eliminarPopup(a.idModalCerrarRolDeTurno),a.eliminarPopup(a.idModalConductoresViaje),a.eliminarPopup(a.idModalHistorialGestionesVacaciones)}),a.inicio=function(){a.localStorageSpace(),a.listYearsAnticipo=a.obtenerAnios(2017),a.obtenerGenero(),a.obtenerRecursosHumanos(),a.recuperarDatosTipo(),a.empleadosSeleccionados=[],a.listaBancos(),a.obtenerConfiguracionVacaciones(),a.obtenerTiposOtrosingresosYDeduccion(),a.obtenerMotivosRetiro(),a.buscarRopaTrabajo(),a.obtenerCuentasBancos(),a.buscarDepartamentoFiniquito(),a.obtenerGestiones(),a.obtenerChoferesViaje(),a.dynamicPopoverRopaTrabajo={templateUrl:"myPopoverRopaTrabajo.html"}},a.abrirDialogConceptoEdicion=function(e){a.tipo_edicion=e,a.clase={},a.abrirPopup(a.idModalConceptoEdicion)},a.cerrarDialogConceptoEdicion=function(){a.cerrarPopup(a.idModalConceptoEdicion)},a.abrirDialogCerrarRolDeTurno=function(){a.abrirPopup(a.idModalCerrarRolDeTurno)},a.cerrarDialogCerrarRolDeTurno=function(){a.cerrarPopup(a.idModalCerrarRolDeTurno)},a.abrirDialogConductoresViaje=function(){a.conductor={},a.abrirPopup(a.idModalConductoresViaje)},a.cerrarDialogConductoresViaje=function(){a.cerrarPopup(a.idModalConductoresViaje)},a.abrirDialogTipoImportacionRol=function(e){a.rolesTurno=e,a.tipoImportacionRol=!0,a.abrirPopup(a.idModalTipoImportacionRol)},a.cerrarDialogTipoImportacionRol=function(){a.cerrarPopup(a.idModalTipoImportacionRol)},a.abrirDialogHistorialGestionesVacaciones=function(){a.conductor={};a.obtenerHistorialEmpresaVacacionGestion({}),a.abrirPopup(a.idModalHistorialGestionesVacaciones)},a.cerrarDialogHistorialGestionesVacaciones=function(){a.cerrarPopup(a.idModalHistorialGestionesVacaciones)},a.obtenerColumnasAplicacion=function(){a.fieldViewer=p({crear:!0,id_empresa:a.usuario.id_empresa,configuracion:{codigo:{value:"Codigo",show:!0},nombre:{value:"Nombre",show:!0},empresa:{value:"Empresa",show:!0},imagen:{value:"Imagen",show:!0},ci:{value:"CI",show:!0},extension:{value:"Extension",show:!0},tipo_contrato:{value:"Tipo Contrato",show:!0},campo:{value:"Campo",show:!0},cargo:{value:"Cargo",show:!0}}},a.aplicacion.aplicacion.id),a.fieldViewer.updateObject()},a.abrirModalHistorialTr3=function(e,o){a.tipoBanco=o,da(a.usuario.id_empresa,e.nombre).then(function(e){a.historialTr3=e,a.abrirPopup(a.idModalHistorialTr3)}).catch(function(e){var o=void 0!==e.data&&null!==e.data?e.data:e.message;a.mostrarMensaje("Se produjo un error! > "+o),r.stop()})},a.abrirModalBeneficioSicial=function(){a.abrirPopup(a.idModalHistorialBeneficios)},a.obtenerbeneficiosSociales=function(e){a.quienqueniosDisponibles=!0,fa(a.empleado.id_ficha).then(function(o){a.listabeneficios=o,a.quinqueniosRealizados=a.listabeneficios.length;var i=5*a.quinqueniosRealizados,t=e.anios-i;a.añosRestantes=t,a.quienquenioRestante=Math.trunc(t/5),a.beneficio.tipo_beneficio||(0==a.quienquenioRestante?(a.quienquenioRestanteDisabled=!0,a.mostrarMensaje("No cuenta con mas quinquenios disponibles")):a.quienquenioRestanteDisabled=!1)})},a.cerrarModalBeneficioSicial=function(){a.cerrarPopup(a.idModalHistorialBeneficios)},a.cerrarModalHistorialTr3=function(){a.cerrarPopup(a.idModalHistorialTr3)},a.abrirModalConfiguracionRopaDeTrabajo=function(){a.listaRopasDeTrabajo=[],a.ropaTrabajo={},a.cargo="",a.abrirPopup(a.idModalConfiguracionRopaDeTrabajo)},a.cerrarModalConfiguracionRopaDeTrabajo=function(){a.cerrarPopup(a.idModalConfiguracionRopaDeTrabajo)},a.abrirModalReporteRopaDeTrabajo=function(e){a.abrirPopup(a.idModalReporteRopaDeTrabajo)},a.cerrarModalReporteRopaDeTrabajo=function(){a.cerrarPopup(a.idModalReporteRopaDeTrabajo)},a.abrirModalDesabilitarPasajero=function(e){a.empleado=e,"HABILITADO"==e.estado.nombre?a.abrirPopup(a.idModalDesabilitarPasajero):e.habilitado=!1},a.cerrarModalDesabilitarPasajero=function(){a.cerrarPopup(a.idModalDesabilitarPasajero)},a.abrirModalRopaTrabajo=function(e){a.filtroropa={},e.activo&&(a.empleado=e,a.dynamicPopoverCargosRopaTrabajo={templateUrl:"myPopoverCargosRopa.html"},a.dynamicPopoverRopasRopaTrabajo={templateUrl:"myPopoverRopasRopa.html"},a.ObtenerDotacionesRopa(e),a.abrirPopup(a.idModalRopaTrabajo))},a.cerrarModalRopaTrabajo=function(){a.cerrarPopup(a.idModalRopaTrabajo)},a.abrirModalNuevaRopaTrabajo=function(e,o,i,t){if(a.filtroropa.inicio="",a.filtroropa.fin="",a.empleado=e,o?a.actualizarDotacion=!0:(a.actualizarDotacion=!1,a.verinformacionDOtacion=!1),void 0!=i?(a.verinformacionDOtacion=!0,a.indexInfo=i,console.log(a.listaDotaciones[a.indexInfo].ropas),a.visible=!1):void 0!=t&&(a.indexInfo=t,a.visible=!0,a.verinformacionDOtacion=!1),a.listaDotaciones.length>0){var n=new Date;if(new Date(a.listaDotaciones[a.listaDotaciones.length-1].fecha_vencimiento).getTime()>n.getTime()){a.obtenerCargosEmpleado(o,i,!1);a.dotacionRopa=a.listaDotaciones[a.listaDotaciones.length-1],a.sucursales.forEach(function(e,o,i){0==e.numero&&(a.dotacionRopa.sucursal=e),o===i.length-1&&a.obtenerAlmacenes(a.dotacionRopa.sucursal.id)}),a.dotacionRopa.almacen=a.listaDotaciones[a.listaDotaciones.length-1].almacen,a.dotacionRopa.almacen?a.editAlmacen=!0:a.editAlmacen=!1,a.abrirPopup(a.idModalNuevaRopaTrabajo)}else a.editAlmacen=!1,a.dotacionRopa={id_usuario:a.usuario.id},a.sucursales.forEach(function(e,o,i){0==e.numero&&(a.dotacionRopa.sucursal=e),o===i.length-1&&a.obtenerAlmacenes(a.dotacionRopa.sucursal.id)}),a.obtenerCargosEmpleado(o,i,!0),a.abrirPopup(a.idModalNuevaRopaTrabajo)}else a.editAlmacen=!1,a.empleado=e,a.dotacionRopa={id_usuario:a.usuario.id},a.sucursales.forEach(function(e,o,i){0==e.numero&&(a.dotacionRopa.sucursal=e),o===i.length-1&&a.obtenerAlmacenes(a.dotacionRopa.sucursal.id)}),a.obtenerCargosEmpleado(o,i,!1),a.abrirPopup(a.idModalNuevaRopaTrabajo)},a.cerrarModalNuevaRopaTrabajo=function(){a.ObtenerDotacionesRopa(a.empleado),a.cerrarPopup(a.idModalNuevaRopaTrabajo)},a.abrirModalItemsNuevaRopaTrabajo=function(){console.log(a.dotacionRopa.dotacionItems),a.obtenerListaRopaTrabajoProductos(),a.abrirPopup(a.idModalItemsNuevaRopaTrabajo)},a.cerrarModalItemsNuevaRopaTrabajo=function(){a.cerrarPopup(a.idModalItemsNuevaRopaTrabajo)},a.abrirModalTr3BancoMsc=function(){a.abrirPopup(a.idModalTr3BancoMsc)},a.cerrarModalTr3BancoMsc=function(){a.cerrarPopup(a.idModalTr3BancoMsc)},a.abrirModalTr3BancoUnion=function(){a.abrirPopup(a.idModalTr3BancoUnion)},a.cerrarModalTr3BancoUnion=function(){a.cerrarPopup(a.idModalTr3BancoUnion)},a.abrirModalbanco=function(e){a.tr3={anticipos:a.anticiposTr3,tipo:""},a.datosBanco=e,"Banco Mercantil Santa Cruz"==e.nombre&&(a.tr3.tipo="MSC",a.abrirModalTr3BancoMsc()),"Banco Unión"==e.nombre&&(a.tr3.tipo="BU",a.abrirModalTr3BancoUnion())},a.abrirModalImprimirHojaVida=function(){a.filtroCap={inicio:"",fin:"",capacidadInterna:""},a.abrirPopup(a.idModalImpresionHojaVida)},a.cerrarModalImprimirHojaVida=function(){a.cerrarPopup(a.idModalImpresionHojaVida)},a.abrirDialogEditarPreRequisito=function(e){a.prerequisito=e,a.prerequisito.fecha_vencimiento_texto=a.fechaATexto(new Date),a.abrirPopup(a.idModalEditarPrerequisito)},a.cerrarDialogEditarPreRequisito=function(){a.cerrarPopup(a.idModalEditarPrerequisito)},a.abrirDialogPrerequisitoNuevo=function(){a.NuevoP=new h({puede_modificar_rrhh:!1}),a.abrirPopup(a.idModalDialogPrerequisitoNuevo)},a.cerrarDialogPrerequisitoNuevo=function(){a.cerrarPopup(a.idModalDialogPrerequisitoNuevo)},a.abrirDialogHistoricoPreRequisito=function(e,o){var i=0,t=0;a.preRequisito=e,a.paciente=o,j({id_pre:a.preRequisito.preRequisito.id,id_pac:a.paciente.id,inicio:i,fin:t}).then(function(e){a.historialPrerequisitosPaciente=e.historial,r.stop(),a.filtro.inicio=a.filtro.inicio instanceof Date?a.filtro.inicio.getDate()+"/"+(a.filtro.inicio.getMonth()+1)+"/"+a.filtro.inicio.getFullYear():"",a.filtro.fin=a.filtro.fin instanceof Date?a.filtro.fin.getDate()+"/"+(a.filtro.fin.getMonth()+1)+"/"+a.filtro.fin.getFullYear():""}),a.abrirPopup(a.idModalHistorialPrerequisito)},a.guardarEntregaPrerequisito=function(e){r.start(),null==e.fecha_entrega_texto||""==e.fecha_entrega_texto?a.mostrarMensaje("Ingrese la fecha de entrega."):(e.fecha_entrega=new Date(a.convertirFecha(e.fecha_entrega_texto)),e.asignado=!0,T.save(e,function(e){v(a.paciente.id,{inicio:0,fin:0}).then(function(o){a.prerequisitosPaciente=o.Prerequisitos,a.mostrarMensaje(e.mensaje),a.prerequisitosPaciente.forEach(function(a){null!=a.fecha_entrega&&(a.entregado=!0)}),a.cerrarPopUpEntregaPreRequisito(),r.stop()})},function(e){a.mostrarMensaje("Ocurrio un problema al guardar la fecha de entrega  de el prerequisito")}))},a.verificarFechaEntregaPrerequisito=function(e,o){a.preRequisito=e,a.preRequisito.fecha_entrega_texto=a.fechaATexto(new Date),a.paciente=void 0===o?e.pacientePrerequisito:o;var i=new Date(a.preRequisito.fecha_vencimiento).getTime(),t=(new Date).getTime();Math.floor((t-i)/864e5)>=0?a.abrirDialogEntregaPreRequisito(a.preRequisito,a.empleado):a.abrirPopup(a.idModalDialogConfirmacionEntregaAdelantado)},a.abrirDialogEntregaPreRequisito=function(e,o){a.cerrarConfirmacionEntragaAdelantadaPrerequisito(),a.preRequisito=e,a.preRequisito.fecha_entrega_texto=a.fechaATexto(new Date),a.paciente=o,a.abrirPopup(a.IdEntregaPrerequisito)},a.cerrarPopUpEntregaPreRequisito=function(){a.cerrarPopup(a.IdEntregaPrerequisito)},a.cerrarConfirmacionEntragaAdelantadaPrerequisito=function(){a.cerrarPopup(a.idModalDialogConfirmacionEntregaAdelantado)},a.filtrarHistorialPrerequisito=function(e){if(void 0!=e){var o=null===e.inicio||""===e.inicio||void 0===e.inicio?0:new Date(e.inicio),i=null===e.fin||""===e.fin||void 0===e.fin?0:new Date(e.fin),t=null===e.opcion||void 0===e.opcion?0:e.opcion;e={inicio:o,fin:i,opcion:t}}else e={inicio:0,fin:0};j({id_pre:a.preRequisito.preRequisito.id,id_pac:a.paciente.id,inicio:e.inicio,fin:e.fin}).then(function(o){a.historialPrerequisitosPaciente=o.historial,r.stop(),e.inicio=a.filtro.inicio instanceof Date?a.filtro.inicio.getDate()+"/"+(a.filtro.inicio.getMonth()+1)+"/"+a.filtro.inicio.getFullYear():"",e.fin=a.filtro.fin instanceof Date?a.filtro.fin.getDate()+"/"+(a.filtro.fin.getMonth()+1)+"/"+a.filtro.fin.getFullYear():""})},a.cerrarDialogHistoricoPreRequisito=function(){a.cerrarPopup(a.idModalHistorialPrerequisito)},a.abrirDialogVerEmpleado=function(e){promesaPaciente=f(e.id),promesaPaciente.then(function(e){void 0!=e.clase&&(e.medicoPaciente.tipo_contrato=e.clase),a.paciente=e.medicoPaciente,a.paciente.fecha_nacimiento_texto=a.fechaATexto(a.paciente.persona.fecha_nacimiento),a.seleccionarCargos(paciente.cargos),a.paciente.ver=!0}),a.abrirPopup(a.idModalWizardRhVista)},a.cerrarDialogVerEmpleado=function(){a.cerrarPopup(a.idModalWizardRhVista)},a.abrirDialogRhNuevo=function(){a.steps=[{cabeza:"cabeza-nuevo-datos-personales",cuerpo:"cuerpo-nuevo-datos-personales"},{cabeza:"cabeza-nuevo-datos-comple",cuerpo:"cuerpo-nuevo-datos-comple"},{cabeza:"cabeza-nuevo-datos-laborales",cuerpo:"cuerpo-nuevo-datos-laborales"}],a.nuevoRH=new s({persona:{imagen:"img/icon-user-default.png"},id_empresa:a.usuario.id_empresa,es_empleado:!0,activoCopiaCodigo:!0}),a.abrirPopup(a.idModalRhNuevo)},a.cerrarDialogRhNuevo=function(){a.cerrarPopup(a.idModalRhNuevo)},a.cerrarDialogEliminarUsuarioRh=function(){a.cerrarPopup(a.idEliminarUsuarioRh)},a.abrirDialogEliminarUsuarioRh=function(e){a.empleado=e,e.activo&&a.abrirPopup(a.idEliminarUsuarioRh)},a.cerrarDialogEliminarSeguroEmpleado=function(){a.cerrarPopup(a.idEliminarSeguroEmpleado)},a.abrirDialogEliminarSeguroEmpleado=function(e,o){a.otroSeguro=e,a.otroSeguro.index=o,a.abrirPopup(a.idEliminarSeguroEmpleado)},a.cerrarDialogEliminarFamiliarEmpleado=function(){a.cerrarPopup(a.idEliminarFamiliarEmpleado)},a.abrirDialogEliminarFamiliarEmpleado=function(e,o){a.familiar=e,a.familiar.index=o,a.abrirPopup(a.idEliminarFamiliarEmpleado)},a.abrirIdModalDialogPreRequisitos=function(e){e.activo&&(a.empleado=e,a.verificarAsignacionPrerequisitos(),a.abrirPopup(a.idModalPrerequisitos))},a.cerrarIdModalDialogPreRequisitos=function(){a.cerrarPopup(a.idModalPrerequisitos)},a.abrirDialogEmpleado=function(e,o){void 0==a.primeroGuardarParaCerrar&&(a.primeroGuardarParaCerrar=!1),a.steps=[{cabeza:"stepDatosPersonales",cuerpo:"datos-personales"},{cabeza:"stepDatosLaborales",cuerpo:"ficha-datos-laborales"},{cabeza:"stepdatosAfiliacion",cuerpo:"ficha-seguros"},{cabeza:"stepDatosFamiliares",cuerpo:"ficha-familia"}],a.obtenerDatosFichaUsuario(e,o),a.empleado=e,e.activo?a.nopuedoModificarFicha=!1:a.nopuedoModificarFicha=!0,a.abrirPopup(a.idModalEmpleado)},a.cerrarDialogEmpleado=function(e){0==a.primeroGuardarParaCerrar?(a.departamentos=[],a.provincias=[],a.localidades=[],a.obtenerCargos(),a.obtenerDiscapacidades(),a.cerrarPopup(a.idModalEmpleado)):a.mostrarMensaje("guardar nuevo reingreso para salir!")},a.abrirDialogDepartamentoEstado=function(){a.clase={pais:a.ficha.empleado.persona.pais},E("DEP").then(function(e){a.tipo_edicion2=e,a.abrirPopup(a.idModalDepartamentoEstado)})},a.cerrarDialogDepartamentoEstado=function(){a.cerrarPopup(a.idModalDepartamentoEstado)},a.abrirDialogProvincia=function(){a.clase={departamento:a.ficha.empleado.persona.ciudad},E("MUN").then(function(e){a.tipo_edicion2=e,a.abrirPopup(a.idModalProvincia)})},a.cerrarDialogProvincia=function(){a.cerrarPopup(a.idModalProvincia)},a.abrirDialogLocalidad=function(){a.clase={provincia:a.ficha.empleado.persona.provincia},E("LOC").then(function(e){a.tipo_edicion2=e,a.abrirPopup(a.idModalLocalidad)})},a.cerrarDialogLocalidad=function(){a.cerrarPopup(a.idModalLocalidad)},a.fechacontratos=[{name:"10/01/2000 - 01/01/2002"},{name:"10/01/2000 - 01/01/2002"},{name:"10/01/2000 - 01/01/2002"}],a.localLang={selectAll:"Marcar todo",selectNone:"No marcar ninguno",reset:"Deshacer todo",search:"Escriba aquí para busc$scope.idModalGradoar...",nothingSelected:"No se ha seleccionado nada"},a.abrirDialogHojaVida=function(e){a.empleado=e,a.empleado.activo=!e.eliminado,a.empleado.persona||(a.empleado.persona={nombre_completo:""},a.empleado.persona.nombre_completo=e.nombre_completo),C(e.id).then(function(e){e.hojaVida?(e.hojaVida.capacidades.length>0&&e.hojaVida.capacidades.forEach(function(e,o,i){e.fechaTexto=a.fechaATexto(e.fecha)}),e.hojaVida.logros.length>0&&e.hojaVida.logros.forEach(function(e,o,i){e.fechaTexto=a.fechaATexto(e.fecha)}),e.hojaVida.experienciasLaborales.length>0&&e.hojaVida.experienciasLaborales.forEach(function(e,o,i){e.fecha_inicioTexto=a.fechaATexto(e.fecha_inicio),e.fecha_finTexto=a.fechaATexto(e.fecha_fin)}),a.hojaVida=e.hojaVida):a.hojaVida={capacidades:[],logros:[],formacionesAcademicas:[],experienciasLaborales:[]}}),a.formacionAcademica={edit:!1,eliminado:!1},a.capacidad={edit:!1,eliminado:!1},a.logros={edit:!1,eliminado:!1},a.experienciaLaboral={edit:!1,eliminado:!1},a.abrirPopup(a.idModalHojaVida)},a.cerrarDialogHojaVida=function(){a.cerrarPopup(a.idModalHojaVida)},a.abrirDialogNuevoFamiliar=function(){a.abrirPopup(a.idModalNuevoFamiliar)},a.cerrarDialogNuevoFamiliar=function(){a.familiar&&(a.familiar={edit:!1}),a.cerrarPopup(a.idModalNuevoFamiliar)},a.abrirDialogHistorialContrato=function(){a.obtenerHistorialContratos(a.empleado),a.abrirPopup(a.idModalHistorialContrato)},a.cerrarDialogHistorialContrato=function(){a.cerrarPopup(a.idModalHistorialContrato)},a.abrirDialogBeneficiosSociales=function(e,o){if(a.empleado=e,e.fecha_inicio){if(o){a.beneficio=o;var i=null,t=new Date;a.beneficio.fecha_elaboracion=a.beneficio.fecha_elaboracion?a.fechaATexto(a.beneficio.fecha_elaboracion):a.fechaATexto(new Date),a.beneficio.fecha_asistensia&&(a.beneficio.fecha_asistensia=a.fechaATexto(a.beneficio.fecha_asistensia)),a.beneficio.fecha_ingreso=a.beneficio.fecha_ingreso?a.fechaATexto(a.beneficio.fecha_ingreso):a.fechaATexto(e.fecha_inicio),a.beneficio.fecha_retiro&&(a.beneficio.fecha_retiro=a.fechaATexto(a.beneficio.fecha_retiro));var n=!1;e.fecha_expiracion&&(i=a.fechaATexto(e.fecha_expiracion),t=new Date(e.fecha_expiracion),n=!0),o.cuenta&&(o.tipo_pago=!0),o.mes_uno=a.meses[o.mes_uno],o.mes_dos=a.meses[o.mes_dos],o.mes_tres=a.meses[o.mes_tres],o.totalAguinaldo=a.CalcularAguinaldoNavidad2(o);var r=new Date(e.fecha_inicio);a.tiempoTrabajado=duration(r,t);var c=a.fechaATexto(new Date);a.obtenerbeneficiosSociales(a.tiempoTrabajado),a.deduccion={},a.ingreso={},a.vacacion={sabado:!1,inicio_tipo:!1,fin_tipo:!1,aniosDisponibles:0,historial:null},a.beneficio.anios=0,a.beneficio.meses=0,a.beneficio.dias=0,a.beneficio.ingresos=[],a.beneficio.deducciones=[],a.beneficio.promedio=(a.beneficio.primer_mes+a.beneficio.segundo_mes+a.beneficio.tercer_mes)/3,a.beneficio.deduccionEingresos.forEach(function(e,o,i){"OTRING"==e.tipo.nombre_corto?a.beneficio.ingresos.push(e):a.beneficio.deducciones.push(e),o===i.length-1&&a.calcularDesaucio(a.beneficio,!0)})}else{i=null,t=new Date,n=!1;e.fecha_expiracion&&(i=a.fechaATexto(e.fecha_expiracion),t=new Date(e.fecha_expiracion),n=!0);r=new Date(e.fecha_inicio);a.tiempoTrabajado=duration(r,t);c=a.fechaATexto(new Date);a.beneficio={fecha_elaboracion:c,tipo_beneficio:n,anios:0,meses:0,dias:0,fecha_elaboracion:a.fechaATexto(new Date),fecha_ingreso:a.fechaATexto(e.fecha_inicio),fecha_retiro:i,ingresos:[],deducciones:[]},a.obtenerbeneficiosSociales(a.tiempoTrabajado),a.deduccion={},a.ingreso={},a.vacacion={sabado:!1,inicio_tipo:!1,fin_tipo:!1,aniosDisponibles:0,historial:null}}a.abrirPopup(a.idModalBeneficiosSociales)}else k(function(){a.$apply(function(){a.mostrarMensaje("No cuenta con ficha actualmente, crear ficha empleado!")})},200)},a.verVacaciones=function(){a.verVacacion=!a.verVacacion},a.abrirDialogBeneficiosSociales2=function(e,o){a.verVacacion=!1,ga(e.id_ficha).then(function(i){i.beneficio?i.beneficio.fecha_ingreso&&1!=o?a.abrirModalVerificarCuenta(e,"finiquito"):(a.obtenerHistorialGestionesVacacion(e,!1,!0),a.abrirDialogBeneficiosSociales(e,i.beneficio)):sa(e.id_ficha).then(function(o){var i=new Date;if(o.length>0)if(o[o.length-1].gestion<i.getFullYear()){var t=o[o.length-1].anio+1,n=0,r=i.getFullYear();t<=5?n=a.configuracionesVacacion[0].dias:t<=10?n=a.configuracionesVacacion[1].dias:t>10&&(n=a.configuracionesVacacion[2].dias);var c={gestion:r,anio:t,aplicadas:n,tomadas:0};pa(e.id_ficha,c).then(function(i){a.obtenerHistorialGestionesVacacion(e,!1,!0),a.abrirDialogBeneficiosSociales(e,o.beneficio)})}else a.obtenerHistorialGestionesVacacion(e,!1,!0),a.abrirDialogBeneficiosSociales(e,o.beneficio);else a.mostrarMensaje("No cuenta con ficha del empleado actualizada, actualizar ficha empleado")})})},a.cerrarDialogBeneficiosSociales=function(){a.cerrarPopup(a.idModalBeneficiosSociales)},a.abrirDialogDetalleVacaciones=function(){a.abrirPopup(a.idModalDetalleVacaciones)},a.cerrarDialogDetalleVacaciones=function(){a.cerrarPopup(a.idModalDetalleVacaciones)},a.abrirDialogBitacoraFicha=function(){ha(a.ficha.id).then(function(e){a.bitacoraCambios=e,a.abrirPopup(a.idModalBitacoraFicha)})},a.cerrarDialogBitacoraFicha=function(){a.cerrarPopup(a.idModalBitacoraFicha)},a.abrirDialogAnticipoExtraordinario=function(e){e.activo&&(a.empleado=e,e.haber_basico?(a.obtenerAnticiposExtra(e),a.abrirPopup(a.idModalAnticipoExtraordinario)):k(function(){a.$apply(function(){a.mostrarMensaje("No cuenta con haber basico actualizar ficha empleado!")})},200))},a.obtenerAnticiposExtra=function(e){var o=(new Date).getMonth();a.mesActual=o;var i=String((new Date).getFullYear());new Date;a.listaAnticipos=[],a.filtroAnticipo={mes:{id:o},gestion:i};var t=new Date,n={inicio:new Date(t.getFullYear(),t.getMonth(),1),fin:new Date(t.getFullYear(),t.getMonth()+1,0),nombre:"ORDI",id_empresa:0};a.anticipo_ordinaroOextra=0,a.obtenerListaAnticipos(n,e.id)},a.cerrarDialogAnticipoExtraordinario=function(){a.cerrarPopup(a.idModalAnticipoExtraordinario)},a.abrirDialogNuevoPrestamo=function(e){e.activo&&(a.empleado=e,a.prestamo={},e.haber_basico?a.abrirPopup(a.idModalNuevoPrestamo):k(function(){a.$apply(function(){a.mostrarMensaje("No cuenta con haber basico actualizar ficha empleado!")})},200))},a.cerrarDialogNuevoPrestamo=function(){a.cerrarPopup(a.idModalNuevoPrestamo)},a.abrirDialogAusenciasVacaciones=function(e){a.empleado=e,a.ausencia={primera_baja:!1},a.otraAusencia={},a.vacacion={sabado:!1,inicio_tipo:!1,fin_tipo:!1,aniosDisponibles:0,historial:null},a.feriados=[],a.listaFeriado(),a.obtenerHistorialGestionesVacacion(e,!0)},a.abriirmodelAusenciasVacas=function(e){e.activo&&(e.fecha_inicio?sa(e.id_ficha).then(function(o){var i=new Date;if(o[o.length-1].gestion<i.getFullYear()){var t=o[o.length-1].anio+1,n=0,r=i.getFullYear();t<=5?n=a.configuracionesVacacion[0].dias:t<=10?n=a.configuracionesVacacion[1].dias:t>10&&(n=a.configuracionesVacacion[2].dias);var c={gestion:r,anio:t,aplicadas:n,tomadas:0};pa(e.id_ficha,c).then(function(o){a.abrirDialogAusenciasVacaciones(e)})}else a.abrirDialogAusenciasVacaciones(e)}):k(function(){a.$apply(function(){a.mostrarMensaje("No cuenta con ficha actualmente, crear ficha empleado!")})},200))},a.cerrarDialogAusenciasVacaciones=function(){a.cerrarPopup(a.idModalAusenciasVacaciones)},a.abrirDialogTipoBaja=function(e){a.clase={},e.ausencias?a.tiposAusencia=e.ausencias:a.tipoAusencia=[],a.abrirPopup(a.idModalTipoBaja)},a.cerrarDialogTipoBaja=function(){a.cerrarPopup(a.idModalTipoBaja)},a.GuardarFeriadosCalendario=function(){var e=a.calendar.fullCalendar("clientEvents"),o=[];e.length>0?e.forEach(function(e,i,t){if(void 0==e.id){e={start:e.start._d,end:e.end._d};o.push(e)}i===t.length-1&&oa(a.usuario.id_empresa,o,a.feriadosEliminados).then(function(e){a.listaFeriado(),a.feriadosEliminados=[],a.cerrarDialogFeriados(),a.mostrarMensaje(e.mensaje)})}):oa(a.usuario.id_empresa,o,a.feriadosEliminados).then(function(e){a.listaFeriado(),a.feriadosEliminados=[],a.cerrarDialogFeriados(),a.mostrarMensaje(e.mensaje)})},a.agregarFeriado=function(e,o,i){a.calendar.fullCalendar("renderEvent",{title:"Feriado",start:e,end:o,allDay:i,className:"label-info"},!0),a.calendar.fullCalendar("unselect")},a.obtenerFechasCalendarioFeriado=function(){$("#calendar").fullCalendar("removeEvents");var e=[];a.FeriadosCalendario.forEach(function(o,i,t){var n={id:o.id,title:"Feriado",start:o.fecha_inicio,end:o.fecha_fin,className:"label-info"};e.push(n),i===t.length-1&&a.addEvents(e)},this)},a.listaFeriado=function(){a.ListaDiasFeriado=[],promesa=ia(a.usuario.id_empresa),promesa.then(function(e){e.forEach(function(e,o,i){var t=getDates(new Date(e.fecha_inicio),new Date(e.fecha_fin));a.ListaDiasFeriado.push.apply(a.ListaDiasFeriado,t)}),a.FeriadosCalendario=e})},a.addEvents=function(e){a.calendar.fullCalendar("addEventSource",e)},a.calendar=$("#calendar").fullCalendar({buttonHtml:{prev:'<i class="ace-icon fa fa-chevron-left"></i>',next:'<i class="ace-icon fa fa-chevron-right"></i>'},height:400,header:{left:"prev,next today",center:"title",right:"month,agendaWeek, agendaDay"},events:[],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],buttonText:{today:"hoy",month:"mes",week:"semana",day:"día",list:"lista"},editable:!0,selectable:!0,select:function(e,o,i){var t=a.calendar.fullCalendar("clientEvents"),n=!0;t.length>0?t.forEach(function(t,r,c){a.fechaATexto(t.start._d)==a.fechaATexto(e._d)&&(n=!1),r===c.length-1&&n&&a.agregarFeriado(e,o,i)}):a.agregarFeriado(e,o,i)},eventClick:function(e,o,i){if(void 0!=e.id){var t={id:e.id};a.feriadosEliminados.push(t),a.calendar.fullCalendar("removeEvents",function(a){return a._id==e._id})}else a.calendar.fullCalendar("removeEvents",function(a){return a._id==e._id})}}),a.abrirDialogFeriados=function(){a.abrirPopup(a.idModalFeriados),a.feriadosEliminados=[],$("#calendar").fullCalendar("render"),a.obtenerFechasCalendarioFeriado()},a.cerrarDialogFeriados=function(){a.cerrarPopup(a.idModalFeriados)},a.abrirDialogHitorialVacaciones=function(){a.obtenerHistorialEmpleadVacacion({}),a.abrirPopup(a.idModalHitorialVacaciones)},a.cerrarDialogHitorialVacaciones=function(){a.cerrarPopup(a.idModalHitorialVacaciones)};var ka=new Date,Ga=(ka.getDate(),ka.getMonth()),Ua=ka.getFullYear();a.selectionday=[],a.totalHoras=moment("00:00","HH:mm"),a.calendarCompensacion=$("#calendar-compensacion").fullCalendar({buttonHtml:{prev:'<i class="ace-icon fa fa-chevron-left"></i>',next:'<i class="ace-icon fa fa-chevron-right"></i>'},height:400,defaultView:"agendaWeek",allDaySlot:!1,header:{left:"prev,next today",center:"title",right:"month,agendaWeek, agendaDay"},events:[{title:"Feriado",start:new Date(Ua,Ga,1),className:"label-important"}],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],buttonText:{today:"hoy",month:"mes",week:"semana",day:"día",list:"lista"},editable:!0,selectable:!0,select:function(e,o){a.horas=moment.utc(moment(o,"DD/MM/YYYY HH:mm:ss").diff(moment(e,"DD/MM/YYYY HH:mm:ss"))).format("HH:mm:ss"),a.Event=a.calendarCompensacion.fullCalendar("renderEvent",{start:e,end:o,className:"label-info"},!0),a.selectionday.push({_id:a.Event[0]._id,fecha_real:e,fecha:e.format("DD-MM-YYYY"),hora_inicio:e.format("HH:mm:ss"),hora_fin:o.format("HH:mm:ss"),total:a.horas}),a.sumarTotalHoras(),a.$apply(),a.calendarCompensacion.fullCalendar("unselect")},eventResize:function(e,o,i){var t=e.end,n=e.start,r=e._id;a.horas=moment.utc(moment(t,"DD/MM/YYYY HH:mm:ss").diff(moment(n,"DD/MM/YYYY HH:mm:ss"))).format("HH:mm"),function(e,o){for(var i=0;i<a.selectionday.length;i++)if(a.selectionday[i]._id==e){a.selectionday[i].hora_fin=o,a.selectionday[i].total=a.horas;break}}(r,t.format("HH:mm")),a.sumarTotalHoras(),a.$apply()},eventDrop:function(e,o,i){var t=e.start,n=e.end;a.horas=moment.utc(moment(n,"DD/MM/YYYY HH:mm:ss").diff(moment(t,"DD/MM/YYYY HH:mm:ss"))).format("HH:mm"),function(e,o,i){for(var t=0;t<a.selectionday.length;t++)if(a.selectionday[t]._id==e){a.selectionday[t].fecha=o.format("DD-MM-YYYY"),a.selectionday[t].hora_inicio=o.format("HH:mm"),a.selectionday[t].hora_fin=i.format("HH:mm"),a.selectionday[t].total=a.horas;break}}(e._id,t,n),a.sumarTotalHoras(),a.$apply()},eventClick:function(e,o,i){var t='<div class="modal fade modal-delete">\t\t\t  <div class="modal-dialog">\t\t\t   <div class="modal-content">\t\t\t\t <div class="modal-body">\t\t\t\t   <button type="button" class="close" data-dismiss="modal" style="margin-top:-10px;">&times;</button>\t\t\t\t   <form class="no-margin">\t\t\t\t\t  <label> Eliminar '+e.title+' &nbsp;</label>\t\t\t\t   </form>\t\t\t\t </div>\t\t\t\t <div class="modal-footer">\t\t\t\t\t<button type="button" class="btn btn-sm btn-danger" data-action="delete"><i class="ace-icon fa fa-trash-o"></i>Eliminar</button>\t\t\t\t\t<button type="button" class="btn btn-sm" data-dismiss="modal"><i class="ace-icon fa fa-times"></i> Cancel</button>\t\t\t\t </div>\t\t\t  </div>\t\t\t </div>\t\t\t</div>';(t=$(t).appendTo("body")).find("button[data-action=delete]").on("click",function(){a.calendarCompensacion.fullCalendar("removeEvents",function(a){return a._id==e._id}),a.selectionday.splice(e._id,1),a.$apply(),t.modal("hide")}),t.modal("show").on("hidden",function(){t.remove()})}}),a.sumarTotalHoras=function(){for(var e="",o=0,i=0,t=0;t<a.selectionday.length;t++){var n=a.selectionday[t].total.split(":")[1],r=a.selectionday[t].total.split(":")[0];o+=parseInt(r),(i+=parseInt(n))>=60&&(i-=60,o+=1),e=String("0"+o).slice(-2)+":"+String("0"+i).slice(-2)+":00"}a.SumaTotalHoras=e},a.abrirDialogCompensacion=function(){a.abrirPopup(a.idModalCompensacion),$("#calendar-compensacion").fullCalendar("render")},a.cerrarDialogCompensacion=function(){a.cerrarPopup(a.idModalCompensacion)},a.abrirDialogHistorialAusencias=function(){a.filtroOtrasAusencias={},a.obtenerHistorialEmpleadoOtrasAusencias({inicio:0,fin:0,tipo_ausencia:0}),a.abrirPopup(a.idModalHistorialAusencias)},a.cerrarDialogHistorialAusencias=function(){a.cerrarPopup(a.idModalHistorialAusencias)},a.abrirDialogHistorialAusenciaMedica=function(){a.filtroAusencias={},a.obtenerHistorialEmpleadoAusenciasMedicas({inicio:0,fin:0,tipo_ausencia:0}),a.abrirPopup(a.idModalHistorialAusenciaMedica)},a.cerrarDialogHistorialAusenciaMedica=function(){a.cerrarPopup(a.idModalHistorialAusenciaMedica)},a.abrirDialogTipoAusencia=function(e){a.tiposOtras=e.ausencias,a.clase={},a.abrirPopup(a.idModalTipoAusencia)},a.cerrarDialogTipoAusencia=function(){a.cerrarPopup(a.idModalTipoAusencia)},a.abrirDialogRolTurnos=function(e){if(e.activo)if(a.obtenerlistaRolTurno(e.id_ficha),e.fecha_inicio){a.empleado=e;var o={};a.centrosDeCostos.forEach(function(i,t,n){i.nombre==e.campamento&&(o=i),t===n.length-1&&(a.rolTurno={campo:o,tipo:!1,fecha_fin:"",dias_trabajo:null,dias_descanso:null,grupo:"",id_ficha:null},a.abrirPopup(a.idModalRolTurnos))})}else k(function(){a.$apply(function(){a.mostrarMensaje("No cuenta con ficha actualmente, crear ficha empleado!")})},200)},a.cerrarDialogRolTurnos=function(){a.cerrarPopup(a.idModalRolTurnos)},a.abrirDialogHistorialTurnos=function(e){a.obtenerlistaRolTurno(e.id_ficha),a.abrirPopup(a.idModalHistorialTurnos)},a.cerrarDialogHistorialTurnos=function(){a.cerrarPopup(a.idModalHistorialTurnos)},a.abrirDialogHorasExtras=function(e){if(e.activo)if(e.fecha_inicio){a.empleado=e;var o=new Date;a.horaExtra={fecha:a.fechaATexto(o)},a.abrirPopup(a.idModalHorasExtras)}else k(function(){a.$apply(function(){a.mostrarMensaje("No cuenta con ficha actualmente, crear ficha empleado!")})},200)},a.cerrarDialogHorasExtras=function(){a.cerrarPopup(a.idModalHorasExtras)},a.abrirDialogHistorialHorasExtras=function(){a.obtenerHistorialHorasExtra({inicio:"",fin:""}),a.abrirPopup(a.idModalHistorialHorasExtras)},a.cerrarDialogHistorialHorasExtras=function(){a.cerrarPopup(a.idModalHistorialHorasExtras)},a.abrirDialogAnticipoRegular=function(){a.obteneranticiposOrdi(),a.dynamicPopovertr3={templateUrl:"myPopoverTr3.html"},a.obtenerDepartamentos(),a.abrirPopup(a.idModalAnticipoRegular)},a.obteneranticiposOrdi=function(){var e=(new Date).getMonth(),o=String((new Date).getFullYear());new Date;a.listaAnticipos=[],a.meses.forEach(function(i,t,n){if(i.id==e&&(e=i),t===n.length-1){a.filtroAnticipo={mes:e,gestion:o};var r=new Date,c={inicio:new Date(r.getFullYear(),r.getMonth(),1),fin:new Date(r.getFullYear(),r.getMonth()+1,0),nombre:"EXTRAORDI",id_empresa:a.usuario.id_empresa};a.anticipo_extraordinaro=0,a.obtenerListaAnticiposOrdi(c,0)}})},a.cerrarDialogAnticipoRegular=function(){a.listaAnticipos2=[],a.cerrarPopup(a.idModalAnticipoRegular)},a.abrirDialogPrestamosPersonal=function(){a.obtenerPrestamos(),a.abrirPopup(a.idModalPrestamosPersonal)},a.optenerListaPrestamos=function(){V(a.paginator).then(function(e){a.paginator.setPages(e.paginas),e.prestamos.length>0?e.prestamos.forEach(function(o,i,t){var n=a.fechaATexto(o.fecha_inicial);o.fecha_vence=editar_fecha(n,o.plazo,"m","/"),o.saldo=o.monto,o.pago=0,a.prestamos={total_montos:0,pagos_acuenta:0,saldo:0},i===t.length-1&&e.prestamos.forEach(function(o,i,t){o.prestamoPagos.length>0?(o.prestamoPagos[o.prestamoPagos.length-1].saldo_anterior==o.total&&(o.pagadoTotal=!0),o.pagadoTotal=!1,a.prestamos.total_montos+=o.monto,a.prestamos.pagos_acuenta+=o.prestamoPagos[o.prestamoPagos.length-1].a_cuenta_anterior,a.prestamos.saldo+=o.total-o.prestamoPagos[o.prestamoPagos.length-1].a_cuenta_anterior):(o.pagadoTotal=!1,a.prestamos.total_montos+=o.monto,a.prestamos.pagos_acuenta+=0,a.prestamos.saldo+=o.total),i===t.length-1&&(a.listaPrestamos=e.prestamos)}),o.montoEdit=!1}):(a.listaPrestamos={},a.prestamos={})})},a.copiarCodigodeCi=function(a){a.activoCopiaCodigo?a.codigo=a.persona.ci:a.codigo=""},a.obtenerPrestamos=function(){r.start(),a.paginator=d(),a.paginator.column="id",a.paginator.direccion="asc",a.filtro={empresa:a.usuario.id_empresa,plazo:"",inicio:"",fin:"",nombre:"",apellido:"",cuentas_liquidas:!1},a.paginator.callBack=a.optenerListaPrestamos,a.paginator.getSearch("",a.filtro,null),r.stop()},a.borrarFechas=function(e){e.fin="",e.inicio="",a.paginator.getSearch("",a.filtro,null)},a.cerrarDialogPrestamosPersonal=function(){a.cerrarPopup(a.idModalPrestamosPersonal)},a.abrirDialogNuevoAnticipoRegularTodos=function(){a.listaAnticipos2=[],a.cerrarDialogAdvertencia(),a.obtenerListaEmpleados(),a.abrirPopup(a.idModalNuevoAnticipoRegularTodos)},a.cerrarDialogNuevoAnticipoRegularTodos=function(){a.cerrarPopup(a.idModalNuevoAnticipoRegularTodos)},a.abrirDialogAdvertencia=function(e){a.abrirModalAdvertencia=e,a.abrirPopup(a.idModalAdvertencia)},a.abrirDialogAdvertenciaPrestamo=function(){a.mensajeAdvertencia={texto1:"Los prestamos y las condiciones se realizarán para todos los trabajadores seleccionados.",texto2:"Para prestamos personalizados use la opción directamente en la fila del empleado."},a.abrirDialogAdvertencia(a.abrirDialogPretamosNuevoTodos)},a.abrirDialogAdvertenciaAnticipo=function(){a.anticipo={tipo:!1,tope:null,monto:null},a.mensajeAdvertencia={texto1:"Los anticipos y las condiciones se realizarán para todos los trabajadores seleccionados.",texto2:"Para anticipos personalizados use la opción directamente en la fila del empleado."},a.abrirDialogAdvertencia(a.abrirDialogNuevoAnticipoRegularTodos)},a.cerrarDialogAdvertencia=function(){a.cerrarPopup(a.idModalAdvertencia)},a.abrirDialogPretamosNuevoTodos=function(){a.cerrarDialogAdvertencia(),a.obtenerListaEmpleados(),a.abrirPopup(a.idModalPretamosNuevoTodos)},a.cerrarDialogPretamosNuevoTodos=function(){a.cerrarPopup(a.idModalPretamosNuevoTodos)},a.abrirDialogReporteHijos=function(){a.abrirPopup(a.idModalReporteHijos)},a.cerrarDialogReporteHijos=function(){a.cerrarPopup(a.idModalReporteHijos)},a.abrirDialogReporteVeneficios=function(){a.obtenerbeneficiosSocialesEmpresa(),a.empleado=void 0,a.abrirPopup(a.idModalReporteVeneficios)},a.cerrarDialogReporteVeneficios=function(){a.obtenerRecursosHumanos(),a.cerrarPopup(a.idModalReporteVeneficios)},a.abrirDialogPagoPrestamo=function(e){a.prestamo=e;var o=new Date;a.prestamo.prestamoPagos.length>0&&(e.saldo=a.prestamo.prestamoPagos[e.prestamoPagos.length-1].saldo_anterior,e.total=e.monto*e.interes_pactado/100+e.monto);var i=new Date(a.convertirFecha(e.fecha_vence)),t=moment(o).format("YYYY-MM-DD HH:mm:ss"),n=moment(i).format("YYYY-MM-DD HH:mm:ss"),r=moment(t,"YYYY-MM-DD HH:mm:ss"),c=moment(n,"YYYY-MM-DD HH:mm:ss");a.prestamo.plazo_restante=Math.round(c.diff(r,"months",!0)),a.abrirPopup(a.idModalPagoPrestamo)},a.cerrarDialogPagoPrestamo=function(){a.cerrarPopup(a.idModalPagoPrestamo)},a.abrirDialogReporteVacaciones=function(){a.filtroVacacion={},a.obtenerHistorialEmpresaVacacion(a.filtroVacacion),a.abrirPopup(a.idModalReporteVacaciones)},a.cerrarDialogReporteVacaciones=function(){a.cerrarPopup(a.idModalReporteVacaciones)},a.abrirDialogReporteBajasMedicas=function(){a.filtroAusencias={},a.obtenerHistorialEmpresaAusenciasMedicas({inicio:0,fin:0,tipo_ausencia:0}),a.abrirPopup(a.idModalReporteBajasMedicas)},a.cerrarDialogReporteBajasMedicas=function(){a.cerrarPopup(a.idModalReporteBajasMedicas)},a.abrirDialogReporteRolTurnos=function(){a.paginator=d(),a.paginator.column="id",a.paginator.direccion="asc",a.filtroRol={empresa:a.usuario.id_empresa,inicio:"",fin:"",grupo:"",campo:""},a.paginator.callBack=a.obtenerlistaRolTurnoEmpresa,a.paginator.getSearch("",a.filtroRol,null),a.abrirPopup(a.idModalReporteRolTurnos)},a.cerrarDialogReporteRolTurnos=function(){a.cerrarPopup(a.idModalReporteRolTurnos)},a.abrirDialogReporteTurnosDetallado=function(){a.obtenerlistaRolTurnoCal(),a.abrirPopup(a.idModalReporteTurnosDetallado)},a.cambiarFecha=function(a){},a.formatofecha=function(a){var e=a.split("/");return e[2]+"/"+e[1]+"/"+e[0]},a.cerrarDialogReporteTurnosDetallado=function(){a.obtenerRecursosHumanos(),a.cerrarPopup(a.idModalReporteTurnosDetallado)},a.abrirDialogViajes=function(){a.viaje={empleadosEntrada:[],empleadosSalida:[]},a.obtenerlistaRolTurno(0),a.obtenerChoferesViaje(),a.abrirPopup(a.idModalViajes)},a.cerrarDialogViajes=function(){a.cerrarPopup(a.idModalViajes)},a.abrirDialogVisita=function(){a.visita={persona:{nombres:"",apellido_paterno:"",apellido_materno:"",ci:null,expedido:null},visita:!0,estado:{}};for(var e=0;e<a.tiposPasajerosViaje.length;e++){var o=a.tiposPasajerosViaje[e];"VISITA"==o.nombre&&(a.visita.estado=o)}a.abrirPopup(a.idModalVisita)},a.cerrarDialogVisita=function(){a.cerrarPopup(a.idModalVisita)},a.abrirDialogVisitaSalida=function(){a.visita={persona:{nombres:"",apellido_paterno:"",apellido_materno:"",ci:null,expedido:null},visita:!0,estado:{}};for(var e=0;e<a.tiposPasajerosViaje.length;e++){var o=a.tiposPasajerosViaje[e];"VISITA"==o.nombre&&(a.visita.estado=o)}a.abrirPopup(a.idModalVisitaSalida)},a.cerrarDialogVisitaSalida=function(){a.cerrarPopup(a.idModalVisitaSalida)},a.eliminarPopup,a.agregarvisitaEntrada=function(e){a.tiposViaje.clases.forEach(function(o,i,t){"INGRESO"==o.nombre&&(e.tipoViaje=o),i==t.length-1&&(e.persona.nombre_completo=e.persona.nombres,""!=e.persona.apellido_paterno&&(e.persona.nombre_completo+=" "+e.persona.nombre_completo),""!=e.persona.apellido_materno&&(e.persona.nombre_completo+=" "+e.persona.apellido_materno),e.habilitado=!0,e.esVisita=!0,a.viaje.empleadosEntrada.push(e))}),scope.cerrarDialogVisita()},a.agregarvisitaSalida=function(e){a.tiposViaje.clases.forEach(function(o,i,t){"SALIDA"==o.nombre&&(e.tipoViaje=o),i==t.length-1&&(e.persona.nombre_completo=e.persona.nombres,""!=e.persona.apellido_paterno&&(e.persona.nombre_completo+=" "+e.persona.nombre_completo),""!=e.persona.apellido_materno&&(e.persona.nombre_completo+=" "+e.persona.apellido_materno),e.habilitado=!0,e.esVisita=!0,a.viaje.empleadosSalida.push(e))}),a.cerrarDialogVisitaSalida()},a.abrirDialogVehiculosViaje=function(e){a.clase={habilitado:!0},a.tipo_edicion=e,a.abrirPopup(a.idModalVehiculosViaje)},a.agregarVehiculo=function(e){e.nombre=e.vehiculo+"-"+e.placa,e.nombre&&e.nombre_corto&&(-1==a.tipo_edicion.clases.indexOf(e)&&a.tipo_edicion.clases.push(e),a.clase={habilitado:!0})},a.cerrarDialogVehiculosViaje=function(){a.cerrarPopup(a.idModalVehiculosViaje)},a.abrirDialogHistorialViajes=function(){a.obtenerViajesPasajeros(),a.VerViajes=!1,a.abrirPopup(a.idModalHistorialViajes)},a.verBusesViaje=function(){a.obtenerViajes(),a.VerViajes=!0,setTimeout(function(){aplicarDatePickers()},400)},a.verPasajerosViajes=function(){a.obtenerViajesPasajeros(),a.VerViajes=!1,setTimeout(function(){aplicarDatePickers()},400)},a.cerrarDialogHistorialViajes=function(){a.obtenerRecursosHumanos(),a.cerrarPopup(a.idModalHistorialViajes)},a.abrirDialogReporteAusencias=function(){a.filtroOtrasAusencias={},a.obtenerHistorialEmpresaOtrasAusencias({inicio:0,fin:0,tipo_ausencia:0}),a.abrirPopup(a.idModalReporteAusencias)},a.cerrarDialogReporteAusencias=function(){a.cerrarPopup(a.idModalReporteAusencias)},a.abrirDialogCertificado=function(){a.abrirPopup(a.idModalCertificado)},a.cerrarDialogCertificado=function(){a.cerrarPopup(a.idModalCertificado)},a.button_clicked=!1,a.disableImput=function(e){a.button_clicked=!e},a.obtenerGenero=function(){r.start(),a.generos=[],c().then(function(e){e.forEach(function(e){a.generos.push(e)},this),r.stop()})},a.abrirDialogPrerequisitoEditar=function(e){a.NuevoP=new h({id:e.id,nombre:e.nombre,observacion:e.observacion,vencimiento_mes:e.vencimiento_mes,dias_activacion:e.dias_activacion,puede_modificar_rrhh:e.puede_modificar_rrhh}),a.abrirPopup(a.idModalDialogPrerequisitoNuevo)},a.cerrarPopupPrerequisitoNuevo=function(){a.obtenerAlertas(),a.cerrarPopup(a.idModalDialogPrerequisitoNuevo)},a.saveForm=function(){a.nuevoRH.imagen;a.nuevoRH.fechaFicha=new Date,"Siguiente"!=$("#siguiente").text().trim()&&(r.start(),a.nuevoRH.id?(a.nuevoRH.persona.fecha_nacimiento=new Date(a.convertirFecha(a.nuevoRH.persona.fecha_nacimiento)),s.update({id_usuario:a.nuevoRH.id},a.nuevoRH,function(e){r.stop(),a.cerrarDialogRhNuevo(),a.mostrarMensaje("Actualizado Exitosamente!"),a.recargarItemsTabla()})):(a.nuevoRH.persona.fecha_nacimiento=new Date(a.convertirFecha(a.nuevoRH.persona.fecha_nacimiento)),a.nuevoRH.$save({id_usuario:0},function(e){r.stop(),a.cerrarDialogRhNuevo(),a.mostrarMensaje("Guardado Exitosamente!"),a.recargarItemsTabla()},function(e){r.stop(),a.cerrarDialogRhNuevo(),a.mostrarMensaje("Ocurrio un problema al momento de guardar!"),a.recargarItemsTabla()})))},a.obtenerRecursosHumanos=function(){r.start(),a.paginator=d(),a.paginator.column="id",a.paginator.direccion="asc",a.dynamicPopoverCargos={templateUrl:"myPopoverTemplate.html"},a.filtro={empresa:a.usuario.id_empresa,codigo:"",nombres:"",ci:"",campo:"",cargo:"",busquedaEmpresa:"",estado:"",grupo_sanguineo:""},a.paginator.callBack=a.buscarRecursosHumanos,a.paginator.getSearch("",a.filtro,null),r.stop()},a.buscarRecursosHumanos=function(e,o,i,t){r.start(),l(a.paginator).then(function(o){a.paginator.setPages(o.paginas),a.RecursosHumanosEmpleados=o.pacientes,a.RecursosHumanosEmpleados.forEach(function(a){a.activo=0==a.activo}),e&&i&&a.RecursosHumanosEmpleados.forEach(function(e,o,i){0==t?(e.select=!1,a.empleadosSeleccionados=[]):(e.select=!0,a.empleadosSeleccionados.push(e))}),r.stop()})},a.subirExcelPacientes=function(e){r.start();var o,i,t=e.target.files;for(i=t[o=0];o!=t.length;++o){var n=new FileReader;i.name;n.onload=function(e){var o=e.target.result,i=XLSX.read(o,{type:"binary"}),t=i.SheetNames[0],n=2,r=i.Sheets[t],c=[];do{var s={personaReferencia:{}};s.codigo=void 0!=r["A"+n]&&""!=r["A"+n]?r["A"+n].v.toString():null,s.apellido_paterno=void 0!=r["B"+n]&&""!=r["B"+n]?r["B"+n].v.toString():null,s.apellido_materno=void 0!=r["C"+n]&&""!=r["C"+n]?r["C"+n].v.toString():null,s.nombres=void 0!=r["D"+n]&&""!=r["D"+n]?r["D"+n].v.toString():null,s.segundo_nombre=void 0!=r["E"+n]&&""!=r["E"+n]?r["E"+n].v.toString():null,s.ci=void 0!=r["F"+n]&&""!=r["F"+n]?r["F"+n].v.toString():null,s.extension=void 0!=r["G"+n]&&""!=r["G"+n]?r["G"+n].v.toString():null,s.contrato=void 0!=r["H"+n]&&""!=r["H"+n]?r["H"+n].v.toString():null,s.fecha_nacimiento=void 0!=r["I"+n]&&""!=r["I"+n]?a.fecha_excel_angular(r["I"+n].v.toString()):null,s.genero=void 0!=r["J"+n]&&""!=r["J"+n]?r["J"+n].v.toString():null,s.telefono=void 0!=r["K"+n]&&""!=r["K"+n]?r["K"+n].v.toString():null,s.telefono2=void 0!=r["L"+n]&&""!=r["L"+n]?r["L"+n].v.toString():null,s.telefono_movil=void 0!=r["M"+n]&&""!=r["M"+n]?r["M"+n].v.toString():null,s.estilo_de_vida=void 0!=r["N"+n]&&""!=r["N"+n]?r["N"+n].v.toString():null,s.cargo=void 0!=r["O"+n]&&""!=r["O"+n]?r["O"+n].v.toString():null,s.designacion_empresa=void 0!=r["P"+n]&&""!=r["P"+n]?r["P"+n].v.toString():null,s.telefono_empresa=void 0!=r["Q"+n]&&""!=r["Q"+n]?r["Q"+n].v.toString():null,s.campamento=void 0!=r["R"+n]&&""!=r["R"+n]?r["R"+n].v.toString():null,s.riesgos_procesos_trabajo=void 0!=r["S"+n]&&""!=r["S"+n]?r["S"+n].v.toString():null,s.personaReferencia.ciudad_referencia=void 0!=r["T"+n]&&""!=r["T"+n]?r["T"+n].v.toString():null,s.personaReferencia.zona_referencia=void 0!=r["U"+n]&&""!=r["U"+n]?r["U"+n].v.toString():null,s.personaReferencia.calle_av_referencia=void 0!=r["V"+n]&&""!=r["V"+n]?r["V"+n].v.toString():null,s.personaReferencia.nro_referencia=void 0!=r["W"+n]&&""!=r["W"+n]?r["W"+n].v.toString():null,s.personaReferencia.telefonos_referencia=void 0!=r["X"+n]&&""!=r["X"+n]?r["X"+n].v.toString():null,s.personaReferencia.celular_referencia=void 0!=r["Y"+n]&&""!=r["Y"+n]?r["Y"+n].v.toString():null,s.personaReferencia.nombre_referencia=void 0!=r["Z"+n]&&""!=r["Z"+n]?r["Z"+n].v.toString():null,s.fecha_inicio=void 0!=r["AA"+n]&&""!=r["AA"+n]?a.fecha_excel_angular(r["AA"+n].v.toString()):null,s.haber_basico=void 0!=r["AB"+n]&&""!=r["AB"+n]?parseFloat(r["AB"+n].v.toString()):null,s.matricula_seguro=void 0!=r["AC"+n]&&""!=r["AC"+n]?r["AC"+n].v.toString():null,s.seguro_salud=void 0!=r["AD"+n]&&""!=r["AD"+n]?r["AD"+n].v.toString():null,s.estadoTexto=void 0!=r["AE"+n]&&""!=r["AE"+n]?r["AE"+n].v.toString():null,s.estado="Activo"!==s.estadoTexto.toUpperCase(),s.fecha_expiracion=void 0!=r["AF"+n]&&""!=r["AF"+n]?a.fecha_excel_angular(r["AF"+n].v.toString()):null,s.imagen="img/icon-user-default.png",s.es_empleado=!0;var l=new Date(s.fecha_inicio);s.historialVacacion=[];var d=l.getFullYear();a.obtenerAnios(d).forEach(function(e,o,i){var t=o+1,n=null;t<=5?n=a.configuracionesVacacion[0].dias:t<=10?n=a.configuracionesVacacion[1].dias:t>10&&(n=a.configuracionesVacacion[2].dias);var r={gestion:e,anio:o+1,aplicadas:n,tomadas:0};s.historialVacacion.push(r)}),c.push(s),n++,0}while(void 0!=r["A"+n]);a.GuardarEmpleadosRh(c)},n.readAsBinaryString(i)}},a.subirExcelFichaEmpleados=function(e){r.start();var o,i,t=e.target.files;for(i=t[o=0];o!=t.length;++o){var n=new FileReader;i.name;n.onload=function(e){var o=e.target.result,i=XLSX.read(o,{type:"binary"}),t=i.SheetNames[0],n=2,r=i.Sheets[t],c=[];do{var s={seguros:[]};s.codigo=void 0!=r["A"+n]&&""!=r["A"+n]?r["A"+n].v.toString():null,s.apellido_paterno=void 0!=r["B"+n]&&""!=r["B"+n]?r["B"+n].v.toString():null,s.apellido_materno=void 0!=r["C"+n]&&""!=r["C"+n]?r["C"+n].v.toString():null,s.nombres=void 0!=r["D"+n]&&""!=r["D"+n]?r["D"+n].v.toString():null,s.segundo_nombre=void 0!=r["E"+n]&&""!=r["E"+n]?r["E"+n].v.toString():null,s.estado_civil=void 0!=r["F"+n]&&""!=r["F"+n]?r["F"+n].v.toString():null,s.nacionalidad=void 0!=r["G"+n]&&""!=r["G"+n]?r["G"+n].v.toString():null,s.departamento=void 0!=r["H"+n]&&""!=r["H"+n]?r["H"+n].v.toString():null,s.provincia=void 0!=r["I"+n]&&""!=r["I"+n]?r["I"+n].v.toString():null,s.localidad=void 0!=r["J"+n]&&""!=r["J"+n]?a.fecha_excel_angular(r["J"+n].v.toString()):null,s.tipo_personal=void 0!=r["K"+n]&&""!=r["K"+n]?r["K"+n].v.toString():null,s.carga_horario=void 0!=r["L"+n]&&""!=r["L"+n]?r["L"+n].v.toString():null,s.area=void 0!=r["M"+n]&&""!=r["M"+n]?r["M"+n].v.toString():null,s.ubicacion=void 0!=r["N"+n]&&""!=r["N"+n]?r["N"+n].v.toString():null,s.lugar_seguro=void 0!=r["O"+n]&&""!=r["O"+n]?r["O"+n].v.toString():null,s.nua_cua=void 0!=r["P"+n]&&""!=r["P"+n]?r["P"+n].v.toString():null,s.afp_aporte=void 0!=r["Q"+n]&&""!=r["Q"+n]?r["Q"+n].v.toString():null,s.lugar_afp=void 0!=r["R"+n]&&""!=r["R"+n]?r["R"+n].v.toString():null,s.seguro1=void 0!=r["S"+n]&&""!=r["S"+n]?r["S"+n].v.toString():null,s.monto1=void 0!=r["T"+n]&&""!=r["T"+n]?parseFloat(r["T"+n].v.toString()):null,s.observacion1=void 0!=r["U"+n]&&""!=r["U"+n]?r["U"+n].v.toString():null,s.seguro2=void 0!=r["V"+n]&&""!=r["V"+n]?r["V"+n].v.toString():null,s.monto2=void 0!=r["W"+n]&&""!=r["W"+n]?parseFloat(r["W"+n].v.toString()):null,s.observacion2=void 0!=r["X"+n]&&""!=r["X"+n]?r["X"+n].v.toString():null,c.push(s),n++,0}while(void 0!=r["A"+n]);var l=[],d=[],p=[],u=[],f=[],m=[],h=[],g=[],b=[],v=[];c.forEach(function(e,o,i){var t=!1;if(l.length>0){for(var n=0;n<l.length;n++){var r=l[n];null!=e.afp_aporte&&r==e.afp_aporte&&(t=!0)}t||l.push(e.afp_aporte)}else l.push(e.afp_aporte);var s=!1;if(d.length>0){for(n=0;n<d.length;n++){r=d[n];null!=e.lugar_afp&&r==e.lugar_afp&&(s=!0)}s||d.push(e.lugar_afp)}else d.push(e.lugar_afp);var _=!1;if(p.length>0){for(n=0;n<p.length;n++){r=p[n];null!=e.lugar_seguro&&r==e.lugar_seguro&&(_=!0)}_||p.push(e.lugar_seguro)}else p.push(e.lugar_seguro);var D=!1;if(u.length>0){for(n=0;n<u.length;n++){r=u[n];null!=e.tipo_personal&&r==e.tipo_personal&&(D=!0)}D||u.push(e.tipo_personal)}else u.push(e.tipo_personal);var E=!1;if(f.length>0){for(n=0;n<f.length;n++){r=f[n];null!=e.carga_horario&&r==e.carga_horario&&(E=!0)}E||f.push(e.carga_horario)}else f.push(e.carga_horario);var A=!1;if(m.length>0){for(n=0;n<m.length;n++){r=m[n];null!=e.area&&r==e.area&&(A=!0)}A||m.push(e.area)}else m.push(e.area);var R=!1;if(h.length>0){for(n=0;n<h.length;n++){r=h[n];null!=e.ubicacion&&r==e.ubicacion&&(R=!0)}R||h.push(e.ubicacion)}else h.push(e.ubicacion);var M=!1;if(g.length>0){for(n=0;n<g.length;n++){r=g[n];null!=e.estado_civil&&r==e.estado_civil&&(M=!0)}M||g.push(e.estado_civil)}else g.push(e.estado_civil);var x=!1;if(b.length>0){for(n=0;n<b.length;n++){r=b[n];null!=e.seguro1&&r==e.seguro1&&(x=!0)}x||b.push(e.seguro1)}else b.push(e.seguro1);var P=!1;if(v.length>0){for(n=0;n<v.length;n++){r=v[n];null!=e.seguro2&&r==e.seguro2&&(P=!0)}P||v.push(e.seguro2)}else v.push(e.seguro2);o===i.length-1&&a.guardarFichasEmpleados(c,l,d,p,u,f,m,h,g,b,v)})},n.readAsBinaryString(i)}},a.guardarFichasEmpleados=function(e,o,i,t,n,c,s,l,d,p,u){qa(e,a.usuario.id_empresa,o,i,t,n,c,s,l,d,p,u).then(function(e){a.recargarItemsTabla(),a.mostrarMensaje(e.mensaje),r.stop()})},a.subirExcelRTurnoEmpleados=function(e){r.start();var o,i,t=e.target.files;for(i=t[o=0];o!=t.length;++o){var n=new FileReader;i.name;n.onload=function(e){var o=e.target.result,i=XLSX.read(o,{type:"binary"}),t=i.SheetNames[0],n=2,r=i.Sheets[t],c=[];do{var s={};s.codigo=void 0!=r["A"+n]&&""!=r["A"+n]?r["A"+n].v.toString():null,s.tipo=void 0!=r["F"+n]&&""!=r["F"+n]?"Fijo"==r["F"+n].v.toString():null,s.campo=void 0!=r["G"+n]&&""!=r["G"+n]?r["G"+n].v.toString():null,s.fecha_inicio=void 0!=r["H"+n]&&""!=r["H"+n]?a.fecha_excel_angular(r["H"+n].v.toString()):null,s.fecha_fin=void 0!=r["I"+n]&&""!=r["I"+n]?a.fecha_excel_angular(r["I"+n].v.toString()):null,s.grupo=void 0!=r["J"+n]&&""!=r["J"+n]?r["J"+n].v.toString():null,s.dias_trabajo=void 0!=r["K"+n]&&""!=r["K"+n]?r["K"+n].v.toString():null,s.dias_descanso=void 0!=r["L"+n]&&""!=r["L"+n]?r["L"+n].v.toString():null,c.push(s),n++,0}while(void 0!=r["A"+n]);a.guardarRolTurnoEmpleados(c,a.tipoImportacionRol)},n.readAsBinaryString(i)}},a.actualizarImportacionRoles=function(){a.tipoImportacionRol=!0},a.importarNuevosRoles=function(){a.tipoImportacionRol=!1},a.guardarRolTurnoEmpleados=function(e,o){Ya(e,a.usuario.id_empresa,o).then(function(e){a.mostrarMensaje(e.mensaje),a.cerrarDialogTipoImportacionRol(),r.stop()})},a.subirExcelFichaEmpleadoFamiliares=function(e){r.start();var o,i,t=e.target.files;for(i=t[o=0];o!=t.length;++o){var n=new FileReader;i.name;n.onload=function(e){var o=e.target.result,i=XLSX.read(o,{type:"binary"}),t=i.SheetNames[0],n=2,r=i.Sheets[t],c=[];do{var s={};s.codigoEmpleado=void 0!=r["A"+n]&&""!=r["A"+n]?r["A"+n].v.toString():null,s.genero=void 0!=r["C"+n]&&""!=r["C"+n]?r["C"+n].v.toString():null,s.nombres=void 0!=r["D"+n]&&""!=r["D"+n]?r["D"+n].v.toString():null,s.apellido_paterno=void 0!=r["E"+n]&&""!=r["E"+n]?r["E"+n].v.toString():null,s.apellido_materno=void 0!=r["F"+n]&&""!=r["F"+n]?r["F"+n].v.toString():null,s.fecha_nacimiento=void 0!=r["G"+n]&&""!=r["G"+n]?new Date(a.fecha_excel_angular(r["G"+n].v.toString())):null,s.relacion=void 0!=r["H"+n]&&""!=r["H"+n]?r["H"+n].v.toString():null,s.referencia=void 0!=r["I"+n]&&""!=r["I"+n]?r["I"+n].v.toString():null,c.push(s),n++,0}while(void 0!=r["A"+n]);a.GuardarFichasEmpleadosFamiliares(c)},n.readAsBinaryString(i)}},a.GuardarFichasEmpleadosFamiliares=function(e){var o=[];e.forEach(function(i,t,n){if(o.length>0){bandera=!0;for(var c=0;c<o.length;c++){o[c]===i.relacion&&(bandera=!1)}bandera&&o.push(i.relacion)}else o.push(i.relacion);t===n.length-1&&new Ha({id_empresa:a.usuario.id_empresa,familiares:e,relaciones:o}).$save(function(e){a.mostrarMensaje(e.mensaje),a.recargarItemsTabla(),r.stop()})})},a.subirExcelFicha=function(e){r.start();var o,i,t=e.target.files;for(i=t[o=0];o!=t.length;++o){var n=new FileReader;i.name;n.onload=function(e){var o=e.target.result,i=XLSX.read(o,{type:"binary"}),t=i.SheetNames[0],n=2,r=i.Sheets[t],c=[];do{var s={};s.codigo=void 0!=r["A"+n]&&""!=r["A"+n]?r["A"+n].v.toString():null,s.banco=void 0!=r["C"+n]&&""!=r["C"+n]?r["C"+n].v.toString():null,s.numero_cuenta=void 0!=r["D"+n]&&""!=r["D"+n]?r["D"+n].v.toString():null,c.push(s),n++,0}while(void 0!=r["A"+n]);a.GuardarFichasEmpleadosRh(c)},n.readAsBinaryString(i)}},a.GuardarEmpleadosRh=function(e){new u({pacientes:e,id_empresa:a.usuario.id_empresa}).$save(function(e){a.mostrarMensaje(e.mensaje),a.recargarItemsTabla(),r.stop()})},a.GuardarFichasEmpleadosRh=function(e){var o=[];e.forEach(function(i,t,n){var c=!1;if(o.length>0){for(var s=0;s<o.length;s++){o[s]==i.banco&&(c=!0)}c||o.push(i.banco)}else o.push(i.banco);t===n.length-1&&new Ea({pacientes:e,id_empresa:a.usuario.id_empresa,bancos:o}).$save(function(e){a.mostrarMensaje(e.mensaje),a.recargarItemsTabla(),r.stop()})})},a.modificarEmpleado=function(e){a.steps=[{cabeza:"cabeza-nuevo-datos-personales",cuerpo:"cuerpo-nuevo-datos-personales"},{cabeza:"cabeza-nuevo-datos-comple",cuerpo:"cuerpo-nuevo-datos-comple"},{cabeza:"cabeza-nuevo-datos-laborales",cuerpo:"cuerpo-nuevo-datos-laborales"}],promesaPaciente=f(e.id),promesaPaciente.then(function(e){void 0!=e.clase&&(e.medicoPaciente.tipo_contrato=e.clase),a.nuevoRH=e.medicoPaciente,a.nuevoRH.persona.fecha_nacimiento=a.fechaATexto(a.nuevoRH.persona.fecha_nacimiento),a.seleccionarCargos(a.nuevoRH.empleadosFichas[a.nuevoRH.empleadosFichas.length-1].cargos)}),a.abrirPopup(a.idModalRhNuevo)},a.validarCodigoCuentaEmpleado=function(e){""!=e&&k(function(){a.validar=new y,a.validar.codigo=e,a.validar.$save({id_empresa:a.usuario.id_empresa},function(e){a.data=e})},1500)},a.eliminarFamiliarRh=function(){P(a.familiar).then(function(e){a.ficha.empleado.familiares.splice(a.familiar.index,1),a.familiar=null,a.cerrarDialogEliminarFamiliarEmpleado(),a.mostrarMensaje(e.mensaje)})},a.eliminarOtroSeguroRh=function(e){x(e).then(function(o){a.ficha.otrosSeguros.splice(e.index,1),a.otroSeguro=null,a.cerrarDialogEliminarSeguroEmpleado(),a.mostrarMensaje(o.mensaje)})},a.finVerEmpleado=function(){"Siguiente"!=$("#siguiente-v").text().trim()&&a.cerrarDialogVerEmpleado()},a.obtenerDatosFichaUsuario=function(e,o){D(e.id).then(function(e){if(e.ficha){a.ficha=e.ficha,a.ficha.editDatosLaborales=!1,a.ficha.fecha_inicio?a.ficha.fecha_inicio2=a.fechaATexto(a.ficha.fecha_inicio):a.ficha.editDatosLaborales=!0,a.ficha.fecha_fin&&(a.ficha.fecha_fin2=a.fechaATexto(a.ficha.fecha_fin)),a.ficha.cargo=[],a.ficha.fecha_jubilacion=new Date(a.ficha.fecha_jubilacion),a.ficha.empleado.fecha_vence_documento=new Date(a.ficha.empleado.fecha_vence_documento),a.ficha.fecha_jubilacion=a.fechaATexto(a.ficha.fecha_jubilacion),a.ficha.empleado.fecha_vence_documento=a.fechaATexto(a.ficha.empleado.fecha_vence_documento),a.buscarDepartamento(e.ficha.empleado.persona.pais),a.buscarMunicipios(e.ficha.empleado.persona.ciudad),a.buscarLocalidad(e.ficha.empleado.persona.provincia);var i=new Date,t=new Date(a.ficha.empleado.persona.fecha_nacimiento);a.ficha.nac_anio=t.getFullYear(),a.ficha.nac_dia=t.getDate();var n=t.getMonth();if(a.meses.forEach(function(e,o,i){e.id==n&&(a.ficha.nac_mes=e,a.getDaysInMonth(a.ficha.nac_mes.id,a.ficha.nac_anio))}),a.ficha.fecha)var c=new Date(a.ficha.fecha);else c=new Date;a.ficha.fecha_elaboracion=c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear();var s=a.diferenciaEntreDiasEnDias(t,i);a.ficha.edad=Math.trunc(s/365),a.ficha.empleado.familiares.forEach(function(e,o,i){var t=new Date,n=new Date(e.persona.fecha_nacimiento),r=a.diferenciaEntreDiasEnDias(n,t);e.edad=Math.trunc(r/365),e.eliminado=!1}),a.ficha.otrosSeguros.forEach(function(a,e,o){a.eliminado=!1}),a.seleccionarCargos(a.ficha.cargos),a.seleccionarDiscapacidades(a.ficha.discapacidades),o&&setTimeout(function(){a.ficha.editDatosLaborales=!0,a.ficha.fecha_inicio2=a.fechaATexto(new Date),$("#siguiente-f").click()},200)}r.stop()})},a.seleccionarCargos=function(e){for(var o=0;o<a.cargos.length;o++)for(var i=0;i<e.length;i++)a.cargos[o].id==e[i].id_cargo&&(a.cargos[o].ticked=!0)},a.llenarCargos=function(e){a.cargos=[];for(var o=0;o<e.length;o++){var i={nombre:e[o].nombre,maker:"",ticked:!1,id:e[o].id};a.cargos.push(i)}},a.seleccionarDiscapacidades=function(e){for(var o=0;o<a.discapacidades.length;o++)for(var i=0;i<e.length;i++)a.discapacidades[o].id==e[i].id_discapacidad&&(a.discapacidades[o].ticked=!0)},a.llenarDiscapacidades=function(e){a.discapacidades=[];for(var o=0;o<e.length;o++){var i={nombre:e[o].nombre,maker:"",ticked:!1,id:e[o].id};a.discapacidades.push(i)}},a.diferenciaEntreDiasEnDias=function(a,e){var o=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),i=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate());return Math.floor((i-o)/864e5)},a.obtenerDatosPrerequisito=function(e,o){r.start(),void 0!=o.inicio&&0!=o.inicio&&""!=o.inicio?a.filtro.inicio=o.inicio instanceof Date?o.inicio:new Date(a.convertirFecha(o.inicio)):a.filtro.inicio=0,void 0!=o.fin&&0!=o.fin&&""!=o.fin?a.filtro.fin=o.fin instanceof Date?o.fin:new Date(a.convertirFecha(o.fin)):a.filtro.fin=0,v(e.id,a.filtro).then(function(e){a.prerequisitosPaciente=e.Prerequisitos,a.prerequisitosPaciente.forEach(function(a){null!=a.fecha_entrega&&(a.entregado=!0)}),a.filtro.inicio=a.filtro.inicio instanceof Date?a.filtro.inicio.getDate()+"/"+(a.filtro.inicio.getMonth()+1)+"/"+a.filtro.inicio.getFullYear():"",a.filtro.fin=a.filtro.fin instanceof Date?a.filtro.fin.getDate()+"/"+(a.filtro.fin.getMonth()+1)+"/"+a.filtro.fin.getFullYear():"",r.stop()},function(e){a.mostrarMensaje("Se produjo un error al obtener datos de prerequisitos"),r.stop()})},a.saveFormPrerequisito=function(e){(r.start(),void 0!=e.nombre&&void 0!=e.vencimiento_mes)?ya(e).then(function(e){a.mostrarMensaje(e.mensaje),a.cerrarPopupPrerequisitoNuevo(),r.stop(),a.verificarAsignacionPrerequisitos()}).catch(function(e){r.stop();var o=void 0!==e.stack&&null!==e.stack?e.stack:void 0!==e.message&&null!==e.message?e.message:"Se perdió la conexión.";a.mostrarMensaje(o)}):(a.mostrarMensaje("Los campos Prerequisito Nombre y vencimiento mes son requeridos."),r.stop())},a.verificarAsignacionPrerequisitos=function(){r.start(),b().then(function(e){a.preRequisitos=e.prerequisitos,filtro={inicio:0,fin:0},v(a.empleado.id,filtro).then(function(e){a.prerequisitosPaciente=e.Prerequisitos,a.preRequisitos.forEach(function(e,o,i){a.prerequisitosPaciente.forEach(function(a){e.id==a.id_prerequisito&&(e.asignado=!0),null!=a.fecha_entrega&&(a.entregado=!0)}),0==a.prerequisitosPaciente.length&&(e.asignado=!1),o==i.length-1&&r.stop()}),0==a.preRequisitos.length&&r.stop()})})},a.diasVencidosPrerequisito=function(a){var e=(new Date).getTime()-a.getTime();return Math.floor(e/864e5)},a.calcularFechaVencimientoRequisito=function(e){var o=void 0===e.vencimiento_mes?e.preRequisito.vencimiento_mes:e.vencimiento_mes,i=(new Date,new Date);if(void 0===e.fecha_inicio_texto)var t=a.fechaATexto(e.fecha_inicio);var n=void 0===e.fecha_inicio_texto?t.split("/"):e.fecha_inicio_texto.split("/"),r=parseInt(n[0]),c=parseInt(n[1]),s=parseInt(n[2]);return i.setFullYear(s,c-1,r),new Date(i.setTime(i.getTime()+30*o*864e5))},a.actualizarPreRequisitoPaciente=function(e){r.start();var o=e;o.fecha_vencimiento=new Date(a.convertirFecha(o.fecha_vencimiento_texto)),o.fecha_inicio=new Date,o.fecha_entrega=null,o.asignado=!0,T.save(o,function(e){a.mostrarMensaje(e.mensaje),a.cerrarDialogEditarPreRequisito(),a.verificarAsignacionPrerequisitos(),r.stop()},function(e){a.mostrarMensaje("Ocurrio un problema al asignar el prerequisito"),a.cerrarDialogEditarPreRequisito(),r.stop()})},a.asignarPrerequisito=function(e,o){r.start(),e.pacientePrerequisito={id:o.id},e.preRequisito={id:e.id},e.fecha_inicio=new Date,e.fecha_inicio_texto=a.fechaATexto(e.fecha_inicio),e.fecha_vencimiento=a.calcularFechaVencimientoRequisito(e),e.paraAsignar=!0,T.save(e,function(e){a.verificarAsignacionPrerequisitos(),a.mostrarMensaje(e.mensaje),r.stop()},function(e){a.mostrarMensaje("Ocurrio un problema al asignar el prerequisito"),r.stop()})},a.obtenerPrerequisito=function(){r.start(),g().then(function(e){a.prerequisitos=e,r.stop()})},a.agregarSeguro=function(e){e.eliminado=!1,a.ficha.otrosSeguros.push(e),a.seguro={edit:!1}},a.calcularEdad=function(e){var o=new Date;if(e.nac_mes&&e.nac_anio&&e.nac_dia){var i=e.nac_anio,t=parseInt(e.nac_mes.id),n=parseInt(e.nac_dia),r=new Date;r.setFullYear(i,t,n);var c=a.diferenciaEntreDiasEnDias(r,o);e.edad=Math.trunc(c/365)}},a.eliminarSeguro=function(e,o){e.id?e.eliminado=!0:a.ficha.otrosSeguros.splice(o,1)},a.editarSeguro=function(e,o){a.seguro=e,a.seguro.edit=!0,a.seguro.index=o},a.agregarFamiliar=function(e){e.eliminado=!1,parseInt(e.nac_mes.id)<10&&(e.nac_mes.id="0"+e.nac_mes.id),e.persona.fecha_nacimiento=new Date(e.nac_anio,parseInt(e.nac_mes.id),parseInt(e.nac_dia)),a.ficha.empleado.familiares.push(e),a.familiar={edit:!1}},a.eliminarFamiliar=function(e,o){e.id?e.eliminado=!0:a.ficha.empleado.familiares.splice(o,1)},a.editarFamiliar=function(e,o){a.familiar=e;var i=new Date(e.persona.fecha_nacimiento);a.familiar.nac_anio=i.getFullYear(),a.familiar.nac_dia=i.getDate();var t=i.getMonth();a.meses.forEach(function(e,o,i){e.id==t&&(a.familiar.nac_mes=e)}),a.familiar.edit=!0,a.familiar.index=o,a.abrirDialogNuevoFamiliar()},a.guardarSeguroEditado=function(e){a.ficha.otrosSeguros[e.index]=e,a.seguro={edit:!1}},a.guardarFamiliarEditado=function(e){a.ficha.empleado.familiares[e.index].persona.fecha_nacimiento=new Date(e.nac_anio,parseInt(e.nac_mes.id),parseInt(e.nac_dia)),a.ficha.empleado.familiares[e.index]=e,a.familiar={edit:!1},a.cerrarDialogNuevoFamiliar()},a.recuperarDatosTipo=function(){a.obtenerExpeditos(),a.obtenerTipoExpeditos(),a.obtenerEstadoCivil(),a.obtenerNacionalidades(),a.obtenerTiposContratos(),a.obtenerTiposPersonales(),a.obtenerCargasHorarios(),a.obtenerAreas(),a.obtenerUbicacion(),a.obtenerSegurosSalud(),a.obtenerLugarSegurosSalud(),a.obtenerAporteSeguroLargoPlazo(),a.obtenerTipoOtrosSeguros(),a.obtenerFamiliaRelacion(),a.obtenerBancos(),a.obtenerMeses(),a.listYears=a.obtenerAnios(1930),a.obtenerCargos(),a.obtenerDiscapacidades(),a.obtenerGrados(),a.obtenerTitulos(),a.obtenerInstituciones(),a.obtenerCapacidadesIE(),a.obtenerLogrosIE(),a.obtenertiposAusenciaMedica(),a.obtenerTiposOtrasAusencias(),a.obtenerTiposBaja(),a.obtenerEstadoDotacion(),a.obtenerCumplimientoDotacion(),a.obtenerPeriodosDotacion(),a.obtenerGruposRol(),a.obtenerVehiculosViaje(),a.obtenerTipoViajeDetalle(),a.obtenerTiposEstadosPasajeros(),a.obtenerTipoLicenciaVehiculo()},a.obtenerTiposEstadosPasajeros=function(){r.start(),ba("RRHH_EPVIA",a.usuario.id_empresa).then(function(e){a.tiposPasajerosViaje=e.clases,r.stop()})},a.obtenerGruposRol=function(){r.start(),ba("RRHH_GROL",a.usuario.id_empresa).then(function(e){a.gruposRol=e,r.stop()})},a.obtenerTipoLicenciaVehiculo=function(){r.start(),ba("RRHH_TLVVIA",a.usuario.id_empresa).then(function(e){a.TiposLicenciasVehiculo=e,r.stop()})},a.obtenerVehiculosViaje=function(){r.start(),ba("RRHH_VVIA",a.usuario.id_empresa).then(function(e){a.vehiculosViaje=e,r.stop()})},a.obtenerTipoViajeDetalle=function(){r.start(),ba("RRHH_TVIA",a.usuario.id_empresa).then(function(e){a.tiposViaje=e,r.stop()})},a.obtenerGrados=function(){r.start(),ba("RRHH_GRA",a.usuario.id_empresa).then(function(e){a.grados=e,r.stop()})},a.obtenerTitulos=function(){r.start(),ba("RRHH_TITL",a.usuario.id_empresa).then(function(e){a.titulos=e,r.stop()})},a.obtenerInstituciones=function(){r.start(),ba("RRHH_INST",a.usuario.id_empresa).then(function(e){a.instituciones=e,r.stop()})},a.obtenerCapacidadesIE=function(){r.start(),ba("RRHH_TCIE",a.usuario.id_empresa).then(function(e){a.capacidadesIE=e,r.stop()})},a.obtenerLogrosIE=function(){r.start(),ba("RRHH_TLIE",a.usuario.id_empresa).then(function(e){a.logrosIE=e,r.stop()})},a.obtenerHistorialContratos=function(e){r.start(),H(e.id).then(function(e){a.historialFichaEmpleado=e,a.llenarHistoricoCertificado(e),r.stop()})},a.obtenerCargos=function(){r.start(),ba("RRHH_CARGO",a.usuario.id_empresa).then(function(e){var o=e.clases;a.listaCargos=e,a.llenarCargos(o),r.stop()})},a.obtenerDiscapacidades=function(){r.start(),ba("RRHH_DISC",a.usuario.id_empresa).then(function(e){var o=e.clases;a.llenarDiscapacidades(o),r.stop()})},a.obtenerExpeditos=function(){r.start(),ba("RRHH_EXP",a.usuario.id_empresa).then(function(e){a.tipoExpedido=e,r.stop()})},a.obtenerTipoExpeditos=function(){r.start(),ba("RRHH_TEXP",a.usuario.id_empresa).then(function(e){a.tipoDocumento=e,r.stop()})},a.obtenerEstadoCivil=function(){r.start(),ba("RRHH_EC",a.usuario.id_empresa).then(function(e){a.estadosCiviles=e,r.stop()})},a.obtenerNacionalidades=function(){r.start(),E("NAC").then(function(e){a.nacionalidades=e,r.stop()})},a.obtenerDepartamentos=function(){r.start();R("-BOL").then(function(e){a.departamentosBanco=e,r.stop()})},a.buscarDepartamento=function(e){if(e){var o="-"+e.nombre_corto;R(o).then(function(e){a.departamentos=e,0===e.length&&(a.provincias=[],a.localidades=[])})}},a.buscarDepartamentoFiniquito=function(){R("-BOL").then(function(e){a.departamentosFiniquito=e})},a.buscarRopaTrabajo=function(){wa("ROPA DE TRABAJO-G",a.usuario.id_empresa).then(function(e){a.ropasDeTrabajo=e})},a.buscarMunicipios=function(e){if(e){var o=(e.id+"-"+e.nombre_corto).split("-")[1];R(o+"M").then(function(e){a.provincias=e,0===e.length&&(a.localidades=[])})}},a.buscarLocalidad=function(e){if(e){var o=e.nombre_corto.split("-")[1];R((o="-"+o)+"L").then(function(e){a.localidades=e})}},a.AgregarDepartamento=function(e){if(e.edit){var o=!0;a.clase={pais:e.pais},a.departamentos.forEach(function(i,t,n){var r=i.nombre_corto.split("-")[0];i.id!=e.id&&r==e.nombre_corto2&&(o=!1),t===n.length-1&&(o?(e.nombre_corto=e.nombre_corto2+"-"+e.pais.nombre_corto,a.clase={pais:e.pais}):a.mostrarMensaje("El nombre corto tiene que ser unico por departamento"))})}else{o=!0;a.departamentos.length>0?a.departamentos.forEach(function(i,t,n){i.nombre_corto.split("-")[0]==e.nombre_corto2&&(o=!1),t===n.length-1&&(o?(e.nombre_corto=e.nombre_corto2+"-"+e.pais.nombre_corto,a.departamentos.push(e),a.clase={pais:e.pais}):a.mostrarMensaje("El nombre corto tiene que ser unico por departamento"))}):(e.nombre_corto=e.nombre_corto2+"-"+e.pais.nombre_corto,a.departamentos.push(e),a.clase={pais:e.pais})}},a.AgregarProvincia=function(e){if(e.edit){var o=!0;a.provincias.forEach(function(i,t,n){var r=i.nombre_corto.split("-")[1];if(i.id!=e.id&&r==e.nombre_corto2&&(o=!1),t===n.length-1)if(o){var c=e.departamento.nombre_corto.split("-")[0];e.nombre_corto=c+"M-"+e.nombre_corto2}else a.mostrarMensaje("El nombre corto tiene que ser unico por provincia")}),a.clase={departamento:e.departamento}}else{o=!0;if(a.provincias.length>0)a.provincias.forEach(function(i,t,n){if(i.nombre_corto.split("-")[1]==e.nombre_corto2&&(o=!1),t===n.length-1)if(o){var r=e.departamento.nombre_corto.split("-")[0];e.nombre_corto=r+"M-"+e.nombre_corto2,a.provincias.push(e),a.clase={departamento:e.departamento}}else a.mostrarMensaje("El nombre corto tiene que ser unico por provincia")});else{var i=e.departamento.nombre_corto.split("-")[0];e.nombre_corto=i+"M-"+e.nombre_corto2,a.provincias.push(e),a.clase={departamento:e.departamento}}}},a.AgregarLocalidad=function(e){if(e.edit){var o=!0;a.localidades.forEach(function(i,t,n){var r=i.nombre_corto.split("-")[0],c=e.nombre_corto2;if(i.id!=e.id&&r==c&&(o=!1),t===n.length-1)if(o){var s=e.provincia.nombre_corto.split("-")[1];e.nombre_corto=e.nombre_corto2+"-"+s+"L"}else a.mostrarMensaje("El nombre corto tiene que ser unico por localidad")}),a.clase={provincia:e.provincia}}else{o=!0;if(a.localidades.length>0)a.localidades.forEach(function(i,t,n){if(i.nombre_corto.split("-")[0]==e.nombre_corto2&&(o=!1),t===n.length-1)if(o){var r=e.provincia.nombre_corto.split("-")[1];e.nombre_corto=e.nombre_corto2+"-"+r+"L",a.localidades.push(e),a.clase={provincia:e.provincia}}else a.mostrarMensaje("El nombre corto tiene que ser unico por localidad")});else{var i=e.provincia.nombre_corto.split("-")[1];e.nombre_corto=e.nombre_corto2+"-"+i+"L",a.localidades.push(e),a.clase={provincia:e.provincia}}}},a.guardarConceptoEdicionRrhh=function(e,o){r.start(),a.tipo_edicion2.clases=e;var i=a.tipo_edicion2;na.update({id_tipo:i.id},i,function(e){E(i.nombre_corto).then(function(e){i=e,a.tipo_edicion2={},r.stop(),a.buscarDepartamento(o.pais),a.buscarMunicipios(o.departamento),a.buscarLocalidad(o.provincia),a.cerrarDialogDepartamentoEstado(),a.cerrarDialogProvincia(),a.cerrarDialogLocalidad(),a.mostrarMensaje("Guardado Exitosamente!")})})},a.editarLocalidad=function(e,o){var i=o.provincia,t=e.nombre_corto.split("-")[0];a.clase=e,a.clase.provincia=i,a.clase.nombre_corto2=t,a.clase.edit=!0},a.editarProvincia=function(e,o){var i=o.departamento,t=e.nombre_corto.split("-")[1];a.clase=e,a.clase.departamento=i,a.clase.nombre_corto2=t,a.clase.edit=!0},a.editarDepartamento=function(e,o){var i=o.pais,t=e.nombre_corto.split("-")[0];a.clase=e,a.clase.pais=i,a.clase.nombre_corto2=t,a.clase.edit=!0},a.cancelarEdicionLocalidad=function(e){a.clase={provincia:e.provincia}},a.cancelarEdicionProvincia=function(e){a.clase={departamento:e.departamento}},a.cancelarEdicionDepartamento=function(e){a.clase={pais:e.pais}},a.obtenerTiposContratos=function(){r.start(),ba("RRHH_TC",a.usuario.id_empresa).then(function(e){a.tiposContratos=e,r.stop()})},a.obtenerTiposPersonales=function(){r.start(),ba("RRHH_TP",a.usuario.id_empresa).then(function(e){a.tiposPersonales=e,r.stop()})},a.obtenerCargasHorarios=function(){r.start(),ba("RRHH_CH",a.usuario.id_empresa).then(function(e){a.cargasHorarios=e,r.stop()})},a.obtenerAreas=function(){r.start(),ba("RRHH_AREA",a.usuario.id_empresa).then(function(e){a.listaAreas=e,r.stop()})},a.obtenerUbicacion=function(){r.start(),ba("RRHH_UBI",a.usuario.id_empresa).then(function(e){a.ubicaciones=e,r.stop()})},a.obtenerSegurosSalud=function(){r.start(),ba("RRHH_SS",a.usuario.id_empresa).then(function(e){a.segurosSalud=e,r.stop()})},a.obtenerLugarSegurosSalud=function(){r.start(),ba("RRHH_LSS",a.usuario.id_empresa).then(function(e){a.LugaresSegurosSalud=e,r.stop()})},a.obtenerAporteSeguroLargoPlazo=function(){r.start(),ba("RRHH_ASLP",a.usuario.id_empresa).then(function(e){a.aportesSeguroLargoPlazo=e,r.stop()})},a.obtenerTipoOtrosSeguros=function(){r.start(),ba("RRHH_OST",a.usuario.id_empresa).then(function(e){a.OtrosSegurosTipos=e,r.stop()})},a.obtenerBancos=function(){r.start(),ba("RRHH_BAN",a.usuario.id_empresa).then(function(e){a.bancosHdv=e,r.stop()})},a.obtenerFamiliaRelacion=function(){r.start(),ba("RRHH_REL",a.usuario.id_empresa).then(function(e){a.relaciones=e,r.stop()})},a.obtenerAnios=function(a){var e=(new Date).getFullYear(),o=[];for(a=a||1930;a<=e;)o.push(a++);return o},a.getDaysInMonth=function(e,o){for(var i=new Date(o,e+1,0).getDate(),t=[],n=1;n<=i;n++)t.push(n),n==i&&(a.listaDias=t)},a.guardarFichaTecnica=function(e,o,i){if(0==a.nopuedoModificarFicha){a.ficha.quienModifico=a.usuario.id;var t=a.fechaATexto(o.fecha_inicio);if(o.historialVacacion=[],t!=o.fecha_inicio2){var n=o.fecha_inicio2,r=new Date(a.convertirFecha(n)).getFullYear();a.obtenerAnios(r).forEach(function(e,i,t){var n=i+1,r=null;n<=5?r=a.configuracionesVacacion[0].dias:n<=10?r=a.configuracionesVacacion[1].dias:n>10&&(r=a.configuracionesVacacion[2].dias);var c={gestion:e,anio:i+1,aplicadas:r,tomadas:0};o.historialVacacion.push(c)})}if(i){a.primeroGuardarParaCerrar=!1,o.empleado.persona.fecha_nacimiento=new Date(o.nac_anio,parseInt(o.nac_mes.id),parseInt(o.nac_dia)),o.fecha_elaboracion&&(o.fecha_elaboracion=new Date(a.convertirFecha(o.fecha_elaboracion))),o.fecha_inicio2&&(o.fecha_inicio2=new Date(a.convertirFecha(o.fecha_inicio2))),o.fecha_fin2&&(o.fecha_fin2=new Date(a.convertirFecha(o.fecha_fin2))),o.fecha_jubilacion&&(o.fecha_jubilacion=new Date(a.convertirFecha(o.fecha_jubilacion))),o.empleado.fecha_vence_documento&&(o.empleado.fecha_vence_documento=new Date(a.convertirFecha(o.empleado.fecha_vence_documento)));var c=document.getElementById("id-contrato").files[0],s=new FileReader;if(c)s.onloadend=function(e){o.contrato2={name:"",data:null},o.contrato2.name=o.contrato[0].name,o.contrato2.data=e.target.result,M(o).then(function(e){a.cerrarDialogEmpleado(),a.recargarItemsTabla(),a.mostrarMensaje(e.message)})},s.readAsBinaryString(c);else M(o).then(function(e){if(fecha1=a.fechaATexto(e.fichaActual.fecha_inicio),fecha2=a.fechaATexto(e.fichaAnterior.fecha_inicio),fecha1==fecha2){var o=[],i={},t=0,n=Object.keys(e.fichaActual).length;for(var r in e.fichaActual){var c=r.substr(0,3);if("id_"!=c&&"updatedAt"!=r&&"createdAt"!=r&&"id"!=r&&"nombre_corto"!=r)if(e.fichaActual[r]instanceof Object){if(e.fichaActual[r]instanceof Array){console.log("comparar arreglos");var s=!1,l="",d="",p=e.fichaActual[r];e.fichaActual[r].forEach(function(a){"cargos"==r&&(l+=a.cargo.nombre+", "),"discapacidades"==r&&(l+=a.discapacidad.nombre+", "),"otrosSeguros"==r&&(l+=a.tipoSeguro.nombre+", ")});var u=e.fichaAnterior[r];e.fichaAnterior[r].forEach(function(a){"cargos"==r&&(d+=a.cargo.nombre+", "),"discapacidades"==r&&(d+=a.discapacidad.nombre+", "),"otrosSeguros"==r&&(l+=a.tipoSeguro.nombre+", ")}),s=p.includes(u),u.length!=p.length&&(s=!0),s&&(i={id_ficha:e.fichaActual.id,campo:r,valor_anterior:d,valor_actual:l,fecha:new Date},o.push(i))}else for(var f in e.fichaActual[r])if("id_"!=(c=f.substr(0,3))&&"updatedAt"!=f&&"createdAt"!=f&&"id"!=f&&"nombre_corto"!=f)if(e.fichaActual[r][f]instanceof Object)for(var m in e.fichaActual[r][f])"id_"!=(c=m.substr(0,3))&&"updatedAt"!=m&&"createdAt"!=m&&"id"!=m&&"nombre_corto"!=m&&(e.fichaActual[r][f][m]instanceof Object?console.log("aqui otro forin"):e.fichaAnterior[r][f]?e.fichaActual[r][f][m]!=e.fichaAnterior[r][f][m]&&(i={id_ficha:e.fichaActual.id,campo:r+"."+f+"."+m,valor_anterior:e.fichaAnterior[r][f][m],valor_actual:e.fichaActual[r][f][m],fecha:new Date},o.push(i)):e.fichaActual[r][f][m]&&(i={id_ficha:e.fichaActual.id,campo:r+"."+f+"."+m,valor_anterior:"",valor_actual:e.fichaActual[r][f][m],fecha:new Date},o.push(i)));else e.fichaAnterior[r]?e.fichaActual[r][f]!=e.fichaAnterior[r][f]&&(i={id_ficha:e.fichaActual.id,campo:r+"."+f,valor_anterior:e.fichaAnterior[r][f],valor_actual:e.fichaActual[r][f],fecha:new Date},o.push(i)):e.fichaActual[r][f]&&(i={id_ficha:e.fichaActual.id,campo:r+"."+f,valor_anterior:"",valor_actual:e.fichaActual[r][f],fecha:new Date},o.push(i))}else e.fichaActual[r]!=e.fichaAnterior[r]&&(i={id_ficha:e.fichaActual.id,campo:r,valor_anterior:e.fichaAnterior[r],valor_actual:e.fichaActual[r],fecha:new Date},o.push(i));if(++t===n-1)if(o.length>0)ma(a.usuario.id,o).then(function(o){a.cerrarDialogEmpleado(),a.recargarItemsTabla(),a.mostrarMensaje(e.message)});else a.primeroGuardarParaCerrar=!1,a.cerrarDialogEmpleado(),a.recargarItemsTabla(),a.mostrarMensaje(e.message)}}else a.primeroGuardarParaCerrar=!1,a.cerrarDialogEmpleado(),a.recargarItemsTabla(),a.mostrarMensaje(e.message)})}else{if("Siguiente"!=$("#siguiente-f").text().trim())o.empleado.persona.fecha_nacimiento=new Date(o.nac_anio,parseInt(o.nac_mes.id),parseInt(o.nac_dia)),o.fecha_elaboracion&&(o.fecha_elaboracion=new Date(a.convertirFecha(o.fecha_elaboracion))),o.fecha_inicio2&&(o.fecha_inicio2=new Date(a.convertirFecha(o.fecha_inicio2))),o.fecha_fin2&&(o.fecha_fin2=new Date(a.convertirFecha(o.fecha_fin2))),o.fecha_jubilacion&&(o.fecha_jubilacion=new Date(a.convertirFecha(o.fecha_jubilacion))),o.empleado.fecha_vence_documento&&(o.empleado.fecha_vence_documento=new Date(a.convertirFecha(o.empleado.fecha_vence_documento))),M(o).then(function(e){if(a.primeroGuardarParaCerrar=!1,fecha1=a.fechaATexto(e.fichaActual.fecha_inicio),fecha2=a.fechaATexto(e.fichaAnterior.fecha_inicio),fecha1==fecha2){var o=[],i={},t=0,n=Object.keys(e.fichaActual).length;for(var r in e.fichaActual){var c=r.substr(0,3);if("id_"!=c&&"updatedAt"!=r&&"createdAt"!=r&&"id"!=r&&"nombre_corto"!=r)if(e.fichaActual[r]instanceof Object){if(e.fichaActual[r]instanceof Array){console.log("comparar arreglos");var s=!1,l="",d="",p=e.fichaActual[r];e.fichaActual[r].forEach(function(a){"cargos"==r&&(l+=a.cargo.nombre+", "),"discapacidades"==r&&(l+=a.discapacidad.nombre+", "),"otrosSeguros"==r&&(l+=a.tipoSeguro.nombre+", ")});var u=e.fichaAnterior[r];e.fichaAnterior[r].forEach(function(a){"cargos"==r&&(d+=a.cargo.nombre+", "),"discapacidades"==r&&(d+=a.discapacidad.nombre+", "),"otrosSeguros"==r&&(l+=a.tipoSeguro.nombre+", ")}),s=p.includes(u),u.length!=p.length&&(s=!0),s&&(i={id_ficha:e.fichaActual.id,campo:r,valor_anterior:d,valor_actual:l,fecha:new Date},o.push(i))}else for(var f in e.fichaActual[r])if("id_"!=(c=f.substr(0,3))&&"updatedAt"!=f&&"createdAt"!=f&&"id"!=f&&"nombre_corto"!=f)if(e.fichaActual[r][f]instanceof Object)for(var m in e.fichaActual[r][f])"id_"!=(c=m.substr(0,3))&&"updatedAt"!=m&&"createdAt"!=m&&"id"!=m&&"nombre_corto"!=m&&(e.fichaActual[r][f][m]instanceof Object?console.log("aqui otro forin"):e.fichaAnterior[r][f]?e.fichaActual[r][f][m]!=e.fichaAnterior[r][f][m]&&(i={id_ficha:e.fichaActual.id,campo:r+"."+f+"."+m,valor_anterior:e.fichaAnterior[r][f][m],valor_actual:e.fichaActual[r][f][m],fecha:new Date},o.push(i)):e.fichaActual[r][f][m]&&(i={id_ficha:e.fichaActual.id,campo:r+"."+f+"."+m,valor_anterior:"",valor_actual:e.fichaActual[r][f][m],fecha:new Date},o.push(i)));else e.fichaAnterior[r]?e.fichaActual[r][f]!=e.fichaAnterior[r][f]&&(i={id_ficha:e.fichaActual.id,campo:r+"."+f,valor_anterior:e.fichaAnterior[r][f],valor_actual:e.fichaActual[r][f],fecha:new Date},o.push(i)):e.fichaActual[r][f]&&(i={id_ficha:e.fichaActual.id,campo:r+"."+f,valor_anterior:"",valor_actual:e.fichaActual[r][f],fecha:new Date},o.push(i))}else e.fichaActual[r]!=e.fichaAnterior[r]&&(i={id_ficha:e.fichaActual.id,campo:r,valor_anterior:e.fichaAnterior[r],valor_actual:e.fichaActual[r],fecha:new Date},o.push(i));if(++t===n-1)if(o.length>0)ma(a.usuario.id,o).then(function(o){a.cerrarDialogEmpleado(),a.recargarItemsTabla(),a.mostrarMensaje(e.message)});else a.cerrarDialogEmpleado(),a.recargarItemsTabla(),a.mostrarMensaje(e.message)}}else a.primeroGuardarParaCerrar=!1,a.cerrarDialogEmpleado(),a.recargarItemsTabla(),a.mostrarMensaje(e.message)})}}else{"Siguiente"!=$("#siguiente-f").text().trim()&&a.cerrarDialogEmpleado()}},a.actualizarPrerequisito=function(e){_(e).then(function(e){a.cerrarDialogInicioPreRequisitos(),a.mostrarMensaje(e.message)})},a.completarCamposLaboral=function(e){"OBRA"==e.tipoContrato.nombre&&(a.tiposPersonales.clases.forEach(function(a){"CAMPO"==a.nombre&&(e.tipoPersonal=a)}),e.area={},e.ubicacion={}),"INDEFINIDO"==e.tipoContrato.nombre&&(a.tiposPersonales.clases.forEach(function(a){"OFICINA"==a.nombre&&(e.tipoPersonal=a)}),a.listaAreas.clases.forEach(function(a){"ESS-SCZ"==a.nombre&&(e.area=a)}),a.ubicaciones.clases.forEach(function(a){"ESS-SCZ"==a.nombre&&(e.ubicacion=a)}))},a.agregarFormacionAcademica=function(e){a.hojaVida.formacionesAcademicas.push(e),a.formacionAcademica={edit:!1,eliminado:!1}},a.guardarFormacionAcademicaEditada=function(e){a.formacionAcademica={edit:!1,eliminado:!1}},a.editarFomracionAcademica=function(e,o){a.formacionAcademica=e,a.formacionAcademica.edit=!0},a.eliminarFomracionAcademica=function(a){a.eliminado=!0},a.agregarExperienciaLaboral=function(e){e.fecha_inicio=new Date(convertirFecha(e.fecha_inicio)),e.fecha_fin=new Date(convertirFecha(e.fecha_fin)),e.fecha_inicioTexto=a.fechaATexto(e.fecha_inicio),e.fecha_finTexto=a.fechaATexto(e.fecha_fin),a.hojaVida.experienciasLaborales.push(e),a.experienciaLaboral={edit:!1,eliminado:!1}},a.guardarExperienciaLaboralEditada=function(e){e.fecha_inicio=new Date(convertirFecha(e.fecha_inicio)),e.fecha_fin=new Date(convertirFecha(e.fecha_fin)),e.fecha_inicioTexto=a.fechaATexto(e.fecha_inicio),e.fecha_finTexto=a.fechaATexto(e.fecha_fin),a.experienciaLaboral={edit:!1,eliminado:!1}},a.editarExperienciaLaboral=function(e){e.fecha_inicio=a.fechaATexto(e.fecha_inicio),e.fecha_fin=a.fechaATexto(e.fecha_fin),a.experienciaLaboral=e,a.experienciaLaboral.edit=!0},a.eliminarExperienciaLaboral=function(a){a.eliminado=!0},a.agregarCapacidadHojaVida=function(e){e.fecha=new Date(convertirFecha(e.fecha)),e.fechaTexto=a.fechaATexto(e.fecha),a.hojaVida.capacidades.push(e),a.capacidad={edit:!1,eliminado:!1}},a.guardarCapacidadHojaVidaEditada=function(e){e.fecha=new Date(convertirFecha(e.fecha)),e.fechaTexto=a.fechaATexto(e.fecha),a.capacidad={edit:!1,eliminado:!1}},a.editarCapacidadHojaVida=function(e){e.fecha=a.fechaATexto(e.fecha),a.capacidad=e,a.capacidad.edit=!0},a.eliminarCapacidadHojaVida=function(a){a.eliminado=!0},a.agregarLogroHojaVida=function(e){e.fecha=new Date(convertirFecha(e.fecha)),e.fechaTexto=a.fechaATexto(e.fecha),a.hojaVida.logros.push(e),a.logro={edit:!1,eliminado:!1}},a.guardarLogroHojaVidaEditada=function(e){e.fecha=new Date(convertirFecha(e.fecha)),e.fechaTexto=a.fechaATexto(e.fecha),a.logro={edit:!1,eliminado:!1}},a.editarLogroHojaVida=function(e){e.fecha=a.fechaATexto(e.fecha),a.logro=e,a.logro.edit=!0},a.eliminarLogroHojaVida=function(a){a.eliminado=!0},a.GuardarHojaDeVida=function(){"Siguiente"!=$("#siguiente-s").text().trim()&&(a.empleado.activo?w(a.empleado.id,a.hojaVida).then(function(e){a.cerrarDialogHojaVida(),a.mostrarMensaje(e.mensaje),a.recargarItemsTabla()}):($("#formacion-academica").click(),a.cerrarDialogHojaVida()))},a.GuardarHojaDeVidaDirecto=function(){w(a.empleado.id,a.hojaVida).then(function(e){a.cerrarDialogHojaVida(),a.mostrarMensaje(e.mensaje),a.recargarItemsTabla()})},a.imprimirHojaVida=function(e){var o;e.capacidadInterna?((o=e).tipo="INTER",o.inicio&&o.fin?(o.inicio=new Date(convertirFecha(o.inicio)),o.fin=new Date(convertirFecha(o.fin))):(o.inicio=0,o.fin=0),G(o,a.hojaVida.id).then(function(e){a.capacidades=e.capacidades,ObtenerImagen(a.empleado.imagen).then(function(e){a.generarPdfHojaVida(e),o.inicio="",o.fin=""})})):((o=e).tipo="EXT",o.inicio=0,o.fin=0,G(o,a.hojaVida.id).then(function(e){a.capacidades=e.capacidades,ObtenerImagen(a.empleado.imagen).then(function(e){a.generarPdfHojaVida(e),o.inicio="",o.fin=""})}))},a.generarPdfHojaVida=function(e){r.start(),totalpaginastamaño=a.hojaVida.experienciasLaborales.length+a.hojaVida.formacionesAcademicas.length+a.capacidades.length,promesaPaciente=f(a.empleado.id),promesaPaciente.then(function(o){void 0!=o.clase&&(o.medicoPaciente.tipo_contrato=o.clase),a.empleado2=o.medicoPaciente;var i=new PDFDocument({compress:!1,size:[612,792],margin:10}),t=i.pipe(blobStream()),n=205,c=1,s=Math.ceil(totalpaginastamaño/20);a.dibujarCabeceraPDFHojaVida(i,1,s,e),i.font("Helvetica",7);for(var l=0;l<a.hojaVida.formacionesAcademicas.length;l++){if(formacion=a.hojaVida.formacionesAcademicas[l],i.text(formacion.anio_obtencion,80,n),i.text(formacion.institucion.nombre,170,n,{width:100}),i.text(formacion.grado.nombre,305,n,{width:100}),i.text(formacion.titulo.nombre,405,n,{width:100}),formacion.institucion.nombre.length>20||formacion.grado.nombre.length>20||formacion.titulo.nombre.length>20)rowinstituto=formacion.institucion.nombre.length/20,rowgrado=formacion.grado.nombre.length/20,rowtitulo=formacion.titulo.nombre.length/20,arregloTamaño=[Math.floor(rowinstituto),Math.floor(rowgrado),Math.floor(rowtitulo)],n+=10*Math.max.apply(null,arregloTamaño);0,(n+=20)>=725&&(i.addPage({margin:0,bufferPages:!0}),n=90,0,i.rect(25,n-20,550,15).fill("silver","#000"),i.font("Helvetica-Bold",8).fill("black"),i.text("GRADO DE INSTRUCCIONES",35,n),i.font("Helvetica-Bold",8),i.text("AÑO DE OBTENCIÓN",45,n),i.text("INSTITUCIÓN",170,n),i.text("GRADO",305,n),i.text("CARRERA",405,n),c+=1,i.text("PÁGINA "+c+" DE "+s,0,750,{align:"center"}),i.font("Helvetica",7))}for(var d=0;d<a.capacidades.length;d++){var p=a.capacidades[d];if(0==d&&(n+=15,i.rect(25,n-20,550,15).fill("silver","#000"),i.font("Helvetica-Bold",8).fill("black"),i.text("CURSO,CAPACIDADES Y SEMINARIOS",35,n-15),i.font("Helvetica-Bold",8),i.text("FECHA",45,n),i.text("INSTITUCIÓN",170,n),i.text("GRADO",305,n),i.text("CARRERA",405,n),n+=20),i.font("Helvetica",8),p.fechaTexto=a.fechaATexto(p.fecha),i.text(p.fechaTexto,40,n,{width:100}),i.text(p.curso,170,n,{width:100}),i.text(p.institucion,305,n,{width:80}),i.text(p.certificado,405,n,{width:100}),p.curso.length>20||p.institucion.length>17||p.certificado.length>20)rowcurso=p.curso.length/20,rowinstituto=p.institucion.length/17,rowcertificado=p.certificado.length/20,arregloTamaño=[Math.floor(rowcurso),Math.floor(rowinstituto),Math.floor(rowcertificado)],n+=10*Math.max.apply(null,arregloTamaño);0,(n+=20)>=725&&(i.addPage({margin:0,bufferPages:!0}),n=90,0,i.rect(25,n-20,550,15).fill("silver","#000"),i.font("Helvetica-Bold",8).fill("black"),i.text("CURSO,CAPACIDADES Y SEMINARIOS",35,n-15),i.font("Helvetica-Bold",8),i.text("FECHA",45,n),i.text("INSTITUCIÓN",170,n),i.text("GRADO",305,n),i.text("CARRERA",405,n),n+=20,c+=1,i.text("PÁGINA "+c+" DE "+s,0,750,{align:"center"}),i.font("Helvetica",7))}for(var u=0;u<a.hojaVida.experienciasLaborales.length;u++){var f=a.hojaVida.experienciasLaborales[u];if(0==u&&(n+=15,i.rect(25,n-20,550,15).fill("silver","#000"),i.font("Helvetica-Bold",8).fill("black"),i.text("EXPERIENCIA LABORAL",35,n-15),i.font("Helvetica-Bold",8),i.text("DESDE",45,n),i.text("HASTA",120,n),i.text("EMPRESA",205,n),i.text("CARGO",305,n),i.text("REFERENCIA",385,n),i.text("TELEFONO",485,n),n+=20),i.font("Helvetica",8),i.text(f.fecha_inicioTexto,40,n,{width:100}),i.text(f.fecha_finTexto,115,n,{width:100}),i.text(f.empresa,205,n,{width:80}),i.text(f.cargo,305,n,{width:60}),i.text(f.contacto,385,n,{width:100}),i.text(f.telefono,485,n,{width:100}),f.empresa.length>17||f.cargo.length>13||f.contacto.length>20)rowempresa=f.empresa.length/17,rowcargo=f.cargo.length/13,rowcontacto=f.contacto.length/20,arregloTamaño=[Math.floor(rowempresa),Math.floor(rowcargo),Math.floor(rowcontacto)],n+=10*Math.max.apply(null,arregloTamaño);0,(n+=20)>=725&&(n+=20,i.addPage({margin:0,bufferPages:!0}),n=90,0,i.rect(25,n-20,550,15).fill("silver","#000"),i.font("Helvetica-Bold",8).fill("black"),i.text("EXPERIENCIA LABORAL",35,n-15),i.font("Helvetica-Bold",8),i.text("DESDE",45,n),i.text("HASTA",120,n),i.text("EMPRESA",205,n),i.text("CARGO",305,n),i.text("REFERENCIA",385,n),i.text("TELEFONO",485,n),n+=20,c+=1,i.text("PÁGINA "+c+" DE "+s,0,750,{align:"center"}),i.font("Helvetica",7))}i.end(),t.on("finish",function(){var a=t.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),r.stop()})},a.dibujarCabeceraPDFHojaVida=function(e,o,i,t){e.font("Helvetica-Bold",12),e.rect(25,30,550,20).fill("silver","#000"),e.font("Helvetica-Bold",12).fill("black"),e.text("HOJA DE VIDA",0,35,{align:"center"}),e.image(t,400,70,{width:80,height:80}),e.font("Helvetica-Bold",10),e.font("Helvetica-Bold",8),e.text("PÁGINA "+o+" DE "+i,0,750,{align:"center"}),e.font("Helvetica-Bold",8),e.text("NOMBRE Y APELLIDO:",45,60),e.text("NACIONALIDAD:",45,70),e.text("LUGAR DE NACIMIENTOS:",45,80),e.text("RESIDENCIA ACTUAL:",45,90),e.text("DIRECCION:",45,100),e.text("CI:",45,110),e.text("ESTADO CIVIL:",45,120),e.text("TELEFONO:",45,130),e.text("CELULAR:",45,140),e.text("E-MAIL:",45,150),e.font("Helvetica",8),e.text(a.empleado2.persona.nombre_completo,170,60),e.text(a.empleado2.persona.pais_nacimiento,170,70),e.text(a.empleado2.persona.ciudad_nacimiento+" / "+a.empleado2.persona.provincia_nacimiento+" / "+a.empleado2.persona.localidad_nacimiento,170,80),e.text("",170,90),e.text(a.empleado2.persona.direccion_zona,170,100),e.text(a.empleado2.persona.ci,170,110),e.text(a.empleado2.persona.estado_civil,170,120),e.text(a.empleado2.persona.telefono,170,130),e.text(a.empleado2.persona.telefono_movil,170,140),e.text(a.empleado2.persona.correo_electronico,170,150),e.rect(25,165,550,15).fill("silver","#000"),e.font("Helvetica-Bold",8).fill("black"),e.text("GRADO DE INSTRUCCIONES",35,170),e.font("Helvetica-Bold",8),e.text("AÑO DE OBTENCIÓN",45,185),e.text("INSTITUCIÓN",170,185),e.text("GRADO",305,185),e.text("CARRERA",405,185)},a.llenarHistoricoCertificado=function(e){a.historialContratos=[];for(var o=0;o<e.length;o++){var i="",t=a.fechaATexto(e[o].fecha_inicio);if(null!=e[o].fecha_fin)i=a.fechaATexto(e[o].fecha_fin);var n={nombre:t+"-"+i,maker:"",ticked:!1,id:e[o].id};a.historialContratos.push(n)}},a.generarPdfCertificado=function(e){var o=new PDFDocument({size:[612,792],margins:{top:10,bottom:10,left:20,right:20}}),i=o.pipe(blobStream());0==e.tipo?a.dibujarPdfCertificadoHojaVida(o,e):a.dibujarPdfCertificadoPrestamo(o,e),o.end(),i.on("finish",function(){var a=i.toBlobURL("application/pdf");window.open(a,"_blank","location=no")})},a.dibujarPdfCertificadoHojaVida=function(e,o){var i=new Date,t="",n="",r=i.getMonth();a.meses.forEach(function(a){a.id==r&&(t=a.nombre)}),a.ficha.cargo.forEach(function(a){n=""==n?a.nombre:n+", "+a.nombre}),e.font("Times-Roman",12),e.text("Santa Cruz, "+i.getDate()+" de "+t+" de "+i.getFullYear(),0,75,{align:"center"}),e.font("Times-Roman",24),e.text("CERTIFICADO DE TRABAJO",0,150,{align:"center"}),e.font("Times-Roman",13);var c="EMSERSO SA., certifica que "+a.ficha.empleado.persona.nombre_completo+" con CI."+a.ficha.empleado.persona.ci+" "+a.ficha.empleado.extension.nombre+", trabajó (a) como "+n+", durante los siguientes periodos:";e.text(c,100,230,{width:412,align:"left",indent:0,columns:1,height:300,ellipsis:!0});for(var s=250,l=0;l<o.historialContratos.length;l++){var d=o.historialContratos[l].nombre.split("-");e.text("Desde el "+d[0]+" al "+d[1],100,s,{width:412,align:"left",indent:0,columns:1,height:300,ellipsis:!0}),s+=20}e.text("Es cuanto certifico para los fines que convengan al interesado.",100,s+20,{align:"left"}),e.text("Lic. Rosangela Velasques S.",100,695),e.text("JEFA DE RECURSOS HUMANOS",100,715)},a.dibujarPdfCertificadoPrestamo=function(e,o){var i=new Date,t="",n="",r="",c=i.getMonth();a.meses.forEach(function(a){a.id==c&&(t=a.nombre)}),a.ficha.cargo.forEach(function(a){n=""==n?a.nombre:n+", "+a.nombre});for(var s=0;s<o.historialContratos.length;s++){var l=o.historialContratos[s].nombre.split("-"),d=l[0].split("/"),p=l[1].split("/");fechaIni=new Date(d[0],d[1],d[2]);var u=new Date(p[0],p[1],p[2]),f=fechaIni.getMonth(),m=u.getMonth();a.meses.forEach(function(a){a.id==f&&(f=a.nombre)}),a.meses.forEach(function(a){a.id==m&&(m=a.nombre),""==l[1]&&(m="")}),r=""==r?""!=m?"el "+fechaIni.getDate()+" de "+f+" de "+fechaIni.getFullYear()+" al "+u.getDate()+" de "+m+" de "+u.getFullYear():"el "+fechaIni.getDate()+" de "+f+" de "+fechaIni.getFullYear()+".":""!=m?r+",  renovando contrato con la empresa a partir del "+fechaIni.getDate()+" de "+f+" de "+fechaIni.getFullYear()+" al "+u.getDate()+" de "+m+" de "+u.getFullYear():r+",  renovando contrato con la empresa a partir del "+fechaIni.getDate()+" de "+f+" de "+fechaIni.getFullYear(),s===o.historialContratos.length-1&&(r=r+". Percibiendo un sueldo aproximado mensual de Bs."+a.ficha.haber_basico+".- ("+a.ficha.haber_basico_literal+")")}e.font("Times-Roman",12),e.text("Santa Cruz, "+i.getDate()+" de "+t+" de "+i.getFullYear(),0,75,{align:"center"}),e.font("Times-Roman",24),e.text("CERTIFICADO DE TRABAJO",0,150,{align:"center"}),e.font("Times-Roman",13);var h="EMSERSO SA., certifica que "+a.ficha.empleado.persona.nombre_completo+" con CI."+a.ficha.empleado.persona.ci+" "+a.ficha.empleado.extension.nombre+", trabaja en nuestra empresa como "+n+" desde "+r;e.text(h,100,230,{width:412,align:"justify",indent:0,columns:1,lineGap:10,wordSpacing:1,height:300,ellipsis:!0}),e.moveDown(2),e.text("Es cuanto certifico para los fines que convengan al interesado.",{align:"left"}),e.text("Lic. Rosangela Velasques S.",100,695),e.text("JEFA DE RECURSOS HUMANOS",100,715)},a.calcularCuota=function(e){var o=e.monto/e.plazo,i=o*e.interes_pactado/100;e.cuota=o+i,e.cuota2=a.number_format(e.cuota,2);var t=0,n=e.plazo;do{t++,(n-=12)<=12&&n}while(n>12);e.plazo>12?e.tiempo_plazo_literal=t+" año y "+(e.plazo-12*t)+" meses":e.tiempo_plazo_literal=e.plazo+" meses"},a.GuardarPrestamo=function(e){e.id_usuario=a.usuario.id,e.fecha_inicial=new Date(a.convertirFecha(e.fecha_inicial)),e.total=e.monto*e.interes_pactado/100+e.monto,S(a.empleado.id,e).then(function(o){a.imprimirPrestamo(e),a.cerrarDialogNuevoPrestamo(),a.prestamo={},a.mostrarMensaje(o.mensaje)})},a.GuardarMultiplesPrestamos=function(e){e.id_usuario=a.usuario.id,e.fecha_inicial=a.convertirFecha(e.fecha_inicial),e.total=e.monto*e.interes_pactado/100+e.monto,S(0,e).then(function(e){a.cerrarDialogPretamosNuevoTodos(),a.optenerListaPrestamos(),a.mostrarMensaje(e.mensaje),a.prestamo={}})},a.imprimirPrestamo=function(e){var o=new PDFDocument({size:[792,612],margins:{top:10,bottom:10,left:20,right:20}}),i=o.pipe(blobStream());o.rect(40,90,712,432).stroke(),o.rect(635,125,100,30).stroke(),o.font("Helvetica-Bold",16),o.text("Nro. 11111",640,133),o.font("Helvetica-Bold",14),o.text(a.usuario.empresa.razon_social,65,95),o.text("Santa Cruz- Bolivia",55,110),o.text("NIT: ",55,125),o.font("Helvetica",14),o.text(a.usuario.empresa.nit+".",80,125),o.font("Helvetica-Bold",14),o.text("PRESTAMO AL PERSONAL",0,135,{align:"center"}),o.font("Helvetica-Bold",14),o.text("Empleado ",55,175),o.text("Monto otorgado ",55,200),o.text("Interés Pactado ",55,225),o.text("Fecha des desembolso ",55,250),o.text("Plazo ",55,275),o.text("Monto Mensual ",55,300),o.text("Observaciones ",55,325),o.text("Sueldo Básico ",55,350),o.font("Helvetica",14),o.text(a.empleado.nombre_completo,220,175),o.text(a.number_format(e.monto,2),220,200),o.text(e.interes_pactado+"%",220,225);var t=a.fechaATexto(e.fecha_inicial);o.text(t,220,250),o.text(e.plazo,220,275),o.text(e.cuota2,220,300),o.text(e.observacion,220,325),o.text(a.number_format(a.empleado.haber_basico,2),220,350),o.font("Helvetica-Bold",14),o.text("Recibí Conforme ",55,500),o.text("Responsable de Área ",225,500),o.text("Encargado RRHH ",425,500),o.text("Contabilidad ",605,500),o.end(),i.on("finish",function(){var a=i.toBlobURL("application/pdf");window.open(a,"_blank","location=no")})},a.GuardarPagoPrestamo=function(e){if(e.prestamoPagos.length>0){var o=e.monto_pagado+e.prestamoPagos[e.prestamoPagos.length-1].a_cuenta_anterior,i=(e.total-o)/e.plazo_restante;e.cuota2=i}else{i=(e.total-e.monto_pagado)/e.plazo_restante;e.cuota2=i}e.pagoFecha=new Date,I(a.usuario.id,a.prestamo.id,e).then(function(e){a.cerrarDialogPagoPrestamo(),a.optenerListaPrestamos(),a.prestamo={},a.mostrarMensaje(e.mensaje)})},a.abrirModalVerificarCuenta=function(e,o){a.dato=e,a.tipoDatosPermiso=o,a.abrirPopup(a.IdModalVerificarCuenta)},a.cerrarModalVerificarCuenta=function(){a.cerrarPopup(a.IdModalVerificarCuenta)},a.EditarMontoPrestamo=function(e){e.montoEdit=!1,e.total=e.monto*e.interes_pactado/100+e.monto;var o=e.monto/e.plazo,i=o*e.interes_pactado/100;(e.cuota=o+i,e.prestamoPagos.length>0)?e.prestamoPagos.forEach(function(o,i,t){(o.saldo_anterior=e.total-o.a_cuenta_anterior,i===t.length-1)&&N(e).then(function(e){a.mostrarMensaje(e.mensaje)})}):N(e).then(function(e){a.mostrarMensaje(e.mensaje)})},a.CancelarEditMontoPrestamo=function(e){a.optenerListaPrestamos()},a.verificarCuentaAdmin=function(e){O.save({id_empresa:a.usuario.id_empresa},e,function(e){e.type?(a.mostrarMensaje(e.message),"anticipo"==a.tipoDatosPermiso&&(a.dato.montoEdit?a.dato.montoEdit=!1:a.dato.montoEdit=!0),"datosLaborales"==a.tipoDatosPermiso&&(a.dato.editDatosLaborales?a.dato.editDatosLaborales=!1:a.dato.editDatosLaborales=!0),"finiquito"==a.tipoDatosPermiso&&(a.cuenta={},a.abrirDialogBeneficiosSociales2(a.dato,!0)),"dotacion"==a.tipoDatosPermiso&&(a.cuenta={},a.abrirDialogEliminarRopaTrabajo()),"rolturnoEmpleado"==a.tipoDatosPermiso&&(a.cuenta={},a.editarRoldeTurno(a.dato)),"cerrarRolturnoEmpleado"==a.tipoDatosPermiso&&(a.cuenta={},a.abrirDialogCerrarRolDeTurno()),a.cerrarModalVerificarCuenta()):a.mostrarMensaje(e.message)})},a.obtenerListaEmpleados=function(){B(a.usuario.id_empresa).then(function(e){e.empleados.forEach(function(o,i,t){o.ficha=o.empleadosFichas[0],i===t.length-1&&a.llenarEmpleados(e.empleados)})})},a.llenarEmpleados=function(e){a.todosLosEmpleados=[];for(var o=0;o<e.length;o++){var i={nombre:e[o].persona.nombre_completo,persona:e[o].persona,ficha:e[o].ficha,maker:"",ticked:!1,id:e[o].id};a.todosLosEmpleados.push(i),o===e.length-1&&a.seleccionarEmpleados(a.empleadosSeleccionados)}},a.seleccionarEmpleados=function(e){for(var o=0;o<a.todosLosEmpleados.length;o++)for(var i=0;i<e.length;i++)e[o].select&&(a.todosLosEmpleados[o].ticked=!0)},a.GuardarRolTurno=function(e){e.fecha_inicio=new Date(a.convertirFecha(e.fecha_inicio)),e.fecha_fin&&(e.fecha_fin=new Date(a.convertirFecha(e.fecha_fin))),e.id_ficha=a.empleado.id_ficha,F(a.empleado.id,e).then(function(o){e={},a.cerrarDialogRolTurnos(),a.mostrarMensaje(o.mensaje)})},a.GuardarCierreRolTurno=function(e){e.fecha_fin=new Date(a.convertirFecha(e.fecha_fin)),F(a.empleado.id,e).then(function(e){a.cerrarDialogCerrarRolDeTurno(),a.mostrarMensaje(e.mensaje)})},a.calcularDatosRolTurno=function(e){var o=!0;if(a.empleadosRolTurnoE.length>0){var i="";contFijos=0,a.empleadosRolTurnoE.forEach(function(t,n,r){1==t.tipo&&(contFijos++,o=!1,t.fecha_fin?(o=!0,i=a.fechaATexto(sumaFecha(1,t.fecha_fin))):i=a.fechaATexto(sumaFecha(t.dias_trabajado,t.fecha_inicio))),n===r.length-1&&(o?e.tipo?(e.fecha_fin="",e.dias_trabajado=14,e.dias_descanso=7):(e.dias_trabajado=7,e.dias_descanso=0):contFijos>1?(e.tipo=!1,a.mostrarMensaje("ya cuenta con dos roles de turno fijos, las asignaciones de fechas estan copadas!. Para asignar otro rol de turno fijo debe dar de baja 1")):e.tipo&&(e.blokearDatos=!0,e.dias_trabajado=7,e.dias_descanso=14,a.mostrarMensaje("ya cuenta con un rol turno fijo,se genero otro con la configuracion fija!"),e.fecha_inicio=i))})}else e.tipo?(e.fecha_fin="",e.dias_trabajado=14,e.dias_descanso=7):(e.dias_trabajado=7,e.dias_descanso=0)},a.editarRoldeTurno=function(e){e.fecha_inicio=a.fechaATexto(e.fecha_inicio),e.fecha_fin&&(e.fecha_fin=a.fechaATexto(e.fecha_fin)),a.cerrarDialogHistorialTurnos(),a.rolTurno=e},a.obtenerlistaRolTurno=function(e){r.start(),Y(a.usuario.id_empresa,e).then(function(e){a.empleadosRolTurnoE=e.rolesTurno,a.fechaInicioCalendario=a.fechaATexto(new Date(e.fechaInicio)),r.stop()})},a.obtenerlistaRolTurnoCal=function(){a.paginator=d(),a.paginator.column="id",a.paginator.direccion="asc",a.paginator.itemsPerPage=10,a.filtroRolCal={empresa:a.usuario.id_empresa,inicio:"",fin:"",grupo:"",nombre:"",campo:""},a.paginator.callBack=a.listaRolTurnoCal,a.paginator.getSearch("",a.filtroRolCal,null)},a.listaRolTurnoCal=function(){r.start(),Ia(a.paginator).then(function(e){a.paginator.setPages(e.paginas),a.empleadosRolTurno=e.rolesTurno,a.fechaInicioCalendario=a.fechaATexto(new Date(e.fechaInicio));var o=new Date,i=new Date(o.getFullYear(),12,0).getDate(),t="",n="",c="",s="",l="";a.filtroRolCal.inicio2&&(t=a.filtroRolCal.inicio2),a.filtroRolCal.fin2&&(s=a.filtroRolCal.fin2),a.filtroRolCal.grupo&&(n=a.filtroRolCal.grupo),a.filtroRolCal.nombre&&(c=a.filtroRolCal.nombre),a.filtroRolCal.campo&&(l=a.filtroRolCal.campo),a.filtroRolCal={campo:l,nombre:c,grupo:n,empresa:a.usuario.id_empresa,fin2:s,inicio2:t,inicio:a.fechaInicioCalendario,fin:i+"/12/"+o.getFullYear()},a.realizarCalendarioTrabajo(a.filtroRolCal),r.stop()})},a.obtenerlistaRolTurnoEmpresa=function(){Ca(a.paginator).then(function(e){a.paginator.setPages(e.paginas),a.listaRolTurnoFiltro=e.rolesTurno})},a.guardarHorasExtra=function(e){e.fecha=new Date(a.convertirFecha(e.fecha)),e.hora_inicio2=a.fechaATiempo(e.hora_inicio),e.hora_fin2=a.fechaATiempo(e.hora_fin),e.id_ficha=a.empleado.id_ficha,L(a.empleado.id,e).then(function(e){a.cerrarDialogHorasExtras(),a.horaExtra={},a.mostrarMensaje(e.mensaje)})},a.calcularTiempoHorasExtra=function(e){if(e.hora_inicio instanceof Date&&e.hora_fin instanceof Date){var o=e.hora_inicio.getHours(),i=e.hora_fin.getHours(),t=e.hora_inicio.getMinutes(),n=e.hora_fin.getMinutes();if(o<i){var r=moment(e.hora_inicio).format("YYYY-MM-DD HH:mm:ss"),c=moment(e.hora_fin).format("YYYY-MM-DD HH:mm:ss"),s=moment(r,"YYYY-MM-DD HH:mm:ss"),l=moment(c,"YYYY-MM-DD HH:mm:ss").diff(s,"s");e.tiempo=a.caluclarDiferencia(l)}else if(o==i&&t<n){r=moment(e.hora_inicio).format("YYYY-MM-DD HH:mm:ss"),c=moment(e.hora_fin).format("YYYY-MM-DD HH:mm:ss"),s=moment(r,"YYYY-MM-DD HH:mm:ss"),l=moment(c,"YYYY-MM-DD HH:mm:ss").diff(s,"s");e.tiempo=a.caluclarDiferencia(l)}else e.tiempo=""}},a.fechaATiempo=function(a){var e=a.getHours(),o=a.getMinutes(),i=a.getSeconds();return(e=e<10?"0"+e:e)+":"+(o=o<10?"0"+o:o)+":"+(i=i<10?"0"+i:i)},a.caluclarDiferencia=function(a){var e=Math.floor(a/3600),o=Math.floor(a%3600/60),i=a%60;return e+":"+(o=o<10?"0"+o:o)+":"+(i=i<10?"0"+i:i)},a.obtenerHistorialHorasExtra=function(e){var o={};o.inicio=10==e.inicio.length?new Date(a.convertirFecha(e.inicio)):0,o.fin=10==e.fin.length?new Date(a.convertirFecha(e.fin)):0,q(a.empleado.id_ficha,o).then(function(e){a.ListaHorasExtraEmpleado=e,a.ListaHorasExtraEmpleado.length>0?a.sumarTotalHorasExtra():a.SumaTotalHorasExtra="00:00"})},a.sumarTotalHorasExtra=function(){for(var e="",o=0,i=0,t=0;t<a.ListaHorasExtraEmpleado.length;t++){var n=a.ListaHorasExtraEmpleado[t].tiempo.split(":")[1],r=a.ListaHorasExtraEmpleado[t].tiempo.split(":")[0];o+=parseInt(r),(i+=parseInt(n))>=60&&(i-=60,o+=1),e=String("0"+o).slice(-3)+":"+String("0"+i).slice(-2)}a.SumaTotalHorasExtra=e},a.GuardarAnticipos=function(e){var o=e.slice(-1).pop();o.montoExtraoridnario=o.total-o.anticipo_ordinaro,o.textoClase="EXTRAORDI",o.fecha=(new Date).getTime(),U(a.empleado.id,o).then(function(e){o={},a.cerrarDialogAnticipoExtraordinario(),a.mostrarMensaje(e.mensaje)})},a.GuardarAnticiposEmpleados=function(e){var o={};o.anticipos=e,o.textoClase="ORDI",o.fecha=(new Date).getTime(),o.anticipos.forEach(function(e,i,t){(e.montoordinario=e.monto+e.anticipo_ordinaro,i===t.length-1)&&J(o).then(function(o){e={},a.listaAnticipos2=[],a.cerrarDialogAnticipoRegular(),a.mostrarMensaje(o.mensaje)})})},a.buscarAnticiposExtraoridnario=function(e){a.anticipo_extraordinaro=0;var o=new Date(e.gestion,e.mes.id,1),i={inicio:new Date(o.getFullYear(),o.getMonth(),1),fin:new Date(o.getFullYear(),o.getMonth()+1,0),nombre:"ORDI",id_empresa:0};a.obtenerListaAnticipos(i,a.empleado.id)},a.buscarAnticiposOridnario=function(e){if(void 0!=e.gestion){a.anticipo_extraordinaro=0;var o=new Date(e.gestion,e.mes.id,1),i={inicio:new Date(o.getFullYear(),o.getMonth(),1),fin:new Date(o.getFullYear(),o.getMonth()+1,0),nombre:"EXTRAORDI",id_empresa:a.usuario.id_empresa};a.obtenerListaAnticiposOrdi(i,0)}},a.obtenerListaAnticipos=function(e,o){a.anticipo_ordinaroOextra=0;var i=z(e,o);a.arregloid=[],i.then(function(o){o.anticipos.length>0?(o.anticipos.ordinarios=[],o.anticipos.extraordinarios=[],o.anticipos.forEach(function(i,t,n){if(i.empleado.ficha=i.empleado.empleadosFichas[i.empleado.empleadosFichas.length-1],i.total2=0,i.tipoAnticipo.nombre_corto!=e.nombre?o.anticipos.ordinarios.push(i):(a.anticipo_ordinaroOextra+=i.monto,o.anticipos.extraordinarios.push(i)),t===n.length-1)for(var r=0;r<o.anticipos.ordinarios.length;r++){var c=o.anticipos.ordinarios[r];if(o.anticipos.extraordinarios.length>0)for(var s=0;s<o.anticipos.extraordinarios.length;s++){(i=o.anticipos.extraordinarios[s]).id_empleado==c.id_empleado?(c.anticipo_ordinaro?c.anticipo_ordinaro+=i.monto:c.anticipo_ordinaro=i.monto,c.saldo_salario=c.salario_basico-c.total,c.montoEdit=!1):(c.anticipo_ordinaro=0,c.saldo_salario=c.salario_basico-c.total)}else c.anticipo_ordinaro=0,c.saldo_salario=c.salario_basico-c.total;r===o.anticipos.ordinarios.length-1&&(a.listaAnticipos=o.anticipos.ordinarios)}})):a.listaAnticipos=[]})},a.obtenerListaAnticiposOrdi=function(e,o){a.anticipo_ordinaroOextra=0,a.listaAnticipos=[];var i=z(e,o);a.arregloid=[],i.then(function(o){o.anticipos.length>0?(o.anticipos.ordinarios=[],o.anticipos.extraordinarios=[],o.anticipos.forEach(function(i,t,n){if(i.empleado.ficha=i.empleado.empleadosFichas[i.empleado.empleadosFichas.length-1],i.total2=0,i.anticipo_extraordinaro=0,i.saldo_salario=i.salario_basico-i.total,i.tipoAnticipo.nombre_corto!=e.nombre?o.anticipos.ordinarios.push(i):o.anticipos.extraordinarios.push(i),t===n.length-1){void 0==a.anticiposDatos&&(a.anticiposDatos={ordinarios:o.anticipos.ordinarios,extraordinarios:o.anticipos.extraordinarios});for(var r=0;r<o.anticipos.ordinarios.length;r++){for(var c=o.anticipos.ordinarios[r],s=0;s<o.anticipos.extraordinarios.length;s++){(i=o.anticipos.extraordinarios[s]).id_empleado==c.id_empleado?(c.anticipo_extraordinaro?c.anticipo_extraordinaro+=i.monto:c.anticipo_extraordinaro=i.monto,c.saldo_salario=c.salario_basico-c.total,c.montoEdit=!1):(c.anticipo_ordinaro?c.anticipo_ordinaro+=i.monto:c.anticipo_ordinaro=i.monto,c.anticipo_extraordinaro=0,c.saldo_salario=c.salario_basico-c.total)}r===o.anticipos.ordinarios.length-1&&(a.listaAnticipos=o.anticipos.ordinarios)}}})):a.listaAnticipos=[]})},a.EliminarAnticipo=function(e){a.listaAnticipos2.splice(e,1)},a.AgregarAnticipoOrdinario=function(e){var o=e.monto,i=0,t=null;i=e.tope?e.tope:null,e.empleados.forEach(function(n,r,c){if(e.tipo&&(o=n.ficha.haber_basico*e.monto/100,t=e.monto),o=parseFloat(o.toFixed(2)),0==a.listaAnticipos2.length)var s={fecha:new Date,empleado:n,monto:o,anticipo_extraordinaro:null,total:null,salario_basico:n.ficha.haber_basico,saldo_salario:n.haber_basico,tope:i,tipo_porcentual:e.tipo,porcentaje:t};else(s={fecha:new Date,empleado:n,monto:o,anticipo_extraordinaro:null,total:null,salario_basico:n.ficha.haber_basico,saldo_salario:null,tope:i,tipo_porcentual:e.tipo,porcentaje:t}).saldo_salario=s.salario_basico-s.total;if(s.anticipo_extraordinaro=0,s.anticipo_ordinaro=0,a.anticiposDatos){if(a.anticiposDatos.ordinarios.length>0)for(var l=0;l<a.anticiposDatos.ordinarios.length;l++){var d=a.anticiposDatos.ordinarios[l];s.empleado.id==d.id_empleado&&(s.anticipo_ordinaro+=d.monto)}if(a.anticiposDatos.extraordinarios.length>0)for(l=0;l<a.anticiposDatos.extraordinarios.length;l++){d=a.anticiposDatos.extraordinarios[l];s.empleado.id==d.id_empleado&&(s.anticipo_extraordinaro+=d.monto)}}else s.anticipo_ordinaro=0,s.anticipo_extraordinaro=0;s.total=s.anticipo_extraordinaro+s.anticipo_ordinaro+s.monto,s.total2=s.anticipo_extraordinaro+s.anticipo_ordinaro+s.monto,s.saldo_salario=s.salario_basico-s.total,s.saldo_salario2=s.salario_basico-s.total,a.listaAnticipos2.push(s),r===c.length-1&&(a.cerrarDialogNuevoAnticipoRegularTodos(),a.anticipo={})})},a.AgregarAnticipoExtraordinario=function(){if(0==a.listaAnticipos.length){var e={fecha:new Date,monto:null,total2:a.anticipo_ordinaroOextra,anticipo_ordinaro:a.anticipo_ordinaroOextra,total:a.anticipo_ordinaroOextra,salario_basico:a.empleado.haber_basico,saldo_salario:a.empleado.haber_basico,empleado:a.empleado};a.listaAnticipos.push(e)}else{if(a.listaAnticipos[a.listaAnticipos.length-1].id)(e={fecha:new Date,monto:null,anticipo_ordinaro:a.anticipo_ordinaroOextra,total:a.listaAnticipos[a.listaAnticipos.length-1].total,salario_basico:a.empleado.haber_basico,saldo_salario:null,empleado:a.empleado}).saldo_salario=e.salario_basico-e.total,a.listaAnticipos.push(e);else a.mostrarMensaje("cuenta con 1 anticipo sin guardar!")}},a.sumarMontoPrestamoNuevo=function(e,o){a.listaAnticipos.length>1?e.monto?o>0&&a.listaAnticipos[o-1].empleado.id==a.listaAnticipos[o].empleado.id?e.total=a.listaAnticipos[o-1].total+e.monto:e.anticipo_ordinaro?e.total=e.monto+e.anticipo_ordinaro:e.total=e.monto+e.anticipo_extraordinaro:e.anticipo_ordinaro?e.total=e.anticipo_ordinaro:e.total=e.anticipo_extraordinaro:(e.total2=e.anticipo_ordinaro,e.monto?e.total=e.total2+e.monto:e.anticipo_ordinaro?e.total=e.anticipo_ordinaro:e.total=e.anticipo_extraordinaro),e.saldo_salario=e.salario_basico-e.total},a.sumarMontoPrestamoNuevo2=function(a){a.total=a.anticipo_extraordinaro+a.monto+a.anticipo_ordinaro,a.saldo_salario=a.salario_basico-a.total},a.ActualizarAnticipo=function(e){e.montoExtraoridnario=e.total-e.anticipo_ordinaro,X(e.id_empleado,e).then(function(o){e.montoEdit=!1,a.cerrarDialogAnticipoExtraordinario(),a.mostrarMensaje(o.mensaje)})},a.ActualizarAnticipoOrdi=function(e){if(e.anticipo_ordinaro=0,a.anticiposDatos&&a.anticiposDatos.ordinarios.length>0)for(var o=0;o<a.anticiposDatos.ordinarios.length;o++){var i=a.anticiposDatos.ordinarios[o];e.empleado.id==i.id_empleado&&e.id!=i.id&&(e.anticipo_ordinaro+=i.monto)}e.montoExtraoridnario=e.total-e.anticipo_extraordinaro,X(e.id_empleado,e).then(function(o){e.montoEdit=!1,a.cerrarDialogAnticipoExtraordinario(),a.mostrarMensaje(o.mensaje)})},a.cancelarEdicionAnticipo=function(){a.obtenerAnticiposExtra(a.empleado)},a.cancelarEdicionAnticipo=function(){a.obteneranticiposOrdi()},a.imprimirAnticipoRegular=function(e,o){var i=new PDFDocument({compress:!1,size:"letter",margin:10}),t=i.pipe(blobStream()),n=205,c=0,s=1,l=Math.ceil(e.length/18);a.DibujarCabeceraPDFAnticipoRegular(i,s,l,e,o),i.font("Helvetica",10);for(var d=0;d<e.length&&c<=18;d++)anticipo=e[d],i.text(d+1,45,n),i.text(anticipo.empleado.codigo,80,n,{width:70}),i.text(anticipo.empleado.persona.nombre_completo,200,n,{width:100}),i.text(anticipo.monto,320,n,{width:100}),i.text(anticipo.empleado.ficha.banco.nombre,400,n,{width:100}),i.text(".......... ",500,n+2,{width:100}),n+=30,18==++c&&(i.addPage({margin:0,bufferPages:!0}),n=205,c=0,s+=1,a.DibujarCabeceraPDFAnticipoRegular(i,s,l,e,o),i.font("Helvetica",10));i.end(),t.on("finish",function(){var a=t.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),r.stop()},a.DibujarCabeceraPDFAnticipoRegular=function(e,o,i,t,n){var r=0,c=0,s=!1,l=0,d=!1,p=!1,u=0,f=0,m="",h="";t.forEach(function(t,g,b){if(0==g?(r=t.tope,c=t.tipo_porcentual,f=t.porcentaje,m=a.fechaATexto(t.fecha)):(t.tope!=r&&(s=!0),t.tipo_porcentual!=c&&(d=!0),a.fechaATexto(t.fecha)!=m&&(p=!0)),g===b.length-1){l=s?"Diferentes Topes":r,u=d?"Diferentes tipos":c=c?"Porcentual "+f+"%":"Monto",h=p?"Diferentes fechas":m,l=null==l?"Sin restricción":l,e.font("Helvetica-Bold",14),e.text("LISTA DE ANTICIPOS",0,45,{align:"center"}),e.font("Helvetica-Bold",12),e.text("PERIODO : ",45,100),e.text("FECHA DE CREACIÓN : ",45,120),e.text("USUARIO : ",45,140),e.text("TIPO DE ANTICIPO : ",45,160),e.text("TOPE: ",345,160),e.font("Helvetica",12),h instanceof Date&&(h=a.fechaATexto(h)),e.fillColor("blue"),e.text(h,185,120),e.text(a.usuario.persona.nombre_completo,115,140),e.text(n.mes.nombre+" "+n.gestion,115,100),e.text(u,175,160),e.text(l,385,160),e.fillColor("black"),e.font("Helvetica-Bold",12),e.text("Nro.",45,180),width=e.widthOfString("Nro."),height=e.currentLineHeight(),e.underline(45,181,width,height),e.text("Cod. Emp.",80,180),width=e.widthOfString("Cod. Emp."),height=e.currentLineHeight(),e.underline(80,181,width,height),e.text("Nombre",200,180),width=e.widthOfString("Nombre"),height=e.currentLineHeight(),e.underline(200,181,width,height),e.text("Monto",320,180),width=e.widthOfString("Monto"),height=e.currentLineHeight(),e.underline(320,181,width,height),e.text("Mod. ",400,180),width=e.widthOfString("Mod"),height=e.currentLineHeight(),e.underline(400,181,width,height),e.text("Firma. ",500,180),width=e.widthOfString("Firma"),height=e.currentLineHeight(),e.underline(500,181,width,height),e.font("Helvetica",8);var v=new Date;e.text("USUARIO: "+a.usuario.persona.nombre_completo+" fecha "+v.getDate()+"/"+(v.getMonth()+1)+"/"+v.getFullYear()+"Hrs."+v.getHours()+":"+v.getMinutes(),15,765),e.text("PÁGINA "+o+" DE "+i,0,740,{align:"center"})}})},a.listaBancos=function(){a.anticiposSeleccionados=[],a.anticiposTr3=[];var e=ra(a.usuario.id_empresa);a.arregloBancosUnion="",a.arregloBancosMsc="";e.then(function(e){a.datosBancos=e,a.bancos=[],e.forEach(function(o,i,t){o.cuentas=[],0==i&&a.bancos.push(o);for(var n=!1,r=0;r<a.bancos.length;r++){a.bancos[r].nombre==o.nombre&&(n=!0),r===a.bancos.length-1&&0==n&&a.bancos.push(o)}i===t.length-1&&e.forEach(function(e,o,i){for(var t=0;t<a.bancos.length;t++){var r=a.bancos[t];r.nombre==e.nombre&&(n=!0,r.cuentas.push(e),t=a.bancos.length)}})})})},a.imprimirTr3=function(e,o){for(var i=new Date(e.fecha),t=i.getMonth(),n=i.getDate(),r="",c=0;c<a.meses.length;c++){var s=a.meses[c];t==s.id&&(r=s.nombre)}t=t<10?"0"+t:t,n=n<10?"0"+n:n,anio=i.getFullYear();var l=[],d=0;e.historialtr3.forEach(function(i,c,s){if(d+=i.anticipo.monto,l.push(i.anticipo),c===s.length-1){var p={anticipos:l,tipo:o,tr3Encontrado:e,total:d};if("MSC"==o)var u=p.tr3Encontrado.planilla+""+n+(t+1)+anio+p.tr3Encontrado.numero_planilla+".tr3";else u="SUELDO"+r+anio+"BUNION.tr3";a.descargarArchivo(a.generarTexto(p),u)}})},a.imprimirCartaTr3=function(e,o){for(var i=[],t=0,n=new Date(e.fecha),r=n.getMonth()+1,c=n.getDate(),s=0;s<a.meses.length;s++){var l=a.meses[s];r==l.id&&l.nombre}r=r<10?"0"+r:r,c=c<10?"0"+c:c,anio=n.getFullYear(),e.historialtr3.forEach(function(n,s,l){if(t=n.anticipo.monto,i.push(n.anticipo),s===l.length-1){var d={anticipos:i,tipo:o,tr3Encontrado:e,total:t};if("MSC"==o)var p=d.tr3Encontrado.planilla+""+c+r+anio+d.tr3Encontrado.numero_planilla+".txt";else p=d.tr3Encontrado.planilla+""+c+r+anio+d.tr3Encontrado.numero_planilla+".txt";a.descargarArchivo(a.generarTextoCarta(d),p)}})},a.guardarTr3Empleado=function(e){e.fecha=new Date;var o=[];e.anticipos.length>0&&e.anticipos.forEach(function(i,t,n){(bandera=!1,a.datosBanco.nombre.toUpperCase()==i.empleado.empleadosFichas[i.empleado.empleadosFichas.length-1].banco.nombre&&(bandera=!0),bandera&&o.push(i),t===n.length-1)&&(e.anticipos=o,la(e,a.usuario.id_empresa).then(function(o){for(var i=new Date(o.tr3Encontrado.fecha),t=i.getMonth()+1,n=i.getMonth(),r=i.getDate(),c="",s=0;s<a.meses.length;s++){var l=a.meses[s];n==l.id&&(c=l.nombre)}if(t=t<10?"0"+t:t,r=r<10?"0"+r:r,anio=i.getFullYear(),a.cerrarModalTr3BancoMsc(),a.cerrarModalTr3BancoUnion(),a.buscarAnticiposOridnario(a.filtroAnticipo),"MSC"==e.tipo)var d=o.tr3Encontrado.planilla+""+r+t+anio+o.tr3Encontrado.numero_planilla+".tr3",p=o.tr3Encontrado.planilla+""+r+t+anio+o.tr3Encontrado.numero_planilla+".txt";else d="SUELDO"+c+anio+"BUNION.tr3",p=o.tr3Encontrado.planilla+""+r+t+anio+".txt";a.descargarArchivo(a.generarTexto(o),d),a.descargarArchivo(a.generarTextoCarta(o),p),a.mostrarMensaje(o.mensaje)}))})},a.descargarArchivo=function(a,e){var o=new FileReader;o.onload=function(a){var o=document.createElement("a");o.href=a.target.result,o.target="_blank",o.download=e||"archivo.dat";var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});o.dispatchEvent(i),(window.URL||window.webkitURL).revokeObjectURL(o.href)},o.readAsDataURL(a)},a.generarTextoCarta=function(e){for(var o=new Date(e.tr3Encontrado.fecha),i=o.getMonth()+1,t=o.getDate(),n="",r=0;r<a.meses.length;r++){var c=a.meses[r];i-1===c.id&&(n=c.nombre)}i=i<10?"0"+i:i,t=t<10?"0"+t:t,anio=o.getFullYear();var s=ConvertirALiteral(e.total.toFixed(2)),l=[];if("MSC"==e.tipo){var d="\r\n\r\n"+e.tr3Encontrado.departamento.nombre+" "+t+" de "+n+" del "+anio+"\r\nNro Cite: ESS-P-29/18\r\n\r\n\r\nSeñores \r\n"+e.tr3Encontrado.cuenta.nombre+"\r\nCiudad\r\n\r\nRef.: Orden de Pago\r\n\r\nDe nuestra consideración:\r\n\r\nMediante la presente y según contrato suscrito con el Banco Mercantil Santa Cruz S.A.,\r\nautorizamos a ustedes realizar el débito por el valor total de Bs. "+e.total+"\r\n("+s+")\r\ncorrespondiente a la cancelación de la planilla de pago(s), de acuerdo al siguiente detalle:\r\n\r\n* Cuenta de débito Nro:                 "+e.tr3Encontrado.cuenta.numero+"\r\n* Cuenta Pago de Planilla:              "+e.tr3Encontrado.planilla+"\r\n* Nombre del archivo:                   "+e.tr3Encontrado.planilla+t+i+anio+e.tr3Encontrado.numero_planilla+".tr3\r\n* Código de control:                     87fd35e019787f9612a4ffb9fc2cb415\r\n* Nombre / Número de planilla:  "+e.tr3Encontrado.nombre_planilla+"\r\n* Monto total de débito:                 Bs "+e.total+"\r\n\r\nLos datos apuntados anteriormente y el detalle de pagos, se encuentran en el archivo \r\n"+e.tr3Encontrado.planilla+t+i+anio+e.tr3Encontrado.numero_planilla+".tr3, adjunto a la presente carta.\r\n\r\n Si, a los efectos de la presente, fuera necesario realizar compra venta de moneda nacional\r\no extranjera,  también  autorizamos e instruimos  realizar las operaciones  necesarias  para\r\ncumplir  con  lo  instruido,  de  tal  manera  que se realicen  los abonos  en  la moneda  que\r\ncorresponda a cada cuenta beneficiaria.\r\nde "+n+" Debo informar lo siguiente:\r\nEl origen de los fondos corresponde al "+e.tr3Encontrado.origen_fondos+".\r\nEl Destino de los Fondos, "+e.tr3Encontrado.destino_fondos+".\r\n\r\nAgradecemos su gentil atención a esta solicitud.\r\n\r\nAtentamente\r\n\r\n\r\n\r\n"+e.tr3Encontrado.firma_uno+"                                 "+e.tr3Encontrado.firma_tres+"\r\n"+e.tr3Encontrado.firma_dos+"                                             "+e.tr3Encontrado.firma_cuatro+"\r\n\r\n\r\nAdj. Lo citado";return l.push(d),new Blob(l,{type:"text/plain"})}if("BU"==e.tipo){d="\r\n\r\nSanta Cruz "+t+" de "+n+" de "+anio+"\r\nESS-P-30/18\r\nSeñores:\r\nBANCO UNION  S.A.\r\nAtn.:"+e.tr3Encontrado.dirigido_para+"\r\n"+e.tr3Encontrado.cargo+"\r\nPresente.-\r\n\r\n\t\t\t\tRef.: Autorización para Abono de  Sueldos "+n+" "+anio+"\r\n\r\nMediante la presente solicitamos debiten de nuestra cuenta corriente No."+e.tr3Encontrado.cuenta.numero+"\r\nel importe total de Bs."+e.total+"("+s+")\r\n, y el concepto de comisiones debitar de nuestra cuenta.\r\n\r\nSe ha realizado la verificación de nuestro extracto de cuenta  No."+e.tr3Encontrado.cuenta.numero+", tenemos saldo suficiente lo cual cubre el importe requerido.\r\n\r\nEnviamos planilla detallada adjunta.\r\n\r\nde "+n+" Debo informar lo siguiente:\r\n\r\n"+e.tr3Encontrado.origen_fondos+"\r\n"+e.tr3Encontrado.destino_fondos+".\r\n\r\nAgradeciendo de antemano su pronta respuesta vía mail, saludo a Usted cordialmente.\r\n\r\nAtentamente,\r\n\r\n\r\n\r\n\r\n\r\n\t\t"+e.tr3Encontrado.firma_uno+"\t\t\t\t"+e.tr3Encontrado.firma_tres+"\r\n\t"+e.tr3Encontrado.firma_dos+"\t\t\t\t\t\t"+e.tr3Encontrado.firma_cuatro+"\r\n";return l.push(d),new Blob(l,{type:"text/plain"})}},a.generarTexto=function(e){var o=[];if("MSC"==e.tipo){e.tr3Encontrado.nombre_archivo;var i=a.fechaATexto(e.tr3Encontrado.fecha);if(e.tr3Encontrado.historialtr3)var t=a.fechaATexto(e.tr3Encontrado.historialtr3[0].anticipo.fecha);else t=a.fechaATexto(e.anticipos[0].fecha);var n=e.tr3Encontrado.planilla+"|"+e.tr3Encontrado.cuenta.numero+"|0|"+e.tr3Encontrado.nombre_planilla+"|"+t+"|"+i+"|"+e.total+"|"+e.tr3Encontrado.numero_planilla+"\r\n";return e.anticipos.forEach(function(i,r,c){i.empleado.empleadosFichas&&(i.empleado.ficha=i.empleado.empleadosFichas[0]),t=a.fechaATexto(i.fecha),n+=r+1+"|"+i.empleado.persona.nombre_completo+"|"+i.empleado.ficha.numero_cuenta+"|"+t+"|"+e.tr3Encontrado.numero_planilla+"|"+i.monto+"|||"+e.tr3Encontrado.nombre_archivo+"\r\n",r===c.length-1&&o.push(n)}),new Blob(o,{type:"text/plain"})}if("BU"==e.tipo){for(var r=(t=new Date(e.tr3Encontrado.fecha)).getMonth()+1,c=t.getMonth(),s=t.getDate(),l="",d=0;d<a.meses.length;d++){var p=a.meses[d];c==p.id&&(l=p.nombre)}r=r<10?"0"+r:r,s=s<10?"0"+s:s;n="SUELDOS  "+l+"  "+t.getFullYear()+"      "+e.tr3Encontrado.planilla+s+r+t.getFullYear()+"\r\n";return n+=e.tr3Encontrado.cuenta.numero+""+e.total+"\r\n",e.anticipos.forEach(function(e,i,r){e.empleado.empleadosFichas&&(e.empleado.ficha=e.empleado.empleadosFichas[0]),t=a.fechaATexto(e.fecha),n+=e.empleado.ficha.numero_cuenta+""+e.monto+"\r\n",i===r.length-1&&o.push(n)}),new Blob(o,{type:"text/plain"})}},a.selecionarAnticipos=function(e,o,i){e&&(0==e.select?(a.anticiposSeleccionados.splice(a.anticiposSeleccionados.indexOf(e)),0==e.entregado&&a.anticiposTr3.splice(a.anticiposTr3.indexOf(e))):(a.anticiposSeleccionados.push(e),0==e.entregado&&a.anticiposTr3.push(e),console.log(a.empleadosSeleccionados))),1==i?(a.anticiposSeleccionados=[],o&&o.forEach(function(e,o,i){e.select=!0,a.anticiposSeleccionados.push(e),0==e.entregado&&a.anticiposTr3.push(e)})):0==i&&(o.forEach(function(a,e,o){a.select=!1}),a.anticiposSeleccionados=[],a.anticiposTr3=[])},a.obtenertiposAusenciaMedica=function(){a.tiposAusenciasMedicas=[],r.start(),ba("RRHH_AUSMED",a.usuario.id_empresa).then(function(e){a.tiposAusenciasMedicas=e,r.stop()})},a.obtenerTiposOtrasAusencias=function(){a.tiposOtrasAusencias=[],r.start(),ba("RRHH_OTRAUS",a.usuario.id_empresa).then(function(e){a.tiposOtrasAusencias=e,r.stop()})},a.CalcularDiferenciaDias=function(e,o){if(o){if(e.fecha_inicio&&e.fecha_fin){var i=new Date(a.convertirFecha(e.fecha_inicio)),t=new Date(a.convertirFecha(e.fecha_fin));i.setMinutes(e.fecha_inicio_hora.getMinutes()),i.setHours(e.fecha_inicio_hora.getHours()),t.setMinutes(e.fecha_fin_hora.getMinutes()),t.setHours(e.fecha_fin_hora.getHours());var n=moment('"'+i.getFullYear()+"-"+i.getMonth()+"-"+i.getDate()+" "+i.getHours()+":"+i.getMinutes()+":00","YYYY-MM-DD HH:mm:ss"),r=moment('"'+t.getFullYear()+"-"+t.getMonth()+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":00","YYYY-MM-DD HH:mm:ss");r.diff(n,"d");e.horas=convertirSegundosATiempo(r.diff(n,"s"))}}else if(e.fecha_inicio&&e.fecha_fin){i=new Date(a.convertirFecha(e.fecha_inicio)),t=new Date(a.convertirFecha(e.fecha_fin));var c=a.diferenciaEntreDiasEnDias(i,t);0==c&&(c=1)}e.primera_baja?(e.dias=c-e.tipo.dias_descuento,e.dias_reales=c):e.dias=c},a.crearNuevaAusencia=function(e,o){if(1==o){var i=parseInt(a.SumaTotalHoras.split(":")[1]),t=parseInt(a.SumaTotalHoras.split(":")[0]),n=parseInt(e.horas.split(":")[1]),r=parseInt(e.horas.split(":")[0]);t<r?(e.fecha_inicio=new Date(a.convertirFecha(e.fecha_inicio)),e.fecha_fin=new Date(a.convertirFecha(e.fecha_fin)),e.fecha_inicio.setMinutes(e.fecha_inicio_hora.getMinutes()),e.fecha_inicio.setHours(e.fecha_inicio_hora.getHours()),e.fecha_fin.setMinutes(e.fecha_fin_hora.getMinutes()),e.fecha_fin.setHours(e.fecha_fin_hora.getHours()),e.compensaciones=a.selectionday,a.guardarAusencia(a.empleado.id_ficha,e)):t==r&&i<=n?(e.fecha_inicio=new Date(a.convertirFecha(e.fecha_inicio)),e.fecha_fin=new Date(a.convertirFecha(e.fecha_fin)),e.fecha_inicio.setMinutes(e.fecha_inicio_hora.getMinutes()),e.fecha_inicio.setHours(e.fecha_inicio_hora.getHours()),e.fecha_fin.setMinutes(e.fecha_fin_hora.getMinutes()),e.fecha_fin.setHours(e.fecha_fin_hora.getHours()),e.compensaciones=a.selectionday,a.guardarAusencia(a.empleado.id_ficha,e)):a.mostrarMensaje("La suma del total de horas compensacion es mayor al total de horas de la ausencia!")}else e.fecha_inicio=new Date(a.convertirFecha(e.fecha_inicio)),e.fecha_fin=new Date(a.convertirFecha(e.fecha_fin)),a.guardarAusencia(a.empleado.id_ficha,e)},a.guardarAusencia=function(e,o){W(e,o).then(function(e){a.ausencia={},a.cerrarDialogAusenciasVacaciones(),a.selectionday=[],a.SumaTotalHoras="",a.calendarCompensacion.fullCalendar("removeEvents"),a.mostrarMensaje(e.mensaje)})},a.obtenerHistorialEmpleadoAusenciasMedicas=function(e){a.historialEmpleadoAusencias=[],null!=e.tipo_ausencia&&void 0!=e.tipo_ausencia||(e.tipo_ausencia=0);var o={inicio:0,fin:0,tipo_ausencia:e.tipo_ausencia};e&&e.inicio&&(o.inicio=new Date(a.convertirFecha(e.inicio)),o.fin=new Date(a.convertirFecha(e.fin))),K(a.empleado.id_ficha,o,"RRHH_AUSMED").then(function(e){e.forEach(function(o,i,t){o.primera_baja?o.baja="Si":o.baja="No",i===t.length-1&&(a.historialEmpleadoAusencias=e)})})},a.obtenerHistorialEmpleadoOtrasAusencias=function(e){null!=e.tipo_ausencia&&void 0!=e.tipo_ausencia||(e.tipo_ausencia=0);var o={inicio:0,fin:0,tipo_ausencia:e.tipo_ausencia};e.inicio&&(o.inicio=new Date(a.convertirFecha(e.inicio)),o.fin=new Date(a.convertirFecha(e.fin))),K(a.empleado.id_ficha,o,"RRHH_OTRAUS").then(function(e){a.historialEmpleadoOtrasAusencias=e})},a.obtenerHistorialEmpresaAusenciasMedicas=function(e){null!=e.tipo_ausencia&&void 0!=e.tipo_ausencia||(e.tipo_ausencia=0);var o={inicio:0,fin:0,tipo_ausencia:e.tipo_ausencia};e.inicio&&(o.inicio=new Date(a.convertirFecha(e.inicio)),o.fin=new Date(a.convertirFecha(e.fin))),Q(a.usuario.id_empresa,o,"RRHH_AUSMED").then(function(e){a.historialEmpresaAusencias=e})},a.obtenerHistorialEmpresaOtrasAusencias=function(e){null!=e.tipo_ausencia&&void 0!=e.tipo_ausencia||(e.tipo_ausencia=0);var o={inicio:0,fin:0,tipo_ausencia:e.tipo_ausencia};e.inicio&&(o.inicio=new Date(a.convertirFecha(e.inicio)),o.fin=new Date(a.convertirFecha(e.fin))),Q(a.usuario.id_empresa,o,"RRHH_OTRAUS").then(function(e){a.historialEmpresaOtrasAusencias=e})},a.agregarTipoAusencia=function(e,o){1==e.edit?a.guardarModificado(e):o.push(e)},a.ModificarTipoAusencia=function(e){a.clase={},e.edit=!0,a.clase=e},a.guardarModificado=function(e){e.edit=!1,a.clase={}},a.guardarClasesAusencias=function(e,o){ta(e,o).then(function(e){a.cerrarDialogTipoBaja(),a.cerrarDialogTipoAusencia(),a.obtenertiposAusenciaMedica(),a.obtenerTiposOtrasAusencias(),a.mostrarMensaje(e.mensaje)})},a.obtenerConfiguracionVacaciones=function(){ca().then(function(e){a.configuracionesVacacion=e})},a.obtenerHistorialGestionesVacacion=function(e,o,i){sa(e.id_ficha).then(function(t){a.historialGestionesVacacion=t;var n=new Date;e.fecha_Retiro_beneficio&&(n=new Date(e.fecha_Retiro_beneficio));var r=new Date(e.fecha_inicio),c=a.diferenciaEntreDiasEnDias(r,n),s=Math.round(c/365);if(a.vacacion.aniosDisponibles=s,a.vacacion.historial=a.historialGestionesVacacion,a.diasDisponibles=0,a.historialGestionesVacacion.forEach(function(e,o,i){e.anio<=s&&(a.diasDisponibles+=e.aplicadas-e.tomadas)}),c>365?(a.usarVacacion=!0,o&&a.abrirPopup(a.idModalAusenciasVacaciones)):(a.usarVacacion=!1,o&&(a.abrirPopup(a.idModalAusenciasVacaciones),setTimeout(function(){a.$apply(function(){a.mostrarMensaje("El empleado no cuenta con la antiguedad para asignar vacaciones")})},2e3))),i){var l=new Date(a.empleado.fecha_expiracion).getFullYear();a.beneficio.totalV=0,a.historialGestionesVacacion.forEach(function(e,o,i){if(e.gestion<l)e.tomadas<e.aplicadas&&(a.beneficio.totalV+=e.aplicadas-e.tomadas,a.beneficio.anios++);else if(e.gestion==l){a.beneficio.meses=a.tiempoTrabajado.meses,a.beneficio.dias=a.tiempoTrabajado.dias;var t=a.beneficio.meses*(e.aplicadas-e.tomadas)/12;a.beneficio.totalV+=t;var n=a.beneficio.dias*(e.aplicadas-e.tomadas)/365;a.beneficio.totalV+=n,0==a.beneficio.meses?(a.beneficio.anios++,e.gestion<=l&&e.tomadas<e.aplicadas&&(a.beneficio.totalV+=e.aplicadas-e.tomadas)):a.beneficio.anios--,a.beneficio.totalV=Math.round(a.beneficio.totalV)}})}})},a.agregarConceptoEdicion=function(e){e.nombre&&e.nombre_corto&&(-1==a.tipo_edicion.clases.indexOf(e)&&a.tipo_edicion.clases.push(e),a.clase={})},a.agregarConductor=function(e){e.habilitado=!0,a.choferesViaje.push(e),a.conductor={}},a.editarConductor=function(e){a.conductor=e},a.filtrarConductor=function(e){a.tipoConductor=e?{id_empleado:e}:{}},a.guardarConductores=function(){Ba(a.usuario.id_empresa,a.choferesViaje).then(function(e){a.mostrarMensaje(e.mensaje),a.obtenerChoferesViaje(),a.cerrarDialogConductoresViaje()})},a.modificarConceptoEdicion=function(e){a.clase=e},a.modificarConceptoEdicionVehiculo=function(e){var o=e.nombre.split("-");e.vehiculo=o[0],e.placa=o[1],a.clase=e},a.removerConceptoEdicion=function(a){a.eliminado=!0},a.guardarConceptoEdicion=function(e){r.start(),na.update({id_tipo:e.id},e,function(o){E(e.nombre_corto).then(function(o){e=o,r.stop(),a.cerrarDialogConceptoEdicion(),a.mostrarMensaje("Guardado Exitosamente!")})})},a.guardarConceptoEdicionVehiculo=function(e){r.start(),na.update({id_tipo:e.id},e,function(o){E(e.nombre_corto).then(function(o){e=o,r.stop(),a.cerrarDialogVehiculosViaje(),a.mostrarMensaje("Guardado Exitosamente!")})})},a.CalcularDiferenciaDiasVacacion=function(e){e.dias=0,e.dias_descuento=0,e.domingos=0,e.sabados=0;var o=e.fecha_inicio,i=e.fecha_fin;if(o&&(o=new Date(a.convertirFecha(o))),i&&(i=new Date(a.convertirFecha(i))),o&&i){if(e.fecha_inicio.length>=9&&e.fecha_fin.length>=9)var t=getDates(o,i);t.forEach(function(o,i,t){var n;e.sabado?(0==(n=new Date(o)).getDay()&&(e.domingos+=1),-1!=a.ListaDiasFeriado.indexOf(o)&&(e.dias_descuento+=1),i===t.length-1&&a.CalcularDiferenciaDiasV(e)):(0==(n=new Date(o)).getDay()&&(e.domingos+=1),6==n.getDay()&&(e.sabados+=1),-1!=a.ListaDiasFeriado.indexOf(o)&&(e.dias_descuento+=1),i===t.length-1&&a.CalcularDiferenciaDiasV(e))})}},a.CalcularDiferenciaDiasV=function(e){if(e.fecha_inicio&&e.fecha_fin){var o=new Date(a.convertirFecha(e.fecha_inicio)),i=new Date(a.convertirFecha(e.fecha_fin)),t=a.diferenciaEntreDiasEnDias(o,i);0==t&&(t=1),e.dias=t+1-(e.dias_descuento+e.domingos+e.sabados),e.inicio_tipo||e.fin_tipo?e.inicio_tipo&&!e.fin_tipo?e.dias=e.dias-.5:!e.inicio_tipo&&e.fin_tipo?e.dias=e.dias-.5:e.inicio_tipo&&e.fin_tipo&&(e.dias=e.dias):e.dias=e.dias-1;var n=(new Date).setTime(new Date(a.convertirFecha(e.fecha_fin)).getTime()+864e5);e.fecha_Retorno=e.fin_tipo?a.fechaATexto(n):e.fecha_fin,e.dias_reales=t+1}},a.crearNuevaVacacion=function(e){e.dias<=a.diasDisponibles?(e.fecha_inicio=new Date(a.convertirFecha(e.fecha_inicio)),e.fecha_fin=new Date(a.convertirFecha(e.fecha_fin)),Z(a.empleado.id_ficha,e).then(function(o){a.imprimirReciboVacacion(e,a.empleado.nombre_completo,a.empleado.fecha_inicio,o.gestiones,o.restantes),a.cerrarDialogAusenciasVacaciones(),a.mostrarMensaje(o.mensaje)})):a.mostrarMensaje("El empleado solo cuenta con "+a.diasDisponibles+" dias disponbles para asignar vacaciones")},a.obtenerHistorialEmpleadVacacion=function(e){var o={inicio:0,fin:0};e.inicio&&(o.inicio=new Date(a.convertirFecha(e.inicio)),o.fin=new Date(a.convertirFecha(e.fin))),aa(a.empleado.id_ficha,o).then(function(e){a.historialEmpleadoVacaciones=e})},a.obtenerHistorialEmpresaVacacion=function(e){var o={inicio:0,fin:0,estado:2};e.inicio&&(o.inicio=new Date(a.convertirFecha(e.inicio)),o.fin=new Date(a.convertirFecha(e.fin))),e.estado&&(o.estado=e.estado),ea(a.usuario.id_empresa,o).then(function(e){e.forEach(function(o,i,t){o.diasRestantes=0;for(var n=0;n<o.ficha.historialVacaciones.length;n++){var r=o.ficha.historialVacaciones[n];o.diasRestantes+=r.aplicadas-r.tomadas}i===t.length-1&&(a.historialEmpresaVacaciones=e)})})},a.selecionarEmpleados=function(e,o,i){i?(a.paginator.itemsPerPage="0",a.empleadosSeleccionados=[]):a.paginator.itemsPerPage="10",o?a.buscarRecursosHumanos(!0,e,o,i):0==e.select?(e.select=!1,a.empleadosSeleccionados.splice(a.empleadosSeleccionados.indexOf(e))):(e.select=!0,a.empleadosSeleccionados.push(e),console.log(a.empleadosSeleccionados))},a.generarExcelEmpleados=function(a,e){for(var o=[["N°","ACTIVO","CODIGO","NOMBRE COMPLETO","EMPLEADO","CI","EXTENCÓN","TIPO CONTRATO","CAMPO","CARGO"]],i=[],t=0;t<a.length;t++){var n=[];n.push(t+1),n.push(a[t].eliminado),n.push(a[t].codigo),n.push(a[t].nombre_completo),n.push(a[t].designacion_empresa),n.push(a[t].ci),n.push(a[t].extension),n.push(a[t].tipoContrato),n.push(a[t].campo);var c=a[t].cargos;i.push(t),n.push(c),o.push(n)}var s="SheetJS",l=new Workbook,d=sheet_from_array_of_arrays(o);l.SheetNames.push(s),l.Sheets[s]=d;var p=XLSX.write(l,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(p)],{type:"application/octet-stream"}),"EMPLEADO RRHH.xlsx"),r.stop()},a.obtenerGestiones=function(){r.start(),E("GTN").then(function(e){a.gestiones=e.clases,r.stop()})},a.abrirModalVerificarCuentaRrhh=function(e){a.empleado=e,a.abrirPopup(a.IdModalVerificarCuentaRrhh)},a.cerrarModalVerificarCuentaRrhh=function(e){e&&(a.empleado.activo=1!=a.empleado.activo),a.cerrarPopup(a.IdModalVerificarCuentaRrhh)},a.abrirModalVerificacion=function(e){1==e.activo?(a.funcionCerrar=a.cerrarModalReingresoEmpleado,a.funcionArealizar=a.ActivarCuentaRrhh,a.abrirModalVerificarCuentaRrhh(e)):(a.funcionCerrar=a.cerrarMensajeConfirmacion,a.funcionArealizar=a.verificarCuentaAdminRrhh,a.abrirModalVerificarCuentaRrhh(e),setTimeout(function(){aplicarDatePickers()},300))},a.abrirMensajeConfirmacion=function(e){a.cuenta=e,a.abrirPopup(a.idModalConfirmarDesabilitacion)},a.abrirModalReingresoEmpleado=function(){a.abrirPopup(a.idModalReingresoEmpleado)},a.cerrarModalReingresoEmpleado=function(e){e&&(a.empleado.activo=1!=a.empleado.activo),a.cerrarPopup(a.idModalReingresoEmpleado),a.empleado.tipoReincorporacion&&"NREING"==a.empleado.tipoReincorporacion.nombre_corto&&a.abrirDialogEmpleado(a.empleado)},a.cerrarMensajeConfirmacion=function(e){e&&(a.empleado.activo=1!=a.empleado.activo),a.cerrarPopup(a.idModalConfirmarDesabilitacion)},a.verificarCuentaAdminRrhh=function(e){O.save({id_empresa:a.usuario.id_empresa},e,function(o){o.type?(e.fecha?a.empleado.nueva_fecha_expiracion=new Date(a.convertirFecha(a.cuenta.fecha)):a.empleado.nueva_fecha_expiracion=null,a.empleado.motivo_retiro=a.cuenta.motivo_retiro,a.abrirMensajeConfirmacion(e),a.cerrarModalVerificarCuentaRrhh()):a.mostrarMensaje(o.message)})},a.ActivarCuentaRrhh=function(e){O.save({id_empresa:a.usuario.id_empresa},e,function(o){o.type?(a.empleado.nueva_fecha_expiracion=null,a.abrirModalReingresoEmpleado(e),a.cerrarModalVerificarCuentaRrhh()):a.mostrarMensaje(o.message)})},a.changeActivoEmpleado=function(e){e.activo=0==e.activo,m(e).then(function(o){a.funcionCerrar(),a.cuenta={},a.mostrarMensaje(o.mensaje),e.tipoReincorporacion?(e.activo=0==e.activo,"NREING"==e.tipoReincorporacion.nombre_corto?(a.primeroGuardarParaCerrar=!0,a.obtenerRecursosHumanos(),a.abrirDialogEmpleado(e,!0)):a.obtenerRecursosHumanos()):a.obtenerRecursosHumanos()})},a.EliminarUsuarioRh=function(e){e.activo&&(e.activo=!1,a.abrirModalVerificacion(e))},a.obtenerTiposBaja=function(){r.start(),ba("RRHH_TPRE",a.usuario.id_empresa).then(function(e){a.tiposBajas=e,r.stop()})},a.obtenerTiposOtrosingresosYDeduccion=function(){r.start(),ba("RRHH_TPDOI",a.usuario.id_empresa).then(function(e){a.tiposOtrosingresosYDeduccion=e,a.tiposOtrosingresosYDeduccion.clases.forEach(function(e,o,i){"OTRING"==e.nombre_corto?a.tipoOtrosIngresos=e:a.tipoDeducciones=e}),r.stop()})},a.obtenerMotivosRetiro=function(){r.start(),ba("RRHH_TPMR",a.usuario.id_empresa).then(function(e){a.tipoMotivo=e,r.stop()})},a.agregarOtroIngreso=function(e){e.tipo=a.tipoOtrosIngresos,a.beneficio.ingresos.push(e),a.ingreso={motivo:"",monto:""},a.sumartotalOtrosIngresos(a.beneficio)},a.eliminarOtroIngreso=function(e,o){o.id?(o.eliminado=!0,o.motivo=""):(a.beneficio.ingresos.splice(e,1),a.sumartotalOtrosIngresos(a.beneficio))},a.agregarDeduccion=function(e){e.tipo=a.tipoDeducciones,a.beneficio.deducciones.push(e),a.deduccion={motivo:"",monto:""},a.sumarTotalDeducciones(a.beneficio)},a.sumarTotalDeducciones=function(a){a.total_deducciones=0,a.deducciones.forEach(function(e,o,i){a.total_deducciones+=e.monto})},a.eliminarDeduccion=function(e,o){o.id?(o.eliminado=!0,o.motivo=""):(a.beneficio.deducciones.splice(e,1),a.sumarTotalDeducciones(a.beneficio))},a.guardarBeneficioSocial=function(e){e.fecha_elaboracion=new Date(a.convertirFecha(e.fecha_elaboracion)),e.fecha_asistensia=new Date(a.convertirFecha(e.fecha_asistensia)),e.fecha_ingreso=new Date(a.convertirFecha(e.fecha_ingreso)),e.fecha_retiro?e.fecha_retiro=new Date(a.convertirFecha(e.fecha_retiro)):e.fecha_retiro=new Date,ua(e,a.empleado.id_ficha).then(function(o){a.imprimirFiniquito(e,!1),a.mostrarMensaje(o.mensaje),a.cerrarDialogBeneficiosSociales()}).catch(function(e){var o=void 0!==e.data&&null!==e.data?e.data:e.message;a.mostrarMensaje("Se produjo un error! > "+o),r.stop()})},a.seleccionarMesesFiniquito=function(e){10==e.mes_uno.id?(e.mes_dos=a.meses[11],e.mes_tres=a.meses[0]):11==e.mes_uno.id?(e.mes_dos=a.meses[0],e.mes_tres=a.meses[1]):(e.mes_dos=a.meses[e.mes_uno.id+1],e.mes_tres=a.meses[e.mes_uno.id+2])},a.agregarQuinquenioAdelantado=function(e){var o=0;if(e.quinquenio_adelantado){var i={monto:o=e.quinquenio_adelantado,motivo:"Quinquenio Adelantado",tipo:a.tipoDeducciones};if(e.deducciones.length>0){var t=!1;e.deducciones.forEach(function(n,r,c){"Quinquenio Adelantado"==n.motivo&&(n.monto=o,t=!0),r===c.length-1&&(t||e.deducciones.push(i),a.sumarTotalDeducciones(e))})}else e.deducciones.push(i)}else e.deducciones.forEach(function(o,i,n){t=!1,"Quinquenio Adelantado"==o.motivo&&(e.deducciones.splice(i,1),a.sumarTotalDeducciones(e))})},a.CalcularAguinaldoNavidad2=function(e){var o=new Date(a.convertirFecha(e.fecha_retiro)),i=new Date(a.convertirFecha(e.fecha_retiro)).getMonth()+1,t=new Date(a.convertirFecha(e.fecha_retiro)).getDate();t===new Date(o.getFullYear(),o.getMonth()+1,0).getDate()?(e.diasAguinaldo=0,e.mesesAguinaldo=i):(e.mesesAguinaldo=i-1,e.diasAguinaldo=t);var n=e.promedio/12,r=n/30;return n*e.mesesAguinaldo+r*e.diasAguinaldo},a.obtenerCuentasBancos=function(){r.start(),ra(a.usuario.id_empresa).then(function(e){a.cuentasBancos=e,r.stop()})},a.calcularPromedioFiniquito=function(e){if(e.promedio=(e.primer_mes+e.segundo_mes+e.tercer_mes)/3,e.tipo_beneficio)if(isNaN(e.promedio)){var o=[];e.ingresos.forEach(function(i,t,n){if("Vacacion"==i.motivo&&o.push(t),"indemnizacion años"==i.motivo&&o.push(t),"indemnizacion meses"==i.motivo&&o.push(t),"indemnizacion dias"==i.motivo&&o.push(t),"Desahucio"==i.motivo&&o.push(t),t===n.length-1)for(var r=o.length-1;r>=0;r--){var c=o[r];e.ingresos.splice(c,1),a.sumartotalOtrosIngresos(e)}})}else{e.desahucio&&a.calcularDesaucio(e,!1),e.totalAguinaldo=a.CalcularAguinaldoNavidad2(e);var i=a.añosRestantes*e.promedio,t=e.promedio/12*a.tiempoTrabajado.meses,n=e.promedio/365*a.tiempoTrabajado.dias,r={monto:i,motivo:"indemnizacion años",tipo:a.tipoOtrosIngresos},c={monto:t,motivo:"indemnizacion meses",tipo:a.tipoOtrosIngresos},s={monto:n,motivo:"indemnizacion dias",tipo:a.tipoOtrosIngresos},l={monto:e.promedio/30*e.totalV,motivo:"Vacacion",tipo:a.tipoOtrosIngresos},d={monto:e.totalAguinaldo,motivo:"Aguinaldo de navidad",tipo:a.tipoOtrosIngresos};if(e.ingresos.length>0){var p=!1,u=!1,f=!1,m=!1,h=!1;e.ingresos.forEach(function(o,g,b){"indemnizacion años"==o.motivo&&(o.monto=i,p=!0),"indemnizacion meses"==o.motivo&&(o.monto=t,u=!0),"indemnizacion dias"==o.motivo&&(o.monto=n,f=!0),"Vacacion"==o.motivo&&(o.monto=e.promedio/30*e.totalV,m=!0),"Aguinaldo de navidad"==o.motivo&&(o.monto=e.totalAguinaldo,h=!0),g===b.length-1&&(p||e.ingresos.push(r),u||e.ingresos.push(c),f||e.ingresos.push(s),m||e.ingresos.push(l),h||e.ingresos.push(d),a.sumartotalOtrosIngresos(e))})}else e.ingresos.push(r),e.ingresos.push(c),e.ingresos.push(s),e.ingresos.push(l),e.ingresos.push(d),a.sumartotalOtrosIngresos(e)}},a.sumartotalOtrosIngresos=function(a){a.total_ingresos=0,a.ingresos.forEach(function(e,o,i){a.total_ingresos+=e.monto})},a.calcularTotalQuiquenio=function(a){a.total_quinquenio=a.promedio*(5*a.numero_quinquenio),a.total_por_quinquenio=a.total_quinquenio/a.numero_quinquenio},a.calcularDesaucio=function(e,o){if(isNaN(e.promedio))e.ingresos.forEach(function(o,i,t){"Desahucio"==o.motivo&&(e.ingresos.splice(i,1),a.sumartotalOtrosIngresos(e))});else if(e.desahucio){if(e.total_desahucio=3*e.promedio,e.total_desahucio=parseFloat(e.total_desahucio.toFixed(2)),e.tipo_beneficio){var i={monto:e.total_desahucio,motivo:"Desahucio",tipo:a.tipoOtrosIngresos};if(!o)if(e.ingresos.length>0){var t=!1;e.ingresos.forEach(function(o,n,r){"Desahucio"==o.motivo&&(o.monto=e.total_desahucio,t=!0),n===r.length-1&&(t||(e.ingresos.push(i),a.sumartotalOtrosIngresos(e)))})}else e.ingresos.push(i),a.sumartotalOtrosIngresos(e)}}else{t=!1;var n=0;e.ingresos.forEach(function(o,i,r){"Desahucio"==o.motivo&&(t=!0,n=i),i===r.length-1&&t&&(e.ingresos.splice(n,1),a.sumartotalOtrosIngresos(e))})}},a.listaRopaTrabajoPorCargo=function(e){_a(e).then(function(e){a.listaRopasDeTrabajo=e})},a.GuardarlistaRopaTrabajoPorCargo=function(e){"Siguiente"!=$("#siguiente-ca").text().trim()&&va(a.listaRopasDeTrabajo,e).then(function(e){a.mostrarMensaje(e.mensaje),a.cerrarModalConfiguracionRopaDeTrabajo(),a.listaRopasDeTrabajo=[],a.recargarItemsTabla()})},a.agregarRopaTrabajo=function(e){var o=!0;e.edit?(e.edit=!1,a.ropaTrabajo={}):a.listaRopasDeTrabajo.length>0?a.listaRopasDeTrabajo.forEach(function(i,t,n){e.ropaTrabajo.nombre==i.ropaTrabajo.nombre&&(o=!1,1==i.eliminado&&(i.eliminado=!1)),t===n.length-1&&o&&(a.listaRopasDeTrabajo.push(e),a.ropaTrabajo={})}):(a.listaRopasDeTrabajo.push(e),a.ropaTrabajo={})},a.editarRopaTrabajo=function(e){a.ropaTrabajo=e,a.ropaTrabajo.edit=!0},a.eliminarRopaTrabajo=function(a){a.eliminado=!0},a.generarPdfRopaTrabajo=function(){Da(a.usuario.id_empresa).then(function(e){var o=[];e.forEach(function(i,t,n){var c={nombre:i.cargo.nombre,detalle:[]};if(o.length>0)for(var s=!0,l=0;l<o.length;l++){c={nombre:i.cargo.nombre,detalle:[]},o[l].nombre==i.cargo.nombre&&(s=!1),l===o.length-1&&s&&o.push(c)}else o.push(c);t===n.length-1&&e.forEach(function(i,t,n){for(var c=0;c<o.length;c++){var s=o[c];s.nombre==i.cargo.nombre&&s.detalle.push(i)}t===n.length-1&&ObtenerImagen(a.usuario.empresa.imagen).then(function(i){var t=i,n=new PDFDocument({compress:!1,size:"letter",margin:10}),c=n.pipe(blobStream()),s=100,l=0,d=1,p=Math.ceil((2*o.length+e.length)/25);a.DibujarCabeceraPDFConfigRopa(n,d,p,o,t),n.font("Helvetica",10);for(var u=0;u<o.length&&l<=25;u++){ropaTrabajo=o[u],n.text(u+1,45,s),n.text(ropaTrabajo.nombre,80,s),s+=30,25==++l&&(n.addPage({margin:0,bufferPages:!0}),s=100,l=0,d+=1,a.DibujarCabeceraPDFConfigRopa(n,d,p,o,t),n.font("Helvetica",10)),n.font("Helvetica-Bold",10),n.text("ROPA",80,s),n.text("CANTIDAD",250,s,{width:70}),n.font("Helvetica",10),s+=30,25==++l&&(n.addPage({margin:0,bufferPages:!0}),s=100,l=0,d+=1,a.DibujarCabeceraPDFConfigRopa(n,d,p,o,t),n.font("Helvetica",10));for(var f=0;f<ropaTrabajo.detalle.length;f++){var m=ropaTrabajo.detalle[f];n.text(m.ropaTrabajo.nombre,80,s),n.text(m.cantidad,250,s,{width:70}),s+=30,25==++l&&(n.addPage({margin:0,bufferPages:!0}),s=100,l=0,d+=1,a.DibujarCabeceraPDFConfigRopa(n,d,p,o,t),n.font("Helvetica",10))}25==++l&&(n.addPage({margin:0,bufferPages:!0}),s=100,l=0,d+=1,a.DibujarCabeceraPDFConfigRopa(n,d,p,o,t),n.font("Helvetica",10))}n.end(),c.on("finish",function(){var a=c.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),r.stop()})})})})},a.DibujarCabeceraPDFConfigRopa=function(e,o,i,t,n){e.font("Helvetica-Bold",14),e.text("ROPA DE TRABAJO - POR CARGOS",0,20,{align:"center"}),e.image(n,30,10,{fit:[80,80]}),e.rect(0,65,620,0).stroke(),e.rect(130,40,500,0).stroke(),e.rect(130,0,0,65).stroke(),e.rect(460,0,0,65).stroke(),e.font("Helvetica-Bold",8),e.text("Revicion:",480,20),e.text("Fecha de aprobación:",480,45),e.text("Código .",0,45,{align:"center"}),e.font("Helvetica",8);var r=new Date;e.text("Usuario: "+a.usuario.persona.nombre_completo+"      Fecha :  "+a.fechaATexto(r)+"   Hrs. "+r.getHours()+":"+r.getMinutes(),15,765),e.font("Helvetica-Bold",8),e.text("PÁGINA "+o+" DE "+i,0,740,{align:"center"})},a.generarExcelRopaTrabajo=function(){Da(a.usuario.id_empresa).then(function(a){for(var e=[["N°","CARGO","ROPA","CANTIDAD"]],o=0;o<a.length;o++){var i=[];i.push(o+1),i.push(a[o].cargo.nombre),i.push(a[o].ropaTrabajo.nombre),i.push(a[o].cantidad),e.push(i)}var t="SheetJS",n=new Workbook,c=sheet_from_array_of_arrays(e);n.SheetNames.push(t),n.Sheets[t]=c;var s=XLSX.write(n,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(s)],{type:"application/octet-stream"}),"REPORTES CONFIGURACION ROPA DE TRABAJO.xlsx"),r.stop()})},a.obtenerCargosRopaTrabajo=function(){r.start(),ba("RRHH_CARGO",a.usuario.id_empresa).then(function(e){var o=e.clases;a.listaCargos=e,a.llenarCargos(o),r.stop()})},a.obtenerCargosEmpleado=function(e,o,i){Aa(a.empleado.id_ficha).then(function(t){a.cargosEmpleado=t;var n=[];t.forEach(function(r,c,s){r.cargo.ConfiguracionesCargo.forEach(function(a,e,o){var i={nombre:a.cargo.nombre,detalle:[]};if(n.length>0)for(var t=!0,r=0;r<n.length;r++){i={nombre:a.cargo.nombre,detalle:[]},n[r].nombre==a.cargo.nombre&&(t=!1),r===n.length-1&&t&&n.push(i)}else n.push(i);o.length}),c===s.length-1&&t.forEach(function(r,c,s){r.cargo.ConfiguracionesCargo.forEach(function(a,e,o){for(var i=0;i<n.length;i++){var t=n[i];t.nombre==a.cargo.nombre&&t.detalle.push(a)}}),c===s.length-1&&(a.dotacionItems=[],t.forEach(function(t,n,r){if(t.cargo.ConfiguracionesCargo.forEach(function(e,o,i){if(a.dotacionItems.length>0)for(var t=!0,n=0;n<a.dotacionItems.length;n++){a.dotacionItems[n].ropaTrabajo.nombre==e.ropaTrabajo.nombre&&(t=!1),n===a.dotacionItems.length-1&&t&&(e.editable=!0,e.modificable=!0,e.entregado=!1,a.dotacionItems.push(e))}else e.editable=!0,e.modificable=!0,e.entregado=!1,a.dotacionItems.push(e)}),n===r.length-1){var c=[];if(e){l=a.listaDotaciones.length-1;void 0!=o&&(l=o),a.dotacionRopa.dotacionItems=a.listaDotaciones[l].dotacionItems;d=new Date;a.dotacionRopa.fecha=a.fechaATexto(d),a.dotacionRopa.fecha_vencimiento=a.fechaATexto(a.dotacionRopa.fecha_vencimiento)}else{if(a.listaDotaciones.length>0&&!i){var s=[],l=a.listaDotaciones.length-1;o&&(l=o),console.log(a.listaDotaciones[l].dotacionItems.length),console.log(a.dotacionItems.length),a.listaDotaciones[l].dotacionItems.forEach(function(o,i,t){for(var n=!1,r=0;r<a.dotacionItems.length;r++){var l=a.dotacionItems[r];l.id_cargo==o.id_cargo&&l.id_ropa_trabajo==o.id_ropa_trabajo?(l.producto=o.producto,l.cantidad=o.cantidad,l.entregado=o.entregado,l.entregado&&(l.modificable=!1),e&&(l.modificable=!0),s.push(o.id)):n=!0}n&&c.push(o),i===t.length-1&&s.forEach(function(e,o,i){for(var t=0;t<c.length;t++){var n=c[t];n.id==e?c.splice(t,1):n.editable=!1}if(o===i.length-1){var r=[];a.dotacionItems.forEach(function(e,o,i){for(var t=0;t<c.length;t++){var n=c[t];e.id_ropa_trabajo==n.id_ropa_trabajo&&(e.producto=n.producto,e.cantidad=n.cantidad,e.entregado=n.entregado,r.push(n.id))}if(o===i.length-1)if(r.length>0)r.forEach(function(e,o,i){for(var t=0;t<c.length;t++){var n=c[t];n.id==e?c.splice(t,1):n.editable=!1}if(o===i.length-1){a.dotacionItemsDetalle=a.dotacionItems.concat(c),a.dotacionRopa.dotacionItems=a.dotacionItemsDetalle;var r=new Date;a.dotacionRopa.fecha=a.fechaATexto(r),a.dotacionRopa.fecha_vencimiento=a.fechaATexto(a.dotacionRopa.fecha_vencimiento)}});else{a.dotacionItemsDetalle=a.dotacionItems.concat(c),a.dotacionRopa.dotacionItems=a.dotacionItemsDetalle;var s=new Date;a.dotacionRopa.fecha=a.fechaATexto(s),a.dotacionRopa.fecha_vencimiento=a.fechaATexto(a.dotacionRopa.fecha_vencimiento)}})}})})}else{a.dotacionRopa.dotacionItems=a.dotacionItems;var d=new Date;a.dotacionRopa.fecha=a.fechaATexto(d)}}}}))})})})},a.obtenerEstadoDotacion=function(){r.start(),ba("RRHH_EDRT",a.usuario.id_empresa).then(function(e){a.estadoDotacion=e,r.stop()})},a.obtenerCumplimientoDotacion=function(){r.start(),ba("RRHH_CDRT",a.usuario.id_empresa).then(function(e){a.cumplimientoDotacion=e,r.stop()})},a.obtenerPeriodosDotacion=function(){r.start(),ba("RRHH_PDR",a.usuario.id_empresa).then(function(e){a.periodoDotacion=e,r.stop()})},a.obtenerListaRopaTrabajoProductos=function(){r.start();var e="";a.dotacionRopa.dotacionItems.forEach(function(o,i,t){i===t.length-1?(e+=o.id_ropa_trabajo,Ra(e).then(function(e){a.productosRopaTrabajo=e,a.dotacionRopa.dotacionItems.forEach(function(e){e.producto&&a.calularInventarioItem(e)}),r.stop()})):e+=o.id_ropa_trabajo+","})},a.calularInventarioItem=function(a){a.cantidad_disponible=0,a.producto.inventarios.length>0&&a.producto.inventarios.forEach(function(e,o,i){a.cantidad_disponible+=e.cantidad})},a.seleccionarItem=function(a){a.editable?a.modificable&&(a.entregado?a.entregado=!a.entregado:a.entregado=!0):a.anterior||(a.entregado?a.entregado=!a.entregado:a.entregado=!0)},a.guardarDotacionRopa=function(e){(r.start(),a.actualizarDotacion)?(e.fecha=new Date(a.convertirFecha(e.fecha)),e.fecha_vencimiento=new Date(a.convertirFecha(e.fecha_vencimiento)),ja(a.empleado.id,e).then(function(o){a.mostrarMensaje(o.mensaje),a.obtenerRecursosHumanos(),a.ObtenerDotacionesRopa(a.empleado),e.numero=o.numero,a.imprimirRopaTrabajo(e),a.cerrarModalNuevaRopaTrabajo(),r.stop()}),r.stop()):(e.fecha=new Date(a.convertirFecha(e.fecha)),e.fecha_vencimiento=new Date(a.convertirFecha(e.fecha_vencimiento)),Ma(a.empleado.id,e).then(function(o){a.mostrarMensaje(o.mensaje),a.ObtenerDotacionesRopa(a.empleado),e.numero=o.numero,a.imprimirRopaTrabajo(e),a.cerrarModalNuevaRopaTrabajo(),r.stop()}))},a.ObtenerDotacionesRopa=function(e,o,i){var t={inicio:0,fin:0};o&&void 0!=o.inicio&&(t.inicio=o.inicio,t.fin=o.fin),xa(e.id,t).then(function(e){e.length>0?e.forEach(function(o,t,n){o.cargos=[],o.ropas=[],o.dotacionItems.forEach(function(a,e,i){if(o.cargos.length>0){for(var t=!0,n=0;n<o.cargos.length;n++){o.cargos[n].nombre==a.cargo.nombre&&(t=!1)}t&&o.cargos.push(a.cargo)}else o.cargos.push(a.cargo);if(o.ropas.length>0){for(t=!0,n=0;n<o.ropas.length;n++){o.ropas[n].nombre==a.ropaTrabajo.nombre&&(t=!1)}t&&o.ropas.push(a.ropaTrabajo)}else o.ropas.push(a.ropaTrabajo)}),t===n.length-1&&(a.listaDotaciones=e,i&&a.abrirModalNuevaRopaTrabajo(a.empleado,!1))}):(a.listaDotaciones=e,i&&a.abrirModalNuevaRopaTrabajo(a.empleado,!1)),r.stop()})},a.abrirDialogEliminarRopaTrabajo=function(){a.abrirPopup(a.idModalEliminarRopaTrabajo)},a.cerrarDialogEliminarRopaTrabajo=function(){a.dato={},a.cerrarPopup(a.idModalEliminarRopaTrabajo)},a.eliminarRopaTrabajoEmpleado=function(e){Pa(e).then(function(e){a.mostrarMensaje(e.mensaje),a.ObtenerDotacionesRopa(a.empleado),a.cerrarDialogEliminarRopaTrabajo()})},a.imprimirRopaTrabajo=function(e){var o=new PDFDocument({compress:!1,size:"letter",margin:10}),i=o.pipe(blobStream()),t=215,n=0,c=1,s=Math.ceil(e.dotacionItems.length/18);a.DibujarCabeceraPDFRopaTrabajo(o,c,s,e),o.font("Helvetica",10);for(var l=0;l<e.dotacionItems.length&&n<=18;l++){if(item=e.dotacionItems[l],item.entregado)!item.anterior&&(o.text(item.producto.codigo,45,t,{width:70}),codigo,o.text(item.ropaTrabajo.nombre,175,t,{width:70}),o.text(item.producto.unidad_medida,345,t,{width:100}),o.text(item.cantidad,485,t,{width:100}),t+=30,n++);18==n&&(o.addPage({margin:0,bufferPages:!0}),t=215,n=0,c+=1,a.DibujarCabeceraPDFAnticipoRegular(o,c,s,e))}o.font("Helvetica",10);var d=new Date;t<400?t=335:t+=30,o.rect(85,t-5,85,0).dash(5,{space:10}).stroke(),o.rect(300,t-5,85,0).dash(5,{space:10}).stroke(),o.rect(455,t-5,85,0).dash(5,{space:10}).stroke(),o.text("encargado Área",85,t),o.text("Supervisor",315,t),o.text("Recibó conforme",455,t),t+=30,o.text("USUARIO: "+a.usuario.persona.nombre_completo+" FECHA:"+a.fechaATexto(d),15,t),o.end(),i.on("finish",function(){var a=i.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),r.stop()},a.DibujarCabeceraPDFRopaTrabajo=function(e,o,i,t){e.font("Helvetica-Bold",12),e.text("DOTACIÓN ROPA DE TRABAJO",0,45,{align:"center"}),e.font("Helvetica",10),e.text("Nro. "+t.numero,0,65,{align:"center"}),e.text(a.fechaATexto(new Date(t.fecha)),0,85,{align:"center"}),e.font("Helvetica-Bold",10),e.text("Empleado: ",45,100),e.text("Cargo: ",400,100),e.text("Campamento: ",45,120),e.text("Periodo: ",45,140),e.text("Estado: ",400,140),e.text("Retrasado",45,160),e.rect(35,175,535,0).dash(5,{space:10}).stroke(),e.rect(35,200,535,0).dash(5,{space:10}).stroke(),e.text("Código",45,185,{width:70}),e.text("Descripcion",175,185,{width:70}),e.text("Unidad",345,185,{width:70}),e.text("Cant",485,185,{width:70}),e.font("Helvetica",10),e.text(a.empleado.nombre_completo,100,100),e.text(t.periodo.nombre,100,140),a.empleado.campamento&&e.text(a.empleado.campamento,120,120),e.text(t.estado.nombre,440,140);var n="";t.cargos?t.cargos.forEach(function(a,o,i){o===i.length-1?(n+=a.nombre,e.text(n,440,100)):n+=a.nombre+", "}):a.cargosEmpleado.forEach(function(a,o,i){o===i.length-1?(n+=a.cargo.nombre,e.text(n,440,100)):n+=a.nombre+", "})},a.generarReporteRopaTrabajo=function(e,o){"pdf"==e?a.generarpdfRopaTrabajoEmpleados(o):a.generarExcelRopaTrabajoEmpleados(o)},a.generarExcelRopaTrabajoEmpleados=function(e){e.inicio?(e.inicio=new Date(a.convertirFecha(e.inicio)),e.fin=new Date(a.convertirFecha(e.fin))):(e.inicio=0,e.fin=0),Ta(a.usuario.id_empresa,e).then(function(a){0==e.inicio&&(e.inicio="",e.fin="");for(var o=1,i=[["N°","Asignado a:","Codigo de Artículo","Descripción","unidad","cantidad","PU","TOTAL","N° de Documento","Fecha de Entrega"]],t=0;t<a.length;t++)if(a[t].dotacionRopa.empleado.id_campo==e.campo){var n=[];n.push(o++),n.push(a[t].dotacionRopa.empleado.persona.nombre_completo),n.push(a[t].producto.codigo),n.push(a[t].producto.nombre),n.push(a[t].producto.unidad_medida),n.push(a[t].cantidad),n.push(a[t].producto.precio_unitario),n.push(a[t].producto.precio_unitario*a[t].cantidad),n.push(a[t].dotacionRopa.numero),n.push(new Date(a[t].dotacionRopa.fecha)),i.push(n)}var c="SheetJS",s=new Workbook,l=sheet_from_array_of_arrays(i);s.SheetNames.push(c),s.Sheets[c]=l;var d=XLSX.write(s,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(d)],{type:"application/octet-stream"}),"REPORTES CONFIGURACION ROPA DE TRABAJO.xlsx"),r.stop()})},a.generarpdfRopaTrabajoEmpleados=function(e){e.inicio?(e.inicio=new Date(a.convertirFecha(e.inicio)),e.fin=new Date(a.convertirFecha(e.fin))):(e.inicio=0,e.fin=0),Ta(a.usuario.id_empresa,e).then(function(o){arregloNombres=[],o.forEach(function(i,t,n){if(0==t)arregloNombres.push(i.dotacionRopa.empleado.persona.nombre_completo);else{for(var c=!1,s=0;s<arregloNombres.length;s++){arregloNombres[s]===i.dotacionRopa.empleado.persona.nombre_completo&&(c=!0)}c||arregloNombres.push(i.dotacionRopa.empleado.persona.nombre_completo)}t===n.length-1&&ObtenerImagen(a.usuario.empresa.imagen).then(function(i){var t=i;0==e.inicio&&(e.inicio="",e.fin="");var n=new PDFDocument({compress:!1,size:"letter",margin:10}),c=n.pipe(blobStream()),s=110,l=0,d=1,p=Math.ceil((o.length+arregloNombres.length)/20);a.DibujarCabeceraPDFRopaTrabajoEmpleados(n,d,p,o,t),n.font("Helvetica",10);for(var u=0;u<o.length&&l<=20;u++)item=o[u],0==u&&(n.font("Helvetica-Bold",10),n.text("Asignado a:",45,s),n.font("Helvetica",10),n.text(item.dotacionRopa.empleado.persona.nombre_completo,105,s),s+=30,n.rect(30,s-15,550,0).stroke(),n.rect(30,s-15,0,30).stroke(),n.rect(580,s-15,0,30).stroke(),l++),u>0&&(item.dotacionRopa.empleado.persona.nombre_completo===o[u-1].dotacionRopa.empleado.persona.nombre_completo?(n.rect(30,s-15,0,30).stroke(),n.rect(580,s-15,0,30).stroke()):(n.rect(30,s-15,550,0).stroke(),n.font("Helvetica-Bold",10),n.text("Asignado a:",45,s),n.font("Helvetica",10),n.text(item.dotacionRopa.empleado.persona.nombre_completo,105,s),s+=30,n.rect(30,s-15,550,0).stroke(),n.rect(30,s-15,0,30).stroke(),n.rect(580,s-15,0,30).stroke(),l++)),n.text(u+1,35,s),n.text(item.producto.codigo,85,s),n.text(item.producto.nombre,145,s),n.text(item.producto.unidad_medida,245,s),n.text(item.cantidad,295,s),n.text(item.producto.precio_unitario,345,s),n.text(item.producto.precio_unitario*item.cantidad,400,s),n.text(item.dotacionRopa.numero,480,s),n.text(a.fechaATexto(new Date(item.dotacionRopa.fecha)),500,s),s+=30,20==++l&&(n.rect(30,s-15,550,0).stroke(),n.addPage({margin:0,bufferPages:!0}),s=110,l=0,d+=1,a.DibujarCabeceraPDFRopaTrabajoEmpleados(n,d,p,o,t),o[u+1].dotacionRopa.empleado.persona.nombre_completo===o[u].dotacionRopa.empleado.persona.nombre_completo&&(n.rect(30,s-15,550,0).stroke(),n.font("Helvetica-Bold",10),n.text("Asignado a:",45,s),n.font("Helvetica",10),n.text(item.dotacionRopa.empleado.persona.nombre_completo,105,s),s+=30,n.rect(30,s-15,550,0).stroke(),n.rect(30,s-15,0,30).stroke(),n.rect(580,s-15,0,30).stroke(),l++));n.rect(30,s-15,550,0).stroke(),n.end(),c.on("finish",function(){var a=c.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),r.stop()})})})},a.DibujarCabeceraPDFRopaTrabajoEmpleados=function(e,o,i,t,n){e.font("Helvetica-Bold",12),e.text("DOTACION DE ROPA E IMPLEMENTOS DE TRABAJO",0,50,{align:"center"}),e.image(n,40,40,{fit:[80,80]}),e.rect(30,35,550,0).stroke(),e.rect(30,95,550,0).stroke(),e.rect(130,70,450,0).stroke(),e.rect(130,35,0,60).stroke(),e.rect(460,35,0,60).stroke(),e.rect(30,35,0,60).stroke(),e.rect(580,35,0,60).stroke(),e.font("Helvetica-Bold",8),e.text("Revicion:",470,50),e.text("Fecha de aprobación:",470,75),e.text("Código .",0,75,{align:"center"}),e.font("Helvetica",8);var r=new Date;e.text("Usuario: "+a.usuario.persona.nombre_completo+"      Fecha :  "+a.fechaATexto(r)+"   Hrs. "+r.getHours()+":"+r.getMinutes(),15,765),e.font("Helvetica-Bold",8),e.text("PÁGINA "+o+" DE "+i,0,740,{align:"center"})},a.imprimirFiniquito=function(e,o,i){if(i){a.vacacion={},a.beneficio=e,a.empleado=e.ficha.empleado,a.empleado.id_ficha=e.ficha.id,a.empleado.haber_basico=e.ficha.haber_basico,a.empleado.fecha_inicio=e.ficha.fecha_inicio,a.empleado.fecha_Retiro_beneficio=new Date(e.fecha_retiro),a.empleado.nombre_completo=e.ficha.empleado.persona.nombre_completo,a.empleado.estado=e.ficha.empleado.persona.estadoCivil.nombre,a.empleado.direccion=e.ficha.empleado.persona.direccion_zona,a.empleado.fecha_nacimiento=e.ficha.empleado.persona.fecha_nacimiento,a.empleado.ci=e.ficha.empleado.persona.ci,a.empleado.extension=e.ficha.empleado.extension.nombre,a.obtenerHistorialGestionesVacacion(a.empleado,!1,!0);var t=new Date;e.fecha_retiro&&(t=new Date(e.fecha_retiro));var n=new Date(e.fecha_ingreso);a.tiempoTrabajado=duration(n,t),e.mes_uno=a.meses[e.mes_uno],e.mes_dos=a.meses[e.mes_dos],e.mes_tres=a.meses[e.mes_tres],e.fecha_retiro&&(e.fecha_retiro=a.fechaATexto(e.fecha_retiro),e.totalAguinaldo=a.CalcularAguinaldoNavidad2(e)),e.ingresos=[],e.deducciones=[],e.deduccionEingresos.forEach(function(o,i,t){"OTRING"==o.tipo.nombre_corto?e.ingresos.push(o):e.deducciones.push(o),i===t.length-1&&a.calcularDesaucio(e,!0)})}convertUrlToBase64Image("./img/finiquito.png",function(t){convertUrlToBase64Image("./img/finiquito2.png",function(n){var c=t,s=n,l=new PDFDocument({compress:!1,size:[612,936],margin:10}),d=198,p=l.pipe(blobStream());if(o){var u=new Date;e.fecha_retiro&&(u=new Date(e.fecha_retiro));var f=new Date(e.fecha_ingreso);a.tiempoTrabajado=duration(f,u),e.mes_uno=a.meses[e.mes_uno],e.mes_dos=a.meses[e.mes_dos],e.mes_tres=a.meses[e.mes_tres]}l.image(c,30,30,{fit:[572,876]}),l.font("Helvetica",10),l.fillColor("#4183C4"),d=a.usuario.empresa.razon_social.length>50?182:187,l.text(a.usuario.empresa.razon_social,280,d,{width:250}),d=a.usuario.empresa.direccion.length>29?206:211,l.text("Servicios",230,d,{width:170}),l.text(a.usuario.empresa.direccion,387,d,{width:170}),d=a.usuario.empresa.direccion.length>29?231:236,l.text(a.empleado.nombre_completo,280,d,{width:250}),a.empleado.direccion&&(d=a.empleado.direccion.length>24?255:260,l.text(a.empleado.direccion,453,d,{width:250})),l.text(a.empleado.estado,160,260,{width:250}),l.text(a.empleado.cargos.split(",")[0],220,280,{width:250});u=new Date;var m=new Date(a.empleado.fecha_nacimiento),h=a.diferenciaEntreDiasEnDias(m,u);h=Math.trunc(h/365),l.text(h+" años",325,260,{width:250}),l.text(a.empleado.ci+" "+a.empleado.extension,130,298,{width:250}),l.text(a.fechaATexto(e.fecha_ingreso),325,298,{width:250});var g=(new Date).getMonth(),b=(new Date).getFullYear();if(e.fecha_retiro&&(g=new Date(e.fecha_retiro).getMonth(),b=new Date(e.fecha_retiro).getFullYear(),e.tipo_beneficio&&l.text(a.fechaATexto(e.fecha_retiro),490,298,{width:250})),e.motivo?(d=e.motivo.nombre.length>18?315:320,l.text(e.motivo.nombre,178,d,{width:120})):l.text("QUINQUENIO",180,320,{width:250}),l.text(a.number_format(e.promedio,2),490,320,{width:250}),e.tipo_beneficio?(l.text(a.tiempoTrabajado.anios,195,343,{width:250}),l.text(a.tiempoTrabajado.meses,290,343,{width:250}),l.text(a.tiempoTrabajado.dias,400,343,{width:250})):l.text(5*e.numero_quinquenio,195,343,{width:250}),e.mes_uno.id>e.mes_tres.id)var v=b-1;else v=b;if(e.mes_dos.id>e.mes_tres.id)var _=b-1;else _=b;if(l.text(e.mes_uno.nombre.toUpperCase()+" "+v,210,403),l.text(e.mes_dos.nombre.toUpperCase()+" "+_,300,403),l.text(e.mes_tres.nombre.toUpperCase()+" "+b,390,403),l.text(a.number_format(e.primer_mes,2),225,421),l.text(a.number_format(e.segundo_mes,2),315,421),l.text(a.number_format(e.tercer_mes,2),405,421),l.text(a.number_format(e.promedio,2),500,421),l.text(a.number_format(e.promedio,2),500,551),e.tipo_beneficio){for(var D=0,E="",A=0,R=0;R<e.ingresos.length;R++){"Desahucio"===(M=e.ingresos[R]).motivo?l.text(a.number_format(e.total_desahucio,2),503,580):"indemnizacion años"===M.motivo?(e.numero_quinquenio=void 0!=e.numero_quinquenio?e.numero_quinquenio:0,l.text(a.tiempoTrabajado.anios-5*e.numero_quinquenio,325,600),l.text(a.number_format(M.monto,2),435,600),A+=M.monto):"indemnizacion meses"===M.motivo?(l.text(a.tiempoTrabajado.meses,325,620),l.text(a.number_format(M.monto,2),435,620),A+=M.monto):"indemnizacion dias"===M.motivo?(l.text(a.tiempoTrabajado.dias,325,638),l.text(a.number_format(M.monto,2),435,638),A+=M.monto,l.text(a.number_format(A,2),503,638)):"Vacacion"===M.motivo?(l.text(e.totalV,415,672),l.text(a.number_format(M.monto,2),503,672)):"Aguinaldo de navidad"===M.motivo?(l.text(e.mesesAguinaldo,325,654),l.text(e.diasAguinaldo,415,654),l.text(a.number_format(M.monto,2),503,654)):(D+=M.monto,E+=M.motivo+", "),R===e.ingresos.length-1&&(E.length>72?(E=E.substring(0,72),E+="..."):l.text(E,110,603),l.text(a.number_format(D,2),503,709))}if(l.text(a.number_format(e.total_ingresos,2),503,745),e.deducciones.length>0){d=777;for(R=0;R<e.deducciones.length;R++){var M=e.deducciones[R];l.text(a.number_format(M.monto,2),365,d),l.text(M.motivo,155,d),d+=18,e.total_ingresos=e.total_ingresos-M.monto,R===e.deducciones.length-1&&l.text(a.number_format(e.total_ingresos,2),503,885)}}else l.text(a.number_format(e.total_ingresos,2),503,885)}else l.text(a.number_format(5*e.numero_quinquenio,0),325,600),l.text(a.number_format(e.promedio,2),435,600),l.text(a.number_format(e.total_quinquenio,2),503,600),l.text(a.number_format(e.total_quinquenio,2),503,745),l.text(a.number_format(e.total_quinquenio,2),503,885);l.addPage({margin:0,size:[612,936],bufferPages:!0}),l.image(s,30,30,{fit:[572,876]}),l.font("Helvetica",10),l.fillColor("#4183C4"),l.text(a.empleado.nombre_completo,70,130),l.text(a.empleado.ci+" "+a.empleado.extension,215,148),e.tipo_beneficio?(l.text("                                                                         "+ConvertirALiteral(e.total_ingresos.toFixed(2)),50,73,{width:470,lineGap:8}),l.text("Bs. "+a.number_format(e.total_ingresos,2),220,167)):(l.text("                                                                         "+ConvertirALiteral(e.total_quinquenio.toFixed(2)),50,73,{width:470,lineGap:8}),l.text("Bs. "+a.number_format(e.total_quinquenio,2),220,167)),void 0==e.cuenta?l.text("X",215,53):(l.text("X",315,53),l.text(e.cuenta.numero,500,53)),l.text(a.usuario.empresa.departamento.nombre,155,240);var x=(new Date).getDate();l.text(x,255,240),l.text(a.meses[g].nombre.toUpperCase(),330,240);b=(new Date).getFullYear();l.text(b.toString().substr(-2),515,240),l.text(a.empleado.nombre_completo.toUpperCase(),65,325,{width:250,align:"center"}),l.text(e.empleado_cargo_impresion.toUpperCase(),320,325,{width:250,align:"center"}),l.fillColor("#000000"),l.text(e.cargo_imprecion.toUpperCase(),400,335),l.end(),p.on("finish",function(){var a=p.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),i&&a.paginator.getSearch(a.paginator.search,a.filtroBeneficioEmpresa,null),r.stop()})})};a.obtenerChoferesViaje=function(){Sa(a.usuario.id_empresa).then(function(e){a.choferesViaje=e})},a.CargarEmpleadosViaje=function(e){var o=0;a.tiposViaje.clases.forEach(function(i,t,n){"INGRESO"==i.nombre&&(o=i),t==n.length-1&&(a.viaje.empleadosEntrada=[],a.empleadosRolTurnoE.forEach(function(i,t,n){for(var r=0;r<a.tiposPasajerosViaje.length;r++){if("HABILITADO"==(h=a.tiposPasajerosViaje[r]).nombre&&(i.estado=h),r===a.tiposPasajerosViaje.length-1){i.habilitado=!0,i.tipoViaje=o,i.id_ficha=i.empleadosFichas[i.empleadosFichas.length-1].id;for(var c=0;c<i.empleadosFichas[i.empleadosFichas.length-1].rolesTurno.length;c++)for(var s=i.empleadosFichas[i.empleadosFichas.length-1].rolesTurno[c],l=a.fechaATexto(s.fecha_inicio),d=new Date(a.convertirFecha(l)),p=new Date(a.convertirFecha(e));d.getTime()<=p.getTime();){if(d.getTime()===p.getTime()){if(i.empleadosFichas[i.empleadosFichas.length-1].ausencias.length>0)for(var u=0;u<i.empleadosFichas[i.empleadosFichas.length-1].ausencias.length;u++){(g=i.empleadosFichas[i.empleadosFichas.length-1].ausencias[u]).fechas=getDates(new Date(g.fecha_inicio),new Date(g.fecha_fin));for(var f=0;f<g.fechas.length;f++){var m=new Date(a.convertirFecha(a.formatofecha(g.fechas[f])));if(p.getTime()===m.getTime()){for(r=0;r<a.tiposPasajerosViaje.length;r++){var h=a.tiposPasajerosViaje[r];g.horas?"OTRA AUSENCIA"==h.nombre&&(i.estado=h):"AUSENCIA MEDICA"==h.nombre&&(i.estado=h)}i.habilitado=!1}}}if(i.empleadosFichas[i.empleadosFichas.length-1].vacaciones.length>0)for(u=0;u<i.empleadosFichas[i.empleadosFichas.length-1].vacaciones.length;u++){var g;(g=i.empleadosFichas[i.empleadosFichas.length-1].vacaciones[u]).fechas=getDates(new Date(g.fecha_inicio),new Date(g.fecha_fin));for(f=0;f<g.fechas.length;f++){m=new Date(a.convertirFecha(a.formatofecha(g.fechas[f])));if(p.getTime()===m.getTime()){for(r=0;r<a.tiposPasajerosViaje.length;r++){"VACACION"==(h=a.tiposPasajerosViaje[r]).nombre&&(i.estado=h)}i.habilitado=!1}}}if(i.eliminado){for(r=0;r<a.tiposPasajerosViaje.length;r++){"INHABILITADO"==(h=a.tiposPasajerosViaje[r]).nombre&&(i.estado=h)}i.habilitado=!1}i.campo=i.empleadosFichas[i.empleadosFichas.length-1].rolesTurno[0].campo;var b=!1;a.viaje.destinos.forEach(function(o,t,n){s.campo.id==o.id&&(b=!0),t===n.length-1&&1==b&&(i.campo=Object.assign({},s.campo),s.fecha_fin?new Date(a.convertirFecha(e)).getTime()<new Date(s.fecha_fin).getTime()&&a.viaje.empleadosEntrada.push(Object.assign({},i)):a.viaje.empleadosEntrada.push(Object.assign({},i)))})}l=a.fechaATexto(a.sumaFecha(s.dias_trabajado+s.dias_descanso,a.convertirFecha(l))),d=new Date(a.convertirFecha(l))}}}t===n.length-1&&console.log(a.viaje.empleadosEntrada)}))})},a.localStorageSpace=function(){var a="";console.log("Current local storage: ");for(var e in window.localStorage)window.localStorage.hasOwnProperty(e)&&(a+=window.localStorage[e],console.log(e+" = "+(16*window.localStorage[e].length/8192).toFixed(2)+" KB"));console.log(a?"\nTotal space used: "+(16*a.length/8192).toFixed(2)+" KB":"Empty (0 KB)"),console.log(a?"Approx. space remaining: "+(5120-(16*a.length/8192).toFixed(2))+" KB":"5 MB")},a.CargarEmpleadosViajeSalida=function(e){a.viaje.empleadosSalida=[];var o=0;a.tiposViaje.clases.forEach(function(i,t,n){"SALIDA"==i.nombre&&(o=i),t==n.length-1&&a.empleadosRolTurnoE.forEach(function(i,t,n){for(var r=0;r<a.tiposPasajerosViaje.length;r++){"HABILITADO"==(v=a.tiposPasajerosViaje[r]).nombre&&(i.estado=v)}i.tipoViaje=o,i.id_ficha=i.empleadosFichas[i.empleadosFichas.length-1].id;for(var c=0;c<i.empleadosFichas[i.empleadosFichas.length-1].rolesTurno.length;c++)for(var s=i.empleadosFichas[i.empleadosFichas.length-1].rolesTurno[c],l=a.fechaATexto(s.fecha_inicio),d=new Date(a.convertirFecha(l)),p=new Date(a.convertirFecha(e)),u=0;d.getTime()<=p.getTime();){if(d.getTime()===p.getTime()){if(i.empleadosFichas[i.empleadosFichas.length-1].ausencias.length>0)for(var f=0;f<i.empleadosFichas[i.empleadosFichas.length-1].ausencias.length;f++){(g=i.empleadosFichas[i.empleadosFichas.length-1].ausencias[f]).fechas=getDates(new Date(g.fecha_inicio),new Date(g.fecha_fin));for(var m=0;m<g.fechas.length;m++){var h=new Date(a.convertirFecha(a.formatofecha(g.fechas[m])));if(p.getTime()===h.getTime()){for(r=0;r<a.tiposPasajerosViaje.length;r++){"AUSENCIA"==(v=a.tiposPasajerosViaje[r]).nombre&&(i.estado=v)}i.habilitado=!1}}}if(i.empleadosFichas[i.empleadosFichas.length-1].vacaciones.length>0)for(f=0;f<i.empleadosFichas[i.empleadosFichas.length-1].vacaciones.length;f++){var g;(g=i.empleadosFichas[i.empleadosFichas.length-1].vacaciones[f]).fechas=getDates(new Date(g.fecha_inicio),new Date(g.fecha_fin));for(m=0;m<g.fechas.length;m++){h=new Date(a.convertirFecha(a.formatofecha(g.fechas[m])));if(p.getTime()===h.getTime()){for(r=0;r<a.tiposPasajerosViaje.length;r++){"VACACION"==(v=a.tiposPasajerosViaje[r]).nombre&&(i.estado=v)}i.habilitado=!1}}}i.campo=i.empleadosFichas[i.empleadosFichas.length-1].rolesTurno[0].campo;var b=!1;if(i.eliminado){for(r=0;r<a.tiposPasajerosViaje.length;r++){var v;"INHABILITADO"==(v=a.tiposPasajerosViaje[r]).nombre&&(i.estado=v)}i.habilitado=!1}a.viaje.destinos.forEach(function(e,o,t){i.campo.id==e.id&&(b=!0),o===t.length-1&&1==b&&a.viaje.empleadosSalida.push(Object.assign({},i))})}l=0==u?a.fechaATexto(a.sumaFecha(s.dias_trabajado,a.convertirFecha(l))):a.fechaATexto(a.sumaFecha(s.dias_trabajado+s.dias_descanso,a.convertirFecha(l))),d=new Date(a.convertirFecha(l)),u++}t===n.length-1&&console.log(a.viaje.empleadosSalida)})})},a.CopiarEmpleadosViaje=function(){a.viaje.empleadosSalida=[],a.viaje.empleadosSalida=a.viaje.empleadosEntrada.map(function(a){return Object.assign({},a)}),a.viaje.empleadosSalida.forEach(function(e,o,i){for(var t=0;t<a.tiposViaje.clases.length;t++){var n=a.tiposViaje.clases[t];"SALIDA"==n.nombre&&(e.tipoViaje=n)}})},a.cambiarEstadoPasajero=function(e){e.activo=0==e.eliminado,e.fecha_inicio=e.empleadosFichas[e.empleadosFichas.length-1].fecha_inicio,e.nombre_completo=e.persona.nombre_completo,a.cerrarModalDesabilitarPasajero(),a.abriirmodelAusenciasVacas(e),"OTRA AUSENCIA"==e.estado.nombre&&$("#otra-ausencia").click(),"AUSENCIA MEDICA"==e.estado.nombre&&$("#ausencia-medica").click(),"VACACION"==e.estado.nombre&&$("vacacion").click()},a.realizarCalendarioTrabajo=function(o){var i=[];if(o){if(o.inicio)for(var t=new Date(a.convertirFecha(o.inicio)).getFullYear(),n=new Date(a.convertirFecha(o.fin)).getFullYear();t<=n;)i.push(t),t++}else i.push((new Date).getFullYear());a.diasAnio=a.CalendarioRolTurnos(i,o),a.diasAnioPieTrabajos=a.CalendarioRolTurnos(i,o),a.diasAnioPieAusencias=a.CalendarioRolTurnos(i,o),a.diasAnioPieVacaciones=a.CalendarioRolTurnos(i,o),a.empleadosRolTurno.forEach(function(t,n,r){t.diasAnio=a.CalendarioRolTurnos(i,o),n==r.length-1&&a.empleadosRolTurno.forEach(function(o,i,t){var n=o,r="";n.fecha_fin&&(r=a.fechaATexto(n.fecha_fin));for(var c=!1,s=1,l=0;l<o.diasAnio.length;l++){var d=o.diasAnio[l];d.fecha==a.fechaATexto(n.fecha_inicio)?c=!0:new Date(a.convertirFecha(d.fecha)).getFullYear()>new Date(n.fecha_inicio).getFullYear()&&new Date(a.convertirFecha(d.fecha)).getDate()>=new Date(n.fecha_inicio).getDate()&&(c=!0),c&&(s<=n.dias_trabajado?n.fecha_fin?(r==d.fecha?(l=o.diasAnio.length,d.texto="T"):d.texto="T",s++):(d.texto="T",s++):s<=n.dias_trabajado+n.dias_descanso&&(n.fecha_fin?(r==d.fecha?(l=o.diasAnio.length,d.texto="D"):d.texto="D",s===n.dias_trabajado+n.dias_descanso&&(s=0),s++):(d.texto="D",s===n.dias_trabajado+n.dias_descanso&&(s=0),s++)))}i==t.length-1&&a.empleadosRolTurno.forEach(function(o,i,t){for(var n=0;n<o.ficha.ausencias.length;n++){var r=o.ficha.ausencias[n];r.fechas=getDates(new Date(r.fecha_inicio),new Date(r.fecha_fin))}i==t.length-1&&a.empleadosRolTurno.forEach(function(o,i,t){for(var n=0;n<o.ficha.ausencias.length;n++)for(var r=o.ficha.ausencias[n],c=0;c<r.fechas.length;c++)for(var s=r.fechas[c],l=0;l<o.diasAnio.length;l++){var d=o.diasAnio[l];s==a.formatofecha(d.fecha)&&(d.mensaje=e.trustAsHtml(r.tipoAusencia.tipo.nombre+"<br> motivo:"+r.tipoAusencia.nombre),"D"==d.texto?r.horas?d.texto+="OA":d.texto+="BD":"T"==d.texto&&(r.horas?d.texto+="OA":d.texto+="BM"))}i==t.length-1&&a.empleadosRolTurno.forEach(function(o,i,t){for(var n=0;n<o.ficha.vacaciones.length;n++){var r=o.ficha.vacaciones[n];r.fechas=getDates(new Date(r.fecha_inicio),new Date(r.fecha_fin))}i==t.length-1&&a.empleadosRolTurno.forEach(function(o,i,t){for(var n=0;n<o.ficha.vacaciones.length;n++)for(var r=o.ficha.vacaciones[n],c=0;c<r.fechas.length;c++)for(var s=r.fechas[c],l=0;l<o.diasAnio.length;l++){var d=o.diasAnio[l];s==a.formatofecha(d.fecha)&&(d.mensaje=e.trustAsHtml("vacacion del <br>"+a.fechaATexto(r.fecha_inicio)+" al "+a.fechaATexto(r.fecha_fin)),d.texto,d.texto+="V")}i===t.length-1&&(a.diasAnioPieTrabajos.forEach(function(e,o,i){e.texto=parseInt(0);for(var t=0;t<a.empleadosRolTurno.length;t++)for(var n=a.empleadosRolTurno[t],r=0;r<n.diasAnio.length;r++){var c=n.diasAnio[r];e.fecha==c.fecha&&"T"==c.texto&&(e.texto+=1)}}),a.diasAnioPieAusencias.forEach(function(e,o,i){e.texto=parseInt(0);for(var t=0;t<a.empleadosRolTurno.length;t++)for(var n=a.empleadosRolTurno[t],r=0;r<n.diasAnio.length;r++){var c=n.diasAnio[r];e.fecha==c.fecha&&("A"!=c.texto&&"TBM"!=c.texto&&"DBD"!=c.texto||(e.texto+=1))}}),a.diasAnioPieVacaciones.forEach(function(e,o,i){e.texto=parseInt(0);for(var t=0;t<a.empleadosRolTurno.length;t++)for(var n=a.empleadosRolTurno[t],r=0;r<n.diasAnio.length;r++){var c=n.diasAnio[r];e.fecha==c.fecha&&("V"!=c.texto&&"TV"!=c.texto&&"DV"!=c.texto||(e.texto+=1))}i.length}))})})})})})})},a.CalendarioRolTurnos=function(e,o){a.mesesRolTurno=[];var i=[];if(o&&o.inicio){var t=new Date(a.convertirFecha(o.inicio)).getMonth(),n=new Date(a.convertirFecha(o.fin)).getMonth(),r=new Date(a.convertirFecha(o.inicio)).getDate(),c=new Date(a.convertirFecha(o.fin)).getDate();if(o.inicio2&&(t=new Date(a.convertirFecha(o.inicio2)).getMonth(),r=new Date(a.convertirFecha(o.inicio2)).getDate()),o.fin2)n=new Date(a.convertirFecha(o.fin2)).getMonth(),c=new Date(a.convertirFecha(o.fin2)).getDate()}for(var s=0;s<e.length;s++){var l=e[s];Object.assign([],a.meses).forEach(function(e,s,d){var p=Object.assign({},e);if(p.dias=[],p.anio=l,o&&o.inicio?p.id>t-1&&p.id<=n?p.visible=!0:p.visible=!1:p.visible=!0,a.mesesRolTurno.push(p),s===d.length-1)for(var u=1;u<366;u++){var f=a.fechaPorDia(l,u),m=(e=f.getMonth(),f.getDate()),h=(f.getDay(),{id:u,dia:m,visible:!0,texto:"",fecha:a.fechaATexto(f),mes:a.mesesRolTurno[e]});e==t?m>=r?i.push(h):(h.visible=!1,i.push(h)):e==n?m<=c?i.push(h):(h.visible=!1,i.push(h)):i.push(h);for(var g=0;g<a.mesesRolTurno.length;g++){var b=a.mesesRolTurno[g];b.anio==l&&b.id==e&&(b.id==t?m>=r&&b.dias.push(m):b.id==n?m<=c&&b.dias.push(m):b.dias.push(m))}}})}return i},a.guardarViaje=function(e){e.fecha=new Date,e.fecha_ingreso=new Date(a.convertirFecha(e.fecha_ingreso)),e.fecha_salida&&(e.fecha_salida=new Date(a.convertirFecha(e.fecha_salida))),Va(e,a.usuario.id_empresa).then(function(o){a.cerrarDialogViajes(),a.imprimirReporteViaje(e),a.mostrarMensaje(o.mensaje)})},a.listaViajesPasajero=function(){0!=a.paginator.filter.inicio&&(a.paginator.filter.inicio=new Date(a.convertirFecha(a.paginator.filter.inicio)),a.paginator.filter.fin=new Date(a.convertirFecha(a.paginator.filter.fin))),Fa(a.paginator).then(function(e){0!=a.paginator.filter.inicio&&(a.paginator.filter.inicio=a.fechaATexto(a.paginator.filter.inicio),a.paginator.filter.fin=a.fechaATexto(a.paginator.filter.fin)),a.paginator.setPages(e.paginas),a.viajesEmpresa=e.viajes})},a.listaViajes=function(){0!=a.paginator.filter.inicio&&(a.paginator.filter.inicio=new Date(a.convertirFecha(a.paginator.filter.inicio)),a.paginator.filter.fin=new Date(a.convertirFecha(a.paginator.filter.fin))),Oa(a.paginator).then(function(e){0!=a.paginator.filter.inicio&&(a.paginator.filter.inicio=a.fechaATexto(a.paginator.filter.inicio),a.paginator.filter.fin=a.fechaATexto(a.paginator.filter.fin)),a.paginator.setPages(e.paginas),a.viajesEmpresa=e.viajes})},a.obtenerViajesPasajeros=function(){a.paginator=d(),a.paginator.column="id",a.paginator.direccion="asc",a.filtroViaje={empresa:a.usuario.id_empresa,inicio:"",fin:"",tipoPasajero:"",destino:"",vehiculo:"",conductor:"",tipoViaje:""},a.paginator.callBack=a.listaViajesPasajero,a.paginator.getSearch("",a.filtroViaje,null)},a.obtenerViajes=function(){a.paginator=d(),a.paginator.column="id",a.paginator.direccion="asc",a.filtroViaje={empresa:a.usuario.id_empresa,inicio:"",fin:"",destino:"",vehiculo:"",conductor:"",relevo:""},a.paginator.callBack=a.listaViajes,a.paginator.getSearch("",a.filtroViaje,null)},a.imprimirDesteHistorialReporteVIaje=function(e){e.empleadosEntrada=[],e.empleadosSalida=[];var o=[],i=Object.assign([],e.destinos);e.destinos.forEach(function(t,n,r){o.push(t.destino),n===r.length-1&&(e.destinos=o,e.viajeDetalles.forEach(function(o,t,n){o.persona=o.ficha.empleado.persona,"INGRESO"==o.tipoViaje.nombre?e.empleadosEntrada.push(o):e.empleadosSalida.push(o),t===n.length-1&&(a.imprimirReporteViaje(e),e.destinos=i)}))})},a.imprimirReporteViaje=function(e){if(e.empleadosEntrada.length>0){var o=[],i=e.destinos.map(function(a){return Object.assign({},a)}),t=e.empleadosEntrada,n=" (Ingreso)";do{destinos2=i.slice(0,6),o.push(destinos2),i=i.slice(6,i.length)}while(i.length-1>6);i.length>0&&o.push(i),o.forEach(function(o,i,r){a.generarPdfViaje(e,t,o,n)})}if(e.empleadosSalida.length>0){o=[],i=e.destinos.map(function(a){return Object.assign({},a)}),t=e.empleadosSalida,n=" (Salida)";do{destinos2=i.slice(0,6),o.push(destinos2),i=i.slice(6,i.length)}while(i.length-1>6);i.length>0&&o.push(i),o.forEach(function(o,i,r){a.generarPdfViaje(e,t,o,n)})}},a.generarPdfViaje=function(e,o,i,t){i.forEach(function(n,r,c){(n.y=215,r===c.length-1)&&ObtenerImagen(a.usuario.empresa.imagen).then(function(n){var r=n,c=new PDFDocument({compress:!1,size:"letter",margin:10}),s=c.pipe(blobStream());a.dibujarCabeceraPDFViaje(c,e,1,r,i,t),c.font("Helvetica",5),itemsPorPagina=12,items=0,pagina=1;for(var l=0;l<o.length;l++)for(var d=35,p=o[l],u=0;u<i.length;u++){var f=i[u];i.length,p.campo.id===f.id&&(c.text(p.persona.nombre_completo,d,f.y,{width:91,align:"center"}),f.y+=10),d+=91}c.end(),s.on("finish",function(){var a=s.toBlobURL("application/pdf");window.open(a,"_blank","location=no")})})})},a.dibujarCabeceraPDFViaje=function(e,o,i,t,n,r){e.font("Helvetica-Bold",12),e.text("LISTA DE PASAJEROS",0,50,{align:"center"}),e.image(t,40,40,{fit:[80,80]}),e.rect(30,35,550,0).stroke(),e.rect(30,95,550,0).stroke(),e.rect(130,70,450,0).stroke(),e.rect(130,35,0,60).stroke(),e.rect(440,35,0,60).stroke(),e.rect(30,35,0,60).stroke(),e.rect(580,35,0,60).stroke(),e.font("Helvetica",10),e.text("Revición:",450,50),e.text("Fecha de aprobación:",450,72),e.text("Código .",0,75,{align:"center"}),e.font("Helvetica-Bold",10),e.rect(30,105,550,0).stroke(),e.text("Conductor 1:",35,110),e.text("licencia 1:",345,110),e.rect(30,120,550,0).stroke(),e.text("Conductor 2:",35,125),e.text("licencia 2:",345,125),e.rect(30,135,550,0).stroke(),e.text("Vehículo:",35,140),e.text("Placa:",345,140),e.rect(30,150,550,0).stroke(),e.text("Fecha:",35,160),e.font("Helvetica",10),e.text(o.conductor.nombre,135,110),e.text(o.relevo.nombre,135,125);var c=o.vehiculo.nombre.split("-");e.text(c[0],135,140),e.text(o.conductor.licencia+" "+o.conductor.tipoLicencia.nombre,415,110),e.text(o.relevo.licencia+" "+o.relevo.tipoLicencia.nombre,415,125),e.text(c[1],415,140),e.text(a.fechaATexto(o.fecha)+r,135,160),e.rect(30,105,0,45).stroke(),e.rect(115,105,0,45).stroke(),e.rect(340,105,0,45).stroke(),e.rect(410,105,0,45).stroke(),e.rect(580,105,0,45).stroke(),e.rect(30,170,550,590).stroke(),e.rect(30,190,550,0).stroke(),e.font("Helvetica-Bold",8),e.text("Campamentos",0,177,{align:"center"});var s=125,l=30,d=125;n.forEach(function(a,o,i){e.rect(s,190,0,570).stroke(),0==o?(e.text(a.nombre,l,195,{width:91,align:"center"}),e.rect(l,212,95,0).stroke()):(e.text(a.nombre,s-91,195,{width:91,align:"center"}),e.rect(d,212,91,0).stroke(),d+=91),s+=91,l+=95})},a.obtenerbeneficiosSocialesEmpresa=function(){a.paginator=d(),a.paginator.column="id",a.paginator.direccion="asc",a.filtroBeneficioEmpresa={empresa:a.usuario.id_empresa,inicio:"",fin:"",motivo:"",tipo:0},a.paginator.callBack=a.listaBeneficiosEmpresa,a.paginator.getSearch("",a.filtroBeneficioEmpresa,null)},a.listaBeneficiosEmpresa=function(){0!=a.paginator.filter.inicio&&(a.paginator.filter.inicio=new Date(a.convertirFecha(a.paginator.filter.inicio)),a.paginator.filter.fin=new Date(a.convertirFecha(a.paginator.filter.fin))),Na(a.paginator).then(function(e){0!=a.paginator.filter.inicio&&(a.paginator.filter.inicio=a.fechaATexto(a.paginator.filter.inicio),a.paginator.filter.fin=a.fechaATexto(a.paginator.filter.fin)),a.paginator.setPages(e.paginas),a.beneficiosEmpresa=e.beneficios})},a.imprimirReciboVacacion=function(e,o,i,t,n){ObtenerImagen(a.usuario.empresa.imagen).then(function(r){var c=new PDFDocument({compress:!1,size:"letter",margin:10}),s=c.pipe(blobStream()),l=new Date(e.createdAt),d=30,p=new Date;a.dibujarCabeceraPDFImpresionVacacion(c,e,r,d,o),c.font("Helvetica",10),c.text(a.fechaATexto(e.createdAt),80,d+80),c.text(o,90,d+110),c.text(a.fechaATexto(i),410,d+110);var u="";if(e.detalleDescuentosVacacionHistorial){for(var f=0;f<e.detalleDescuentosVacacionHistorial.length;f++){u=(m=e.detalleDescuentosVacacionHistorial[f]).historialVacacion.gestion+"-"+(m.historialVacacion.gestion+1)}e.detalleDescuentosVacacionHistorial.length>0&&c.text(e.detalleDescuentosVacacionHistorial[e.detalleDescuentosVacacionHistorial.length-1].historialVacacion.aplicadas-e.detalleDescuentosVacacionHistorial[e.detalleDescuentosVacacionHistorial.length-1].historialVacacion.tomadas+" días de la Gestion "+e.detalleDescuentosVacacionHistorial[e.detalleDescuentosVacacionHistorial.length-1].historialVacacion.gestion+"-"+(e.detalleDescuentosVacacionHistorial[e.detalleDescuentosVacacionHistorial.length-1].historialVacacion.gestion+1),430,d+140)}else c.text(n,430,d+140);void 0!=t?c.text(t,100,d+140):c.text(u,100,d+140),c.text(e.inicio_tipo?a.fechaATexto(e.fecha_inicio)+" (dia)":a.fechaATexto(e.fecha_inicio)+" (medio dia)",60,d+170),c.text(e.fin_tipo?a.fechaATexto(e.fecha_fin)+" (dia)":a.fechaATexto(e.fecha_fin)+" (medio dia)",370,d+170),c.text(e.dias+" días",70,d+200),c.text(e.domingos,305,d+200),void 0!=e.feriados?c.text(e.feriados,410,d+200):c.text(e.dias_descuento,410,d+200),c.text(e.observacion,40,d+260),c.font("Helvetica",5),c.text("EMISIÓN: "+l.getDate()+"/"+(l.getMonth()+1)+"/"+l.getFullYear(),200,375),c.text("IMPRESIÓN: "+p.getDate()+"/"+(p.getMonth()+1)+"/"+p.getFullYear(),260,375),c.text("USUARIO: "+a.usuario.persona.nombre_completo,40,375),c.font("Helvetica",8),c.rect(3,400,600,0).dash(1,{space:5}).stroke(),d=430,a.dibujarCabeceraPDFImpresionVacacion(c,e,r,430,o),c.font("Helvetica",10),c.text(a.fechaATexto(p),80,d+80),c.text(o,90,d+110),c.text(a.fechaATexto(i),410,d+110);u="";if(e.detalleDescuentosVacacionHistorial){for(f=0;f<e.detalleDescuentosVacacionHistorial.length;f++){var m;u=(m=e.detalleDescuentosVacacionHistorial[f]).historialVacacion.gestion+"-"+(m.historialVacacion.gestion+1)}e.detalleDescuentosVacacionHistorial.length>0&&c.text(e.detalleDescuentosVacacionHistorial[e.detalleDescuentosVacacionHistorial.length-1].historialVacacion.aplicadas-e.detalleDescuentosVacacionHistorial[e.detalleDescuentosVacacionHistorial.length-1].historialVacacion.tomadas+" días de la Gestion "+e.detalleDescuentosVacacionHistorial[e.detalleDescuentosVacacionHistorial.length-1].historialVacacion.gestion+"-"+(e.detalleDescuentosVacacionHistorial[e.detalleDescuentosVacacionHistorial.length-1].historialVacacion.gestion+1),430,d+140)}else c.text(n,430,d+140);void 0!=t?c.text(t,100,d+140):c.text(u,100,d+140),c.text(e.inicio_tipo?a.fechaATexto(e.fecha_inicio)+" (dia)":a.fechaATexto(e.fecha_inicio)+" (medio dia)",60,d+170),c.text(e.fin_tipo?a.fechaATexto(e.fecha_fin)+" (dia)":a.fechaATexto(e.fecha_fin)+" (medio dia)",370,d+170),c.text(e.dias+" días",70,d+200),c.text(e.domingos,305,d+200),void 0!=e.feriados?c.text(e.feriados,410,d+200):c.text(e.dias_descuento,410,d+200),c.text(e.observacion,40,d+260),c.font("Helvetica",5),c.text("EMISIÓN: "+l.getDate()+"/"+(l.getMonth()+1)+"/"+l.getFullYear(),200,775),c.text("IMPRESIÓN: "+p.getDate()+"/"+(p.getMonth()+1)+"/"+p.getFullYear(),260,775),c.text("USUARIO: "+a.usuario.persona.nombre_completo,40,775),c.end(),s.on("finish",function(){var a=s.toBlobURL("application/pdf");window.open(a,"_blank","location=no")})})},a.dibujarCabeceraPDFImpresionVacacion=function(a,e,o,i,t){a.font("Helvetica-Bold",16),a.text("BOLETA DE PERMISO",0,i,{align:"center"}),a.text("VACACIONES",0,i+30,{align:"center"}),a.rect(0,i+65,630,0).dash(0,{space:0}).stroke(),a.image(o,40,i-20,{fit:[80,80]}),a.font("Helvetica-Bold",10),a.text("Fecha:",40,i+80),a.text("Nombre:",40,i+110),a.text("F. Ingreso:",350,i+110),a.text("Gestiones:",40,i+140),a.text("Días restantes:",350,i+140),a.text("del:",40,i+170),a.text("Al:",350,i+170),a.text("Total:",40,i+200),a.text("OBSERVACIÓN",40,i+230),a.text("Domingos:",240,i+200),a.text("Feriados:",350,i+200),a.font("Helvetica",10),a.text(t,40,i+320),a.text("EMPLEADO",100,i+330),a.text("JEFE DE AREA",280,i+320),a.text("JEFE DE R.R.H.H.",440,i+320)},a.fechaPorDia=function(a,e){var o=new Date(a,0);return new Date(o.setDate(e))},a.generarPdfEstadoVacacionEmpresa=function(e,o){r.start();var i=new PDFDocument({size:"letter",margin:10}),t=i.pipe(blobStream()),n=120,c=0,s=Math.ceil(e.length/28);a.dibujarCabeceraPDFVacacionEmpresa(i,1,s,e,o),i.font("Helvetica",8);for(var l=0;l<e.length&&c<=28;l++){var d=e[l];i.text(d.ficha.empleado.persona.nombre_completo,45,n),i.text(a.fechaATexto(d.fecha_inicio),220,n,{width:50}),i.text(a.fechaATexto(d.fecha_fin),290,n,{width:60}),i.text(d.dias,370,n,{width:50}),i.text(d.observacion,420,n,{width:200}),n+=20,28==++c&&(i.addPage({margin:0,bufferPages:!0}),n=120,c=0,1,a.dibujarCabeceraPDFVacacionEmpresa(i,1,s,e,o),i.font("Helvetica",8))}i.font("Helvetica",5);var p=new Date,u=p.getMinutes();u<10&&(u="0"+u);new Date;i.text("IMPRESIÓN: "+a.fechaATexto(p)+" Hr. "+p.getHours()+":"+u,180,775),i.text("USUARIO: "+a.usuario.persona.nombre_completo,40,775),i.font("Helvetica-Bold",8),i.end(),t.on("finish",function(){var a=t.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),r.stop()},a.generarPdfHistorialVacacionEmpresa=function(e,o){r.start();var i=new PDFDocument({size:"letter",margin:10}),t=i.pipe(blobStream()),n=120,c=0,s=Math.ceil(e.length/28);a.dibujarCabeceraPDFHistorialVacacionEmpresa(i,1,s,e,o),i.font("Helvetica",8);for(var l=0;l<e.length;l++){var d=e[l];if(!d.ficha.fecha_expiracion){for(var p=0;p<d.ficha.historialVacaciones.length&&c<=28;p++){var u=d.ficha.historialVacaciones[p];i.text(d.ficha.empleado.persona.nombre_completo,45,n),i.text(u.aplicadas,250,n,{width:50}),i.text(u.tomadas,350,n,{width:60}),i.text(u.aplicadas-u.tomadas,450,n,{width:50}),n+=20,c++}28==c&&(i.addPage({margin:0,bufferPages:!0}),n=120,c=0,1,a.dibujarCabeceraPDFHistorialVacacionEmpresa(i,1,s,e,o),i.font("Helvetica",8))}}i.font("Helvetica",5);var f=new Date,m=f.getMinutes();m<10&&(m="0"+m);new Date;i.text("IMPRESIÓN: "+a.fechaATexto(f)+" Hr. "+f.getHours()+":"+m,180,775),i.text("USUARIO: "+a.usuario.persona.nombre_completo,40,775),i.font("Helvetica-Bold",8),i.end(),t.on("finish",function(){var a=t.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),r.stop()},a.generarExcelEstadoVacacionEmpresa=function(a){for(var e=[["","","REPORTE DE VACACIONES"],["Nombre","Desde","Hasta","Días","Observacion","Sabado","Gestión","Dias Rest.","Estado","Fecha Baja"]],o=0;o<a.length;o++){var i=[],t=a[o];if(!t.ficha.fecha_expiracion){i.push(t.ficha.empleado.persona.nombre_completo),i.push(new Date(t.fecha_inicio)),i.push(new Date(t.fecha_fin)),i.push(t.dias),i.push(t.observacion),i.push(t.sabado?"Si":"No");for(var n="",c=0;c<t.detalleDescuentosVacacionHistorial.length;c++){c>0&&(n+=", ");var s=t.detalleDescuentosVacacionHistorial[c],l=s.historialVacacion.gestion+1;n+=s.historialVacacion.gestion+"-"+l}i.push(n),i.push(t.diasRestantes),i.push(t.ficha.empleado.eliminado?"Incantivo":"Activo"),i.push(new Date(t.ficha.fecha_expiracion)),e.push(i)}}var d="SheetJS",p=new Workbook,u=sheet_from_array_of_arrays(e);p.SheetNames.push(d),p.Sheets[d]=u;var f=XLSX.write(p,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(f)],{type:"application/octet-stream"}),"REPORTE-VACACIONES.xlsx"),r.stop()},a.generarExcelHistorialVacacionEmpresa=function(a){for(var e=[["Nombre","Cargo","Campo","Gestión","Aplicadas","Todamas","Restantes"]],o=0;o<a.length;o++)for(var i=[],t=a[o],n=0;n<t.ficha.historialVacaciones.length;n++){i=[];var c=t.ficha.historialVacaciones[n];i.push(t.ficha.empleado.persona.nombre_completo);for(var s="",l=0;l<t.ficha.cargos.length;l++){var d=t.ficha.cargos[l];l>0&&(s+=", "),s+=d.cargo.nombre}i.push(s),i.push(t.ficha.empleado.campo.nombre);var p=c.gestion+1,u=c.gestion+"-"+p;i.push(u),i.push(c.aplicadas),i.push(c.tomadas),i.push(c.aplicadas-c.tomadas),e.push(i)}var f="SheetJS",m=new Workbook,h=sheet_from_array_of_arrays(e);m.SheetNames.push(f),m.Sheets[f]=h;var g=XLSX.write(m,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(g)],{type:"application/octet-stream"}),"REPORTE-VACACIONES-RESTANTES.xlsx"),r.stop()},a.dibujarCabeceraPDFVacacionEmpresa=function(e,o,i,t,n){e.font("Helvetica-Bold",12),e.text("REPORTE DE VACACIONES",0,25,{align:"center"}),n?(e.text(a.empleado.nombre_completo,0,45,{align:"center"}),e.text("PERIODO: TODOS",0,65,{align:"center"})):e.text("PERIODO: TODOS",0,45,{align:"center"}),e.font("Helvetica-Bold",8),e.text("NOMBRE",45,90),e.text("DESDE",220,90),e.text("HASTA",290,90),e.text("DÍAS",370,90),e.text("OBSERVACIÓN",420,90),e.font("Helvetica-Bold",8),e.text("PÁGINA "+o+" DE "+i,0,740,{align:"center"})},a.dibujarCabeceraPDFHistorialVacacionEmpresa=function(e,o,i,t,n){e.font("Helvetica-Bold",12),e.text("REPORTE DE VACACIONES RESTANTES",0,25,{align:"center"}),n?(e.text(a.empleado.nombre_completo,0,45,{align:"center"}),e.text("PERIODO: TODOS",0,65,{align:"center"})):e.text("PERIODO: TODOS",0,45,{align:"center"}),e.font("Helvetica-Bold",8),e.text("EMPLEADO",45,90),e.text("APLICADAS",250,90),e.text("TOMADAS",350,90),e.text("RESTANTES",450,90),e.font("Helvetica-Bold",8),e.text("PÁGINA "+o+" DE "+i,0,740,{align:"center"})},a.AgregarProrreteo=function(e){if(1==e)for(var o=(new Date).getFullYear(),i=(new Date).getMonth(),t=0;t<a.historialEmpresaVacacionesGestion.length;t++)for(var n=a.historialEmpresaVacacionesGestion[t],r=0;r<n.ficha.historialVacaciones.length;r++){var c=n.ficha.historialVacaciones[r];c.gestion==o&&(c.aplicadas=Math.round(c.aplicadas*i/12))}else{a.obtenerHistorialEmpresaVacacionGestion({})}},a.obtenerHistorialEmpresaVacacionGestion=function(e){var o={inicio:0,fin:0,estado:2};e.inicio&&(o.inicio=new Date(a.convertirFecha(e.inicio)),o.fin=new Date(a.convertirFecha(e.fin))),e.estado&&(o.estado=e.estado),ea(a.usuario.id_empresa,o).then(function(e){e.forEach(function(o,i,t){o.diasRestantes=0;for(var n=0;n<o.ficha.historialVacaciones.length;n++){var r=o.ficha.historialVacaciones[n];o.diasRestantes+=r.aplicadas-r.tomadas}i===t.length-1&&(a.historialEmpresaVacacionesGestion=e)})})},a.ReporteDehijos=function(e,o,i){La(a.usuario.id_empresa).then(function(t){var n=new Date,r=[];t.forEach(function(c,s,l){console.log("falta funcionalidad"),fechaNacimiento=new Date(c.persona.fecha_nacimiento);var d=a.diferenciaEntreDiasEnDias(fechaNacimiento,n);c.edad=Math.trunc(d/365),s===l.length-1&&t.forEach(function(t,n,c){i?t.edad>=e&&t.edad<=o?(r.push(t),n===c.length-1&&a.generarReproteHijos(r)):n===c.length-1&&a.generarReproteHijos(r):0==t.empleado.eliminado&&t.edad>=e&&t.edad<=o?(r.push(t),n===c.length-1&&a.generarReproteHijos(r)):n===c.length-1&&a.generarReproteHijos(r)})}),console.log(t)})},a.generarReproteHijos=function(a){for(var e=[["CODIGO","EMPLEADO","L_APORTE","DEPARTAMENTO","PROVINCIA","LOCALIDAD","RECIDENCIA","CAMPO","ESTADO","NOMBRES","APELLIDO PATERNO","APELLIDO MATERNO","FECHA_NAC","SEXO","EDAD","AFILIADO","RELACION"]],o=[],i=0;i<a.length;i++){var t=[];t.push(a[i].empleado.codigo),t.push(a[i].empleado.persona.nombre_completo),t.push(a[i].empleado.empleadosFichas[a[i].empleado.empleadosFichas.length-1].aporteSeguroLargoPlazo.nombre),t.push(a[i].empleado.persona.ciudad?a[i].empleado.persona.ciudad.nombre:""),t.push(a[i].empleado.persona.provincia?a[i].empleado.persona.provincia.nombre:""),t.push(a[i].empleado.persona.localidad?a[i].empleado.persona.localidad.nombre:""),t.push(a[i].empleado.persona.direccion_numero),t.push(a[i].empleado.campo.nombre),t.push(""),t.push(a[i].persona.nombres),t.push(a[i].persona.apellido_paterno),t.push(a[i].persona.apellido_materno),t.push(new Date(a[i].persona.fecha_nacimiento)),t.push(a[i].persona.genero.nombre),t.push(a[i].edad),t.push(null!=a[i].afiliado&&a[i].afiliado?"si":"no"),t.push(a[i].relacion.nombre),o.push(i),e.push(t)}var n="SheetJS",c=new Workbook,s=sheet_from_array_of_arrays(e);c.SheetNames.push(n),c.Sheets[n]=s;var l=XLSX.write(c,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(l)],{type:"application/octet-stream"}),"EMPLEADO RRHH.xlsx"),r.stop()},a.inicio()}]);