angular.module("agil.controladores").controller("ControladorDosificaciones",["$scope","$localStorage","$location","$templateCache","$route","blockUI","Dosificacion","Dosificaciones","DosificacionesEmpresa","ClasesTipo",function(i,o,a,c,n,e,r,t,s,d){i.idModalWizardDosificacionEdicion="modal-wizard-dosificacion-edicion",i.idModalWizardDosificacionVista="modal-wizard-dosificacion-vista",i.idModalEliminarDosificacion="dialog-eliminar-dosificacion",i.idModalContenedorDosificacionEdicion="modal-wizard-container-dosificacion-edicion",i.idModalContenedorDosificacionVista="modal-wizard-container-dosificacion-vista",i.usuario=JSON.parse(o.usuario),i.inicio=function(){i.obtenerDosificaciones(),i.obtenerPiesFactura(),setTimeout(function(){ejecutarScriptsTabla("tabla-dosificaciones",6)},2e3)},i.obtenerPiesFactura=function(){e.start(),d("PIÉFACT").then(function(o){i.piesFactura=o.clases,e.stop()})},i.obtenerDosificaciones=function(){e.start(),t(i.usuario.id_empresa).then(function(o){i.dosificaciones=o,e.stop()})},i.$on("$viewContentLoaded",function(){resaltarPestaña(a.path().substring(1)),ejecutarScriptsDosificacion(i.idModalWizardDosificacionEdicion,i.idModalWizardDosificacionVista,i.idModalEliminarDosificacion,i.idModalContenedorDosificacionEdicion,i.idModalContenedorDosificacionVista),i.buscarAplicacion(i.usuario.aplicacionesUsuario,a.path().substring(1)),e.stop()}),i.crearNuevaDosificacion=function(){var a=JSON.parse(o.usuario);i.dosificacion=new r({id_empresa:a.id_empresa}),i.abrirPopup(i.idModalWizardDosificacionEdicion)},i.verDosificacion=function(o){i.dosificacion=o,o.fecha_limite_emision=new Date(o.fecha_limite_emision),i.dosificacion.fechaTexto=o.fecha_limite_emision.getDate()+"/"+(o.fecha_limite_emision.getMonth()+1)+"/"+o.fecha_limite_emision.getFullYear(),i.abrirPopup(i.idModalWizardDosificacionVista)},i.cerrarPopPupVista=function(){i.cerrarPopup(i.idModalWizardDosificacionVista)},i.cerrarPopPupEdicion=function(){i.cerrarPopup(i.idModalWizardDosificacionEdicion)},i.modificarDosificacion=function(o){i.dosificacion=o,o.fecha_limite_emision=new Date(o.fecha_limite_emision),i.dosificacion.fechaTexto=o.fecha_limite_emision.getDate()+"/"+(o.fecha_limite_emision.getMonth()+1)+"/"+o.fecha_limite_emision.getFullYear(),i.abrirPopup(i.idModalWizardDosificacionEdicion)},i.mostrarConfirmacionEliminacion=function(o){i.dosificacion=new r(o),i.abrirPopup(i.idModalEliminarDosificacion)},i.cerrarConfirmacionEliminacion=function(){i.cerrarPopup(i.idModalEliminarDosificacion)},i.eliminarDosificacion=function(o){e.start(),i.cerrarConfirmacionEliminacion(),o.$delete(),i.mostrarMensaje("Eliminado exitosamente!"),i.recargarItemsTabla(),e.stop()},i.saveForm=function(o){"Siguiente"!=$("#siguiente").text().trim()&&(e.start(),o.fecha_limite_emision=new Date(i.convertirFecha(o.fechaTexto)),o.id?r.update({idDosificacion:o.id},o,function(o){e.stop(),i.cerrarPopPupEdicion(),i.mostrarMensaje("Actualizado Exitosamente!"),i.recargarItemsTabla()}):o.$save(function(o){e.stop(),i.dosificacion=new r({}),i.cerrarPopPupEdicion(),i.mostrarMensaje("Guardado Exitosamente!"),i.recargarItemsTabla()},function(o){e.stop(),i.cerrarPopPupEdicion(),i.mostrarMensaje("Ocurrio un problema al momento de guardar!"),i.recargarItemsTabla()}))},i.$on("$routeChangeStart",function(o,a){i.eliminarPopup(i.idModalWizardDosificacionEdicion),i.eliminarPopup(i.idModalWizardDosificacionVista),i.eliminarPopup(i.idModalEliminarDosificacion)}),i.inicio()}]);