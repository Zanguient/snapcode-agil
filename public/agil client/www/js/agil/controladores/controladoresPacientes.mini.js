angular.module("agil.controladores").controller("ControladorPacientes",["$scope","$sce","blockUI","$localStorage","$window","$location","$templateCache","$route","Usuario","Paginator","DatosPacientes","Paciente","$filter","PacientesPaginador","ListaDatosPrerequisito","CrearPrerequisito","Prerequisito","DatosPrerequisitoPaciente","ListaDatosGenero","Vacunas","ltsVacunas","PacienteVacuna","VacunasPaciente","asignacionPacienteVacuna","aplicacionPacienteVacuna","VacunasPacientedosis","CrearMedicoPacienteConsulta","ListaConsultasMedicoPaciente","CrearMedicoPacienteFicha","BuscarFichaPaciente","ListaDatosTiposControl","ActualizarPatologiaPaciente","ListaPrerequisitosEmpresa","ListaPrerequisitosPaciente","ActualizarPrerequisito","CrearLaboratorio","ListaLaboratorios","CrearLaboratorioExamen","ListaLaboratorioExamenes","CrearLaboratorioExamenResultado","LaboratorioExamenListaHistorial","CrearDiagnostico","ListaDiagnosticos","CrearDiagnosticoExamen","ListaDiagnosticoExamenes","DiagnosticoExamenListaHistorial","CrearDiagnosticoExamenResultado","PacientesEmpresa","ListaVacunasEmpresa","FichasTecnicasPacientes","SignosVitalesPacientes","SOAPlistaPacientes","aplicacionVacunasPacientes","obtenerPaciente","Comentario","FieldViewer","PacienteActivo","HistorialFichaMedicoPaciente","ActualizarLaboratorio","ActualizarLaboratorioExamen","ActualizarDiagnostico","ActualizarDiagnosticoExamen","Tipos","EliminarLaboratorio","EliminarLaboratorioExamen","EliminarDiagnosticoExamen","EliminarDiagnostico","Prerequisitos","PrerequisitoPaciente","ListaAlertasPrerequisitosPaciente","PrerequisitosHistorial","ListaAlertasVacunasEmpresa","Vacuna","ClasesTipo","ValidarCodigoCuentaEmpleado","$timeout","ClasesTipoEmpresa","PrerequisitosSave",function(a,i,e,o,n,t,r,c,s,l,u,d,f,p,g,m,v,D,h,P,M,b,_,V,A,E,x,w,q,C,I,S,F,T,L,R,H,N,j,O,y,Y,G,z,U,k,X,B,J,W,K,Q,Z,aa,ia,ea,oa,na,ta,ra,ca,sa,la,ua,da,fa,pa,ga,ma,va,Da,ha,Pa,Ma,ba,_a,Va,Aa){a.usuario=JSON.parse(o.usuario),a.idModalDialogVacunas="dialog-vacunas",a.idModalDialogConsulta="modal-wizard-consulta",a.idModalwizardContainerConsulta="modal-wizard-container-consulta",a.idModalDialogVacunasConfig="dialog-vacunas-config",a.idModalDialogVacunaEdicion="dialog-vacuna-nueva",a.idModalDialogFechaEntrega="dialog-fecha-entrega",a.IdModalDialogPreRequisitos="modal-preRequisitos",a.IdModalDialogLaboratorio="dialog-laboratorio",a.IdModalDialogGraficoSV="dialog-grafico",a.idModalDialogHistorico="dialog-previewHistorico",a.idModalFichaTecnica="modal-fichaMedica",a.idModalwizardContainerFichaTecnica="modal-wizard-container-ficha",a.IdModalDialogLaboratorioExamen="dialog-nuevo-examen",a.IdModalDialogLaboratorioExamenes="dialog-examenes",a.IdModalDialogLaboratorioExamenesNuevoResultado="dialog-nuevo-resultado",a.IdModalDialogLaboratorioExamenHistoricoPreview="dialog-previewHistorico",a.IdModalDialogLaboratorioExamenHistoricoResultado="dialog-historico-resultado",a.IdEntregaPrerequisito="dialog-entrega-preRequisito",a.idModalDialogPacienteNuevo="dialog-paciente-nuevo",a.idModalDialogPrerequisitoNuevo="dialog-pre-requisito-nuevo",a.idModalwizardContainerPaciente="modal-wizard-paciente-container",a.idModalHistorialPrerequisito="dialog-historico-preRequisito",a.idModalEditarPrerequisito="dialog-editar-preRequisito",a.idModalDialogHistorialVacuna="dialog-historial-vacuna",a.idModalDialogHistorialVacunaGeneral="dialog-historial-vacuna-general",a.idModalDialogDiagnosticos="dialog-diagnosticos",a.idModalDialogDiagnosticoNuevo="dialog-diagnostico-nuevo",a.idModalDialogExamenesDiagnostico="dialog-examenesDiagnostico",a.idModalDialogNuevoExamenDiagnostico="dialog-examenDiagnostico-nuevo",a.idModalDialogHistorialFicha="dialog-historico-ficha",a.idModalDialogCredencial="dialog-credencial",a.idModalDialogPatologias="dialog-patologias",a.idModalDialogComentario="dialog-editar-comentario",a.idModalAlertPrerequisitos="dialog-alertPre-requisitos",a.idModalDiasActivacionPrerequisitos="dialog-diasActivacion-Prerequisitos",a.idModalReprogramarPrerequisitos="dialog-reprogramar-prerequisito",a.idModalAlertVacunas="dialog-alertVacunas",a.idModalDiasActivacionVacunas="dialog-diasActivacion-Vacunas",a.idModalReprogramarVacunas="dialog-reprogramar-vacunas",a.idImagenUsuario="imagen-persona",a.idModalHistorialConsulta="dialog-historial-consulta",a.idModalWizardPacienteVista="dialog-paciente-vista",a.idModalContenedorPacienteVista="modal-wizard-container-paciente-vista",a.idModalEliminarPaciente="dialog-eliminar-paciente",a.IdModalDialogNuevoLaboratorio="dialog-nuevo-laboratorio",a.IdModalDialogDiagnosticoExamenHistoricoResultado="dialog-historico-resultado-diag",a.idModalDialogVerResultadosHistorialLab="dialog-ver-resultados-Examen",a.idModalDialogConfirmacionEntregaAdelantado="dialog-entrega-adelantada-prerequisito",a.idModalConceptoEdicion="dialog-conceptos",a.$on("$viewContentLoaded",function(){resaltarPestaña(t.path().substring(1)),ejecutarScriptsPacientes(a.idModalDialogVacunas,a.idModalDialogConsulta,a.idModalwizardContainerConsulta,a.idModalDialogVacunasConfig,a.idModalDialogVacunaEdicion,a.idModalDialogFechaEntrega,a.IdModalDialogPreRequisitos,a.IdModalDialogLaboratorio,a.IdModalDialogGraficoSV,a.idModalDialogHistorico,a.idModalFichaTecnica,a.idModalwizardContainerFichaTecnica,a.IdModalDialogLaboratorioExamen,a.IdModalDialogLaboratorioExamenes,a.IdModalDialogLaboratorioExamenesNuevoResultado,a.IdModalDialogLaboratorioExamenHistoricoPreview,a.IdModalDialogLaboratorioExamenHistoricoResultado,a.IdEntregaPrerequisito,a.idModalDialogPacienteNuevo,a.idModalDialogPrerequisitoNuevo,a.idModalwizardContainerPaciente,a.idModalHistorialPrerequisito,a.idModalEditarPrerequisito,a.idModalDialogHistorialVacuna,a.idModalDialogHistorialVacunaGeneral,a.idModalDialogDiagnosticos,a.idModalDialogDiagnosticoNuevo,a.idModalDialogExamenesDiagnostico,a.idModalDialogNuevoExamenDiagnostico,a.idModalDialogHistorialFicha,a.idModalDialogCredencial,a.idModalDialogPatologias,a.idModalDialogComentario,a.idModalAlertPrerequisitos,a.idModalDiasActivacionPrerequisitos,a.idModalReprogramarPrerequisitos,a.idModalAlertVacunas,a.idModalDiasActivacionVacunas,a.idModalReprogramarVacunas,a.idImagenUsuario,a.idModalHistorialConsulta,a.idModalWizardPacienteVista,a.idModalContenedorPacienteVista,a.idModalEliminarPaciente,a.IdModalDialogNuevoLaboratorio,a.IdModalDialogDiagnosticoExamenHistoricoResultado,a.idModalDialogVerResultadosHistorialLab,a.idModalDialogConfirmacionEntregaAdelantado,a.idModalConceptoEdicion),a.buscarAplicacion(a.usuario.aplicacionesUsuario,t.path().substring(1)),a.obtenerColumnasAplicacion()}),a.$on("$routeChangeStart",function(i,e){a.eliminarPopup(a.idModalEliminarPaciente),a.eliminarPopup(a.idModalDialogVacunas),a.eliminarPopup(a.idModalDialogConsulta),a.eliminarPopup(a.idModalDialogVacunasConfig),a.eliminarPopup(a.idModalDialogVacunaEdicion),a.eliminarPopup(a.idModalDialogFechaEntrega),a.eliminarPopup(a.IdModalDialogPreRequisitos),a.eliminarPopup(a.IdModalDialogLaboratorio),a.eliminarPopup(a.IdModalDialogGraficoSV),a.eliminarPopup(a.idModalDialogHistorico),a.eliminarPopup(a.idModalFichaTecnica),a.eliminarPopup(a.IdModalDialogLaboratorioExamen),a.eliminarPopup(a.IdModalDialogLaboratorioExamenes),a.eliminarPopup(a.IdModalDialogLaboratorioExamenesNuevoResultado),a.eliminarPopup(a.IdModalDialogLaboratorioExamenHistoricoResultado),a.eliminarPopup(a.IdEntregaPrerequisito),a.eliminarPopup(a.idModalDialogPacienteNuevo),a.eliminarPopup(a.idModalDialogPrerequisitoNuevo),a.eliminarPopup(a.idModalHistorialPrerequisito),a.eliminarPopup(a.idModalEditarPrerequisito),a.eliminarPopup(a.idModalDialogHistorialVacuna),a.eliminarPopup(a.idModalDialogHistorialVacunaGeneral),a.eliminarPopup(a.idModalDialogDiagnosticos),a.eliminarPopup(a.idModalDialogDiagnosticoNuevo),a.eliminarPopup(a.idModalDialogExamenesDiagnostico),a.eliminarPopup(a.idModalDialogNuevoExamenDiagnostico),a.eliminarPopup(a.idModalDialogHistorialFicha),a.eliminarPopup(a.idModalDialogCredencial),a.eliminarPopup(a.idModalDialogPatologias),a.eliminarPopup(a.idModalDialogComentario),a.eliminarPopup(a.idModalAlertPrerequisitos),a.eliminarPopup(a.idModalDiasActivacionPrerequisitos),a.eliminarPopup(a.idModalReprogramarPrerequisitos),a.eliminarPopup(a.idModalAlertVacunas),a.eliminarPopup(a.idModalDiasActivacionVacunas),a.eliminarPopup(a.idModalHistorialConsulta),a.eliminarPopup(a.idModalWizardPacienteVista),a.eliminarPopup(a.IdModalDialogNuevoLaboratorio),a.eliminarPopup(a.IdModalDialogDiagnosticoExamenHistoricoResultado),a.eliminarPopup(a.idModalDialogVerResultadosHistorialLab),a.eliminarPopup(a.idModalReprogramarVacunas),a.eliminarPopup(a.idModalDialogConfirmacionEntregaAdelantado),a.eliminarPopup(a.idModalConceptoEdicion)}),a.inicio=function(){a.obtenerAlertas(),e.start(),a.paginator={pages:[]},a.obtenerPacientes(),a.obtenerVacunas(),a.paciente={vacunas:[],cargos:[]},a.vacunas=[],a.vacuna={vacunaDosis:[]},a.vacunaDosis=[],a.requisitos={preRequisitos:[]},a.ficha={},a.dosis={tiempo:0,numero:0},a.obtenerExpeditos(),a.obtenerGenero(),a.obtenerTipoControl(),a.obtenerCargos(),a.examen={},a.filtroHistorialVacunas=[],a.filtroVacunas={inicio:"",fin:"",opcion:"todas"};var i=new Date;a.filtro.fechaAplicacionVacuna_texto=i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear(),e.stop(),a.dosisEdit=!1,a.fechaResultado=a.fechaATexto(new Date)},a.abrirDialogConceptoEdicion=function(i){a.tipo_edicion=i,a.clase={},a.abrirPopup(a.idModalConceptoEdicion)},a.cerrarDialogConceptoEdicion=function(){a.cerrarPopup(a.idModalConceptoEdicion)},a.agregarConceptoEdicion=function(i){i.nombre&&i.nombre_corto&&(-1==a.tipo_edicion.clases.indexOf(i)&&a.tipo_edicion.clases.push(i),a.clase={})},a.modificarConceptoEdicion=function(i){a.clase=i},a.removerConceptoEdicion=function(a){a.eliminado=!0},a.guardarConceptoEdicion=function(i){e.start(),la.update({id_tipo:i.id},i,function(o){Ma(i.nombre_corto).then(function(o){i=o,e.stop(),a.cerrarDialogConceptoEdicion(),a.mostrarMensaje("Guardado Exitosamente!")})})},a.obtenerExpeditos=function(){e.start(),Va("RRHH_EXP",a.usuario.id_empresa).then(function(i){a.expeditos=i,e.stop()})},a.obtenerCargos=function(){e.start(),Va("RRHH_CARGO",a.usuario.id_empresa).then(function(i){var o=i.clases;a.listaCargos=i,a.llenarCargos(o),e.stop()})},a.seleccionarCargos=function(i){if(i.length>0)for(var e=0;e<a.cargos.length;e++)for(var o=0;o<i.length;o++)a.cargos[e].id==i[o].id_cargo&&(a.cargos[e].ticked=!0)},a.llenarCargos=function(i){a.nuevoRH="",a.cargos=[];for(var e=0;e<i.length;e++){var o={nombre:i[e].nombre,maker:"",ticked:!1,id:i[e].id};a.cargos.push(o)}},a.imcCal=function(i){if(void 0!=i.talla&&void 0!=i.peso){if(i.talla>0&&i.peso>0){var e=i.talla/100*(i.talla/100);i.indice_masa=i.peso/e,i.indice_masa=i.indice_masa.toFixed(2)}a.ClasificacionIMC="",a.ColorIMC="",i.indice_masa<16&&(a.ClasificacionIMC="Infrapeso: Delgadez Severa"),i.indice_masa>=16&&i.indice_masa<17&&(a.ClasificacionIMC="Infrapeso: Delgadez moderada"),i.indice_masa>=17&&i.indice_masa<18.49&&(a.ClasificacionIMC="Infrapeso: Delgadez aceptable"),i.indice_masa>=18.5&&i.indice_masa<25&&(a.ClasificacionIMC="Peso Normal"),i.indice_masa>=25&&i.indice_masa<30&&(a.ClasificacionIMC="Sobrepeso"),i.indice_masa>=30&&i.indice_masa<35&&(a.ClasificacionIMC="Obeso: Tipo I"),i.indice_masa>=35&&i.indice_masa<40&&(a.ClasificacionIMC="Obeso: Tipo II"),i.indice_masa>=40&&(a.ClasificacionIMC="Obeso: Tipo III")}},a.obtenerColumnasAplicacion=function(){a.fieldViewer=ea({crear:!0,id_empresa:a.usuario.id_empresa,configuracion:{codigo:{value:"Codigo",show:!0},nombre:{value:"Nombre",show:!0},empresa:{value:"Empresa",show:!0},imagen:{value:"Imagen",show:!0},ci:{value:"CI",show:!0},extension:{value:"Extension",show:!0},grupo_sanguineo:{value:"Grupo Sang.",show:!0},campo:{value:"Campo",show:!0},cargo:{value:"Cargo",show:!0}}},a.aplicacion.aplicacion.id),a.fieldViewer.updateObject()},a.fechaATexto=function(a){return fech=new Date(a),a=fech.getDate()+"/"+(fech.getMonth()+1)+"/"+fech.getFullYear()},a.agregarDosisVacuna=function(i){e.start(),void 0!=i.id||null!=i.id?(indx=a.vacunaDosis.indexOf(i),i.es_dosis=null!=i.es_dosis&&void 0!=i.es_dosis&&i.es_dosis,i.unico=null!==i.unico&&void 0!==i.unico&&i.unico,i.numero=indx,a.vacunaDosis[indx]=i):(i.es_dosis=null!=i.es_dosis&&void 0!=i.es_dosis&&i.es_dosis,i.unico=null!==i.unico&&void 0!==i.unico&&i.unico,i.numero=a.vacunaDosis.length+1,a.vacunaDosis.push(i),console.log("añadiendo dosis"),console.log(i)),a.vacunaDosis.length>1&&(i.unico=!1),a.dosis={},e.stop()},a.agregarDosisEditada=function(i){a.vacunaDosis.length>1&&(i.unico=!1),a.vacunaDosis[i.index]=i,a.dosis={},a.dosisEdit=!1},a.eliminarDosis=function(i){if(void 0===i.id)a.vacunaDosis.splice(a.vacunaDosis.indexOf(i),1);else{var e=a.vacunaDosis.indexOf(i);a.vacunaDosis[e].eliminado=!0,a.vacunaDosis[e].eliminar=!0}},a.editarLaDosis=function(i){a.dosis=i,a.dosisEdit=!0},a.asignarVacunas=function(){a.paciente.eliminado?(e.start(),a.vacunas.forEach(function(i){i.asignada=null!==i.asignada&&void 0!==i.asignada&&i.asignada;var e=!1,o={};if(a.paciente.vacunas.forEach(function(a){a.id_vacuna==i.id&&(e=!0,o=a)},this),e)V.update({id:o.id,asignar:i.asignada},o,function(i){_(a.paciente).then(function(i){a.paciente.vacunas=i})},function(i){a.mostrarMensaje("Ocurrio un problema al momento de actualizar la asignación de la vacuna!")});else if(i.asignada){var n=new Date;i.vacunaDosis.length>1&&(i.vacunaDosis[1].es_dosis?n.setTime(n.getTime()+864e5*i.vacunaDosis[1].tiempo):n.setTime(n.getTime()+30*i.vacunaDosis[1].tiempo*864e5)),new V({id_paciente:a.paciente.id,id_vacuna:i.id,siguiente_aplicacion:n}).$save(function(i){_(a.paciente).then(function(i){a.paciente.vacunas=i})},function(i){a.mostrarMensaje("Ocurrio un problema al momento de asignar la vacuna!")})}},this)):a.mostrarMensaje("No se puede asignar vacuna a un paciente inactivo!"),a.cerrarPopUpVacunasConfig(),e.stop()},a.obtenerVacunas=function(){M().then(function(i){a.vacunas=i})},a.limpiarAsignacionVacunas=function(){e.start(),a.vacunas.forEach(function(a){a.asignada=!1},this),e.stop()},a.verificarAsignacionVacunas=function(){e.start(),a.paciente.vacunas.length>0&&a.paciente.vacunas.forEach(function(i){for(var e=0;e<a.vacunas.length;e++)i.id_vacuna!=a.vacunas[e].id||i.eliminado||(a.vacunas[e].asignada=!0)},this),e.stop()},a.evaluarFechaDosisVacuna=function(i){if(e.start(),a.vacuna=i,void 0!=a.vacuna.pacienteVacunaDosis[0])if(void 0==a.vacuna.alreadyProyected){if(1==a.vacuna.pacienteVacuna.vacunaDosis.length&&a.vacuna.pacienteVacuna.vacunaDosis[0].unico)return a.vacuna.pacienteVacunaDosis[0].visible=!0,a.vacuna.pacienteVacunaDosis[0].retrasada=!1,a.vacuna.alreadyProyected=!0,a.vacuna.pacienteVacunaDosis[0].fechaCorta=a.fechaATexto(new Date(a.vacuna.pacienteVacunaDosis[0].fecha_aplicacion)),void e.stop();if(1==a.vacuna.pacienteVacuna.vacunaDosis.length&&!a.vacuna.pacienteVacuna.vacunaDosis[0].unico){a.vacuna.pacienteVacunaDosis.forEach(function(i,e,o){if(0==e)i.retrasada=!1,i.visible=!0,i.fechaCorta=a.fechaATexto(new Date(i.fecha_aplicacion));else{var n=new Date(a.vacuna.pacienteVacunaDosis[e-1].fecha_aplicacion).getTime();if(a.vacuna.pacienteVacuna.vacunaDosis[0].es_dosis)var t=new Date((new Date).setTime(n+864e5*a.vacuna.pacienteVacuna.vacunaDosis[0].tiempo));else t=new Date((new Date).setTime(864e5*(n+30*a.vacuna.pacienteVacuna.vacunaDosis[0].tiempo)));t.setHours(12,0,0,0);var r=new Date(i.fecha_aplicacion);r.setHours(12,0,0,0),r.getTime()<=t.getTime()?i.retrasada=!1:i.retrasada=!0,i.visible=!0,i.fechaCorta=a.fechaATexto(new Date(i.fecha_aplicacion))}});var o={retrasada:!1,id_paciente_vacuna:a.vacuna.id_paciente,fecha_aplicacion:new Date(a.vacuna.fecha_siguiente_aplicacion),proyectada:!0,visible:!0,fechaCorta:a.fechaATexto(new Date(a.vacuna.fecha_siguiente_aplicacion)),eliminado:!1};a.vacuna.pacienteVacunaDosis.push(o),a.vacuna.alreadyProyected=!0}if(a.vacuna.pacienteVacuna.vacunaDosis.length>1){for(a.vacuna.pacienteVacunaDosis.forEach(function(i,e,o){if(0==e)i.retrasada=!1,i.visible=!0,i.fechaCorta=a.fechaATexto(new Date(i.fecha_aplicacion));else{var n=new Date(a.vacuna.pacienteVacunaDosis[e-1].fecha_aplicacion).getTime();if(a.vacuna.pacienteVacuna.vacunaDosis[0].es_dosis)var t=new Date((new Date).setTime(n+864e5*a.vacuna.pacienteVacuna.vacunaDosis[e].tiempo));else t=new Date((new Date).setTime(864e5*(n+30*a.vacuna.pacienteVacuna.vacunaDosis[e].tiempo)));t.setHours(12,0,0,0);var r=new Date(i.fecha_aplicacion);r.setHours(12,0,0,0),r.getTime()<=t.getTime()?i.retrasada=!1:i.retrasada=!0,i.visible=!0,i.fechaCorta=a.fechaATexto(new Date(i.fecha_aplicacion))}});a.vacuna.pacienteVacunaDosis.length<a.vacuna.pacienteVacuna.vacunaDosis.length;){o={retrasada:!1,id_paciente_vacuna:a.vacuna.id_paciente,fecha_aplicacion:new Date,proyectada:!0,visible:!0,fechaCorta:a.fechaATexto(new Date),eliminado:!1};a.vacuna.pacienteVacuna.vacunaDosis[a.vacuna.pacienteVacunaDosis.length].es_dosis?o.fecha_aplicacion=new Date((new Date).setTime(new Date(a.vacuna.pacienteVacunaDosis[a.vacuna.pacienteVacunaDosis.length-1].fecha_aplicacion).getTime()+864e5*a.vacuna.pacienteVacuna.vacunaDosis[a.vacuna.pacienteVacunaDosis.length].tiempo)):o.fecha_aplicacion=new Date((new Date).setTime(new Date(a.vacuna.pacienteVacunaDosis[a.vacuna.pacienteVacunaDosis.length-1].fecha_aplicacion).getTime()+30*a.vacuna.pacienteVacuna.vacunaDosis[a.vacuna.pacienteVacunaDosis.length].tiempo*864e5)),o.fechaCorta=a.fechaATexto(o.fecha_aplicacion),a.vacuna.pacienteVacunaDosis.push(o),a.vacuna.alreadyProyected=!0}return void e.stop()}e.stop()}else e.stop();else e.stop()},a.validarDatosVacuna=function(i){return!(a.vacunaDosis.length>0&&""!=i.nombre)},a.editarVacuna=function(i,o){if(e.start(),i){var n=!1;a.vacuna=o,a.vacuna.vacunaDosis=a.vacunaDosis,a.vacunaDosis.length>1&&a.vacunaDosis.forEach(function(i,e,o){i.unico&&(n=!0,i.unico=!1),e==o.length-1&&n&&a.mostrarMensaje("No se puede guardar una dosis única en un conjunto de dosis!")}),o.id||n?n||P.update({id:o.id},o,function(i){a.mostrarMensaje(i.mensaje),e.stop()},function(i){a.mostrarMensaje("Ocurrio un problema al momento de guardar!"),e.stop()}):o.$save(function(i){a.mostrarMensaje(i.mensaje),e.stop()},function(i){a.mostrarMensaje("Ocurrio un problema al momento de guardar!"),e.stop()}),a.vacunaDosis=[],a.cerrarPopUpVacunaNueva()}else a.mostrarMensaje("Complete los campos requeridos!")},a.obtenerPrerequisitos=function(){e.start(),ga().then(function(i){a.preRequisitos=i.prerequisitos,e.stop()})},a.obtenerGenero=function(){e.start(),a.generos=[],h().then(function(i){i.forEach(function(i){a.generos.push(i)},this),e.stop()})},a.obtenerPacientes=function(){e.start(),a.paginator=l(),a.paginator.column="codigo",a.paginator.direccion="asc",a.filtro={empresa:a.usuario.id_empresa,codigo:"",nombres:"",ci:"",campo:"",cargo:"",busquedaEmpresa:"",estado:"",grupo_sanguineo:""},a.paginator.callBack=a.buscarPacientes,a.paginator.getSearch("",a.filtro,null),e.stop()},a.buscarPacientes=function(){e.start(),p(a.paginator).then(function(i){if(a.paginator.setPages(i.paginas),a.dynamicPopoverCargos={templateUrl:"myPopoverTemplate.html"},i.pacientes.length>0)if(i.fichas.length>0)for(var o=0;o<i.fichas.length;o++){var n=i.fichas[o];null!=n?i.pacientes.forEach(function(e,o,t){e.eliminado=0==e.activo,e.ficha=e.id==n.id_empleado?n:e.ficha,o===t.length-1&&(a.pacientes=i.pacientes)}):o===i.fichas.length-1&&i.pacientes.forEach(function(e,o,n){e.eliminado=0==e.activo,o===n.length-1&&(a.pacientes=i.pacientes)})}else i.pacientes.forEach(function(e,o,n){e.eliminado=0==e.activo,o===n.length-1&&(a.pacientes=i.pacientes)});else a.pacientes=i.pacientes;e.stop()})},a.guardarFichaTecnica=function(i,e){i&&("Siguiente"!=$("#siguiente-f").text().trim()&&(e.fecha_elaboracion=new Date(a.convertirFecha(e.fecha_elaboracion)),q(e).then(function(i){a.cerrarPopUpIdModalFichaTecnica(),a.recargarItemsTabla(),a.mostrarMensaje(i.message)})))},a.guardarFichaTecnicaExistente=function(i,e){i?(e.fecha_elaboracion=new Date(a.convertirFecha(e.fecha_elaboracion)),q(e).then(function(i){a.cerrarPopUpIdModalFichaTecnica(),a.recargarItemsTabla(),a.mostrarMensaje(i.message)})):a.mostrarMensaje("Faltan datos!")},a.aplicarVacuna=function(i,o){if(void 0!=o&&(o.activo=o.eliminado,a.paciente=o),e.start(),!a.paciente.eliminado)return a.mostrarMensaje("No se puede aplicar vacuna a un paciente inactivo!"),void e.stop();var n=new Date;n.setHours(12,0,0,0);var t=void 0!=i.fechaAplicacionVacuna_texto?new Date(a.convertirFecha(i.fechaAplicacionVacuna_texto)):new Date;t.setHours(12,0,0,0);var r=0,c=[];if(i.pacienteVacunaDosis.forEach(function(a){void 0===a.proyectada&&c.push(new Date(a.fecha_aplicacion))}),0==c.length)i.fecha_ultima_aplicacion=t,i.pacienteVacuna.vacunaDosis.length>1?i.pacienteVacuna.vacunaDosis[1].es_dosis?(i.fecha_siguiente_aplicacion=new Date((new Date).setTime(t.getTime()+864e5*i.pacienteVacuna.vacunaDosis[1].tiempo)),i.fecha_siguiente_aplicacion_texto=a.fechaATexto(i.fecha_siguiente_aplicacion)):(i.fecha_siguiente_aplicacion=new Date((new Date).setTime(t.getTime()+30*i.pacienteVacuna.vacunaDosis[1].tiempo*864e5)),i.fecha_siguiente_aplicacion_texto=a.fechaATexto(i.fecha_siguiente_aplicacion)):i.pacienteVacuna.vacunaDosis[0].es_dosis?(i.fecha_siguiente_aplicacion=new Date((new Date).setTime(t.getTime()+864e5*i.pacienteVacuna.vacunaDosis[r].tiempo)),i.fecha_siguiente_aplicacion_texto=a.fechaATexto(i.fecha_siguiente_aplicacion)):(i.fecha_siguiente_aplicacion=new Date((new Date).setTime(t.getTime()+30*i.pacienteVacuna.vacunaDosis[r].tiempo*864e5)),i.fecha_siguiente_aplicacion_texto=a.fechaATexto(i.fecha_siguiente_aplicacion));else{if(t<new Date(Math.max.apply(null,c)))return a.mostrarMensaje("No se puede aplicar en una fecha anterior a la ultima aplicación!"),void e.stop();if(i.pacienteVacuna.vacunaDosis.length>1){if(r=i.pacienteVacunaDosis.length,void 0==i.pacienteVacuna.vacunaDosis[r])return void a.mostrarMensaje("No se puede aplicar, excede el número de dosis aplicables!");i.fecha_ultima_aplicacion=t,i.pacienteVacuna.vacunaDosis[r].es_dosis?(i.fecha_siguiente_aplicacion=new Date((new Date).setTime(t.getTime()+864e5*i.pacienteVacuna.vacunaDosis[r].tiempo)),i.fecha_siguiente_aplicacion_texto=a.fechaATexto(i.fecha_siguiente_aplicacion)):(i.fecha_siguiente_aplicacion=new Date((new Date).setTime(t.getTime()+30*i.pacienteVacuna.vacunaDosis[r].tiempo*864e5)),i.fecha_siguiente_aplicacion_texto=a.fechaATexto(i.fecha_siguiente_aplicacion))}else i.fecha_ultima_aplicacion=t,i.pacienteVacuna.vacunaDosis[0].es_dosis?(i.fecha_siguiente_aplicacion=new Date((new Date).setTime(t.getTime()+864e5*i.pacienteVacuna.vacunaDosis[0].tiempo)),i.fecha_siguiente_aplicacion_texto=a.fechaATexto(i.fecha_siguiente_aplicacion)):(i.fecha_siguiente_aplicacion=new Date((new Date).setTime(t.getTime()+30*i.pacienteVacuna.vacunaDosis[0].tiempo*864e5)),i.fecha_siguiente_aplicacion_texto=a.fechaATexto(i.fecha_siguiente_aplicacion))}A.update({id:i.id},i,function(i){_(a.paciente).then(function(i){a.paciente.vacunas=i,a.inicializarFechaAplicacionVacuna(),e.stop()}),a.mostrarMensaje(i.mensaje)},function(i){a.mostrarMensaje("Se produjo un error"),e.stop()}),a.fechaATexto(n)!=a.fechaATexto(t)||(a.mostrarMensaje("La fecha de aplicación y la fecha actual son diferentes, vacuna aplicada de todas formas!"),e.stop()),a.obtenerAlertas()},a.inicializarFechaAplicacionVacuna=function(){a.paciente.vacunas.forEach(function(i,e,o){var n=new Date;i.fechaAplicacionVacuna_texto=n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear(),e===o.length-1&&a.obtenerAlertas()})},a.button_clicked=!1,a.disableImput=function(i){aplicarDatePickers();var e=0;i.pacienteVacunaDosis.forEach(function(a){a.proyectada||(e+=1)},this),i.button_clicked?(1!=i.pacienteVacuna.vacunaDosis.length||i.pacienteVacuna.vacunaDosis[0].unico?e<i.pacienteVacuna.vacunaDosis.length?a.aplicarVacuna(i):a.mostrarMensaje("No se puede aplicar la vacuna, excede la cantidad de dosis"):a.aplicarVacuna(i),i.button_clicked=!1):i.button_clicked=!0},a.dosisText="Mes(es)",a.textoDosis=function(i){a.dosisText=i?"Día(s)":"Mes(es)"},a.imprimirCredencial=function(){html2canvas(document.getElementsByClassName("PrintCredencial"),{allowTaint:!0,onrendered:function(a){var i=window.open("","Credencial","width=1100,height=1000");i.document.body.appendChild(a),i.focus(),i.print()}})},a.DatosSV=[{type:"line",showInLegend:!0,lineThickness:2,name:"PrecionS",color:"#F08080",dataPoints:[]},{type:"line",showInLegend:!0,lineThickness:2,name:"Pulso",color:"#EC11B0",dataPoints:[]},{type:"line",showInLegend:!0,lineThickness:2,name:"Talla",color:"#11EC2B",dataPoints:[]},{type:"line",showInLegend:!0,lineThickness:2,name:"Temperatura",color:"#48B5DF",dataPoints:[]},{type:"line",showInLegend:!0,lineThickness:2,name:"Frecuencia Respiratoria",color:"#DF488A",dataPoints:[]},{type:"line",showInLegend:!0,lineThickness:2,name:"Frecuencia cardiaca",color:"#CCDF48",dataPoints:[]},{type:"line",showInLegend:!0,lineThickness:2,name:"indice de masa corporal",color:"#48DFD3",dataPoints:[]}],a.selection=[],a.chart=new CanvasJS.Chart("chartContainer",{title:{text:"GRAFICA - SIGNOS VITALES",fontSize:22},legend:{horizontalAlign:"right",verticalAlign:"center",fontSize:14},animationEnabled:!0,exportEnabled:!0,width:1100,axisX:{gridColor:"Silver",tickColor:"silver",valueFormatString:"DD/MM/YY",titleFontSize:8},theme:"theme1",axisY:{gridColor:"Silver",tickColor:"silver"},data:a.selection}),a.chart.render(),a.toggleSelection=function(i){var e=a.selection.map(function(a){return a.name}).indexOf(i.name);e>-1?(a.selection.splice(e,1),a.chart.render(),a.chart.destroy()):(a.selection.push(i),a.chart.render(),a.chart.destroy())},a.checkAll=function(i){a.selection.length=0,angular.forEach(a.DatosSV,function(e){e.selected=i.target.checked,e.selected?(a.selection.push(e),a.chart.render(),a.chart.destroy()):(a.selection.splice(0,1),a.chart.render(),a.chart.destroy())})},a.abrirIdModalDialogLaboratorioExamenesNuevoResultado=function(i,e){a.examen={},i&&(a.examen=i),a.examen.soloVista=!!e,a.abrirPopup(a.IdModalDialogLaboratorioExamenesNuevoResultado),a.fechaResultado=a.fechaATexto(new Date)},a.abrirIdModalDialogLaboratorioExamenesHistoricoResultados=function(){filtro={inicio:0,fin:0},a.ObtenerHistorialLaboratorioExamenes(filtro),a.abrirPopup(a.IdModalDialogLaboratorioExamenHistoricoResultado)},a.abrirIdModalDialogDiagnosticoExamenesHistoricoResultados=function(){filtro={inicio:0,fin:0},a.ObtenerHistorialDiagnosticoExamenes(filtro),a.abrirPopup(a.IdModalDialogDiagnosticoExamenHistoricoResultado)},a.abrirIdModalDialogNuevoLaboratorio=function(i,e){a.laboratorio={},i&&(a.laboratorio=i),a.laboratorio.soloVista=!!e,a.abrirPopup(a.IdModalDialogNuevoLaboratorio)},a.abrirIdModalDialogLaboratorioExamenesHistorico=function(){a.abrirPopup(a.IdModalDialogLaboratorioExamenHistoricoPreview)},a.abrirIdModalDialogLaboratorioExamenes=function(i){a.laboratorio=i,a.ObtenerMedicoLaboratorioExamenes(i),a.abrirPopup(a.IdModalDialogLaboratorioExamenes)},a.abrirIdModalFichaTecnica=function(i){a.paciente=i,a.buscarfichaPaciente(i),a.abrirPopup(a.idModalFichaTecnica)},a.buscarfichaPaciente=function(i){e.start(),C(i.id).then(function(i){if(i.ficha){a.ficha=i.ficha;var o=new Date,n=new Date(a.ficha.paciente.persona.fecha_nacimiento),t=new Date(i.ficha.fecha);a.ficha.fecha_elaboracion=t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear();var r=a.diferenciaEntreDiasEnDias(n,o);a.ficha.edad=Math.trunc(r/365),a.ficha.edad,a.mostarGuardarFicha=!0}else{a.mostarGuardarFicha=!1,a.ficha={paciente:i.paciente,pacienteReferencia:{}};o=new Date,n=new Date(a.ficha.paciente.persona.fecha_nacimiento),r=a.diferenciaEntreDiasEnDias(n,o);a.ficha.edad=Math.trunc(r/365)}e.stop()})},a.obtenerTipoControl=function(){e.start(),I().then(function(i){a.tiposControl=i,e.stop()})},a.diferenciaEntreDiasEnDias=function(a,i){var e=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),o=Date.UTC(i.getFullYear(),i.getMonth(),i.getDate());return Math.floor((o-e)/864e5)},a.obtenerDatosPrerequisito=function(i,o){e.start(),void 0!=o.inicio&&0!=o.inicio&&""!=o.inicio?a.filtro.inicio=o.inicio instanceof Date?o.inicio:new Date(a.convertirFecha(o.inicio)):a.filtro.inicio=0,void 0!=o.fin&&0!=o.fin&&""!=o.fin?a.filtro.fin=o.fin instanceof Date?o.fin:new Date(a.convertirFecha(o.fin)):a.filtro.fin=0,T(i.id,a.filtro).then(function(i){a.prerequisitosPaciente=i.Prerequisitos,a.prerequisitosPaciente.forEach(function(a){null!=a.fecha_entrega&&(a.entregado=!0)}),console.log(a.prerequisitosPaciente),a.filtro.inicio=a.filtro.inicio instanceof Date?a.filtro.inicio.getDate()+"/"+(a.filtro.inicio.getMonth()+1)+"/"+a.filtro.inicio.getFullYear():"",a.filtro.fin=a.filtro.fin instanceof Date?a.filtro.fin.getDate()+"/"+(a.filtro.fin.getMonth()+1)+"/"+a.filtro.fin.getFullYear():"",e.stop()},function(i){a.mostrarMensaje("Se produjo un error al obtener datos de prerequisitos"),e.stop()})},a.abrirDialogVerResultadosLab=function(i){a.Hostorialexamenes=i.laboratorioResultados,a.abrirPopup(a.idModalDialogVerResultadosHistorialLab)},a.cerrarDialogVerResultadosLab=function(i){a.cerrarPopup(a.idModalDialogVerResultadosHistorialLab)},a.showPopover=!1,a.popover={title:"Title",message:"Message"},a.abrirIdModalDialogPreRequisitos=function(i){a.paciente=i,a.verificarAsignacionPrerequisitos(),a.abrirPopup(a.IdModalDialogPreRequisitos)},a.abrirDialogHistorico=function(i){a.abrirPopup(a.idModalDialogHistorico)},a.abrirDialogVacunaEditar=function(i){a.vacuna=i,a.vacunaDosis=i.vacunaDosis,a.dosis={},a.dosisEdit=!1,a.abrirPopup(a.idModalDialogVacunaEdicion)},a.abriridModalDialogFechaEntrega=function(){a.abrirPopup(a.idModalDialogFechaEntrega)},a.abrirIdModalGraficoSV=function(i){a.DatosSV.forEach(function(a){a.dataPoints=[]}),a.fechasLabel=[];a.paciente=i;w(a.paciente.id,{inicio:0,fin:0}).then(function(i){for(var e=0;e<i.consultas.length;e++){var o=i.consultas[e],n=new Date(o.fecha),t=o.presion.split("/"),r=n.getDate()+"/"+n.getMonth()+"/"+n.getFullYear();a.fechasLabel.push(r);var c={x:new Date(n.getFullYear(),n.getMonth(),n.getDate()),y:parseInt(t[0])},s={x:new Date(n.getFullYear(),n.getMonth(),n.getDate()),y:parseInt(o.pulso)},l={x:new Date(n.getFullYear(),n.getMonth(),n.getDate()),y:parseInt(o.talla)},u={x:new Date(n.getFullYear(),n.getMonth(),n.getDate()),y:parseInt(o.peso)},d={x:new Date(n.getFullYear(),n.getMonth(),n.getDate()),y:parseInt(o.temperatura)},f={x:new Date(n.getFullYear(),n.getMonth(),n.getDate()),y:parseInt(o.frecuencia_cardiaca)},p={x:new Date(n.getFullYear(),n.getMonth(),n.getDate()),y:parseInt(o.frecuencia_respiratoria)},g={x:new Date(n.getFullYear(),n.getMonth(),n.getDate()),y:parseInt(o.indice_masa_corporal)};a.DatosSV.forEach(function(a){"PrecionS"==a.name&&a.dataPoints.push(c),"Talla"==a.name&&a.dataPoints.push(l),"Pulso"==a.name&&a.dataPoints.push(s),"Peso"==a.name&&a.dataPoints.push(u),"Temperatura"==a.name&&a.dataPoints.push(d),"Frecuencia Respiratoria"==a.name&&a.dataPoints.push(p),"Frecuencia cardiaca"==a.name&&a.dataPoints.push(f),"indice de masa corporal"==a.name&&a.dataPoints.push(g)},this),20}}),a.abrirPopup(a.IdModalDialogGraficoSV)},a.cerrarIdModalGraficoSV=function(){a.cerrarPopup(a.IdModalDialogGraficoSV)},a.abrirDialogNuevoExamen=function(){a.abrirPopup(a.IdModalDialogLaboratorioExamen)},a.abrirIdModalDialogLaboratorio=function(i){a.paciente=i,a.ObtenerMedicoLaboratorios(i),a.abrirPopup(a.IdModalDialogLaboratorio)},a.abriridModalDialogVacunaNueva=function(){a.vacuna=new P({}),a.dosis={},a.dosisEdit=!1,a.abrirPopup(a.idModalDialogVacunaEdicion)},a.abrirDialogVacunasConfig=function(){a.limpiarAsignacionVacunas(),a.verificarAsignacionVacunas(),a.obtenerAlertas(),a.abrirPopup(a.idModalDialogVacunasConfig)},a.abrirDialogVacunas=function(i){a.paciente=i,a.paciente.vacunas=[],a.filtroHistorialVacunas=[],_(a.paciente).then(function(i){a.paciente.vacunas=i,a.paciente.vacunas.forEach(function(a){var i=new Date;a.fechaAplicacionVacuna_texto=i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear(),a.button_clicked=!1},this)}),a.limpiarAsignacionVacunas(),a.verificarAsignacionVacunas(),a.obtenerAlertas(),a.abrirPopup(a.idModalDialogVacunas)},a.guardarEntregaPrerequisito=function(i){e.start(),null==i.fecha_entrega_texto||""==i.fecha_entrega_texto?a.mostrarMensaje("Ingrese la fecha de entrega."):(i.fecha_entrega=new Date(a.convertirFecha(i.fecha_entrega_texto)),i.asignado=!0,ma.save(i,function(i){T(a.paciente.id,{inicio:0,fin:0}).then(function(o){a.prerequisitosPaciente=o.Prerequisitos,a.mostrarMensaje(i.mensaje),a.prerequisitosPaciente.forEach(function(a){null!=a.fecha_entrega&&(a.entregado=!0)}),a.cerrarPopUpEntregaPreRequisito(),e.stop()})},function(i){a.mostrarMensaje("Ocurrio un problema al guardar la fecha de entrega  de el prerequisito")}))},a.verificarFechaEntregaPrerequisito=function(i,e){a.preRequisito=i,a.preRequisito.fecha_entrega_texto=a.fechaATexto(new Date),a.paciente=void 0===e?i.pacientePrerequisito:e,console.log(a.preRequisito);var o=new Date(a.preRequisito.fecha_vencimiento).getTime(),n=(new Date).getTime();Math.floor((n-o)/864e5)>=0?a.abrirDialogEntregaPreRequisito(a.preRequisito,a.paciente):a.abrirPopup(a.idModalDialogConfirmacionEntregaAdelantado),a.obtenerAlertas()},a.cerrarConfirmacionEntragaAdelantadaPrerequisito=function(){a.cerrarPopup(a.idModalDialogConfirmacionEntregaAdelantado)},a.abrirDialogEntregaPreRequisito=function(i,e){a.cerrarConfirmacionEntragaAdelantadaPrerequisito(),a.preRequisito=i,a.preRequisito.fecha_entrega_texto=a.fechaATexto(new Date),a.paciente=e,a.abrirPopup(a.IdEntregaPrerequisito)},a.cerrarPopUpEntregaPreRequisito=function(){a.obtenerAlertas(),a.cerrarPopup(a.IdEntregaPrerequisito)},a.abrirDialogPacienteNuevo=function(){a.paciente=new d({persona:{imagen:"img/icon-user-default.png"},id_empresa:a.usuario.id_empresa}),a.abrirPopup(a.idModalDialogPacienteNuevo)},a.cerrarPopupPacienteNuevo=function(){a.cerrarPopup(a.idModalDialogPacienteNuevo)},a.abrirDialogPrerequisitoNuevo=function(){a.NuevoP=new v({puede_modificar_rrhh:!1}),a.abrirPopup(a.idModalDialogPrerequisitoNuevo)},a.abrirDialogPrerequisitoEditar=function(i){a.NuevoP=new v({id:i.id,nombre:i.nombre,observacion:i.observacion,vencimiento_mes:i.vencimiento_mes,dias_activacion:i.dias_activacion,puede_modificar_rrhh:i.puede_modificar_rrhh}),a.abrirPopup(a.idModalDialogPrerequisitoNuevo)},a.cerrarPopupPrerequisitoNuevo=function(){a.obtenerAlertas(),a.cerrarPopup(a.idModalDialogPrerequisitoNuevo)},a.validarCodigoCuentaEmpleado=function(i){""!=i&&_a(function(){a.validar=new ba,a.validar.codigo=i,a.validar.$save(function(i){a.data=i})},1500)},a.abrirDialogHistoricoPreRequisito=function(i,o){var n=0,t=0;a.preRequisito=i,a.paciente=o,Da({id_pre:a.preRequisito.preRequisito.id,id_pac:a.paciente.id,inicio:n,fin:t}).then(function(i){a.historialPrerequisitosPaciente=i.historial,e.stop(),a.filtro.inicio=a.filtro.inicio instanceof Date?a.filtro.inicio.getDate()+"/"+(a.filtro.inicio.getMonth()+1)+"/"+a.filtro.inicio.getFullYear():"",a.filtro.fin=a.filtro.fin instanceof Date?a.filtro.fin.getDate()+"/"+(a.filtro.fin.getMonth()+1)+"/"+a.filtro.fin.getFullYear():""}),a.abrirPopup(a.idModalHistorialPrerequisito)},a.filtrarHistorialPrerequisito=function(i){if(void 0!=i){var o=null===i.inicio||""===i.inicio||void 0===i.inicio?0:new Date(i.inicio),n=null===i.fin||""===i.fin||void 0===i.fin?0:new Date(i.fin),t=null===i.opcion||void 0===i.opcion?0:i.opcion;i={inicio:o,fin:n,opcion:t}}else i={inicio:0,fin:0};Da({id_pre:a.preRequisito.preRequisito.id,id_pac:a.paciente.id,inicio:i.inicio,fin:i.fin}).then(function(o){a.historialPrerequisitosPaciente=o.historial,e.stop(),i.inicio=a.filtro.inicio instanceof Date?a.filtro.inicio.getDate()+"/"+(a.filtro.inicio.getMonth()+1)+"/"+a.filtro.inicio.getFullYear():"",i.fin=a.filtro.fin instanceof Date?a.filtro.fin.getDate()+"/"+(a.filtro.fin.getMonth()+1)+"/"+a.filtro.fin.getFullYear():""})},a.cerrarDialogHistoricoPreRequisito=function(){a.cerrarPopup(a.idModalHistorialPrerequisito)},a.actualizarPrerequisito=function(i){e.start(),console.log(i),L(i).then(function(o){i instanceof Array&&a.cerrarPopUpPreRequisitos(),e.stop(),a.mostrarMensaje(o.message)})},a.verificarAsignacionPrerequisitos=function(){e.start(),ga().then(function(i){a.preRequisitos=i.prerequisitos,filtro={inicio:0,fin:0},T(a.paciente.id,filtro).then(function(i){a.prerequisitosPaciente=i.Prerequisitos,a.preRequisitos.forEach(function(i,o,n){a.prerequisitosPaciente.forEach(function(e){e.fecha_vencimiento=a.calcularFechaVencimientoRequisito(e),i.id==e.id_prerequisito&&(i.asignado=!0),null!=e.fecha_entrega&&(e.entregado=!0)}),0==a.prerequisitosPaciente.length&&(i.asignado=!1),o===n.length-1&&e.stop()}),0==a.preRequisitos.length&&e.stop()})})},a.asignarPrerequisito=function(i,o){e.start(),i.pacientePrerequisito={id:o.id},i.preRequisito={id:i.id},i.fecha_inicio=new Date,i.fecha_inicio_texto=a.fechaATexto(i.fecha_inicio),i.fecha_vencimiento=a.calcularFechaVencimientoRequisito(i),i.paraAsignar=!0,ma.save(i,function(i){a.verificarAsignacionPrerequisitos(),a.mostrarMensaje(i.mensaje),e.stop()},function(i){a.mostrarMensaje("Ocurrio un problema al asignar el prerequisito"),e.stop()})},a.diasVencidos=function(a){var i=(new Date).getTime()-a.getTime();return Math.floor(i/864e5)},a.calcularFechaVencimientoRequisito=function(i){var e=void 0===i.vencimiento_mes?i.preRequisito.vencimiento_mes:i.vencimiento_mes,o=(new Date,new Date);if(void 0===i.fecha_inicio_texto)var n=a.fechaATexto(i.fecha_inicio);var t=void 0===i.fecha_inicio_texto?n.split("/"):i.fecha_inicio_texto.split("/"),r=parseInt(t[0]),c=parseInt(t[1]),s=parseInt(t[2]);return o.setFullYear(s,c-1,r),new Date(o.setTime(o.getTime()+30*e*864e5))},a.actualizarPreRequisitoPaciente=function(i){e.start();var o=i;o.fecha_vencimiento=new Date(a.convertirFecha(o.fecha_vencimiento_texto)),o.fecha_inicio=new Date,o.fecha_entrega=null,o.asignado=!0,ma.save(o,function(i){a.mostrarMensaje(i.mensaje),a.cerrarDialogEditarPreRequisito(),a.verificarAsignacionPrerequisitos(),e.stop()},function(i){a.mostrarMensaje("Ocurrio un problema al asignar el prerequisito"),a.cerrarDialogEditarPreRequisito(),e.stop()})},a.saveFormPrerequisito=function(i){(e.start(),void 0!=i.nombre&&void 0!=i.vencimiento_mes)?Aa(i).then(function(i){a.mostrarMensaje(i.mensaje),a.cerrarPopupPrerequisitoNuevo(),e.stop(),a.verificarAsignacionPrerequisitos()}).catch(function(i){e.stop();var o=void 0!==i.stack&&null!==i.stack?i.stack:void 0!==i.message&&null!==i.message?i.message:"Se perdió la conexión.";a.mostrarMensaje(o)}):(a.mostrarMensaje("Los campos Prerequisito Nombre y vencimiento mes son requeridos."),e.stop())},a.finVerPaciente=function(){"Siguiente"!=$("#siguiente-v").text().trim()&&a.cerrarPopPupVista()},a.sinFuncionalidad=function(i){a.mostrarMensaje("Sin funcionalidad")},a.abrirDialogEditarPreRequisito=function(i){a.preRequisito=i,a.preRequisito.fecha_vencimiento_texto=a.fechaATexto(new Date),a.abrirPopup(a.idModalEditarPrerequisito)},a.cerrarDialogEditarPreRequisito=function(){a.cerrarPopup(a.idModalEditarPrerequisito)},a.verPaciente=function(i){promesaPaciente=aa(i.id),promesaPaciente.then(function(i){a.paciente=i,a.paciente.fecha_nacimiento_texto=a.fechaATexto(a.paciente.persona.fecha_nacimiento)}),a.abrirPopup(a.idModalWizardPacienteVista)},a.cerrarPopPupVista=function(){a.cerrarPopup(a.idModalWizardPacienteVista)},a.modificarPaciente=function(i){promesaPaciente=aa(i.id),promesaPaciente.then(function(i){console.log(i),a.paciente=i,a.paciente.fecha_nacimiento_texto=a.fechaATexto(a.paciente.persona.fecha_nacimiento),a.paciente.persona.imagen=null==i.persona.imagen?"img/icon-user-default.png":i.persona.imagen,console.log(a.paciente.fecha_nacimiento_texto)}),console.log(a.paciente),a.abrirPopup(a.idModalDialogPacienteNuevo)},a.mostrarConfirmacionEliminacion=function(i){i.persona=void 0==i.persona?{imagen:null==i.imagen?"img/icon-user-default.png":i.imagen}:i.persona.imagen,i.eliminar=!0,a.paciente=i,a.abrirPopup(a.idModalEliminarPaciente)},a.cerrarConfirmacionEliminacion=function(){a.cerrarPopup(a.idModalEliminarPaciente)},a.eliminarPaciente=function(i){e.start(),a.paciente.eliminado=0==i.eliminado,d.update({id_paciente:a.paciente.id},a.paciente,function(i){e.stop(),a.cerrarConfirmacionEliminacion(),a.obtenerPacientes(),a.mostrarMensaje("Eliminado Exitosamente!")},function(i){e.stop(),a.cerrarConfirmacionEliminacion(),a.obtenerPacientes(),a.mostrarMensaje("Ocurrio un problema al eliminar el paciente!"),a.recargarItemsTabla()})},a.cortarFecha=function(a){var i=a.split(" "),e=i[1].split(":"),o=i[0].split("/"),n=parseInt(o[0]),t=parseInt(o[1]),r=parseInt(o[2]),c=new Date,s="AM"==i[2]?parseInt(e[0]):parseInt(e[0])<12?parseInt(e[0])+12:parseInt(e[0]);return c.setFullYear(r,t-1,n),c.setHours(s,e[1]),c},a.guardarConsulta=function(i,e){if("Siguiente"!=$("#siguiente-c").text().trim()&&i.$valid){e.fecha.split(" ");e.fecha=(e.fecha,Date,a.cortarFecha(e.fecha)),e.presion=e.presionAlta+"/"+e.presionBaja,x(e).then(function(i){a.cerrarPopUpConsulta(),a.recargarItemsTabla(),a.mostrarMensaje(i.message)})}},a.guardarDatosConsulta=function(i,e){if(i.$valid){e.fecha.split(" ");e.fecha=(e.fecha,Date,a.cortarFecha(e.fecha)),e.presion=e.presionAlta+"/"+e.presionBaja,x(e).then(function(i){a.cerrarPopUpConsulta(),a.recargarItemsTabla(),a.mostrarMensaje(i.message)})}},a.listarConsultasPaciente=function(i){void 0!=i.inicio&&(0!=i.inicio||""!=i.inicio)?a.filtro.inicio=i.inicio instanceof Date?i.inicio:new Date(a.convertirFecha(i.inicio)):a.filtro.inicio=0,void 0!=i.fin&&(0!=i.fin||""!=i.fin)?a.filtro.fin=i.fin instanceof Date?i.fin:new Date(a.convertirFecha(i.fin)):a.filtro.fin=0,w(a.paciente.id,a.filtro).then(function(i){a.listaConsultas=i.consultas,a.filtro.inicio=a.filtro.inicio instanceof Date?a.filtro.inicio.getDate()+"/"+(a.filtro.inicio.getMonth()+1)+"/"+a.filtro.inicio.getFullYear():"",a.filtro.fin=a.filtro.fin instanceof Date?a.filtro.fin.getDate()+"/"+(a.filtro.fin.getMonth()+1)+"/"+a.filtro.fin.getFullYear():""})},a.changeActivo=function(i){oa.update({id_paciente:i.id},i,function(i){a.mostrarMensaje(i.mensaje)})},a.saveForm=function(i){a.paciente=i;i.imagen;"Siguiente"!=$("#siguiente").text().trim()&&(e.start(),i.id?(i.persona.fecha_nacimiento=new Date(a.convertirFecha(i.fecha_nacimiento_texto)),d.update({id_paciente:i.id},i,function(i){e.stop(),a.cerrarPopupPacienteNuevo(),a.obtenerPacientes(),a.mostrarMensaje("Actualizado Exitosamente!"),a.recargarItemsTabla()})):(i.persona.fecha_nacimiento=new Date(a.convertirFecha(i.fecha_nacimiento_texto)),i.$save({id_paciente:0},function(i){e.stop(),a.cerrarPopupPacienteNuevo(),a.obtenerPacientes(),a.mostrarMensaje(i.message),a.recargarItemsTabla()},function(i){e.stop(),a.cerrarPopupPacienteNuevo(),a.obtenerPacientes(),a.mostrarMensaje("Ocurrio un problema al momento de guardar!"),a.recargarItemsTabla()})))},a.saveComment=function(i){ia.update({id_paciente:i.id},i,function(i){a.mostrarMensaje("Comentario actualizado Exitosamente!")},function(i){a.mostrarMensaje("Hubo un problema al guardar su comentario.")}),e.stop(),a.cerrarDialogDialogComentario()},a.filtrarHistorialVacunas=function(i){var e=""===i.inicio||void 0===i.inicio?0:new Date(i.inicio),o=""===i.fin||void 0===i.fin?0:new Date(i.fin),n=""===i.opcion||void 0===i.opcion?0:i.opcion;0!=e&&0!=o?a.filtroHistorialVacunas.forEach(function(a){a.pacienteVacunaDosis.forEach(function(a){var i=new Date(a.fecha_aplicacion);e<=i&&o>=i?(a.visible=!0,0!=n&&("enfec"==n&&(a.visible=void 0!=a.retrasada&&!(a.retrasada&&!a.proyectada)),"proye"==n&&(a.visible=void 0!=a.proyectada&&null!=a.proyectada&&!!a.proyectada),"retra"==n&&(a.visible=void 0!=a.retrasada&&!(!a.retrasada||a.proyectada)),"todas"==n&&(a.visible=!0))):a.visible=!1})}):a.filtroHistorialVacunas.forEach(function(i){i.pacienteVacunaDosis.forEach(function(i){0!=n?a.filtroHistorialVacunas.forEach(function(a){a.pacienteVacunaDosis.forEach(function(a){"enfec"==n&&(a.visible=void 0!=a.retrasada&&!(a.retrasada&&!a.proyectada)),"proye"==n&&(a.visible=void 0!=a.proyectada&&null!=a.proyectada&&!!a.proyectada),"retra"==n&&(a.visible=void 0!=a.retrasada&&!(!a.retrasada||a.proyectada)),"todas"==n&&(a.visible=!0)})}):i.visible=!0})}),0!=e&&0==o?a.filtroHistorialVacunas.forEach(function(a){a.pacienteVacunaDosis.forEach(function(a){var i=new Date(a.fecha_aplicacion);e<=i?(a.visible=!0,0!=n&&("enfec"==n&&(a.visible=void 0!=a.retrasada&&!(a.retrasada&&!a.proyectada)),"proye"==n&&(a.visible=void 0!=a.proyectada&&null!=a.proyectada&&!!a.proyectada),"retra"==n&&(a.visible=void 0!=a.retrasada&&!(!a.retrasada||a.proyectada)),"todas"==n&&(a.visible=!0))):a.visible=!1})}):0==e&&0!=o&&a.filtroHistorialVacunas.forEach(function(a){a.pacienteVacunaDosis.forEach(function(a){var i=new Date(a.fecha_aplicacion);o>=i?(a.visible=!0,0!=n&&("enfec"==n&&(a.visible=void 0!=a.retrasada&&!(a.retrasada&&!a.proyectada)),"proye"==n&&(a.visible=void 0!=a.proyectada&&null!=a.proyectada&&!!a.proyectada),"retra"==n&&(a.visible=void 0!=a.retrasada&&!(!a.retrasada||a.proyectada)),"todas"==n&&(a.visible=!0))):a.visible=!1})})},a.limpiarVisibilidadDosis=function(){a.filtroHistorialVacunas.forEach(function(a){a.pacienteVacunaDosis.forEach(function(a){a.visible=!0})})},a.abrirDialogHistorialVacuna=function(i){var e=a.paciente.vacunas.indexOf(i);a.vacuna=a.paciente.vacunas[e],a.evaluarFechaDosisVacuna(a.vacuna),a.filtroHistorialVacunas=[],a.filtroHistorialVacunas.push(a.vacuna),a.limpiarVisibilidadDosis(),a.abrirPopup(a.idModalDialogHistorialVacuna),a.filtroHistorialVacunas.forEach(function(a){a.pacienteVacunaDosis.forEach(function(a){a.visible=!0})})},a.cerrarDialogHistorialVacuna=function(){a.filtroVacunas={inicio:"",fin:"",opcion:"todas"},a.limpiarVisibilidadDosis(),a.cerrarPopup(a.idModalDialogHistorialVacuna)},a.abrirDialogHistorialConsulta=function(){a.listarConsultasPaciente({inicio:0,fin:0}),a.dynamicPopoverCargos={templateUrl:"consultaPopoverTemplate.html"},a.abrirPopup(a.idModalHistorialConsulta)},a.cerrarDialogHistorialConsulta=function(){a.cerrarPopup(a.idModalHistorialConsulta)},a.abrirDialogHistorialVacunaGeneral=function(){a.paciente.vacunas.forEach(function(i,e,o){a.evaluarFechaDosisVacuna(i),e===o.length-1&&(a.filtroHistorialVacunas=a.paciente.vacunas,a.limpiarVisibilidadDosis())},this),a.abrirPopup(a.idModalDialogHistorialVacunaGeneral)},a.cerrarDialogHistorialVacunaGeneral=function(){a.filtroVacunas={inicio:"",fin:"",opcion:"todas"},a.limpiarVisibilidadDosis(),a.filtroHistorialVacunas=[],a.cerrarPopup(a.idModalDialogHistorialVacunaGeneral)},a.abrirDialogDiagnosticos=function(i){a.paciente=i,a.ObtenerMedicoDiagnostico(i),a.abrirPopup(a.idModalDialogDiagnosticos)},a.cerrarDialogDiagnosticos=function(){a.cerrarPopup(a.idModalDialogDiagnosticos)},a.abrirDialogDiagnosticoNuevo=function(i,e){a.diagnostico={},i&&(a.diagnostico=i),a.diagnostico.soloVista=!!e,a.abrirPopup(a.idModalDialogDiagnosticoNuevo)},a.cerrarDialogDiagnosticoNuevo=function(){a.cerrarPopup(a.idModalDialogDiagnosticoNuevo)},a.abrirDialogExamenesDiagnostico=function(i){a.diagnostico=i,a.ObtenerMedicoDiagnosticoExamenes(i),a.abrirPopup(a.idModalDialogExamenesDiagnostico)},a.cerrarDialogExamenesDiagnostico=function(){a.cerrarPopup(a.idModalDialogExamenesDiagnostico)},a.abrirDialogNuevoExamenDiagnostico=function(i,e){a.examen={},i&&(a.examen=i),a.examen.soloVista=!!e,a.abrirPopup(a.idModalDialogNuevoExamenDiagnostico)},a.cerrarDialogNuevoExamenDiagnostico=function(){a.cerrarPopup(a.idModalDialogNuevoExamenDiagnostico)},a.abrirDialogHistorialFicha=function(i){a.ObtenerHistorialFichaMedica({inicio:0,fin:0,tipo_control:0}),a.abrirPopup(a.idModalDialogHistorialFicha)},a.cerrarDialogHistorialFicha=function(){a.cerrarPopup(a.idModalDialogHistorialFicha)},a.abrirDialogDialogCredencial=function(i){a.paciente=i,C(i.id).then(function(i){i.ficha?(a.ficha=i.ficha,a.ficha.enfermedad_cardilogia||(a.ficha.enfermedad_cardilogia2=!0),a.ficha.enfermedad_hipertension||(a.ficha.enfermedad_hipertension2=!0),a.ficha.enfermedad_lumbalgia||(a.ficha.enfermedad_lumbalgia2=!0),a.ficha.enfermedad_diabetes||(a.ficha.enfermedad_diabetes2=!0),a.ficha.enfermedad_epilepsia||(a.ficha.enfermedad_epilepsia2=!0),a.ficha.enfermedad_chagas||(a.ficha.enfermedad_chagas2=!0),a.ficha.enfermedad_hepatitis||(a.ficha.enfermedad_hepatitis2=!0),""==!a.ficha.enfermedad_otros?a.ficha.enfermedad_otros2=!0:a.ficha.enfermedad_otros3=!0,a.ficha.alergia_otros||a.ficha.alergia_conservas||a.ficha.alergia_alimentos||a.ficha.alergia_humo_cigarrillo||a.ficha.alergia_polvo||a.ficha.alergia_quimico||a.ficha.alergia_algun_material||a.ficha.alergia_medicamento||a.ficha.alergia_plantas?a.ficha.alergia=!0:a.ficha.alergia2=!0,a.abrirPopup(a.idModalDialogCredencial)):a.mostrarMensaje("primero debe crear una ficha medica del paciente para poder ver el credencial")})},a.cerrarDialogDialogCredencial=function(){a.cerrarPopup(a.idModalDialogCredencial)},a.abrirDialogDialogPatologias=function(i){a.paciente=i,C(i.id).then(function(i){i.ficha?(a.ficha=i.ficha,a.abrirPopup(a.idModalDialogPatologias)):a.mostrarMensaje("primero debe crear una ficha medica para poder ver las patogias del paciente")})},a.guardarPatoliga=function(){S(a.paciente.id,a.ficha).then(function(i){a.cerrarDialogDialogPatologias(),a.mostrarMensaje(i.message)})},a.cerrarDialogDialogPatologias=function(){a.cerrarPopup(a.idModalDialogPatologias)},a.abrirDialogDialogComentario=function(i){a.paciente=i,a.abrirPopup(a.idModalDialogComentario)},a.cerrarDialogDialogComentario=function(){a.cerrarPopup(a.idModalDialogComentario)},a.abrirDialogDialogAlertPrerequisitos=function(){a.listaAlertasPrerequisitosPaciente({inicio:0,fin:0}),a.abrirPopup(a.idModalAlertPrerequisitos)},a.cerrarDialogDialogAlertPrerequisitos=function(){a.cerrarPopup(a.idModalAlertPrerequisitos)},a.verificarConteoAlertas=function(){var i=0;return void 0!=a.alertasPrerequisitos&&(i+=a.alertasPrerequisitos),void 0!=a.alertasVacunas&&(i+=a.alertasVacunas),a.alertasOtros=0,i},a.obtenerAlertas=function(){a.verificarAlertasPrerequisitos(),a.verificarAlertasVacunas(),a.verificarConteoAlertas()},a.verificarAlertasPrerequisitos=function(){var i={inicio:0,fin:0};a.filtro=i,va(a.usuario.id_empresa,i).then(function(i){a.filtro.inicio=a.filtro.inicio instanceof Date?a.filtro.inicio.getDate()+"/"+(a.filtro.inicio.getMonth()+1)+"/"+a.filtro.inicio.getFullYear():"",a.filtro.fin=a.filtro.fin instanceof Date?a.filtro.fin.getDate()+"/"+(a.filtro.fin.getMonth()+1)+"/"+a.filtro.fin.getFullYear():"";var e=i.Prerequisitos;a.listaAlertPrerequisitos=[],e.forEach(function(i,e,o){new Date;var n=new Date(i.fecha_vencimiento);i.DiasVence=a.diasVencidos(n),null!=i.fecha_entrega?i.entregado=!0:(i.entregado=!1,i.reprogramado?i.DiasVence<=i.dias_activacion&&i.DiasVence>=-1*i.dias_activacion&&a.listaAlertPrerequisitos.push(i):i.DiasVence<=i.preRequisito.dias_activacion&&i.DiasVence>=-1*i.preRequisito.dias_activacion&&a.listaAlertPrerequisitos.push(i)),e==o.length-1&&(a.alertasPrerequisitos=a.listaAlertPrerequisitos.length)},this)})},a.verificarAlertasVacunas=function(){var i={inicio:0,fin:0};""!==i.vacuna&&void 0!==i.vacuna||(i.vacuna=0),ha(a.usuario.id_empresa,i).then(function(i){a.filtro.inicio=a.filtro.inicio instanceof Date?a.filtro.inicio.getDate()+"/"+(a.filtro.inicio.getMonth()+1)+"/"+a.filtro.inicio.getFullYear():"",a.filtro.fin=a.filtro.fin instanceof Date?a.filtro.fin.getDate()+"/"+(a.filtro.fin.getMonth()+1)+"/"+a.filtro.fin.getFullYear():"",a.listaAlertVacunas=i.Vacunas,a.listaAlertVacunas.forEach(function(i,e,o){new Date(i.fecha_ultima_aplicacion);var n=new Date(i.fecha_siguiente_aplicacion);i.DiasVence=a.diasVencidos(n),console.log(i.DiasVence),e==o.length-1&&(a.alertasVacunas=a.listaAlertVacunas.length)},this)})},a.listaAlertasPrerequisitosPaciente=function(i){a.filtro=i,void 0!=i.inicio&&0!=i.inicio&&""!=i.inicio?a.filtro.inicio=i.inicio instanceof Date?i.inicio:new Date(a.convertirFecha(i.inicio)):a.filtro.inicio=0,void 0!=i.fin&&0!=i.fin&&""!=i.fin?a.filtro.fin=i.fin instanceof Date?i.fin:new Date(a.convertirFecha(i.fin)):a.filtro.fin=0,va(a.usuario.id_empresa,a.filtro).then(function(i){a.filtro.inicio=a.filtro.inicio instanceof Date?a.filtro.inicio.getDate()+"/"+(a.filtro.inicio.getMonth()+1)+"/"+a.filtro.inicio.getFullYear():"",a.filtro.fin=a.filtro.fin instanceof Date?a.filtro.fin.getDate()+"/"+(a.filtro.fin.getMonth()+1)+"/"+a.filtro.fin.getFullYear():"";var e=i.Prerequisitos;a.listaAlertPrerequisitos=[],e.forEach(function(i,e,o){new Date(i.fecha_inicio);var n=new Date(i.fecha_vencimiento);i.DiasVence=a.diasVencidos(n),null!=i.fecha_entrega?i.entregado=!0:(i.entregado=!1,i.DiasVence<=i.preRequisito.dias_activacion&&i.DiasVence>=-1*i.preRequisito.dias_activacion&&a.listaAlertPrerequisitos.push(i)),e==o.length-1&&(a.alertasPrerequisitos=a.listaAlertPrerequisitos.length,a.verificarConteoAlertas())},this)})},a.obtenerListaEmpresaVacunas=function(i){a.filtro=i,void 0!=i.inicio&&void 0!=i.fin&&(0!=i.inicio||""!=i.inicio)?(a.filtro.inicio=i.inicio instanceof Date?i.inicio:new Date(a.convertirFecha(i.inicio)),a.filtro.fin=i.fin instanceof Date?i.fin:new Date(a.convertirFecha(i.fin))):(a.filtro.inicio=0,a.filtro.fin=0),J(a.usuario.id_empresa,a.filtro).then(function(i){a.listaAlertVacunas=i.Vacunas,a.listaAlertVacunas.forEach(function(i){new Date(i.fecha_ultima_aplicacion);var e=new Date(i.fecha_siguiente_aplicacion);i.DiasVence=a.diasVencidos(e).console.log(i.DiasVence)},this)})},a.obtenerListaAlertasVacunas=function(i){a.filtro=i,void 0!=i.inicio&&0!=i.inicio&&""!=i.inicio?a.filtro.inicio=i.inicio instanceof Date?i.inicio:new Date(a.convertirFecha(i.inicio)):a.filtro.inicio=0,void 0!=i.fin&&0!=i.fin&&""!=i.fin?a.filtro.fin=i.fin instanceof Date?i.fin:new Date(a.convertirFecha(i.fin)):a.filtro.fin=0,null!=i.vacuna&&void 0!=i.vacuna&&""!=a.filtro.vacuna||(a.filtro.vacuna=0),ha(a.usuario.id_empresa,i).then(function(i){a.listaAlertVacunas=i.Vacunas,a.listaAlertVacunas.forEach(function(i){new Date(i.fecha_ultima_aplicacion);var e=new Date(i.fecha_siguiente_aplicacion);i.DiasVence=a.diasVencidos(e),a.alertasVacunas=a.listaAlertVacunas.length,a.verificarConteoAlertas(),console.log(i.DiasVence)},this),a.filtro.inicio=a.filtro.inicio instanceof Date?a.filtro.inicio.getDate()+"/"+(a.filtro.inicio.getMonth()+1)+"/"+a.filtro.inicio.getFullYear():"",a.filtro.fin=a.filtro.fin instanceof Date?a.filtro.fin.getDate()+"/"+(a.filtro.fin.getMonth()+1)+"/"+a.filtro.fin.getFullYear():""})},a.setDiasActivacionPrerequisitos=function(i){if(e.start(),void 0===a.preRequisito){var o={setDiasTodos:!0,dias_activacion:i};v.save(o,function(i){a.mostrarMensaje(i.mensaje),a.cerrarDialogDialogDiasActivacionPrerequisitos(),a.obtenerAlertas(),e.stop()})}else a.preRequisito.dias_activacion=i,v.save(a.preRequisito,function(i){a.mostrarMensaje(i.mensaje),a.cerrarDialogDialogDiasActivacionPrerequisitos(),a.obtenerAlertas(),e.stop()})},a.setDiasActivacionVacunas=function(i){if(e.start(),void 0===a.vacuna){var o={setDiasTodos:!0,dias_activacion:i};Pa.update(o,function(i){a.mostrarMensaje(i.mensaje),a.cerrarDialogDiasActivacionVacunas(),a.obtenerAlertas(),e.stop()})}else a.vacuna.dias_activacion=i,Pa.update(a.preRequisito,function(i){a.mostrarMensaje(i.mensaje),a.cerrarDialogDiasActivacionVacunas(),a.obtenerAlertas(),e.stop()})},a.abrirDialogDialogDiasActivacionPrerequisitos=function(i){void 0===i?(a.preRequisito=void 0,a.paciente=void 0):a.preRequisito=i,a.abrirPopup(a.idModalDiasActivacionPrerequisitos)},a.cerrarDialogDialogDiasActivacionPrerequisitos=function(){a.cerrarPopup(a.idModalDiasActivacionPrerequisitos)},a.reprogramarPrerequisitos=function(i){if(e.start(),void 0===a.paciente&&void 0===a.preRequisito){var o={reprogramarTodos:!0,fecha_vencimiento:new Date(i)};ma.save(o,function(i){a.mostrarMensaje(i.mensaje),a.cerrarDialogReprogramarPrerequisitos(),a.obtenerAlertas(),e.stop()})}else a.preRequisito.fecha_vencimiento=new Date(a.convertirFecha(i)),a.preRequisito.asignado=!0,ma.save(a.preRequisito,function(i){a.mostrarMensaje(i.mensaje),a.cerrarDialogReprogramarPrerequisitos(),a.obtenerAlertas(),e.stop()})},a.abrirDialogReprogramarPrerequisitos=function(i){void 0===i?(a.preRequisito=void 0,a.paciente=void 0):a.preRequisito=i,a.abrirPopup(a.idModalReprogramarPrerequisitos)},a.cerrarDialogReprogramarPrerequisitos=function(){a.cerrarPopup(a.idModalReprogramarPrerequisitos)},a.abrirDialogAlertVacunas=function(){a.obtenerListaAlertasVacunas({inicio:0,fin:0}),a.abrirPopup(a.idModalAlertVacunas)},a.cerrarDialogAlertVacunas=function(){a.cerrarPopup(a.idModalAlertVacunas)},a.abrirDialogDiasActivacionVacunas=function(i){a.vacuna=void 0===i?void 0:i,a.abrirPopup(a.idModalDiasActivacionVacunas)},a.cerrarDialogDiasActivacionVacunas=function(){a.cerrarPopup(a.idModalDiasActivacionVacunas)},a.abrirDialogReprogramarVacunas=function(){a.abrirPopup(a.idModalReprogramarVacunas)},a.cerrarDialogReprogramarVacunas=function(){a.cerrarPopup(a.idModalReprogramarVacunas)},a.cerrarIdModalDialogLaboratorioExamenesHistoricoResultados=function(){a.cerrarPopup(a.IdModalDialogLaboratorioExamenHistoricoResultado)},a.cerrarIdModalDialogDiagnosticoExamenesHistoricoResultados=function(){a.cerrarPopup(a.IdModalDialogDiagnosticoExamenHistoricoResultado)},a.cerrarIdModalDialogNuevoLaboratorio=function(){a.cerrarPopup(a.IdModalDialogNuevoLaboratorio)},a.cerrarIdModalDialogLaboratorioExameneHistoricoPreview=function(){a.cerrarPopup(a.IdModalDialogLaboratorioExamenHistoricoPreview)},a.cerrarIdModalDialogLaboratorioExamenesNuevoResultado=function(){a.cerrarPopup(a.IdModalDialogLaboratorioExamenesNuevoResultado)},a.cerrarIdModalDialogLaboratorioExamenes=function(){a.cerrarPopup(a.IdModalDialogLaboratorioExamenes)},a.cerrarPopUpExamenLaboratorio=function(){a.cerrarPopup(a.IdModalDialogLaboratorioExamen)},a.cerrarPopUpVacunaNueva=function(){a.vacunaDosis=[],setTimeout(function(){a.obtenerVacunas(),setTimeout(function(){a.verificarAsignacionVacunas()},1e3)},1e3),a.dosis={},a.dosisEdit=!1,a.cerrarPopup(a.idModalDialogVacunaEdicion)},a.cerrarPopUpVacunasConfig=function(){a.paciente.vacunas=[],_(a.paciente).then(function(i){a.paciente.vacunas=i,a.paciente.vacunas.forEach(function(a){var i=new Date;a.fechaAplicacionVacuna_texto=i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear(),a.button_clicked=!1},this)}),a.limpiarAsignacionVacunas(),a.verificarAsignacionVacunas(),a.obtenerAlertas(),a.cerrarPopup(a.idModalDialogVacunasConfig)},a.cerrarPopUpIdModalFichaTecnica=function(){a.cerrarPopup(a.idModalFichaTecnica)},a.cerrarPopUpConsulta=function(){a.cerrarPopup(a.idModalDialogConsulta)},a.cerrarPopUpPreRequisitos=function(){a.obtenerAlertas(),a.cerrarPopup(a.IdModalDialogPreRequisitos)},a.cerrarIdModalDialogLaboratorio=function(){a.cerrarPopup(a.IdModalDialogLaboratorio)},a.cerrarPopPupVacunas=function(){a.filtroHistorialVacunas=[],a.obtenerAlertas(),a.cerrarPopup(a.idModalDialogVacunas)},a.cerrarPopPupVacunasConfig=function(){a.obtenerAlertas(),a.cerrarPopup(a.idModalDialogVacunasConfig)},a.crearNuevaConsulta=function(i){var e=(new Date).getDate()+"/"+((new Date).getMonth()+1)+"/"+(new Date).getFullYear();a.horaConsulta=(new Date).getHours()+":"+(new Date).getMinutes();var o=(new Date).getHours()>=12?"PM":"AM";a.consulta={id_paciente:i.id,fecha:e+" "+a.horaConsulta+" "+o},a.paciente=i;w(a.paciente.id,{inicio:0,fin:0}).then(function(i){a.consultas=i.consultas,a.filtro.inicio=a.filtro.inicio instanceof Date?a.filtro.inicio.getDate()+"/"+(a.filtro.inicio.getMonth()+1)+"/"+a.filtro.inicio.getFullYear():"",a.filtro.fin=a.filtro.fin instanceof Date?a.filtro.fin.getDate()+"/"+(a.filtro.fin.getMonth()+1)+"/"+a.filtro.fin.getFullYear():""}),a.abrirPopup(a.idModalDialogConsulta)},a.EliminarNuevoLaboratorio=function(i){ua(a.paciente.id_empresa,i).then(function(i){a.ObtenerMedicoLaboratorios(a.paciente),a.mostrarMensaje(i.message)})},a.guardarNuevoLaboratorio=function(i){i.$valid&&(a.laboratorio.id?ta(a.paciente.id_empresa,a.laboratorio).then(function(i){a.cerrarIdModalDialogNuevoLaboratorio(),a.ObtenerMedicoLaboratorios(a.paciente),a.mostrarMensaje(i.message)}):R(a.paciente.id_empresa,a.laboratorio).then(function(i){a.cerrarIdModalDialogNuevoLaboratorio(),a.ObtenerMedicoLaboratorios(a.paciente),a.mostrarMensaje(i.message)}))},a.ObtenerMedicoLaboratorios=function(i){H(i.id_empresa).then(function(i){a.listaLaboratorios=i})},a.guardarNuevoLaboratorioExamen=function(i){i.$valid&&(a.examen.id?ra(a.laboratorio.id,a.examen).then(function(i){a.cerrarIdModalDialogLaboratorioExamenesNuevoResultado(),a.ObtenerMedicoLaboratorioExamenes(a.laboratorio),a.mostrarMensaje(i.message)}):N(a.laboratorio.id,a.examen).then(function(i){a.cerrarIdModalDialogLaboratorioExamenesNuevoResultado(),a.ObtenerMedicoLaboratorioExamenes(a.laboratorio),a.mostrarMensaje(i.message)}))},a.EliminarNuevoLaboratorioExamen=function(i){da(a.laboratorio.id,i).then(function(i){a.ObtenerMedicoLaboratorioExamenes(a.laboratorio),a.mostrarMensaje(i.message)})},a.ObtenerMedicoLaboratorioExamenes=function(i){promesa=j(i.id),promesa.then(function(i){a.listaLaboratorioExamenes=i})},a.guardarLaboratorioExamenResultados=function(i,e){if(i.$valid){var o={fecha:new Date(a.convertirFecha(e)),examenes:a.listaLaboratorioExamenes};promesa=O(a.laboratorio.id,a.paciente.id,o),promesa.then(function(i){a.cerrarIdModalDialogLaboratorioExamenes(),a.ObtenerMedicoLaboratorioExamenes(a.laboratorio),a.mostrarMensaje(i.message)})}},a.ObtenerHistorialLaboratorioExamenes=function(i){void 0!=i.inicio&&(0!=i.inicio||""!=i.inicio)?a.filtro.inicio=i.inicio instanceof Date?i.inicio:new Date(a.convertirFecha(i.inicio)):a.filtro.inicio=0,void 0!=i.fin&&(0!=i.fin||""!=i.fin)?a.filtro.fin=i.fin instanceof Date?i.fin:new Date(a.convertirFecha(i.fin)):a.filtro.fin=0,promesa=y(a.laboratorio.id,a.paciente.id,a.filtro),promesa.then(function(i){a.filtro.inicio=a.filtro.inicio instanceof Date?a.filtro.inicio.getDate()+"/"+(a.filtro.inicio.getMonth()+1)+"/"+a.filtro.inicio.getFullYear():"",a.filtro.fin=a.filtro.fin instanceof Date?a.filtro.fin.getDate()+"/"+(a.filtro.fin.getMonth()+1)+"/"+a.filtro.fin.getFullYear():"",a.listaHistorialLaboratorioExamenes=i})},a.ObtenerHistorialFichaMedica=function(i){void 0!=i.inicio&&(0!=i.inicio||""!=i.inicio)?a.filtro.inicio=i.inicio instanceof Date?i.inicio:new Date(a.convertirFecha(i.inicio)):a.filtro.inicio=0,void 0!=i.fin&&(0!=i.fin||""!=i.fin)?a.filtro.fin=i.fin instanceof Date?i.fin:new Date(a.convertirFecha(i.fin)):a.filtro.fin=0,void 0==i.tipo_control&&(i.tipo_control=0),promesa=na(a.paciente.id,i),promesa.then(function(i){a.filtro.inicio=a.filtro.inicio instanceof Date?a.filtro.inicio.getDate()+"/"+(a.filtro.inicio.getMonth()+1)+"/"+a.filtro.inicio.getFullYear():"",a.filtro.fin=a.filtro.fin instanceof Date?a.filtro.fin.getDate()+"/"+(a.filtro.fin.getMonth()+1)+"/"+a.filtro.fin.getFullYear():"",a.listaHistorialfichaMEdica=i})},a.eliminarDiagnostico=function(i){pa(a.paciente.id_empresa,i).then(function(i){a.ObtenerMedicoDiagnostico(a.paciente),a.mostrarMensaje(i.message)})},a.guardarNuevoDiagnostico=function(i){i.$valid&&(a.diagnostico.id?(promesa=ca(a.paciente.id_empresa,a.diagnostico),promesa.then(function(i){a.cerrarDialogDiagnosticoNuevo(),a.ObtenerMedicoDiagnostico(a.paciente),a.mostrarMensaje(i.message)})):(promesa=Y(a.paciente.id_empresa,a.diagnostico),promesa.then(function(i){a.cerrarDialogDiagnosticoNuevo(),a.ObtenerMedicoDiagnostico(a.paciente),a.mostrarMensaje(i.message)})))},a.ObtenerMedicoDiagnostico=function(i){promesa=G(i.id_empresa),promesa.then(function(i){a.listaDiagnosticos=i})},a.guardarNuevoDiagnosticoExamen=function(i){i.$valid&&(a.examen.id?(promesa=sa(a.diagnostico.id,a.examen),promesa.then(function(i){a.cerrarDialogNuevoExamenDiagnostico(),a.ObtenerMedicoDiagnosticoExamenes(a.diagnostico),a.mostrarMensaje(i.message)})):(promesa=z(a.diagnostico.id,a.examen),promesa.then(function(i){a.cerrarDialogNuevoExamenDiagnostico(),a.ObtenerMedicoDiagnosticoExamenes(a.diagnostico),a.mostrarMensaje(i.message)})))},a.eliminarNuevoDiagnosticoExamen=function(i){fa(a.diagnostico.id,i).then(function(i){a.ObtenerMedicoDiagnosticoExamenes(a.diagnostico),a.mostrarMensaje(i.message)})},a.ObtenerMedicoDiagnosticoExamenes=function(i){promesa=U(i.id),promesa.then(function(i){a.listaDiagnosticosExamenes=i})},a.guardarDiagnosticoExamenResultados=function(i,e){if(i.$valid){var o={fecha:new Date(a.convertirFecha(e)),examenes:a.listaDiagnosticosExamenes};promesa=X(a.diagnostico.id,a.paciente.id,o),promesa.then(function(i){a.cerrarDialogExamenesDiagnostico(),a.ObtenerMedicoDiagnosticoExamenes(a.diagnostico),a.mostrarMensaje(i.message)})}},a.ObtenerHistorialDiagnosticoExamenes=function(i){void 0!=i.inicio&&(0!=i.inicio||""!=i.inicio)?a.filtro.inicio=i.inicio instanceof Date?i.inicio:new Date(a.convertirFecha(i.inicio)):a.filtro.inicio=0,void 0!=i.fin&&(0!=i.fin||""!=i.fin)?a.filtro.fin=i.fin instanceof Date?i.fin:new Date(a.convertirFecha(i.fin)):a.filtro.fin=0,promesa=k(a.diagnostico.id,a.paciente.id,a.filtro),promesa.then(function(i){a.filtro.inicio=a.filtro.inicio instanceof Date?a.filtro.inicio.getDate()+"/"+(a.filtro.inicio.getMonth()+1)+"/"+a.filtro.inicio.getFullYear():"",a.filtro.fin=a.filtro.fin instanceof Date?a.filtro.fin.getDate()+"/"+(a.filtro.fin.getMonth()+1)+"/"+a.filtro.fin.getFullYear():"",a.listaHistorialDiagnosticoExamenes=i})},a.fecha_excel_angular=function(a){var i=new Date(1/1970),e=a-25568;return i.setTime(i.getTime()+864e5*e)},a.subirExcelPacientes=function(i){e.start();var o,n,t=i.target.files;for(n=t[o=0];o!=t.length;++o){var r=new FileReader;n.name;r.onload=function(i){var e=i.target.result,o=XLSX.read(e,{type:"binary"}),n=o.SheetNames[0],t=2,r=o.Sheets[n],c=[];do{var s={};s.codigo=void 0!=r["A"+t]&&""!=r["A"+t]?r["A"+t].v.toString():null,s.apellido_paterno=void 0!=r["B"+t]&&""!=r["B"+t]?r["B"+t].v.toString():null,s.apellido_materno=void 0!=r["C"+t]&&""!=r["C"+t]?r["C"+t].v.toString():null,s.nombres=void 0!=r["D"+t]&&""!=r["D"+t]?r["D"+t].v.toString():null,s.ci=void 0!=r["E"+t]&&""!=r["E"+t]?r["E"+t].v.toString():null,s.extension=void 0!=r["F"+t]&&""!=r["F"+t]?r["F"+t].v.toString():null,s.grupo_sanguineo=void 0!=r["G"+t]&&""!=r["G"+t]?r["G"+t].v.toString():null,s.fecha_nacimiento=void 0!=r["H"+t]&&""!=r["H"+t]?a.fecha_excel_angular(r["H"+t].v.toString()):null,s.genero=void 0!=r["I"+t]&&""!=r["I"+t]?r["I"+t].v.toString():null,s.telefono=void 0!=r["J"+t]&&""!=r["J"+t]?r["J"+t].v.toString():null,s.telefono2=void 0!=r["K"+t]&&""!=r["K"+t]?r["K"+t].v.toString():null,s.telefono_movil=void 0!=r["L"+t]&&""!=r["L"+t]?r["L"+t].v.toString():null,s.estilo_de_vida=void 0!=r["M"+t]&&""!=r["M"+t]?r["M"+t].v.toString():null,s.cargo=void 0!=r["N"+t]&&""!=r["N"+t]?r["N"+t].v.toString():null,s.designacion_empresa=void 0!=r["O"+t]&&""!=r["O"+t]?r["O"+t].v.toString():null,s.telefono_empresa=void 0!=r["P"+t]&&""!=r["P"+t]?r["P"+t].v.toString():null,s.campamento=void 0!=r["Q"+t]&&""!=r["Q"+t]?r["Q"+t].v.toString():null,s.riesgos_procesos_trabajo=void 0!=r["R"+t]&&""!=r["R"+t]?r["R"+t].v.toString():null,s.ciudad_referencia=void 0!=r["S"+t]&&""!=r["S"+t]?r["S"+t].v.toString():null,s.zona_referencia=void 0!=r["T"+t]&&""!=r["T"+t]?r["T"+t].v.toString():null,s.calle_av_referencia=void 0!=r["U"+t]&&""!=r["U"+t]?r["U"+t].v.toString():null,s.nro_referencia=void 0!=r["V"+t]&&""!=r["V"+t]?r["V"+t].v.toString():null,s.telefonos_referencia=void 0!=r["W"+t]&&""!=r["W"+t]?r["W"+t].v.toString():null,s.celular_referencia=void 0!=r["X"+t]&&""!=r["X"+t]?r["X"+t].v.toString():null,s.nombre_referencia=void 0!=r["Y"+t]&&""!=r["Y"+t]?r["Y"+t].v.toString():null,s.imagen="img/icon-user-default.png",c.push(s),t++,0,console.log}while(void 0!=r["A"+t]);a.guardarPacientes(c)},r.readAsBinaryString(n)}},a.guardarPacientes=function(i){new B({pacientes:i,id_empresa:a.usuario.id_empresa}).$save(function(i){a.mostrarMensaje(i.mensaje),a.recargarItemsTabla()}),e.stop()},a.subirExcelFichasTecnicas=function(i){e.start();var o,n,t=i.target.files;for(n=t[o=0];o!=t.length;++o){var r=new FileReader;n.name;r.onload=function(i){var e=i.target.result,o=XLSX.read(e,{type:"binary"}),n=o.SheetNames[0],t=2,r=o.Sheets[n],c=[];do{var s={};s.codigo=void 0!=r["A"+t]&&""!=r["A"+t]?r["A"+t].v.toString():null,s.fecha=void 0!=r["G"+t]&&""!=r["G"+t]?new Date(a.convertirFecha(r["G"+t].v.toString())):null,s.estilo_vida=void 0!=r["L"+t]&&""!=r["L"+t]?r["L"+t].v.toString():null,s.empresa=void 0!=r["M"+t]&&""!=r["M"+t]?r["M"+t].v.toString():null,s.telefono=void 0!=r["N"+t]&&""!=r["N"+t]?r["N"+t].v.toString():null,s.area_operacion=void 0!=r["O"+t]&&""!=r["O"+t]?r["O"+t].v.toString():null,s.actividad_laboral=void 0!=r["P"+t]&&""!=r["P"+t]?r["P"+t].v.toString():null,s.riesgo=void 0!=r["Q"+t]&&""!=r["Q"+t]?r["Q"+t].v.toString():null,s.ciudad_referencia=void 0!=r["R"+t]&&""!=r["R"+t]?r["R"+t].v.toString():null,s.zona_referencia=void 0!=r["S"+t]&&""!=r["S"+t]?r["S"+t].v.toString():null,s.calle_av_referencia=void 0!=r["T"+t]&&""!=r["T"+t]?r["T"+t].v.toString():null,s.numero_referencia=void 0!=r["U"+t]&&""!=r["U"+t]?r["U"+t].v.toString():null,s.telefono_referencia=void 0!=r["V"+t]&&""!=r["V"+t]?r["V"+t].v.toString():null,s.celular_referencia=void 0!=r["W"+t]&&""!=r["W"+t]?r["W"+t].v.toString():null,s.nombre_referencia=void 0!=r["X"+t]&&""!=r["X"+t]?r["X"+t].v.toString():null,s.tipo_control=void 0!=r["Y"+t]&&""!=r["Y"+t]?r["Y"+t].v.toString():null,s.grupo_sanguineo=void 0!=r["Z"+t]&&""!=r["Z"+t]?r["Z"+t].v.toString():null,s.alergia_humo_cigarrillo=void 0!=r["AA"+t]&&""!=r["AA"+t]&&"NO"!=r["AA"+t].v.toString(),s.alergia_quimico=void 0!=r["AB"+t]&&""!=r["AB"+t]&&"NO"!=r["AB"+t].v.toString(),s.alergia_medicamento=void 0!=r["AC"+t]&&""!=r["AC"+t]&&"NO"!=r["AC"+t].v.toString(),s.alergia_plantas=void 0!=r["AD"+t]&&""!=r["AD"+t]&&"NO"!=r["AD"+t].v.toString(),s.alergia_polvo=void 0!=r["AE"+t]&&""!=r["AE"+t]&&"NO"!=r["AE"+t].v.toString(),s.alergia_algun_material=void 0!=r["AF"+t]&&""!=r["AF"+t]&&"NO"!=r["AF"+t].v.toString(),s.alergia_alimentos=void 0!=r["AG"+t]&&""!=r["AG"+t]&&"NO"!=r["AG"+t].v.toString(),s.alergia_conservas=void 0!=r["AH"+t]&&""!=r["AH"+t]&&"NO"!=r["AH"+t].v.toString(),s.alergia_picadura=void 0!=r["AI"+t]&&""!=r["AI"+t]&&"NO"!=r["AI"+t].v.toString(),s.alergia_otros=void 0!=r["AJ"+t]&&""!=r["AJ"+t]&&"NO"!=r["AJ"+t].v.toString(),s.alergia_otros_comentario=void 0!=r["AL"+t]&&""!=r["AL"+t]?r["AL"+t].v.toString():null,s.enfermedad_hipertension=void 0!=r["AL"+t]&&""!=r["AL"+t]&&"NO"!=r["AL"+t].v.toString(),s.enfermedad_diabetes=void 0!=r["AM"+t]&&""!=r["AM"+t]&&"NO"!=r["AM"+t].v.toString(),s.enfermedad_epilepsia=void 0!=r["AN"+t]&&""!=r["AN"+t]&&"NO"!=r["AN"+t].v.toString(),s.enfermedad_asma=void 0!=r["AO"+t]&&""!=r["AO"+t]&&"NO"!=r["AO"+t].v.toString(),s.enfermedad_cardiologia=void 0!=r["AP"+t]&&""!=r["AP"+t]&&"NO"!=r["AP"+t].v.toString(),s.enfermedad_digestivas=void 0!=r["AQ"+t]&&""!=r["AQ"+t]&&"NO"!=r["AQ"+t].v.toString(),s.enfermedad_chagas=void 0!=r["AR"+t]&&""!=r["AR"+t]&&"NO"!=r["AR"+t].v.toString(),s.enfermedad_hepatitis=void 0!=r["AS"+t]&&""!=r["AS"+t]&&"NO"!=r["AS"+t].v.toString(),s.enfermedad_lumbalgia=void 0!=r["AT"+t]&&""!=r["AT"+t]&&"NO"!=r["AT"+t].v.toString(),s.enfermedad_otros=void 0!=r["AU"+t]&&""!=r["AU"+t]&&"NO"!=r["AU"+t].v.toString(),s.enfermedad_comentario=void 0!=r["AV"+t]&&""!=r["AV"+t]?r["AV"+t].v.toString():null,s.quirurgico_operado=void 0!=r["AW"+t]&&""!=r["AW"+t]&&"NO"!=r["AW"+t].v.toString(),s.quirurgico_comentario=void 0!=r["AX"+t]&&""!=r["AX"+t]?r["AX"+t].v.toString():null,s.es_donante=void 0!=r["AY"+t]&&""!=r["AY"+t]&&"NO"!=r["AY"+t].v.toString(),s.fecha=new Date(s.fecha),c.push(s),t++,0}while(void 0!=r["A"+t]);a.guardarfichasTecnicas(c)},r.readAsBinaryString(n)}},a.guardarfichasTecnicas=function(i){new W({fichas:i,id_empresa:a.usuario.id_empresa}).$save(function(i){a.mostrarMensaje(i.mensaje),a.recargarItemsTabla()},function(i){a.mostrarMensaje("Ocurrio un problema al momento de guardar!"),a.recargarItemsTabla()}),e.stop()},a.subirExcelSignosVitales=function(i){e.start();var o,n,t=i.target.files;for(n=t[o=0];o!=t.length;++o){var r=new FileReader;n.name;r.onload=function(i){var e=i.target.result,o=XLSX.read(e,{type:"binary"}),n=o.SheetNames[0],t=2,r=o.Sheets[n],c=[];do{var s={};s.codigo=void 0!=r["A"+t]&&""!=r["A"+t]?r["A"+t].v.toString():null,s.fecha=void 0!=r["G"+t]&&""!=r["G"+t]?r["G"+t].v.toString():null,s.presion=void 0!=r["H"+t]&&""!=r["H"+t]?r["H"+t].v.toString():null,s.pulso=void 0!=r["I"+t]&&""!=r["I"+t]?r["I"+t].v.toString():null,s.talla=void 0!=r["J"+t]&&""!=r["J"+t]?Math.round(parseFloat(r["J"+t].v.toString()),4):null,s.peso=void 0!=r["K"+t]&&""!=r["K"+t]?Math.round(parseFloat(r["K"+t].v.toString()),4):null,s.temperatura=void 0!=r["L"+t]&&""!=r["L"+t]?Math.round(parseFloat(r["L"+t].v.toString()),3):null,s.frecuencia_respiratoria=void 0!=r["M"+t]&&""!=r["M"+t]?r["M"+t].v.toString():null,s.fecha=new Date(s.fecha),c.push(s),t++,0}while(void 0!=r["A"+t]);a.guardarSignosVitales(c)},r.readAsBinaryString(n)}},a.guardarSignosVitales=function(i){new K({signosVitales:i,id_empresa:a.usuario.id_empresa}).$save(function(i){a.mostrarMensaje(i.mensaje),a.recargarItemsTabla()},function(i){a.mostrarMensaje("Ocurrio un problema al momento de guardar!"),a.recargarItemsTabla()}),e.stop()},a.guardarPacientes=function(i){new B({pacientes:i,id_empresa:a.usuario.id_empresa}).$save(function(i){a.mostrarMensaje(i.mensaje),a.recargarItemsTabla()},function(i){a.mostrarMensaje("Ocurrio un problema al momento de guardar!"),a.recargarItemsTabla()}),e.stop()},a.subirExcelSOAP=function(i){e.start();var o,n,t=i.target.files;for(n=t[o=0];o!=t.length;++o){var r=new FileReader;n.name;r.onload=function(i){var e=i.target.result,o=XLSX.read(e,{type:"binary"}),n=o.SheetNames[0],t=2,r=o.Sheets[n],c=[];do{var s={};s.codigo=void 0!=r["A"+t]&&""!=r["A"+t]?r["A"+t].v.toString():null,s.fecha=void 0!=r["F"+t]&&""!=r["F"+t]?r["F"+t].v.toString():null,s.subjetivo=void 0!=r["G"+t]&&""!=r["G"+t]?r["G"+t].v.toString():null,s.objetivo=void 0!=r["H"+t]&&""!=r["H"+t]?r["H"+t].v.toString():null,s.analitico=void 0!=r["I"+t]&&""!=r["I"+t]?r["I"+t].v.toString():null,s.plan=void 0!=r["J"+t]&&""!=r["J"+t]?r["J"+t].v.toString():null,s.evolucion=void 0!=r["K"+t]&&""!=r["K"+t]?r["K"+t].v.toString():null,s.fecha=new Date(s.fecha),c.push(s),t++,0}while(void 0!=r["A"+t]);a.guardarSOAPLista(c)},r.readAsBinaryString(n)}},a.guardarSOAPLista=function(i){new Q({SOAPLista:i,id_empresa:a.usuario.id_empresa}).$save(function(i){a.mostrarMensaje(i.mensaje),a.recargarItemsTabla()},function(i){a.mostrarMensaje("Ocurrio un problema al momento de guardar!"),a.recargarItemsTabla()}),e.stop()},a.subirExcelVacunasPacientes=function(i){e.start();var o,n,t=i.target.files;for(n=t[o=0];o!=t.length;++o){var r=new FileReader;n.name;r.onload=function(i){var e=i.target.result,o=XLSX.read(e,{type:"binary"}),n=o.SheetNames[0],t=2,r=o.Sheets[n],c=[];do{var s={};s.codigo=void 0!=r["A"+t]&&""!=r["A"+t]?r["A"+t].v.toString():null,s.nombre_vacuna=void 0!=r["F"+t]&&""!=r["F"+t]?r["F"+t].v.toString():null,s.dosis=void 0!=r["G"+t]&&""!=r["G"+t]?r["G"+t].v.toString():null,s.fecha=void 0!=r["H"+t]&&""!=r["H"+t]?a.fecha_excel_angular(r["H"+t].v.toString()):null,s.Estado=void 0!=r["I"+t]&&""!=r["I"+t]?r["I"+t].v.toString():null,c.push(s),t++,0}while(void 0!=r["A"+t]);a.guardarAplicacionVacunas(c)},r.readAsBinaryString(n)}},a.guardarAplicacionVacunas=function(i){new Z({pacientes:i,id_empresa:a.usuario.id_empresa}).$save(function(i){a.mostrarMensaje(i.mensaje),a.recargarItemsTabla()},function(i){a.mostrarMensaje("Ocurrio un problema al momento de guardar!"),a.recargarItemsTabla()}),e.stop()},a.inicio()}]);