angular.module("agil.servicios").factory("Diccionario",[function(){return{MOV_ING:"MOVING",MOV_EGR:"MOVEGR",ING_INV_INICIAL:"III",EGRE_FACTURACION:"FACT",EGRE_PRE_FACTURACION:"PREFACT",EGRE_BAJA:"BAJA",EGRE_PROFORMA:"PFR",EGRE_TRASPASO:"TRAS",EGRE_AJUSTE:"AJU",EGRE_COTIZACION:"COT",FACT_IMPRESION_VACIA:"VAC",FACT_IMPRESION_COMPLETA:"COMPL",FACT_IMPRESION_SEMICOMPLETA:"SEMICOMPL",FACT_PAPEL_OFICIO:"OFICIO",FACT_PAPEL_CARTA:"CARTA",FACT_PAPEL_MEDIOOFICIO:"MEDOFI",FACT_PAPEL_ROLLO:"ROLLO",FACT_PAPEL_CUARTOCARTA:"CARTACUARTO",TIPO_PAGO_CREDITO:"CREDITO",TIPO_PAGO_CONTADO:"CONTADO",CENTRO_COSTO_ALMACEN:"ALMACEN",ROL_ADMINISTRADOR:"ADMINISTRADOR",ROL_VENDEDOR:"VENDEDOR",ROL_OPERADOR:"OPERADOR",DIA_LUNES:"LUN19",DIA_MARTES:"MAR19",DIA_MIERCOLES:"MIE19",DIA_JUEVES:"JUE19",DIA_VIERNES:"VIE19",DIA_SABADO:"SAB19",DIA_DOMINGO:"DOM19",USUARIO_SUPERADMIN:"SUPER-ADMINISTRADOR",MENU_RUTAS:"RUTAS",MENU_SEGUIMIENTOAPP:"SEGUIMIENTO APP",MENU_APPMOVIL:"APP MOVIL",MENU_PANTALLACLIENTE:"PANTALLA CLIENTE",MENU_PANTALLADESPACHO:"PANTALLA DESPACHO",TIPO_PRODUCTO_BASE:"PBASE",TIPO_PRODUCTO_INTER:"PINTER",TIPO_PRODUCTO_FINAL:"PFINAL",DESTINO_CIERRE_BANCO:"DBANCO",DESTINO_CIERRE_CAJA:"CAJA",DESTINO_CIERRE_SIGUIENTETURNO:"SIGUIENTETURNO",ESTADO_MESA_OCUPADO:"OCU",ESTADO_MESA_DISPONIBLE:"DIS",ESTADO_MESA_RESERVADO:"RE",MENU_MESAS:"MESAS",MENU_PLAN_CUENTAS:"PLAN CUENTAS",MENU_COMPROBANTES:"COMPROBANTES",MENU_MEDICO:"PACIENTES",IVA_DF:"IVA DF",IVA_CF:"IVA CF",IT:"IT",IT_POR_PAGAR:"IT POR PAGAR",CAJA_BANCOS:"CAJA/BANCOS",COMPROBANTE_INGRESO:"INGRESO",COMPROBANTE_EGRESO:"EGRESO",COMPROBANTE_TRASPASO:"TRASPASO",COMPROBANTE_CAJA_CHICA:"CAJA CHICA",MENU_VEHICULOS:"VEHICULOS",MENU_PROFORMAS:"PROFORMAS",MENU_USUARIO:"USUARIOS",MENU_EMPRESA:"EMPRESAS",MENU_VENTA:"VENTAS",MENU_COMPRA:"COMPRAS",MENU_CONFIGURACION:"CONFIGURACIONES",MENU_REPORTE:"REPORTES",MENU_LIBRO_COMPRA:"LIBRO DE COMPRAS",MENU_LIBRO_VENTAS:"LIBRO DE VENTAS",MENU_REPORTE_VENTAS:"REPORTE DE VENTAS",MENU_REPORTE_COMPRAS:"REPORTE DE COMPRAS",MENU_ESTADO_RESULTADOS:"ESTADO DE RESULTADOS NO CONTABLE",MENU_ALMACEN:"ALMACENES",MENU_CERT_COD_CONTROL:"CERT. COD. DE CONTROL",MENU_ESTADO_CUENTAS_CLIENTES:"ESTADO DE CUENTAS CLIENTES",MENU_ESTADO_CUENTAS_PROVEEDORES:"ESTADO DE CUENTAS PROVEEDORES",MENU_PANTALLA:"PANTALLAS",MENU_DESPACHO:"DESPACHOS",MENU_CONCEPTO:"CONCEPTOS",MENU_DOSIFICACION:"DOSIFICACIONES",TIPO_CORRELATIVO_CLIENTES:"CORRELATIVO CLIENTES",TIPO_CORRELATIVO_DESTINOS:"CORRELATIVO DESTINOS",MOVING_INVENTARIO_INICIAL:"INGRESO POR INVENTARIO INICIAL",MOVING_POR_TRASPASO:"INGRESO POR TRASPASO",MOVING_POR_DEVOLUCION:"INGRESO POR DEVOLUCIÓN",MOVING_DIARIO:"INGRESO DIARIO",MOVING_POR_AJUSTE:"INGRESO POR AJUSTE",MOVING_POR_IMPORTACION:"INGRESO POR IMPORTACIÓN",MOVING_POR_RETENCION_SERVICIOS:"INGRESO POR RETENCIONES DE SERVICIOS",MOVING_POR_RETENCION_BIENES:"INGRESO POR RETENCIONES DE BIENES",MOVING_POR_COMPRA_SIN_FACTURA:"INGRESO POR COMPRA S/F",IT_RETENCION_BIEN:"IT RETENCION BIEN ALMACEN",IUE_RETENCION_BIEN:"IUE RETENCION BIEN ALMACEN",CUENTA_ALMACEN_RETENCION_BIEN:"CUENTA ALMACEN RETENCION BIEN",CUENTA_GASTO_RETENCION_BIEN:"CUENTA GASTO RETENCION BIEN",IT_RETENCION_BIEN_GASTO:"IT RETENCION BIEN GASTO",IUE_RETENCION_BIEN_GASTO:"IUE RETENCION BIEN GASTO",CUENTA_RETENCION_SERVICIO:"CUENTA RETENCION SERVICIO",IT_RETENCION_SERVICIO:"IT RETENCION SERVICIO",IUE_RETENCION_SERVICIO:"IUE RETENCION SERVICIO",CC_ESTADO_PROCESADO:"PROCESADO",CC_ESTADO_DESEMBOLSADO:"DESEMBOLSADO",CC_ESTADO_VERIFICADO:"VERIFICADO",CC_ESTADO_PENDIENTE:"PENDIENTE",CC_ESTADO_AUTORIZADO:"AUTORIZADO",CC_ESTADO_ANULADO:"ANULADO",CC_MOV_ANTICIPO:"ANTICIPO",EGRE_SERVICIO:"SERV"}}]).factory("VerificarDescuentos",[function(){return function(e){var t=!1;if(void 0!==e)for(var o=0;o<e.length;o++)(e[o].descuento>0||e[o].recargo>0||e[o].ice>0||e[o].excento>0)&&(t=!0);return t}}]).factory("ObtenerImagen",["$q",function(e){return function(t){var o=e.defer();return convertUrlToBase64Image(t,function(e){e.length>0&&"error"!==e?o.resolve(e):convertUrlToBase64Image("img/agilsoftware.png",function(e){if(e.length>0&&"error"!==e)return o.resolve(e),e;o.reject("No se encuentra la imagen.")})}),o.promise}}]).factory("NuevoComprobante",["blockUI","AsignarComprobanteFavorito","LibroMayorCuenta","ComprobanteRevisarPaginador","NuevoComprobanteContabilidad","ListaCuentasComprobanteContabilidad","ActualizarComprobanteContabilidad","ImprimirComprobante","DatosComprobante",function(e,t,o,a,n,i,r,c,l){return function(e,s,d,u,f,m,x,p,g,_,E,A,C,O,v){f&&(T=t(f)).then(function(t){e(t.mensaje),s.getSearch("",d)});if(m&&m.asiento.id)return T=o(m.asiento.id,m.fechaInicio,m.fechaFin);if(x)return s.filter.inicio,s.filter.fin,null==s.filter.inicio&&(s.filter.inicio=0,s.filter.fin=0),0!=s.filter.inicio&&(s.filter.inicio=new Date(p(d.inicio)),s.filter.fin=new Date(p(d.fin))),T=a(s);if(_){var I=new Date;if(_.fechaActual=new Date,_.id){for(_.importe=0,_.abierto=!1,h=0;h<_.asientosContables.length;h++)0!=(D=_.asientosContables[h]).activo&&""!=D.debe_bs&&(_.importe=Math.round(1e4*(_.importe+D.debe_bs))/1e4);_.fecha=new Date(p(_.fecha)),_.fecha.setHours(I.getHours()),_.fecha.setMinutes(I.getMinutes()),r.update({id_comprobante:_.id},_,function(t){A(u.id_empresa),C(u.id_empresa),e(t.mensaje),g(),O()}),console.log("falta agregar el put para guardar")}else{for(var h=0;h<_.asientosContables.length;h++){var D;0!=(D=_.asientosContables[h]).activo&&""!=D.debe_bs&&(_.importe=Math.round(1e4*(_.importe+D.debe_bs))/1e4)}_.fecha=new Date(p(_.fecha)),_.fecha.setHours(I.getHours()),_.fecha.setMinutes(I.getMinutes()),n.save(_,function(t){A(u.id_empresa),C(u.id_empresa),e(t.mensaje),l(t.comprobante.id).then(function(e){e.comprobante.importe_literal=e.importeLiteral,c(e.comprobante,!1,u,v)}),O(),g()})}}if(E&&""!=E&&void 0!=E){var T=i(u.id_empresa,E);return console.log(T),T}}}]).factory("ImprimirComprobante",["blockUI","DibujarCabeceraComprobante","Diccionario","DibujarCabeceraFacturaNVCartaOficio","DibujarCabeceraFacturaNVmedioOficio","$timeout",function(e,t,o,a,n,i){return function(o,a,n,r){var c=[],l=[],s={calculo:0,monto:0,texto1:"",texto2:"",texto3:"",cant:0},d={calculo:0,monto:0,texto1:"",texto2:"",texto3:"",cant:0};o.asientosContables.forEach(function(u,f,m){if(0!=u.debe_bs?c.push(u):l.push(u),u.cuenta.especifica&&(u.cuenta.tipo_especifica?(d.monto+=u.debe_bs,d.texto1=u.cuenta.especificaTexto1.nombre_corto,d.texto2=u.cuenta.especificaTexto2.nombre_corto,d.texto3=u.cuenta.especificaTexto3.nombre_corto,d.cant++,d.calculo=100*d.monto/13,d.calculo=r(d.calculo,2)):(s.monto+=u.haber_bs,s.texto1=u.cuenta.especificaTexto1.nombre_corto,s.texto2=u.cuenta.especificaTexto2.nombre_corto,s.texto3=u.cuenta.especificaTexto3.nombre_corto,s.cant++,s.calculo=100*s.monto/13,s.calculo=r(s.calculo,2))),f===m.length-1){var x=c.concat(l),p=new PDFDocument({compress:!1,size:[612,792],margin:10}),g=p.pipe(blobStream());p.font("Helvetica",8);var _=160,E=0,A=1,C=Math.ceil(x.length/19),O=0,v=0,I=0,h=0,D=new Date;if(a){t(p,a,n,o,A,C,d,s);for(var T=0;T<x.length&&E<=19;T++){u=x[T],p.rect(390,_,0,30).stroke(),p.rect(440,_,0,30).stroke(),p.rect(490,_,0,30).stroke(),p.rect(540,_,0,30).stroke(),p.font("Helvetica",7),p.text(u.cuenta.codigo,28,_+5),p.font("Helvetica-Bold",7),u.cuenta.tipoAuxiliar&&p.text(u.cuentaAux.nombre,28,_+13,{width:80}),p.font("Helvetica-Bold",7),p.text(u.cuenta.nombre,120,_+5,{width:190,underline:!0}),p.font("Helvetica",7),p.text(u.glosa,125,_+13,{width:190}),u.centroCosto&&p.text(u.centroCosto.nombre,310,_+5),p.text("",350,_+5);var b=r(u.debe_bs,2),V=r(u.haber_bs,2);"0.00"!=b&&p.text(b,395,_+5),"0.00"!=V&&p.text(V,445,_+5);var F=r(u.debe_sus,2),N=r(u.haber_sus,2);"0.00"!=F&&p.text(F,500,_+5),"0.00"!=V&&p.text(N,545,_+5),O+=0+u.debe_bs,v+=0+u.haber_bs,I+=0+u.debe_sus,h+=0+u.haber_sus,_+=30,++E>19&&(p.addPage({size:[612,792],margin:10}),_=160,E=0,t(p,a,n,o,A+=1,C,d,s))}p.font("Helvetica-Bold",7),p.text("SUMA TOTAL:",330,_+5),O=r(O,2),v=r(v,2),p.text(O,395,_+5),p.text(v,445,_+5),h=r(h,2),I=r(I,2),p.text(I,500,_+5),p.text(h,545,_+5),p.rect(20,_,571,0).stroke(),p.rect(20,_+20,571,0).stroke(),p.rect(390,_,0,20).stroke(),p.rect(440,_,0,20).stroke(),p.rect(490,_,0,20).stroke(),p.rect(540,_,0,20).stroke()}else{for(t(p,a,n,o,A,C,d,s),T=0;T<x.length&&E<=19;T++)u=x[T],p.rect(450,_,0,30).stroke(),p.rect(520,_,0,30).stroke(),p.font("Helvetica",7),p.text(u.cuenta.codigo,38,_+5),p.font("Helvetica-Bold",7),u.cuenta.tipoAuxiliar&&u.cuentaAux&&p.text(u.cuentaAux.nombre,38,_+13,{width:80}),p.font("Helvetica-Bold",7),p.text(u.cuenta.nombre,130,_+5,{width:190,underline:!0}),p.font("Helvetica",7),p.text(u.glosa,135,_+13,{width:190}),u.centroCosto&&p.text(u.centroCosto.nombre,340,_+5),p.text("",380,_+5),b=r(u.debe_bs,2),V=r(u.haber_bs,2),"0.00"!=b&&p.text(b,470,_+5),"0.00"!=V&&p.text(V,540,_+5),O+=0+u.debe_bs,v+=0+u.haber_bs,_+=30,++E>19&&(p.rect(450,_,0,2).stroke(),p.rect(520,_,0,2).stroke(),p.addPage({size:[612,792],margin:10}),_=160,E=0,t(p,a,n,o,A+=1,C,d,s));p.font("Helvetica-Bold",7),p.text("SUMA TOTAL:",390,_+5),p.font("Helvetica",7),O=r(O,2),v=r(v,2),p.text(O,470,_+5),p.text(v,540,_+5),p.rect(20,_,571,0).stroke(),p.rect(20,_+20,571,0).stroke(),p.font("Helvetica-Bold",7),p.rect(450,_,0,20).stroke(),p.rect(520,_,0,20).stroke()}if(p.text("Son:",38,_+25),p.font("Helvetica",7),p.text(o.importe_literal,60,_+25),p.rect(20,_+40,571,0).stroke(),"TRASPASO"==o.tipoComprobante.nombre){p.rect(20,720,571,0).stroke(),p.font("Helvetica-Bold",7),p.text("Preparado por:",38,725),p.font("Helvetica",7),p.text(n.persona.nombre_completo,38,735),p.rect(200,720,0,42).stroke();var P=(R=new Date(o.fecha_creacion)).getMonth()+1;(M=R.getMinutes())<10&&(M="0"+R.getMinutes()),(w=R.getHours())<10&&(w="0"+R.getHours()),(L=R.getSeconds())<10&&(L="0"+R.getSeconds()),P<10?p.text(+R.getDate()+"/0"+P+"/"+R.getFullYear()+"         "+w+":"+M+":"+L,58,752):p.text(+R.getDate()+"/"+P+"/"+R.getFullYear()+"         "+w+":"+M+":"+L,58,752);var S=D.getMonth()+1;(U=D.getMinutes())<10&&(U="0"+D.getMinutes()),(H=D.getHours())<10&&(H="0"+D.getHours()),(B=D.getSeconds())<10&&(B="0"+D.getSeconds()),S<10?p.text("IMP.:"+D.getDate()+"/0"+S+"/"+D.getFullYear()+"         "+H+":"+U+":"+B,38,765):p.text("IMP.:"+D.getDate()+"/"+S+"/"+D.getFullYear()+"         "+H+":"+U+":"+B,38,765),p.text("Revisado",290,752),p.text("Autorizado",480,752),p.rect(410,720,0,42).stroke(),p.rect(20,750,571,0).stroke()}else{var R,M,w,L,U,H,B;p.rect(20,720,571,0).stroke(),p.font("Helvetica-Bold",7),p.text("Preparado por:",38,725),p.font("Helvetica",7),p.text(n.persona.nombre_completo,38,735),p.rect(200,720,0,42).stroke(),P=(R=new Date(o.fecha_creacion)).getMonth()+1,(M=R.getMinutes())<10&&(M="0"+R.getMinutes()),(w=R.getHours())<10&&(w="0"+R.getHours()),(L=R.getSeconds())<10&&(L="0"+R.getSeconds()),P<10?p.text(+R.getDate()+"/0"+P+"/"+R.getFullYear()+"         "+w+":"+M+":"+L,58,752):p.text(+R.getDate()+"/"+P+"/"+R.getFullYear()+"         "+w+":"+M+":"+L,58,752),S=D.getMonth()+1,(U=D.getMinutes())<10&&(U="0"+D.getMinutes()),(H=D.getHours())<10&&(H="0"+D.getHours()),(B=D.getSeconds())<10&&(B="0"+D.getSeconds()),S<10?p.text("IMP.:"+D.getDate()+"/0"+S+"/"+D.getFullYear()+"         "+H+":"+U+":"+B,38,765):p.text("IMP.:"+D.getDate()+"/"+S+"/"+D.getFullYear()+"         "+H+":"+U+":"+B,38,765),p.text("Revisado",240,752),p.text("Autorizado",350,752),p.text("Recibio conforme:",425,740),p.text("CI:",425,752),p.rect(310,720,0,42).stroke(),p.rect(420,720,0,42).stroke(),p.rect(20,750,571,0).stroke()}p.end(),g.on("finish",function(){var e=g.toBlobURL("application/pdf"),t=window.open(e,"_blank","location=no");i(function(){t.print()},500)}),e.stop()}})}}]).factory("DibujarCabeceraComprobante",[function(){return function(e,t,o,a,n,i,r,c){var l,s=new Date(a.fecha);console.log(o),t?(e.rect(20,30,571,732).stroke(),e.font("Helvetica-Bold",8),e.text(o.empresa.razon_social,25,35),e.text("SISTEMA DE CONTABILIDAD.",25,50),e.text("NIT: ",25,65),e.font("Helvetica",8),e.text(o.empresa.nit+".",50,65),e.font("Helvetica-Bold",14),e.text("COMPROBANTE DE "+a.tipoComprobante.nombre,0,75,{align:"center"}),e.font("Helvetica",8),e.text(n+" de: "+i,545,35),e.font("Helvetica-Bold",8),e.text("Gestión: "+s.getFullYear(),515,50),e.font("Helvetica-Bold",12),e.text("N°: ",535,65),e.font("Helvetica",12),e.text(a.numero,555,65),e.rect(20,90,571,0).stroke(),e.font("Helvetica",8),e.text(a.gloza,68,105),e.font("Helvetica-Bold",8),(l=s.getMonth()+1)<10?e.text("Fecha: "+s.getDate()+"/0"+l+"/"+s.getFullYear(),500,95):e.text("Fecha: "+s.getDate()+"/"+l+"/"+s.getFullYear(),500,95),e.text("T. Cambio: ",500,105),e.font("Helvetica",8),e.text(a.tipoCambio.dolar,545,105),r.cant>0&&0==c.cant&&e.text(r.texto1+" "+r.monto+"    "+r.texto2+" "+r.calculo+"    "+r.texto3+" "+r.cant,400,120),c.cant>0&&0==r.cant&&e.text(c.texto1+" "+c.monto+"    "+c.texto2+" "+c.calculo+"    "+c.texto3+" "+c.cant,400,120),c.cant>0&&r.cant>0&&e.text(c.texto1+" "+c.monto+"    "+c.texto2+" "+c.calculo+"    "+c.texto3+" "+c.cant+"     "+r.texto1+" "+r.monto+"    "+r.texto2+" "+r.calculo+"    "+r.texto3+" "+r.cant,350,120),e.font("Helvetica-Bold",8),e.rect(20,130,571,0).stroke(),e.font("Helvetica-Bold",8),e.text("Cuenta",45,145),e.text("Descripcion/Glosa",140,145),e.text("C.Costo",310,145),e.text("ref",350,145),e.rect(20,160,571,0).stroke(),e.rect(390,130,0,30).stroke(),e.rect(440,145,0,15).stroke(),e.rect(390,145,200,0).stroke(),e.text("BOLIVIANOS",415,137),e.text("Debe",405,150),e.text("Haber",455,150),e.rect(490,130,0,30).stroke(),e.rect(540,145,0,15).stroke(),e.text("DOLARES",520,137),e.text("Debe",505,150),e.text("Haber",550,150)):(e.rect(20,30,571,732).stroke(),e.font("Helvetica-Bold",8),e.text(o.empresa.razon_social,25,35),e.text("SISTEMA DE CONTABILIDAD.",25,50),e.text("NIT: ",25,65),e.font("Helvetica",8),e.text(o.empresa.nit+".",50,65),e.font("Helvetica-Bold",14),e.text("COMPROBANTE DE "+a.tipoComprobante.nombre,0,75,{align:"center"}),e.font("Helvetica",8),e.text(n+" de: "+i,545,35),e.font("Helvetica-Bold",8),e.text("Gestión: "+s.getFullYear(),515,50),e.font("Helvetica-Bold",12),e.text("N°: ",535,65),e.font("Helvetica",12),e.text(a.numero,555,65),e.rect(20,90,571,0).stroke(),e.font("Helvetica",8),e.text(a.gloza,38,105),e.font("Helvetica-Bold",8),(l=s.getMonth()+1)<10?e.text("Fecha: "+s.getDate()+"/0"+l+"/"+s.getFullYear(),500,95):e.text("Fecha: "+s.getDate()+"/"+l+"/"+s.getFullYear(),500,95),e.text("T. Cambio: ",500,105),e.font("Helvetica",8),e.text(a.tipoCambio.dolar,545,105),r.cant>0&&0==c.cant&&e.text(r.texto1+" "+r.monto+"    "+r.texto2+" "+r.calculo+"    "+r.texto3+" "+r.cant,400,120),c.cant>0&&0==r.cant&&e.text(c.texto1+" "+c.monto+"    "+c.texto2+" "+c.calculo+"    "+c.texto3+" "+c.cant,400,120),c.cant>0&&r.cant>0&&e.text(c.texto1+" "+c.monto+"    "+c.texto2+" "+c.calculo+"    "+c.texto3+" "+c.cant+"     "+r.texto1+" "+r.monto+"    "+r.texto2+" "+r.calculo+"    "+r.texto3+" "+r.cant,350,120),e.font("Helvetica-Bold",8),e.rect(20,130,571,0).stroke(),e.text("Cuenta",50,145),e.text("Descripcion/Glosa",150,145),e.text("C.Costo",340,145),e.text("ref",405,145),e.text("BOLIVIANOS",500,135),e.rect(450,145,140,0).stroke(),e.rect(20,160,571,0).stroke(),e.rect(450,130,0,30).stroke(),e.rect(520,145,0,15).stroke(),e.text("Debe",475,150),e.text("Haber",545,150))}}]).factory("ComprasComprobante",["$resource",function(e){return e(restServer+"comprasComprobante")}]).factory("CuentasAuxiliares",["$resource",function(e){return e(restServer+"cuentas-auxiliares/empresa/:id_empresa/tipo/:tipo")}]).factory("ListasCuentasAuxiliares",["CuentasAuxiliares","$q",function(e,t){return function(o,a){var n=t.defer();return e.query({id_empresa:o,tipo:a},function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}}]).factory("ComprobanteTotalGeneral",["$resource",function(e){return e(restServer+"comprobantes/totalGeneral/empresa/:id_empresa")}]).factory("ComprobanteTotalGeneralEmpresa",["ComprobanteTotalGeneral","$q",function(e,t){return function(o){var a=t.defer();return e.get({id_empresa:o},function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise}}]).factory("ComprobanteRevisarDatosPaginador",["$resource",function(e){return e(restServer+"comprobantes/empresa/:id_empresa/pagina/:pagina/items-pagina/:items_pagina/fecha-inicio/:inicio/fecha-fin/:fin/columna/:columna/direccion/:direccion/busqueda/:texto_busqueda")}]).factory("ComprobanteRevisarPaginador",["ComprobanteRevisarDatosPaginador","$q",function(e,t){return function(o){var a=t.defer();return e.get({id_empresa:o.filter.empresa,pagina:o.currentPage,items_pagina:o.itemsPerPage,inicio:o.filter.inicio,fin:o.filter.fin,columna:o.column,direccion:o.direction,texto_busqueda:o.search},function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise}}]).factory("CuentasComprobanteContabilidad",["$resource",function(e){return e(restServer+"comprobante-cuenta/empresa/:id_empresa/busqueda/:buscar",{id_empresa:"@id_empresa",buscar:"@buscar"},{update:{method:"PUT"}})}]).factory("ListaCuentasComprobanteContabilidad",["CuentasComprobanteContabilidad","$q",function(e,t){return function(o,a){var n=t.defer();return e.query({id_empresa:o,buscar:a},function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}}]).factory("ComprobanteEmpresaPaginador",["$resource",function(e){return e(restServer+"comprobantes/empresa/:id_empresa/pagina/:pagina/items-pagina/:items_pagina/fecha-inicio/:inicio/fecha-fin/:fin/columna/:columna/direccion/:direccion/monto/:monto/tipo-comprobante/:tipo_comprobante/sucursal/:sucursal/usuario/:usuario/numero/:numero/busqueda/:busqueda")}]).factory("ComprobantePaginador",["ComprobanteEmpresaPaginador","$q",function(e,t){return function(o){null==o.filter.monto&&(o.filter.monto=0),null==o.filter.tipo_comprobante&&(o.filter.tipo_comprobante=0),null==o.filter.sucursal&&(o.filter.sucursal=0),null==o.filter.usuario&&(o.filter.usuario=0),null==o.filter.numero&&(o.filter.numero=0);var a=t.defer();return e.get({id_empresa:o.filter.empresa,pagina:o.currentPage,items_pagina:o.itemsPerPage,inicio:o.filter.inicio,fin:o.filter.fin,columna:o.column,direccion:o.direction,monto:o.filter.monto,tipo_comprobante:o.filter.tipo_comprobante,sucursal:o.filter.sucursal,usuario:o.filter.usuario,numero:o.filter.numero,busqueda:o.search},function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise}}]).factory("LibroMayor",["$resource",function(e){return e(restServer+"/comprobante-cuenta/:id_cuenta/periodo/:inicio/:fin")}]).factory("LibroMayorCuenta",["LibroMayor","$q",function(e,t){return function(o,a,n){var i=t.defer();return e.get({id_cuenta:o,inicio:a,fin:n},function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise}}]).factory("ComprobanteFavorito",["$resource",function(e){return e(restServer+"comprobante-contabilidad/favorito/:id_comprobante",{id_comprobante:"@id_comprobante"},{update:{method:"PUT"}})}]).factory("AsignarComprobanteFavorito",["ComprobanteFavorito","$q",function(e,t){return function(o){var a=t.defer();return e.update({id_comprobante:o},function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise}}]).factory("AsientosComprobanteContabilidad",["$resource",function(e){return e(restServer+"comprobante-cuenta/asientos/:id_cuenta",{id_cuenta:"@id_cuenta"},{update:{method:"PUT"}})}]).factory("FormatoImpresion",["$resource",function(e){return e(restServer+"tipos/:nombre_corto",{nombre_corto:"@nombre_corto"},{update:{method:"PUT"}})}]).factory("IdsFormatoImpresion",["FormatoImpresion","$q",function(e,t){return function(){var o=t.defer();return e.get({nombre_corto:"FORM_IMP_FAC"},function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise}}]).factory("ListaAsientosComprobanteContabilidad",["AsientosComprobanteContabilidad","$q",function(e,t){return function(o){var a=t.defer();return e.query({id_cuenta:o},function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise}}]).factory("NuevoComprobanteContabilidad",["$resource",function(e){return e(restServer+"comprobante-contabolidad",{update:{method:"PUT"}})}]).factory("ActualizarComprobanteContabilidad",["$resource",function(e){return e(restServer+"comprobante-contabolidad/:id_comprobante",{id_comprobante:"@id_comprobante"},{update:{method:"PUT"}})}]).factory("DatosComprobante",["ActualizarComprobanteContabilidad","$q",function(e,t){return function(o){var a=t.defer();return e.get({id_comprobante:o},function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise}}]).factory("EliminarComprobante",["ActualizarComprobanteContabilidad","$q",function(e,t){return function(o){var a=t.defer();return e.save({id_comprobante:o},function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise}}]).factory("ImprimirSalida",["Diccionario","ImprimirFactura","ImprimirProforma","ImprimirNotaBaja","ImprimirNotaTraspaso","ImprimirServicio",function(e,t,o,a,n,i){return function(r,c,l,s,d){r==e.EGRE_FACTURACION?t(c,l,s):r==e.EGRE_PROFORMA?o(c,l,s,d):r==e.EGRE_BAJA?a(c,s):r==e.EGRE_TRASPASO?n(c,s):r==e.EGRE_SERVICIO&&i(c,l,s)}}]).factory("ImprimirFactura",["Diccionario","ImprimirFacturaCartaOficio","ImprimirFacturaCartaOficioSinFormato","ImprimirPedido","ImprimirFacturaRollo","$timeout",function(e,t,o,a,n,i){return function(o,r,c,l){var s,d,u;if(o.configuracion.formatoColor=o.configuracion.formatoColorFactura,o.configuracion.formatoPapel=o.configuracion.formatoPapelFactura,o.configuracion.color1=o.configuracion.color_cabecera_factura,o.configuracion.color2=o.configuracion.color_detalle_factura,o.configuracion.nota=o.configuracion.nota_factura_bien?o.configuracion.nota_factura_bien:"",o.configuracion.tamanoPapelFactura.nombre_corto==e.FACT_PAPEL_OFICIO)s=[612,936],o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_VACIA?t(o,s,!0,!1,!1,c):o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_COMPLETA?t(o,s,!1,!0,!1,c):o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_SEMICOMPLETA&&t(o,s,!1,!1,!0);else if(o.configuracion.tamanoPapelFactura.nombre_corto==e.FACT_PAPEL_CARTA)s=[612,792],o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_VACIA?t(o,s,!0,!1,!1,c):o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_COMPLETA?t(o,s,!1,!0,!1,c):o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_SEMICOMPLETA&&t(o,s,!1,!1,!0,c);else if(o.configuracion.tamanoPapelFactura.nombre_corto==e.FACT_PAPEL_MEDIOOFICIO)s=[612,468],o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_VACIA?t(o,s,!0,!1,!1,c):o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_COMPLETA?t(o,s,!1,!0,!1,c):o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_SEMICOMPLETA&&t(o,s,!1,!1,!0,c);else if(o.configuracion.tamanoPapelFactura.nombre_corto==e.FACT_PAPEL_ROLLO){if(s=[227,o.detallesVenta.length<=2?610:610+20*(o.detallesVenta.length-2)],r&&!o.configuracion.imprimir_al_guardar){if(c.empresa.usar_pedidos){var f=230+20*o.detallesVenta.length;d=new PDFDocument({compress:!1,size:[227,f],margins:{top:10,bottom:10,left:20,right:20}}),u=d.pipe(blobStream()),a(o,r,d,u,f,c,!1)}}else d=new PDFDocument({compress:!1,size:s,margins:{top:0,bottom:0,left:20,right:20}}),u=d.pipe(blobStream()),n(o,s,d,u,c),c.empresa.usar_pedidos&&(f=230+20*o.detallesVenta.length,d.addPage({size:[227,f],margins:{top:10,bottom:10,left:20,right:20}}),a(o,r,d,u,f,c,!1));d&&u&&(d.end(),u.on("finish",function(){var e=u.toBlobURL("application/pdf"),t=window.open(e,"_blank","location=no");i(function(){t.print()},500)}))}}}]).factory("ImprimirServicio",["Diccionario","ImprimirFacturaCartaOficio","ImprimirFacturaCartaOficioSinFormato","ImprimirPedido","ImprimirFacturaRollo","$timeout",function(e,t,o,a,n,i){return function(o,r,c){var l,s,d;if(o.configuracion.formatoColor=o.configuracion.formatoColorFacturaServicio,o.configuracion.formatoPapel=o.configuracion.formatoPapelFacturaServicio,o.configuracion.color1=o.configuracion.color_cabecera_factura_servicio,o.configuracion.color2=o.configuracion.color_detalle_factura_servicio,o.configuracion.nota=o.configuracion.nota_factura_servicio?o.configuracion.nota_factura_servicio:"",o.configuracion.tamanoPapelFacturaServicio.nombre_corto==e.FACT_PAPEL_OFICIO)l=[612,936],o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_VACIA?t(o,l,!0,!1,!1,c):o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_COMPLETA?t(o,l,!1,!0,!1,c):o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_SEMICOMPLETA&&t(o,l,!1,!1,!0);else if(o.configuracion.tamanoPapelFacturaServicio.nombre_corto==e.FACT_PAPEL_CARTA)l=[612,792],o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_VACIA?t(o,l,!0,!1,!1,c):o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_COMPLETA?t(o,l,!1,!0,!1,c):o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_SEMICOMPLETA&&t(o,l,!1,!1,!0,c);else if(o.configuracion.tamanoPapelFacturaServicio.nombre_corto==e.FACT_PAPEL_MEDIOOFICIO)l=[612,468],o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_VACIA?t(o,l,!0,!1,!1,c):o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_COMPLETA?t(o,l,!1,!0,!1,c):o.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_SEMICOMPLETA&&t(o,l,!1,!1,!0,c);else if(o.configuracion.tamanoPapelFacturaServicio.nombre_corto==e.FACT_PAPEL_ROLLO){if(l=[227,o.detallesVenta.length<=2?610:610+20*(o.detallesVenta.length-2)],r&&!o.configuracion.imprimir_al_guardar){if(c.empresa.usar_pedidos){var u=230+20*o.detallesVenta.length;s=new PDFDocument({compress:!1,size:[227,u],margins:{top:10,bottom:10,left:20,right:20}}),d=s.pipe(blobStream()),a(o,r,s,d,u,c,!1)}}else s=new PDFDocument({compress:!1,size:l,margins:{top:0,bottom:0,left:20,right:20}}),d=s.pipe(blobStream()),n(o,l,s,d,c),c.empresa.usar_pedidos&&(u=230+20*o.detallesVenta.length,s.addPage({size:[227,u],margins:{top:10,bottom:10,left:20,right:20}}),a(o,r,s,d,u,c,!1));s&&d&&(s.end(),d.on("finish",function(){var e=d.toBlobURL("application/pdf"),t=window.open(e,"_blank","location=no");i(function(){t.print()},500)}))}}}]).factory("ImprimirFacturaCartaOficio",["blockUI","VerificarDescuentos","Diccionario","DibujarCabeceraFacturaNVCartaOficio","DibujarCabeceraFacturaNVmedioOficio","$timeout",function(e,t,o,a,n,i){return function(r,c,l,s,d,u){var f=new PDFDocument({compress:!1,size:c,margin:10}),m=f.pipe(blobStream());if(r.configuracion.usar_pf){var x=0;r.configuracion.tamanoPapelFactura.nombre_corto==o.FACT_PAPEL_OFICIO?x=19:r.configuracion.tamanoPapelFactura.nombre_corto==o.FACT_PAPEL_CARTA?x=16:r.configuracion.tamanoPapelFactura.nombre_corto==o.FACT_PAPEL_MEDIOOFICIO&&(x=3);var p=240,g=0,_=1,E=Math.ceil(r.detallesVenta.length/x);a(f,l,s,r,c,_,E,u);for(var A=0;A<r.detallesVenta.length&&g<=x;A++){if(f.font("Helvetica",8),r.detallesVenta[A].producto){r.detallesVenta[A].fecha_vencimiento=new Date(r.detallesVenta[A].fecha_vencimiento);var C=r.detallesVenta[A].fecha_vencimiento.getDate()+"/"+(r.detallesVenta[A].fecha_vencimiento.getMonth()+1)+"/"+r.detallesVenta[A].fecha_vencimiento.getFullYear().toString().substring(2);f.text(r.detallesVenta[A].producto.codigo,55,p,{width:70}),f.text(r.detallesVenta[A].cantidad,135,p),f.text(r.detallesVenta[A].producto.unidad_medida,160,p-3,{width:43});var O=(T=r.detallesVenta[A].producto.nombre.length)<=24?p:T>24&&T<=60?p-4:p-11;f.text(r.detallesVenta[A].producto.nombre,198,O,{width:130}),r.con_vencimiento&&("SERIE"==r.configuracion.tipoConfiguracion.nombre_corto?f.text(r.detallesVenta[A].lote,380,p):(f.text(C,340,p),f.text(r.detallesVenta[A].lote,380,p))),f.text(r.detallesVenta[A].precio_unitario.toFixed(2),450,p),f.text(r.detallesVenta[A].total.toFixed(2),530,p),(s||l)&&"FORM_C_MAR"==r.configuracion.formatoPapel.nombre_corto&&f.rect(50,p-15,520,30).stroke()}else r.detallesVenta[A].servicio&&(r.detallesVenta[A].fecha_vencimiento=new Date(r.detallesVenta[A].fecha_vencimiento),C=r.detallesVenta[A].fecha_vencimiento.getDate()+"/"+(r.detallesVenta[A].fecha_vencimiento.getMonth()+1)+"/"+r.detallesVenta[A].fecha_vencimiento.getFullYear().toString().substring(2),f.text(r.detallesVenta[A].servicio.codigo,55,p,{width:70}),f.text(r.detallesVenta[A].cantidad,130,p),O=(T=r.detallesVenta[A].servicio.nombre.length)<=24?p:T>24&&T<=60?p-4:p-11,f.text(r.detallesVenta[A].servicio.nombre,198,O,{width:130}),r.con_vencimiento&&(f.text(C,340,p),f.text(r.detallesVenta[A].lote,380,p)),f.text(r.detallesVenta[A].importe.toFixed(2),450,p),f.text(r.detallesVenta[A].total.toFixed(2),530,p),(s||l)&&"FORM_C_MAR"==r.configuracion.formatoPapel.nombre_corto&&f.rect(50,p-15,520,30).stroke());p+=30,++g==x&&(f.addPage({size:c,margin:10}),p=240,g=0,a(f,l,s,r,c,_+=1,E,u))}(s||l)&&(f.font("Helvetica-Bold",8),f.text("TOTAL",485,p)),f.font("Helvetica",8),f.text(r.total.toFixed(2),530,p),f.text("SON : "+r.numero_literal,55,p),(s||l)&&f.rect(50,p-15,520,30).stroke();var v=new Date,I=v.getMinutes();I<10&&(I="0"+I),f.text("usuario : "+u.nombre_usuario,55,p+20),f.text("fecha : "+v.getDate()+"/"+(v.getMonth()+1)+"/"+v.getFullYear()+"  "+v.getHours()+":"+I,180,p+20)}else{var h=document.getElementById("qr-code"),D=t(r.detallesVenta);for(f.font("Helvetica",8),x=0,r.configuracion.tamanoPapelFactura.nombre_corto==o.FACT_PAPEL_OFICIO?x=19:r.configuracion.tamanoPapelFactura.nombre_corto==o.FACT_PAPEL_CARTA?x=16:r.configuracion.tamanoPapelFactura.nombre_corto==o.FACT_PAPEL_MEDIOOFICIO&&(x=3),void 0!==r.detallesVenta?r.detallesVenta:r.detallesProformas,p=240,g=0,_=1,E=Math.ceil(r.detallesVenta.length/x),n(f,l,s,r,c,_,E,u,o),A=0;A<r.detallesVenta.length&&g<=x;A++){if(f.font("Helvetica",8),r.detallesVenta[A].producto)D?(f.text(r.detallesVenta[A].producto.codigo,55,p),f.text(r.detallesVenta[A].cantidad,115,p),f.text(r.detallesVenta[A].producto.unidad_medida,140,p),f.text(r.detallesVenta[A].producto.nombre,180,p-6,{width:120}),f.text(r.detallesVenta[A].precio_unitario.toFixed(2),300,p),f.text(r.detallesVenta[A].importe.toFixed(2),335,p),f.text(r.detallesVenta[A].tipo_descuento?"%":"Bs",385,p-10),f.text(r.detallesVenta[A].descuento.toFixed(2),385,p),f.text(r.detallesVenta[A].tipo_recargo?"%":"Bs",420,p-10),f.text(r.detallesVenta[A].recargo.toFixed(2),420,p),f.text(r.detallesVenta[A].ice.toFixed(2),455,p),f.text(r.detallesVenta[A].excento.toFixed(2),490,p),f.text(r.detallesVenta[A].total.toFixed(2),520,p)):(f.text(r.detallesVenta[A].producto.codigo,55,p),f.text(r.detallesVenta[A].cantidad,110,p),f.text(r.detallesVenta[A].producto.unidad_medida,165,p),O=(T=r.detallesVenta[A].producto.nombre.length)<=45?p:T>45&&T<=90?p-4:p-11,f.text(r.detallesVenta[A].producto.nombre,220,O,{width:225}),f.text(r.detallesVenta[A].precio_unitario.toFixed(2),450,p),f.text(r.detallesVenta[A].total.toFixed(2),520,p));else if(r.movimiento&&(r.movimientoServicio=r.movimiento.nombre_corto==o.EGRE_SERVICIO?r.movimiento:null),r.movimientoServicio)r.detallesVenta[A].fecha_vencimiento=new Date(r.detallesVenta[A].fecha_vencimiento),C=r.detallesVenta[A].fecha_vencimiento.getDate()+"/"+(r.detallesVenta[A].fecha_vencimiento.getMonth()+1)+"/"+r.detallesVenta[A].fecha_vencimiento.getFullYear().toString().substring(2),D?(O=(T=r.detallesVenta[A].observaciones.length)<=24?p:T>24&&T<=60?p-4:p-11,f.text(r.detallesVenta[A].observaciones,55,O,{width:300}),f.text(r.detallesVenta[A].importe.toFixed(2),335,p),f.text(r.detallesVenta[A].descuento.toFixed(2),385,p),f.text(r.detallesVenta[A].recargo.toFixed(2),420,p),f.text(r.detallesVenta[A].ice.toFixed(2),455,p),f.text(r.detallesVenta[A].excento.toFixed(2),490,p),f.text(r.detallesVenta[A].total.toFixed(2),530,p),(s||l)&&"FORM_C_MAR"==r.configuracion.formatoPapel.nombre_corto&&f.rect(50,p-15,520,30).stroke()):(O=(T=r.detallesVenta[A].observaciones.length)<=24?p:T>24&&T<=60?p-4:p-11,f.text(r.detallesVenta[A].observaciones,55,O,{width:400}),f.text(r.detallesVenta[A].importe.toFixed(2),450,p),f.text(r.detallesVenta[A].total.toFixed(2),530,p),(s||l)&&"FORM_C_MAR"==r.configuracion.formatoPapel.nombre_corto&&f.rect(50,p-15,520,30).stroke());else if(D)f.text(r.detallesVenta[A].servicio.codigo,55,p),f.text(r.detallesVenta[A].cantidad,115,p),f.text(r.detallesVenta[A].observaciones,180,p-6,{width:120}),f.text(r.detallesVenta[A].precio_unitario.toFixed(2),300,p),f.text(r.detallesVenta[A].importe.toFixed(2),335,p),f.text(r.detallesVenta[A].total.toFixed(2),520,p);else{var T;f.text(r.detallesVenta[A].servicio.codigo,55,p),f.text(r.detallesVenta[A].cantidad,110,p),O=(T=r.detallesVenta[A].servicio.nombre.length)<=45?p:T>45&&T<=90?p-4:p-11,f.text(r.detallesVenta[A].observaciones,220,O,{width:225}),f.text(r.detallesVenta[A].precio_unitario.toFixed(2),450,p),f.text(r.detallesVenta[A].total.toFixed(2),520,p)}(s||l)&&"FORM_C_MAR"==r.configuracion.formatoPapel.nombre_corto&&f.rect(50,p-15,520,30).stroke(),p+=30,++g>x&&(f.addPage({size:c,margin:10}),p=240,g=0,n(f,l,s,r,c,_+=1,E,u,o))}(s||l)&&(f.font("Helvetica-Bold",8),f.text("TOTAL",455,p)),f.font("Helvetica",8),f.text(r.total.toFixed(2),520,p),f.text("SON : "+r.numero_literal,55,p),f.text("CÓDIGO DE CONTROL : "+r.codigo_control,55,p+30),r.fecha_limite_emision=new Date(r.fecha_limite_emision),f.text("FECHA LÍMITE DE EMISIÓN: "+r.fecha_limite_emision.getDate()+"/"+(r.fecha_limite_emision.getMonth()+1)+"/"+r.fecha_limite_emision.getFullYear(),55,p+60),(s||l)&&(f.rect(50,p-15,520,30).stroke(),f.rect(50,p+25,400,20).stroke(),f.rect(50,p+55,400,20).stroke()),qr.canvas({canvas:h,value:u.empresa.nit+"|"+r.factura+"|"+r.autorizacion+"|"+r.fechaTexto+"|"+r.total.toFixed(2)+"|"+r.total.toFixed(2)+"|"+r.codigo_control+"|"+r.cliente.nit+"|0|0|0|0"},function(){});var b=h.toDataURL("image/png");f.image(b,470,p+20,{width:70,height:70}),(s||l)&&(f.text(r.configuracion.nota,50,c[1]-80),f.text(void 0!==r.pieFactura&&null!==r.pieFactura?r.pieFactura.nombre:"",50,c[1]-60),f.text('"ESTA FACTURA CONTRIBUYE AL DESARROLLO DEL PAIS. EL USO ILICITO DE ESTA SERA SANCIONADO DE ACUERDO A LEY"',50,c[1]-40))}f.end(),m.on("finish",function(){var e=m.toBlobURL("application/pdf"),t=window.open(e,"_blank","location=no");i(function(){t.print()},500)}),e.stop()}}]).factory("DibujarCabeceraFacturaNVCartaOficio",[function(){return function(e,t,o,a,n,i,r,c){if(a.configuracion.usar_pf){if(t){c.empresa.imagen.length>100&&e.image(c.empresa.imagen,60,40,{fit:[65,65]}),e.font("Helvetica-Bold",8),e.text(c.empresa.razon_social.toUpperCase(),60,105),e.font("Helvetica",7),e.text(a.sucursal.nombre.toUpperCase(),60,113);var l=(d=a.sucursal.direccion.length)<=45?129:d>45&&d<=90?139:145;e.text(a.sucursal.direccion.toUpperCase(),60,121);var s=(null!=a.sucursal.telefono1?a.sucursal.telefono1:"")+(null!=a.sucursal.telefono2?"-"+a.sucursal.telefono2:"")+(null!=a.sucursal.telefono3?"-"+a.sucursal.telefono3:"");e.text("TELF.: "+s,60,l),e.text("COCHABAMBA - BOLIVIA",60,l+8)}e.font("Helvetica-Bold",16),e.text(a.configuracion.tituloFactura.nombre.toUpperCase(),250,90),e.font("Helvetica-Bold",8),(o||t)&&(e.rect(380,40,190,50).stroke(),e.text("NIT : ",400,50),e.text("Nota No : ",400,60)),e.text(c.empresa.nit,500,50),e.text(a.factura,500,60),(o||t)&&(e.rect(50,160,520,40).stroke(),e.text("FECHA : ",60,165),e.text("SEÑOR(ES) : ",60,175),e.text("NIT : ",360,165)),e.text(a.fecha_factura?a.fecha_factura:a.fechaTexto,120,165),e.text(a.cliente.razon_social,120,175),e.text(a.cliente.nit,400,165),(o||t)&&(e.rect(50,200,520,25).stroke(),e.text("CODIGO",55,210,{width:70}),e.text("CANT.",125,210),a.detallesVenta[0].producto&&e.text("UNIDAD",155,210),e.text("DETALLE",198,210),a.con_vencimiento&&("SERIE"==a.configuracion.tipoConfiguracion.nombre_corto?e.text("SERIE",380,210):(e.text("VENC.",340,210),e.text("LOTE",380,210))),a.detallesVenta[0].producto&&e.text("P.UNIT.",450,210),e.text("TOTAL",530,210)),e.font("Helvetica",7),e.text("PÁGINA "+i+" DE "+r,500,n[1]-60)}else{var d;if(t)c.empresa.imagen.length>100&&e.image(c.empresa.imagen,60,40,{fit:[65,65]}),e.font("Helvetica-Bold",8),e.text(c.empresa.razon_social.toUpperCase(),60,105),e.font("Helvetica",7),e.text(a.sucursal.nombre.toUpperCase(),60,113),l=(d=a.sucursal.direccion.length)<=45?129:d>45&&d<=90?139:145,e.text(a.sucursal.direccion.toUpperCase(),60,121),s=(null!=a.sucursal.telefono1?a.sucursal.telefono1:"")+(null!=a.sucursal.telefono2?"-"+a.sucursal.telefono2:"")+(null!=a.sucursal.telefono3?"-"+a.sucursal.telefono3:""),e.text("TELF.: "+s,60,l),e.text("COCHABAMBA - BOLIVIA",60,l+8);e.font("Helvetica-Bold",16),e.text(a.configuracion.tituloFactura.nombre.toUpperCase(),250,90),e.font("Helvetica-Bold",8),e.text(a.actividad.nombre,380,95,{width:200}),(o||t)&&(e.rect(380,40,190,50).stroke(),e.text("NIT : ",390,50),e.text("FACTURA No : ",390,60),e.text("AUTORIZACIÓN No : ",390,70)),e.text(c.empresa.nit,500,50),e.text(a.factura,500,60),e.text(a.autorizacion,500,70),(o||t)&&(e.rect(50,160,520,40).stroke(),e.text("FECHA : ",60,165),e.text("SEÑOR(ES) : ",60,175),e.text("NIT : ",360,165)),e.text(a.fecha_factura?a.fecha_factura:a.fechaTexto,120,165),e.text(a.cliente.razon_social,120,175),e.text(a.cliente.nit,400,165),(o||t)&&(e.rect(50,200,520,25).stroke(),e.text("CODIGO",55,210,{width:70}),e.text("CANT.",125,210),a.detallesVenta[0].producto&&e.text("UNIDAD",155,210),e.text("DETALLE",198,210),a.con_vencimiento&&(e.text("VENC.",340,210),e.text("LOTE",380,210)),a.detallesVenta[0].producto&&e.text("P.UNIT.",410,210),e.text("IMP.",450,210),a.detallesVenta[0].producto&&e.text("DESC.",490,210),e.text("TOTAL",530,210)),e.font("Helvetica",7),e.text("PÁGINA "+i+" DE "+r,500,n[1]-60)}}}]).factory("ImprimirFacturaCartaOficioSinFormato",["blockUI","VerificarDescuentos","Diccionario","DibujarCabeceraFacturaNVCartaOficioSinFormato","DibujarCabeceraFacturaNVmedioOficio","$timeout",function(e,t,o,a,n,i){return function(r,c,l,s,d,u){var f=new PDFDocument({compress:!1,size:c,margin:10}),m=f.pipe(blobStream());if(r.configuracion.usar_pf){var x=0;r.configuracion.tamanoPapelFactura.nombre_corto==o.FACT_PAPEL_OFICIO?x=19:r.configuracion.tamanoPapelFactura.nombre_corto==o.FACT_PAPEL_CARTA?x=32:r.configuracion.tamanoPapelFactura.nombre_corto==o.FACT_PAPEL_MEDIOOFICIO&&(x=3);var p=240,g=0,_=1,E=Math.ceil(r.detallesVenta.length/x);a(f,l,s,r,c,_,E,u);for(var A=0;A<r.detallesVenta.length&&g<=x;A++){if(f.font("Helvetica",8),r.detallesVenta[A].producto){r.detallesVenta[A].fecha_vencimiento=new Date(r.detallesVenta[A].fecha_vencimiento);var C=r.detallesVenta[A].fecha_vencimiento.getDate()+"/"+(r.detallesVenta[A].fecha_vencimiento.getMonth()+1)+"/"+r.detallesVenta[A].fecha_vencimiento.getFullYear().toString().substring(2);f.text(r.detallesVenta[A].producto.codigo,55,p,{width:70}),f.text(r.detallesVenta[A].cantidad,135,p),f.text(r.detallesVenta[A].producto.unidad_medida,180,p-3,{width:43});var O=(T=r.detallesVenta[A].producto.nombre.length)<=27?p:T>27&&T<=63?p-4:p-11;f.text(r.detallesVenta[A].producto.nombre,240,O,{width:250}),r.con_vencimiento&&(f.text(C,340,p),f.text(r.detallesVenta[A].lote,380,p)),f.text(r.detallesVenta[A].precio_unitario.toFixed(2),505,p),f.text(r.detallesVenta[A].total.toFixed(2),560,p)}else r.detallesVenta[A].fecha_vencimiento=new Date(r.detallesVenta[A].fecha_vencimiento),C=r.detallesVenta[A].fecha_vencimiento.getDate()+"/"+(r.detallesVenta[A].fecha_vencimiento.getMonth()+1)+"/"+r.detallesVenta[A].fecha_vencimiento.getFullYear().toString().substring(2),f.text(r.detallesVenta[A].servicio.codigo,55,p,{width:70}),f.text(r.detallesVenta[A].cantidad,130,p),O=(T=r.detallesVenta[A].observaciones.length)<=24?p:T>24&&T<=60?p-4:p-11,f.text(r.detallesVenta[A].observaciones,198,O,{width:130}),r.con_vencimiento&&(f.text(C,340,p),f.text(r.detallesVenta[A].lote,380,p)),f.text(r.detallesVenta[A].importe.toFixed(2),450,p),f.text(r.detallesVenta[A].total.toFixed(2),580,p);p+=15,++g==x&&(f.addPage({size:c,margin:10}),p=240,g=0,a(f,l,s,r,c,_+=1,E,u))}(s||l)&&(f.font("Helvetica-Bold",8),f.text("TOTAL",500,p)),f.font("Helvetica",8),f.text(r.total.toFixed(2),560,p),f.text("SON : "+r.numero_literal,55,p),(s||l)&&f.rect(50,p-5,545,15).stroke();var v=new Date,I=v.getMinutes();I<10&&(I="0"+I),f.text("usuario : "+u.nombre_usuario,55,p+20),f.text("fecha : "+v.getDate()+"/"+(v.getMonth()+1)+"/"+v.getFullYear()+"  "+v.getHours()+":"+I,180,p+20)}else{var h=document.getElementById("qr-code"),D=t(r.detallesVenta);for(f.font("Helvetica",8),x=0,r.configuracion.tamanoPapelFactura.nombre_corto==o.FACT_PAPEL_OFICIO?x=19:r.configuracion.tamanoPapelFactura.nombre_corto==o.FACT_PAPEL_CARTA?x=32:r.configuracion.tamanoPapelFactura.nombre_corto==o.FACT_PAPEL_MEDIOOFICIO&&(x=3),void 0!==r.detallesVenta?r.detallesVenta:r.detallesProformas,p=240,g=0,_=1,E=Math.ceil(r.detallesVenta.length/x),n(f,l,s,r,c,_,E,u,o),A=0;A<r.detallesVenta.length&&g<=x;A++){if(f.font("Helvetica",8),r.detallesVenta[A].producto)D?(f.text(r.detallesVenta[A].producto.codigo,55,p),f.text(r.detallesVenta[A].cantidad,115,p),f.text(r.detallesVenta[A].producto.unidad_medida,140,p),f.text(r.detallesVenta[A].producto.nombre,180,p-6,{width:120}),f.text(r.detallesVenta[A].precio_unitario.toFixed(2),300,p),f.text(r.detallesVenta[A].importe.toFixed(2),335,p),f.text(r.detallesVenta[A].tipo_descuento?"%":"Bs",385,p-10),f.text(r.detallesVenta[A].descuento.toFixed(2),385,p),f.text(r.detallesVenta[A].tipo_recargo?"%":"Bs",420,p-10),f.text(r.detallesVenta[A].recargo.toFixed(2),420,p),f.text(r.detallesVenta[A].ice.toFixed(2),455,p),f.text(r.detallesVenta[A].excento.toFixed(2),490,p),f.text(r.detallesVenta[A].total.toFixed(2),520,p)):(f.text(r.detallesVenta[A].producto.codigo,55,p),f.text(r.detallesVenta[A].cantidad,110,p),f.text(r.detallesVenta[A].producto.unidad_medida,165,p),O=(T=r.detallesVenta[A].producto.nombre.length)<=45?p:T>45&&T<=90?p-4:p-11,f.text(r.detallesVenta[A].producto.nombre,220,O,{width:225}),f.text(r.detallesVenta[A].precio_unitario.toFixed(2),450,p),f.text(r.detallesVenta[A].total.toFixed(2),520,p));else if(r.movimiento&&(r.movimientoServicio=r.movimiento.nombre_corto==o.EGRE_SERVICIO?r.movimiento:null),r.movimientoServicio)r.detallesVenta[A].fecha_vencimiento=new Date(r.detallesVenta[A].fecha_vencimiento),C=r.detallesVenta[A].fecha_vencimiento.getDate()+"/"+(r.detallesVenta[A].fecha_vencimiento.getMonth()+1)+"/"+r.detallesVenta[A].fecha_vencimiento.getFullYear().toString().substring(2),D?(O=(T=r.detallesVenta[A].observaciones.length)<=24?p:T>24&&T<=60?p-4:p-11,f.text(r.detallesVenta[A].observaciones,55,O,{width:300}),f.text(r.detallesVenta[A].importe.toFixed(2),335,p),f.text(r.detallesVenta[A].descuento.toFixed(2),385,p),f.text(r.detallesVenta[A].recargo.toFixed(2),420,p),f.text(r.detallesVenta[A].ice.toFixed(2),455,p),f.text(r.detallesVenta[A].excento.toFixed(2),490,p),f.text(r.detallesVenta[A].total.toFixed(2),530,p),(s||l)&&f.rect(50,p-15,520,30).stroke()):(O=(T=r.detallesVenta[A].observaciones.length)<=24?p:T>24&&T<=60?p-4:p-11,f.text(r.detallesVenta[A].observaciones,55,O,{width:400}),f.text(r.detallesVenta[A].importe.toFixed(2),450,p),f.text(r.detallesVenta[A].total.toFixed(2),530,p),(s||l)&&f.rect(50,p-15,520,30).stroke());else if(D)f.text(r.detallesVenta[A].servicio.codigo,55,p),f.text(r.detallesVenta[A].cantidad,115,p),f.text(r.detallesVenta[A].observaciones,180,p-6,{width:120}),f.text(r.detallesVenta[A].precio_unitario.toFixed(2),300,p),f.text(r.detallesVenta[A].importe.toFixed(2),335,p),f.text(r.detallesVenta[A].total.toFixed(2),520,p);else{var T;f.text(r.detallesVenta[A].servicio.codigo,55,p),f.text(r.detallesVenta[A].cantidad,110,p),O=(T=r.detallesVenta[A].observaciones.length)<=45?p:T>45&&T<=90?p-4:p-11,f.text(r.detallesVenta[A].observaciones,220,O,{width:225}),f.text(r.detallesVenta[A].precio_unitario.toFixed(2),450,p),f.text(r.detallesVenta[A].total.toFixed(2),520,p)}(s||l)&&f.rect(50,p-15,520,30).stroke(),p+=30,++g>x&&(f.addPage({size:c,margin:10}),p=240,g=0,n(f,l,s,r,c,_+=1,E,u,o))}(s||l)&&(f.font("Helvetica-Bold",8),f.text("TOTAL",455,p)),f.font("Helvetica",8),f.text(r.total.toFixed(2),520,p),f.text("SON : "+r.numero_literal,55,p),f.text("CÓDIGO DE CONTROL : "+r.codigo_control,55,p+30),r.fecha_limite_emision=new Date(r.fecha_limite_emision),f.text("FECHA LÍMITE DE EMISIÓN: "+r.fecha_limite_emision.getDate()+"/"+(r.fecha_limite_emision.getMonth()+1)+"/"+r.fecha_limite_emision.getFullYear(),55,p+60),(s||l)&&(f.rect(50,p-15,520,30).stroke(),f.rect(50,p+25,400,20).stroke(),f.rect(50,p+55,400,20).stroke()),qr.canvas({canvas:h,value:u.empresa.nit+"|"+r.factura+"|"+r.autorizacion+"|"+r.fechaTexto+"|"+r.total.toFixed(2)+"|"+r.total.toFixed(2)+"|"+r.codigo_control+"|"+r.cliente.nit+"|0|0|0|0"},function(){});var b=h.toDataURL("image/png");f.image(b,470,p+20,{width:70,height:70}),(s||l)&&(f.text(void 0!==r.pieFactura&&null!==r.pieFactura?r.pieFactura.nombre:"",50,c[1]-60),f.text('"ESTA FACTURA CONTRIBUYE AL DESARROLLO DEL PAIS. EL USO ILICITO DE ESTA SERA SANCIONADO DE ACUERDO A LEY"',50,c[1]-40))}f.end(),m.on("finish",function(){var e=m.toBlobURL("application/pdf"),t=window.open(e,"_blank","location=no");i(function(){t.print()},500)}),e.stop()}}]).factory("DibujarCabeceraFacturaNVCartaOficioSinFormato",[function(){return function(e,t,o,a,n,i,r,c){if(a.configuracion.usar_pf){if(t){c.empresa.imagen.length>100&&e.image(c.empresa.imagen,60,40,{fit:[65,65]}),e.font("Helvetica-Bold",8),e.text(c.empresa.razon_social.toUpperCase(),60,105),e.font("Helvetica",7),e.text(a.sucursal.nombre.toUpperCase(),60,113);var l=(d=a.sucursal.direccion.length)<=45?129:d>45&&d<=90?139:145;e.text(a.sucursal.direccion.toUpperCase(),60,120,{width:150});var s=(null!=a.sucursal.telefono1?a.sucursal.telefono1:"")+(null!=a.sucursal.telefono2?"-"+a.sucursal.telefono2:"")+(null!=a.sucursal.telefono3?"-"+a.sucursal.telefono3:"");e.text("TELF.: "+s,60,l),l+=11,e.font("Helvetica-Bold").text("COCHABAMBA - BOLIVIA",60,l)}e.font("Helvetica-Bold",16),e.text(a.configuracion.tituloFactura.nombre.toUpperCase(),250,90),e.font("Helvetica-Bold",10),(o||t)&&(e.text("NIT : ",410,50),e.text("Nota No : ",410,60)),e.text(c.empresa.nit,500,50),e.font("Helvetica-Bold",13),e.text(a.factura,500,60),e.font("Helvetica-Bold",10),(o||t)&&(e.text("FECHA : ",60,165),e.text("SEÑOR(ES) : ",60,175),e.text("NIT : ",470,165)),e.text(a.fecha_factura?a.fecha_factura:a.fechaTexto,120,165),e.text(a.cliente.razon_social,130,175),e.text(a.cliente.nit,530,165),(o||t)&&(e.rect(50,200,545,25).stroke(),e.text("CODIGO",55,210,{width:70}),e.text("CANT.",125,210),a.detallesVenta[0].producto&&e.text("UNIDAD",175,210),e.text("DETALLE",250,210),a.con_vencimiento&&(e.text("VENC.",340,210),e.text("LOTE",380,210)),a.detallesVenta[0].producto&&e.text("P.UNIT.",500,210),e.text("TOTAL",555,210)),e.font("Helvetica",7),e.text("PÁGINA "+i+" DE "+r,500,n[1]-60)}else{var d;if(t)c.empresa.imagen.length>100&&e.image(c.empresa.imagen,60,40,{fit:[65,65]}),e.font("Helvetica-Bold",8),e.text(c.empresa.razon_social.toUpperCase(),60,105),e.font("Helvetica",7),e.text(a.sucursal.nombre.toUpperCase(),60,113),l=(d=a.sucursal.direccion.length)<=45?129:d>45&&d<=90?139:145,e.text(a.sucursal.direccion.toUpperCase(),60,120,{width:150}),s=(null!=a.sucursal.telefono1?a.sucursal.telefono1:"")+(null!=a.sucursal.telefono2?"-"+a.sucursal.telefono2:"")+(null!=a.sucursal.telefono3?"-"+a.sucursal.telefono3:""),e.text("TELF.: "+s,60,l),l+=11,e.font("Helvetica-Bold").text("COCHABAMBA - BOLIVIA",60,l);e.font("Helvetica-Bold",16),e.text(a.configuracion.tituloFactura.nombre.toUpperCase(),250,90),e.font("Helvetica-Bold",8),e.text(a.actividad.nombre,380,95,{width:200}),(o||t)&&(e.text("NIT : ",390,50),e.text("FACTURA No : ",390,60),e.text("AUTORIZACIÓN No : ",390,70)),e.text(c.empresa.nit,500,50),e.text(a.factura,500,60),e.text(a.autorizacion,500,70),(o||t)&&(e.text("FECHA : ",60,165),e.text("SEÑOR(ES) : ",60,175),e.text("NIT : ",360,165)),e.text(a.fecha_factura?a.fecha_factura:a.fechaTexto,120,165),e.text(a.cliente.razon_social,130,175),e.text(a.cliente.nit,410,165),(o||t)&&(e.text("CODIGO",55,210,{width:70}),e.text("CANT.",125,210),a.detallesVenta[0].producto&&e.text("UNIDAD",155,210),e.text("DETALLE",198,210),a.con_vencimiento&&(e.text("VENC.",340,210),e.text("LOTE",380,210)),a.detallesVenta[0].producto&&e.text("P.UNIT.",410,210),e.text("TOTAL",530,210)),e.font("Helvetica",7),e.text("PÁGINA "+i+" DE "+r,500,n[1]-60)}}}]).factory("DibujarCabeceraFacturaNVmedioOficio",["VerificarDescuentos",function(e){return function(t,o,a,n,i,r,c,l,s){if(n.configuracion.usar_pf){if(o){l.empresa.imagen.length>100&&t.image(l.empresa.imagen,60,40,{fit:[70,70]}),t.font("Helvetica-Bold",8);var d=(x=l.empresa.razon_social.length+30)<=35?105:x>36&&x<=72?95:85;t.text(l.empresa.razon_social.toUpperCase(),60,d,{width:170}),t.font("Helvetica",7),t.text(n.sucursal.nombre.toUpperCase(),60,113),d=(x=n.sucursal.direccion.length)<=45?129:x>45&&x<=90?139:145,t.text(n.sucursal.direccion.toUpperCase(),60,121,{width:200});var u=(null!=n.sucursal.telefono1?n.sucursal.telefono1:"")+(null!=n.sucursal.telefono2?"-"+n.sucursal.telefono2:"")+(null!=n.sucursal.telefono3?"-"+n.sucursal.telefono3:"");t.text("TELF.: "+u,60,d),t.text("COCHABAMBA - BOLIVIA",60,d+6)}t.font("Helvetica-Bold",16),t.text(n.configuracion.tituloFactura.nombre.toUpperCase(),250,100),t.font("Helvetica-Bold",8),(a||o)&&("FORM_C_MAR"==n.configuracion.formatoPapel.nombre_corto&&t.rect(380,40,190,50).stroke(),t.text("NIT : ",390,50),t.text("NOTA No : ",390,60)),t.text(l.empresa.nit,500,50),t.text(n.factura,500,60),t.text(n.autorizacion,500,70),(a||o)&&(t.rect(50,160,520,40).stroke(),t.text("FECHA : ",60,165),t.text("SEÑOR(ES) : ",60,175),t.text("NIT : ",360,165)),t.text(n.fecha_factura?n.fecha_factura:n.fechaTexto,120,165),t.text(n.cliente.razon_social,120,175),t.text(n.cliente.nit,400,165),(a||o)&&(t.rect(50,200,520,25).stroke(),(g=e(n.detallesVenta))?(t.text("CODIGO",55,210),t.text("CANT.",110,210),t.text("DETALLE",160,210),t.text("P. UNIT.",300,210),t.text("IMPORTE",335,210),n.detallesVenta[0].producto&&(t.text("UNID.",140,210),t.text("DESC.",385,210),t.text("REC.",420,210),t.text("ICE",455,210),t.text("EXC.",490,210)),t.text("TOTAL",520,210)):(t.text("CODIGO",55,210),t.text("CANTIDAD",110,210),n.detallesVenta[0].producto&&t.text("UNIDAD",165,210),t.text("DETALLE",220,210),t.text("P.UNIT.",450,210),t.text("TOTAL",520,210)))}else{if(o){var f=80;l.empresa.imagen.length>100&&(t.image(l.empresa.imagen,60,40,{fit:[65,65]}),f=l.altura_imagen);var m=f<=1.95?f+85:105;t.font("Helvetica-Bold",8),d=(x=l.empresa.razon_social.length)<=35?m+11:m+20,t.text(l.empresa.razon_social.toUpperCase(),60,m,{width:170}),t.font("Helvetica",7),t.text(n.sucursal.nombre.toUpperCase(),60,d);var x,p=(x=n.sucursal.direccion.length)<=35?d+9:d+18;t.text(n.sucursal.direccion.toUpperCase(),60,d+9,{width:200}),u=(null!=n.sucursal.telefono1?n.sucursal.telefono1:"")+(null!=n.sucursal.telefono2?"-"+n.sucursal.telefono2:"")+(null!=n.sucursal.telefono3?"-"+n.sucursal.telefono3:""),t.text("TELF.: "+u,60,p+9),t.text("COCHABAMBA - BOLIVIA",60,p+18)}if(t.font("Helvetica-Bold",16),t.text(n.configuracion.tituloFactura.nombre.toUpperCase(),250,100),t.font("Helvetica-Bold",8),t.text(n.actividad.nombre,380,105,{width:200}),(a||o)&&("FORM_C_MAR"==n.configuracion.formatoPapel.nombre_corto&&("FORM_S_COL"==n.configuracion.formatoColor.nombre_corto?t.rect(380,40,190,50).stroke():t.rect(380,40,190,50).fillAndStroke(n.configuracion.color1,"black").fillColor("black").stroke()),t.text("NIT : ",390,50),t.text("FACTURA No : ",390,60),t.text("AUTORIZACIÓN No : ",390,70)),t.text(l.empresa.nit,500,50),t.text(n.factura,500,60),t.text(n.autorizacion,500,70),(a||o)&&("FORM_S_COL"==n.configuracion.formatoColor.nombre_corto?t.rect(50,160,520,40).stroke():t.rect(50,160,520,40).fillAndStroke(n.configuracion.color1,"black").fillColor("black").stroke(),t.text("FECHA : ",60,165),t.text("SEÑOR(ES) : ",60,175),t.text("NIT : ",360,165)),t.text(n.fecha_factura?n.fecha_factura:n.fechaTexto,120,165),t.text(n.cliente.razon_social,120,175),t.text(n.cliente.nit,400,165),a||o){"FORM_S_COL"==n.configuracion.formatoColor.nombre_corto?t.rect(50,200,520,25).stroke():t.rect(50,200,520,25).fillAndStroke(n.configuracion.color2,"black").fillColor("white").stroke();var g=e(n.detallesVenta);n.movimiento&&(n.movimientoServicio=n.movimiento.nombre_corto==s.EGRE_SERVICIO?n.movimiento:null),n.movimientoServicio?g?(t.text("DETALLE",55,210),t.text("IMPORTE",335,210),t.text("DESC.",385,210),t.text("REC.",420,210),t.text("ICE",455,210),t.text("EXC.",490,210),t.text("TOTAL",520,210)):(t.text("DETALLE",55,210),t.text("IMPORTE",450,210),t.text("TOTAL",520,210)):g?(t.text("CODIGO",55,210),t.text("CANT.",110,210),t.text("DETALLE",160,210),t.text("P. UNIT.",300,210),t.text("IMPORTE",335,210),n.detallesVenta[0].producto&&(t.text("UNID.",140,210),t.text("DESC.",385,210),t.text("REC.",420,210),t.text("ICE",455,210),t.text("EXC.",490,210)),t.text("TOTAL",520,210)):(t.text("CODIGO",55,210),t.text("CANTIDAD",110,210),n.detallesVenta[0].producto&&t.text("UNIDAD",165,210),t.text("DETALLE",220,210),t.text("P.UNIT.",450,210),t.text("TOTAL",520,210)),t.fillColor("black")}}}}]).factory("ImprimirPedido",[function(){return function(e,t,o,a,n,i,r){for(var c=0;c<e.sucursal.copias_impresion_pedido;c++){0!=c&&o.addPage({size:[227,n],margins:{top:10,bottom:10,left:20,right:20}}),o.font("Helvetica-Bold",12),r&&o.text("PARA LLEVAR¡¡¡",{align:"center"}),o.font("Helvetica-Bold",14),o.text("Nro. Pedido : "+e.pedido,{align:"left"}),o.font("Helvetica",12),o.text(e.sucursal.frase_pedido+" : "+e.factura,{align:"left"}),o.moveDown(.4),o.text("Cliente : "+e.cliente.razon_social,{align:"left"}),o.moveDown(.4),o.text("NIT/CI : "+e.cliente.nit,{align:"left"}),o.moveDown(.4),o.text("Total Transacción : "+e.total.toFixed(2),{align:"left"}),o.moveDown(.2),o.text("---------------------------------------------",{align:"center"}),o.moveDown(.2),o.text("Cant.   Producto         Subtotal",{align:"left"}),o.moveDown(.2),o.text("---------------------------------------------",{align:"center"}),o.moveDown(.4);var l=o.y;o.fontSize(10);for(var s=0;s<e.detallesVenta.length;s++)o.text(e.detallesVenta[s].cantidad,20,l),e.detallesVenta[s].producto?(e.detallesVenta[s].producto.nombre.length>40&&o.fontSize(9),o.text(e.detallesVenta[s].producto.nombre,50,l,{width:90}),o.text(e.detallesVenta[s].total.toFixed(2),150,l),o.fontSize(10)):(e.detallesVenta[s].servicio.nombre.length>40&&o.fontSize(9),o.text(e.detallesVenta[s].servicio.nombre,50,l,{width:90}),o.text(e.detallesVenta[s].total?e.detallesVenta[s].total.toFixed(2):e.detallesVenta[s].importe.toFixed(2),150,l),o.fontSize(10)),l+=20;o.moveDown(4),o.x=0;var d=new Date,u=d.getMinutes();u<10&&(u="0"+u),o.text(" Fecha : "+d.getDate()+"/"+(d.getMonth()+1)+"/"+d.getFullYear()+"  "+d.getHours()+":"+u+"  ",{align:"center"})}if(e.sucursal.imprimir_pedido_corto){for(o.addPage({size:[227,n],margins:{top:10,bottom:10,left:20,right:20}}),o.font("Helvetica-Bold",12),r&&o.text("PARA LLEVAR¡¡¡",{align:"center"}),o.font("Helvetica-Bold",14),o.text(i.empresa.razon_social,{align:"left"}),o.x,l=o.y,o.text("Nro. Pedido : ",20,l,{align:"left"}),o.font("Helvetica-Bold",22),o.text(e.pedido,120,l-5),o.font("Helvetica",12),o.x=20,l=o.y,o.text("Cant.   Producto         Subtotal",{align:"left"}),l=o.y,o.fontSize(10),s=0;s<e.detallesVenta.length;s++)o.text(e.detallesVenta[s].cantidad,20,l),e.detallesVenta[s].producto?(e.detallesVenta[s].producto.nombre.length>40&&o.fontSize(9),o.text(e.detallesVenta[s].producto.nombre,50,l,{width:90}),o.text(e.detallesVenta[s].total.toFixed(2),150,l),o.fontSize(10)):(e.detallesVenta[s].servicio.nombre.length>40&&o.fontSize(9),o.text(e.detallesVenta[s].servicio.nombre,50,l,{width:90}),o.text(e.detallesVenta[s].total?e.detallesVenta[s].total.toFixed(2):e.detallesVenta[s].importe.toFixed(2),150,l),o.fontSize(10)),l+=20;o.moveDown(4),o.x=0,o.text("Gracias por su preferencia",{align:"center"})}}}]).factory("ImprimirFacturaRollo",["blockUI",function(e){return function(t,o,a,n,i){if(t.configuracion.usar_pf){var r=document.getElementById("qr-code");a.moveDown(2),a.font("Helvetica-Bold",8),a.text(i.empresa.razon_social.toUpperCase(),{align:"center"}),a.moveDown(.4),a.font("Helvetica",7),a.text(t.sucursal.nombre.toUpperCase(),{align:"center"}),a.moveDown(.4),a.text(t.sucursal.direccion.toUpperCase(),{align:"center"}),a.moveDown(.4);var c=(null!=t.sucursal.telefono1?t.sucursal.telefono1:"")+(null!=t.sucursal.telefono2?"-"+t.sucursal.telefono2:"")+(null!=t.sucursal.telefono3?"-"+t.sucursal.textlefono3:"");a.text("TELF.: "+c,{align:"center"}),a.moveDown(.4),a.text("COCHABAMBA - BOLIVIA",{align:"center"}),a.moveDown(.5),a.font("Helvetica-Bold",8),a.text("PROFORMA NV",{align:"center"}),a.font("Helvetica",7),a.moveDown(.4),a.text("------------------------------------",{align:"center"}),a.moveDown(.4),a.text("Nro.  "+t.factura,{align:"center"}),a.moveDown(.4),a.text("------------------------------------",{align:"center"}),a.moveDown(.4),a.text(t.tipoPago.nombre_corto,{align:"center"}),a.moveDown(.4),a.text("------------------------------------",{align:"center"}),a.moveDown(.6),a.text("FECHA : "+t.fechaTexto,{align:"left"}),a.moveDown(.4),a.text("SEÑOR(ES) : "+t.cliente.razon_social,{align:"left"}),a.moveDown(.4),a.text("NIT/CI : "+t.cliente.nit,{align:"left"}),a.moveDown(.4),a.text("---------------------------------------------------------------------------------",{align:"center"}),a.moveDown(.2),a.text("CANT   CONCEPTO                                   P. UNIT.    SUBTOTAL",{align:"left"}),a.moveDown(.2),a.text("---------------------------------------------------------------------------------",{align:"center"}),a.moveDown(.4);for(var l=a.y,s=0,d=0,u=0,f=0,m=0;m<t.detallesVenta.length;m++)a.text(t.detallesVenta[m].cantidad,15,l),t.detallesVenta[m].producto?(t.detallesVenta[m].producto.nombre.length>40&&a.fontSize(6),a.text(t.detallesVenta[m].producto.nombre,35,l,{width:100}),a.fontSize(7),a.text(t.detallesVenta[m].precio_unitario.toFixed(2),145,l),a.text(t.detallesVenta[m].importe.toFixed(2),180,l),s+=t.detallesVenta[m].tipo_descuento?t.detallesVenta[m].importe*(t.detallesVenta[m].descuento/100):t.detallesVenta[m].descuento,d+=t.detallesVenta[m].tipo_recargo?t.detallesVenta[m].importe*(t.detallesVenta[m].recargo/100):t.detallesVenta[m].recargo,u+=t.detallesVenta[m].ice,f+=t.detallesVenta[m].excento):(t.detallesVenta[m].servicio.nombre.length>40&&a.fontSize(6),a.text(t.detallesVenta[m].servicio.nombre,35,l,{width:100}),a.fontSize(7),a.text(t.detallesVenta[m].precio_unitario.toFixed(2),145,l),a.text(t.detallesVenta[m].importe.toFixed(2),180,l),s+=t.detallesVenta[m].tipo_descuento?t.detallesVenta[m].importe*(t.detallesVenta[m].descuento/100):t.detallesVenta[m].descuento,d+=t.detallesVenta[m].tipo_recargo?t.detallesVenta[m].importe*(t.detallesVenta[m].recargo/100):t.detallesVenta[m].recargo,u+=t.detallesVenta[m].ice,f+=t.detallesVenta[m].excento),l+=20;a.text("--------------",10,l,{align:"right"}),a.moveDown(.4),a.text("IMPORTE TOTAL Bs.              "+t.importe.toFixed(2),{align:"right"}),a.moveDown(.3),s>0&&a.text("DESCUENTO Bs.              "+s.toFixed(2),{align:"right"}),a.moveDown(.3),d>0&&a.text("RECARGO Bs.              "+d.toFixed(2),{align:"right"}),a.moveDown(.3),u>0&&a.text("ICE Bs.              "+u.toFixed(2),{align:"right"}),a.moveDown(.3),f>0&&a.text("EXCENTO Bs.              "+f.toFixed(2),{align:"right"}),a.moveDown(.3),a.text("TOTAL Bs.              "+t.total.toFixed(2),{align:"right"}),a.moveDown(.4),a.moveDown(.4),a.text("SON: "+t.numero_literal,{align:"left"}),a.moveDown(.6),(p=(x=new Date).getMinutes())<10&&(p="0"+p),a.text("usuario : "+i.nombre_usuario,0,l+205,{align:"right"}),a.moveDown(.4),a.text("fecha : "+x.getDate()+"/"+(x.getMonth()+1)+"/"+x.getFullYear()+"  "+x.getHours()+":"+p,10,l+215,{align:"right"})}else{for(r=document.getElementById("qr-code"),a.moveDown(1),i.empresa.imagen.length>100&&a.image(i.empresa.imagen,75,a.y,{align:"center",fit:[75,75]}),a.y=40,a.moveDown(2),a.font("Helvetica-Bold",8),a.text(i.empresa.razon_social.toUpperCase(),35,a.y,{align:"center",width:150}),a.moveDown(.4),a.font("Helvetica",7),a.text(t.sucursal.nombre.toUpperCase(),{align:"center"}),a.moveDown(.4),a.text(t.sucursal.direccion.toUpperCase(),{align:"center"}),a.moveDown(.4),c=(null!=t.sucursal.telefono1?t.sucursal.telefono1:"")+(null!=t.sucursal.telefono2?"-"+t.sucursal.telefono2:"")+(null!=t.sucursal.telefono3?"-"+t.sucursal.telefono3:""),a.text("TELF.: "+c,{align:"center"}),a.moveDown(.4),a.text("COCHABAMBA - BOLIVIA",{align:"center"}),a.moveDown(.5),a.font("Helvetica-Bold",8),a.text(t.configuracion.tituloFactura.nombre.toUpperCase(),{align:"center"}),a.font("Helvetica",7),a.moveDown(.4),a.text("------------------------------------",{align:"center"}),a.moveDown(.4),a.text("NIT: "+i.empresa.nit,{align:"center"}),a.moveDown(.4),a.text("FACTURA No: "+t.factura,{align:"center"}),a.moveDown(.4),a.text("AUTORIZACIÓN No: "+t.autorizacion,{align:"center"}),a.moveDown(.4),a.text("------------------------------------",{align:"center"}),a.moveDown(.4),a.text(t.actividad.nombre,{align:"center",width:150}),a.x=20,a.moveDown(.6),a.text("FECHA : "+t.fechaTexto,{align:"left"}),a.moveDown(.4),a.text("SEÑOR(ES) : "+t.cliente.razon_social,{align:"left"}),a.moveDown(.4),a.text("NIT/CI : "+t.cliente.nit,{align:"left"}),a.moveDown(.4),a.text("--------------------------------------------------------------------------------",{align:"center"}),a.moveDown(.2),a.text("CANT   CONCEPTO                    P. UNIT.    SUBTOTAL",{align:"left"}),a.moveDown(.2),a.text("--------------------------------------------------------------------------------",{align:"center"}),a.moveDown(.4),l=a.y,s=0,d=0,u=0,f=0,m=0;m<t.detallesVenta.length;m++)a.text(t.detallesVenta[m].cantidad,20,l),t.detallesVenta[m].producto?(t.detallesVenta[m].producto.nombre.length>40&&a.fontSize(6),a.text(t.detallesVenta[m].producto.nombre,40,l,{width:100}),a.fontSize(7),a.text(t.detallesVenta[m].precio_unitario.toFixed(2),150,l),a.text(t.detallesVenta[m].importe.toFixed(2),175,l),s+=t.detallesVenta[m].tipo_descuento?t.detallesVenta[m].importe*(t.detallesVenta[m].descuento/100):t.detallesVenta[m].descuento,d+=t.detallesVenta[m].tipo_recargo?t.detallesVenta[m].importe*(t.detallesVenta[m].recargo/100):t.detallesVenta[m].recargo,u+=t.detallesVenta[m].ice,f+=t.detallesVenta[m].excento):(t.detallesVenta[m].servicio.nombre.length>40&&a.fontSize(6),a.text(t.detallesVenta[m].servicio.nombre,40,l,{width:100}),a.fontSize(7),a.text(t.detallesVenta[m].precio_unitario.toFixed(2),150,l),a.text(t.detallesVenta[m].importe.toFixed(2),175,l)),l+=20;a.x=20,a.text("--------------",{align:"right"}),a.moveDown(.4),a.text("IMPORTE TOTAL Bs.         "+t.importe.toFixed(2),90,a.y),a.moveDown(.3),s>0&&a.text("DESCUENTO Bs.              "+s.toFixed(2),97,a.y),a.moveDown(.3),d>0&&a.text("RECARGO Bs.              "+d.toFixed(2),105,a.y),a.moveDown(.3),u>0&&a.text("ICE Bs.              "+u.toFixed(2),128,a.y),a.moveDown(.3),f>0&&a.text("EXCENTO Bs.              "+f.toFixed(2),107,a.y),a.moveDown(.3),a.text("TOTAL Bs.         "+t.total.toFixed(2),124,a.y),a.x=20,a.moveDown(.4),a.moveDown(.4),a.text("SON: "+t.numero_literal,{align:"left"}),a.moveDown(.6),a.text("CÓDIGO DE CONTROL: "+t.codigo_control,{align:"center"}),a.moveDown(.4),t.fecha_limite_emision=new Date(t.fecha_limite_emision),a.text("FECHA LÍMITE DE EMISIÓN: "+t.fecha_limite_emision.getDate()+"/"+(t.fecha_limite_emision.getMonth()+1)+"/"+t.fecha_limite_emision.getFullYear(),{align:"center"}),a.moveDown(.4),qr.canvas({canvas:r,value:i.empresa.nit+"|"+t.factura+"|"+t.autorizacion+"|"+t.fechaTexto+"|"+t.total.toFixed(2)+"|"+t.total.toFixed(2)+"|"+t.codigo_control+"|"+t.cliente.nit+"|0|0|0|0"},function(){});var x,p,g=r.toDataURL("image/png");a.image(g,70,a.y,{width:85,height:85}),a.moveDown(.4),a.text(t.pieFactura?t.pieFactura.nombre:"",{align:"center",width:150}),a.moveDown(.6),a.text('"ESTA FACTURA CONTRIBUYE AL DESARROLLO DEL PAIS. EL USO ILICITO DE ESTA SERA SANCIONADO DE ACUERDO A LEY"',{align:"center",width:150}),a.moveDown(.4),(p=(x=new Date).getMinutes())<10&&(p="0"+p),a.text("  Usuario : "+i.nombre_usuario+" -- Fecha : "+x.getDate()+"/"+(x.getMonth()+1)+"/"+x.getFullYear()+"  "+x.getHours()+":"+p+"  ",{align:"center"})}e.stop()}}]).factory("ImprimirProforma",["Diccionario","ImprimirProformaCartaOficio","ImprimirPedido","ImprimirProformaRollo","$timeout",function(e,t,o,a,n){return function(i,r,c,l){var s,d,u;if(i.configuracion.tamanoPapelNotaVenta.nombre_corto==e.FACT_PAPEL_OFICIO)s=[612,936],i.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_VACIA?t(i,s,!0,!1,!1,c):i.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_COMPLETA?t(i,s,!1,!0,!1,c):i.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_SEMICOMPLETA&&t(i,s,!1,!1,!0,c);else if(i.configuracion.tamanoPapelNotaVenta.nombre_corto==e.FACT_PAPEL_CARTA)s=[612,792],i.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_VACIA?t(i,s,!0,!1,!1,c):i.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_COMPLETA?t(i,s,!1,!0,!1,c):i.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_SEMICOMPLETA&&t(i,s,!1,!1,!0,c);else if(i.configuracion.tamanoPapelNotaVenta.nombre_corto==e.FACT_PAPEL_MEDIOOFICIO)s=[612,468],i.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_VACIA?t(i,s,!0,!1,!1,c):i.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_COMPLETA?t(i,s,!1,!0,!1,c):i.configuracion.impresionFactura.nombre_corto==e.FACT_IMPRESION_SEMICOMPLETA&&t(i,s,!1,!1,!0,c);else if(i.configuracion.tamanoPapelNotaVenta.nombre_corto==e.FACT_PAPEL_ROLLO){if(s=[227,i.detallesVenta.length<=2?400:400+20*(i.detallesVenta.length-2)],r&&!i.configuracion.imprimir_al_guardar){if(c.empresa.usar_pedidos){var f=230+20*i.detallesVenta.length;d=new PDFDocument({compress:!1,size:[227,f],margins:{top:10,bottom:10,left:20,right:20}}),u=d.pipe(blobStream()),o(i,r,d,u,f,c,l)}}else d=new PDFDocument({compress:!1,size:s,margins:{top:0,bottom:0,left:20,right:20}}),u=d.pipe(blobStream()),a(i,s,d,u,c),c.empresa.usar_pedidos&&(f=230+20*i.detallesVenta.length,d.addPage({size:[227,f],margins:{top:10,bottom:10,left:20,right:20}}),o(i,r,d,u,f,c,l));d&&u&&(d.end(),u.on("finish",function(){var e=u.toBlobURL("application/pdf"),t=window.open(e,"_blank","location=no");n(function(){t.print()},500)}))}}}]).factory("ImprimirProformaCartaOficio",["Diccionario","$timeout","blockUI","VerificarDescuentos","DibujarCabeceraProformaNVmedioOficio",function(e,t,o,a,n){return function(i,r,c,l,s,d){var u=new PDFDocument({compress:!1,size:r,margin:10}),f=u.pipe(blobStream()),m=a(i.detallesVenta);u.font("Helvetica",8);var x=0;i.configuracion.tamanoPapelNotaVenta.nombre_corto==e.FACT_PAPEL_OFICIO?x=19:i.configuracion.tamanoPapelNotaVenta.nombre_corto==e.FACT_PAPEL_CARTA?x=16:i.configuracion.tamanoPapelNotaVenta.nombre_corto==e.FACT_PAPEL_MEDIOOFICIO&&(x=3);var p=240,g=0,_=1,E=Math.ceil(i.detallesVenta.length/x);n(u,c,l,i,r,_,E,d),u.font("Helvetica",7);for(var A=0;A<i.detallesVenta.length&&g<=x;A++)i.detallesVenta[A].fecha_vencimiento=new Date(i.detallesVenta[A].fecha_vencimiento),m?(u.text(i.detallesVenta[A].producto.codigo,55,p,{width:50}),u.text(i.detallesVenta[A].cantidad,105,p),u.text(i.detallesVenta[A].producto.unidad_medida,120,p,{width:40}),u.text(i.detallesVenta[A].producto.nombre,160,p-9,{width:80}),d.empresa.usar_vencimientos&&i.con_vencimiento&&(u.text(i.detallesVenta[A].fecha_vencimiento.getDate()+"/"+(i.detallesVenta[A].fecha_vencimiento.getMonth()+1)+"/"+i.detallesVenta[A].fecha_vencimiento.getFullYear(),245,p),u.text(i.detallesVenta[A].lote,285,p)),u.text(i.detallesVenta[A].precio_unitario.toFixed(2),310,p),u.text(i.detallesVenta[A].importe.toFixed(2),345,p),u.text(i.detallesVenta[A].descuento?i.detallesVenta[A].descuento.toFixed(2):0,395,p),u.text(i.detallesVenta[A].recargo.toFixed(2),430,p),u.text(i.detallesVenta[A].ice.toFixed(2),465,p),u.text(i.detallesVenta[A].excento.toFixed(2),500,p),u.text(i.detallesVenta[A].total.toFixed(2),530,p)):(u.text(i.detallesVenta[A].producto.codigo,55,p),u.text(i.detallesVenta[A].cantidad,130,p),u.text(i.detallesVenta[A].producto.unidad_medida,160,p),u.text(i.detallesVenta[A].producto.nombre,200,p-9,{width:150}),d.empresa.usar_vencimientos&&i.con_vencimiento&&(u.text(i.detallesVenta[A].fecha_vencimiento.getDate()+"/"+(i.detallesVenta[A].fecha_vencimiento.getMonth()+1)+"/"+i.detallesVenta[A].fecha_vencimiento.getFullYear(),360,p),u.text(i.detallesVenta[A].lote,415,p)),u.text(i.detallesVenta[A].precio_unitario.toFixed(2),460,p),u.text(i.detallesVenta[A].total.toFixed(2),520,p)),(l||c)&&u.rect(50,p-15,520,30).stroke(),p+=30,++g==x&&(u.addPage({size:r,margin:10}),p=240,g=0,n(u,c,l,i,r,_+=1,E,d));(l||c)&&(u.font("Helvetica-Bold",7),u.text("TOTAL",455,p-5)),u.font("Helvetica",7),u.text(i.total.toFixed(2),520,p-5),u.text("SON : "+i.numero_literal,55,p-5),(l||c)&&u.rect(50,p-15,520,20).stroke(),u.moveDown(2);var C=new Date,O=C.getMinutes();O<10&&(O="0"+O),u.text("  Usuario : "+d.nombre_usuario+" -- Fecha : "+C.getDate()+"/"+(C.getMonth()+1)+"/"+C.getFullYear()+"  "+C.getHours()+":"+O+"  ",{align:"center"}),u.end(),f.on("finish",function(){var e=f.toBlobURL("application/pdf"),o=window.open(e,"_blank","location=no");t(function(){o.print()},500)}),o.stop()}}]).factory("DibujarCabeceraProformaNVmedioOficio",["VerificarDescuentos",function(e){return function(t,o,a,n,i,r,c,l){if(o){l.empresa.imagen.length>100&&t.image(l.empresa.imagen,60,50,{fit:[75,75]}),t.font("Helvetica-Bold",8),t.text(l.empresa.razon_social.toUpperCase(),150,60),t.font("Helvetica",7),t.text(n.sucursal.nombre.toUpperCase(),150,70),t.text(n.sucursal.direccion.toUpperCase(),150,80);var s=(null!=n.sucursal.telefono1?n.sucursal.telefono1:"")+(null!=n.sucursal.telefono2?"-"+n.sucursal.telefono2:"")+(null!=n.sucursal.telefono3?"-"+n.sucursal.telefono3:"");t.text("TELF.: "+s,150,90),t.text("COCHABAMBA - BOLIVIA",150,100)}t.font("Helvetica-Bold",16),t.text("PROFORMA Nº "+n.factura,200,125),t.font("Helvetica-Bold",8),(a||o)&&(t.rect(50,150,520,50).stroke(),t.text("FECHA : ",60,165),t.text("SEÑOR(ES) : ",60,175),t.text("NIT : ",360,165)),t.font("Helvetica",8),t.text(n.fecha_factura?n.fecha_factura:n.fechaTexto,120,165),t.text(n.cliente.razon_social,120,175),t.text(n.cliente.nit,400,165),t.font("Helvetica-Bold",7),(a||o)&&(t.rect(50,200,520,25).stroke(),e(n.detallesVenta)?(t.text("CODIGO",55,210),t.text("CANT.",100,210),t.text("UNID.",130,210),t.text("DETALLE",160,210),l.empresa.usar_vencimientos&&n.con_vencimiento&&(t.text("VENC.",245,210),t.text("LOTE.",280,210)),t.text("P. UNIT.",310,210),t.text("IMPORTE",345,210),t.text("DESC.",395,210),t.text("REC.",430,210),t.text("ICE",465,210),t.text("EXC.",500,210),t.text("TOTAL",530,210)):(t.text("CODIGO",55,210),t.text("CANTIDAD",120,210),t.text("UNIDAD",165,210),t.text("DETALLE",200,210),l.empresa.usar_vencimientos&&n.con_vencimiento&&(t.text("VENC.",360,210),t.text("LOTE.",415,210)),t.text("P.UNIT.",460,210),t.text("TOTAL",520,210)))}}]).factory("ImprimirProformaRollo",["blockUI",function(e){return function(t,o,a,n,i){a.moveDown(2),a.font("Helvetica-Bold",8),a.text(i.empresa.razon_social.toUpperCase(),{align:"center"}),a.moveDown(.4),a.font("Helvetica",7),a.text(t.sucursal.nombre.toUpperCase(),{align:"center"}),a.moveDown(.4),a.text(t.sucursal.direccion.toUpperCase(),{align:"center"}),a.moveDown(.4);var r=(null!=t.sucursal.telefono1?t.sucursal.telefono1:"")+(null!=t.sucursal.telefono2?"-"+t.sucursal.telefono2:"")+(null!=t.sucursal.telefono3?"-"+t.sucursal.telefono3:"");a.text("TELF.: "+r,{align:"center"}),a.moveDown(.4),a.text("COCHABAMBA - BOLIVIA",{align:"center"}),a.moveDown(.5),a.font("Helvetica-Bold",8),a.text("PROFORMA Nº "+t.factura,{align:"center"}),a.font("Helvetica",7),a.moveDown(.4),a.text("------------------------------------",{align:"center"}),a.moveDown(.4),a.moveDown(.4),a.moveDown(.4),a.moveDown(.4),a.text("------------------------------------",{align:"center"}),a.moveDown(.4),a.moveDown(.6),a.text("FECHA : "+t.fechaTexto,{align:"left"}),a.moveDown(.4),a.text("SEÑOR(ES) : "+t.cliente.razon_social,{align:"left"}),a.moveDown(.4),a.text("NIT/CI : "+t.cliente.nit,{align:"left"}),a.moveDown(.4),a.text("---------------------------------------------------------------------------------",{align:"center"}),a.moveDown(.2),a.text("CANT   CONCEPTO                                   P. UNIT.    SUBTOTAL",{align:"left"}),a.moveDown(.2),a.text("---------------------------------------------------------------------------------",{align:"center"}),a.moveDown(.4);for(var c=a.y,l=0,s=0,d=0,u=0,f=0;f<t.detallesVenta.length;f++)a.text(t.detallesVenta[f].cantidad,15,c),t.detallesVenta[f].producto.nombre.length>40&&a.fontSize(6),a.text(t.detallesVenta[f].producto.nombre,35,c,{width:100}),a.fontSize(7),a.text(t.detallesVenta[f].precio_unitario.toFixed(2),145,c),a.text(t.detallesVenta[f].importe.toFixed(2),180,c),l+=t.detallesVenta[f].tipo_descuento?t.detallesVenta[f].importe*(t.detallesVenta[f].descuento/100):t.detallesVenta[f].descuento,s+=t.detallesVenta[f].tipo_recargo?t.detallesVenta[f].importe*(t.detallesVenta[f].recargo/100):t.detallesVenta[f].recargo,d+=t.detallesVenta[f].ice,u+=t.detallesVenta[f].excento,c+=20;a.text("--------------",10,c,{align:"right"}),a.moveDown(.4),a.text("IMPORTE TOTAL Bs.              "+t.importe.toFixed(2),{align:"right"}),a.moveDown(.3),l>0&&a.text("DESCUENTO Bs.              "+l.toFixed(2),{align:"right"}),a.moveDown(.3),s>0&&a.text("RECARGO Bs.              "+s.toFixed(2),{align:"right"}),a.moveDown(.3),d>0&&a.text("ICE Bs.              "+d.toFixed(2),{align:"right"}),a.moveDown(.3),u>0&&a.text("EXCENTO Bs.              "+u.toFixed(2),{align:"right"}),a.moveDown(.3),a.text("TOTAL Bs.              "+t.total.toFixed(2),{align:"right"}),a.moveDown(.4),a.moveDown(.4),a.text("SON: "+t.numero_literal,{align:"left"}),a.moveDown(.6),a.moveDown(.4),a.moveDown(.4),a.moveDown(.4),a.moveDown(.4);var m=new Date,x=m.getMinutes();x<10&&(x="0"+x),a.text("  Usuario : "+i.nombre_usuario+" -- Fecha : "+m.getDate()+"/"+(m.getMonth()+1)+"/"+m.getFullYear()+"  "+m.getHours()+":"+x+"  ",{align:"center"}),e.stop()}}]).factory("ImprimirNotaBaja",["blockUI","Diccionario","ImprimirNotaBajaCartaOficio","ImprimirNotaBajaRollo",function(e,t,o,a){return function(n,i){var r;if(e.start(),n.configuracion.tamanoPapelNotaBaja.nombre_corto==t.FACT_PAPEL_OFICIO)papel=[612,936],r=23,o(n,papel,r,i);else if(n.configuracion.tamanoPapelNotaBaja.nombre_corto==t.FACT_PAPEL_CARTA)papel=[612,792],r=20,o(n,papel,r,i);else if(n.configuracion.tamanoPapelNotaBaja.nombre_corto==t.FACT_PAPEL_MEDIOOFICIO)papel=[612,468],r=10,o(n,papel,r,i);else if(n.configuracion.tamanoPapelNotaBaja.nombre_corto==t.FACT_PAPEL_ROLLO){var c,l=n.detallesVenta.length;c=l<=2?440:440+30*(l-2),papel=[227,c],a(n,papel,i)}}}]).factory("ImprimirNotaBajaCartaOficio",["blockUI","VerificarDescuentos","DibujarCabeceraPDFBaja",function(e,t,o){return function(a,n,i,r){var c=new PDFDocument({compress:!1,size:n,margin:0}),l=c.pipe(blobStream()),s=t(a.detallesVenta);c.font("Helvetica",7);var d=0,u=140,f=0,m=1,x=Math.ceil(a.detallesVenta.length/i);o(c,1,x,a,s,r);for(var p=0;p<a.detallesVenta.length&&f<=i;p++){if(s)c.text(a.detallesVenta[p].producto.codigo,55,u),c.text(a.detallesVenta[p].cantidad,110),c.text(a.detallesVenta[p].producto.unidad_medida,135,u),c.text(a.detallesVenta[p].producto.nombre,170,u-6,{width:120}),c.text(a.detallesVenta[p].producto.precio_unitario.toFixed(2),300,u),c.text(a.detallesVenta[p].importe.toFixed(2),335,u),c.text(a.detallesVenta[p].descuento.toFixed(2),385,u),c.text(a.detallesVenta[p].recargo.toFixed(2),420,u),c.text(a.detallesVenta[p].ice.toFixed(2),455,u),c.text(a.detallesVenta[p].excento.toFixed(2),490,u),c.text(a.detallesVenta[p].total.toFixed(2),520,u);else{c.text(a.detallesVenta[p].producto.codigo,55,u,{width:60}),c.text(a.detallesVenta[p].cantidad,130,u,{width:70}),c.text(a.detallesVenta[p].producto.unidad_medida,153,u);var g=a.detallesVenta[p].producto.nombre.length,_=g<=30?u:g>40&&g<=75?u:u-7;if(r.empresa.usar_vencimientos){c.font("Helvetica",6),c.text(a.detallesVenta[p].producto.nombre,205,_,{width:160});var E=new Date(a.detallesVenta[p].inventario.fecha_vencimiento);c.font("Helvetica",7),c.text(E.getDate()+"/"+(E.getMonth()+1)+"/"+E.getFullYear(),375,u),c.text(a.detallesVenta[p].inventario.lote,435,u)}else c.text(a.detallesVenta[p].producto.nombre,210,_,{width:250});c.text(a.detallesVenta[p].producto.precio_unitario.toFixed(2),470,u),c.text(a.detallesVenta[p].total.toFixed(2),520,u)}if(c.rect(50,u-15,520,30).stroke(),u+=30,++f==i&&(d+=f)!=a.detallesVenta.length){var A=new Date;a.fecha=new Date(a.fecha),c.font("Helvetica",5),c.text("EMISIÓN: "+a.fecha.getDate()+"/"+(a.fecha.getMonth()+1)+"/"+a.fecha.getFullYear(),200,u),c.text("IMPRESIÓN: "+A.getDate()+"/"+(A.getMonth()+1)+"/"+A.getFullYear(),260,u),c.text("USUARIO: "+r.persona.nombre_completo,55,u),c.text(m+" de "+x,540,u-10),c.addPage({margin:0,bufferPages:!0}),u=140,f=0,m+=1,o(c,1,x,a,s,r)}}c.font("Helvetica-Bold",7),c.text("TOTAL",465,u-5),c.font("Helvetica",7),c.text(a.total.toFixed(2),520,u-5),c.rect(50,u-15,520,20).stroke();A=new Date;a.fecha=new Date(a.fecha),c.font("Helvetica",5),c.text("EMISIÓN: "+a.fecha.getDate()+"/"+(a.fecha.getMonth()+1)+"/"+a.fecha.getFullYear(),200,u+10),c.text("IMPRESIÓN: "+A.getDate()+"/"+(A.getMonth()+1)+"/"+A.getFullYear(),260,u+10),c.text("USUARIO: "+r.persona.nombre_completo,55,u+10),m>x||c.text(m+" de "+x,540,u+10),c.end(),l.on("finish",function(){var e=l.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),e.stop()}}]).factory("DibujarCabeceraPDFBaja",[function(){return function(e,t,o,a,n,i){e.font("Helvetica-Bold",7),e.text(i.empresa.razon_social,55,55),e.text("SUCURSAL: ",55,65),e.text("DIRECCIÓN: ",55,75);var r=(null!=a.sucursal.telefono1?a.sucursal.telefono1:"")+(null!=a.sucursal.telefono2?"-"+a.sucursal.telefono2:"")+(null!=a.sucursal.telefono3?"-"+a.sucursal.telefono3:"");e.text("TELF.: ",55,85),e.font("Helvetica",7),e.text(a.sucursal.nombre,105,65),e.text(a.sucursal.direccion,105,75),e.text(r,85,85),e.font("Helvetica-Bold",15),e.text("NOTA DE BAJA",0,65,{align:"center"}),e.font("Helvetica-Bold",7),a.fecha=new Date(a.fecha),e.font("Helvetica",11),e.text("Fecha: "+a.fecha.getDate()+"/"+(a.fecha.getMonth()+1)+"/"+a.fecha.getFullYear(),0,85,{align:"center"}),e.font("Helvetica-Bold",7),e.text("NRO. : "+a.factura,450,75),e.rect(50,40,520,60).stroke(),e.rect(50,100,520,25).stroke(),n?(e.text("CODIGO",55,110),e.text("CANT.",105,110),e.text("UNID.",135,110),e.text("DETALLE",170,110),e.text("P. UNIT.",300,110),e.text("IMPORTE",335,110),e.text("DESC.",385,110),e.text("REC.",420,110),e.text("ICE",455,110),e.text("EXC.",490,110),e.text("TOTAL",520,110)):(e.text("CODIGO",55,110),e.text("CANTIDAD",115,110),e.text("UNIDAD",160,110),i.empresa.usar_vencimientos?(e.text("DETALLE",210,110),e.text("FECHA VENC.",370,110),e.text("LOTE",430,110)):e.text("DETALLE",210,110),e.text("P.UNIT.",470,110),e.text("TOTAL",520,110))}}]).factory("ImprimirNotaBajaRollo",["blockUI","VerificarDescuentos",function(e,t){return function(o,a,n){var i=new PDFDocument({compress:!1,size:a,margins:{top:10,bottom:10,left:10,right:20}}),r=i.pipe(blobStream());t(o.detallesVenta);i.moveDown(2),i.font("Helvetica-Bold",8),i.text(n.empresa.razon_social.toUpperCase(),{align:"center"}),i.moveDown(.4),i.font("Helvetica",7),i.text(o.sucursal.nombre.toUpperCase(),{align:"center"}),i.moveDown(.4),i.text(o.sucursal.direccion.toUpperCase(),{align:"center"});var c=(null!=o.sucursal.telefono1?o.sucursal.telefono1:"")+(null!=o.sucursal.telefono2?"-"+o.sucursal.telefono2:"")+(null!=o.sucursal.telefono3?"-"+o.sucursal.telefono3:"");i.moveDown(.4),i.text("TELF.: "+c,{align:"center"}),i.moveDown(.4),i.text("COCHABAMBA - BOLIVIA",{align:"center"}),i.moveDown(.5),i.font("Helvetica-Bold",8),i.text("NOTA DE BAJA",{align:"center"}),o.fecha=new Date(o.fecha),i.font("Helvetica",8),i.text("Fecha: "+o.fecha.getDate()+"/"+(o.fecha.getMonth()+1)+"/"+o.fecha.getFullYear(),{align:"center"}),i.font("Helvetica-Bold",8),i.moveDown(.4),i.text("------------------------------------",{align:"center"}),i.moveDown(.4),i.font("Helvetica-Bold",7);var l=165;i.moveDown(.4),i.text("COD.",10,145),i.text("CANT.",35,145),i.text("DETALL.",60,145),i.text("F. VENC.",128,145),i.text("LOTE",162,145),i.text("TOTAL",183,145),i.moveDown(.4);for(var s=0;s<o.detallesVenta.length;s++){i.font("Helvetica",7),i.moveDown(.4),i.text(o.detallesVenta[s].producto.codigo,10,l,{width:25}),i.text(o.detallesVenta[s].cantidad,38,l),i.text(o.detallesVenta[s].producto.nombre,57,l,{width:70});var d=new Date(o.detallesVenta[s].inventario.fecha_vencimiento);console.log((new Date).getFullYear().toString().substr(-2)),i.text(d.getDate()+"/"+(d.getMonth()+1)+"/"+d.getFullYear().toString().substr(-2),128,l),i.text(o.detallesVenta[s].inventario.lote,164,l),i.text(o.detallesVenta[s].total.toFixed(2),187,l,{width:100}),l+=30}var u=new Date;o.fecha=new Date(o.fecha),i.moveDown(.4),i.font("Helvetica",6),i.text("EMISIÓN: "+o.fecha.getDate()+"/"+(o.fecha.getMonth()+1)+"/"+o.fecha.getFullYear(),150,l+190),i.text("IMPRESIÓN: "+u.getDate()+"/"+(u.getMonth()+1)+"/"+u.getFullYear(),15,l+200),i.text("USUARIO: "+n.persona.nombre_completo,15,l+190),i.end(),r.on("finish",function(){var e=r.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),e.stop()}}]).factory("ImprimirNotaTraspaso",["Diccionario","blockUI","ImprimirNotaTraspasoCartaOficio","ImprimirNotaTraspasoRollo",function(e,t,o,a){return function(n,i){if(t.start(),n.configuracion.tamanoPapelNotaTraspaso.nombre_corto==e.FACT_PAPEL_OFICIO)papel=[612,936],itemsPorPagina=19,o(n,papel,itemsPorPagina,i);else if(n.configuracion.tamanoPapelNotaTraspaso.nombre_corto==e.FACT_PAPEL_CARTA)papel=[612,792],itemsPorPagina=16,o(n,papel,itemsPorPagina,i);else if(n.configuracion.tamanoPapelNotaTraspaso.nombre_corto==e.FACT_PAPEL_MEDIOOFICIO)papel=[612,468],itemsPorPagina=9,o(n,papel,itemsPorPagina,i);else if(n.configuracion.tamanoPapelNotaTraspaso.nombre_corto==e.FACT_PAPEL_ROLLO){var r,c=n.detallesVenta.length;r=c<=2?440:440+30*(c-2),papel=[227,r],a(n,papel,i)}}}]).factory("ImprimirNotaTraspasoCartaOficio",["blockUI","VerificarDescuentos","DibujarCabeceraPDFTraspaso",function(e,t,o){return function(a,n,i,r){var c=new PDFDocument({compress:!1,size:n,margin:0}),l=c.pipe(blobStream()),s=t(a.detallesVenta);c.font("Helvetica",8);var d,u,f=150,m=0,x=1,p=Math.ceil(a.detallesVenta.length/i),g=0;o(c,1,p,a,s,r);for(var _=0;_<a.detallesVenta.length&&m<=i;_++){if(s)c.font("Helvetica",7),u=(d=a.detallesVenta[_].producto.codigo.length)<=15?f:d>15&&d<=15?f-4:f-11,c.text(a.detallesVenta[_].producto.codigo,55,u,{width:40}),c.text(a.detallesVenta[_].cantidad,110,f),c.text(a.detallesVenta[_].producto.unidad_medida,135,f),c.text(a.detallesVenta[_].producto.nombre,170,f-6,{width:130}),c.text(a.detallesVenta[_].producto.precio_unitario.toFixed(2),300,f),c.text(a.detallesVenta[_].importe.toFixed(2),335,f),c.text(a.detallesVenta[_].descuento.toFixed(2),385,f),c.text(a.detallesVenta[_].recargo.toFixed(2),420,f),c.text(a.detallesVenta[_].ice.toFixed(2),455,f),c.text(a.detallesVenta[_].excento.toFixed(2),490,f),c.text(a.detallesVenta[_].total.toFixed(2),520,f);else{if(c.font("Helvetica",7),u=(d=a.detallesVenta[_].producto.codigo.length)<=15?f:d>15&&d<=15?f-4:f-11,c.font("Helvetica",6),c.text(a.detallesVenta[_].producto.codigo,55,u,{width:70}),c.font("Helvetica",7),c.text(a.detallesVenta[_].cantidad,135,f),c.text(a.detallesVenta[_].producto.unidad_medida,160,f),u=(d=a.detallesVenta[_].producto.nombre.length)<=25?f:d>25&&d<=40?f-4:f-11,r.empresa.usar_vencimientos){if(c.font("Helvetica",6),c.text(a.detallesVenta[_].producto.nombre,210,u,{width:175}),c.font("Helvetica",7),a.detallesVenta[_].inventario){var E=new Date(a.detallesVenta[_].inventario.fecha_vencimiento);c.text(E.getDate()+"/"+(E.getMonth()+1)+"/"+E.getFullYear(),390,f),c.text(a.detallesVenta[_].inventario.lote,455,f)}}else c.text(a.detallesVenta[_].producto.nombre,210,u,{width:250});c.text(a.detallesVenta[_].producto.precio_unitario.toFixed(2),490,f),c.text(a.detallesVenta[_].total.toFixed(2),530,f)}if(c.rect(50,f-15,520,30).stroke(),f+=30,++m==i&&(g+=m)!=a.detallesVenta.length){var A=new Date;a.fecha=new Date(a.fecha),c.font("Helvetica",6),c.text("EMISIÓN: "+a.fecha.getDate()+"/"+(a.fecha.getMonth()+1)+"/"+a.fecha.getFullYear(),200,f-10),c.text("IMPRESIÓN: "+A.getDate()+"/"+(A.getMonth()+1)+"/"+A.getFullYear(),260,f-10),c.text("USUARIO: "+r.persona.nombre_completo,55,f-10),c.text(x+" de "+p,540,f-10),c.addPage({margin:0,bufferPages:!0}),f=140,m=0,o(c,x+=1,p,a,s,r),c.font("Helvetica",8)}}c.font("Helvetica-Bold",8),c.text("TOTAL",465,f-5),c.font("Helvetica",8),c.text(a.total.toFixed(2),520,f-5),c.rect(50,f-15,520,20).stroke(),c.text("------------------------------------------",180,f+80),c.text("------------------------------------------",340,f+80),c.text("ENTREGA CONFORME",190,f+90),c.text("RECIBO CONFORME",350,f+90);A=new Date;a.fecha=new Date(a.fecha),c.font("Helvetica",6),c.text("EMISIÓN: "+a.fecha.getDate()+"/"+(a.fecha.getMonth()+1)+"/"+a.fecha.getFullYear(),200,f+10),c.text("IMPRESIÓN: "+A.getDate()+"/"+(A.getMonth()+1)+"/"+A.getFullYear(),260,f+10),c.text("USUARIO: "+r.persona.nombre_completo,55,f+10),x>p||c.text(x+" de "+p,540,f+10),c.end(),l.on("finish",function(){var e=l.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),e.stop()}}]).factory("DibujarCabeceraPDFTraspaso",[function(){return function(e,t,o,a,n,i){e.rect(50,40,520,70).stroke(),e.rect(50,110,520,25).stroke(),e.font("Helvetica-Bold",7),e.text(i.empresa.razon_social,55,55),e.text("SUCURSAL: ",55,65),e.text("DIRECCIÓN: ",55,75);var r=(null!=a.sucursal.telefono1?a.sucursal.telefono1:"")+(null!=a.sucursal.telefono2?"-"+a.sucursal.telefono2:"")+(null!=a.sucursal.telefono3?"-"+a.sucursal.telefono3:"");e.text("TELF.: ",55,95),e.font("Helvetica",8),e.text(a.sucursal.nombre,105,65),e.text(a.sucursal.direccion,105,75,{width:120}),e.text(r,85,95),e.font("Helvetica-Bold",15),e.text("NOTA DE TRASPASO",0,60,{align:"center"}),e.font("Helvetica-Bold",7),e.text("DE SUCURSAL: "+a.sucursal.nombre+" A "+a.sucursalDestino.nombre,0,78,{align:"center"}),e.text("NRO. : "+a.factura,450,75),n?(e.text("CODIGO",55,120),e.text("CANT.",105,120),e.text("UNID.",135,120),e.text("DETALLE",170,120),e.text("P. UNIT.",300,120),e.text("IMPORTE",335,120),e.text("DESC.",385,120),e.text("REC.",420,120),e.text("ICE",455,120),e.text("EXC.",490,120),e.text("TOTAL",520,120)):(e.text("CODIGO",55,120),e.text("CANT.",128,120),e.text("UNID.",165,120),i.empresa.usar_vencimientos?(e.text("DETALLE",210,120,{width:110}),e.text("FECHA VENC.",380,120),e.text("LOTE",450,120)):e.text("DETALLE",190,120,{width:250}),e.text("P.UNIT.",490,120),e.text("TOTAL",530,120))}}]).factory("ImprimirNotaTraspasoRollo",["blockUI","VerificarDescuentos",function(e,t){return function(o,a,n){var i=new PDFDocument({compress:!1,size:a,margins:{top:10,bottom:10,left:10,right:20}}),r=i.pipe(blobStream());t(o.detallesVenta);i.moveDown(2),i.font("Helvetica-Bold",8),i.text(n.empresa.razon_social.toUpperCase(),{align:"center"}),i.moveDown(.4),i.font("Helvetica",7),i.text(o.sucursal.nombre.toUpperCase(),{align:"center"}),i.moveDown(.4),i.text(o.sucursal.direccion.toUpperCase(),{align:"center"});var c=(null!=o.sucursal.telefono1?o.sucursal.telefono1:"")+(null!=o.sucursal.telefono2?"-"+o.sucursal.telefono2:"")+(null!=o.sucursal.telefono3?"-"+o.sucursal.telefono3:"");i.moveDown(.4),i.text("TELF.: "+c,{align:"center"}),i.moveDown(.4),i.text("COCHABAMBA - BOLIVIA",{align:"center"}),i.moveDown(.5),i.font("Helvetica-Bold",8),i.text("NOTA DE TRASPASO ",{align:"center"}),i.text("DE SUCURSAL: "+o.sucursal.nombre+" A "+o.sucursalDestino.nombre,{align:"center"}),i.font("Helvetica-Bold",8),i.moveDown(.4),i.text("------------------------------------",{align:"center"}),i.moveDown(.4),i.font("Helvetica-Bold",7);var l,s,d=160;i.moveDown(.4),i.text("COD.",10,145),i.text("CANT.",35,145),i.text("DETALL.",60,145),i.text("F. VENC.",128,145),i.text("LOTE",162,145),i.text("TOTAL",183,145),i.moveDown(.4);for(var u=0;u<o.detallesVenta.length;u++){if(i.font("Helvetica",7),s=(l=o.detallesVenta[u].producto.codigo.length)<=15?d:l>15&&l<=15?d-4:d-11,i.moveDown(.4),i.text(o.detallesVenta[u].producto.codigo,10,s,{width:25}),i.text(o.detallesVenta[u].cantidad,38,d),i.text(o.detallesVenta[u].producto.nombre,57,d,{width:70}),o.detallesVenta[u].inventario){var f=new Date(o.detallesVenta[u].inventario.fecha_vencimiento);console.log((new Date).getFullYear().toString().substr(-2)),i.text(f.getDate()+"/"+(f.getMonth()+1)+"/"+f.getFullYear().toString().substr(-2),128,d),i.text(o.detallesVenta[u].inventario.lote,164,d)}i.text(o.detallesVenta[u].total.toFixed(2),187,d,{width:100}),d+=30}var m=new Date;o.fecha=new Date(o.fecha),i.font("Helvetica-Bold",8),i.x=10,i.text("   -----------------------------                 --------------------------",0,d+130,{align:"center"}),i.text("   ENTREGUE CONFORME          RECIBI CONFORME",{align:"center"}),i.moveDown(.4),i.font("Helvetica",6),i.text("EMISIÓN: "+o.fecha.getDate()+"/"+(o.fecha.getMonth()+1)+"/"+o.fecha.getFullYear(),150,d+190),i.text("IMPRESIÓN: "+m.getDate()+"/"+(m.getMonth()+1)+"/"+m.getFullYear(),15,d+200),i.text("USUARIO: "+n.persona.nombre_completo,15,d+190),i.end(),r.on("finish",function(){var e=r.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),e.stop()}}]).factory("ImprimirPdfAlertaDespacho",["blockUI","DibujarCabeceraPDFAlertaDespacho",function(e,t){return function(o,a,n,i){e.start();var r=new PDFDocument({compress:!1,size:"letter",margin:10}),c=r.pipe(blobStream()),l=130,s=0,d=1,u=Math.ceil(o.length/24);t(r,1,u,o,a,n,i),r.font("Helvetica",8);for(var f=0;f<o.length&&s<=24;f++){var m=o[f];r.text(f+1,45,l),r.text(m.despacho.usuario.persona.nombre_completo,70,l,{width:100}),r.text(m.despacho.cliente.razon_social,190,l,{width:100}),r.text(m.producto.nombre,300,l,{width:110}),r.text(m.cantidad,420,l,{width:50}),r.text(m.cantidad_despacho,460,l,{width:50}),r.text(m.cantidad-m.cantidad_despacho,500,l,{width:50}),r.text("Bs. "+m.servicio_transporte+".-",545,l,{width:80}),l+=25,24==++s&&(r.addPage({margin:0,bufferPages:!0}),l=130,s=0,t(r,d+=1,u,o,a,n,i),r.font("Helvetica",8))}r.end(),c.on("finish",function(){var e=c.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),e.stop()}}]).factory("ImprimirPdfDespachos",["blockUI","DibujarCabeceraPDFDespacho",function(e,t){return function(o,a,n){e.start();var i=new PDFDocument({compress:!1,size:"letter",margin:10}),r=i.pipe(blobStream()),c=0,l=0,s=130,d=0,u=1,f=Math.ceil(o.length/24);t(i,1,f,o,a,n),i.font("Helvetica",8);for(var m=0;m<o.length&&d<=24;m++){var x=o[m];i.text(m+1,45,s),i.text(x.despacho.usuario.persona.nombre_completo,70,s,{width:100}),i.text(x.despacho.cliente.razon_social,190,s,{width:100}),i.text(x.producto.nombre,320,s,{width:110}),i.text(x.cantidad,440,s,{width:50}),i.text("Bs. "+x.servicio_transporte+".-",500,s,{width:80}),s+=25,24==++d&&(i.addPage({margin:0,bufferPages:!0}),s=130,d=0,t(i,u+=1,f,o,a,n),i.font("Helvetica",8)),c+=x.cantidad,l+=x.servicio_transporte}i.font("Helvetica-Bold",8),i.text("TOTALES:",350,s,{width:80}),i.text(c,440,s,{width:80}),i.text("Bs. "+l+".-",500,s,{width:80}),i.end(),r.on("finish",function(){var e=r.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),e.stop()}}]).factory("ExportarExelAlarmasDespachos",["blockUI",function(e){return res=function(t,o,a){var n="Todos",i="Todos";""!=o.empleado&&(n=t[0].despacho.usuario.persona.nombre_completo),""!=o.razon_social&&(i=t[0].despacho.cliente.razon_social);for(var r=[["","","REPORTE DE PEDIDOS "],["Vendedor :"+n],["Cliente :"+i],["Nro","Vendedor","Cliente","Direccion","Razón social","Fecha","Producto","Cant.","Desp.","Saldo","S. Transp."]],c=0;c<t.length;c++){var l=t[c];l.despacho.usuario.persona.nombre_completo;var s=[];s.push(c+1),s.push(l.despacho.usuario.persona.nombre_completo),s.push(l.despacho.cliente.razon_social),s.push(l.despacho.destino.direccion),s.push(l.despacho.cliente_razon.razon_social);var d=new Date(l.despacho.fecha),u=d.getDate()>=10?d.getDate():"0"+d.getDate(),f=d.getMonth()>=10?d.getMonth()+1:"0"+(d.getMonth()+1);s.push(u+"/"+f+"/"+d.getFullYear()),s.push(l.producto.nombre),s.push(l.cantidad),s.push(l.cantidad_despacho);var m=l.cantidad-l.cantidad_despacho;s.push(m),s.push(l.servicio_transporte),r.push(s)}var x="SheetJS",p=new Workbook,g=sheet_from_array_of_arrays(r);p.SheetNames.push(x),p.Sheets[x]=g;var _=XLSX.write(p,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(_)],{type:"application/octet-stream"}),"REPORTE-PEDIDOS.xlsx"),e.stop()},res}]).factory("ExportarExelDespachos",["blockUI",function(e){return res=function(t,o,a){for(var n=[["","","REPORTE DE DESPACHOS "],["cod. dest","Destino","Direccion","Cod Cliente","Cliente","cod dest.factura","Razón social","NIT","Vendedor","Nro. pedido","F. Pedido","Factura SAP","fecha fact.","No. Despacho","fecha desp.","Transportista","doc. Cobranza","Fecha Pago","Cod. prodcuto","Producto","cant. pedido","cant. Despacho","P/U","Total","Costo Transportista","Grupo de Estibaje","Tipo de Estibaje","Costo Estibaje","Precio Transporte","Total Pedido"]],i=0;i<t.length;i++){var r=t[i],c=[];c.push(void 0!=r.despacho.destino?r.despacho.destino.codigo:""),c.push(void 0!=r.despacho.destino?r.despacho.destino.destino:"Sin destino"),c.push(void 0!=r.despacho.destino?r.despacho.destino.direccion:"Sin direccion"),c.push(r.despacho.cliente.codigo),c.push(r.despacho.cliente.razon_social),c.push(void 0!=r.despacho.cliente_razon?r.despacho.cliente_razon.codigo_sap:""),c.push(void 0!=r.despacho.cliente_razon?r.despacho.cliente_razon.razon_social:""),c.push(void 0!=r.despacho.cliente_razon?r.despacho.cliente_razon.nit:""),c.push(r.despacho.usuario.persona.nombre_completo);var l=new Date(r.despacho.fecha);l.getDate()>=10?l.getDate():l.getDate(),l.getMonth()>=10?l.getMonth():l.getMonth();c.push(r.despacho.id),c.push(new Date(r.despacho.fecha)),c.push(r.factura),c.push(new Date(r.fecha_factura)),c.push(r.numero_correlativo);var s=new Date(r.fecha);s.getDate()>=10?s.getDate():s.getDate(),s.getMonth()+1>=10?s.getMonth():s.getMonth();c.push(new Date(r.fecha)),c.push(r.transportista.persona.nombre_completo),c.push(""),c.push(""),c.push(r.producto.codigo),c.push(r.producto.nombre),c.push(r.cantidad),c.push(r.cantidad_despacho),c.push(r.precio_unitario);var d=r.precio_unitario*r.cantidad_despacho;c.push(d);var u=r.transportista.costo_transporte*r.cantidad_despacho;c.push(u),c.push(r.grupo_estibaje.nombre),c.push(r.estibaje.nombre);var f=r.estibaje.costo*r.cantidad_despacho;c.push(f),c.push(r.servicio_transporte);var m=r.servicio_transporte+d;c.push(m),c.push(void 0!=r.despacho.cliente_razon?r.despacho.cliente_razon.codigo_sap:""),n.push(c)}var x="SheetJS",p=new Workbook,g=sheet_from_array_of_arrays(n);p.SheetNames.push(x),p.Sheets[x]=g;var _=XLSX.write(p,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(_)],{type:"application/octet-stream"}),"REPORTE-DESPACHOS.xlsx"),e.stop()},res}]).factory("DibujarCabeceraPDFAlertaDespacho",[function(){return res=function(e,t,o,a,n,i,r){var c={inicio:n.inicio,fin:n.fin};if(e.font("Helvetica-Bold",12),e.text("REPORTE DE PEDIDOS",0,25,{align:"center"}),e.font("Helvetica",12),c.inicio&&c.fin){c.inicio=new Date(r(c.inicio)),c.fin=new Date(r(c.fin));var l=c.inicio.getMonth()+1<10?"0"+(c.inicio.getMonth()+1):c.inicio.getMonth()+1,s=c.inicio.getDate()<10?"0"+c.inicio.getDate():c.inicio.getDate(),d=c.fin.getMonth()+1<10?"0"+(c.fin.getMonth()+1):c.fin.getMonth()+1,u=c.fin.getDate()<10?"0"+c.fin.getDate():c.fin.getDate();e.text(s+"/"+l+"/"+c.inicio.getFullYear()+" AL "+u+"/"+d+"/"+c.fin.getFullYear(),0,45,{align:"center"})}e.font("Helvetica-Bold",8),e.text("PÁGINA "+t+" DE "+o,0,740,{align:"center"});var f="Todos",m="Todos";""!=c.empleado&&(f=a[0].despacho.usuario.persona.nombre_completo),""!=c.razon_social&&(m=a[0].despacho.cliente.razon_social),e.font("Helvetica-Bold",8),e.text("Vendedor : "+f,45,80),e.text("Cliente : "+m,245,80),e.font("Helvetica",8),e.font("Helvetica-Bold",8),e.text("Nro.",45,110),e.text("Vendedor",80,110,{width:50}),e.text("Cliente",200,110,{width:60}),e.text("Producto",300,110,{width:50}),e.text("Cant.",420,110,{width:50}),e.text("desp.",460,110,{width:50}),e.text("saldo",500,110,{width:50}),e.text("S. Transp.",545,110,{width:80}),e.font("Helvetica",8);var x=new Date;e.text("USUARIO: "+i.persona.nombre_completo+" fecha "+x.getDate()+"/"+(x.getMonth()+1)+"/"+x.getFullYear()+"Hrs."+x.getHours()+":"+x.getMinutes(),15,765)},res}]).factory("DibujarCabeceraPDFDespacho",[function(){return res=function(e,t,o,a,n,i){if(e.font("Helvetica-Bold",12),e.text("REPORTE DE PEDIDOS",0,25,{align:"center"}),e.font("Helvetica",12),n.inicio&&n.fin){var r=n.inicio.getMonth()+1<10?"0"+(n.inicio.getMonth()+1):n.inicio.getMonth()+1,c=n.inicio.getDate()<10?"0"+n.inicio.getDate():n.inicio.getDate(),l=n.fin.getMonth()+1<10?"0"+(n.fin.getMonth()+1):n.fin.getMonth()+1,s=n.fin.getDate()<10?"0"+n.fin.getDate():n.fin.getDate();e.text(c+"/"+r+"/"+n.inicio.getFullYear()+" AL "+s+"/"+l+"/"+n.fin.getFullYear(),0,45,{align:"center"})}e.font("Helvetica-Bold",8),e.text("PÁGINA "+t+" DE "+o,0,740,{align:"center"});e.font("Helvetica-Bold",8),e.text("Vendedor : Todos",45,80),e.text("Cliente : Todos",245,80),e.font("Helvetica",8),e.font("Helvetica-Bold",8),e.text("Nro.",45,110),e.text("Vendedor",80,110,{width:50}),e.text("Cliente",200,110,{width:60}),e.text("Producto",320,110,{width:50}),e.text("Cant.",440,110,{width:50}),e.text("S. Transp.",500,110,{width:80}),e.font("Helvetica",8);var d=new Date;e.text("USUARIO: "+i.persona.nombre_completo+" fecha "+d.getDate()+"/"+(d.getMonth()+1)+"/"+d.getFullYear()+"Hrs."+d.getHours()+":"+d.getMinutes(),15,765)},res}]);