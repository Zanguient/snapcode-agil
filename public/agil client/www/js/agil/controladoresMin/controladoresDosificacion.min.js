angular.module("agil.controladores").controller("ControladorDosificaciones",["$scope","$localStorage","$location","$templateCache","$route","blockUI","Dosificacion","Dosificaciones","DosificacionesEmpresa","ClasesTipo",function(a,o,i,c,n,e,r,t,s,d){a.idModalWizardDosificacionEdicion="modal-wizard-dosificacion-edicion",a.idModalWizardDosificacionVista="modal-wizard-dosificacion-vista",a.idModalEliminarDosificacion="dialog-eliminar-dosificacion",a.idModalContenedorDosificacionEdicion="modal-wizard-container-dosificacion-edicion",a.idModalContenedorDosificacionVista="modal-wizard-container-dosificacion-vista",a.usuario=JSON.parse(o.usuario),a.inicio=function(){a.obtenerDosificaciones(),a.obtenerPiesFactura(),setTimeout(function(){ejecutarScriptsTabla("tabla-dosificaciones",6)},2e3)},a.obtenerPiesFactura=function(){e.start(),d("PIÉFACT").then(function(i){a.piesFactura=i.clases,e.stop()})},a.obtenerDosificaciones=function(){e.start(),t(a.usuario.id_empresa).then(function(i){a.dosificaciones=i,e.stop()})},a.$on("$viewContentLoaded",function(){resaltarPestaña(i.path().substring(1)),ejecutarScriptsDosificacion(a.idModalWizardDosificacionEdicion,a.idModalWizardDosificacionVista,a.idModalEliminarDosificacion,a.idModalContenedorDosificacionEdicion,a.idModalContenedorDosificacionVista),a.buscarAplicacion(a.usuario.aplicacionesUsuario,i.path().substring(1)),e.stop()}),a.crearNuevaDosificacion=function(){var i=JSON.parse(o.usuario);a.dosificacion=new r({id_empresa:i.id_empresa}),a.abrirPopup(a.idModalWizardDosificacionEdicion)},a.verDosificacion=function(i){(a.dosificacion=i).fecha_limite_emision=new Date(i.fecha_limite_emision),a.dosificacion.fechaTexto=i.fecha_limite_emision.getDate()+"/"+(i.fecha_limite_emision.getMonth()+1)+"/"+i.fecha_limite_emision.getFullYear(),a.abrirPopup(a.idModalWizardDosificacionVista)},a.cerrarPopPupVista=function(){a.cerrarPopup(a.idModalWizardDosificacionVista)},a.cerrarPopPupEdicion=function(){a.cerrarPopup(a.idModalWizardDosificacionEdicion)},a.modificarDosificacion=function(i){(a.dosificacion=i).fecha_limite_emision=new Date(i.fecha_limite_emision),a.dosificacion.fechaTexto=i.fecha_limite_emision.getDate()+"/"+(i.fecha_limite_emision.getMonth()+1)+"/"+i.fecha_limite_emision.getFullYear(),a.abrirPopup(a.idModalWizardDosificacionEdicion)},a.mostrarConfirmacionEliminacion=function(i){a.dosificacion=new r(i),a.abrirPopup(a.idModalEliminarDosificacion)},a.cerrarConfirmacionEliminacion=function(){a.cerrarPopup(a.idModalEliminarDosificacion)},a.eliminarDosificacion=function(i){e.start(),a.cerrarConfirmacionEliminacion(),i.$delete(),a.mostrarMensaje("Eliminado exitosamente!"),a.recargarItemsTabla(),e.stop()},a.saveForm=function(i){"Siguiente"!=$("#siguiente").text().trim()&&(e.start(),i.fecha_limite_emision=new Date(a.convertirFecha(i.fechaTexto)),i.id?r.update({idDosificacion:i.id},i,function(i){e.stop(),a.cerrarPopPupEdicion(),a.mostrarMensaje("Actualizado Exitosamente!"),a.recargarItemsTabla()}):i.$save(function(i){e.stop(),a.dosificacion=new r({}),a.cerrarPopPupEdicion(),a.mostrarMensaje("Guardado Exitosamente!"),a.recargarItemsTabla()},function(i){e.stop(),a.cerrarPopPupEdicion(),a.mostrarMensaje("Ocurrio un problema al momento de guardar!"),a.recargarItemsTabla()}))},a.$on("$routeChangeStart",function(i,o){a.eliminarPopup(a.idModalWizardDosificacionEdicion),a.eliminarPopup(a.idModalWizardDosificacionVista),a.eliminarPopup(a.idModalEliminarDosificacion)}),a.inicio()}]);