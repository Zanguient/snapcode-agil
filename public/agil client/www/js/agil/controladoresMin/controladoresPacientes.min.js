angular.module("agil.controladores").controller("ControladorPacientes",["$scope","$sce","blockUI","$localStorage","$window","$location","$templateCache","$route","Usuario","Paginator","DatosPacientes","Paciente","$filter","PacientesPaginador","ListaDatosPrerequisito","CrearPrerequisito","Prerequisito","DatosPrerequisitoPaciente","ListaDatosGenero","Vacunas","ltsVacunas","PacienteVacuna","VacunasPaciente","asignacionPacienteVacuna","aplicacionPacienteVacuna","VacunasPacientedosis","CrearMedicoPacienteConsulta","ListaConsultasMedicoPaciente","CrearMedicoPacienteFicha","BuscarFichaPaciente","ListaDatosTiposControl","ActualizarPatologiaPaciente","ListaPrerequisitosEmpresa","ListaPrerequisitosPaciente","ActualizarPrerequisito","CrearLaboratorio","ListaLaboratorios","CrearLaboratorioExamen","ListaLaboratorioExamenes","CrearLaboratorioExamenResultado","LaboratorioExamenListaHistorial","CrearDiagnostico","ListaDiagnosticos","CrearDiagnosticoExamen","ListaDiagnosticoExamenes","DiagnosticoExamenListaHistorial","CrearDiagnosticoExamenResultado","PacientesEmpresa","ListaVacunasEmpresa","FichasTecnicasPacientes","SignosVitalesPacientes","SOAPlistaPacientes","aplicacionVacunasPacientes","obtenerPaciente","Comentario","FieldViewer","PacienteActivo","HistorialFichaMedicoPaciente","ActualizarLaboratorio","ActualizarLaboratorioExamen","ActualizarDiagnostico","ActualizarDiagnosticoExamen","Tipos","EliminarLaboratorio","EliminarLaboratorioExamen","EliminarDiagnosticoExamen","EliminarDiagnostico","Prerequisitos","PrerequisitoPaciente","ListaAlertasPrerequisitosPaciente","PrerequisitosHistorial","ListaAlertasVacunasEmpresa","Vacuna","ClasesTipo","ValidarCodigoCuentaEmpleado","$timeout","ClasesTipoEmpresa","PrerequisitosSave",function(g,a,r,i,e,o,n,t,c,s,l,u,d,f,p,m,D,v,h,P,M,b,_,V,A,E,x,w,q,C,I,S,F,L,T,R,H,N,j,O,y,Y,G,z,U,k,X,B,J,W,K,Q,Z,aa,ia,ea,oa,na,ta,ra,ca,sa,la,ua,da,fa,pa,ga,ma,Da,va,ha,Pa,Ma,ba,_a,Va,Aa){g.usuario=JSON.parse(i.usuario),g.idModalDialogVacunas="dialog-vacunas",g.idModalDialogConsulta="modal-wizard-consulta",g.idModalwizardContainerConsulta="modal-wizard-container-consulta",g.idModalDialogVacunasConfig="dialog-vacunas-config",g.idModalDialogVacunaEdicion="dialog-vacuna-nueva",g.idModalDialogFechaEntrega="dialog-fecha-entrega",g.IdModalDialogPreRequisitos="modal-preRequisitos",g.IdModalDialogLaboratorio="dialog-laboratorio",g.IdModalDialogGraficoSV="dialog-grafico",g.idModalDialogHistorico="dialog-previewHistorico",g.idModalFichaTecnica="modal-fichaMedica",g.idModalwizardContainerFichaTecnica="modal-wizard-container-ficha",g.IdModalDialogLaboratorioExamen="dialog-nuevo-examen",g.IdModalDialogLaboratorioExamenes="dialog-examenes",g.IdModalDialogLaboratorioExamenesNuevoResultado="dialog-nuevo-resultado",g.IdModalDialogLaboratorioExamenHistoricoPreview="dialog-previewHistorico",g.IdModalDialogLaboratorioExamenHistoricoResultado="dialog-historico-resultado",g.IdEntregaPrerequisito="dialog-entrega-preRequisito",g.idModalDialogPacienteNuevo="dialog-paciente-nuevo",g.idModalDialogPrerequisitoNuevo="dialog-pre-requisito-nuevo",g.idModalwizardContainerPaciente="modal-wizard-paciente-container",g.idModalHistorialPrerequisito="dialog-historico-preRequisito",g.idModalEditarPrerequisito="dialog-editar-preRequisito",g.idModalDialogHistorialVacuna="dialog-historial-vacuna",g.idModalDialogHistorialVacunaGeneral="dialog-historial-vacuna-general",g.idModalDialogDiagnosticos="dialog-diagnosticos",g.idModalDialogDiagnosticoNuevo="dialog-diagnostico-nuevo",g.idModalDialogExamenesDiagnostico="dialog-examenesDiagnostico",g.idModalDialogNuevoExamenDiagnostico="dialog-examenDiagnostico-nuevo",g.idModalDialogHistorialFicha="dialog-historico-ficha",g.idModalDialogCredencial="dialog-credencial",g.idModalDialogPatologias="dialog-patologias",g.idModalDialogComentario="dialog-editar-comentario",g.idModalAlertPrerequisitos="dialog-alertPre-requisitos",g.idModalDiasActivacionPrerequisitos="dialog-diasActivacion-Prerequisitos",g.idModalReprogramarPrerequisitos="dialog-reprogramar-prerequisito",g.idModalAlertVacunas="dialog-alertVacunas",g.idModalDiasActivacionVacunas="dialog-diasActivacion-Vacunas",g.idModalReprogramarVacunas="dialog-reprogramar-vacunas",g.idImagenUsuario="imagen-persona",g.idModalHistorialConsulta="dialog-historial-consulta",g.idModalWizardPacienteVista="dialog-paciente-vista",g.idModalContenedorPacienteVista="modal-wizard-container-paciente-vista",g.idModalEliminarPaciente="dialog-eliminar-paciente",g.IdModalDialogNuevoLaboratorio="dialog-nuevo-laboratorio",g.IdModalDialogDiagnosticoExamenHistoricoResultado="dialog-historico-resultado-diag",g.idModalDialogVerResultadosHistorialLab="dialog-ver-resultados-Examen",g.idModalDialogConfirmacionEntregaAdelantado="dialog-entrega-adelantada-prerequisito",g.idModalConceptoEdicion="dialog-conceptos",g.$on("$viewContentLoaded",function(){resaltarPestaña(o.path().substring(1)),ejecutarScriptsPacientes(g.idModalDialogVacunas,g.idModalDialogConsulta,g.idModalwizardContainerConsulta,g.idModalDialogVacunasConfig,g.idModalDialogVacunaEdicion,g.idModalDialogFechaEntrega,g.IdModalDialogPreRequisitos,g.IdModalDialogLaboratorio,g.IdModalDialogGraficoSV,g.idModalDialogHistorico,g.idModalFichaTecnica,g.idModalwizardContainerFichaTecnica,g.IdModalDialogLaboratorioExamen,g.IdModalDialogLaboratorioExamenes,g.IdModalDialogLaboratorioExamenesNuevoResultado,g.IdModalDialogLaboratorioExamenHistoricoPreview,g.IdModalDialogLaboratorioExamenHistoricoResultado,g.IdEntregaPrerequisito,g.idModalDialogPacienteNuevo,g.idModalDialogPrerequisitoNuevo,g.idModalwizardContainerPaciente,g.idModalHistorialPrerequisito,g.idModalEditarPrerequisito,g.idModalDialogHistorialVacuna,g.idModalDialogHistorialVacunaGeneral,g.idModalDialogDiagnosticos,g.idModalDialogDiagnosticoNuevo,g.idModalDialogExamenesDiagnostico,g.idModalDialogNuevoExamenDiagnostico,g.idModalDialogHistorialFicha,g.idModalDialogCredencial,g.idModalDialogPatologias,g.idModalDialogComentario,g.idModalAlertPrerequisitos,g.idModalDiasActivacionPrerequisitos,g.idModalReprogramarPrerequisitos,g.idModalAlertVacunas,g.idModalDiasActivacionVacunas,g.idModalReprogramarVacunas,g.idImagenUsuario,g.idModalHistorialConsulta,g.idModalWizardPacienteVista,g.idModalContenedorPacienteVista,g.idModalEliminarPaciente,g.IdModalDialogNuevoLaboratorio,g.IdModalDialogDiagnosticoExamenHistoricoResultado,g.idModalDialogVerResultadosHistorialLab,g.idModalDialogConfirmacionEntregaAdelantado,g.idModalConceptoEdicion),g.buscarAplicacion(g.usuario.aplicacionesUsuario,o.path().substring(1)),g.obtenerColumnasAplicacion()}),g.$on("$routeChangeStart",function(a,i){g.eliminarPopup(g.idModalEliminarPaciente),g.eliminarPopup(g.idModalDialogVacunas),g.eliminarPopup(g.idModalDialogConsulta),g.eliminarPopup(g.idModalDialogVacunasConfig),g.eliminarPopup(g.idModalDialogVacunaEdicion),g.eliminarPopup(g.idModalDialogFechaEntrega),g.eliminarPopup(g.IdModalDialogPreRequisitos),g.eliminarPopup(g.IdModalDialogLaboratorio),g.eliminarPopup(g.IdModalDialogGraficoSV),g.eliminarPopup(g.idModalDialogHistorico),g.eliminarPopup(g.idModalFichaTecnica),g.eliminarPopup(g.IdModalDialogLaboratorioExamen),g.eliminarPopup(g.IdModalDialogLaboratorioExamenes),g.eliminarPopup(g.IdModalDialogLaboratorioExamenesNuevoResultado),g.eliminarPopup(g.IdModalDialogLaboratorioExamenHistoricoResultado),g.eliminarPopup(g.IdEntregaPrerequisito),g.eliminarPopup(g.idModalDialogPacienteNuevo),g.eliminarPopup(g.idModalDialogPrerequisitoNuevo),g.eliminarPopup(g.idModalHistorialPrerequisito),g.eliminarPopup(g.idModalEditarPrerequisito),g.eliminarPopup(g.idModalDialogHistorialVacuna),g.eliminarPopup(g.idModalDialogHistorialVacunaGeneral),g.eliminarPopup(g.idModalDialogDiagnosticos),g.eliminarPopup(g.idModalDialogDiagnosticoNuevo),g.eliminarPopup(g.idModalDialogExamenesDiagnostico),g.eliminarPopup(g.idModalDialogNuevoExamenDiagnostico),g.eliminarPopup(g.idModalDialogHistorialFicha),g.eliminarPopup(g.idModalDialogCredencial),g.eliminarPopup(g.idModalDialogPatologias),g.eliminarPopup(g.idModalDialogComentario),g.eliminarPopup(g.idModalAlertPrerequisitos),g.eliminarPopup(g.idModalDiasActivacionPrerequisitos),g.eliminarPopup(g.idModalReprogramarPrerequisitos),g.eliminarPopup(g.idModalAlertVacunas),g.eliminarPopup(g.idModalDiasActivacionVacunas),g.eliminarPopup(g.idModalHistorialConsulta),g.eliminarPopup(g.idModalWizardPacienteVista),g.eliminarPopup(g.IdModalDialogNuevoLaboratorio),g.eliminarPopup(g.IdModalDialogDiagnosticoExamenHistoricoResultado),g.eliminarPopup(g.idModalDialogVerResultadosHistorialLab),g.eliminarPopup(g.idModalReprogramarVacunas),g.eliminarPopup(g.idModalDialogConfirmacionEntregaAdelantado),g.eliminarPopup(g.idModalConceptoEdicion)}),g.inicio=function(){g.obtenerAlertas(),r.start(),g.paginator={pages:[]},g.obtenerPacientes(),g.obtenerVacunas(),g.paciente={vacunas:[],cargos:[]},g.vacunas=[],g.vacuna={vacunaDosis:[]},g.vacunaDosis=[],g.requisitos={preRequisitos:[]},g.ficha={},g.dosis={tiempo:0,numero:0},g.obtenerExpeditos(),g.obtenerGenero(),g.obtenerTipoControl(),g.obtenerCargos(),g.examen={},g.filtroHistorialVacunas=[],g.filtroVacunas={inicio:"",fin:"",opcion:"todas"};var a=new Date;g.filtro.fechaAplicacionVacuna_texto=a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear(),r.stop(),g.dosisEdit=!1,g.fechaResultado=g.fechaATexto(new Date)},g.abrirDialogConceptoEdicion=function(a){g.tipo_edicion=a,g.clase={},g.abrirPopup(g.idModalConceptoEdicion)},g.cerrarDialogConceptoEdicion=function(){g.cerrarPopup(g.idModalConceptoEdicion)},g.agregarConceptoEdicion=function(a){a.nombre&&a.nombre_corto&&(-1==g.tipo_edicion.clases.indexOf(a)&&g.tipo_edicion.clases.push(a),g.clase={})},g.modificarConceptoEdicion=function(a){g.clase=a},g.removerConceptoEdicion=function(a){a.eliminado=!0},g.guardarConceptoEdicion=function(i){r.start(),la.update({id_tipo:i.id},i,function(a){Ma(i.nombre_corto).then(function(a){i=a,r.stop(),g.cerrarDialogConceptoEdicion(),g.mostrarMensaje("Guardado Exitosamente!")})})},g.obtenerExpeditos=function(){r.start(),Va("RRHH_EXP",g.usuario.id_empresa).then(function(a){g.expeditos=a,r.stop()})},g.obtenerCargos=function(){r.start(),Va("RRHH_CARGO",g.usuario.id_empresa).then(function(a){var i=a.clases;g.listaCargos=a,g.llenarCargos(i),r.stop()})},g.seleccionarCargos=function(a){if(0<a.length)for(var i=0;i<g.cargos.length;i++)for(var e=0;e<a.length;e++)g.cargos[i].id==a[e].id_cargo&&(g.cargos[i].ticked=!0)},g.llenarCargos=function(a){g.nuevoRH="",g.cargos=[];for(var i=0;i<a.length;i++){var e={nombre:a[i].nombre,maker:"",ticked:!1,id:a[i].id};g.cargos.push(e)}},g.imcCal=function(a){if(null!=a.talla&&null!=a.peso){if(0<a.talla&&0<a.peso){var i=a.talla/100*(a.talla/100);a.indice_masa=a.peso/i,a.indice_masa=a.indice_masa.toFixed(2)}g.ClasificacionIMC="",g.ColorIMC="",a.indice_masa<16&&(g.ClasificacionIMC="Infrapeso: Delgadez Severa"),16<=a.indice_masa&&a.indice_masa<17&&(g.ClasificacionIMC="Infrapeso: Delgadez moderada"),17<=a.indice_masa&&a.indice_masa<18.49&&(g.ClasificacionIMC="Infrapeso: Delgadez aceptable"),18.5<=a.indice_masa&&a.indice_masa<25&&(g.ClasificacionIMC="Peso Normal"),25<=a.indice_masa&&a.indice_masa<30&&(g.ClasificacionIMC="Sobrepeso"),30<=a.indice_masa&&a.indice_masa<35&&(g.ClasificacionIMC="Obeso: Tipo I"),35<=a.indice_masa&&a.indice_masa<40&&(g.ClasificacionIMC="Obeso: Tipo II"),40<=a.indice_masa&&(g.ClasificacionIMC="Obeso: Tipo III")}},g.obtenerColumnasAplicacion=function(){g.fieldViewer=ea({crear:!0,id_empresa:g.usuario.id_empresa,configuracion:{codigo:{value:"Codigo",show:!0},nombre:{value:"Nombre",show:!0},empresa:{value:"Empresa",show:!0},imagen:{value:"Imagen",show:!0},ci:{value:"CI",show:!0},extension:{value:"Extension",show:!0},grupo_sanguineo:{value:"Grupo Sang.",show:!0},campo:{value:"Campo",show:!0},cargo:{value:"Cargo",show:!0}}},g.aplicacion.aplicacion.id),g.fieldViewer.updateObject()},g.fechaATexto=function(a){return fech=new Date(a),a=fech.getDate()+"/"+(fech.getMonth()+1)+"/"+fech.getFullYear()},g.agregarDosisVacuna=function(a){r.start(),null!=a.id||null!=a.id?(indx=g.vacunaDosis.indexOf(a),a.es_dosis=null!=a.es_dosis&&null!=a.es_dosis&&a.es_dosis,a.unico=null!==a.unico&&void 0!==a.unico&&a.unico,a.numero=indx,g.vacunaDosis[indx]=a):(a.es_dosis=null!=a.es_dosis&&null!=a.es_dosis&&a.es_dosis,a.unico=null!==a.unico&&void 0!==a.unico&&a.unico,a.numero=g.vacunaDosis.length+1,g.vacunaDosis.push(a),console.log("añadiendo dosis"),console.log(a)),1<g.vacunaDosis.length&&(a.unico=!1),g.dosis={},r.stop()},g.agregarDosisEditada=function(a){1<g.vacunaDosis.length&&(a.unico=!1),g.vacunaDosis[a.index]=a,g.dosis={},g.dosisEdit=!1},g.eliminarDosis=function(a){if(void 0===a.id)g.vacunaDosis.splice(g.vacunaDosis.indexOf(a),1);else{var i=g.vacunaDosis.indexOf(a);g.vacunaDosis[i].eliminado=!0,g.vacunaDosis[i].eliminar=!0}},g.editarLaDosis=function(a){g.dosis=a,g.dosisEdit=!0},g.asignarVacunas=function(){g.paciente.eliminado?(r.start(),g.vacunas.forEach(function(i){i.asignada=null!==i.asignada&&void 0!==i.asignada&&i.asignada;var e=!1,o={};if(g.paciente.vacunas.forEach(function(a){a.id_vacuna==i.id&&(e=!0,o=a)},this),e)V.update({id:o.id,asignar:i.asignada},o,function(a){_(g.paciente).then(function(a){g.paciente.vacunas=a})},function(a){g.mostrarMensaje("Ocurrio un problema al momento de actualizar la asignación de la vacuna!")});else if(i.asignada){var a=new Date;1<i.vacunaDosis.length&&(i.vacunaDosis[1].es_dosis?a.setTime(a.getTime()+864e5*i.vacunaDosis[1].tiempo):a.setTime(a.getTime()+30*i.vacunaDosis[1].tiempo*864e5)),new V({id_paciente:g.paciente.id,id_vacuna:i.id,siguiente_aplicacion:a}).$save(function(a){_(g.paciente).then(function(a){g.paciente.vacunas=a})},function(a){g.mostrarMensaje("Ocurrio un problema al momento de asignar la vacuna!")})}},this)):g.mostrarMensaje("No se puede asignar vacuna a un paciente inactivo!"),g.cerrarPopUpVacunasConfig(),r.stop()},g.obtenerVacunas=function(){M().then(function(a){g.vacunas=a})},g.limpiarAsignacionVacunas=function(){r.start(),g.vacunas.forEach(function(a){a.asignada=!1},this),r.stop()},g.verificarAsignacionVacunas=function(){r.start(),0<g.paciente.vacunas.length&&g.paciente.vacunas.forEach(function(a){for(var i=0;i<g.vacunas.length;i++)a.id_vacuna!=g.vacunas[i].id||a.eliminado||(g.vacunas[i].asignada=!0)},this),r.stop()},g.evaluarFechaDosisVacuna=function(a){if(r.start(),g.vacuna=a,null!=g.vacuna.pacienteVacunaDosis[0])if(null==g.vacuna.alreadyProyected){if(1==g.vacuna.pacienteVacuna.vacunaDosis.length&&g.vacuna.pacienteVacuna.vacunaDosis[0].unico)return g.vacuna.pacienteVacunaDosis[0].visible=!0,g.vacuna.pacienteVacunaDosis[0].retrasada=!1,g.vacuna.alreadyProyected=!0,g.vacuna.pacienteVacunaDosis[0].fechaCorta=g.fechaATexto(new Date(g.vacuna.pacienteVacunaDosis[0].fecha_aplicacion)),void r.stop();if(1==g.vacuna.pacienteVacuna.vacunaDosis.length&&!g.vacuna.pacienteVacuna.vacunaDosis[0].unico){g.vacuna.pacienteVacunaDosis.forEach(function(a,i,e){if(0==i)a.retrasada=!1,a.visible=!0,a.fechaCorta=g.fechaATexto(new Date(a.fecha_aplicacion));else{var o=new Date(g.vacuna.pacienteVacunaDosis[i-1].fecha_aplicacion).getTime();if(g.vacuna.pacienteVacuna.vacunaDosis[0].es_dosis)var n=new Date((new Date).setTime(o+864e5*g.vacuna.pacienteVacuna.vacunaDosis[0].tiempo));else n=new Date((new Date).setTime(864e5*(o+30*g.vacuna.pacienteVacuna.vacunaDosis[0].tiempo)));n.setHours(12,0,0,0);var t=new Date(a.fecha_aplicacion);t.setHours(12,0,0,0),t.getTime()<=n.getTime()?a.retrasada=!1:a.retrasada=!0,a.visible=!0,a.fechaCorta=g.fechaATexto(new Date(a.fecha_aplicacion))}});var i={retrasada:!1,id_paciente_vacuna:g.vacuna.id_paciente,fecha_aplicacion:new Date(g.vacuna.fecha_siguiente_aplicacion),proyectada:!0,visible:!0,fechaCorta:g.fechaATexto(new Date(g.vacuna.fecha_siguiente_aplicacion)),eliminado:!1};g.vacuna.pacienteVacunaDosis.push(i),g.vacuna.alreadyProyected=!0}if(1<g.vacuna.pacienteVacuna.vacunaDosis.length){for(g.vacuna.pacienteVacunaDosis.forEach(function(a,i,e){if(0==i)a.retrasada=!1,a.visible=!0,a.fechaCorta=g.fechaATexto(new Date(a.fecha_aplicacion));else{var o=new Date(g.vacuna.pacienteVacunaDosis[i-1].fecha_aplicacion).getTime();if(g.vacuna.pacienteVacuna.vacunaDosis[0].es_dosis)var n=new Date((new Date).setTime(o+864e5*g.vacuna.pacienteVacuna.vacunaDosis[i].tiempo));else n=new Date((new Date).setTime(864e5*(o+30*g.vacuna.pacienteVacuna.vacunaDosis[i].tiempo)));n.setHours(12,0,0,0);var t=new Date(a.fecha_aplicacion);t.setHours(12,0,0,0),t.getTime()<=n.getTime()?a.retrasada=!1:a.retrasada=!0,a.visible=!0,a.fechaCorta=g.fechaATexto(new Date(a.fecha_aplicacion))}});g.vacuna.pacienteVacunaDosis.length<g.vacuna.pacienteVacuna.vacunaDosis.length;){i={retrasada:!1,id_paciente_vacuna:g.vacuna.id_paciente,fecha_aplicacion:new Date,proyectada:!0,visible:!0,fechaCorta:g.fechaATexto(new Date),eliminado:!1};g.vacuna.pacienteVacuna.vacunaDosis[g.vacuna.pacienteVacunaDosis.length].es_dosis?i.fecha_aplicacion=new Date((new Date).setTime(new Date(g.vacuna.pacienteVacunaDosis[g.vacuna.pacienteVacunaDosis.length-1].fecha_aplicacion).getTime()+864e5*g.vacuna.pacienteVacuna.vacunaDosis[g.vacuna.pacienteVacunaDosis.length].tiempo)):i.fecha_aplicacion=new Date((new Date).setTime(new Date(g.vacuna.pacienteVacunaDosis[g.vacuna.pacienteVacunaDosis.length-1].fecha_aplicacion).getTime()+30*g.vacuna.pacienteVacuna.vacunaDosis[g.vacuna.pacienteVacunaDosis.length].tiempo*864e5)),i.fechaCorta=g.fechaATexto(i.fecha_aplicacion),g.vacuna.pacienteVacunaDosis.push(i),g.vacuna.alreadyProyected=!0}return void r.stop()}r.stop()}else r.stop();else r.stop()},g.validarDatosVacuna=function(a){return!(0<g.vacunaDosis.length&&""!=a.nombre)},g.editarVacuna=function(a,i){if(r.start(),a){var o=!1;g.vacuna=i,g.vacuna.vacunaDosis=g.vacunaDosis,1<g.vacunaDosis.length&&g.vacunaDosis.forEach(function(a,i,e){a.unico&&(o=!0,a.unico=!1),i==e.length-1&&o&&g.mostrarMensaje("No se puede guardar una dosis única en un conjunto de dosis!")}),i.id||o?o||P.update({id:i.id},i,function(a){g.mostrarMensaje(a.mensaje),r.stop()},function(a){g.mostrarMensaje("Ocurrio un problema al momento de guardar!"),r.stop()}):i.$save(function(a){g.mostrarMensaje(a.mensaje),r.stop()},function(a){g.mostrarMensaje("Ocurrio un problema al momento de guardar!"),r.stop()}),g.vacunaDosis=[],g.cerrarPopUpVacunaNueva()}else g.mostrarMensaje("Complete los campos requeridos!")},g.obtenerPrerequisitos=function(){r.start(),ga().then(function(a){g.preRequisitos=a.prerequisitos,r.stop()})},g.obtenerGenero=function(){r.start(),g.generos=[],h().then(function(a){a.forEach(function(a){g.generos.push(a)},this),r.stop()})},g.obtenerPacientes=function(){r.start(),g.paginator=s(),g.paginator.column="codigo",g.paginator.direccion="asc",g.filtro={empresa:g.usuario.id_empresa,codigo:"",nombres:"",ci:"",campo:"",cargo:"",busquedaEmpresa:"",estado:"",grupo_sanguineo:""},g.paginator.callBack=g.buscarPacientes,g.paginator.getSearch("",g.filtro,null),r.stop()},g.buscarPacientes=function(){r.start(),f(g.paginator).then(function(o){if(g.paginator.setPages(o.paginas),g.dynamicPopoverCargos={templateUrl:"myPopoverTemplate.html"},0<o.pacientes.length)if(0<o.fichas.length)for(var a=0;a<o.fichas.length;a++){var n=o.fichas[a];null!=n?o.pacientes.forEach(function(a,i,e){a.eliminado=0==a.activo,a.ficha=a.id==n.id_empleado?n:a.ficha,i===e.length-1&&(g.pacientes=o.pacientes)}):a===o.fichas.length-1&&o.pacientes.forEach(function(a,i,e){a.eliminado=0==a.activo,i===e.length-1&&(g.pacientes=o.pacientes)})}else o.pacientes.forEach(function(a,i,e){a.eliminado=0==a.activo,i===e.length-1&&(g.pacientes=o.pacientes)});else g.pacientes=o.pacientes;r.stop()})},g.guardarFichaTecnica=function(a,i){a&&("Siguiente"!=$("#siguiente-f").text().trim()&&(i.fecha_elaboracion=new Date(g.convertirFecha(i.fecha_elaboracion)),q(i).then(function(a){g.cerrarPopUpIdModalFichaTecnica(),g.recargarItemsTabla(),g.mostrarMensaje(a.message)})))},g.guardarFichaTecnicaExistente=function(a,i){a?(i.fecha_elaboracion=new Date(g.convertirFecha(i.fecha_elaboracion)),q(i).then(function(a){g.cerrarPopUpIdModalFichaTecnica(),g.recargarItemsTabla(),g.mostrarMensaje(a.message)})):g.mostrarMensaje("Faltan datos!")},g.aplicarVacuna=function(a,i){if(null!=i&&(i.activo=i.eliminado,g.paciente=i),r.start(),!g.paciente.eliminado)return g.mostrarMensaje("No se puede aplicar vacuna a un paciente inactivo!"),void r.stop();var e=new Date;e.setHours(12,0,0,0);var o=null!=a.fechaAplicacionVacuna_texto?new Date(g.convertirFecha(a.fechaAplicacionVacuna_texto)):new Date;o.setHours(12,0,0,0);var n=0,t=[];if(a.pacienteVacunaDosis.forEach(function(a){void 0===a.proyectada&&t.push(new Date(a.fecha_aplicacion))}),0==t.length)a.fecha_ultima_aplicacion=o,1<a.pacienteVacuna.vacunaDosis.length?a.pacienteVacuna.vacunaDosis[1].es_dosis?a.fecha_siguiente_aplicacion=new Date((new Date).setTime(o.getTime()+864e5*a.pacienteVacuna.vacunaDosis[1].tiempo)):a.fecha_siguiente_aplicacion=new Date((new Date).setTime(o.getTime()+30*a.pacienteVacuna.vacunaDosis[1].tiempo*864e5)):a.pacienteVacuna.vacunaDosis[0].es_dosis?a.fecha_siguiente_aplicacion=new Date((new Date).setTime(o.getTime()+864e5*a.pacienteVacuna.vacunaDosis[n].tiempo)):a.fecha_siguiente_aplicacion=new Date((new Date).setTime(o.getTime()+30*a.pacienteVacuna.vacunaDosis[n].tiempo*864e5)),a.fecha_siguiente_aplicacion_texto=g.fechaATexto(a.fecha_siguiente_aplicacion);else{if(o<new Date(Math.max.apply(null,t)))return g.mostrarMensaje("No se puede aplicar en una fecha anterior a la ultima aplicación!"),void r.stop();if(1<a.pacienteVacuna.vacunaDosis.length){if(n=a.pacienteVacunaDosis.length,null==a.pacienteVacuna.vacunaDosis[n])return void g.mostrarMensaje("No se puede aplicar, excede el número de dosis aplicables!");a.fecha_ultima_aplicacion=o,a.pacienteVacuna.vacunaDosis[n].es_dosis?a.fecha_siguiente_aplicacion=new Date((new Date).setTime(o.getTime()+864e5*a.pacienteVacuna.vacunaDosis[n].tiempo)):a.fecha_siguiente_aplicacion=new Date((new Date).setTime(o.getTime()+30*a.pacienteVacuna.vacunaDosis[n].tiempo*864e5)),a.fecha_siguiente_aplicacion_texto=g.fechaATexto(a.fecha_siguiente_aplicacion)}else a.fecha_ultima_aplicacion=o,a.pacienteVacuna.vacunaDosis[0].es_dosis?a.fecha_siguiente_aplicacion=new Date((new Date).setTime(o.getTime()+864e5*a.pacienteVacuna.vacunaDosis[0].tiempo)):a.fecha_siguiente_aplicacion=new Date((new Date).setTime(o.getTime()+30*a.pacienteVacuna.vacunaDosis[0].tiempo*864e5)),a.fecha_siguiente_aplicacion_texto=g.fechaATexto(a.fecha_siguiente_aplicacion)}A.update({id:a.id},a,function(a){_(g.paciente).then(function(a){g.paciente.vacunas=a,g.inicializarFechaAplicacionVacuna(),r.stop()}),g.mostrarMensaje(a.mensaje)},function(a){g.mostrarMensaje("Se produjo un error"),r.stop()}),g.fechaATexto(e)!=g.fechaATexto(o)||(g.mostrarMensaje("La fecha de aplicación y la fecha actual son diferentes, vacuna aplicada de todas formas!"),r.stop()),g.obtenerAlertas()},g.inicializarFechaAplicacionVacuna=function(){g.paciente.vacunas.forEach(function(a,i,e){var o=new Date;a.fechaAplicacionVacuna_texto=o.getDate()+"/"+(o.getMonth()+1)+"/"+o.getFullYear(),i===e.length-1&&g.obtenerAlertas()})},g.button_clicked=!1,g.disableImput=function(a){aplicarDatePickers();var i=0;a.pacienteVacunaDosis.forEach(function(a){a.proyectada||(i+=1)},this),a.button_clicked?(1!=a.pacienteVacuna.vacunaDosis.length||a.pacienteVacuna.vacunaDosis[0].unico?i<a.pacienteVacuna.vacunaDosis.length?g.aplicarVacuna(a):g.mostrarMensaje("No se puede aplicar la vacuna, excede la cantidad de dosis"):g.aplicarVacuna(a),a.button_clicked=!1):a.button_clicked=!0},g.dosisText="Mes(es)",g.textoDosis=function(a){g.dosisText=a?"Día(s)":"Mes(es)"},g.imprimirCredencial=function(){html2canvas(document.getElementsByClassName("PrintCredencial"),{allowTaint:!0,onrendered:function(a){var i=window.open("","Credencial","width=1100,height=1000");i.document.body.appendChild(a),i.focus(),i.print()}})},g.DatosSV=[{type:"line",showInLegend:!0,lineThickness:2,name:"PrecionS",color:"#F08080",dataPoints:[]},{type:"line",showInLegend:!0,lineThickness:2,name:"Pulso",color:"#EC11B0",dataPoints:[]},{type:"line",showInLegend:!0,lineThickness:2,name:"Talla",color:"#11EC2B",dataPoints:[]},{type:"line",showInLegend:!0,lineThickness:2,name:"Temperatura",color:"#48B5DF",dataPoints:[]},{type:"line",showInLegend:!0,lineThickness:2,name:"Frecuencia Respiratoria",color:"#DF488A",dataPoints:[]},{type:"line",showInLegend:!0,lineThickness:2,name:"Frecuencia cardiaca",color:"#CCDF48",dataPoints:[]},{type:"line",showInLegend:!0,lineThickness:2,name:"indice de masa corporal",color:"#48DFD3",dataPoints:[]}],g.selection=[],g.chart=new CanvasJS.Chart("chartContainer",{title:{text:"GRAFICA - SIGNOS VITALES",fontSize:22},legend:{horizontalAlign:"right",verticalAlign:"center",fontSize:14},animationEnabled:!0,exportEnabled:!0,width:1100,axisX:{gridColor:"Silver",tickColor:"silver",valueFormatString:"DD/MM/YY",titleFontSize:8},theme:"theme1",axisY:{gridColor:"Silver",tickColor:"silver"},data:g.selection}),g.chart.render(),g.toggleSelection=function(a){var i=g.selection.map(function(a){return a.name}).indexOf(a.name);-1<i?g.selection.splice(i,1):g.selection.push(a),g.chart.render(),g.chart.destroy()},g.checkAll=function(i){g.selection.length=0,angular.forEach(g.DatosSV,function(a){a.selected=i.target.checked,a.selected?g.selection.push(a):g.selection.splice(0,1),g.chart.render(),g.chart.destroy()})},g.abrirIdModalDialogLaboratorioExamenesNuevoResultado=function(a,i){g.examen={},a&&(g.examen=a),g.examen.soloVista=!!i,g.abrirPopup(g.IdModalDialogLaboratorioExamenesNuevoResultado),g.fechaResultado=g.fechaATexto(new Date)},g.abrirIdModalDialogLaboratorioExamenesHistoricoResultados=function(){filtro={inicio:0,fin:0},g.ObtenerHistorialLaboratorioExamenes(filtro),g.abrirPopup(g.IdModalDialogLaboratorioExamenHistoricoResultado)},g.abrirIdModalDialogDiagnosticoExamenesHistoricoResultados=function(){filtro={inicio:0,fin:0},g.ObtenerHistorialDiagnosticoExamenes(filtro),g.abrirPopup(g.IdModalDialogDiagnosticoExamenHistoricoResultado)},g.abrirIdModalDialogNuevoLaboratorio=function(a,i){g.laboratorio={},a&&(g.laboratorio=a),g.laboratorio.soloVista=!!i,g.abrirPopup(g.IdModalDialogNuevoLaboratorio)},g.abrirIdModalDialogLaboratorioExamenesHistorico=function(){g.abrirPopup(g.IdModalDialogLaboratorioExamenHistoricoPreview)},g.abrirIdModalDialogLaboratorioExamenes=function(a){g.laboratorio=a,g.ObtenerMedicoLaboratorioExamenes(a),g.abrirPopup(g.IdModalDialogLaboratorioExamenes)},g.abrirIdModalFichaTecnica=function(a){g.paciente=a,g.buscarfichaPaciente(a),g.abrirPopup(g.idModalFichaTecnica)},g.buscarfichaPaciente=function(a){r.start(),C(a.id).then(function(a){if(a.ficha){g.ficha=a.ficha;var i=new Date,e=new Date(g.ficha.paciente.persona.fecha_nacimiento),o=new Date(a.ficha.fecha);g.ficha.fecha_elaboracion=o.getDate()+"/"+(o.getMonth()+1)+"/"+o.getFullYear();var n=g.diferenciaEntreDiasEnDias(e,i);g.ficha.edad=Math.trunc(n/365),g.ficha.edad,g.mostarGuardarFicha=!0}else{g.mostarGuardarFicha=!1,g.ficha={paciente:a.paciente,pacienteReferencia:{}};i=new Date,e=new Date(g.ficha.paciente.persona.fecha_nacimiento),n=g.diferenciaEntreDiasEnDias(e,i);g.ficha.edad=Math.trunc(n/365)}r.stop()})},g.obtenerTipoControl=function(){r.start(),I().then(function(a){g.tiposControl=a,r.stop()})},g.diferenciaEntreDiasEnDias=function(a,i){var e=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),o=Date.UTC(i.getFullYear(),i.getMonth(),i.getDate());return Math.floor((o-e)/864e5)},g.obtenerDatosPrerequisito=function(a,i){r.start(),null!=i.inicio&&0!=i.inicio&&""!=i.inicio?g.filtro.inicio=i.inicio instanceof Date?i.inicio:new Date(g.convertirFecha(i.inicio)):g.filtro.inicio=0,null!=i.fin&&0!=i.fin&&""!=i.fin?g.filtro.fin=i.fin instanceof Date?i.fin:new Date(g.convertirFecha(i.fin)):g.filtro.fin=0,L(a.id,g.filtro).then(function(a){g.prerequisitosPaciente=a.Prerequisitos,g.prerequisitosPaciente.forEach(function(a){null!=a.fecha_entrega&&(a.entregado=!0)}),console.log(g.prerequisitosPaciente),g.filtro.inicio=g.filtro.inicio instanceof Date?g.filtro.inicio.getDate()+"/"+(g.filtro.inicio.getMonth()+1)+"/"+g.filtro.inicio.getFullYear():"",g.filtro.fin=g.filtro.fin instanceof Date?g.filtro.fin.getDate()+"/"+(g.filtro.fin.getMonth()+1)+"/"+g.filtro.fin.getFullYear():"",r.stop()},function(a){g.mostrarMensaje("Se produjo un error al obtener datos de prerequisitos"),r.stop()})},g.abrirDialogVerResultadosLab=function(a){g.Hostorialexamenes=a.laboratorioResultados,g.abrirPopup(g.idModalDialogVerResultadosHistorialLab)},g.cerrarDialogVerResultadosLab=function(a){g.cerrarPopup(g.idModalDialogVerResultadosHistorialLab)},g.showPopover=!1,g.popover={title:"Title",message:"Message"},g.abrirIdModalDialogPreRequisitos=function(a){g.paciente=a,g.verificarAsignacionPrerequisitos(),g.abrirPopup(g.IdModalDialogPreRequisitos)},g.abrirDialogHistorico=function(a){g.abrirPopup(g.idModalDialogHistorico)},g.abrirDialogVacunaEditar=function(a){g.vacuna=a,g.vacunaDosis=a.vacunaDosis,g.dosis={},g.dosisEdit=!1,g.abrirPopup(g.idModalDialogVacunaEdicion)},g.abriridModalDialogFechaEntrega=function(){g.abrirPopup(g.idModalDialogFechaEntrega)},g.abrirIdModalGraficoSV=function(a){g.DatosSV.forEach(function(a){a.dataPoints=[]}),g.fechasLabel=[];g.paciente=a;w(g.paciente.id,{inicio:0,fin:0}).then(function(a){for(var i=0;i<a.consultas.length;i++){var e=a.consultas[i],o=new Date(e.fecha),n=e.presion.split("/"),t=o.getDate()+"/"+o.getMonth()+"/"+o.getFullYear();g.fechasLabel.push(t);var r={x:new Date(o.getFullYear(),o.getMonth(),o.getDate()),y:parseInt(n[0])},c={x:new Date(o.getFullYear(),o.getMonth(),o.getDate()),y:parseInt(e.pulso)},s={x:new Date(o.getFullYear(),o.getMonth(),o.getDate()),y:parseInt(e.talla)},l={x:new Date(o.getFullYear(),o.getMonth(),o.getDate()),y:parseInt(e.peso)},u={x:new Date(o.getFullYear(),o.getMonth(),o.getDate()),y:parseInt(e.temperatura)},d={x:new Date(o.getFullYear(),o.getMonth(),o.getDate()),y:parseInt(e.frecuencia_cardiaca)},f={x:new Date(o.getFullYear(),o.getMonth(),o.getDate()),y:parseInt(e.frecuencia_respiratoria)},p={x:new Date(o.getFullYear(),o.getMonth(),o.getDate()),y:parseInt(e.indice_masa_corporal)};g.DatosSV.forEach(function(a){"PrecionS"==a.name&&a.dataPoints.push(r),"Talla"==a.name&&a.dataPoints.push(s),"Pulso"==a.name&&a.dataPoints.push(c),"Peso"==a.name&&a.dataPoints.push(l),"Temperatura"==a.name&&a.dataPoints.push(u),"Frecuencia Respiratoria"==a.name&&a.dataPoints.push(f),"Frecuencia cardiaca"==a.name&&a.dataPoints.push(d),"indice de masa corporal"==a.name&&a.dataPoints.push(p)},this),20}}),g.abrirPopup(g.IdModalDialogGraficoSV)},g.cerrarIdModalGraficoSV=function(){g.cerrarPopup(g.IdModalDialogGraficoSV)},g.abrirDialogNuevoExamen=function(){g.abrirPopup(g.IdModalDialogLaboratorioExamen)},g.abrirIdModalDialogLaboratorio=function(a){g.paciente=a,g.ObtenerMedicoLaboratorios(a),g.abrirPopup(g.IdModalDialogLaboratorio)},g.abriridModalDialogVacunaNueva=function(){g.vacuna=new P({}),g.dosis={},g.dosisEdit=!1,g.abrirPopup(g.idModalDialogVacunaEdicion)},g.abrirDialogVacunasConfig=function(){g.limpiarAsignacionVacunas(),g.verificarAsignacionVacunas(),g.obtenerAlertas(),g.abrirPopup(g.idModalDialogVacunasConfig)},g.abrirDialogVacunas=function(a){g.paciente=a,g.paciente.vacunas=[],g.filtroHistorialVacunas=[],_(g.paciente).then(function(a){g.paciente.vacunas=a,g.paciente.vacunas.forEach(function(a){var i=new Date;a.fechaAplicacionVacuna_texto=i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear(),a.button_clicked=!1},this)}),g.limpiarAsignacionVacunas(),g.verificarAsignacionVacunas(),g.obtenerAlertas(),g.abrirPopup(g.idModalDialogVacunas)},g.guardarEntregaPrerequisito=function(a){r.start(),null==a.fecha_entrega_texto||""==a.fecha_entrega_texto?g.mostrarMensaje("Ingrese la fecha de entrega."):(a.fecha_entrega=new Date(g.convertirFecha(a.fecha_entrega_texto)),a.asignado=!0,ma.save(a,function(i){L(g.paciente.id,{inicio:0,fin:0}).then(function(a){g.prerequisitosPaciente=a.Prerequisitos,g.mostrarMensaje(i.mensaje),g.prerequisitosPaciente.forEach(function(a){null!=a.fecha_entrega&&(a.entregado=!0)}),g.cerrarPopUpEntregaPreRequisito(),r.stop()})},function(a){g.mostrarMensaje("Ocurrio un problema al guardar la fecha de entrega  de el prerequisito")}))},g.verificarFechaEntregaPrerequisito=function(a,i){g.preRequisito=a,g.preRequisito.fecha_entrega_texto=g.fechaATexto(new Date),g.paciente=void 0===i?a.pacientePrerequisito:i,console.log(g.preRequisito);var e=new Date(g.preRequisito.fecha_vencimiento).getTime(),o=(new Date).getTime();0<=Math.floor((o-e)/864e5)?g.abrirDialogEntregaPreRequisito(g.preRequisito,g.paciente):g.abrirPopup(g.idModalDialogConfirmacionEntregaAdelantado),g.obtenerAlertas()},g.cerrarConfirmacionEntragaAdelantadaPrerequisito=function(){g.cerrarPopup(g.idModalDialogConfirmacionEntregaAdelantado)},g.abrirDialogEntregaPreRequisito=function(a,i){g.cerrarConfirmacionEntragaAdelantadaPrerequisito(),g.preRequisito=a,g.preRequisito.fecha_entrega_texto=g.fechaATexto(new Date),g.paciente=i,g.abrirPopup(g.IdEntregaPrerequisito)},g.cerrarPopUpEntregaPreRequisito=function(){g.obtenerAlertas(),g.cerrarPopup(g.IdEntregaPrerequisito)},g.abrirDialogPacienteNuevo=function(){g.paciente=new u({persona:{imagen:"img/icon-user-default.png"},id_empresa:g.usuario.id_empresa}),g.abrirPopup(g.idModalDialogPacienteNuevo)},g.cerrarPopupPacienteNuevo=function(){g.cerrarPopup(g.idModalDialogPacienteNuevo)},g.abrirDialogPrerequisitoNuevo=function(){g.NuevoP=new D({puede_modificar_rrhh:!1}),g.abrirPopup(g.idModalDialogPrerequisitoNuevo)},g.abrirDialogPrerequisitoEditar=function(a){g.NuevoP=new D({id:a.id,nombre:a.nombre,observacion:a.observacion,vencimiento_mes:a.vencimiento_mes,dias_activacion:a.dias_activacion,puede_modificar_rrhh:a.puede_modificar_rrhh}),g.abrirPopup(g.idModalDialogPrerequisitoNuevo)},g.cerrarPopupPrerequisitoNuevo=function(){g.obtenerAlertas(),g.cerrarPopup(g.idModalDialogPrerequisitoNuevo)},g.validarCodigoCuentaEmpleado=function(a){""!=a&&_a(function(){g.validar=new ba,g.validar.codigo=a,g.validar.$save(function(a){g.data=a})},1500)},g.abrirDialogHistoricoPreRequisito=function(a,i){var e=0,o=0;g.preRequisito=a,g.paciente=i,va({id_pre:g.preRequisito.preRequisito.id,id_pac:g.paciente.id,inicio:e,fin:o}).then(function(a){g.historialPrerequisitosPaciente=a.historial,r.stop(),g.filtro.inicio=g.filtro.inicio instanceof Date?g.filtro.inicio.getDate()+"/"+(g.filtro.inicio.getMonth()+1)+"/"+g.filtro.inicio.getFullYear():"",g.filtro.fin=g.filtro.fin instanceof Date?g.filtro.fin.getDate()+"/"+(g.filtro.fin.getMonth()+1)+"/"+g.filtro.fin.getFullYear():""}),g.abrirPopup(g.idModalHistorialPrerequisito)},g.filtrarHistorialPrerequisito=function(i){if(null!=i){var a=null===i.inicio||""===i.inicio||void 0===i.inicio?0:new Date(i.inicio),e=null===i.fin||""===i.fin||void 0===i.fin?0:new Date(i.fin),o=null===i.opcion||void 0===i.opcion?0:i.opcion;i={inicio:a,fin:e,opcion:o}}else i={inicio:0,fin:0};va({id_pre:g.preRequisito.preRequisito.id,id_pac:g.paciente.id,inicio:i.inicio,fin:i.fin}).then(function(a){g.historialPrerequisitosPaciente=a.historial,r.stop(),i.inicio=g.filtro.inicio instanceof Date?g.filtro.inicio.getDate()+"/"+(g.filtro.inicio.getMonth()+1)+"/"+g.filtro.inicio.getFullYear():"",i.fin=g.filtro.fin instanceof Date?g.filtro.fin.getDate()+"/"+(g.filtro.fin.getMonth()+1)+"/"+g.filtro.fin.getFullYear():""})},g.cerrarDialogHistoricoPreRequisito=function(){g.cerrarPopup(g.idModalHistorialPrerequisito)},g.actualizarPrerequisito=function(i){r.start(),console.log(i),T(i).then(function(a){i instanceof Array&&g.cerrarPopUpPreRequisitos(),r.stop(),g.mostrarMensaje(a.message)})},g.verificarAsignacionPrerequisitos=function(){r.start(),ga().then(function(a){g.preRequisitos=a.prerequisitos,filtro={inicio:0,fin:0},L(g.paciente.id,filtro).then(function(a){g.prerequisitosPaciente=a.Prerequisitos,g.preRequisitos.forEach(function(i,a,e){g.prerequisitosPaciente.forEach(function(a){a.fecha_vencimiento=g.calcularFechaVencimientoRequisito(a),i.id==a.id_prerequisito&&(i.asignado=!0),null!=a.fecha_entrega&&(a.entregado=!0)}),0==g.prerequisitosPaciente.length&&(i.asignado=!1),a===e.length-1&&r.stop()}),0==g.preRequisitos.length&&r.stop()})})},g.asignarPrerequisito=function(a,i){r.start(),a.pacientePrerequisito={id:i.id},a.preRequisito={id:a.id},a.fecha_inicio=new Date,a.fecha_inicio_texto=g.fechaATexto(a.fecha_inicio),a.fecha_vencimiento=g.calcularFechaVencimientoRequisito(a),a.paraAsignar=!0,ma.save(a,function(a){g.verificarAsignacionPrerequisitos(),g.mostrarMensaje(a.mensaje),r.stop()},function(a){g.mostrarMensaje("Ocurrio un problema al asignar el prerequisito"),r.stop()})},g.diasVencidos=function(a){var i=(new Date).getTime()-a.getTime();return Math.floor(i/864e5)},g.calcularFechaVencimientoRequisito=function(a){var i=void 0===a.vencimiento_mes?a.preRequisito.vencimiento_mes:a.vencimiento_mes,e=(new Date,new Date);if(void 0===a.fecha_inicio_texto)var o=g.fechaATexto(a.fecha_inicio);var n=void 0===a.fecha_inicio_texto?o.split("/"):a.fecha_inicio_texto.split("/"),t=parseInt(n[0]),r=parseInt(n[1]),c=parseInt(n[2]);return e.setFullYear(c,r-1,t),new Date(e.setTime(e.getTime()+30*i*864e5))},g.actualizarPreRequisitoPaciente=function(a){r.start();var i=a;i.fecha_vencimiento=new Date(g.convertirFecha(i.fecha_vencimiento_texto)),i.fecha_inicio=new Date,i.fecha_entrega=null,i.asignado=!0,ma.save(i,function(a){g.mostrarMensaje(a.mensaje),g.cerrarDialogEditarPreRequisito(),g.verificarAsignacionPrerequisitos(),r.stop()},function(a){g.mostrarMensaje("Ocurrio un problema al asignar el prerequisito"),g.cerrarDialogEditarPreRequisito(),r.stop()})},g.saveFormPrerequisito=function(a){(r.start(),null!=a.nombre&&null!=a.vencimiento_mes)?Aa(a).then(function(a){g.mostrarMensaje(a.mensaje),g.cerrarPopupPrerequisitoNuevo(),r.stop(),g.verificarAsignacionPrerequisitos()}).catch(function(a){r.stop();var i=void 0!==a.stack&&null!==a.stack?a.stack:void 0!==a.message&&null!==a.message?a.message:"Se perdió la conexión.";g.mostrarMensaje(i)}):(g.mostrarMensaje("Los campos Prerequisito Nombre y vencimiento mes son requeridos."),r.stop())},g.finVerPaciente=function(){"Siguiente"!=$("#siguiente-v").text().trim()&&g.cerrarPopPupVista()},g.sinFuncionalidad=function(a){g.mostrarMensaje("Sin funcionalidad")},g.abrirDialogEditarPreRequisito=function(a){g.preRequisito=a,g.preRequisito.fecha_vencimiento_texto=g.fechaATexto(new Date),g.abrirPopup(g.idModalEditarPrerequisito)},g.cerrarDialogEditarPreRequisito=function(){g.cerrarPopup(g.idModalEditarPrerequisito)},g.verPaciente=function(a){promesaPaciente=aa(a.id),promesaPaciente.then(function(a){g.paciente=a,g.paciente.fecha_nacimiento_texto=g.fechaATexto(g.paciente.persona.fecha_nacimiento)}),g.abrirPopup(g.idModalWizardPacienteVista)},g.cerrarPopPupVista=function(){g.cerrarPopup(g.idModalWizardPacienteVista)},g.modificarPaciente=function(a){promesaPaciente=aa(a.id),promesaPaciente.then(function(a){console.log(a),g.paciente=a,g.paciente.fecha_nacimiento_texto=g.fechaATexto(g.paciente.persona.fecha_nacimiento),g.paciente.persona.imagen=null==a.persona.imagen?"img/icon-user-default.png":a.persona.imagen,console.log(g.paciente.fecha_nacimiento_texto)}),console.log(g.paciente),g.abrirPopup(g.idModalDialogPacienteNuevo)},g.mostrarConfirmacionEliminacion=function(a){a.persona=null==a.persona?{imagen:null==a.imagen?"img/icon-user-default.png":a.imagen}:a.persona.imagen,a.eliminar=!0,g.paciente=a,g.abrirPopup(g.idModalEliminarPaciente)},g.cerrarConfirmacionEliminacion=function(){g.cerrarPopup(g.idModalEliminarPaciente)},g.eliminarPaciente=function(a){r.start(),g.paciente.eliminado=0==a.eliminado,u.update({id_paciente:g.paciente.id},g.paciente,function(a){r.stop(),g.cerrarConfirmacionEliminacion(),g.obtenerPacientes(),g.mostrarMensaje("Eliminado Exitosamente!")},function(a){r.stop(),g.cerrarConfirmacionEliminacion(),g.obtenerPacientes(),g.mostrarMensaje("Ocurrio un problema al eliminar el paciente!"),g.recargarItemsTabla()})},g.cortarFecha=function(a){var i=a.split(" "),e=i[1].split(":"),o=i[0].split("/"),n=parseInt(o[0]),t=parseInt(o[1]),r=parseInt(o[2]),c=new Date,s="AM"==i[2]?parseInt(e[0]):parseInt(e[0])<12?parseInt(e[0])+12:parseInt(e[0]);return c.setFullYear(r,t-1,n),c.setHours(s,e[1]),c},g.guardarConsulta=function(a,i){if("Siguiente"!=$("#siguiente-c").text().trim()&&a.$valid){i.fecha.split(" ");i.fecha=(i.fecha,Date,g.cortarFecha(i.fecha)),i.presion=i.presionAlta+"/"+i.presionBaja,x(i).then(function(a){g.cerrarPopUpConsulta(),g.recargarItemsTabla(),g.mostrarMensaje(a.message)})}},g.guardarDatosConsulta=function(a,i){if(a.$valid){i.fecha.split(" ");i.fecha=(i.fecha,Date,g.cortarFecha(i.fecha)),i.presion=i.presionAlta+"/"+i.presionBaja,x(i).then(function(a){g.cerrarPopUpConsulta(),g.recargarItemsTabla(),g.mostrarMensaje(a.message)})}},g.listarConsultasPaciente=function(a){null!=a.inicio&&(0!=a.inicio||""!=a.inicio)?g.filtro.inicio=a.inicio instanceof Date?a.inicio:new Date(g.convertirFecha(a.inicio)):g.filtro.inicio=0,null!=a.fin&&(0!=a.fin||""!=a.fin)?g.filtro.fin=a.fin instanceof Date?a.fin:new Date(g.convertirFecha(a.fin)):g.filtro.fin=0,w(g.paciente.id,g.filtro).then(function(a){g.listaConsultas=a.consultas,g.filtro.inicio=g.filtro.inicio instanceof Date?g.filtro.inicio.getDate()+"/"+(g.filtro.inicio.getMonth()+1)+"/"+g.filtro.inicio.getFullYear():"",g.filtro.fin=g.filtro.fin instanceof Date?g.filtro.fin.getDate()+"/"+(g.filtro.fin.getMonth()+1)+"/"+g.filtro.fin.getFullYear():""})},g.changeActivo=function(a){oa.update({id_paciente:a.id},a,function(a){g.mostrarMensaje(a.mensaje)})},g.saveForm=function(a){(g.paciente=a).imagen;"Siguiente"!=$("#siguiente").text().trim()&&(r.start(),a.id?(a.persona.fecha_nacimiento=new Date(g.convertirFecha(a.fecha_nacimiento_texto)),u.update({id_paciente:a.id},a,function(a){r.stop(),g.cerrarPopupPacienteNuevo(),g.obtenerPacientes(),g.mostrarMensaje("Actualizado Exitosamente!"),g.recargarItemsTabla()})):(a.persona.fecha_nacimiento=new Date(g.convertirFecha(a.fecha_nacimiento_texto)),a.$save({id_paciente:0},function(a){r.stop(),g.cerrarPopupPacienteNuevo(),g.obtenerPacientes(),g.mostrarMensaje(a.message),g.recargarItemsTabla()},function(a){r.stop(),g.cerrarPopupPacienteNuevo(),g.obtenerPacientes(),g.mostrarMensaje("Ocurrio un problema al momento de guardar!"),g.recargarItemsTabla()})))},g.saveComment=function(a){ia.update({id_paciente:a.id},a,function(a){g.mostrarMensaje("Comentario actualizado Exitosamente!")},function(a){g.mostrarMensaje("Hubo un problema al guardar su comentario.")}),r.stop(),g.cerrarDialogDialogComentario()},g.filtrarHistorialVacunas=function(a){var e=""===a.inicio||void 0===a.inicio?0:new Date(a.inicio),o=""===a.fin||void 0===a.fin?0:new Date(a.fin),n=""===a.opcion||void 0===a.opcion?0:a.opcion;0!=e&&0!=o?g.filtroHistorialVacunas.forEach(function(a){a.pacienteVacunaDosis.forEach(function(a){var i=new Date(a.fecha_aplicacion);e<=i&&i<=o?(a.visible=!0,0!=n&&("enfec"==n&&(a.visible=null!=a.retrasada&&!(a.retrasada&&!a.proyectada)),"proye"==n&&(a.visible=null!=a.proyectada&&null!=a.proyectada&&!!a.proyectada),"retra"==n&&(a.visible=null!=a.retrasada&&!(!a.retrasada||a.proyectada)),"todas"==n&&(a.visible=!0))):a.visible=!1})}):g.filtroHistorialVacunas.forEach(function(a){a.pacienteVacunaDosis.forEach(function(a){0!=n?g.filtroHistorialVacunas.forEach(function(a){a.pacienteVacunaDosis.forEach(function(a){"enfec"==n&&(a.visible=null!=a.retrasada&&!(a.retrasada&&!a.proyectada)),"proye"==n&&(a.visible=null!=a.proyectada&&null!=a.proyectada&&!!a.proyectada),"retra"==n&&(a.visible=null!=a.retrasada&&!(!a.retrasada||a.proyectada)),"todas"==n&&(a.visible=!0)})}):a.visible=!0})}),0!=e&&0==o?g.filtroHistorialVacunas.forEach(function(a){a.pacienteVacunaDosis.forEach(function(a){var i=new Date(a.fecha_aplicacion);e<=i?(a.visible=!0,0!=n&&("enfec"==n&&(a.visible=null!=a.retrasada&&!(a.retrasada&&!a.proyectada)),"proye"==n&&(a.visible=null!=a.proyectada&&null!=a.proyectada&&!!a.proyectada),"retra"==n&&(a.visible=null!=a.retrasada&&!(!a.retrasada||a.proyectada)),"todas"==n&&(a.visible=!0))):a.visible=!1})}):0==e&&0!=o&&g.filtroHistorialVacunas.forEach(function(a){a.pacienteVacunaDosis.forEach(function(a){new Date(a.fecha_aplicacion)<=o?(a.visible=!0,0!=n&&("enfec"==n&&(a.visible=null!=a.retrasada&&!(a.retrasada&&!a.proyectada)),"proye"==n&&(a.visible=null!=a.proyectada&&null!=a.proyectada&&!!a.proyectada),"retra"==n&&(a.visible=null!=a.retrasada&&!(!a.retrasada||a.proyectada)),"todas"==n&&(a.visible=!0))):a.visible=!1})})},g.limpiarVisibilidadDosis=function(){g.filtroHistorialVacunas.forEach(function(a){a.pacienteVacunaDosis.forEach(function(a){a.visible=!0})})},g.abrirDialogHistorialVacuna=function(a){var i=g.paciente.vacunas.indexOf(a);g.vacuna=g.paciente.vacunas[i],g.evaluarFechaDosisVacuna(g.vacuna),g.filtroHistorialVacunas=[],g.filtroHistorialVacunas.push(g.vacuna),g.limpiarVisibilidadDosis(),g.abrirPopup(g.idModalDialogHistorialVacuna),g.filtroHistorialVacunas.forEach(function(a){a.pacienteVacunaDosis.forEach(function(a){a.visible=!0})})},g.cerrarDialogHistorialVacuna=function(){g.filtroVacunas={inicio:"",fin:"",opcion:"todas"},g.limpiarVisibilidadDosis(),g.cerrarPopup(g.idModalDialogHistorialVacuna)},g.abrirDialogHistorialConsulta=function(){g.listarConsultasPaciente({inicio:0,fin:0}),g.dynamicPopoverCargos={templateUrl:"consultaPopoverTemplate.html"},g.abrirPopup(g.idModalHistorialConsulta)},g.cerrarDialogHistorialConsulta=function(){g.cerrarPopup(g.idModalHistorialConsulta)},g.abrirDialogHistorialVacunaGeneral=function(){g.paciente.vacunas.forEach(function(a,i,e){g.evaluarFechaDosisVacuna(a),i===e.length-1&&(g.filtroHistorialVacunas=g.paciente.vacunas,g.limpiarVisibilidadDosis())},this),g.abrirPopup(g.idModalDialogHistorialVacunaGeneral)},g.cerrarDialogHistorialVacunaGeneral=function(){g.filtroVacunas={inicio:"",fin:"",opcion:"todas"},g.limpiarVisibilidadDosis(),g.filtroHistorialVacunas=[],g.cerrarPopup(g.idModalDialogHistorialVacunaGeneral)},g.abrirDialogDiagnosticos=function(a){g.paciente=a,g.ObtenerMedicoDiagnostico(a),g.abrirPopup(g.idModalDialogDiagnosticos)},g.cerrarDialogDiagnosticos=function(){g.cerrarPopup(g.idModalDialogDiagnosticos)},g.abrirDialogDiagnosticoNuevo=function(a,i){g.diagnostico={},a&&(g.diagnostico=a),g.diagnostico.soloVista=!!i,g.abrirPopup(g.idModalDialogDiagnosticoNuevo)},g.cerrarDialogDiagnosticoNuevo=function(){g.cerrarPopup(g.idModalDialogDiagnosticoNuevo)},g.abrirDialogExamenesDiagnostico=function(a){g.diagnostico=a,g.ObtenerMedicoDiagnosticoExamenes(a),g.abrirPopup(g.idModalDialogExamenesDiagnostico)},g.cerrarDialogExamenesDiagnostico=function(){g.cerrarPopup(g.idModalDialogExamenesDiagnostico)},g.abrirDialogNuevoExamenDiagnostico=function(a,i){g.examen={},a&&(g.examen=a),g.examen.soloVista=!!i,g.abrirPopup(g.idModalDialogNuevoExamenDiagnostico)},g.cerrarDialogNuevoExamenDiagnostico=function(){g.cerrarPopup(g.idModalDialogNuevoExamenDiagnostico)},g.abrirDialogHistorialFicha=function(a){g.ObtenerHistorialFichaMedica({inicio:0,fin:0,tipo_control:0}),g.abrirPopup(g.idModalDialogHistorialFicha)},g.cerrarDialogHistorialFicha=function(){g.cerrarPopup(g.idModalDialogHistorialFicha)},g.abrirDialogDialogCredencial=function(a){g.paciente=a,C(a.id).then(function(a){a.ficha?(g.ficha=a.ficha,g.ficha.enfermedad_cardilogia||(g.ficha.enfermedad_cardilogia2=!0),g.ficha.enfermedad_hipertension||(g.ficha.enfermedad_hipertension2=!0),g.ficha.enfermedad_lumbalgia||(g.ficha.enfermedad_lumbalgia2=!0),g.ficha.enfermedad_diabetes||(g.ficha.enfermedad_diabetes2=!0),g.ficha.enfermedad_epilepsia||(g.ficha.enfermedad_epilepsia2=!0),g.ficha.enfermedad_chagas||(g.ficha.enfermedad_chagas2=!0),g.ficha.enfermedad_hepatitis||(g.ficha.enfermedad_hepatitis2=!0),""==!g.ficha.enfermedad_otros?g.ficha.enfermedad_otros2=!0:g.ficha.enfermedad_otros3=!0,g.ficha.alergia_otros||g.ficha.alergia_conservas||g.ficha.alergia_alimentos||g.ficha.alergia_humo_cigarrillo||g.ficha.alergia_polvo||g.ficha.alergia_quimico||g.ficha.alergia_algun_material||g.ficha.alergia_medicamento||g.ficha.alergia_plantas?g.ficha.alergia=!0:g.ficha.alergia2=!0,g.abrirPopup(g.idModalDialogCredencial)):g.mostrarMensaje("primero debe crear una ficha medica del paciente para poder ver el credencial")})},g.cerrarDialogDialogCredencial=function(){g.cerrarPopup(g.idModalDialogCredencial)},g.abrirDialogDialogPatologias=function(a){g.paciente=a,C(a.id).then(function(a){a.ficha?(g.ficha=a.ficha,g.abrirPopup(g.idModalDialogPatologias)):g.mostrarMensaje("primero debe crear una ficha medica para poder ver las patogias del paciente")})},g.guardarPatoliga=function(){S(g.paciente.id,g.ficha).then(function(a){g.cerrarDialogDialogPatologias(),g.mostrarMensaje(a.message)})},g.cerrarDialogDialogPatologias=function(){g.cerrarPopup(g.idModalDialogPatologias)},g.abrirDialogDialogComentario=function(a){g.paciente=a,g.abrirPopup(g.idModalDialogComentario)},g.cerrarDialogDialogComentario=function(){g.cerrarPopup(g.idModalDialogComentario)},g.abrirDialogDialogAlertPrerequisitos=function(){g.listaAlertasPrerequisitosPaciente({inicio:0,fin:0}),g.abrirPopup(g.idModalAlertPrerequisitos)},g.cerrarDialogDialogAlertPrerequisitos=function(){g.cerrarPopup(g.idModalAlertPrerequisitos)},g.verificarConteoAlertas=function(){var a=0;return null!=g.alertasPrerequisitos&&(a+=g.alertasPrerequisitos),null!=g.alertasVacunas&&(a+=g.alertasVacunas),g.alertasOtros=0,a},g.obtenerAlertas=function(){g.verificarAlertasPrerequisitos(),g.verificarAlertasVacunas(),g.verificarConteoAlertas()},g.verificarAlertasPrerequisitos=function(){var a={inicio:0,fin:0};g.filtro=a,Da(g.usuario.id_empresa,a).then(function(a){g.filtro.inicio=g.filtro.inicio instanceof Date?g.filtro.inicio.getDate()+"/"+(g.filtro.inicio.getMonth()+1)+"/"+g.filtro.inicio.getFullYear():"",g.filtro.fin=g.filtro.fin instanceof Date?g.filtro.fin.getDate()+"/"+(g.filtro.fin.getMonth()+1)+"/"+g.filtro.fin.getFullYear():"";var i=a.Prerequisitos;g.listaAlertPrerequisitos=[],i.forEach(function(a,i,e){new Date;var o=new Date(a.fecha_vencimiento);a.DiasVence=g.diasVencidos(o),null!=a.fecha_entrega?a.entregado=!0:(a.entregado=!1,a.reprogramado?a.DiasVence<=a.dias_activacion&&a.DiasVence>=-1*a.dias_activacion&&g.listaAlertPrerequisitos.push(a):a.DiasVence<=a.preRequisito.dias_activacion&&a.DiasVence>=-1*a.preRequisito.dias_activacion&&g.listaAlertPrerequisitos.push(a)),i==e.length-1&&(g.alertasPrerequisitos=g.listaAlertPrerequisitos.length)},this)})},g.verificarAlertasVacunas=function(){var a={inicio:0,fin:0};""!==a.vacuna&&void 0!==a.vacuna||(a.vacuna=0),ha(g.usuario.id_empresa,a).then(function(a){g.filtro.inicio=g.filtro.inicio instanceof Date?g.filtro.inicio.getDate()+"/"+(g.filtro.inicio.getMonth()+1)+"/"+g.filtro.inicio.getFullYear():"",g.filtro.fin=g.filtro.fin instanceof Date?g.filtro.fin.getDate()+"/"+(g.filtro.fin.getMonth()+1)+"/"+g.filtro.fin.getFullYear():"",g.listaAlertVacunas=a.Vacunas,g.listaAlertVacunas.forEach(function(a,i,e){new Date(a.fecha_ultima_aplicacion);var o=new Date(a.fecha_siguiente_aplicacion);a.DiasVence=g.diasVencidos(o),console.log(a.DiasVence),i==e.length-1&&(g.alertasVacunas=g.listaAlertVacunas.length)},this)})},g.listaAlertasPrerequisitosPaciente=function(a){null!=(g.filtro=a).inicio&&0!=a.inicio&&""!=a.inicio?g.filtro.inicio=a.inicio instanceof Date?a.inicio:new Date(g.convertirFecha(a.inicio)):g.filtro.inicio=0,null!=a.fin&&0!=a.fin&&""!=a.fin?g.filtro.fin=a.fin instanceof Date?a.fin:new Date(g.convertirFecha(a.fin)):g.filtro.fin=0,Da(g.usuario.id_empresa,g.filtro).then(function(a){g.filtro.inicio=g.filtro.inicio instanceof Date?g.filtro.inicio.getDate()+"/"+(g.filtro.inicio.getMonth()+1)+"/"+g.filtro.inicio.getFullYear():"",g.filtro.fin=g.filtro.fin instanceof Date?g.filtro.fin.getDate()+"/"+(g.filtro.fin.getMonth()+1)+"/"+g.filtro.fin.getFullYear():"";var i=a.Prerequisitos;g.listaAlertPrerequisitos=[],i.forEach(function(a,i,e){new Date(a.fecha_inicio);var o=new Date(a.fecha_vencimiento);a.DiasVence=g.diasVencidos(o),null!=a.fecha_entrega?a.entregado=!0:(a.entregado=!1,a.DiasVence<=a.preRequisito.dias_activacion&&a.DiasVence>=-1*a.preRequisito.dias_activacion&&g.listaAlertPrerequisitos.push(a)),i==e.length-1&&(g.alertasPrerequisitos=g.listaAlertPrerequisitos.length,g.verificarConteoAlertas())},this)})},g.obtenerListaEmpresaVacunas=function(a){null!=(g.filtro=a).inicio&&null!=a.fin&&(0!=a.inicio||""!=a.inicio)?(g.filtro.inicio=a.inicio instanceof Date?a.inicio:new Date(g.convertirFecha(a.inicio)),g.filtro.fin=a.fin instanceof Date?a.fin:new Date(g.convertirFecha(a.fin))):(g.filtro.inicio=0,g.filtro.fin=0),J(g.usuario.id_empresa,g.filtro).then(function(a){g.listaAlertVacunas=a.Vacunas,g.listaAlertVacunas.forEach(function(a){new Date(a.fecha_ultima_aplicacion);var i=new Date(a.fecha_siguiente_aplicacion);a.DiasVence=g.diasVencidos(i).console.log(a.DiasVence)},this)})},g.obtenerListaAlertasVacunas=function(a){null!=(g.filtro=a).inicio&&0!=a.inicio&&""!=a.inicio?g.filtro.inicio=a.inicio instanceof Date?a.inicio:new Date(g.convertirFecha(a.inicio)):g.filtro.inicio=0,null!=a.fin&&0!=a.fin&&""!=a.fin?g.filtro.fin=a.fin instanceof Date?a.fin:new Date(g.convertirFecha(a.fin)):g.filtro.fin=0,null!=a.vacuna&&null!=a.vacuna&&""!=g.filtro.vacuna||(g.filtro.vacuna=0),ha(g.usuario.id_empresa,a).then(function(a){g.listaAlertVacunas=a.Vacunas,g.listaAlertVacunas.forEach(function(a){new Date(a.fecha_ultima_aplicacion);var i=new Date(a.fecha_siguiente_aplicacion);a.DiasVence=g.diasVencidos(i),g.alertasVacunas=g.listaAlertVacunas.length,g.verificarConteoAlertas(),console.log(a.DiasVence)},this),g.filtro.inicio=g.filtro.inicio instanceof Date?g.filtro.inicio.getDate()+"/"+(g.filtro.inicio.getMonth()+1)+"/"+g.filtro.inicio.getFullYear():"",g.filtro.fin=g.filtro.fin instanceof Date?g.filtro.fin.getDate()+"/"+(g.filtro.fin.getMonth()+1)+"/"+g.filtro.fin.getFullYear():""})},g.setDiasActivacionPrerequisitos=function(a){if(r.start(),void 0===g.preRequisito){var i={setDiasTodos:!0,dias_activacion:a};D.save(i,function(a){g.mostrarMensaje(a.mensaje),g.cerrarDialogDialogDiasActivacionPrerequisitos(),g.obtenerAlertas(),r.stop()})}else g.preRequisito.dias_activacion=a,D.save(g.preRequisito,function(a){g.mostrarMensaje(a.mensaje),g.cerrarDialogDialogDiasActivacionPrerequisitos(),g.obtenerAlertas(),r.stop()})},g.setDiasActivacionVacunas=function(a){if(r.start(),void 0===g.vacuna){var i={setDiasTodos:!0,dias_activacion:a};Pa.update(i,function(a){g.mostrarMensaje(a.mensaje),g.cerrarDialogDiasActivacionVacunas(),g.obtenerAlertas(),r.stop()})}else g.vacuna.dias_activacion=a,Pa.update(g.preRequisito,function(a){g.mostrarMensaje(a.mensaje),g.cerrarDialogDiasActivacionVacunas(),g.obtenerAlertas(),r.stop()})},g.abrirDialogDialogDiasActivacionPrerequisitos=function(a){void 0===a?(g.preRequisito=void 0,g.paciente=void 0):g.preRequisito=a,g.abrirPopup(g.idModalDiasActivacionPrerequisitos)},g.cerrarDialogDialogDiasActivacionPrerequisitos=function(){g.cerrarPopup(g.idModalDiasActivacionPrerequisitos)},g.reprogramarPrerequisitos=function(a){if(r.start(),void 0===g.paciente&&void 0===g.preRequisito){var i={reprogramarTodos:!0,fecha_vencimiento:new Date(a)};ma.save(i,function(a){g.mostrarMensaje(a.mensaje),g.cerrarDialogReprogramarPrerequisitos(),g.obtenerAlertas(),r.stop()})}else g.preRequisito.fecha_vencimiento=new Date(g.convertirFecha(a)),g.preRequisito.asignado=!0,ma.save(g.preRequisito,function(a){g.mostrarMensaje(a.mensaje),g.cerrarDialogReprogramarPrerequisitos(),g.obtenerAlertas(),r.stop()})},g.abrirDialogReprogramarPrerequisitos=function(a){void 0===a?(g.preRequisito=void 0,g.paciente=void 0):g.preRequisito=a,g.abrirPopup(g.idModalReprogramarPrerequisitos)},g.cerrarDialogReprogramarPrerequisitos=function(){g.cerrarPopup(g.idModalReprogramarPrerequisitos)},g.abrirDialogAlertVacunas=function(){g.obtenerListaAlertasVacunas({inicio:0,fin:0}),g.abrirPopup(g.idModalAlertVacunas)},g.cerrarDialogAlertVacunas=function(){g.cerrarPopup(g.idModalAlertVacunas)},g.abrirDialogDiasActivacionVacunas=function(a){g.vacuna=void 0===a?void 0:a,g.abrirPopup(g.idModalDiasActivacionVacunas)},g.cerrarDialogDiasActivacionVacunas=function(){g.cerrarPopup(g.idModalDiasActivacionVacunas)},g.abrirDialogReprogramarVacunas=function(){g.abrirPopup(g.idModalReprogramarVacunas)},g.cerrarDialogReprogramarVacunas=function(){g.cerrarPopup(g.idModalReprogramarVacunas)},g.cerrarIdModalDialogLaboratorioExamenesHistoricoResultados=function(){g.cerrarPopup(g.IdModalDialogLaboratorioExamenHistoricoResultado)},g.cerrarIdModalDialogDiagnosticoExamenesHistoricoResultados=function(){g.cerrarPopup(g.IdModalDialogDiagnosticoExamenHistoricoResultado)},g.cerrarIdModalDialogNuevoLaboratorio=function(){g.cerrarPopup(g.IdModalDialogNuevoLaboratorio)},g.cerrarIdModalDialogLaboratorioExameneHistoricoPreview=function(){g.cerrarPopup(g.IdModalDialogLaboratorioExamenHistoricoPreview)},g.cerrarIdModalDialogLaboratorioExamenesNuevoResultado=function(){g.cerrarPopup(g.IdModalDialogLaboratorioExamenesNuevoResultado)},g.cerrarIdModalDialogLaboratorioExamenes=function(){g.cerrarPopup(g.IdModalDialogLaboratorioExamenes)},g.cerrarPopUpExamenLaboratorio=function(){g.cerrarPopup(g.IdModalDialogLaboratorioExamen)},g.cerrarPopUpVacunaNueva=function(){g.vacunaDosis=[],setTimeout(function(){g.obtenerVacunas(),setTimeout(function(){g.verificarAsignacionVacunas()},1e3)},1e3),g.dosis={},g.dosisEdit=!1,g.cerrarPopup(g.idModalDialogVacunaEdicion)},g.cerrarPopUpVacunasConfig=function(){g.paciente.vacunas=[],_(g.paciente).then(function(a){g.paciente.vacunas=a,g.paciente.vacunas.forEach(function(a){var i=new Date;a.fechaAplicacionVacuna_texto=i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear(),a.button_clicked=!1},this)}),g.limpiarAsignacionVacunas(),g.verificarAsignacionVacunas(),g.obtenerAlertas(),g.cerrarPopup(g.idModalDialogVacunasConfig)},g.cerrarPopUpIdModalFichaTecnica=function(){g.cerrarPopup(g.idModalFichaTecnica)},g.cerrarPopUpConsulta=function(){g.cerrarPopup(g.idModalDialogConsulta)},g.cerrarPopUpPreRequisitos=function(){g.obtenerAlertas(),g.cerrarPopup(g.IdModalDialogPreRequisitos)},g.cerrarIdModalDialogLaboratorio=function(){g.cerrarPopup(g.IdModalDialogLaboratorio)},g.cerrarPopPupVacunas=function(){g.filtroHistorialVacunas=[],g.obtenerAlertas(),g.cerrarPopup(g.idModalDialogVacunas)},g.cerrarPopPupVacunasConfig=function(){g.obtenerAlertas(),g.cerrarPopup(g.idModalDialogVacunasConfig)},g.crearNuevaConsulta=function(a){var i=(new Date).getDate()+"/"+((new Date).getMonth()+1)+"/"+(new Date).getFullYear();g.horaConsulta=(new Date).getHours()+":"+(new Date).getMinutes();var e=12<=(new Date).getHours()?"PM":"AM";g.consulta={id_paciente:a.id,fecha:i+" "+g.horaConsulta+" "+e},g.paciente=a;w(g.paciente.id,{inicio:0,fin:0}).then(function(a){g.consultas=a.consultas,g.filtro.inicio=g.filtro.inicio instanceof Date?g.filtro.inicio.getDate()+"/"+(g.filtro.inicio.getMonth()+1)+"/"+g.filtro.inicio.getFullYear():"",g.filtro.fin=g.filtro.fin instanceof Date?g.filtro.fin.getDate()+"/"+(g.filtro.fin.getMonth()+1)+"/"+g.filtro.fin.getFullYear():""}),g.abrirPopup(g.idModalDialogConsulta)},g.EliminarNuevoLaboratorio=function(a){ua(g.paciente.id_empresa,a).then(function(a){g.ObtenerMedicoLaboratorios(g.paciente),g.mostrarMensaje(a.message)})},g.guardarNuevoLaboratorio=function(a){a.$valid&&(g.laboratorio.id?ta(g.paciente.id_empresa,g.laboratorio).then(function(a){g.cerrarIdModalDialogNuevoLaboratorio(),g.ObtenerMedicoLaboratorios(g.paciente),g.mostrarMensaje(a.message)}):R(g.paciente.id_empresa,g.laboratorio).then(function(a){g.cerrarIdModalDialogNuevoLaboratorio(),g.ObtenerMedicoLaboratorios(g.paciente),g.mostrarMensaje(a.message)}))},g.ObtenerMedicoLaboratorios=function(a){H(a.id_empresa).then(function(a){g.listaLaboratorios=a})},g.guardarNuevoLaboratorioExamen=function(a){a.$valid&&(g.examen.id?ra(g.laboratorio.id,g.examen).then(function(a){g.cerrarIdModalDialogLaboratorioExamenesNuevoResultado(),g.ObtenerMedicoLaboratorioExamenes(g.laboratorio),g.mostrarMensaje(a.message)}):N(g.laboratorio.id,g.examen).then(function(a){g.cerrarIdModalDialogLaboratorioExamenesNuevoResultado(),g.ObtenerMedicoLaboratorioExamenes(g.laboratorio),g.mostrarMensaje(a.message)}))},g.EliminarNuevoLaboratorioExamen=function(a){da(g.laboratorio.id,a).then(function(a){g.ObtenerMedicoLaboratorioExamenes(g.laboratorio),g.mostrarMensaje(a.message)})},g.ObtenerMedicoLaboratorioExamenes=function(a){promesa=j(a.id),promesa.then(function(a){g.listaLaboratorioExamenes=a})},g.guardarLaboratorioExamenResultados=function(a,i){if(a.$valid){var e={fecha:new Date(g.convertirFecha(i)),examenes:g.listaLaboratorioExamenes};promesa=O(g.laboratorio.id,g.paciente.id,e),promesa.then(function(a){g.cerrarIdModalDialogLaboratorioExamenes(),g.ObtenerMedicoLaboratorioExamenes(g.laboratorio),g.mostrarMensaje(a.message)})}},g.ObtenerHistorialLaboratorioExamenes=function(a){null!=a.inicio&&(0!=a.inicio||""!=a.inicio)?g.filtro.inicio=a.inicio instanceof Date?a.inicio:new Date(g.convertirFecha(a.inicio)):g.filtro.inicio=0,null!=a.fin&&(0!=a.fin||""!=a.fin)?g.filtro.fin=a.fin instanceof Date?a.fin:new Date(g.convertirFecha(a.fin)):g.filtro.fin=0,promesa=y(g.laboratorio.id,g.paciente.id,g.filtro),promesa.then(function(a){g.filtro.inicio=g.filtro.inicio instanceof Date?g.filtro.inicio.getDate()+"/"+(g.filtro.inicio.getMonth()+1)+"/"+g.filtro.inicio.getFullYear():"",g.filtro.fin=g.filtro.fin instanceof Date?g.filtro.fin.getDate()+"/"+(g.filtro.fin.getMonth()+1)+"/"+g.filtro.fin.getFullYear():"",g.listaHistorialLaboratorioExamenes=a})},g.ObtenerHistorialFichaMedica=function(a){null!=a.inicio&&(0!=a.inicio||""!=a.inicio)?g.filtro.inicio=a.inicio instanceof Date?a.inicio:new Date(g.convertirFecha(a.inicio)):g.filtro.inicio=0,null!=a.fin&&(0!=a.fin||""!=a.fin)?g.filtro.fin=a.fin instanceof Date?a.fin:new Date(g.convertirFecha(a.fin)):g.filtro.fin=0,null==a.tipo_control&&(a.tipo_control=0),promesa=na(g.paciente.id,a),promesa.then(function(a){g.filtro.inicio=g.filtro.inicio instanceof Date?g.filtro.inicio.getDate()+"/"+(g.filtro.inicio.getMonth()+1)+"/"+g.filtro.inicio.getFullYear():"",g.filtro.fin=g.filtro.fin instanceof Date?g.filtro.fin.getDate()+"/"+(g.filtro.fin.getMonth()+1)+"/"+g.filtro.fin.getFullYear():"",g.listaHistorialfichaMEdica=a})},g.eliminarDiagnostico=function(a){pa(g.paciente.id_empresa,a).then(function(a){g.ObtenerMedicoDiagnostico(g.paciente),g.mostrarMensaje(a.message)})},g.guardarNuevoDiagnostico=function(a){a.$valid&&(g.diagnostico.id?(promesa=ca(g.paciente.id_empresa,g.diagnostico),promesa.then(function(a){g.cerrarDialogDiagnosticoNuevo(),g.ObtenerMedicoDiagnostico(g.paciente),g.mostrarMensaje(a.message)})):(promesa=Y(g.paciente.id_empresa,g.diagnostico),promesa.then(function(a){g.cerrarDialogDiagnosticoNuevo(),g.ObtenerMedicoDiagnostico(g.paciente),g.mostrarMensaje(a.message)})))},g.ObtenerMedicoDiagnostico=function(a){promesa=G(a.id_empresa),promesa.then(function(a){g.listaDiagnosticos=a})},g.guardarNuevoDiagnosticoExamen=function(a){a.$valid&&(g.examen.id?(promesa=sa(g.diagnostico.id,g.examen),promesa.then(function(a){g.cerrarDialogNuevoExamenDiagnostico(),g.ObtenerMedicoDiagnosticoExamenes(g.diagnostico),g.mostrarMensaje(a.message)})):(promesa=z(g.diagnostico.id,g.examen),promesa.then(function(a){g.cerrarDialogNuevoExamenDiagnostico(),g.ObtenerMedicoDiagnosticoExamenes(g.diagnostico),g.mostrarMensaje(a.message)})))},g.eliminarNuevoDiagnosticoExamen=function(a){fa(g.diagnostico.id,a).then(function(a){g.ObtenerMedicoDiagnosticoExamenes(g.diagnostico),g.mostrarMensaje(a.message)})},g.ObtenerMedicoDiagnosticoExamenes=function(a){promesa=U(a.id),promesa.then(function(a){g.listaDiagnosticosExamenes=a})},g.guardarDiagnosticoExamenResultados=function(a,i){if(a.$valid){var e={fecha:new Date(g.convertirFecha(i)),examenes:g.listaDiagnosticosExamenes};promesa=X(g.diagnostico.id,g.paciente.id,e),promesa.then(function(a){g.cerrarDialogExamenesDiagnostico(),g.ObtenerMedicoDiagnosticoExamenes(g.diagnostico),g.mostrarMensaje(a.message)})}},g.ObtenerHistorialDiagnosticoExamenes=function(a){null!=a.inicio&&(0!=a.inicio||""!=a.inicio)?g.filtro.inicio=a.inicio instanceof Date?a.inicio:new Date(g.convertirFecha(a.inicio)):g.filtro.inicio=0,null!=a.fin&&(0!=a.fin||""!=a.fin)?g.filtro.fin=a.fin instanceof Date?a.fin:new Date(g.convertirFecha(a.fin)):g.filtro.fin=0,promesa=k(g.diagnostico.id,g.paciente.id,g.filtro),promesa.then(function(a){g.filtro.inicio=g.filtro.inicio instanceof Date?g.filtro.inicio.getDate()+"/"+(g.filtro.inicio.getMonth()+1)+"/"+g.filtro.inicio.getFullYear():"",g.filtro.fin=g.filtro.fin instanceof Date?g.filtro.fin.getDate()+"/"+(g.filtro.fin.getMonth()+1)+"/"+g.filtro.fin.getFullYear():"",g.listaHistorialDiagnosticoExamenes=a})},g.fecha_excel_angular=function(a){var i=new Date(1/1970),e=a-25568;return i.setTime(i.getTime()+864e5*e)},g.subirExcelPacientes=function(a){r.start();var i,e,o=a.target.files;for(e=o[i=0];i!=o.length;++i){var n=new FileReader;e.name;n.onload=function(a){var i=a.target.result,e=XLSX.read(i,{type:"binary"}),o=e.SheetNames[0],n=2,t=e.Sheets[o],r=[];do{var c={};c.codigo=null!=t["A"+n]&&""!=t["A"+n]?t["A"+n].v.toString():null,c.apellido_paterno=null!=t["B"+n]&&""!=t["B"+n]?t["B"+n].v.toString():null,c.apellido_materno=null!=t["C"+n]&&""!=t["C"+n]?t["C"+n].v.toString():null,c.nombres=null!=t["D"+n]&&""!=t["D"+n]?t["D"+n].v.toString():null,c.ci=null!=t["E"+n]&&""!=t["E"+n]?t["E"+n].v.toString():null,c.extension=null!=t["F"+n]&&""!=t["F"+n]?t["F"+n].v.toString():null,c.grupo_sanguineo=null!=t["G"+n]&&""!=t["G"+n]?t["G"+n].v.toString():null,c.fecha_nacimiento=null!=t["H"+n]&&""!=t["H"+n]?g.fecha_excel_angular(t["H"+n].v.toString()):null,c.genero=null!=t["I"+n]&&""!=t["I"+n]?t["I"+n].v.toString():null,c.telefono=null!=t["J"+n]&&""!=t["J"+n]?t["J"+n].v.toString():null,c.telefono2=null!=t["K"+n]&&""!=t["K"+n]?t["K"+n].v.toString():null,c.telefono_movil=null!=t["L"+n]&&""!=t["L"+n]?t["L"+n].v.toString():null,c.estilo_de_vida=null!=t["M"+n]&&""!=t["M"+n]?t["M"+n].v.toString():null,c.cargo=null!=t["N"+n]&&""!=t["N"+n]?t["N"+n].v.toString():null,c.designacion_empresa=null!=t["O"+n]&&""!=t["O"+n]?t["O"+n].v.toString():null,c.telefono_empresa=null!=t["P"+n]&&""!=t["P"+n]?t["P"+n].v.toString():null,c.campamento=null!=t["Q"+n]&&""!=t["Q"+n]?t["Q"+n].v.toString():null,c.riesgos_procesos_trabajo=null!=t["R"+n]&&""!=t["R"+n]?t["R"+n].v.toString():null,c.ciudad_referencia=null!=t["S"+n]&&""!=t["S"+n]?t["S"+n].v.toString():null,c.zona_referencia=null!=t["T"+n]&&""!=t["T"+n]?t["T"+n].v.toString():null,c.calle_av_referencia=null!=t["U"+n]&&""!=t["U"+n]?t["U"+n].v.toString():null,c.nro_referencia=null!=t["V"+n]&&""!=t["V"+n]?t["V"+n].v.toString():null,c.telefonos_referencia=null!=t["W"+n]&&""!=t["W"+n]?t["W"+n].v.toString():null,c.celular_referencia=null!=t["X"+n]&&""!=t["X"+n]?t["X"+n].v.toString():null,c.nombre_referencia=null!=t["Y"+n]&&""!=t["Y"+n]?t["Y"+n].v.toString():null,c.imagen="img/icon-user-default.png",r.push(c),n++,0,console.log}while(null!=t["A"+n]);g.guardarPacientes(r)},n.readAsBinaryString(e)}},g.guardarPacientes=function(a){new B({pacientes:a,id_empresa:g.usuario.id_empresa}).$save(function(a){g.mostrarMensaje(a.mensaje),g.recargarItemsTabla()}),r.stop()},g.subirExcelFichasTecnicas=function(a){r.start();var i,e,o=a.target.files;for(e=o[i=0];i!=o.length;++i){var n=new FileReader;e.name;n.onload=function(a){var i=a.target.result,e=XLSX.read(i,{type:"binary"}),o=e.SheetNames[0],n=2,t=e.Sheets[o],r=[];do{var c={};c.codigo=null!=t["A"+n]&&""!=t["A"+n]?t["A"+n].v.toString():null,c.fecha=null!=t["G"+n]&&""!=t["G"+n]?new Date(g.convertirFecha(t["G"+n].v.toString())):null,c.estilo_vida=null!=t["L"+n]&&""!=t["L"+n]?t["L"+n].v.toString():null,c.empresa=null!=t["M"+n]&&""!=t["M"+n]?t["M"+n].v.toString():null,c.telefono=null!=t["N"+n]&&""!=t["N"+n]?t["N"+n].v.toString():null,c.area_operacion=null!=t["O"+n]&&""!=t["O"+n]?t["O"+n].v.toString():null,c.actividad_laboral=null!=t["P"+n]&&""!=t["P"+n]?t["P"+n].v.toString():null,c.riesgo=null!=t["Q"+n]&&""!=t["Q"+n]?t["Q"+n].v.toString():null,c.ciudad_referencia=null!=t["R"+n]&&""!=t["R"+n]?t["R"+n].v.toString():null,c.zona_referencia=null!=t["S"+n]&&""!=t["S"+n]?t["S"+n].v.toString():null,c.calle_av_referencia=null!=t["T"+n]&&""!=t["T"+n]?t["T"+n].v.toString():null,c.numero_referencia=null!=t["U"+n]&&""!=t["U"+n]?t["U"+n].v.toString():null,c.telefono_referencia=null!=t["V"+n]&&""!=t["V"+n]?t["V"+n].v.toString():null,c.celular_referencia=null!=t["W"+n]&&""!=t["W"+n]?t["W"+n].v.toString():null,c.nombre_referencia=null!=t["X"+n]&&""!=t["X"+n]?t["X"+n].v.toString():null,c.tipo_control=null!=t["Y"+n]&&""!=t["Y"+n]?t["Y"+n].v.toString():null,c.grupo_sanguineo=null!=t["Z"+n]&&""!=t["Z"+n]?t["Z"+n].v.toString():null,c.alergia_humo_cigarrillo=null!=t["AA"+n]&&""!=t["AA"+n]&&"NO"!=t["AA"+n].v.toString(),c.alergia_quimico=null!=t["AB"+n]&&""!=t["AB"+n]&&"NO"!=t["AB"+n].v.toString(),c.alergia_medicamento=null!=t["AC"+n]&&""!=t["AC"+n]&&"NO"!=t["AC"+n].v.toString(),c.alergia_plantas=null!=t["AD"+n]&&""!=t["AD"+n]&&"NO"!=t["AD"+n].v.toString(),c.alergia_polvo=null!=t["AE"+n]&&""!=t["AE"+n]&&"NO"!=t["AE"+n].v.toString(),c.alergia_algun_material=null!=t["AF"+n]&&""!=t["AF"+n]&&"NO"!=t["AF"+n].v.toString(),c.alergia_alimentos=null!=t["AG"+n]&&""!=t["AG"+n]&&"NO"!=t["AG"+n].v.toString(),c.alergia_conservas=null!=t["AH"+n]&&""!=t["AH"+n]&&"NO"!=t["AH"+n].v.toString(),c.alergia_picadura=null!=t["AI"+n]&&""!=t["AI"+n]&&"NO"!=t["AI"+n].v.toString(),c.alergia_otros=null!=t["AJ"+n]&&""!=t["AJ"+n]&&"NO"!=t["AJ"+n].v.toString(),c.alergia_otros_comentario=null!=t["AL"+n]&&""!=t["AL"+n]?t["AL"+n].v.toString():null,c.enfermedad_hipertension=null!=t["AL"+n]&&""!=t["AL"+n]&&"NO"!=t["AL"+n].v.toString(),c.enfermedad_diabetes=null!=t["AM"+n]&&""!=t["AM"+n]&&"NO"!=t["AM"+n].v.toString(),c.enfermedad_epilepsia=null!=t["AN"+n]&&""!=t["AN"+n]&&"NO"!=t["AN"+n].v.toString(),c.enfermedad_asma=null!=t["AO"+n]&&""!=t["AO"+n]&&"NO"!=t["AO"+n].v.toString(),c.enfermedad_cardiologia=null!=t["AP"+n]&&""!=t["AP"+n]&&"NO"!=t["AP"+n].v.toString(),c.enfermedad_digestivas=null!=t["AQ"+n]&&""!=t["AQ"+n]&&"NO"!=t["AQ"+n].v.toString(),c.enfermedad_chagas=null!=t["AR"+n]&&""!=t["AR"+n]&&"NO"!=t["AR"+n].v.toString(),c.enfermedad_hepatitis=null!=t["AS"+n]&&""!=t["AS"+n]&&"NO"!=t["AS"+n].v.toString(),c.enfermedad_lumbalgia=null!=t["AT"+n]&&""!=t["AT"+n]&&"NO"!=t["AT"+n].v.toString(),c.enfermedad_otros=null!=t["AU"+n]&&""!=t["AU"+n]&&"NO"!=t["AU"+n].v.toString(),c.enfermedad_comentario=null!=t["AV"+n]&&""!=t["AV"+n]?t["AV"+n].v.toString():null,c.quirurgico_operado=null!=t["AW"+n]&&""!=t["AW"+n]&&"NO"!=t["AW"+n].v.toString(),c.quirurgico_comentario=null!=t["AX"+n]&&""!=t["AX"+n]?t["AX"+n].v.toString():null,c.es_donante=null!=t["AY"+n]&&""!=t["AY"+n]&&"NO"!=t["AY"+n].v.toString(),c.fecha=new Date(c.fecha),r.push(c),n++,0}while(null!=t["A"+n]);g.guardarfichasTecnicas(r)},n.readAsBinaryString(e)}},g.guardarfichasTecnicas=function(a){new W({fichas:a,id_empresa:g.usuario.id_empresa}).$save(function(a){g.mostrarMensaje(a.mensaje),g.recargarItemsTabla()},function(a){g.mostrarMensaje("Ocurrio un problema al momento de guardar!"),g.recargarItemsTabla()}),r.stop()},g.subirExcelSignosVitales=function(a){r.start();var i,e,o=a.target.files;for(e=o[i=0];i!=o.length;++i){var n=new FileReader;e.name;n.onload=function(a){var i=a.target.result,e=XLSX.read(i,{type:"binary"}),o=e.SheetNames[0],n=2,t=e.Sheets[o],r=[];do{var c={};c.codigo=null!=t["A"+n]&&""!=t["A"+n]?t["A"+n].v.toString():null,c.fecha=null!=t["G"+n]&&""!=t["G"+n]?t["G"+n].v.toString():null,c.presion=null!=t["H"+n]&&""!=t["H"+n]?t["H"+n].v.toString():null,c.pulso=null!=t["I"+n]&&""!=t["I"+n]?t["I"+n].v.toString():null,c.talla=null!=t["J"+n]&&""!=t["J"+n]?Math.round(parseFloat(t["J"+n].v.toString()),4):null,c.peso=null!=t["K"+n]&&""!=t["K"+n]?Math.round(parseFloat(t["K"+n].v.toString()),4):null,c.temperatura=null!=t["L"+n]&&""!=t["L"+n]?Math.round(parseFloat(t["L"+n].v.toString()),3):null,c.frecuencia_respiratoria=null!=t["M"+n]&&""!=t["M"+n]?t["M"+n].v.toString():null,c.fecha=new Date(c.fecha),r.push(c),n++,0}while(null!=t["A"+n]);g.guardarSignosVitales(r)},n.readAsBinaryString(e)}},g.guardarSignosVitales=function(a){new K({signosVitales:a,id_empresa:g.usuario.id_empresa}).$save(function(a){g.mostrarMensaje(a.mensaje),g.recargarItemsTabla()},function(a){g.mostrarMensaje("Ocurrio un problema al momento de guardar!"),g.recargarItemsTabla()}),r.stop()},g.guardarPacientes=function(a){new B({pacientes:a,id_empresa:g.usuario.id_empresa}).$save(function(a){g.mostrarMensaje(a.mensaje),g.recargarItemsTabla()},function(a){g.mostrarMensaje("Ocurrio un problema al momento de guardar!"),g.recargarItemsTabla()}),r.stop()},g.subirExcelSOAP=function(a){r.start();var i,e,o=a.target.files;for(e=o[i=0];i!=o.length;++i){var n=new FileReader;e.name;n.onload=function(a){var i=a.target.result,e=XLSX.read(i,{type:"binary"}),o=e.SheetNames[0],n=2,t=e.Sheets[o],r=[];do{var c={};c.codigo=null!=t["A"+n]&&""!=t["A"+n]?t["A"+n].v.toString():null,c.fecha=null!=t["F"+n]&&""!=t["F"+n]?t["F"+n].v.toString():null,c.subjetivo=null!=t["G"+n]&&""!=t["G"+n]?t["G"+n].v.toString():null,c.objetivo=null!=t["H"+n]&&""!=t["H"+n]?t["H"+n].v.toString():null,c.analitico=null!=t["I"+n]&&""!=t["I"+n]?t["I"+n].v.toString():null,c.plan=null!=t["J"+n]&&""!=t["J"+n]?t["J"+n].v.toString():null,c.evolucion=null!=t["K"+n]&&""!=t["K"+n]?t["K"+n].v.toString():null,c.fecha=new Date(c.fecha),r.push(c),n++,0}while(null!=t["A"+n]);g.guardarSOAPLista(r)},n.readAsBinaryString(e)}},g.guardarSOAPLista=function(a){new Q({SOAPLista:a,id_empresa:g.usuario.id_empresa}).$save(function(a){g.mostrarMensaje(a.mensaje),g.recargarItemsTabla()},function(a){g.mostrarMensaje("Ocurrio un problema al momento de guardar!"),g.recargarItemsTabla()}),r.stop()},g.subirExcelVacunasPacientes=function(a){r.start();var i,e,o=a.target.files;for(e=o[i=0];i!=o.length;++i){var n=new FileReader;e.name;n.onload=function(a){var i=a.target.result,e=XLSX.read(i,{type:"binary"}),o=e.SheetNames[0],n=2,t=e.Sheets[o],r=[];do{var c={};c.codigo=null!=t["A"+n]&&""!=t["A"+n]?t["A"+n].v.toString():null,c.nombre_vacuna=null!=t["F"+n]&&""!=t["F"+n]?t["F"+n].v.toString():null,c.dosis=null!=t["G"+n]&&""!=t["G"+n]?t["G"+n].v.toString():null,c.fecha=null!=t["H"+n]&&""!=t["H"+n]?g.fecha_excel_angular(t["H"+n].v.toString()):null,c.Estado=null!=t["I"+n]&&""!=t["I"+n]?t["I"+n].v.toString():null,r.push(c),n++,0}while(null!=t["A"+n]);g.guardarAplicacionVacunas(r)},n.readAsBinaryString(e)}},g.guardarAplicacionVacunas=function(a){new Z({pacientes:a,id_empresa:g.usuario.id_empresa}).$save(function(a){g.mostrarMensaje(a.mensaje),g.recargarItemsTabla()},function(a){g.mostrarMensaje("Ocurrio un problema al momento de guardar!"),g.recargarItemsTabla()}),r.stop()},g.inicio()}]);