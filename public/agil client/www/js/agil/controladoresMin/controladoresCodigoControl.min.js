angular.module("agil.controladores").controller("ControladorCodigoControl",["$scope","$localStorage","$location","$templateCache","$route","blockUI","CodigoControl",function(u,e,a,r,o,s,n){s.start(),u.usuario=JSON.parse(e.usuario),u.inicio=function(){u.descargarPruebasExcel=restServer+"/downloadReport/PRUEBAS-CODIGO-CONTROL.xlsx"},u.$on("$viewContentLoaded",function(){resaltarPesta√±a(a.path().substring(1)),u.buscarAplicacion(u.usuario.aplicacionesUsuario,a.path().substring(1)),s.stop()}),u.subirExcelPruebasDosificaciones=function(e){var a,r,o=e.target.files;for(r=o[a=0];a!=o.length;++a){var n=new FileReader;r.name;n.onload=function(e){s.start();var a=e.target.result,r=XLSX.read(a,{type:"binary"}),o=r.SheetNames[0],n=2,t=r.Sheets[o],l=[];do{var i={};i.autorizacion=null!=t["B"+n]&&""!=t["B"+n]?t["B"+n].v.toString():null,i.factura=null!=t["C"+n]&&""!=t["C"+n]?t["C"+n].v.toString():null,i.nit=null!=t["D"+n]&&""!=t["D"+n]?t["D"+n].v.toString():null,i.fecha=null!=t["E"+n]&&""!=t["E"+n]?u.formatearFecha(t["E"+n].v.toString()):null,i.monto=null!=t["F"+n]&&""!=t["F"+n]?t["F"+n].v.toString():null,i.llave_digital=null!=t["G"+n]&&""!=t["G"+n]?t["G"+n].v.toString():null,i.codigo_control_esperado=null!=t["H"+n]&&""!=t["H"+n]?t["H"+n].v.toString():null,l.push(i),n++,0}while(null!=t["A"+n]);u.generarPruebas(l),s.stop()},n.readAsBinaryString(r)}},u.formatearFecha=function(e){if(3==(r=e.split("/")).length)if(2<r[0].length)var a=r[0]+r[1]+r[2];else a=r[2]+r[1]+r[0];else{var r;a=(r=(e=u.fechaATexto(new Date(u.fecha_excel_angular(e)))).split("/"))[2]+r[1]+r[0]}return a},u.fecha_excel_angular=function(e){var a=new Date(1/1970),r=e-25568;return a.setTime(a.getTime()+864e5*r)},u.generarPruebas=function(e){(e=new n({pruebas:e})).$save(function(e){u.pruebasCodigoControl=e.resultados,u.aplicarTabla("tabla-pruebas-codigo-control",8),s.stop(),u.mostrarMensaje("Pruebas generadas Exitosamente!")},function(e){s.stop(),u.mostrarMensaje("Ocurrio un problema al momento de generar las pruebas!")})},u.inicio()}]);