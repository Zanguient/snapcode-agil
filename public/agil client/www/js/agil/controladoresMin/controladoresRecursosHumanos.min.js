angular.module("agil.controladores").controller("ControladorRecursosHumanos",["$scope","$sce","$localStorage","$location","$templateCache","$route","blockUI","ListaDatosGenero","NuevoRecursoHumano","RecursosHumanosPaginador","Paginator","FieldViewer","EmpleadoEmpresa","obtenerEmpleadoRh","UsuarioRecursosHUmanosActivo","Prerequisito","ListaDatosPrerequisito","Prerequisitos","ListaPrerequisitosPaciente","ActualizarPrerequisito","UsuarioRecursosHumanosFicha","ClasesTipo","Clases","Paises","CrearEmpleadoFicha","EliminarOtroSeguroRh","EliminarFamiliarRh","PrerequisitoPaciente","PrerequisitosHistorial","UsuarioRhHistorialFicha","ObtenerEmpleadoHojaVida","GuardarEmpleadoHojaVida","CrearPrestamo","ObtenerListaPrestamo","CrearRolTurno","CrearPagoPrestamo","VerificarUsuarioEmpresa","EditarPrestamo","ListaEmpleadosRrhh","CrearHorasExtra","HistorialHorasExtra","ListaRolTurnos","ValidarCodigoCuentaEmpleado","$timeout","DatosCapacidadesImpresion","NuevoAnticipoEmpleado","ListaAnticiposEmpleado","CrearNuevosAnticiposEmpleados","ActualizarAnticipoEmpleado","NuevaAusenciaEmpleado","HistorialEmpleadoAusencias","HistorialEmpresaEmpleadosAusencias","NuevaVacacionEmpleado","HistorialEmpleadoVacaciones","HistorialEmpresaVacaciones","NuevoFeriado","ListaFeriados","GuardarClasesAusencias","Tipos","ListaBancos","ConfiguracionesVacacion","HistorialGestionesVacacion","GuardarTr3","ListaTr3Empresa","GuardarHistorialVacacion","CrearBeneficioSocial","ListaBeneficiosEmpleado","GuardarBitacoraFicha","VerBitacoraFicha","ObtenerFiniquitoEmpleado","ClasesTipoEmpresa","GuardarConfiguracionRopaCargo","ListaConfiguracionRopaCargo","DatosReporteConfiguracionRopa","FichasEmpleadoEmpresa","ListaCargosEmpleado","ListaRopaTrabajoProductos","GuardarDotacionRopa","ListaDotacionRopa","EliminarDotacionRopa","ListaDotacionRopaEmpresa","ActualizarDotacionRopa","FamiliaresEmpleadoEmpresa","ListaRolTurnosEmpresa","ClasesEmpresa","ListaChoferesViaje","GuardarViajeRrhh","ListaViajeRrhh","ListaRolTurnosCalendario","ViajeRrhhLista","BeneficioEmpresa","GuardarConductoresEmpresa","ListaHijosEmpleadosEmpresa","GuardarImportacionFichaEmpleados","GuardarImportacionRolTurnoEmpleados","PrerequisitosSave",function(T,l,a,e,o,i,M,t,n,r,c,s,d,p,u,f,m,h,g,b,v,_,D,E,A,R,x,P,j,H,C,w,S,V,F,I,O,N,B,L,q,Y,y,k,U,G,z,J,X,W,K,Q,Z,aa,ea,oa,ia,ta,na,ra,ca,sa,la,da,ua,pa,fa,ma,ha,ga,ba,va,_a,Da,Ea,Aa,Ra,Ma,xa,Ta,Pa,ja,Ha,Ca,wa,Sa,Va,Fa,Ia,Oa,Na,Ba,La,qa,Ya,ya){T.usuario=JSON.parse(a.usuario),T.idModalPrerequisitos="dialog-pre-requisitos",T.idModalEmpleado="dialog-empleado",T.idModalwizardContainerEmpleado="modal-wizard-empleado-container",T.idModalDepartamentoEstado="dialog-departamento-estado",T.idModalProvincia="dialog-provincia",T.idModalLocalidad="dialog-localidad",T.idImputContrato="id-contrato",T.idModalHojaVida="modal-hoja-vida",T.idModalwizardContainerHojaVida="modal-wizard-hoja-vida-container",T.idModalNuevoFamiliar="dialog-nuevo-familiar",T.idModalHistorialContrato="dialog-historial-contrato",T.idModalBeneficiosSociales="modal-beneficios-sociales",T.idModalDetalleVacaciones="dialog-detalle-vacaciones",T.idModalBitacoraFicha="dialog-bitacora-ficha",T.idModalAnticipoExtraordinario="dialog-anticipo-extraordinario",T.idModalNuevoPrestamo="dialog-nuevo-prestamo",T.idModalAusenciasVacaciones="dialog-ausencias-vacaciones",T.idTabAusenciasVacaciones="tab-ausencias-vacaciones",T.idModalTipoBaja="dialog-tipo-baja",T.idModalFeriados="dialog-feriados",T.idModalHitorialVacaciones="dialog-historial-vacaciones",T.idModalCompensacion="dialog-compesacion",T.idModalHistorialAusencias="dialog-historial-ausencias",T.idModalHistorialAusenciaMedica="dialog-historial-ausencia-medica",T.idModalTipoAusencia="dialog-tipo-ausencia",T.idModalRolTurnos="dialog-rol-turnos",T.idModalHistorialTurnos="dialog-historial-turnos",T.idModalHorasExtras="dialog-horas-extras",T.idModalHistorialHorasExtras="dialog-historial-horas-extras",T.idModalAnticipoRegular="dialog-anticipo-regular",T.idModalPrestamosPersonal="dialog-prestamos-personal",T.idModalAdvertencia="dialog-advertencia",T.idModalPretamosNuevoTodos="dialog-nuevo-prestamo-todos",T.idModalReporteHijos="dialog-reporte-hijos",T.idModalReporteVeneficios="dialog-reporte-beneficios-sociales",T.idModalPagoPrestamo="dialog-pago-prestamo",T.idModalReporteVacaciones="dialog-reporte-vacaciones",T.idModalReporteBajasMedicas="dialog-reporte-bajas-medicas",T.idModalReporteRolTurnos="dialog-reporte-rol-turnos",T.idModalReporteTurnosDetallado="dialog-reporte-turnos-detallado",T.idModalViajes="dialog-viajes",T.idModalVisita="dialog-visita",T.idModalVisitaSalida="dialog-visita-salida",T.idModalVehiculosViaje="dialog-vehiculos-viaje",T.idModalConductoresViaje="dialog-conductores-viaje",T.idModalHistorialViajes="dialog-historial-viajes",T.idModalReporteAusencias="dialog-reporte-ausencias",T.idModalCertificado="dialog-certificado",T.idModalRhNuevo="dialog-rh-nuevo",T.idModalWizardRhNuevo="modal-wizard-rh-container",T.idImagenUsuario="imagen-persona",T.idEliminarUsuarioRh="dialog-eliminar-usuarioRh",T.idEliminarSeguroEmpleado="dialog-eliminar-seguro",T.idEliminarFamiliarEmpleado="dialog-eliminar-familiar",T.idModalWizardRhVista="dialog-rh-vista",T.idModalContenedorRhVista="modal-wizard-container-rh-vista",T.idModalDialogPrerequisitoNuevo="dialog-pre-requisito-nuevo",T.idModalHistorialPrerequisito="dialog-historico-preRequisito",T.idModalEditarPrerequisito="dialog-editar-preRequisito",T.idModalDialogConfirmacionEntregaAdelantado="dialog-entrega-adelantada-prerequisito",T.IdEntregaPrerequisito="dialog-entrega-preRequisito",T.IdModalVerificarCuenta="modal-verificar-cuenta",T.IdModalVerificarCuentaRrhh="modal-verificar-cuenta-Rrhh",T.idModalImpresionHojaVida="dialog-impresion-hoja-vida",T.idModalNuevoAnticipoRegularTodos="dialog-nuevo-anticipo-regular-todos",T.idModalTr3BancoMsc="modal-tr3-banco-msc",T.idModalTr3BancoUnion="modal-tr3-banco-union",T.idModalHistorialTr3="modal-historial-tr3",T.idModalConfirmarDesabilitacion="modal-confirmar-desabilitacion",T.idModalReingresoEmpleado="modal-reingreso-empleado",T.idModalHistorialBeneficios="dialog-historial-beneficio_social",T.idModalConfiguracionRopaDeTrabajo="dialog-configuracion-ropa-trabajo",T.idModalReporteRopaDeTrabajo="dialog-reporte-ropa-trabajo",T.idmodalWizardContainerConfiguracionRopaTrabajo="modal-wizard-container-configuracion-ropa-trabajo",T.idModalRopaTrabajo="dialog-ropa-trabajo",T.idModalNuevaRopaTrabajo="dialog-nueva-ropa-trabajo",T.idModalItemsNuevaRopaTrabajo="dialog-items-nueva-ropa-trabajo",T.idModalEliminarRopaTrabajo="dialog-eliminar-ropa-trabajo",T.idModalConceptoEdicion="dialog-conceptos",T.idModalDesabilitarPasajero="dialog-motivo-desabilitar-viajero",T.idModalCerrarRolDeTurno="modal-cerrar-rol-de-turno",T.idModalHistorialGestionesVacaciones="dialog-historial-gestiones-vacaciones",T.idModalTipoImportacionRol="dialog-tipo-importacion-rol",T.$on("$viewContentLoaded",function(){resaltarPestaña(e.path().substring(1)),ejecutarScriptsRecursosHumanos(T.idModalPrerequisitos,T.idModalEmpleado,T.idModalwizardContainerEmpleado,T.idModalDepartamentoEstado,T.idModalProvincia,T.idModalLocalidad,T.idImputContrato,T.idModalHojaVida,T.idModalwizardContainerHojaVida,T.idModalNuevoFamiliar,T.idModalHistorialContrato,T.idModalBeneficiosSociales,T.idModalDetalleVacaciones,T.idModalBitacoraFicha,T.idModalAnticipoExtraordinario,T.idModalNuevoPrestamo,T.idModalAusenciasVacaciones,T.idTabAusenciasVacaciones,T.idModalTipoBaja,T.idModalFeriados,T.idModalHitorialVacaciones,T.idModalCompensacion,T.idModalHistorialAusencias,T.idModalHistorialAusenciaMedica,T.idModalTipoAusencia,T.idModalRolTurnos,T.idModalHistorialTurnos,T.idModalHorasExtras,T.idModalHistorialHorasExtras,T.idModalAnticipoRegular,T.idModalPrestamosPersonal,T.idModalAdvertencia,T.idModalPretamosNuevoTodos,T.idModalReporteHijos,T.idModalReporteVeneficios,T.idModalPagoPrestamo,T.idModalReporteVacaciones,T.idModalReporteBajasMedicas,T.idModalReporteRolTurnos,T.idModalReporteTurnosDetallado,T.idModalViajes,T.idModalVisita,T.idModalVehiculosViaje,T.idModalHistorialViajes,T.idModalReporteAusencias,T.idModalCertificado,T.idModalRhNuevo,T.idModalWizardRhNuevo,T.idImagenUsuario,T.idEliminarUsuarioRh,T.idModalWizardRhVista,T.idModalContenedorRhVista,T.idModalDialogPrerequisitoNuevo,T.idEliminarSeguroEmpleado,T.idEliminarFamiliarEmpleado,T.idModalHistorialPrerequisito,T.idModalEditarPrerequisito,T.idModalDialogConfirmacionEntregaAdelantado,T.IdEntregaPrerequisito,T.IdModalVerificarCuenta,T.idModalImpresionHojaVida,T.idModalNuevoAnticipoRegularTodos,T.idModalTr3BancoMsc,T.idModalTr3BancoUnion,T.idModalHistorialTr3,T.IdModalVerificarCuentaRrhh,T.idModalConfirmarDesabilitacion,T.idModalReingresoEmpleado,T.idModalHistorialBeneficios,T.idModalConfiguracionRopaDeTrabajo,T.idModalReporteRopaDeTrabajo,T.idmodalWizardContainerConfiguracionRopaTrabajo,T.idModalRopaTrabajo,T.idModalNuevaRopaTrabajo,T.idModalItemsNuevaRopaTrabajo,T.idModalEliminarRopaTrabajo,T.idModalConceptoEdicion,T.idModalVisitaSalida,T.idModalDesabilitarPasajero,T.idModalCerrarRolDeTurno,T.idModalConductoresViaje,T.idModalHistorialGestionesVacaciones,T.idModalTipoImportacionRol),T.buscarAplicacion(T.usuario.aplicacionesUsuario,e.path().substring(1)),T.obtenerColumnasAplicacion(),M.stop()}),T.$on("$routeChangeStart",function(a,e){T.eliminarPopup(T.idModalEmpleado),T.eliminarPopup(T.idModalDepartamentoEstado),T.eliminarPopup(T.idModalProvincia),T.eliminarPopup(T.idModalLocalidad),T.eliminarPopup(T.idModalHojaVida),T.eliminarPopup(T.idModalNuevoFamiliar),T.eliminarPopup(T.idModalHistorialContrato),T.eliminarPopup(T.idModalBeneficiosSociales),T.eliminarPopup(T.idModalDetalleVacaciones),T.eliminarPopup(T.idModalBitacoraFicha),T.eliminarPopup(T.idModalAnticipoExtraordinario),T.eliminarPopup(T.idModalNuevoPrestamo),T.eliminarPopup(T.idModalAusenciasVacaciones),T.eliminarPopup(T.idModalTipoBaja),T.eliminarPopup(T.idModalFeriados),T.eliminarPopup(T.idModalHitorialVacaciones),T.eliminarPopup(T.idModalCompensacion),T.eliminarPopup(T.idModalHistorialAusencias),T.eliminarPopup(T.idModalHistorialAusenciaMedica),T.eliminarPopup(T.idModalTipoAusencia),T.eliminarPopup(T.idModalRolTurnos),T.eliminarPopup(T.idModalHistorialTurnos),T.eliminarPopup(T.idModalHorasExtras),T.eliminarPopup(T.idModalHistorialHorasExtras),T.eliminarPopup(T.idModalAnticipoRegular),T.eliminarPopup(T.idModalPrestamosPersonal),T.eliminarPopup(T.idModalAdvertencia),T.eliminarPopup(T.idModalPretamosNuevoTodos),T.eliminarPopup(T.idModalReporteHijos),T.eliminarPopup(T.idModalReporteVeneficios),T.eliminarPopup(T.idModalPagoPrestamo),T.eliminarPopup(T.idModalReporteVacaciones),T.eliminarPopup(T.idModalReporteBajasMedicas),T.eliminarPopup(T.idModalReporteRolTurnos),T.eliminarPopup(T.idModalReporteTurnosDetallado),T.eliminarPopup(T.idModalViajes),T.eliminarPopup(T.idModalVisita),T.eliminarPopup(T.idModalVehiculosViaje),T.eliminarPopup(T.idModalHistorialViajes),T.eliminarPopup(T.idModalReporteAusencias),T.eliminarPopup(T.idModalCertificado),T.eliminarPopup(T.idModalPrerequisitos),T.eliminarPopup(T.idModalRhNuevo),T.eliminarPopup(T.idModalWizardRhVista),T.eliminarPopup(T.idModalDialogPrerequisitoNuevo),T.eliminarPopup(T.idEliminarFamiliarEmpleado),T.eliminarPopup(T.idEliminarSeguroEmpleado),T.eliminarPopup(T.idModalHistorialPrerequisito),T.eliminarPopup(T.idModalEditarPrerequisito),T.eliminarPopup(T.idModalDialogConfirmacionEntregaAdelantado),T.eliminarPopup(T.IdEntregaPrerequisito),T.eliminarPopup(T.IdModalVerificarCuenta),T.eliminarPopup(T.idModalImpresionHojaVida),T.eliminarPopup(T.idModalNuevoAnticipoRegularTodos),T.eliminarPopup(T.idEliminarUsuarioRh),T.eliminarPopup(T.idModalTr3BancoMsc),T.eliminarPopup(T.idModalTr3BancoUnion),T.eliminarPopup(T.idModalHistorialTr3),T.eliminarPopup(T.IdModalVerificarCuentaRrhh),T.eliminarPopup(T.idModalConfirmarDesabilitacion),T.eliminarPopup(T.idModalReingresoEmpleado),T.eliminarPopup(T.idModalHistorialBeneficios),T.eliminarPopup(T.idModalConfiguracionRopaDeTrabajo),T.eliminarPopup(T.idModalReporteRopaDeTrabajo),T.eliminarPopup(T.idModalRopaTrabajo),T.eliminarPopup(T.idModalNuevaRopaTrabajo),T.eliminarPopup(T.idModalItemsNuevaRopaTrabajo),T.eliminarPopup(T.idModalEliminarRopaTrabajo),T.eliminarPopup(T.idModalConceptoEdicion),T.eliminarPopup(T.idModalVisitaSalida),T.eliminarPopup(T.idModalDesabilitarPasajero),T.eliminarPopup(T.idModalCerrarRolDeTurno),T.eliminarPopup(T.idModalConductoresViaje),T.eliminarPopup(T.idModalHistorialGestionesVacaciones)}),T.inicio=function(){T.localStorageSpace(),T.listYearsAnticipo=T.obtenerAnios(2017),T.obtenerGenero(),T.obtenerRecursosHumanos(),T.recuperarDatosTipo(),T.empleadosSeleccionados=[],T.listaBancos(),T.obtenerConfiguracionVacaciones(),T.obtenerTiposOtrosingresosYDeduccion(),T.obtenerMotivosRetiro(),T.buscarRopaTrabajo(),T.obtenerCuentasBancos(),T.buscarDepartamentoFiniquito(),T.obtenerGestiones(),T.obtenerChoferesViaje(),T.dynamicPopoverRopaTrabajo={templateUrl:"myPopoverRopaTrabajo.html"}},T.abrirDialogConceptoEdicion=function(a){T.tipo_edicion=a,T.clase={},T.abrirPopup(T.idModalConceptoEdicion)},T.cerrarDialogConceptoEdicion=function(){T.cerrarPopup(T.idModalConceptoEdicion)},T.abrirDialogCerrarRolDeTurno=function(){T.abrirPopup(T.idModalCerrarRolDeTurno)},T.cerrarDialogCerrarRolDeTurno=function(){T.cerrarPopup(T.idModalCerrarRolDeTurno)},T.abrirDialogConductoresViaje=function(){T.conductor={},T.abrirPopup(T.idModalConductoresViaje)},T.cerrarDialogConductoresViaje=function(){T.cerrarPopup(T.idModalConductoresViaje)},T.abrirDialogTipoImportacionRol=function(a){T.rolesTurno=a,T.tipoImportacionRol=!0,T.abrirPopup(T.idModalTipoImportacionRol)},T.cerrarDialogTipoImportacionRol=function(){T.cerrarPopup(T.idModalTipoImportacionRol)},T.abrirDialogHistorialGestionesVacaciones=function(){T.conductor={};T.obtenerHistorialEmpresaVacacionGestion({}),T.abrirPopup(T.idModalHistorialGestionesVacaciones)},T.cerrarDialogHistorialGestionesVacaciones=function(){T.cerrarPopup(T.idModalHistorialGestionesVacaciones)},T.obtenerColumnasAplicacion=function(){T.fieldViewer=s({crear:!0,id_empresa:T.usuario.id_empresa,configuracion:{codigo:{value:"Codigo",show:!0},nombre:{value:"Nombre",show:!0},empresa:{value:"Empresa",show:!0},imagen:{value:"Imagen",show:!0},ci:{value:"CI",show:!0},extension:{value:"Extension",show:!0},tipo_contrato:{value:"Tipo Contrato",show:!0},campo:{value:"Campo",show:!0},cargo:{value:"Cargo",show:!0}}},T.aplicacion.aplicacion.id),T.fieldViewer.updateObject()},T.abrirModalHistorialTr3=function(a,e){T.tipoBanco=e,da(T.usuario.id_empresa,a.nombre).then(function(a){T.historialTr3=a,T.abrirPopup(T.idModalHistorialTr3)}).catch(function(a){var e=void 0!==a.data&&null!==a.data?a.data:a.message;T.mostrarMensaje("Se produjo un error! > "+e),M.stop()})},T.abrirModalBeneficioSicial=function(){T.abrirPopup(T.idModalHistorialBeneficios)},T.obtenerbeneficiosSociales=function(i){T.quienqueniosDisponibles=!0,fa(T.empleado.id_ficha).then(function(a){T.listabeneficios=a,T.quinqueniosRealizados=T.listabeneficios.length;var e=5*T.quinqueniosRealizados,o=i.anios-e;T.añosRestantes=o,T.quienquenioRestante=Math.trunc(o/5),T.beneficio.tipo_beneficio||(0==T.quienquenioRestante?(T.quienquenioRestanteDisabled=!0,T.mostrarMensaje("No cuenta con mas quinquenios disponibles")):T.quienquenioRestanteDisabled=!1)})},T.cerrarModalBeneficioSicial=function(){T.cerrarPopup(T.idModalHistorialBeneficios)},T.cerrarModalHistorialTr3=function(){T.cerrarPopup(T.idModalHistorialTr3)},T.abrirModalConfiguracionRopaDeTrabajo=function(){T.listaRopasDeTrabajo=[],T.ropaTrabajo={},T.cargo="",T.abrirPopup(T.idModalConfiguracionRopaDeTrabajo)},T.cerrarModalConfiguracionRopaDeTrabajo=function(){T.cerrarPopup(T.idModalConfiguracionRopaDeTrabajo)},T.abrirModalReporteRopaDeTrabajo=function(a){T.abrirPopup(T.idModalReporteRopaDeTrabajo)},T.cerrarModalReporteRopaDeTrabajo=function(){T.cerrarPopup(T.idModalReporteRopaDeTrabajo)},T.abrirModalDesabilitarPasajero=function(a){"HABILITADO"==(T.empleado=a).estado.nombre?T.abrirPopup(T.idModalDesabilitarPasajero):a.habilitado=!1},T.cerrarModalDesabilitarPasajero=function(){T.cerrarPopup(T.idModalDesabilitarPasajero)},T.abrirModalRopaTrabajo=function(a){T.filtroropa={},a.activo&&(T.empleado=a,T.dynamicPopoverCargosRopaTrabajo={templateUrl:"myPopoverCargosRopa.html"},T.dynamicPopoverRopasRopaTrabajo={templateUrl:"myPopoverRopasRopa.html"},T.ObtenerDotacionesRopa(a),T.abrirPopup(T.idModalRopaTrabajo))},T.cerrarModalRopaTrabajo=function(){T.cerrarPopup(T.idModalRopaTrabajo)},T.abrirModalNuevaRopaTrabajo=function(a,e,o,i){if(T.filtroropa.inicio="",T.filtroropa.fin="",T.empleado=a,e?T.actualizarDotacion=!0:(T.actualizarDotacion=!1,T.verinformacionDOtacion=!1),null!=o?(T.verinformacionDOtacion=!0,T.indexInfo=o,console.log(T.listaDotaciones[T.indexInfo].ropas),T.visible=!1):null!=i&&(T.indexInfo=i,T.visible=!0,T.verinformacionDOtacion=!1),0<T.listaDotaciones.length){var t=new Date;if(new Date(T.listaDotaciones[T.listaDotaciones.length-1].fecha_vencimiento).getTime()>t.getTime()){T.obtenerCargosEmpleado(e,o,!1);T.dotacionRopa=T.listaDotaciones[T.listaDotaciones.length-1],T.sucursales.forEach(function(a,e,o){0==a.numero&&(T.dotacionRopa.sucursal=a),e===o.length-1&&T.obtenerAlmacenes(T.dotacionRopa.sucursal.id)}),T.dotacionRopa.almacen=T.listaDotaciones[T.listaDotaciones.length-1].almacen,T.dotacionRopa.almacen?T.editAlmacen=!0:T.editAlmacen=!1,T.abrirPopup(T.idModalNuevaRopaTrabajo)}else T.editAlmacen=!1,T.dotacionRopa={id_usuario:T.usuario.id},T.sucursales.forEach(function(a,e,o){0==a.numero&&(T.dotacionRopa.sucursal=a),e===o.length-1&&T.obtenerAlmacenes(T.dotacionRopa.sucursal.id)}),T.obtenerCargosEmpleado(e,o,!0),T.abrirPopup(T.idModalNuevaRopaTrabajo)}else T.editAlmacen=!1,T.empleado=a,T.dotacionRopa={id_usuario:T.usuario.id},T.sucursales.forEach(function(a,e,o){0==a.numero&&(T.dotacionRopa.sucursal=a),e===o.length-1&&T.obtenerAlmacenes(T.dotacionRopa.sucursal.id)}),T.obtenerCargosEmpleado(e,o,!1),T.abrirPopup(T.idModalNuevaRopaTrabajo)},T.cerrarModalNuevaRopaTrabajo=function(){T.ObtenerDotacionesRopa(T.empleado),T.cerrarPopup(T.idModalNuevaRopaTrabajo)},T.abrirModalItemsNuevaRopaTrabajo=function(){console.log(T.dotacionRopa.dotacionItems),T.obtenerListaRopaTrabajoProductos(),T.abrirPopup(T.idModalItemsNuevaRopaTrabajo)},T.cerrarModalItemsNuevaRopaTrabajo=function(){T.cerrarPopup(T.idModalItemsNuevaRopaTrabajo)},T.abrirModalTr3BancoMsc=function(){T.abrirPopup(T.idModalTr3BancoMsc)},T.cerrarModalTr3BancoMsc=function(){T.cerrarPopup(T.idModalTr3BancoMsc)},T.abrirModalTr3BancoUnion=function(){T.abrirPopup(T.idModalTr3BancoUnion)},T.cerrarModalTr3BancoUnion=function(){T.cerrarPopup(T.idModalTr3BancoUnion)},T.abrirModalbanco=function(a){T.tr3={anticipos:T.anticiposTr3,tipo:""},"Banco Mercantil Santa Cruz"==(T.datosBanco=a).nombre&&(T.tr3.tipo="MSC",T.abrirModalTr3BancoMsc()),"Banco Unión"==a.nombre&&(T.tr3.tipo="BU",T.abrirModalTr3BancoUnion())},T.abrirModalImprimirHojaVida=function(){T.filtroCap={inicio:"",fin:"",capacidadInterna:""},T.abrirPopup(T.idModalImpresionHojaVida)},T.cerrarModalImprimirHojaVida=function(){T.cerrarPopup(T.idModalImpresionHojaVida)},T.abrirDialogEditarPreRequisito=function(a){T.prerequisito=a,T.prerequisito.fecha_vencimiento_texto=T.fechaATexto(new Date),T.abrirPopup(T.idModalEditarPrerequisito)},T.cerrarDialogEditarPreRequisito=function(){T.cerrarPopup(T.idModalEditarPrerequisito)},T.abrirDialogPrerequisitoNuevo=function(){T.NuevoP=new f({puede_modificar_rrhh:!1}),T.abrirPopup(T.idModalDialogPrerequisitoNuevo)},T.cerrarDialogPrerequisitoNuevo=function(){T.cerrarPopup(T.idModalDialogPrerequisitoNuevo)},T.abrirDialogHistoricoPreRequisito=function(a,e){var o=0,i=0;T.preRequisito=a,T.paciente=e,j({id_pre:T.preRequisito.preRequisito.id,id_pac:T.paciente.id,inicio:o,fin:i}).then(function(a){T.historialPrerequisitosPaciente=a.historial,M.stop(),T.filtro.inicio=T.filtro.inicio instanceof Date?T.filtro.inicio.getDate()+"/"+(T.filtro.inicio.getMonth()+1)+"/"+T.filtro.inicio.getFullYear():"",T.filtro.fin=T.filtro.fin instanceof Date?T.filtro.fin.getDate()+"/"+(T.filtro.fin.getMonth()+1)+"/"+T.filtro.fin.getFullYear():""}),T.abrirPopup(T.idModalHistorialPrerequisito)},T.guardarEntregaPrerequisito=function(a){M.start(),null==a.fecha_entrega_texto||""==a.fecha_entrega_texto?T.mostrarMensaje("Ingrese la fecha de entrega."):(a.fecha_entrega=new Date(T.convertirFecha(a.fecha_entrega_texto)),a.asignado=!0,P.save(a,function(e){g(T.paciente.id,{inicio:0,fin:0}).then(function(a){T.prerequisitosPaciente=a.Prerequisitos,T.mostrarMensaje(e.mensaje),T.prerequisitosPaciente.forEach(function(a){null!=a.fecha_entrega&&(a.entregado=!0)}),T.cerrarPopUpEntregaPreRequisito(),M.stop()})},function(a){T.mostrarMensaje("Ocurrio un problema al guardar la fecha de entrega  de el prerequisito")}))},T.verificarFechaEntregaPrerequisito=function(a,e){T.preRequisito=a,T.preRequisito.fecha_entrega_texto=T.fechaATexto(new Date),T.paciente=void 0===e?a.pacientePrerequisito:e;var o=new Date(T.preRequisito.fecha_vencimiento).getTime(),i=(new Date).getTime();0<=Math.floor((i-o)/864e5)?T.abrirDialogEntregaPreRequisito(T.preRequisito,T.empleado):T.abrirPopup(T.idModalDialogConfirmacionEntregaAdelantado)},T.abrirDialogEntregaPreRequisito=function(a,e){T.cerrarConfirmacionEntragaAdelantadaPrerequisito(),T.preRequisito=a,T.preRequisito.fecha_entrega_texto=T.fechaATexto(new Date),T.paciente=e,T.abrirPopup(T.IdEntregaPrerequisito)},T.cerrarPopUpEntregaPreRequisito=function(){T.cerrarPopup(T.IdEntregaPrerequisito)},T.cerrarConfirmacionEntragaAdelantadaPrerequisito=function(){T.cerrarPopup(T.idModalDialogConfirmacionEntregaAdelantado)},T.filtrarHistorialPrerequisito=function(e){if(null!=e){var a=null===e.inicio||""===e.inicio||void 0===e.inicio?0:new Date(e.inicio),o=null===e.fin||""===e.fin||void 0===e.fin?0:new Date(e.fin),i=null===e.opcion||void 0===e.opcion?0:e.opcion;e={inicio:a,fin:o,opcion:i}}else e={inicio:0,fin:0};j({id_pre:T.preRequisito.preRequisito.id,id_pac:T.paciente.id,inicio:e.inicio,fin:e.fin}).then(function(a){T.historialPrerequisitosPaciente=a.historial,M.stop(),e.inicio=T.filtro.inicio instanceof Date?T.filtro.inicio.getDate()+"/"+(T.filtro.inicio.getMonth()+1)+"/"+T.filtro.inicio.getFullYear():"",e.fin=T.filtro.fin instanceof Date?T.filtro.fin.getDate()+"/"+(T.filtro.fin.getMonth()+1)+"/"+T.filtro.fin.getFullYear():""})},T.cerrarDialogHistoricoPreRequisito=function(){T.cerrarPopup(T.idModalHistorialPrerequisito)},T.abrirDialogVerEmpleado=function(a){promesaPaciente=p(a.id),promesaPaciente.then(function(a){null!=a.clase&&(a.medicoPaciente.tipo_contrato=a.clase),T.paciente=a.medicoPaciente,T.paciente.fecha_nacimiento_texto=T.fechaATexto(T.paciente.persona.fecha_nacimiento),T.seleccionarCargos(paciente.cargos),T.paciente.ver=!0}),T.abrirPopup(T.idModalWizardRhVista)},T.cerrarDialogVerEmpleado=function(){T.cerrarPopup(T.idModalWizardRhVista)},T.abrirDialogRhNuevo=function(){T.steps=[{cabeza:"cabeza-nuevo-datos-personales",cuerpo:"cuerpo-nuevo-datos-personales"},{cabeza:"cabeza-nuevo-datos-comple",cuerpo:"cuerpo-nuevo-datos-comple"},{cabeza:"cabeza-nuevo-datos-laborales",cuerpo:"cuerpo-nuevo-datos-laborales"}],T.nuevoRH=new n({persona:{imagen:"img/icon-user-default.png"},id_empresa:T.usuario.id_empresa,es_empleado:!0,activoCopiaCodigo:!0}),T.abrirPopup(T.idModalRhNuevo)},T.cerrarDialogRhNuevo=function(){T.cerrarPopup(T.idModalRhNuevo)},T.cerrarDialogEliminarUsuarioRh=function(){T.cerrarPopup(T.idEliminarUsuarioRh)},T.abrirDialogEliminarUsuarioRh=function(a){(T.empleado=a).activo&&T.abrirPopup(T.idEliminarUsuarioRh)},T.cerrarDialogEliminarSeguroEmpleado=function(){T.cerrarPopup(T.idEliminarSeguroEmpleado)},T.abrirDialogEliminarSeguroEmpleado=function(a,e){T.otroSeguro=a,T.otroSeguro.index=e,T.abrirPopup(T.idEliminarSeguroEmpleado)},T.cerrarDialogEliminarFamiliarEmpleado=function(){T.cerrarPopup(T.idEliminarFamiliarEmpleado)},T.abrirDialogEliminarFamiliarEmpleado=function(a,e){T.familiar=a,T.familiar.index=e,T.abrirPopup(T.idEliminarFamiliarEmpleado)},T.abrirIdModalDialogPreRequisitos=function(a){a.activo&&(T.empleado=a,T.verificarAsignacionPrerequisitos(),T.abrirPopup(T.idModalPrerequisitos))},T.cerrarIdModalDialogPreRequisitos=function(){T.cerrarPopup(T.idModalPrerequisitos)},T.abrirDialogEmpleado=function(a,e){null==T.primeroGuardarParaCerrar&&(T.primeroGuardarParaCerrar=!1),T.steps=[{cabeza:"stepDatosPersonales",cuerpo:"datos-personales"},{cabeza:"stepDatosLaborales",cuerpo:"ficha-datos-laborales"},{cabeza:"stepdatosAfiliacion",cuerpo:"ficha-seguros"},{cabeza:"stepDatosFamiliares",cuerpo:"ficha-familia"}],T.obtenerDatosFichaUsuario(a,e),(T.empleado=a).activo?T.nopuedoModificarFicha=!1:T.nopuedoModificarFicha=!0,T.abrirPopup(T.idModalEmpleado)},T.cerrarDialogEmpleado=function(a){0==T.primeroGuardarParaCerrar?(T.departamentos=[],T.provincias=[],T.localidades=[],T.obtenerCargos(),T.obtenerDiscapacidades(),T.cerrarPopup(T.idModalEmpleado)):T.mostrarMensaje("guardar nuevo reingreso para salir!")},T.abrirDialogDepartamentoEstado=function(){T.clase={pais:T.ficha.empleado.persona.pais},_("DEP").then(function(a){T.tipo_edicion2=a,T.abrirPopup(T.idModalDepartamentoEstado)})},T.cerrarDialogDepartamentoEstado=function(){T.cerrarPopup(T.idModalDepartamentoEstado)},T.abrirDialogProvincia=function(){T.clase={departamento:T.ficha.empleado.persona.ciudad},_("MUN").then(function(a){T.tipo_edicion2=a,T.abrirPopup(T.idModalProvincia)})},T.cerrarDialogProvincia=function(){T.cerrarPopup(T.idModalProvincia)},T.abrirDialogLocalidad=function(){T.clase={provincia:T.ficha.empleado.persona.provincia},_("LOC").then(function(a){T.tipo_edicion2=a,T.abrirPopup(T.idModalLocalidad)})},T.cerrarDialogLocalidad=function(){T.cerrarPopup(T.idModalLocalidad)},T.fechacontratos=[{name:"10/01/2000 - 01/01/2002"},{name:"10/01/2000 - 01/01/2002"},{name:"10/01/2000 - 01/01/2002"}],T.localLang={selectAll:"Marcar todo",selectNone:"No marcar ninguno",reset:"Deshacer todo",search:"Escriba aquí para busc$scope.idModalGradoar...",nothingSelected:"No se ha seleccionado nada"},T.abrirDialogHojaVida=function(a){T.empleado=a,T.empleado.activo=!a.eliminado,T.empleado.persona||(T.empleado.persona={nombre_completo:""},T.empleado.persona.nombre_completo=a.nombre_completo),C(a.id).then(function(a){a.hojaVida?(0<a.hojaVida.capacidades.length&&a.hojaVida.capacidades.forEach(function(a,e,o){a.fechaTexto=T.fechaATexto(a.fecha)}),0<a.hojaVida.logros.length&&a.hojaVida.logros.forEach(function(a,e,o){a.fechaTexto=T.fechaATexto(a.fecha)}),0<a.hojaVida.experienciasLaborales.length&&a.hojaVida.experienciasLaborales.forEach(function(a,e,o){a.fecha_inicioTexto=T.fechaATexto(a.fecha_inicio),a.fecha_finTexto=T.fechaATexto(a.fecha_fin)}),T.hojaVida=a.hojaVida):T.hojaVida={capacidades:[],logros:[],formacionesAcademicas:[],experienciasLaborales:[]}}),T.formacionAcademica={edit:!1,eliminado:!1},T.capacidad={edit:!1,eliminado:!1},T.logros={edit:!1,eliminado:!1},T.experienciaLaboral={edit:!1,eliminado:!1},T.abrirPopup(T.idModalHojaVida)},T.cerrarDialogHojaVida=function(){T.cerrarPopup(T.idModalHojaVida)},T.abrirDialogNuevoFamiliar=function(){T.abrirPopup(T.idModalNuevoFamiliar)},T.cerrarDialogNuevoFamiliar=function(){T.familiar&&(T.familiar={edit:!1}),T.cerrarPopup(T.idModalNuevoFamiliar)},T.abrirDialogHistorialContrato=function(){T.obtenerHistorialContratos(T.empleado),T.abrirPopup(T.idModalHistorialContrato)},T.cerrarDialogHistorialContrato=function(){T.cerrarPopup(T.idModalHistorialContrato)},T.abrirDialogBeneficiosSociales=function(a,e){if((T.empleado=a).fecha_inicio){if(e){T.beneficio=e;var o=null,i=new Date;T.beneficio.fecha_elaboracion=T.beneficio.fecha_elaboracion?T.fechaATexto(T.beneficio.fecha_elaboracion):T.fechaATexto(new Date),T.beneficio.fecha_asistensia&&(T.beneficio.fecha_asistensia=T.fechaATexto(T.beneficio.fecha_asistensia)),T.beneficio.fecha_ingreso=T.beneficio.fecha_ingreso?T.fechaATexto(T.beneficio.fecha_ingreso):T.fechaATexto(a.fecha_inicio),T.beneficio.fecha_retiro&&(T.beneficio.fecha_retiro=T.fechaATexto(T.beneficio.fecha_retiro));var t=!1;a.fecha_expiracion&&(o=T.fechaATexto(a.fecha_expiracion),i=new Date(a.fecha_expiracion),t=!0),e.cuenta&&(e.tipo_pago=!0),e.mes_uno=T.meses[e.mes_uno],e.mes_dos=T.meses[e.mes_dos],e.mes_tres=T.meses[e.mes_tres],e.totalAguinaldo=T.CalcularAguinaldoNavidad2(e);var n=new Date(a.fecha_inicio);T.tiempoTrabajado=duration(n,i);var r=T.fechaATexto(new Date);T.obtenerbeneficiosSociales(T.tiempoTrabajado),T.deduccion={},T.ingreso={},T.vacacion={sabado:!1,inicio_tipo:!1,fin_tipo:!1,aniosDisponibles:0,historial:null},T.beneficio.anios=0,T.beneficio.meses=0,T.beneficio.dias=0,T.beneficio.ingresos=[],T.beneficio.deducciones=[],T.beneficio.promedio=(T.beneficio.primer_mes+T.beneficio.segundo_mes+T.beneficio.tercer_mes)/3,T.beneficio.deduccionEingresos.forEach(function(a,e,o){"OTRING"==a.tipo.nombre_corto?T.beneficio.ingresos.push(a):T.beneficio.deducciones.push(a),e===o.length-1&&T.calcularDesaucio(T.beneficio,!0)})}else{o=null,i=new Date,t=!1;a.fecha_expiracion&&(o=T.fechaATexto(a.fecha_expiracion),i=new Date(a.fecha_expiracion),t=!0);n=new Date(a.fecha_inicio);T.tiempoTrabajado=duration(n,i);r=T.fechaATexto(new Date);T.beneficio={fecha_elaboracion:r,tipo_beneficio:t,anios:0,meses:0,dias:0,fecha_elaboracion:T.fechaATexto(new Date),fecha_ingreso:T.fechaATexto(a.fecha_inicio),fecha_retiro:o,ingresos:[],deducciones:[]},T.obtenerbeneficiosSociales(T.tiempoTrabajado),T.deduccion={},T.ingreso={},T.vacacion={sabado:!1,inicio_tipo:!1,fin_tipo:!1,aniosDisponibles:0,historial:null}}T.abrirPopup(T.idModalBeneficiosSociales)}else k(function(){T.$apply(function(){T.mostrarMensaje("No cuenta con ficha actualmente, crear ficha empleado!")})},200)},T.verVacaciones=function(){T.verVacacion=!T.verVacacion},T.abrirDialogBeneficiosSociales2=function(r,e){T.verVacacion=!1,ga(r.id_ficha).then(function(a){a.beneficio?a.beneficio.fecha_ingreso&&1!=e?T.abrirModalVerificarCuenta(r,"finiquito"):(T.obtenerHistorialGestionesVacacion(r,!1,!0),T.abrirDialogBeneficiosSociales(r,a.beneficio)):sa(r.id_ficha).then(function(e){var a=new Date;if(0<e.length)if(e[e.length-1].gestion<a.getFullYear()){var o=e[e.length-1].anio+1,i=0,t=a.getFullYear();o<=5?i=T.configuracionesVacacion[0].dias:o<=10?i=T.configuracionesVacacion[1].dias:10<o&&(i=T.configuracionesVacacion[2].dias);var n={gestion:t,anio:o,aplicadas:i,tomadas:0};ua(r.id_ficha,n).then(function(a){T.obtenerHistorialGestionesVacacion(r,!1,!0),T.abrirDialogBeneficiosSociales(r,e.beneficio)})}else T.obtenerHistorialGestionesVacacion(r,!1,!0),T.abrirDialogBeneficiosSociales(r,e.beneficio);else T.mostrarMensaje("No cuenta con ficha del empleado actualizada, actualizar ficha empleado")})})},T.cerrarDialogBeneficiosSociales=function(){T.cerrarPopup(T.idModalBeneficiosSociales)},T.abrirDialogDetalleVacaciones=function(){T.abrirPopup(T.idModalDetalleVacaciones)},T.cerrarDialogDetalleVacaciones=function(){T.cerrarPopup(T.idModalDetalleVacaciones)},T.abrirDialogBitacoraFicha=function(){ha(T.ficha.id).then(function(a){T.bitacoraCambios=a,T.abrirPopup(T.idModalBitacoraFicha)})},T.cerrarDialogBitacoraFicha=function(){T.cerrarPopup(T.idModalBitacoraFicha)},T.abrirDialogAnticipoExtraordinario=function(a){a.activo&&((T.empleado=a).haber_basico?(T.obtenerAnticiposExtra(a),T.abrirPopup(T.idModalAnticipoExtraordinario)):k(function(){T.$apply(function(){T.mostrarMensaje("No cuenta con haber basico actualizar ficha empleado!")})},200))},T.obtenerAnticiposExtra=function(a){var e=(new Date).getMonth();T.mesActual=e;var o=String((new Date).getFullYear());new Date;T.listaAnticipos=[],T.filtroAnticipo={mes:{id:e},gestion:o};var i=new Date,t={inicio:new Date(i.getFullYear(),i.getMonth(),1),fin:new Date(i.getFullYear(),i.getMonth()+1,0),nombre:"ORDI",id_empresa:0};T.anticipo_ordinaroOextra=0,T.obtenerListaAnticipos(t,a.id)},T.cerrarDialogAnticipoExtraordinario=function(){T.cerrarPopup(T.idModalAnticipoExtraordinario)},T.abrirDialogNuevoPrestamo=function(a){a.activo&&(T.empleado=a,T.prestamo={},a.haber_basico?T.abrirPopup(T.idModalNuevoPrestamo):k(function(){T.$apply(function(){T.mostrarMensaje("No cuenta con haber basico actualizar ficha empleado!")})},200))},T.cerrarDialogNuevoPrestamo=function(){T.cerrarPopup(T.idModalNuevoPrestamo)},T.abrirDialogAusenciasVacaciones=function(a){T.empleado=a,T.ausencia={primera_baja:!1},T.otraAusencia={},T.vacacion={sabado:!1,inicio_tipo:!1,fin_tipo:!1,aniosDisponibles:0,historial:null},T.feriados=[],T.listaFeriado(),T.obtenerHistorialGestionesVacacion(a,!0)},T.abriirmodelAusenciasVacas=function(r){r.activo&&(r.fecha_inicio?sa(r.id_ficha).then(function(a){var e=new Date;if(a[a.length-1].gestion<e.getFullYear()){var o=a[a.length-1].anio+1,i=0,t=e.getFullYear();o<=5?i=T.configuracionesVacacion[0].dias:o<=10?i=T.configuracionesVacacion[1].dias:10<o&&(i=T.configuracionesVacacion[2].dias);var n={gestion:t,anio:o,aplicadas:i,tomadas:0};ua(r.id_ficha,n).then(function(a){T.abrirDialogAusenciasVacaciones(r)})}else T.abrirDialogAusenciasVacaciones(r)}):k(function(){T.$apply(function(){T.mostrarMensaje("No cuenta con ficha actualmente, crear ficha empleado!")})},200))},T.cerrarDialogAusenciasVacaciones=function(){T.cerrarPopup(T.idModalAusenciasVacaciones)},T.abrirDialogTipoBaja=function(a){T.clase={},a.ausencias?T.tiposAusencia=a.ausencias:T.tipoAusencia=[],T.abrirPopup(T.idModalTipoBaja)},T.cerrarDialogTipoBaja=function(){T.cerrarPopup(T.idModalTipoBaja)},T.GuardarFeriadosCalendario=function(){var a=T.calendar.fullCalendar("clientEvents"),i=[];0<a.length?a.forEach(function(a,e,o){if(null==a.id){a={start:a.start._d,end:a.end._d};i.push(a)}e===o.length-1&&oa(T.usuario.id_empresa,i,T.feriadosEliminados).then(function(a){T.listaFeriado(),T.feriadosEliminados=[],T.cerrarDialogFeriados(),T.mostrarMensaje(a.mensaje)})}):oa(T.usuario.id_empresa,i,T.feriadosEliminados).then(function(a){T.listaFeriado(),T.feriadosEliminados=[],T.cerrarDialogFeriados(),T.mostrarMensaje(a.mensaje)})},T.agregarFeriado=function(a,e,o){T.calendar.fullCalendar("renderEvent",{title:"Feriado",start:a,end:e,allDay:o,className:"label-info"},!0),T.calendar.fullCalendar("unselect")},T.obtenerFechasCalendarioFeriado=function(){$("#calendar").fullCalendar("removeEvents");var t=[];T.FeriadosCalendario.forEach(function(a,e,o){var i={id:a.id,title:"Feriado",start:a.fecha_inicio,end:a.fecha_fin,className:"label-info"};t.push(i),e===o.length-1&&T.addEvents(t)},this)},T.listaFeriado=function(){T.ListaDiasFeriado=[],promesa=ia(T.usuario.id_empresa),promesa.then(function(a){a.forEach(function(a,e,o){var i=getDates(new Date(a.fecha_inicio),new Date(a.fecha_fin));T.ListaDiasFeriado.push.apply(T.ListaDiasFeriado,i)}),T.FeriadosCalendario=a})},T.addEvents=function(a){T.calendar.fullCalendar("addEventSource",a)},T.calendar=$("#calendar").fullCalendar({buttonHtml:{prev:'<i class="ace-icon fa fa-chevron-left"></i>',next:'<i class="ace-icon fa fa-chevron-right"></i>'},height:400,header:{left:"prev,next today",center:"title",right:"month,agendaWeek, agendaDay"},events:[],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],buttonText:{today:"hoy",month:"mes",week:"semana",day:"día",list:"lista"},editable:!0,selectable:!0,select:function(i,t,n){var a=T.calendar.fullCalendar("clientEvents"),r=!0;0<a.length?a.forEach(function(a,e,o){T.fechaATexto(a.start._d)==T.fechaATexto(i._d)&&(r=!1),e===o.length-1&&r&&T.agregarFeriado(i,t,n)}):T.agregarFeriado(i,t,n)},eventClick:function(e,a,o){if(null!=e.id){var i={id:e.id};T.feriadosEliminados.push(i),T.calendar.fullCalendar("removeEvents",function(a){return a._id==e._id})}else T.calendar.fullCalendar("removeEvents",function(a){return a._id==e._id})}}),T.abrirDialogFeriados=function(){T.abrirPopup(T.idModalFeriados),T.feriadosEliminados=[],$("#calendar").fullCalendar("render"),T.obtenerFechasCalendarioFeriado()},T.cerrarDialogFeriados=function(){T.cerrarPopup(T.idModalFeriados)},T.abrirDialogHitorialVacaciones=function(){T.obtenerHistorialEmpleadVacacion({}),T.abrirPopup(T.idModalHitorialVacaciones)},T.cerrarDialogHitorialVacaciones=function(){T.cerrarPopup(T.idModalHitorialVacaciones)};var ka=new Date,Ua=(ka.getDate(),ka.getMonth()),Ga=ka.getFullYear();T.selectionday=[],T.totalHoras=moment("00:00","HH:mm"),T.calendarCompensacion=$("#calendar-compensacion").fullCalendar({buttonHtml:{prev:'<i class="ace-icon fa fa-chevron-left"></i>',next:'<i class="ace-icon fa fa-chevron-right"></i>'},height:400,defaultView:"agendaWeek",allDaySlot:!1,header:{left:"prev,next today",center:"title",right:"month,agendaWeek, agendaDay"},events:[{title:"Feriado",start:new Date(Ga,Ua,1),className:"label-important"}],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],buttonText:{today:"hoy",month:"mes",week:"semana",day:"día",list:"lista"},editable:!0,selectable:!0,select:function(a,e){T.horas=moment.utc(moment(e,"DD/MM/YYYY HH:mm:ss").diff(moment(a,"DD/MM/YYYY HH:mm:ss"))).format("HH:mm:ss"),T.Event=T.calendarCompensacion.fullCalendar("renderEvent",{start:a,end:e,className:"label-info"},!0),T.selectionday.push({_id:T.Event[0]._id,fecha_real:a,fecha:a.format("DD-MM-YYYY"),hora_inicio:a.format("HH:mm:ss"),hora_fin:e.format("HH:mm:ss"),total:T.horas}),T.sumarTotalHoras(),T.$apply(),T.calendarCompensacion.fullCalendar("unselect")},eventResize:function(a,e,o){var i=a.end,t=a.start,n=a._id;T.horas=moment.utc(moment(i,"DD/MM/YYYY HH:mm:ss").diff(moment(t,"DD/MM/YYYY HH:mm:ss"))).format("HH:mm"),function(a,e){for(var o=0;o<T.selectionday.length;o++)if(T.selectionday[o]._id==a){T.selectionday[o].hora_fin=e,T.selectionday[o].total=T.horas;break}}(n,i.format("HH:mm")),T.sumarTotalHoras(),T.$apply()},eventDrop:function(a,e,o){var i=a.start,t=a.end;T.horas=moment.utc(moment(t,"DD/MM/YYYY HH:mm:ss").diff(moment(i,"DD/MM/YYYY HH:mm:ss"))).format("HH:mm"),function(a,e,o){for(var i=0;i<T.selectionday.length;i++)if(T.selectionday[i]._id==a){T.selectionday[i].fecha=e.format("DD-MM-YYYY"),T.selectionday[i].hora_inicio=e.format("HH:mm"),T.selectionday[i].hora_fin=o.format("HH:mm"),T.selectionday[i].total=T.horas;break}}(a._id,i,t),T.sumarTotalHoras(),T.$apply()},eventClick:function(e,a,o){var i='<div class="modal fade modal-delete">\t\t\t  <div class="modal-dialog">\t\t\t   <div class="modal-content">\t\t\t\t <div class="modal-body">\t\t\t\t   <button type="button" class="close" data-dismiss="modal" style="margin-top:-10px;">&times;</button>\t\t\t\t   <form class="no-margin">\t\t\t\t\t  <label> Eliminar '+e.title+' &nbsp;</label>\t\t\t\t   </form>\t\t\t\t </div>\t\t\t\t <div class="modal-footer">\t\t\t\t\t<button type="button" class="btn btn-sm btn-danger" data-action="delete"><i class="ace-icon fa fa-trash-o"></i>Eliminar</button>\t\t\t\t\t<button type="button" class="btn btn-sm" data-dismiss="modal"><i class="ace-icon fa fa-times"></i> Cancel</button>\t\t\t\t </div>\t\t\t  </div>\t\t\t </div>\t\t\t</div>';(i=$(i).appendTo("body")).find("button[data-action=delete]").on("click",function(){T.calendarCompensacion.fullCalendar("removeEvents",function(a){return a._id==e._id}),T.selectionday.splice(e._id,1),T.$apply(),i.modal("hide")}),i.modal("show").on("hidden",function(){i.remove()})}}),T.sumarTotalHoras=function(){for(var a="",e=0,o=0,i=0;i<T.selectionday.length;i++){var t=T.selectionday[i].total.split(":")[1],n=T.selectionday[i].total.split(":")[0];e+=parseInt(n),60<=(o+=parseInt(t))&&(o-=60,e+=1),a=String("0"+e).slice(-2)+":"+String("0"+o).slice(-2)+":00"}T.SumaTotalHoras=a},T.abrirDialogCompensacion=function(){T.abrirPopup(T.idModalCompensacion),$("#calendar-compensacion").fullCalendar("render")},T.cerrarDialogCompensacion=function(){T.cerrarPopup(T.idModalCompensacion)},T.abrirDialogHistorialAusencias=function(){T.filtroOtrasAusencias={},T.obtenerHistorialEmpleadoOtrasAusencias({inicio:0,fin:0,tipo_ausencia:0}),T.abrirPopup(T.idModalHistorialAusencias)},T.cerrarDialogHistorialAusencias=function(){T.cerrarPopup(T.idModalHistorialAusencias)},T.abrirDialogHistorialAusenciaMedica=function(){T.filtroAusencias={},T.obtenerHistorialEmpleadoAusenciasMedicas({inicio:0,fin:0,tipo_ausencia:0}),T.abrirPopup(T.idModalHistorialAusenciaMedica)},T.cerrarDialogHistorialAusenciaMedica=function(){T.cerrarPopup(T.idModalHistorialAusenciaMedica)},T.abrirDialogTipoAusencia=function(a){T.tiposOtras=a.ausencias,T.clase={},T.abrirPopup(T.idModalTipoAusencia)},T.cerrarDialogTipoAusencia=function(){T.cerrarPopup(T.idModalTipoAusencia)},T.abrirDialogRolTurnos=function(i){if(i.activo)if(T.obtenerlistaRolTurno(i.id_ficha),i.fecha_inicio){T.empleado=i;var t={};T.centrosDeCostos.forEach(function(a,e,o){a.nombre==i.campamento&&(t=a),e===o.length-1&&(T.rolTurno={campo:t,tipo:!1,fecha_fin:"",dias_trabajo:null,dias_descanso:null,grupo:"",id_ficha:null},T.abrirPopup(T.idModalRolTurnos))})}else k(function(){T.$apply(function(){T.mostrarMensaje("No cuenta con ficha actualmente, crear ficha empleado!")})},200)},T.cerrarDialogRolTurnos=function(){T.cerrarPopup(T.idModalRolTurnos)},T.abrirDialogHistorialTurnos=function(a){T.obtenerlistaRolTurno(a.id_ficha),T.abrirPopup(T.idModalHistorialTurnos)},T.cerrarDialogHistorialTurnos=function(){T.cerrarPopup(T.idModalHistorialTurnos)},T.abrirDialogHorasExtras=function(a){if(a.activo)if(a.fecha_inicio){T.empleado=a;var e=new Date;T.horaExtra={fecha:T.fechaATexto(e)},T.abrirPopup(T.idModalHorasExtras)}else k(function(){T.$apply(function(){T.mostrarMensaje("No cuenta con ficha actualmente, crear ficha empleado!")})},200)},T.cerrarDialogHorasExtras=function(){T.cerrarPopup(T.idModalHorasExtras)},T.abrirDialogHistorialHorasExtras=function(){T.obtenerHistorialHorasExtra({inicio:"",fin:""}),T.abrirPopup(T.idModalHistorialHorasExtras)},T.cerrarDialogHistorialHorasExtras=function(){T.cerrarPopup(T.idModalHistorialHorasExtras)},T.abrirDialogAnticipoRegular=function(){T.obteneranticiposOrdi(),T.dynamicPopovertr3={templateUrl:"myPopoverTr3.html"},T.obtenerDepartamentos(),T.abrirPopup(T.idModalAnticipoRegular)},T.obteneranticiposOrdi=function(){var n=(new Date).getMonth(),r=String((new Date).getFullYear());new Date;T.listaAnticipos=[],T.meses.forEach(function(a,e,o){if(a.id==n&&(n=a),e===o.length-1){T.filtroAnticipo={mes:n,gestion:r};var i=new Date,t={inicio:new Date(i.getFullYear(),i.getMonth(),1),fin:new Date(i.getFullYear(),i.getMonth()+1,0),nombre:"EXTRAORDI",id_empresa:T.usuario.id_empresa};T.anticipo_extraordinaro=0,T.obtenerListaAnticiposOrdi(t,0)}})},T.cerrarDialogAnticipoRegular=function(){T.listaAnticipos2=[],T.cerrarPopup(T.idModalAnticipoRegular)},T.abrirDialogPrestamosPersonal=function(){T.obtenerPrestamos(),T.abrirPopup(T.idModalPrestamosPersonal)},T.optenerListaPrestamos=function(){V(T.paginator).then(function(t){T.paginator.setPages(t.paginas),0<t.prestamos.length?t.prestamos.forEach(function(a,e,o){var i=T.fechaATexto(a.fecha_inicial);a.fecha_vence=editar_fecha(i,a.plazo,"m","/"),a.saldo=a.monto,a.pago=0,T.prestamos={total_montos:0,pagos_acuenta:0,saldo:0},e===o.length-1&&t.prestamos.forEach(function(a,e,o){0<a.prestamoPagos.length?(a.prestamoPagos[a.prestamoPagos.length-1].saldo_anterior==a.total&&(a.pagadoTotal=!0),a.pagadoTotal=!1,T.prestamos.total_montos+=a.monto,T.prestamos.pagos_acuenta+=a.prestamoPagos[a.prestamoPagos.length-1].a_cuenta_anterior,T.prestamos.saldo+=a.total-a.prestamoPagos[a.prestamoPagos.length-1].a_cuenta_anterior):(a.pagadoTotal=!1,T.prestamos.total_montos+=a.monto,T.prestamos.pagos_acuenta+=0,T.prestamos.saldo+=a.total),e===o.length-1&&(T.listaPrestamos=t.prestamos)}),a.montoEdit=!1}):(T.listaPrestamos={},T.prestamos={})})},T.copiarCodigodeCi=function(a){a.activoCopiaCodigo?a.codigo=a.persona.ci:a.codigo=""},T.obtenerPrestamos=function(){M.start(),T.paginator=c(),T.paginator.column="id",T.paginator.direccion="asc",T.filtro={empresa:T.usuario.id_empresa,plazo:"",inicio:"",fin:"",nombre:"",apellido:"",cuentas_liquidas:!1},T.paginator.callBack=T.optenerListaPrestamos,T.paginator.getSearch("",T.filtro,null),M.stop()},T.borrarFechas=function(a){a.fin="",a.inicio="",T.paginator.getSearch("",T.filtro,null)},T.cerrarDialogPrestamosPersonal=function(){T.cerrarPopup(T.idModalPrestamosPersonal)},T.abrirDialogNuevoAnticipoRegularTodos=function(){T.listaAnticipos2=[],T.cerrarDialogAdvertencia(),T.obtenerListaEmpleados(),T.abrirPopup(T.idModalNuevoAnticipoRegularTodos)},T.cerrarDialogNuevoAnticipoRegularTodos=function(){T.cerrarPopup(T.idModalNuevoAnticipoRegularTodos)},T.abrirDialogAdvertencia=function(a){T.abrirModalAdvertencia=a,T.abrirPopup(T.idModalAdvertencia)},T.abrirDialogAdvertenciaPrestamo=function(){T.mensajeAdvertencia={texto1:"Los prestamos y las condiciones se realizarán para todos los trabajadores seleccionados.",texto2:"Para prestamos personalizados use la opción directamente en la fila del empleado."},T.abrirDialogAdvertencia(T.abrirDialogPretamosNuevoTodos)},T.abrirDialogAdvertenciaAnticipo=function(){T.anticipo={tipo:!1,tope:null,monto:null},T.mensajeAdvertencia={texto1:"Los anticipos y las condiciones se realizarán para todos los trabajadores seleccionados.",texto2:"Para anticipos personalizados use la opción directamente en la fila del empleado."},T.abrirDialogAdvertencia(T.abrirDialogNuevoAnticipoRegularTodos)},T.cerrarDialogAdvertencia=function(){T.cerrarPopup(T.idModalAdvertencia)},T.abrirDialogPretamosNuevoTodos=function(){T.cerrarDialogAdvertencia(),T.obtenerListaEmpleados(),T.abrirPopup(T.idModalPretamosNuevoTodos)},T.cerrarDialogPretamosNuevoTodos=function(){T.cerrarPopup(T.idModalPretamosNuevoTodos)},T.abrirDialogReporteHijos=function(){T.abrirPopup(T.idModalReporteHijos)},T.cerrarDialogReporteHijos=function(){T.cerrarPopup(T.idModalReporteHijos)},T.abrirDialogReporteVeneficios=function(){T.obtenerbeneficiosSocialesEmpresa(),T.empleado=void 0,T.abrirPopup(T.idModalReporteVeneficios)},T.cerrarDialogReporteVeneficios=function(){T.obtenerRecursosHumanos(),T.cerrarPopup(T.idModalReporteVeneficios)},T.abrirDialogPagoPrestamo=function(a){T.prestamo=a;var e=new Date;0<T.prestamo.prestamoPagos.length&&(a.saldo=T.prestamo.prestamoPagos[a.prestamoPagos.length-1].saldo_anterior,a.total=a.monto*a.interes_pactado/100+a.monto);var o=new Date(T.convertirFecha(a.fecha_vence)),i=moment(e).format("YYYY-MM-DD HH:mm:ss"),t=moment(o).format("YYYY-MM-DD HH:mm:ss"),n=moment(i,"YYYY-MM-DD HH:mm:ss"),r=moment(t,"YYYY-MM-DD HH:mm:ss");T.prestamo.plazo_restante=Math.round(r.diff(n,"months",!0)),T.abrirPopup(T.idModalPagoPrestamo)},T.cerrarDialogPagoPrestamo=function(){T.cerrarPopup(T.idModalPagoPrestamo)},T.abrirDialogReporteVacaciones=function(){T.filtroVacacion={},T.obtenerHistorialEmpresaVacacion(T.filtroVacacion),T.abrirPopup(T.idModalReporteVacaciones)},T.cerrarDialogReporteVacaciones=function(){T.cerrarPopup(T.idModalReporteVacaciones)},T.abrirDialogReporteBajasMedicas=function(){T.filtroAusencias={},T.obtenerHistorialEmpresaAusenciasMedicas({inicio:0,fin:0,tipo_ausencia:0}),T.abrirPopup(T.idModalReporteBajasMedicas)},T.cerrarDialogReporteBajasMedicas=function(){T.cerrarPopup(T.idModalReporteBajasMedicas)},T.abrirDialogReporteRolTurnos=function(){T.paginator=c(),T.paginator.column="id",T.paginator.direccion="asc",T.filtroRol={empresa:T.usuario.id_empresa,inicio:"",fin:"",grupo:"",campo:""},T.paginator.callBack=T.obtenerlistaRolTurnoEmpresa,T.paginator.getSearch("",T.filtroRol,null),T.abrirPopup(T.idModalReporteRolTurnos)},T.cerrarDialogReporteRolTurnos=function(){T.cerrarPopup(T.idModalReporteRolTurnos)},T.abrirDialogReporteTurnosDetallado=function(){T.obtenerlistaRolTurnoCal(),T.abrirPopup(T.idModalReporteTurnosDetallado)},T.cambiarFecha=function(a){},T.formatofecha=function(a){var e=a.split("/");return e[2]+"/"+e[1]+"/"+e[0]},T.cerrarDialogReporteTurnosDetallado=function(){T.obtenerRecursosHumanos(),T.cerrarPopup(T.idModalReporteTurnosDetallado)},T.abrirDialogViajes=function(){T.viaje={empleadosEntrada:[],empleadosSalida:[]},T.obtenerlistaRolTurno(0),T.obtenerChoferesViaje(),T.abrirPopup(T.idModalViajes)},T.cerrarDialogViajes=function(){T.cerrarPopup(T.idModalViajes)},T.abrirDialogVisita=function(){T.visita={persona:{nombres:"",apellido_paterno:"",apellido_materno:"",ci:null,expedido:null},visita:!0,estado:{}};for(var a=0;a<T.tiposPasajerosViaje.length;a++){var e=T.tiposPasajerosViaje[a];"VISITA"==e.nombre&&(T.visita.estado=e)}T.abrirPopup(T.idModalVisita)},T.cerrarDialogVisita=function(){T.cerrarPopup(T.idModalVisita)},T.abrirDialogVisitaSalida=function(){T.visita={persona:{nombres:"",apellido_paterno:"",apellido_materno:"",ci:null,expedido:null},visita:!0,estado:{}};for(var a=0;a<T.tiposPasajerosViaje.length;a++){var e=T.tiposPasajerosViaje[a];"VISITA"==e.nombre&&(T.visita.estado=e)}T.abrirPopup(T.idModalVisitaSalida)},T.cerrarDialogVisitaSalida=function(){T.cerrarPopup(T.idModalVisitaSalida)},T.eliminarPopup,T.agregarvisitaEntrada=function(i){T.tiposViaje.clases.forEach(function(a,e,o){"INGRESO"==a.nombre&&(i.tipoViaje=a),e==o.length-1&&(i.persona.nombre_completo=i.persona.nombres,""!=i.persona.apellido_paterno&&(i.persona.nombre_completo+=" "+i.persona.nombre_completo),""!=i.persona.apellido_materno&&(i.persona.nombre_completo+=" "+i.persona.apellido_materno),i.habilitado=!0,i.esVisita=!0,T.viaje.empleadosEntrada.push(i))}),scope.cerrarDialogVisita()},T.agregarvisitaSalida=function(i){T.tiposViaje.clases.forEach(function(a,e,o){"SALIDA"==a.nombre&&(i.tipoViaje=a),e==o.length-1&&(i.persona.nombre_completo=i.persona.nombres,""!=i.persona.apellido_paterno&&(i.persona.nombre_completo+=" "+i.persona.nombre_completo),""!=i.persona.apellido_materno&&(i.persona.nombre_completo+=" "+i.persona.apellido_materno),i.habilitado=!0,i.esVisita=!0,T.viaje.empleadosSalida.push(i))}),T.cerrarDialogVisitaSalida()},T.abrirDialogVehiculosViaje=function(a){T.clase={habilitado:!0},T.tipo_edicion=a,T.abrirPopup(T.idModalVehiculosViaje)},T.agregarVehiculo=function(a){a.nombre=a.vehiculo+"-"+a.placa,a.nombre&&a.nombre_corto&&(-1==T.tipo_edicion.clases.indexOf(a)&&T.tipo_edicion.clases.push(a),T.clase={habilitado:!0})},T.cerrarDialogVehiculosViaje=function(){T.cerrarPopup(T.idModalVehiculosViaje)},T.abrirDialogHistorialViajes=function(){T.obtenerViajesPasajeros(),T.VerViajes=!1,T.abrirPopup(T.idModalHistorialViajes)},T.verBusesViaje=function(){T.obtenerViajes(),T.VerViajes=!0,setTimeout(function(){aplicarDatePickers()},400)},T.verPasajerosViajes=function(){T.obtenerViajesPasajeros(),T.VerViajes=!1,setTimeout(function(){aplicarDatePickers()},400)},T.cerrarDialogHistorialViajes=function(){T.obtenerRecursosHumanos(),T.cerrarPopup(T.idModalHistorialViajes)},T.abrirDialogReporteAusencias=function(){T.filtroOtrasAusencias={},T.obtenerHistorialEmpresaOtrasAusencias({inicio:0,fin:0,tipo_ausencia:0}),T.abrirPopup(T.idModalReporteAusencias)},T.cerrarDialogReporteAusencias=function(){T.cerrarPopup(T.idModalReporteAusencias)},T.abrirDialogCertificado=function(){T.abrirPopup(T.idModalCertificado)},T.cerrarDialogCertificado=function(){T.cerrarPopup(T.idModalCertificado)},T.button_clicked=!1,T.disableImput=function(a){T.button_clicked=!a},T.obtenerGenero=function(){M.start(),T.generos=[],t().then(function(a){a.forEach(function(a){T.generos.push(a)},this),M.stop()})},T.abrirDialogPrerequisitoEditar=function(a){T.NuevoP=new f({id:a.id,nombre:a.nombre,observacion:a.observacion,vencimiento_mes:a.vencimiento_mes,dias_activacion:a.dias_activacion,puede_modificar_rrhh:a.puede_modificar_rrhh}),T.abrirPopup(T.idModalDialogPrerequisitoNuevo)},T.cerrarPopupPrerequisitoNuevo=function(){T.obtenerAlertas(),T.cerrarPopup(T.idModalDialogPrerequisitoNuevo)},T.saveForm=function(){T.nuevoRH.imagen;T.nuevoRH.fechaFicha=new Date,"Siguiente"!=$("#siguiente").text().trim()&&(M.start(),T.nuevoRH.id?(T.nuevoRH.persona.fecha_nacimiento=new Date(T.convertirFecha(T.nuevoRH.persona.fecha_nacimiento)),n.update({id_usuario:T.nuevoRH.id},T.nuevoRH,function(a){M.stop(),T.cerrarDialogRhNuevo(),T.mostrarMensaje("Actualizado Exitosamente!"),T.recargarItemsTabla()})):(T.nuevoRH.persona.fecha_nacimiento=new Date(T.convertirFecha(T.nuevoRH.persona.fecha_nacimiento)),T.nuevoRH.$save({id_usuario:0},function(a){M.stop(),T.cerrarDialogRhNuevo(),T.mostrarMensaje("Guardado Exitosamente!"),T.recargarItemsTabla()},function(a){M.stop(),T.cerrarDialogRhNuevo(),T.mostrarMensaje("Ocurrio un problema al momento de guardar!"),T.recargarItemsTabla()})))},T.obtenerRecursosHumanos=function(){M.start(),T.paginator=c(),T.paginator.column="id",T.paginator.direccion="asc",T.dynamicPopoverCargos={templateUrl:"myPopoverTemplate.html"},T.filtro={empresa:T.usuario.id_empresa,codigo:"",nombres:"",ci:"",campo:"",cargo:"",busquedaEmpresa:"",estado:"",grupo_sanguineo:""},T.paginator.callBack=T.buscarRecursosHumanos,T.paginator.getSearch("",T.filtro,null),M.stop()},T.buscarRecursosHumanos=function(e,a,o,i){M.start(),r(T.paginator).then(function(a){T.paginator.setPages(a.paginas),T.RecursosHumanosEmpleados=a.pacientes,T.RecursosHumanosEmpleados.forEach(function(a){a.activo=0==a.activo}),e&&o&&T.RecursosHumanosEmpleados.forEach(function(a,e,o){0==i?(a.select=!1,T.empleadosSeleccionados=[]):(a.select=!0,T.empleadosSeleccionados.push(a))}),M.stop()})},T.subirExcelPacientes=function(a){M.start();var e,o,i=a.target.files;for(o=i[e=0];e!=i.length;++e){var t=new FileReader;o.name;t.onload=function(a){var e=a.target.result,o=XLSX.read(e,{type:"binary"}),i=o.SheetNames[0],t=2,n=o.Sheets[i],r=[];do{var c={personaReferencia:{}};c.codigo=null!=n["A"+t]&&""!=n["A"+t]?n["A"+t].v.toString():null,c.apellido_paterno=null!=n["B"+t]&&""!=n["B"+t]?n["B"+t].v.toString():null,c.apellido_materno=null!=n["C"+t]&&""!=n["C"+t]?n["C"+t].v.toString():null,c.nombres=null!=n["D"+t]&&""!=n["D"+t]?n["D"+t].v.toString():null,c.segundo_nombre=null!=n["E"+t]&&""!=n["E"+t]?n["E"+t].v.toString():null,c.ci=null!=n["F"+t]&&""!=n["F"+t]?n["F"+t].v.toString():null,c.extension=null!=n["G"+t]&&""!=n["G"+t]?n["G"+t].v.toString():null,c.contrato=null!=n["H"+t]&&""!=n["H"+t]?n["H"+t].v.toString():null,c.fecha_nacimiento=null!=n["I"+t]&&""!=n["I"+t]?T.fecha_excel_angular(n["I"+t].v.toString()):null,c.genero=null!=n["J"+t]&&""!=n["J"+t]?n["J"+t].v.toString():null,c.telefono=null!=n["K"+t]&&""!=n["K"+t]?n["K"+t].v.toString():null,c.telefono2=null!=n["L"+t]&&""!=n["L"+t]?n["L"+t].v.toString():null,c.telefono_movil=null!=n["M"+t]&&""!=n["M"+t]?n["M"+t].v.toString():null,c.estilo_de_vida=null!=n["N"+t]&&""!=n["N"+t]?n["N"+t].v.toString():null,c.cargo=null!=n["O"+t]&&""!=n["O"+t]?n["O"+t].v.toString():null,c.designacion_empresa=null!=n["P"+t]&&""!=n["P"+t]?n["P"+t].v.toString():null,c.telefono_empresa=null!=n["Q"+t]&&""!=n["Q"+t]?n["Q"+t].v.toString():null,c.campamento=null!=n["R"+t]&&""!=n["R"+t]?n["R"+t].v.toString():null,c.riesgos_procesos_trabajo=null!=n["S"+t]&&""!=n["S"+t]?n["S"+t].v.toString():null,c.personaReferencia.ciudad_referencia=null!=n["T"+t]&&""!=n["T"+t]?n["T"+t].v.toString():null,c.personaReferencia.zona_referencia=null!=n["U"+t]&&""!=n["U"+t]?n["U"+t].v.toString():null,c.personaReferencia.calle_av_referencia=null!=n["V"+t]&&""!=n["V"+t]?n["V"+t].v.toString():null,c.personaReferencia.nro_referencia=null!=n["W"+t]&&""!=n["W"+t]?n["W"+t].v.toString():null,c.personaReferencia.telefonos_referencia=null!=n["X"+t]&&""!=n["X"+t]?n["X"+t].v.toString():null,c.personaReferencia.celular_referencia=null!=n["Y"+t]&&""!=n["Y"+t]?n["Y"+t].v.toString():null,c.personaReferencia.nombre_referencia=null!=n["Z"+t]&&""!=n["Z"+t]?n["Z"+t].v.toString():null,c.fecha_inicio=null!=n["AA"+t]&&""!=n["AA"+t]?T.fecha_excel_angular(n["AA"+t].v.toString()):null,c.haber_basico=null!=n["AB"+t]&&""!=n["AB"+t]?parseFloat(n["AB"+t].v.toString()):null,c.matricula_seguro=null!=n["AC"+t]&&""!=n["AC"+t]?n["AC"+t].v.toString():null,c.seguro_salud=null!=n["AD"+t]&&""!=n["AD"+t]?n["AD"+t].v.toString():null,c.estadoTexto=null!=n["AE"+t]&&""!=n["AE"+t]?n["AE"+t].v.toString():null,c.estado="Activo"!==c.estadoTexto,c.fecha_expiracion=null!=n["AF"+t]&&""!=n["AF"+t]?T.fecha_excel_angular(n["AF"+t].v.toString()):null,c.imagen="img/icon-user-default.png",c.es_empleado=!0;var s=new Date(c.fecha_inicio);c.historialVacacion=[];var l=s.getFullYear();T.obtenerAnios(l).forEach(function(a,e,o){var i=e+1,t=null;i<=5?t=T.configuracionesVacacion[0].dias:i<=10?t=T.configuracionesVacacion[1].dias:10<i&&(t=T.configuracionesVacacion[2].dias);var n={gestion:a,anio:e+1,aplicadas:t,tomadas:0};c.historialVacacion.push(n)}),r.push(c),t++,0}while(null!=n["A"+t]);T.GuardarEmpleadosRh(r)},t.readAsBinaryString(o)}},T.subirExcelFichaEmpleados=function(a){M.start();var e,o,i=a.target.files;for(o=i[e=0];e!=i.length;++e){var t=new FileReader;o.name;t.onload=function(a){var e=a.target.result,o=XLSX.read(e,{type:"binary"}),i=o.SheetNames[0],t=2,n=o.Sheets[i],h=[];do{var r={seguros:[]};r.codigo=null!=n["A"+t]&&""!=n["A"+t]?n["A"+t].v.toString():null,r.apellido_paterno=null!=n["B"+t]&&""!=n["B"+t]?n["B"+t].v.toString():null,r.apellido_materno=null!=n["C"+t]&&""!=n["C"+t]?n["C"+t].v.toString():null,r.nombres=null!=n["D"+t]&&""!=n["D"+t]?n["D"+t].v.toString():null,r.segundo_nombre=null!=n["E"+t]&&""!=n["E"+t]?n["E"+t].v.toString():null,r.estado_civil=null!=n["F"+t]&&""!=n["F"+t]?n["F"+t].v.toString():null,r.nacionalidad=null!=n["G"+t]&&""!=n["G"+t]?n["G"+t].v.toString():null,r.departamento=null!=n["H"+t]&&""!=n["H"+t]?n["H"+t].v.toString():null,r.provincia=null!=n["I"+t]&&""!=n["I"+t]?n["I"+t].v.toString():null,r.localidad=null!=n["J"+t]&&""!=n["J"+t]?T.fecha_excel_angular(n["J"+t].v.toString()):null,r.tipo_personal=null!=n["K"+t]&&""!=n["K"+t]?n["K"+t].v.toString():null,r.carga_horario=null!=n["L"+t]&&""!=n["L"+t]?n["L"+t].v.toString():null,r.area=null!=n["M"+t]&&""!=n["M"+t]?n["M"+t].v.toString():null,r.ubicacion=null!=n["N"+t]&&""!=n["N"+t]?n["N"+t].v.toString():null,r.lugar_seguro=null!=n["O"+t]&&""!=n["O"+t]?n["O"+t].v.toString():null,r.nua_cua=null!=n["P"+t]&&""!=n["P"+t]?n["P"+t].v.toString():null,r.afp_aporte=null!=n["Q"+t]&&""!=n["Q"+t]?n["Q"+t].v.toString():null,r.lugar_afp=null!=n["R"+t]&&""!=n["R"+t]?n["R"+t].v.toString():null,r.seguro1=null!=n["S"+t]&&""!=n["S"+t]?n["S"+t].v.toString():null,r.monto1=null!=n["T"+t]&&""!=n["T"+t]?parseFloat(n["T"+t].v.toString()):null,r.observacion1=null!=n["U"+t]&&""!=n["U"+t]?n["U"+t].v.toString():null,r.seguro2=null!=n["V"+t]&&""!=n["V"+t]?n["V"+t].v.toString():null,r.monto2=null!=n["W"+t]&&""!=n["W"+t]?parseFloat(n["W"+t].v.toString()):null,r.observacion2=null!=n["X"+t]&&""!=n["X"+t]?n["X"+t].v.toString():null,h.push(r),t++,0}while(null!=n["A"+t]);var g=[],b=[],v=[],_=[],D=[],E=[],A=[],R=[],M=[],x=[];h.forEach(function(a,e,o){var i=!1;if(0<g.length){for(var t=0;t<g.length;t++){var n=g[t];null!=a.afp_aporte&&n==a.afp_aporte&&(i=!0)}i||g.push(a.afp_aporte)}else g.push(a.afp_aporte);var r=!1;if(0<b.length){for(t=0;t<b.length;t++){n=b[t];null!=a.lugar_afp&&n==a.lugar_afp&&(r=!0)}r||b.push(a.lugar_afp)}else b.push(a.lugar_afp);var c=!1;if(0<v.length){for(t=0;t<v.length;t++){n=v[t];null!=a.lugar_seguro&&n==a.lugar_seguro&&(c=!0)}c||v.push(a.lugar_seguro)}else v.push(a.lugar_seguro);var s=!1;if(0<_.length){for(t=0;t<_.length;t++){n=_[t];null!=a.tipo_personal&&n==a.tipo_personal&&(s=!0)}s||_.push(a.tipo_personal)}else _.push(a.tipo_personal);var l=!1;if(0<D.length){for(t=0;t<D.length;t++){n=D[t];null!=a.carga_horario&&n==a.carga_horario&&(l=!0)}l||D.push(a.carga_horario)}else D.push(a.carga_horario);var d=!1;if(0<E.length){for(t=0;t<E.length;t++){n=E[t];null!=a.area&&n==a.area&&(d=!0)}d||E.push(a.area)}else E.push(a.area);var u=!1;if(0<A.length){for(t=0;t<A.length;t++){n=A[t];null!=a.ubicacion&&n==a.ubicacion&&(u=!0)}u||A.push(a.ubicacion)}else A.push(a.ubicacion);var p=!1;if(0<R.length){for(t=0;t<R.length;t++){n=R[t];null!=a.estado_civil&&n==a.estado_civil&&(p=!0)}p||R.push(a.estado_civil)}else R.push(a.estado_civil);var f=!1;if(0<M.length){for(t=0;t<M.length;t++){n=M[t];null!=a.seguro1&&n==a.seguro1&&(f=!0)}f||M.push(a.seguro1)}else M.push(a.seguro1);var m=!1;if(0<x.length){for(t=0;t<x.length;t++){n=x[t];null!=a.seguro2&&n==a.seguro2&&(m=!0)}m||x.push(a.seguro2)}else x.push(a.seguro2);e===o.length-1&&T.guardarFichasEmpleados(h,g,b,v,_,D,E,A,R,M,x)})},t.readAsBinaryString(o)}},T.guardarFichasEmpleados=function(a,e,o,i,t,n,r,c,s,l,d){qa(a,T.usuario.id_empresa,e,o,i,t,n,r,c,s,l,d).then(function(a){T.recargarItemsTabla(),T.mostrarMensaje(a.mensaje),M.stop()})},T.subirExcelRTurnoEmpleados=function(a){M.start();var e,o,i=a.target.files;for(o=i[e=0];e!=i.length;++e){var t=new FileReader;o.name;t.onload=function(a){var e=a.target.result,o=XLSX.read(e,{type:"binary"}),i=o.SheetNames[0],t=2,n=o.Sheets[i],r=[];do{var c={};c.codigo=null!=n["A"+t]&&""!=n["A"+t]?n["A"+t].v.toString():null,c.tipo=null!=n["F"+t]&&""!=n["F"+t]?"Fijo"==n["F"+t].v.toString():null,c.campo=null!=n["G"+t]&&""!=n["G"+t]?n["G"+t].v.toString():null,c.fecha_inicio=null!=n["H"+t]&&""!=n["H"+t]?T.fecha_excel_angular(n["H"+t].v.toString()):null,c.fecha_fin=null!=n["I"+t]&&""!=n["I"+t]?T.fecha_excel_angular(n["I"+t].v.toString()):null,c.grupo=null!=n["J"+t]&&""!=n["J"+t]?n["J"+t].v.toString():null,c.dias_trabajo=null!=n["K"+t]&&""!=n["K"+t]?n["K"+t].v.toString():null,c.dias_descanso=null!=n["L"+t]&&""!=n["L"+t]?n["L"+t].v.toString():null,r.push(c),t++,0}while(null!=n["A"+t]);T.guardarRolTurnoEmpleados(r,T.tipoImportacionRol)},t.readAsBinaryString(o)}},T.actualizarImportacionRoles=function(){T.tipoImportacionRol=!0},T.importarNuevosRoles=function(){T.tipoImportacionRol=!1},T.guardarRolTurnoEmpleados=function(a,e){Ya(a,T.usuario.id_empresa,e).then(function(a){T.mostrarMensaje(a.mensaje),T.cerrarDialogTipoImportacionRol(),M.stop()})},T.subirExcelFichaEmpleadoFamiliares=function(a){M.start();var e,o,i=a.target.files;for(o=i[e=0];e!=i.length;++e){var t=new FileReader;o.name;t.onload=function(a){var e=a.target.result,o=XLSX.read(e,{type:"binary"}),i=o.SheetNames[0],t=2,n=o.Sheets[i],r=[];do{var c={};c.codigoEmpleado=null!=n["A"+t]&&""!=n["A"+t]?n["A"+t].v.toString():null,c.genero=null!=n["C"+t]&&""!=n["C"+t]?n["C"+t].v.toString():null,c.nombres=null!=n["D"+t]&&""!=n["D"+t]?n["D"+t].v.toString():null,c.apellido_paterno=null!=n["E"+t]&&""!=n["E"+t]?n["E"+t].v.toString():null,c.apellido_materno=null!=n["F"+t]&&""!=n["F"+t]?n["F"+t].v.toString():null,c.fecha_nacimiento=null!=n["G"+t]&&""!=n["G"+t]?new Date(T.fecha_excel_angular(n["G"+t].v.toString())):null,c.relacion=null!=n["H"+t]&&""!=n["H"+t]?n["H"+t].v.toString():null,c.referencia=null!=n["I"+t]&&""!=n["I"+t]?n["I"+t].v.toString():null,r.push(c),t++,0}while(null!=n["A"+t]);T.GuardarFichasEmpleadosFamiliares(r)},t.readAsBinaryString(o)}},T.GuardarFichasEmpleadosFamiliares=function(t){var n=[];t.forEach(function(a,e,o){if(0<n.length){bandera=!0;for(var i=0;i<n.length;i++){n[i]===a.relacion&&(bandera=!1)}bandera&&n.push(a.relacion)}else n.push(a.relacion);e===o.length-1&&new Ha({id_empresa:T.usuario.id_empresa,familiares:t,relaciones:n}).$save(function(a){T.mostrarMensaje(a.mensaje),T.recargarItemsTabla(),M.stop()})})},T.subirExcelFicha=function(a){M.start();var e,o,i=a.target.files;for(o=i[e=0];e!=i.length;++e){var t=new FileReader;o.name;t.onload=function(a){var e=a.target.result,o=XLSX.read(e,{type:"binary"}),i=o.SheetNames[0],t=2,n=o.Sheets[i],r=[];do{var c={};c.codigo=null!=n["A"+t]&&""!=n["A"+t]?n["A"+t].v.toString():null,c.banco=null!=n["C"+t]&&""!=n["C"+t]?n["C"+t].v.toString():null,c.numero_cuenta=null!=n["D"+t]&&""!=n["D"+t]?n["D"+t].v.toString():null,r.push(c),t++,0}while(null!=n["A"+t]);T.GuardarFichasEmpleadosRh(r)},t.readAsBinaryString(o)}},T.GuardarEmpleadosRh=function(a){new d({pacientes:a,id_empresa:T.usuario.id_empresa}).$save(function(a){T.mostrarMensaje(a.mensaje),T.recargarItemsTabla(),M.stop()})},T.GuardarFichasEmpleadosRh=function(n){var r=[];n.forEach(function(a,e,o){var i=!1;if(0<r.length){for(var t=0;t<r.length;t++){r[t]==a.banco&&(i=!0)}i||r.push(a.banco)}else r.push(a.banco);e===o.length-1&&new Ea({pacientes:n,id_empresa:T.usuario.id_empresa,bancos:r}).$save(function(a){T.mostrarMensaje(a.mensaje),T.recargarItemsTabla(),M.stop()})})},T.modificarEmpleado=function(a){T.steps=[{cabeza:"cabeza-nuevo-datos-personales",cuerpo:"cuerpo-nuevo-datos-personales"},{cabeza:"cabeza-nuevo-datos-comple",cuerpo:"cuerpo-nuevo-datos-comple"},{cabeza:"cabeza-nuevo-datos-laborales",cuerpo:"cuerpo-nuevo-datos-laborales"}],promesaPaciente=p(a.id),promesaPaciente.then(function(a){null!=a.clase&&(a.medicoPaciente.tipo_contrato=a.clase),T.nuevoRH=a.medicoPaciente,T.nuevoRH.persona.fecha_nacimiento=T.fechaATexto(T.nuevoRH.persona.fecha_nacimiento),T.seleccionarCargos(T.nuevoRH.empleadosFichas[T.nuevoRH.empleadosFichas.length-1].cargos)}),T.abrirPopup(T.idModalRhNuevo)},T.validarCodigoCuentaEmpleado=function(a){""!=a&&k(function(){T.validar=new y,T.validar.codigo=a,T.validar.$save({id_empresa:T.usuario.id_empresa},function(a){T.data=a})},1500)},T.eliminarFamiliarRh=function(){x(T.familiar).then(function(a){T.ficha.empleado.familiares.splice(T.familiar.index,1),T.familiar=null,T.cerrarDialogEliminarFamiliarEmpleado(),T.mostrarMensaje(a.mensaje)})},T.eliminarOtroSeguroRh=function(e){R(e).then(function(a){T.ficha.otrosSeguros.splice(e.index,1),T.otroSeguro=null,T.cerrarDialogEliminarSeguroEmpleado(),T.mostrarMensaje(a.mensaje)})},T.finVerEmpleado=function(){"Siguiente"!=$("#siguiente-v").text().trim()&&T.cerrarDialogVerEmpleado()},T.obtenerDatosFichaUsuario=function(a,r){v(a.id).then(function(a){if(a.ficha){T.ficha=a.ficha,T.ficha.editDatosLaborales=!1,T.ficha.fecha_inicio?T.ficha.fecha_inicio2=T.fechaATexto(T.ficha.fecha_inicio):T.ficha.editDatosLaborales=!0,T.ficha.fecha_fin&&(T.ficha.fecha_fin2=T.fechaATexto(T.ficha.fecha_fin)),T.ficha.cargo=[],T.ficha.fecha_jubilacion=new Date(T.ficha.fecha_jubilacion),T.ficha.empleado.fecha_vence_documento=new Date(T.ficha.empleado.fecha_vence_documento),T.ficha.fecha_jubilacion=T.fechaATexto(T.ficha.fecha_jubilacion),T.ficha.empleado.fecha_vence_documento=T.fechaATexto(T.ficha.empleado.fecha_vence_documento),T.buscarDepartamento(a.ficha.empleado.persona.pais),T.buscarMunicipios(a.ficha.empleado.persona.ciudad),T.buscarLocalidad(a.ficha.empleado.persona.provincia);var e=new Date,o=new Date(T.ficha.empleado.persona.fecha_nacimiento);T.ficha.nac_anio=o.getFullYear(),T.ficha.nac_dia=o.getDate();var i=o.getMonth();if(T.meses.forEach(function(a,e,o){a.id==i&&(T.ficha.nac_mes=a,T.getDaysInMonth(T.ficha.nac_mes.id,T.ficha.nac_anio))}),T.ficha.fecha)var t=new Date(T.ficha.fecha);else t=new Date;T.ficha.fecha_elaboracion=t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear();var n=T.diferenciaEntreDiasEnDias(o,e);T.ficha.edad=Math.trunc(n/365),T.ficha.empleado.familiares.forEach(function(a,e,o){var i=new Date,t=new Date(a.persona.fecha_nacimiento),n=T.diferenciaEntreDiasEnDias(t,i);a.edad=Math.trunc(n/365),a.eliminado=!1}),T.ficha.otrosSeguros.forEach(function(a,e,o){a.eliminado=!1}),T.seleccionarCargos(T.ficha.cargos),T.seleccionarDiscapacidades(T.ficha.discapacidades),r&&setTimeout(function(){T.ficha.editDatosLaborales=!0,T.ficha.fecha_inicio2=T.fechaATexto(new Date),$("#siguiente-f").click()},200)}M.stop()})},T.seleccionarCargos=function(a){for(var e=0;e<T.cargos.length;e++)for(var o=0;o<a.length;o++)T.cargos[e].id==a[o].id_cargo&&(T.cargos[e].ticked=!0)},T.llenarCargos=function(a){T.cargos=[];for(var e=0;e<a.length;e++){var o={nombre:a[e].nombre,maker:"",ticked:!1,id:a[e].id};T.cargos.push(o)}},T.seleccionarDiscapacidades=function(a){for(var e=0;e<T.discapacidades.length;e++)for(var o=0;o<a.length;o++)T.discapacidades[e].id==a[o].id_discapacidad&&(T.discapacidades[e].ticked=!0)},T.llenarDiscapacidades=function(a){T.discapacidades=[];for(var e=0;e<a.length;e++){var o={nombre:a[e].nombre,maker:"",ticked:!1,id:a[e].id};T.discapacidades.push(o)}},T.diferenciaEntreDiasEnDias=function(a,e){var o=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),i=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate());return Math.floor((i-o)/864e5)},T.obtenerDatosPrerequisito=function(a,e){M.start(),null!=e.inicio&&0!=e.inicio&&""!=e.inicio?T.filtro.inicio=e.inicio instanceof Date?e.inicio:new Date(T.convertirFecha(e.inicio)):T.filtro.inicio=0,null!=e.fin&&0!=e.fin&&""!=e.fin?T.filtro.fin=e.fin instanceof Date?e.fin:new Date(T.convertirFecha(e.fin)):T.filtro.fin=0,g(a.id,T.filtro).then(function(a){T.prerequisitosPaciente=a.Prerequisitos,T.prerequisitosPaciente.forEach(function(a){null!=a.fecha_entrega&&(a.entregado=!0)}),T.filtro.inicio=T.filtro.inicio instanceof Date?T.filtro.inicio.getDate()+"/"+(T.filtro.inicio.getMonth()+1)+"/"+T.filtro.inicio.getFullYear():"",T.filtro.fin=T.filtro.fin instanceof Date?T.filtro.fin.getDate()+"/"+(T.filtro.fin.getMonth()+1)+"/"+T.filtro.fin.getFullYear():"",M.stop()},function(a){T.mostrarMensaje("Se produjo un error al obtener datos de prerequisitos"),M.stop()})},T.saveFormPrerequisito=function(a){(M.start(),null!=a.nombre&&null!=a.vencimiento_mes)?ya(a).then(function(a){T.mostrarMensaje(a.mensaje),T.cerrarPopupPrerequisitoNuevo(),M.stop(),T.verificarAsignacionPrerequisitos()}).catch(function(a){M.stop();var e=void 0!==a.stack&&null!==a.stack?a.stack:void 0!==a.message&&null!==a.message?a.message:"Se perdió la conexión.";T.mostrarMensaje(e)}):(T.mostrarMensaje("Los campos Prerequisito Nombre y vencimiento mes son requeridos."),M.stop())},T.verificarAsignacionPrerequisitos=function(){M.start(),h().then(function(a){T.preRequisitos=a.prerequisitos,filtro={inicio:0,fin:0},g(T.empleado.id,filtro).then(function(a){T.prerequisitosPaciente=a.Prerequisitos,T.preRequisitos.forEach(function(e,a,o){T.prerequisitosPaciente.forEach(function(a){e.id==a.id_prerequisito&&(e.asignado=!0),null!=a.fecha_entrega&&(a.entregado=!0)}),0==T.prerequisitosPaciente.length&&(e.asignado=!1),a==o.length-1&&M.stop()}),0==T.preRequisitos.length&&M.stop()})})},T.diasVencidosPrerequisito=function(a){var e=(new Date).getTime()-a.getTime();return Math.floor(e/864e5)},T.calcularFechaVencimientoRequisito=function(a){var e=void 0===a.vencimiento_mes?a.preRequisito.vencimiento_mes:a.vencimiento_mes,o=(new Date,new Date);if(void 0===a.fecha_inicio_texto)var i=T.fechaATexto(a.fecha_inicio);var t=void 0===a.fecha_inicio_texto?i.split("/"):a.fecha_inicio_texto.split("/"),n=parseInt(t[0]),r=parseInt(t[1]),c=parseInt(t[2]);return o.setFullYear(c,r-1,n),new Date(o.setTime(o.getTime()+30*e*864e5))},T.actualizarPreRequisitoPaciente=function(a){M.start();var e=a;e.fecha_vencimiento=new Date(T.convertirFecha(e.fecha_vencimiento_texto)),e.fecha_inicio=new Date,e.fecha_entrega=null,e.asignado=!0,P.save(e,function(a){T.mostrarMensaje(a.mensaje),T.cerrarDialogEditarPreRequisito(),T.verificarAsignacionPrerequisitos(),M.stop()},function(a){T.mostrarMensaje("Ocurrio un problema al asignar el prerequisito"),T.cerrarDialogEditarPreRequisito(),M.stop()})},T.asignarPrerequisito=function(a,e){M.start(),a.pacientePrerequisito={id:e.id},a.preRequisito={id:a.id},a.fecha_inicio=new Date,a.fecha_inicio_texto=T.fechaATexto(a.fecha_inicio),a.fecha_vencimiento=T.calcularFechaVencimientoRequisito(a),a.paraAsignar=!0,P.save(a,function(a){T.verificarAsignacionPrerequisitos(),T.mostrarMensaje(a.mensaje),M.stop()},function(a){T.mostrarMensaje("Ocurrio un problema al asignar el prerequisito"),M.stop()})},T.obtenerPrerequisito=function(){M.start(),m().then(function(a){T.prerequisitos=a,M.stop()})},T.agregarSeguro=function(a){a.eliminado=!1,T.ficha.otrosSeguros.push(a),T.seguro={edit:!1}},T.calcularEdad=function(a){var e=new Date;if(a.nac_mes&&a.nac_anio&&a.nac_dia){var o=a.nac_anio,i=parseInt(a.nac_mes.id),t=parseInt(a.nac_dia),n=new Date;n.setFullYear(o,i,t);var r=T.diferenciaEntreDiasEnDias(n,e);a.edad=Math.trunc(r/365)}},T.eliminarSeguro=function(a,e){a.id?a.eliminado=!0:T.ficha.otrosSeguros.splice(e,1)},T.editarSeguro=function(a,e){T.seguro=a,T.seguro.edit=!0,T.seguro.index=e},T.agregarFamiliar=function(a){a.eliminado=!1,parseInt(a.nac_mes.id)<10&&(a.nac_mes.id="0"+a.nac_mes.id),a.persona.fecha_nacimiento=new Date(a.nac_anio,parseInt(a.nac_mes.id),parseInt(a.nac_dia)),T.ficha.empleado.familiares.push(a),T.familiar={edit:!1}},T.eliminarFamiliar=function(a,e){a.id?a.eliminado=!0:T.ficha.empleado.familiares.splice(e,1)},T.editarFamiliar=function(a,e){T.familiar=a;var o=new Date(a.persona.fecha_nacimiento);T.familiar.nac_anio=o.getFullYear(),T.familiar.nac_dia=o.getDate();var i=o.getMonth();T.meses.forEach(function(a,e,o){a.id==i&&(T.familiar.nac_mes=a)}),T.familiar.edit=!0,T.familiar.index=e,T.abrirDialogNuevoFamiliar()},T.guardarSeguroEditado=function(a){T.ficha.otrosSeguros[a.index]=a,T.seguro={edit:!1}},T.guardarFamiliarEditado=function(a){T.ficha.empleado.familiares[a.index].persona.fecha_nacimiento=new Date(a.nac_anio,parseInt(a.nac_mes.id),parseInt(a.nac_dia)),T.ficha.empleado.familiares[a.index]=a,T.familiar={edit:!1},T.cerrarDialogNuevoFamiliar()},T.recuperarDatosTipo=function(){T.obtenerExpeditos(),T.obtenerTipoExpeditos(),T.obtenerEstadoCivil(),T.obtenerNacionalidades(),T.obtenerTiposContratos(),T.obtenerTiposPersonales(),T.obtenerCargasHorarios(),T.obtenerAreas(),T.obtenerUbicacion(),T.obtenerSegurosSalud(),T.obtenerLugarSegurosSalud(),T.obtenerAporteSeguroLargoPlazo(),T.obtenerTipoOtrosSeguros(),T.obtenerFamiliaRelacion(),T.obtenerBancos(),T.obtenerMeses(),T.listYears=T.obtenerAnios(1930),T.obtenerCargos(),T.obtenerDiscapacidades(),T.obtenerGrados(),T.obtenerTitulos(),T.obtenerInstituciones(),T.obtenerCapacidadesIE(),T.obtenerLogrosIE(),T.obtenertiposAusenciaMedica(),T.obtenerTiposOtrasAusencias(),T.obtenerTiposBaja(),T.obtenerEstadoDotacion(),T.obtenerCumplimientoDotacion(),T.obtenerPeriodosDotacion(),T.obtenerGruposRol(),T.obtenerVehiculosViaje(),T.obtenerTipoViajeDetalle(),T.obtenerTiposEstadosPasajeros(),T.obtenerTipoLicenciaVehiculo()},T.obtenerTiposEstadosPasajeros=function(){M.start(),ba("RRHH_EPVIA",T.usuario.id_empresa).then(function(a){T.tiposPasajerosViaje=a.clases,M.stop()})},T.obtenerGruposRol=function(){M.start(),ba("RRHH_GROL",T.usuario.id_empresa).then(function(a){T.gruposRol=a,M.stop()})},T.obtenerTipoLicenciaVehiculo=function(){M.start(),ba("RRHH_TLVVIA",T.usuario.id_empresa).then(function(a){T.TiposLicenciasVehiculo=a,M.stop()})},T.obtenerVehiculosViaje=function(){M.start(),ba("RRHH_VVIA",T.usuario.id_empresa).then(function(a){T.vehiculosViaje=a,M.stop()})},T.obtenerTipoViajeDetalle=function(){M.start(),ba("RRHH_TVIA",T.usuario.id_empresa).then(function(a){T.tiposViaje=a,M.stop()})},T.obtenerGrados=function(){M.start(),ba("RRHH_GRA",T.usuario.id_empresa).then(function(a){T.grados=a,M.stop()})},T.obtenerTitulos=function(){M.start(),ba("RRHH_TITL",T.usuario.id_empresa).then(function(a){T.titulos=a,M.stop()})},T.obtenerInstituciones=function(){M.start(),ba("RRHH_INST",T.usuario.id_empresa).then(function(a){T.instituciones=a,M.stop()})},T.obtenerCapacidadesIE=function(){M.start(),ba("RRHH_TCIE",T.usuario.id_empresa).then(function(a){T.capacidadesIE=a,M.stop()})},T.obtenerLogrosIE=function(){M.start(),ba("RRHH_TLIE",T.usuario.id_empresa).then(function(a){T.logrosIE=a,M.stop()})},T.obtenerHistorialContratos=function(a){M.start(),H(a.id).then(function(a){T.historialFichaEmpleado=a,T.llenarHistoricoCertificado(a),M.stop()})},T.obtenerCargos=function(){M.start(),ba("RRHH_CARGO",T.usuario.id_empresa).then(function(a){var e=a.clases;T.listaCargos=a,T.llenarCargos(e),M.stop()})},T.obtenerDiscapacidades=function(){M.start(),ba("RRHH_DISC",T.usuario.id_empresa).then(function(a){var e=a.clases;T.llenarDiscapacidades(e),M.stop()})},T.obtenerExpeditos=function(){M.start(),ba("RRHH_EXP",T.usuario.id_empresa).then(function(a){T.tipoExpedido=a,M.stop()})},T.obtenerTipoExpeditos=function(){M.start(),ba("RRHH_TEXP",T.usuario.id_empresa).then(function(a){T.tipoDocumento=a,M.stop()})},T.obtenerEstadoCivil=function(){M.start(),ba("RRHH_EC",T.usuario.id_empresa).then(function(a){T.estadosCiviles=a,M.stop()})},T.obtenerNacionalidades=function(){M.start(),_("NAC").then(function(a){T.nacionalidades=a,M.stop()})},T.obtenerDepartamentos=function(){M.start();E("-BOL").then(function(a){T.departamentosBanco=a,M.stop()})},T.buscarDepartamento=function(a){if(a){var e="-"+a.nombre_corto;E(e).then(function(a){0===(T.departamentos=a).length&&(T.provincias=[],T.localidades=[])})}},T.buscarDepartamentoFiniquito=function(){E("-BOL").then(function(a){T.departamentosFiniquito=a})},T.buscarRopaTrabajo=function(){wa("ROPA DE TRABAJO-G",T.usuario.id_empresa).then(function(a){T.ropasDeTrabajo=a})},T.buscarMunicipios=function(a){if(a){var e=(a.id+"-"+a.nombre_corto).split("-")[1];E(e+"M").then(function(a){0===(T.provincias=a).length&&(T.localidades=[])})}},T.buscarLocalidad=function(a){if(a){var e=a.nombre_corto.split("-")[1];E((e="-"+e)+"L").then(function(a){T.localidades=a})}},T.AgregarDepartamento=function(t){if(t.edit){var n=!0;T.clase={pais:t.pais},T.departamentos.forEach(function(a,e,o){var i=a.nombre_corto.split("-")[0];a.id!=t.id&&i==t.nombre_corto2&&(n=!1),e===o.length-1&&(n?(t.nombre_corto=t.nombre_corto2+"-"+t.pais.nombre_corto,T.clase={pais:t.pais}):T.mostrarMensaje("El nombre corto tiene que ser unico por departamento"))})}else{n=!0;0<T.departamentos.length?T.departamentos.forEach(function(a,e,o){a.nombre_corto.split("-")[0]==t.nombre_corto2&&(n=!1),e===o.length-1&&(n?(t.nombre_corto=t.nombre_corto2+"-"+t.pais.nombre_corto,T.departamentos.push(t),T.clase={pais:t.pais}):T.mostrarMensaje("El nombre corto tiene que ser unico por departamento"))}):(t.nombre_corto=t.nombre_corto2+"-"+t.pais.nombre_corto,T.departamentos.push(t),T.clase={pais:t.pais})}},T.AgregarProvincia=function(n){if(n.edit){var r=!0;T.provincias.forEach(function(a,e,o){var i=a.nombre_corto.split("-")[1];if(a.id!=n.id&&i==n.nombre_corto2&&(r=!1),e===o.length-1)if(r){var t=n.departamento.nombre_corto.split("-")[0];n.nombre_corto=t+"M-"+n.nombre_corto2}else T.mostrarMensaje("El nombre corto tiene que ser unico por provincia")}),T.clase={departamento:n.departamento}}else{r=!0;if(0<T.provincias.length)T.provincias.forEach(function(a,e,o){if(a.nombre_corto.split("-")[1]==n.nombre_corto2&&(r=!1),e===o.length-1)if(r){var i=n.departamento.nombre_corto.split("-")[0];n.nombre_corto=i+"M-"+n.nombre_corto2,T.provincias.push(n),T.clase={departamento:n.departamento}}else T.mostrarMensaje("El nombre corto tiene que ser unico por provincia")});else{var a=n.departamento.nombre_corto.split("-")[0];n.nombre_corto=a+"M-"+n.nombre_corto2,T.provincias.push(n),T.clase={departamento:n.departamento}}}},T.AgregarLocalidad=function(r){if(r.edit){var c=!0;T.localidades.forEach(function(a,e,o){var i=a.nombre_corto.split("-")[0],t=r.nombre_corto2;if(a.id!=r.id&&i==t&&(c=!1),e===o.length-1)if(c){var n=r.provincia.nombre_corto.split("-")[1];r.nombre_corto=r.nombre_corto2+"-"+n+"L"}else T.mostrarMensaje("El nombre corto tiene que ser unico por localidad")}),T.clase={provincia:r.provincia}}else{c=!0;if(0<T.localidades.length)T.localidades.forEach(function(a,e,o){if(a.nombre_corto.split("-")[0]==r.nombre_corto2&&(c=!1),e===o.length-1)if(c){var i=r.provincia.nombre_corto.split("-")[1];r.nombre_corto=r.nombre_corto2+"-"+i+"L",T.localidades.push(r),T.clase={provincia:r.provincia}}else T.mostrarMensaje("El nombre corto tiene que ser unico por localidad")});else{var a=r.provincia.nombre_corto.split("-")[1];r.nombre_corto=r.nombre_corto2+"-"+a+"L",T.localidades.push(r),T.clase={provincia:r.provincia}}}},T.guardarConceptoEdicionRrhh=function(a,e){M.start(),T.tipo_edicion2.clases=a;var o=T.tipo_edicion2;na.update({id_tipo:o.id},o,function(a){_(o.nombre_corto).then(function(a){o=a,T.tipo_edicion2={},M.stop(),T.buscarDepartamento(e.pais),T.buscarMunicipios(e.departamento),T.buscarLocalidad(e.provincia),T.cerrarDialogDepartamentoEstado(),T.cerrarDialogProvincia(),T.cerrarDialogLocalidad(),T.mostrarMensaje("Guardado Exitosamente!")})})},T.editarLocalidad=function(a,e){var o=e.provincia,i=a.nombre_corto.split("-")[0];T.clase=a,T.clase.provincia=o,T.clase.nombre_corto2=i,T.clase.edit=!0},T.editarProvincia=function(a,e){var o=e.departamento,i=a.nombre_corto.split("-")[1];T.clase=a,T.clase.departamento=o,T.clase.nombre_corto2=i,T.clase.edit=!0},T.editarDepartamento=function(a,e){var o=e.pais,i=a.nombre_corto.split("-")[0];T.clase=a,T.clase.pais=o,T.clase.nombre_corto2=i,T.clase.edit=!0},T.cancelarEdicionLocalidad=function(a){T.clase={provincia:a.provincia}},T.cancelarEdicionProvincia=function(a){T.clase={departamento:a.departamento}},T.cancelarEdicionDepartamento=function(a){T.clase={pais:a.pais}},T.obtenerTiposContratos=function(){M.start(),ba("RRHH_TC",T.usuario.id_empresa).then(function(a){T.tiposContratos=a,M.stop()})},T.obtenerTiposPersonales=function(){M.start(),ba("RRHH_TP",T.usuario.id_empresa).then(function(a){T.tiposPersonales=a,M.stop()})},T.obtenerCargasHorarios=function(){M.start(),ba("RRHH_CH",T.usuario.id_empresa).then(function(a){T.cargasHorarios=a,M.stop()})},T.obtenerAreas=function(){M.start(),ba("RRHH_AREA",T.usuario.id_empresa).then(function(a){T.listaAreas=a,M.stop()})},T.obtenerUbicacion=function(){M.start(),ba("RRHH_UBI",T.usuario.id_empresa).then(function(a){T.ubicaciones=a,M.stop()})},T.obtenerSegurosSalud=function(){M.start(),ba("RRHH_SS",T.usuario.id_empresa).then(function(a){T.segurosSalud=a,M.stop()})},T.obtenerLugarSegurosSalud=function(){M.start(),ba("RRHH_LSS",T.usuario.id_empresa).then(function(a){T.LugaresSegurosSalud=a,M.stop()})},T.obtenerAporteSeguroLargoPlazo=function(){M.start(),ba("RRHH_ASLP",T.usuario.id_empresa).then(function(a){T.aportesSeguroLargoPlazo=a,M.stop()})},T.obtenerTipoOtrosSeguros=function(){M.start(),ba("RRHH_OST",T.usuario.id_empresa).then(function(a){T.OtrosSegurosTipos=a,M.stop()})},T.obtenerBancos=function(){M.start(),ba("RRHH_BAN",T.usuario.id_empresa).then(function(a){T.bancosHdv=a,M.stop()})},T.obtenerFamiliaRelacion=function(){M.start(),ba("RRHH_REL",T.usuario.id_empresa).then(function(a){T.relaciones=a,M.stop()})},T.obtenerAnios=function(a){var e=(new Date).getFullYear(),o=[];for(a=a||1930;a<=e;)o.push(a++);return o},T.getDaysInMonth=function(a,e){for(var o=new Date(e,a+1,0).getDate(),i=[],t=1;t<=o;t++)i.push(t),t==o&&(T.listaDias=i)},T.guardarFichaTecnica=function(a,r,e){if(0==T.nopuedoModificarFicha){T.ficha.quienModifico=T.usuario.id;var o=T.fechaATexto(r.fecha_inicio);if(r.historialVacacion=[],o!=r.fecha_inicio2){var i=r.fecha_inicio2,t=new Date(T.convertirFecha(i)).getFullYear();T.obtenerAnios(t).forEach(function(a,e,o){var i=e+1,t=null;i<=5?t=T.configuracionesVacacion[0].dias:i<=10?t=T.configuracionesVacacion[1].dias:10<i&&(t=T.configuracionesVacacion[2].dias);var n={gestion:a,anio:e+1,aplicadas:t,tomadas:0};r.historialVacacion.push(n)})}if(e){T.primeroGuardarParaCerrar=!1,r.empleado.persona.fecha_nacimiento=new Date(r.nac_anio,parseInt(r.nac_mes.id),parseInt(r.nac_dia)),r.fecha_elaboracion&&(r.fecha_elaboracion=new Date(T.convertirFecha(r.fecha_elaboracion))),r.fecha_inicio2&&(r.fecha_inicio2=new Date(T.convertirFecha(r.fecha_inicio2))),r.fecha_fin2&&(r.fecha_fin2=new Date(T.convertirFecha(r.fecha_fin2))),r.fecha_jubilacion&&(r.fecha_jubilacion=new Date(T.convertirFecha(r.fecha_jubilacion))),r.empleado.fecha_vence_documento&&(r.empleado.fecha_vence_documento=new Date(T.convertirFecha(r.empleado.fecha_vence_documento)));var n=document.getElementById("id-contrato").files[0],c=new FileReader;if(n)c.onloadend=function(a){r.contrato2={name:"",data:null},r.contrato2.name=r.contrato[0].name,r.contrato2.data=a.target.result,A(r).then(function(a){T.cerrarDialogEmpleado(),T.recargarItemsTabla(),T.mostrarMensaje(a.message)})},c.readAsBinaryString(n);else A(r).then(function(e){if(fecha1=T.fechaATexto(e.fichaActual.fecha_inicio),fecha2=T.fechaATexto(e.fichaAnterior.fecha_inicio),fecha1==fecha2){var a=[],o={},i=0,t=Object.keys(e.fichaActual).length;for(var n in e.fichaActual){var r=n.substr(0,3);if("id_"!=r&&"updatedAt"!=n&&"createdAt"!=n&&"id"!=n&&"nombre_corto"!=n)if(e.fichaActual[n]instanceof Object){if(e.fichaActual[n]instanceof Array){console.log("comparar arreglos");var c=!1,s="",l="",d=e.fichaActual[n];e.fichaActual[n].forEach(function(a){"cargos"==n&&(s+=a.cargo.nombre+", "),"discapacidades"==n&&(s+=a.discapacidad.nombre+", "),"otrosSeguros"==n&&(s+=a.tipoSeguro.nombre+", ")});var u=e.fichaAnterior[n];e.fichaAnterior[n].forEach(function(a){"cargos"==n&&(l+=a.cargo.nombre+", "),"discapacidades"==n&&(l+=a.discapacidad.nombre+", "),"otrosSeguros"==n&&(s+=a.tipoSeguro.nombre+", ")}),c=d.includes(u),u.length!=d.length&&(c=!0),c&&(o={id_ficha:e.fichaActual.id,campo:n,valor_anterior:l,valor_actual:s,fecha:new Date},a.push(o))}else for(var p in e.fichaActual[n])if("id_"!=(r=p.substr(0,3))&&"updatedAt"!=p&&"createdAt"!=p&&"id"!=p&&"nombre_corto"!=p)if(e.fichaActual[n][p]instanceof Object)for(var f in e.fichaActual[n][p])"id_"!=(r=f.substr(0,3))&&"updatedAt"!=f&&"createdAt"!=f&&"id"!=f&&"nombre_corto"!=f&&(e.fichaActual[n][p][f]instanceof Object?console.log("aqui otro forin"):e.fichaAnterior[n][p]?e.fichaActual[n][p][f]!=e.fichaAnterior[n][p][f]&&(o={id_ficha:e.fichaActual.id,campo:n+"."+p+"."+f,valor_anterior:e.fichaAnterior[n][p][f],valor_actual:e.fichaActual[n][p][f],fecha:new Date},a.push(o)):e.fichaActual[n][p][f]&&(o={id_ficha:e.fichaActual.id,campo:n+"."+p+"."+f,valor_anterior:"",valor_actual:e.fichaActual[n][p][f],fecha:new Date},a.push(o)));else e.fichaAnterior[n]?e.fichaActual[n][p]!=e.fichaAnterior[n][p]&&(o={id_ficha:e.fichaActual.id,campo:n+"."+p,valor_anterior:e.fichaAnterior[n][p],valor_actual:e.fichaActual[n][p],fecha:new Date},a.push(o)):e.fichaActual[n][p]&&(o={id_ficha:e.fichaActual.id,campo:n+"."+p,valor_anterior:"",valor_actual:e.fichaActual[n][p],fecha:new Date},a.push(o))}else e.fichaActual[n]!=e.fichaAnterior[n]&&(o={id_ficha:e.fichaActual.id,campo:n,valor_anterior:e.fichaAnterior[n],valor_actual:e.fichaActual[n],fecha:new Date},a.push(o));if(++i===t-1)if(0<a.length)ma(T.usuario.id,a).then(function(a){T.cerrarDialogEmpleado(),T.recargarItemsTabla(),T.mostrarMensaje(e.message)});else T.primeroGuardarParaCerrar=!1,T.cerrarDialogEmpleado(),T.recargarItemsTabla(),T.mostrarMensaje(e.message)}}else T.primeroGuardarParaCerrar=!1,T.cerrarDialogEmpleado(),T.recargarItemsTabla(),T.mostrarMensaje(e.message)})}else{if("Siguiente"!=$("#siguiente-f").text().trim())r.empleado.persona.fecha_nacimiento=new Date(r.nac_anio,parseInt(r.nac_mes.id),parseInt(r.nac_dia)),r.fecha_elaboracion&&(r.fecha_elaboracion=new Date(T.convertirFecha(r.fecha_elaboracion))),r.fecha_inicio2&&(r.fecha_inicio2=new Date(T.convertirFecha(r.fecha_inicio2))),r.fecha_fin2&&(r.fecha_fin2=new Date(T.convertirFecha(r.fecha_fin2))),r.fecha_jubilacion&&(r.fecha_jubilacion=new Date(T.convertirFecha(r.fecha_jubilacion))),r.empleado.fecha_vence_documento&&(r.empleado.fecha_vence_documento=new Date(T.convertirFecha(r.empleado.fecha_vence_documento))),A(r).then(function(e){if(T.primeroGuardarParaCerrar=!1,fecha1=T.fechaATexto(e.fichaActual.fecha_inicio),fecha2=T.fechaATexto(e.fichaAnterior.fecha_inicio),fecha1==fecha2){var a=[],o={},i=0,t=Object.keys(e.fichaActual).length;for(var n in e.fichaActual){var r=n.substr(0,3);if("id_"!=r&&"updatedAt"!=n&&"createdAt"!=n&&"id"!=n&&"nombre_corto"!=n)if(e.fichaActual[n]instanceof Object){if(e.fichaActual[n]instanceof Array){console.log("comparar arreglos");var c=!1,s="",l="",d=e.fichaActual[n];e.fichaActual[n].forEach(function(a){"cargos"==n&&(s+=a.cargo.nombre+", "),"discapacidades"==n&&(s+=a.discapacidad.nombre+", "),"otrosSeguros"==n&&(s+=a.tipoSeguro.nombre+", ")});var u=e.fichaAnterior[n];e.fichaAnterior[n].forEach(function(a){"cargos"==n&&(l+=a.cargo.nombre+", "),"discapacidades"==n&&(l+=a.discapacidad.nombre+", "),"otrosSeguros"==n&&(s+=a.tipoSeguro.nombre+", ")}),c=d.includes(u),u.length!=d.length&&(c=!0),c&&(o={id_ficha:e.fichaActual.id,campo:n,valor_anterior:l,valor_actual:s,fecha:new Date},a.push(o))}else for(var p in e.fichaActual[n])if("id_"!=(r=p.substr(0,3))&&"updatedAt"!=p&&"createdAt"!=p&&"id"!=p&&"nombre_corto"!=p)if(e.fichaActual[n][p]instanceof Object)for(var f in e.fichaActual[n][p])"id_"!=(r=f.substr(0,3))&&"updatedAt"!=f&&"createdAt"!=f&&"id"!=f&&"nombre_corto"!=f&&(e.fichaActual[n][p][f]instanceof Object?console.log("aqui otro forin"):e.fichaAnterior[n][p]?e.fichaActual[n][p][f]!=e.fichaAnterior[n][p][f]&&(o={id_ficha:e.fichaActual.id,campo:n+"."+p+"."+f,valor_anterior:e.fichaAnterior[n][p][f],valor_actual:e.fichaActual[n][p][f],fecha:new Date},a.push(o)):e.fichaActual[n][p][f]&&(o={id_ficha:e.fichaActual.id,campo:n+"."+p+"."+f,valor_anterior:"",valor_actual:e.fichaActual[n][p][f],fecha:new Date},a.push(o)));else e.fichaAnterior[n]?e.fichaActual[n][p]!=e.fichaAnterior[n][p]&&(o={id_ficha:e.fichaActual.id,campo:n+"."+p,valor_anterior:e.fichaAnterior[n][p],valor_actual:e.fichaActual[n][p],fecha:new Date},a.push(o)):e.fichaActual[n][p]&&(o={id_ficha:e.fichaActual.id,campo:n+"."+p,valor_anterior:"",valor_actual:e.fichaActual[n][p],fecha:new Date},a.push(o))}else e.fichaActual[n]!=e.fichaAnterior[n]&&(o={id_ficha:e.fichaActual.id,campo:n,valor_anterior:e.fichaAnterior[n],valor_actual:e.fichaActual[n],fecha:new Date},a.push(o));if(++i===t-1)if(0<a.length)ma(T.usuario.id,a).then(function(a){T.cerrarDialogEmpleado(),T.recargarItemsTabla(),T.mostrarMensaje(e.message)});else T.cerrarDialogEmpleado(),T.recargarItemsTabla(),T.mostrarMensaje(e.message)}}else T.primeroGuardarParaCerrar=!1,T.cerrarDialogEmpleado(),T.recargarItemsTabla(),T.mostrarMensaje(e.message)})}}else{"Siguiente"!=$("#siguiente-f").text().trim()&&T.cerrarDialogEmpleado()}},T.actualizarPrerequisito=function(a){b(a).then(function(a){T.cerrarDialogInicioPreRequisitos(),T.mostrarMensaje(a.message)})},T.completarCamposLaboral=function(e){"OBRA"==e.tipoContrato.nombre&&(T.tiposPersonales.clases.forEach(function(a){"CAMPO"==a.nombre&&(e.tipoPersonal=a)}),e.area={},e.ubicacion={}),"INDEFINIDO"==e.tipoContrato.nombre&&(T.tiposPersonales.clases.forEach(function(a){"OFICINA"==a.nombre&&(e.tipoPersonal=a)}),T.listaAreas.clases.forEach(function(a){"ESS-SCZ"==a.nombre&&(e.area=a)}),T.ubicaciones.clases.forEach(function(a){"ESS-SCZ"==a.nombre&&(e.ubicacion=a)}))},T.agregarFormacionAcademica=function(a){T.hojaVida.formacionesAcademicas.push(a),T.formacionAcademica={edit:!1,eliminado:!1}},T.guardarFormacionAcademicaEditada=function(a){T.formacionAcademica={edit:!1,eliminado:!1}},T.editarFomracionAcademica=function(a,e){T.formacionAcademica=a,T.formacionAcademica.edit=!0},T.eliminarFomracionAcademica=function(a){a.eliminado=!0},T.agregarExperienciaLaboral=function(a){a.fecha_inicio=new Date(convertirFecha(a.fecha_inicio)),a.fecha_fin=new Date(convertirFecha(a.fecha_fin)),a.fecha_inicioTexto=T.fechaATexto(a.fecha_inicio),a.fecha_finTexto=T.fechaATexto(a.fecha_fin),T.hojaVida.experienciasLaborales.push(a),T.experienciaLaboral={edit:!1,eliminado:!1}},T.guardarExperienciaLaboralEditada=function(a){a.fecha_inicio=new Date(convertirFecha(a.fecha_inicio)),a.fecha_fin=new Date(convertirFecha(a.fecha_fin)),a.fecha_inicioTexto=T.fechaATexto(a.fecha_inicio),a.fecha_finTexto=T.fechaATexto(a.fecha_fin),T.experienciaLaboral={edit:!1,eliminado:!1}},T.editarExperienciaLaboral=function(a){a.fecha_inicio=T.fechaATexto(a.fecha_inicio),a.fecha_fin=T.fechaATexto(a.fecha_fin),T.experienciaLaboral=a,T.experienciaLaboral.edit=!0},T.eliminarExperienciaLaboral=function(a){a.eliminado=!0},T.agregarCapacidadHojaVida=function(a){a.fecha=new Date(convertirFecha(a.fecha)),a.fechaTexto=T.fechaATexto(a.fecha),T.hojaVida.capacidades.push(a),T.capacidad={edit:!1,eliminado:!1}},T.guardarCapacidadHojaVidaEditada=function(a){a.fecha=new Date(convertirFecha(a.fecha)),a.fechaTexto=T.fechaATexto(a.fecha),T.capacidad={edit:!1,eliminado:!1}},T.editarCapacidadHojaVida=function(a){a.fecha=T.fechaATexto(a.fecha),T.capacidad=a,T.capacidad.edit=!0},T.eliminarCapacidadHojaVida=function(a){a.eliminado=!0},T.agregarLogroHojaVida=function(a){a.fecha=new Date(convertirFecha(a.fecha)),a.fechaTexto=T.fechaATexto(a.fecha),T.hojaVida.logros.push(a),T.logro={edit:!1,eliminado:!1}},T.guardarLogroHojaVidaEditada=function(a){a.fecha=new Date(convertirFecha(a.fecha)),a.fechaTexto=T.fechaATexto(a.fecha),T.logro={edit:!1,eliminado:!1}},T.editarLogroHojaVida=function(a){a.fecha=T.fechaATexto(a.fecha),T.logro=a,T.logro.edit=!0},T.eliminarLogroHojaVida=function(a){a.eliminado=!0},T.GuardarHojaDeVida=function(){"Siguiente"!=$("#siguiente-s").text().trim()&&(T.empleado.activo?w(T.empleado.id,T.hojaVida).then(function(a){T.cerrarDialogHojaVida(),T.mostrarMensaje(a.mensaje),T.recargarItemsTabla()}):($("#formacion-academica").click(),T.cerrarDialogHojaVida()))},T.GuardarHojaDeVidaDirecto=function(){w(T.empleado.id,T.hojaVida).then(function(a){T.cerrarDialogHojaVida(),T.mostrarMensaje(a.mensaje),T.recargarItemsTabla()})},T.imprimirHojaVida=function(a){var o;a.capacidadInterna?((o=a).tipo="INTER",o.inicio&&o.fin?(o.inicio=new Date(convertirFecha(o.inicio)),o.fin=new Date(convertirFecha(o.fin))):(o.inicio=0,o.fin=0),U(o,T.hojaVida.id).then(function(a){T.capacidades=a.capacidades,convertUrlToBase64Image(T.empleado.imagen,function(a){var e=a;T.generarPdfHojaVida(e),o.inicio="",o.fin=""})})):((o=a).tipo="EXT",o.inicio=0,o.fin=0,U(o,T.hojaVida.id).then(function(a){T.capacidades=a.capacidades,convertUrlToBase64Image(T.empleado.imagen,function(a){var e=a;T.generarPdfHojaVida(e),o.inicio="",o.fin=""})}))},T.generarPdfHojaVida=function(u){M.start(),totalpaginastamaño=T.hojaVida.experienciasLaborales.length+T.hojaVida.formacionesAcademicas.length+T.capacidades.length,promesaPaciente=p(T.empleado.id),promesaPaciente.then(function(a){null!=a.clase&&(a.medicoPaciente.tipo_contrato=a.clase),T.empleado2=a.medicoPaciente;var e=new PDFDocument({compress:!1,size:[612,792],margin:10}),o=e.pipe(blobStream()),i=205,t=1,n=Math.ceil(totalpaginastamaño/20);T.dibujarCabeceraPDFHojaVida(e,1,n,u),e.font("Helvetica",7);for(var r=0;r<T.hojaVida.formacionesAcademicas.length;r++){if(formacion=T.hojaVida.formacionesAcademicas[r],e.text(formacion.anio_obtencion,80,i),e.text(formacion.institucion.nombre,170,i,{width:100}),e.text(formacion.grado.nombre,305,i,{width:100}),e.text(formacion.titulo.nombre,405,i,{width:100}),20<formacion.institucion.nombre.length||20<formacion.grado.nombre.length||20<formacion.titulo.nombre.length)rowinstituto=formacion.institucion.nombre.length/20,rowgrado=formacion.grado.nombre.length/20,rowtitulo=formacion.titulo.nombre.length/20,arregloTamaño=[Math.floor(rowinstituto),Math.floor(rowgrado),Math.floor(rowtitulo)],i+=10*Math.max.apply(null,arregloTamaño);0,725<=(i+=20)&&(e.addPage({margin:0,bufferPages:!0}),i=90,0,e.rect(25,i-20,550,15).fill("silver","#000"),e.font("Helvetica-Bold",8).fill("black"),e.text("GRADO DE INSTRUCCIONES",35,i),e.font("Helvetica-Bold",8),e.text("AÑO DE OBTENCIÓN",45,i),e.text("INSTITUCIÓN",170,i),e.text("GRADO",305,i),e.text("CARRERA",405,i),t+=1,e.text("PÁGINA "+t+" DE "+n,0,750,{align:"center"}),e.font("Helvetica",7))}for(var c=0;c<T.capacidades.length;c++){var s=T.capacidades[c];if(0==c&&(i+=15,e.rect(25,i-20,550,15).fill("silver","#000"),e.font("Helvetica-Bold",8).fill("black"),e.text("CURSO,CAPACIDADES Y SEMINARIOS",35,i-15),e.font("Helvetica-Bold",8),e.text("FECHA",45,i),e.text("INSTITUCIÓN",170,i),e.text("GRADO",305,i),e.text("CARRERA",405,i),i+=20),e.font("Helvetica",8),s.fechaTexto=T.fechaATexto(s.fecha),e.text(s.fechaTexto,40,i,{width:100}),e.text(s.curso,170,i,{width:100}),e.text(s.institucion,305,i,{width:80}),e.text(s.certificado,405,i,{width:100}),20<s.curso.length||17<s.institucion.length||20<s.certificado.length)rowcurso=s.curso.length/20,rowinstituto=s.institucion.length/17,rowcertificado=s.certificado.length/20,arregloTamaño=[Math.floor(rowcurso),Math.floor(rowinstituto),Math.floor(rowcertificado)],i+=10*Math.max.apply(null,arregloTamaño);0,725<=(i+=20)&&(e.addPage({margin:0,bufferPages:!0}),i=90,0,e.rect(25,i-20,550,15).fill("silver","#000"),e.font("Helvetica-Bold",8).fill("black"),e.text("CURSO,CAPACIDADES Y SEMINARIOS",35,i-15),e.font("Helvetica-Bold",8),e.text("FECHA",45,i),e.text("INSTITUCIÓN",170,i),e.text("GRADO",305,i),e.text("CARRERA",405,i),i+=20,t+=1,e.text("PÁGINA "+t+" DE "+n,0,750,{align:"center"}),e.font("Helvetica",7))}for(var l=0;l<T.hojaVida.experienciasLaborales.length;l++){var d=T.hojaVida.experienciasLaborales[l];if(0==l&&(i+=15,e.rect(25,i-20,550,15).fill("silver","#000"),e.font("Helvetica-Bold",8).fill("black"),e.text("EXPERIENCIA LABORAL",35,i-15),e.font("Helvetica-Bold",8),e.text("DESDE",45,i),e.text("HASTA",120,i),e.text("EMPRESA",205,i),e.text("CARGO",305,i),e.text("REFERENCIA",385,i),e.text("TELEFONO",485,i),i+=20),e.font("Helvetica",8),e.text(d.fecha_inicioTexto,40,i,{width:100}),e.text(d.fecha_finTexto,115,i,{width:100}),e.text(d.empresa,205,i,{width:80}),e.text(d.cargo,305,i,{width:60}),e.text(d.contacto,385,i,{width:100}),e.text(d.telefono,485,i,{width:100}),17<d.empresa.length||13<d.cargo.length||20<d.contacto.length)rowempresa=d.empresa.length/17,rowcargo=d.cargo.length/13,rowcontacto=d.contacto.length/20,arregloTamaño=[Math.floor(rowempresa),Math.floor(rowcargo),Math.floor(rowcontacto)],i+=10*Math.max.apply(null,arregloTamaño);0,725<=(i+=20)&&(i+=20,e.addPage({margin:0,bufferPages:!0}),i=90,0,e.rect(25,i-20,550,15).fill("silver","#000"),e.font("Helvetica-Bold",8).fill("black"),e.text("EXPERIENCIA LABORAL",35,i-15),e.font("Helvetica-Bold",8),e.text("DESDE",45,i),e.text("HASTA",120,i),e.text("EMPRESA",205,i),e.text("CARGO",305,i),e.text("REFERENCIA",385,i),e.text("TELEFONO",485,i),i+=20,t+=1,e.text("PÁGINA "+t+" DE "+n,0,750,{align:"center"}),e.font("Helvetica",7))}e.end(),o.on("finish",function(){var a=o.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),M.stop()})},T.dibujarCabeceraPDFHojaVida=function(a,e,o,i){a.font("Helvetica-Bold",12),a.rect(25,30,550,20).fill("silver","#000"),a.font("Helvetica-Bold",12).fill("black"),a.text("HOJA DE VIDA",0,35,{align:"center"}),a.image(i,400,70,{width:80,height:80}),a.font("Helvetica-Bold",10),a.font("Helvetica-Bold",8),a.text("PÁGINA "+e+" DE "+o,0,750,{align:"center"}),a.font("Helvetica-Bold",8),a.text("NOMBRE Y APELLIDO:",45,60),a.text("NACIONALIDAD:",45,70),a.text("LUGAR DE NACIMIENTOS:",45,80),a.text("RESIDENCIA ACTUAL:",45,90),a.text("DIRECCION:",45,100),a.text("CI:",45,110),a.text("ESTADO CIVIL:",45,120),a.text("TELEFONO:",45,130),a.text("CELULAR:",45,140),a.text("E-MAIL:",45,150),a.font("Helvetica",8),a.text(T.empleado2.persona.nombre_completo,170,60),a.text(T.empleado2.persona.pais_nacimiento,170,70),a.text(T.empleado2.persona.ciudad_nacimiento+" / "+T.empleado2.persona.provincia_nacimiento+" / "+T.empleado2.persona.localidad_nacimiento,170,80),a.text("",170,90),a.text(T.empleado2.persona.direccion_zona,170,100),a.text(T.empleado2.persona.ci,170,110),a.text(T.empleado2.persona.estado_civil,170,120),a.text(T.empleado2.persona.telefono,170,130),a.text(T.empleado2.persona.telefono_movil,170,140),a.text(T.empleado2.persona.correo_electronico,170,150),a.rect(25,165,550,15).fill("silver","#000"),a.font("Helvetica-Bold",8).fill("black"),a.text("GRADO DE INSTRUCCIONES",35,170),a.font("Helvetica-Bold",8),a.text("AÑO DE OBTENCIÓN",45,185),a.text("INSTITUCIÓN",170,185),a.text("GRADO",305,185),a.text("CARRERA",405,185)},T.llenarHistoricoCertificado=function(a){T.historialContratos=[];for(var e=0;e<a.length;e++){var o="",i=T.fechaATexto(a[e].fecha_inicio);if(null!=a[e].fecha_fin)o=T.fechaATexto(a[e].fecha_fin);var t={nombre:i+"-"+o,maker:"",ticked:!1,id:a[e].id};T.historialContratos.push(t)}},T.generarPdfCertificado=function(a){var e=new PDFDocument({size:[612,792],margins:{top:10,bottom:10,left:20,right:20}}),o=e.pipe(blobStream());0==a.tipo?T.dibujarPdfCertificadoHojaVida(e,a):T.dibujarPdfCertificadoPrestamo(e,a),e.end(),o.on("finish",function(){var a=o.toBlobURL("application/pdf");window.open(a,"_blank","location=no")})},T.dibujarPdfCertificadoHojaVida=function(a,e){var o=new Date,i="",t="",n=o.getMonth();T.meses.forEach(function(a){a.id==n&&(i=a.nombre)}),T.ficha.cargo.forEach(function(a){t=""==t?a.nombre:t+", "+a.nombre}),a.font("Times-Roman",12),a.text("Santa Cruz, "+o.getDate()+" de "+i+" de "+o.getFullYear(),0,75,{align:"center"}),a.font("Times-Roman",24),a.text("CERTIFICADO DE TRABAJO",0,150,{align:"center"}),a.font("Times-Roman",13);var r="EMSERSO SA., certifica que "+T.ficha.empleado.persona.nombre_completo+" con CI."+T.ficha.empleado.persona.ci+" "+T.ficha.empleado.extension.nombre+", trabajó (a) como "+t+", durante los siguientes periodos:";a.text(r,100,230,{width:412,align:"left",indent:0,columns:1,height:300,ellipsis:!0});for(var c=250,s=0;s<e.historialContratos.length;s++){var l=e.historialContratos[s].nombre.split("-");a.text("Desde el "+l[0]+" al "+l[1],100,c,{width:412,align:"left",indent:0,columns:1,height:300,ellipsis:!0}),c+=20}a.text("Es cuanto certifico para los fines que convengan al interesado.",100,c+20,{align:"left"}),a.text("Lic. Rosangela Velasques S.",100,695),a.text("JEFA DE RECURSOS HUMANOS",100,715)},T.dibujarPdfCertificadoPrestamo=function(a,e){var o=new Date,i="",t="",n="",r=o.getMonth();T.meses.forEach(function(a){a.id==r&&(i=a.nombre)}),T.ficha.cargo.forEach(function(a){t=""==t?a.nombre:t+", "+a.nombre});for(var c=0;c<e.historialContratos.length;c++){var s=e.historialContratos[c].nombre.split("-"),l=s[0].split("/"),d=s[1].split("/");fechaIni=new Date(l[0],l[1],l[2]);var u=new Date(d[0],d[1],d[2]),p=fechaIni.getMonth(),f=u.getMonth();T.meses.forEach(function(a){a.id==p&&(p=a.nombre)}),T.meses.forEach(function(a){a.id==f&&(f=a.nombre),""==s[1]&&(f="")}),n=""==n?""!=f?"el "+fechaIni.getDate()+" de "+p+" de "+fechaIni.getFullYear()+" al "+u.getDate()+" de "+f+" de "+u.getFullYear():"el "+fechaIni.getDate()+" de "+p+" de "+fechaIni.getFullYear()+".":""!=f?n+",  renovando contrato con la empresa a partir del "+fechaIni.getDate()+" de "+p+" de "+fechaIni.getFullYear()+" al "+u.getDate()+" de "+f+" de "+u.getFullYear():n+",  renovando contrato con la empresa a partir del "+fechaIni.getDate()+" de "+p+" de "+fechaIni.getFullYear(),c===e.historialContratos.length-1&&(n=n+". Percibiendo un sueldo aproximado mensual de Bs."+T.ficha.haber_basico+".- ("+T.ficha.haber_basico_literal+")")}a.font("Times-Roman",12),a.text("Santa Cruz, "+o.getDate()+" de "+i+" de "+o.getFullYear(),0,75,{align:"center"}),a.font("Times-Roman",24),a.text("CERTIFICADO DE TRABAJO",0,150,{align:"center"}),a.font("Times-Roman",13);var m="EMSERSO SA., certifica que "+T.ficha.empleado.persona.nombre_completo+" con CI."+T.ficha.empleado.persona.ci+" "+T.ficha.empleado.extension.nombre+", trabaja en nuestra empresa como "+t+" desde "+n;a.text(m,100,230,{width:412,align:"justify",indent:0,columns:1,lineGap:10,wordSpacing:1,height:300,ellipsis:!0}),a.moveDown(2),a.text("Es cuanto certifico para los fines que convengan al interesado.",{align:"left"}),a.text("Lic. Rosangela Velasques S.",100,695),a.text("JEFA DE RECURSOS HUMANOS",100,715)},T.calcularCuota=function(a){var e=a.monto/a.plazo,o=e*a.interes_pactado/100;a.cuota=e+o,a.cuota2=T.number_format(a.cuota,2);for(var i=0,t=a.plazo;i++,(t-=12)<=12&&t,12<t;);12<a.plazo?a.tiempo_plazo_literal=i+" año y "+(a.plazo-12*i)+" meses":a.tiempo_plazo_literal=a.plazo+" meses"},T.GuardarPrestamo=function(e){e.id_usuario=T.usuario.id,e.fecha_inicial=new Date(T.convertirFecha(e.fecha_inicial)),e.total=e.monto*e.interes_pactado/100+e.monto,S(T.empleado.id,e).then(function(a){T.imprimirPrestamo(e),T.cerrarDialogNuevoPrestamo(),T.prestamo={},T.mostrarMensaje(a.mensaje)})},T.GuardarMultiplesPrestamos=function(a){a.id_usuario=T.usuario.id,a.fecha_inicial=T.convertirFecha(a.fecha_inicial),a.total=a.monto*a.interes_pactado/100+a.monto,S(0,a).then(function(a){T.cerrarDialogPretamosNuevoTodos(),T.optenerListaPrestamos(),T.mostrarMensaje(a.mensaje),T.prestamo={}})},T.imprimirPrestamo=function(a){var e=new PDFDocument({size:[792,612],margins:{top:10,bottom:10,left:20,right:20}}),o=e.pipe(blobStream());e.rect(40,90,712,432).stroke(),e.rect(635,125,100,30).stroke(),e.font("Helvetica-Bold",16),e.text("Nro. 11111",640,133),e.font("Helvetica-Bold",14),e.text(T.usuario.empresa.razon_social,65,95),e.text("Santa Cruz- Bolivia",55,110),e.text("NIT: ",55,125),e.font("Helvetica",14),e.text(T.usuario.empresa.nit+".",80,125),e.font("Helvetica-Bold",14),e.text("PRESTAMO AL PERSONAL",0,135,{align:"center"}),e.font("Helvetica-Bold",14),e.text("Empleado ",55,175),e.text("Monto otorgado ",55,200),e.text("Interés Pactado ",55,225),e.text("Fecha des desembolso ",55,250),e.text("Plazo ",55,275),e.text("Monto Mensual ",55,300),e.text("Observaciones ",55,325),e.text("Sueldo Básico ",55,350),e.font("Helvetica",14),e.text(T.empleado.nombre_completo,220,175),e.text(T.number_format(a.monto,2),220,200),e.text(a.interes_pactado+"%",220,225);var i=T.fechaATexto(a.fecha_inicial);e.text(i,220,250),e.text(a.plazo,220,275),e.text(a.cuota2,220,300),e.text(a.observacion,220,325),e.text(T.number_format(T.empleado.haber_basico,2),220,350),e.font("Helvetica-Bold",14),e.text("Recibí Conforme ",55,500),e.text("Responsable de Área ",225,500),e.text("Encargado RRHH ",425,500),e.text("Contabilidad ",605,500),e.end(),o.on("finish",function(){var a=o.toBlobURL("application/pdf");window.open(a,"_blank","location=no")})},T.GuardarPagoPrestamo=function(a){if(0<a.prestamoPagos.length){var e=a.monto_pagado+a.prestamoPagos[a.prestamoPagos.length-1].a_cuenta_anterior,o=(a.total-e)/a.plazo_restante;a.cuota2=o}else{o=(a.total-a.monto_pagado)/a.plazo_restante;a.cuota2=o}a.pagoFecha=new Date,I(T.usuario.id,T.prestamo.id,a).then(function(a){T.cerrarDialogPagoPrestamo(),T.optenerListaPrestamos(),T.prestamo={},T.mostrarMensaje(a.mensaje)})},T.abrirModalVerificarCuenta=function(a,e){T.dato=a,T.tipoDatosPermiso=e,T.abrirPopup(T.IdModalVerificarCuenta)},T.cerrarModalVerificarCuenta=function(){T.cerrarPopup(T.IdModalVerificarCuenta)},T.EditarMontoPrestamo=function(i){i.montoEdit=!1,i.total=i.monto*i.interes_pactado/100+i.monto;var a=i.monto/i.plazo,e=a*i.interes_pactado/100;(i.cuota=a+e,0<i.prestamoPagos.length)?i.prestamoPagos.forEach(function(a,e,o){(a.saldo_anterior=i.total-a.a_cuenta_anterior,e===o.length-1)&&N(i).then(function(a){T.mostrarMensaje(a.mensaje)})}):N(i).then(function(a){T.mostrarMensaje(a.mensaje)})},T.CancelarEditMontoPrestamo=function(a){T.optenerListaPrestamos()},T.verificarCuentaAdmin=function(a){O.save({id_empresa:T.usuario.id_empresa},a,function(a){a.type?(T.mostrarMensaje(a.message),"anticipo"==T.tipoDatosPermiso&&(T.dato.montoEdit?T.dato.montoEdit=!1:T.dato.montoEdit=!0),"datosLaborales"==T.tipoDatosPermiso&&(T.dato.editDatosLaborales?T.dato.editDatosLaborales=!1:T.dato.editDatosLaborales=!0),"finiquito"==T.tipoDatosPermiso&&(T.cuenta={},T.abrirDialogBeneficiosSociales2(T.dato,!0)),"dotacion"==T.tipoDatosPermiso&&(T.cuenta={},T.abrirDialogEliminarRopaTrabajo()),"rolturnoEmpleado"==T.tipoDatosPermiso&&(T.cuenta={},T.editarRoldeTurno(T.dato)),"cerrarRolturnoEmpleado"==T.tipoDatosPermiso&&(T.cuenta={},T.abrirDialogCerrarRolDeTurno()),T.cerrarModalVerificarCuenta()):T.mostrarMensaje(a.message)})},T.obtenerListaEmpleados=function(){B(T.usuario.id_empresa).then(function(i){i.empleados.forEach(function(a,e,o){a.ficha=a.empleadosFichas[0],e===o.length-1&&T.llenarEmpleados(i.empleados)})})},T.llenarEmpleados=function(a){T.todosLosEmpleados=[];for(var e=0;e<a.length;e++){var o={nombre:a[e].persona.nombre_completo,persona:a[e].persona,ficha:a[e].ficha,maker:"",ticked:!1,id:a[e].id};T.todosLosEmpleados.push(o),e===a.length-1&&T.seleccionarEmpleados(T.empleadosSeleccionados)}},T.seleccionarEmpleados=function(a){for(var e=0;e<T.todosLosEmpleados.length;e++)for(var o=0;o<a.length;o++)a[e].select&&(T.todosLosEmpleados[e].ticked=!0)},T.GuardarRolTurno=function(e){e.fecha_inicio=new Date(T.convertirFecha(e.fecha_inicio)),e.fecha_fin&&(e.fecha_fin=new Date(T.convertirFecha(e.fecha_fin))),e.id_ficha=T.empleado.id_ficha,F(T.empleado.id,e).then(function(a){e={},T.cerrarDialogRolTurnos(),T.mostrarMensaje(a.mensaje)})},T.GuardarCierreRolTurno=function(a){a.fecha_fin=new Date(T.convertirFecha(a.fecha_fin)),F(T.empleado.id,a).then(function(a){T.cerrarDialogCerrarRolDeTurno(),T.mostrarMensaje(a.mensaje)})},T.calcularDatosRolTurno=function(i){var t=!0;if(0<T.empleadosRolTurnoE.length){var n="";contFijos=0,T.empleadosRolTurnoE.forEach(function(a,e,o){1==a.tipo&&(contFijos++,t=!1,a.fecha_fin?(t=!0,n=T.fechaATexto(sumaFecha(1,a.fecha_fin))):n=T.fechaATexto(sumaFecha(a.dias_trabajado,a.fecha_inicio))),e===o.length-1&&(t?i.tipo?(i.fecha_fin="",i.dias_trabajado=14,i.dias_descanso=7):(i.dias_trabajado=7,i.dias_descanso=0):1<contFijos?(i.tipo=!1,T.mostrarMensaje("ya cuenta con dos roles de turno fijos, las asignaciones de fechas estan copadas!. Para asignar otro rol de turno fijo debe dar de baja 1")):i.tipo&&(i.blokearDatos=!0,i.dias_trabajado=7,i.dias_descanso=14,T.mostrarMensaje("ya cuenta con un rol turno fijo,se genero otro con la configuracion fija!"),i.fecha_inicio=n))})}else i.tipo?(i.fecha_fin="",i.dias_trabajado=14,i.dias_descanso=7):(i.dias_trabajado=7,i.dias_descanso=0)},T.editarRoldeTurno=function(a){a.fecha_inicio=T.fechaATexto(a.fecha_inicio),a.fecha_fin&&(a.fecha_fin=T.fechaATexto(a.fecha_fin)),T.cerrarDialogHistorialTurnos(),T.rolTurno=a},T.obtenerlistaRolTurno=function(a){M.start(),Y(T.usuario.id_empresa,a).then(function(a){T.empleadosRolTurnoE=a.rolesTurno,T.fechaInicioCalendario=T.fechaATexto(new Date(a.fechaInicio)),M.stop()})},T.obtenerlistaRolTurnoCal=function(){T.paginator=c(),T.paginator.column="id",T.paginator.direccion="asc",T.paginator.itemsPerPage=10,T.filtroRolCal={empresa:T.usuario.id_empresa,inicio:"",fin:"",grupo:"",nombre:"",campo:""},T.paginator.callBack=T.listaRolTurnoCal,T.paginator.getSearch("",T.filtroRolCal,null)},T.listaRolTurnoCal=function(){M.start(),Ia(T.paginator).then(function(a){T.paginator.setPages(a.paginas),T.empleadosRolTurno=a.rolesTurno,T.fechaInicioCalendario=T.fechaATexto(new Date(a.fechaInicio));var e=new Date,o=new Date(e.getFullYear(),12,0).getDate(),i="",t="",n="",r="",c="";T.filtroRolCal.inicio2&&(i=T.filtroRolCal.inicio2),T.filtroRolCal.fin2&&(r=T.filtroRolCal.fin2),T.filtroRolCal.grupo&&(t=T.filtroRolCal.grupo),T.filtroRolCal.nombre&&(n=T.filtroRolCal.nombre),T.filtroRolCal.campo&&(c=T.filtroRolCal.campo),T.filtroRolCal={campo:c,nombre:n,grupo:t,empresa:T.usuario.id_empresa,fin2:r,inicio2:i,inicio:T.fechaInicioCalendario,fin:o+"/12/"+e.getFullYear()},T.realizarCalendarioTrabajo(T.filtroRolCal),M.stop()})},T.obtenerlistaRolTurnoEmpresa=function(){Ca(T.paginator).then(function(a){T.paginator.setPages(a.paginas),T.listaRolTurnoFiltro=a.rolesTurno})},T.guardarHorasExtra=function(a){a.fecha=new Date(T.convertirFecha(a.fecha)),a.hora_inicio2=T.fechaATiempo(a.hora_inicio),a.hora_fin2=T.fechaATiempo(a.hora_fin),a.id_ficha=T.empleado.id_ficha,L(T.empleado.id,a).then(function(a){T.cerrarDialogHorasExtras(),T.horaExtra={},T.mostrarMensaje(a.mensaje)})},T.calcularTiempoHorasExtra=function(a){if(a.hora_inicio instanceof Date&&a.hora_fin instanceof Date){var e=a.hora_inicio.getHours(),o=a.hora_fin.getHours(),i=a.hora_inicio.getMinutes(),t=a.hora_fin.getMinutes();if(e<o){var n=moment(a.hora_inicio).format("YYYY-MM-DD HH:mm:ss"),r=moment(a.hora_fin).format("YYYY-MM-DD HH:mm:ss"),c=moment(n,"YYYY-MM-DD HH:mm:ss"),s=moment(r,"YYYY-MM-DD HH:mm:ss").diff(c,"s");a.tiempo=T.caluclarDiferencia(s)}else if(e==o&&i<t){n=moment(a.hora_inicio).format("YYYY-MM-DD HH:mm:ss"),r=moment(a.hora_fin).format("YYYY-MM-DD HH:mm:ss"),c=moment(n,"YYYY-MM-DD HH:mm:ss"),s=moment(r,"YYYY-MM-DD HH:mm:ss").diff(c,"s");a.tiempo=T.caluclarDiferencia(s)}else a.tiempo=""}},T.fechaATiempo=function(a){var e=a.getHours(),o=a.getMinutes(),i=a.getSeconds();return(e=e<10?"0"+e:e)+":"+(o=o<10?"0"+o:o)+":"+(i=i<10?"0"+i:i)},T.caluclarDiferencia=function(a){var e=Math.floor(a/3600),o=Math.floor(a%3600/60),i=a%60;return e+":"+(o=o<10?"0"+o:o)+":"+(i=i<10?"0"+i:i)},T.obtenerHistorialHorasExtra=function(a){var e={};e.inicio=10==a.inicio.length?new Date(T.convertirFecha(a.inicio)):0,e.fin=10==a.fin.length?new Date(T.convertirFecha(a.fin)):0,q(T.empleado.id_ficha,e).then(function(a){T.ListaHorasExtraEmpleado=a,0<T.ListaHorasExtraEmpleado.length?T.sumarTotalHorasExtra():T.SumaTotalHorasExtra="00:00"})},T.sumarTotalHorasExtra=function(){for(var a="",e=0,o=0,i=0;i<T.ListaHorasExtraEmpleado.length;i++){var t=T.ListaHorasExtraEmpleado[i].tiempo.split(":")[1],n=T.ListaHorasExtraEmpleado[i].tiempo.split(":")[0];e+=parseInt(n),60<=(o+=parseInt(t))&&(o-=60,e+=1),a=String("0"+e).slice(-3)+":"+String("0"+o).slice(-2)}T.SumaTotalHorasExtra=a},T.GuardarAnticipos=function(a){var e=a.slice(-1).pop();e.montoExtraoridnario=e.total-e.anticipo_ordinaro,e.textoClase="EXTRAORDI",e.fecha=(new Date).getTime(),G(T.empleado.id,e).then(function(a){e={},T.cerrarDialogAnticipoExtraordinario(),T.mostrarMensaje(a.mensaje)})},T.GuardarAnticiposEmpleados=function(a){var i={};i.anticipos=a,i.textoClase="ORDI",i.fecha=(new Date).getTime(),i.anticipos.forEach(function(e,a,o){(e.montoordinario=e.monto+e.anticipo_ordinaro,a===o.length-1)&&J(i).then(function(a){e={},T.listaAnticipos2=[],T.cerrarDialogAnticipoRegular(),T.mostrarMensaje(a.mensaje)})})},T.buscarAnticiposExtraoridnario=function(a){T.anticipo_extraordinaro=0;var e=new Date(a.gestion,a.mes.id,1),o={inicio:new Date(e.getFullYear(),e.getMonth(),1),fin:new Date(e.getFullYear(),e.getMonth()+1,0),nombre:"ORDI",id_empresa:0};T.obtenerListaAnticipos(o,T.empleado.id)},T.buscarAnticiposOridnario=function(a){if(null!=a.gestion){T.anticipo_extraordinaro=0;var e=new Date(a.gestion,a.mes.id,1),o={inicio:new Date(e.getFullYear(),e.getMonth(),1),fin:new Date(e.getFullYear(),e.getMonth()+1,0),nombre:"EXTRAORDI",id_empresa:T.usuario.id_empresa};T.obtenerListaAnticiposOrdi(o,0)}},T.obtenerListaAnticipos=function(c,a){T.anticipo_ordinaroOextra=0;var e=z(c,a);T.arregloid=[],e.then(function(r){0<r.anticipos.length?(r.anticipos.ordinarios=[],r.anticipos.extraordinarios=[],r.anticipos.forEach(function(a,e,o){if(a.empleado.ficha=a.empleado.empleadosFichas[a.empleado.empleadosFichas.length-1],a.total2=0,a.tipoAnticipo.nombre_corto!=c.nombre?r.anticipos.ordinarios.push(a):(T.anticipo_ordinaroOextra+=a.monto,r.anticipos.extraordinarios.push(a)),e===o.length-1)for(var i=0;i<r.anticipos.ordinarios.length;i++){var t=r.anticipos.ordinarios[i];if(0<r.anticipos.extraordinarios.length)for(var n=0;n<r.anticipos.extraordinarios.length;n++){(a=r.anticipos.extraordinarios[n]).id_empleado==t.id_empleado?(t.anticipo_ordinaro?t.anticipo_ordinaro+=a.monto:t.anticipo_ordinaro=a.monto,t.saldo_salario=t.salario_basico-t.total,t.montoEdit=!1):(t.anticipo_ordinaro=0,t.saldo_salario=t.salario_basico-t.total)}else t.anticipo_ordinaro=0,t.saldo_salario=t.salario_basico-t.total;i===r.anticipos.ordinarios.length-1&&(T.listaAnticipos=r.anticipos.ordinarios)}})):T.listaAnticipos=[]})},T.obtenerListaAnticiposOrdi=function(c,a){T.anticipo_ordinaroOextra=0,T.listaAnticipos=[];var e=z(c,a);T.arregloid=[],e.then(function(r){0<r.anticipos.length?(r.anticipos.ordinarios=[],r.anticipos.extraordinarios=[],r.anticipos.forEach(function(a,e,o){if(a.empleado.ficha=a.empleado.empleadosFichas[a.empleado.empleadosFichas.length-1],a.total2=0,a.anticipo_extraordinaro=0,a.saldo_salario=a.salario_basico-a.total,a.tipoAnticipo.nombre_corto!=c.nombre?r.anticipos.ordinarios.push(a):r.anticipos.extraordinarios.push(a),e===o.length-1){null==T.anticiposDatos&&(T.anticiposDatos={ordinarios:r.anticipos.ordinarios,extraordinarios:r.anticipos.extraordinarios});for(var i=0;i<r.anticipos.ordinarios.length;i++){for(var t=r.anticipos.ordinarios[i],n=0;n<r.anticipos.extraordinarios.length;n++){(a=r.anticipos.extraordinarios[n]).id_empleado==t.id_empleado?(t.anticipo_extraordinaro?t.anticipo_extraordinaro+=a.monto:t.anticipo_extraordinaro=a.monto,t.saldo_salario=t.salario_basico-t.total,t.montoEdit=!1):(t.anticipo_ordinaro?t.anticipo_ordinaro+=a.monto:t.anticipo_ordinaro=a.monto,t.anticipo_extraordinaro=0,t.saldo_salario=t.salario_basico-t.total)}i===r.anticipos.ordinarios.length-1&&(T.listaAnticipos=r.anticipos.ordinarios)}}})):T.listaAnticipos=[]})},T.EliminarAnticipo=function(a){T.listaAnticipos2.splice(a,1)},T.AgregarAnticipoOrdinario=function(r){var c=r.monto,s=0,l=null;s=r.tope?r.tope:null,r.empleados.forEach(function(a,e,o){if(r.tipo&&(c=a.ficha.haber_basico*r.monto/100,l=r.monto),c=parseFloat(c.toFixed(2)),0==T.listaAnticipos2.length)var i={fecha:new Date,empleado:a,monto:c,anticipo_extraordinaro:null,total:null,salario_basico:a.ficha.haber_basico,saldo_salario:a.haber_basico,tope:s,tipo_porcentual:r.tipo,porcentaje:l};else(i={fecha:new Date,empleado:a,monto:c,anticipo_extraordinaro:null,total:null,salario_basico:a.ficha.haber_basico,saldo_salario:null,tope:s,tipo_porcentual:r.tipo,porcentaje:l}).saldo_salario=i.salario_basico-i.total;if(i.anticipo_extraordinaro=0,i.anticipo_ordinaro=0,T.anticiposDatos){if(0<T.anticiposDatos.ordinarios.length)for(var t=0;t<T.anticiposDatos.ordinarios.length;t++){var n=T.anticiposDatos.ordinarios[t];i.empleado.id==n.id_empleado&&(i.anticipo_ordinaro+=n.monto)}if(0<T.anticiposDatos.extraordinarios.length)for(t=0;t<T.anticiposDatos.extraordinarios.length;t++){n=T.anticiposDatos.extraordinarios[t];i.empleado.id==n.id_empleado&&(i.anticipo_extraordinaro+=n.monto)}}else i.anticipo_ordinaro=0,i.anticipo_extraordinaro=0;i.total=i.anticipo_extraordinaro+i.anticipo_ordinaro+i.monto,i.total2=i.anticipo_extraordinaro+i.anticipo_ordinaro+i.monto,i.saldo_salario=i.salario_basico-i.total,i.saldo_salario2=i.salario_basico-i.total,T.listaAnticipos2.push(i),e===o.length-1&&(T.cerrarDialogNuevoAnticipoRegularTodos(),T.anticipo={})})},T.AgregarAnticipoExtraordinario=function(){if(0==T.listaAnticipos.length){var a={fecha:new Date,monto:null,total2:T.anticipo_ordinaroOextra,anticipo_ordinaro:T.anticipo_ordinaroOextra,total:T.anticipo_ordinaroOextra,salario_basico:T.empleado.haber_basico,saldo_salario:T.empleado.haber_basico,empleado:T.empleado};T.listaAnticipos.push(a)}else{if(T.listaAnticipos[T.listaAnticipos.length-1].id)(a={fecha:new Date,monto:null,anticipo_ordinaro:T.anticipo_ordinaroOextra,total:T.listaAnticipos[T.listaAnticipos.length-1].total,salario_basico:T.empleado.haber_basico,saldo_salario:null,empleado:T.empleado}).saldo_salario=a.salario_basico-a.total,T.listaAnticipos.push(a);else T.mostrarMensaje("cuenta con 1 anticipo sin guardar!")}},T.sumarMontoPrestamoNuevo=function(a,e){1<T.listaAnticipos.length?a.monto?0<e&&T.listaAnticipos[e-1].empleado.id==T.listaAnticipos[e].empleado.id?a.total=T.listaAnticipos[e-1].total+a.monto:a.anticipo_ordinaro?a.total=a.monto+a.anticipo_ordinaro:a.total=a.monto+a.anticipo_extraordinaro:a.anticipo_ordinaro?a.total=a.anticipo_ordinaro:a.total=a.anticipo_extraordinaro:(a.total2=a.anticipo_ordinaro,a.monto?a.total=a.total2+a.monto:a.anticipo_ordinaro?a.total=a.anticipo_ordinaro:a.total=a.anticipo_extraordinaro),a.saldo_salario=a.salario_basico-a.total},T.sumarMontoPrestamoNuevo2=function(a){a.total=a.anticipo_extraordinaro+a.monto+a.anticipo_ordinaro,a.saldo_salario=a.salario_basico-a.total},T.ActualizarAnticipo=function(e){e.montoExtraoridnario=e.total-e.anticipo_ordinaro,X(e.id_empleado,e).then(function(a){e.montoEdit=!1,T.cerrarDialogAnticipoExtraordinario(),T.mostrarMensaje(a.mensaje)})},T.ActualizarAnticipoOrdi=function(e){if(e.anticipo_ordinaro=0,T.anticiposDatos&&0<T.anticiposDatos.ordinarios.length)for(var a=0;a<T.anticiposDatos.ordinarios.length;a++){var o=T.anticiposDatos.ordinarios[a];e.empleado.id==o.id_empleado&&e.id!=o.id&&(e.anticipo_ordinaro+=o.monto)}e.montoExtraoridnario=e.total-e.anticipo_extraordinaro,X(e.id_empleado,e).then(function(a){e.montoEdit=!1,T.cerrarDialogAnticipoExtraordinario(),T.mostrarMensaje(a.mensaje)})},T.cancelarEdicionAnticipo=function(){T.obtenerAnticiposExtra(T.empleado)},T.cancelarEdicionAnticipo=function(){T.obteneranticiposOrdi()},T.imprimirAnticipoRegular=function(a,e){var o=new PDFDocument({compress:!1,size:"letter",margin:10}),i=o.pipe(blobStream()),t=205,n=0,r=1,c=Math.ceil(a.length/18);T.DibujarCabeceraPDFAnticipoRegular(o,r,c,a,e),o.font("Helvetica",10);for(var s=0;s<a.length&&n<=18;s++)anticipo=a[s],o.text(s+1,45,t),o.text(anticipo.empleado.codigo,80,t,{width:70}),o.text(anticipo.empleado.persona.nombre_completo,200,t,{width:100}),o.text(anticipo.monto,320,t,{width:100}),o.text(anticipo.empleado.ficha.banco.nombre,400,t,{width:100}),o.text(".......... ",500,t+2,{width:100}),t+=30,18==++n&&(o.addPage({margin:0,bufferPages:!0}),t=205,n=0,r+=1,T.DibujarCabeceraPDFAnticipoRegular(o,r,c,a,e),o.font("Helvetica",10));o.end(),i.on("finish",function(){var a=i.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),M.stop()},T.DibujarCabeceraPDFAnticipoRegular=function(t,n,r,a,c){var s=0,l=0,d=!1,u=0,p=!1,f=!1,m=0,h=0,g="",b="";a.forEach(function(a,e,o){if(0==e?(s=a.tope,l=a.tipo_porcentual,h=a.porcentaje,g=T.fechaATexto(a.fecha)):(a.tope!=s&&(d=!0),a.tipo_porcentual!=l&&(p=!0),T.fechaATexto(a.fecha)!=g&&(f=!0)),e===o.length-1){m=p?"Diferentes tipos":l=l?"Porcentual "+h+"%":"Monto",b=f?"Diferentes fechas":g,u=null==(u=d?"Diferentes Topes":s)?"Sin restricción":u,t.font("Helvetica-Bold",14),t.text("LISTA DE ANTICIPOS",0,45,{align:"center"}),t.font("Helvetica-Bold",12),t.text("PERIODO : ",45,100),t.text("FECHA DE CREACIÓN : ",45,120),t.text("USUARIO : ",45,140),t.text("TIPO DE ANTICIPO : ",45,160),t.text("TOPE: ",345,160),t.font("Helvetica",12),b instanceof Date&&(b=T.fechaATexto(b)),t.fillColor("blue"),t.text(b,185,120),t.text(T.usuario.persona.nombre_completo,115,140),t.text(c.mes.nombre+" "+c.gestion,115,100),t.text(m,175,160),t.text(u,385,160),t.fillColor("black"),t.font("Helvetica-Bold",12),t.text("Nro.",45,180),width=t.widthOfString("Nro."),height=t.currentLineHeight(),t.underline(45,181,width,height),t.text("Cod. Emp.",80,180),width=t.widthOfString("Cod. Emp."),height=t.currentLineHeight(),t.underline(80,181,width,height),t.text("Nombre",200,180),width=t.widthOfString("Nombre"),height=t.currentLineHeight(),t.underline(200,181,width,height),t.text("Monto",320,180),width=t.widthOfString("Monto"),height=t.currentLineHeight(),t.underline(320,181,width,height),t.text("Mod. ",400,180),width=t.widthOfString("Mod"),height=t.currentLineHeight(),t.underline(400,181,width,height),t.text("Firma. ",500,180),width=t.widthOfString("Firma"),height=t.currentLineHeight(),t.underline(500,181,width,height),t.font("Helvetica",8);var i=new Date;t.text("USUARIO: "+T.usuario.persona.nombre_completo+" fecha "+i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear()+"Hrs."+i.getHours()+":"+i.getMinutes(),15,765),t.text("PÁGINA "+n+" DE "+r,0,740,{align:"center"})}})},T.listaBancos=function(){T.anticiposSeleccionados=[],T.anticiposTr3=[];var a=ra(T.usuario.id_empresa);T.arregloBancosUnion="",T.arregloBancosMsc="";a.then(function(t){T.datosBancos=t,T.bancos=[],t.forEach(function(a,e,o){a.cuentas=[],0==e&&T.bancos.push(a);for(var n=!1,i=0;i<T.bancos.length;i++){T.bancos[i].nombre==a.nombre&&(n=!0),i===T.bancos.length-1&&0==n&&T.bancos.push(a)}e===o.length-1&&t.forEach(function(a,e,o){for(var i=0;i<T.bancos.length;i++){var t=T.bancos[i];t.nombre==a.nombre&&(n=!0,t.cuentas.push(a),i=T.bancos.length)}})})})},T.imprimirTr3=function(n,r){for(var a=new Date(n.fecha),c=a.getMonth(),s=a.getDate(),l="",e=0;e<T.meses.length;e++){var o=T.meses[e];c==o.id&&(l=o.nombre)}c=c<10?"0"+c:c,s=s<10?"0"+s:s,anio=a.getFullYear();var d=[],u=0;n.historialtr3.forEach(function(a,e,o){if(u+=a.anticipo.monto,d.push(a.anticipo),e===o.length-1){var i={anticipos:d,tipo:r,tr3Encontrado:n,total:u};if("MSC"==r)var t=i.tr3Encontrado.planilla+""+s+(c+1)+anio+i.tr3Encontrado.numero_planilla+".tr3";else t="SUELDO"+l+anio+"BUNION.tr3";T.descargarArchivo(T.generarTexto(i),t)}})},T.imprimirCartaTr3=function(n,r){for(var c=[],s=0,a=new Date(n.fecha),l=a.getMonth()+1,d=a.getDate(),e=0;e<T.meses.length;e++){var o=T.meses[e];l==o.id&&o.nombre}l=l<10?"0"+l:l,d=d<10?"0"+d:d,anio=a.getFullYear(),n.historialtr3.forEach(function(a,e,o){if(s=a.anticipo.monto,c.push(a.anticipo),e===o.length-1){var i={anticipos:c,tipo:r,tr3Encontrado:n,total:s};if("MSC"==r)var t=i.tr3Encontrado.planilla+""+d+l+anio+i.tr3Encontrado.numero_planilla+".txt";else t=i.tr3Encontrado.planilla+""+d+l+anio+i.tr3Encontrado.numero_planilla+".txt";T.descargarArchivo(T.generarTextoCarta(i),t)}})},T.guardarTr3Empleado=function(d){d.fecha=new Date;var i=[];0<d.anticipos.length&&d.anticipos.forEach(function(a,e,o){(bandera=!1,T.datosBanco.nombre.toUpperCase()==a.empleado.empleadosFichas[a.empleado.empleadosFichas.length-1].banco.nombre&&(bandera=!0),bandera&&i.push(a),e===o.length-1)&&(d.anticipos=i,la(d,T.usuario.id_empresa).then(function(a){for(var e=new Date(a.tr3Encontrado.fecha),o=e.getMonth()+1,i=e.getMonth(),t=e.getDate(),n="",r=0;r<T.meses.length;r++){var c=T.meses[r];i==c.id&&(n=c.nombre)}if(o=o<10?"0"+o:o,t=t<10?"0"+t:t,anio=e.getFullYear(),T.cerrarModalTr3BancoMsc(),T.cerrarModalTr3BancoUnion(),T.buscarAnticiposOridnario(T.filtroAnticipo),"MSC"==d.tipo)var s=a.tr3Encontrado.planilla+""+t+o+anio+a.tr3Encontrado.numero_planilla+".tr3",l=a.tr3Encontrado.planilla+""+t+o+anio+a.tr3Encontrado.numero_planilla+".txt";else s="SUELDO"+n+anio+"BUNION.tr3",l=a.tr3Encontrado.planilla+""+t+o+anio+".txt";T.descargarArchivo(T.generarTexto(a),s),T.descargarArchivo(T.generarTextoCarta(a),l),T.mostrarMensaje(a.mensaje)}))})},T.descargarArchivo=function(a,i){var e=new FileReader;e.onload=function(a){var e=document.createElement("a");e.href=a.target.result,e.target="_blank",e.download=i||"archivo.dat";var o=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(o),(window.URL||window.webkitURL).revokeObjectURL(e.href)},e.readAsDataURL(a)},T.generarTextoCarta=function(a){for(var e=new Date(a.tr3Encontrado.fecha),o=e.getMonth()+1,i=e.getDate(),t="",n=0;n<T.meses.length;n++){var r=T.meses[n];o-1===r.id&&(t=r.nombre)}o=o<10?"0"+o:o,i=i<10?"0"+i:i,anio=e.getFullYear();var c=ConvertirALiteral(a.total.toFixed(2)),s=[];if("MSC"==a.tipo){var l="\r\n\r\n"+a.tr3Encontrado.departamento.nombre+" "+i+" de "+t+" del "+anio+"\r\nNro Cite: ESS-P-29/18\r\n\r\n\r\nSeñores \r\n"+a.tr3Encontrado.cuenta.nombre+"\r\nCiudad\r\n\r\nRef.: Orden de Pago\r\n\r\nDe nuestra consideración:\r\n\r\nMediante la presente y según contrato suscrito con el Banco Mercantil Santa Cruz S.A.,\r\nautorizamos a ustedes realizar el débito por el valor total de Bs. "+a.total+"\r\n("+c+")\r\ncorrespondiente a la cancelación de la planilla de pago(s), de acuerdo al siguiente detalle:\r\n\r\n* Cuenta de débito Nro:                 "+a.tr3Encontrado.cuenta.numero+"\r\n* Cuenta Pago de Planilla:              "+a.tr3Encontrado.planilla+"\r\n* Nombre del archivo:                   "+a.tr3Encontrado.planilla+i+o+anio+a.tr3Encontrado.numero_planilla+".tr3\r\n* Código de control:                     87fd35e019787f9612a4ffb9fc2cb415\r\n* Nombre / Número de planilla:  "+a.tr3Encontrado.nombre_planilla+"\r\n* Monto total de débito:                 Bs "+a.total+"\r\n\r\nLos datos apuntados anteriormente y el detalle de pagos, se encuentran en el archivo \r\n"+a.tr3Encontrado.planilla+i+o+anio+a.tr3Encontrado.numero_planilla+".tr3, adjunto a la presente carta.\r\n\r\n Si, a los efectos de la presente, fuera necesario realizar compra venta de moneda nacional\r\no extranjera,  también  autorizamos e instruimos  realizar las operaciones  necesarias  para\r\ncumplir  con  lo  instruido,  de  tal  manera  que se realicen  los abonos  en  la moneda  que\r\ncorresponda a cada cuenta beneficiaria.\r\nde "+t+" Debo informar lo siguiente:\r\nEl origen de los fondos corresponde al "+a.tr3Encontrado.origen_fondos+".\r\nEl Destino de los Fondos, "+a.tr3Encontrado.destino_fondos+".\r\n\r\nAgradecemos su gentil atención a esta solicitud.\r\n\r\nAtentamente\r\n\r\n\r\n\r\n"+a.tr3Encontrado.firma_uno+"                                 "+a.tr3Encontrado.firma_tres+"\r\n"+a.tr3Encontrado.firma_dos+"                                             "+a.tr3Encontrado.firma_cuatro+"\r\n\r\n\r\nAdj. Lo citado";return s.push(l),new Blob(s,{type:"text/plain"})}if("BU"==a.tipo){l="\r\n\r\nSanta Cruz "+i+" de "+t+" de "+anio+"\r\nESS-P-30/18\r\nSeñores:\r\nBANCO UNION  S.A.\r\nAtn.:"+a.tr3Encontrado.dirigido_para+"\r\n"+a.tr3Encontrado.cargo+"\r\nPresente.-\r\n\r\n\t\t\t\tRef.: Autorización para Abono de  Sueldos "+t+" "+anio+"\r\n\r\nMediante la presente solicitamos debiten de nuestra cuenta corriente No."+a.tr3Encontrado.cuenta.numero+"\r\nel importe total de Bs."+a.total+"("+c+")\r\n, y el concepto de comisiones debitar de nuestra cuenta.\r\n\r\nSe ha realizado la verificación de nuestro extracto de cuenta  No."+a.tr3Encontrado.cuenta.numero+", tenemos saldo suficiente lo cual cubre el importe requerido.\r\n\r\nEnviamos planilla detallada adjunta.\r\n\r\nde "+t+" Debo informar lo siguiente:\r\n\r\n"+a.tr3Encontrado.origen_fondos+"\r\n"+a.tr3Encontrado.destino_fondos+".\r\n\r\nAgradeciendo de antemano su pronta respuesta vía mail, saludo a Usted cordialmente.\r\n\r\nAtentamente,\r\n\r\n\r\n\r\n\r\n\r\n\t\t"+a.tr3Encontrado.firma_uno+"\t\t\t\t"+a.tr3Encontrado.firma_tres+"\r\n\t"+a.tr3Encontrado.firma_dos+"\t\t\t\t\t\t"+a.tr3Encontrado.firma_cuatro+"\r\n";return s.push(l),new Blob(s,{type:"text/plain"})}},T.generarTexto=function(i){var t=[];if("MSC"==i.tipo){i.tr3Encontrado.nombre_archivo;var a=T.fechaATexto(i.tr3Encontrado.fecha);if(i.tr3Encontrado.historialtr3)var n=T.fechaATexto(i.tr3Encontrado.historialtr3[0].anticipo.fecha);else n=T.fechaATexto(i.anticipos[0].fecha);var r=i.tr3Encontrado.planilla+"|"+i.tr3Encontrado.cuenta.numero+"|0|"+i.tr3Encontrado.nombre_planilla+"|"+n+"|"+a+"|"+i.total+"|"+i.tr3Encontrado.numero_planilla+"\r\n";return i.anticipos.forEach(function(a,e,o){a.empleado.empleadosFichas&&(a.empleado.ficha=a.empleado.empleadosFichas[0]),n=T.fechaATexto(a.fecha),r+=e+1+"|"+a.empleado.persona.nombre_completo+"|"+a.empleado.ficha.numero_cuenta+"|"+n+"|"+i.tr3Encontrado.numero_planilla+"|"+a.monto+"|||"+i.tr3Encontrado.nombre_archivo+"\r\n",e===o.length-1&&t.push(r)}),new Blob(t,{type:"text/plain"})}if("BU"==i.tipo){for(var e=(n=new Date(i.tr3Encontrado.fecha)).getMonth()+1,o=n.getMonth(),c=n.getDate(),s="",l=0;l<T.meses.length;l++){var d=T.meses[l];o==d.id&&(s=d.nombre)}e=e<10?"0"+e:e,c=c<10?"0"+c:c;r="SUELDOS  "+s+"  "+n.getFullYear()+"      "+i.tr3Encontrado.planilla+c+e+n.getFullYear()+"\r\n";return r+=i.tr3Encontrado.cuenta.numero+""+i.total+"\r\n",i.anticipos.forEach(function(a,e,o){a.empleado.empleadosFichas&&(a.empleado.ficha=a.empleado.empleadosFichas[0]),n=T.fechaATexto(a.fecha),r+=a.empleado.ficha.numero_cuenta+""+a.monto+"\r\n",e===o.length-1&&t.push(r)}),new Blob(t,{type:"text/plain"})}},T.selecionarAnticipos=function(a,e,o){a&&(0==a.select?(T.anticiposSeleccionados.splice(T.anticiposSeleccionados.indexOf(a)),0==a.entregado&&T.anticiposTr3.splice(T.anticiposTr3.indexOf(a))):(T.anticiposSeleccionados.push(a),0==a.entregado&&T.anticiposTr3.push(a),console.log(T.empleadosSeleccionados))),1==o?(T.anticiposSeleccionados=[],e&&e.forEach(function(a,e,o){a.select=!0,T.anticiposSeleccionados.push(a),0==a.entregado&&T.anticiposTr3.push(a)})):0==o&&(e.forEach(function(a,e,o){a.select=!1}),T.anticiposSeleccionados=[],T.anticiposTr3=[])},T.obtenertiposAusenciaMedica=function(){T.tiposAusenciasMedicas=[],M.start(),ba("RRHH_AUSMED",T.usuario.id_empresa).then(function(a){T.tiposAusenciasMedicas=a,M.stop()})},T.obtenerTiposOtrasAusencias=function(){T.tiposOtrasAusencias=[],M.start(),ba("RRHH_OTRAUS",T.usuario.id_empresa).then(function(a){T.tiposOtrasAusencias=a,M.stop()})},T.CalcularDiferenciaDias=function(a,e){if(e){if(a.fecha_inicio&&a.fecha_fin){var o=new Date(T.convertirFecha(a.fecha_inicio)),i=new Date(T.convertirFecha(a.fecha_fin));o.setMinutes(a.fecha_inicio_hora.getMinutes()),o.setHours(a.fecha_inicio_hora.getHours()),i.setMinutes(a.fecha_fin_hora.getMinutes()),i.setHours(a.fecha_fin_hora.getHours());var t=moment('"'+o.getFullYear()+"-"+o.getMonth()+"-"+o.getDate()+" "+o.getHours()+":"+o.getMinutes()+":00","YYYY-MM-DD HH:mm:ss"),n=moment('"'+i.getFullYear()+"-"+i.getMonth()+"-"+i.getDate()+" "+i.getHours()+":"+i.getMinutes()+":00","YYYY-MM-DD HH:mm:ss");n.diff(t,"d");a.horas=convertirSegundosATiempo(n.diff(t,"s"))}}else if(a.fecha_inicio&&a.fecha_fin){o=new Date(T.convertirFecha(a.fecha_inicio)),i=new Date(T.convertirFecha(a.fecha_fin));var r=T.diferenciaEntreDiasEnDias(o,i);0==r&&(r=1)}a.primera_baja?(a.dias=r-a.tipo.dias_descuento,a.dias_reales=r):a.dias=r},T.crearNuevaAusencia=function(a,e){if(1==e){var o=parseInt(T.SumaTotalHoras.split(":")[1]),i=parseInt(T.SumaTotalHoras.split(":")[0]),t=parseInt(a.horas.split(":")[1]),n=parseInt(a.horas.split(":")[0]);i<n?(a.fecha_inicio=new Date(T.convertirFecha(a.fecha_inicio)),a.fecha_fin=new Date(T.convertirFecha(a.fecha_fin)),a.fecha_inicio.setMinutes(a.fecha_inicio_hora.getMinutes()),a.fecha_inicio.setHours(a.fecha_inicio_hora.getHours()),a.fecha_fin.setMinutes(a.fecha_fin_hora.getMinutes()),a.fecha_fin.setHours(a.fecha_fin_hora.getHours()),a.compensaciones=T.selectionday,T.guardarAusencia(T.empleado.id_ficha,a)):i==n&&o<=t?(a.fecha_inicio=new Date(T.convertirFecha(a.fecha_inicio)),a.fecha_fin=new Date(T.convertirFecha(a.fecha_fin)),a.fecha_inicio.setMinutes(a.fecha_inicio_hora.getMinutes()),a.fecha_inicio.setHours(a.fecha_inicio_hora.getHours()),a.fecha_fin.setMinutes(a.fecha_fin_hora.getMinutes()),a.fecha_fin.setHours(a.fecha_fin_hora.getHours()),a.compensaciones=T.selectionday,T.guardarAusencia(T.empleado.id_ficha,a)):T.mostrarMensaje("La suma del total de horas compensacion es mayor al total de horas de la ausencia!")}else a.fecha_inicio=new Date(T.convertirFecha(a.fecha_inicio)),a.fecha_fin=new Date(T.convertirFecha(a.fecha_fin)),T.guardarAusencia(T.empleado.id_ficha,a)},T.guardarAusencia=function(a,e){W(a,e).then(function(a){T.ausencia={},T.cerrarDialogAusenciasVacaciones(),T.selectionday=[],T.SumaTotalHoras="",T.calendarCompensacion.fullCalendar("removeEvents"),T.mostrarMensaje(a.mensaje)})},T.obtenerHistorialEmpleadoAusenciasMedicas=function(a){T.historialEmpleadoAusencias=[],null!=a.tipo_ausencia&&null!=a.tipo_ausencia||(a.tipo_ausencia=0);var e={inicio:0,fin:0,tipo_ausencia:a.tipo_ausencia};a&&a.inicio&&(e.inicio=new Date(T.convertirFecha(a.inicio)),e.fin=new Date(T.convertirFecha(a.fin))),K(T.empleado.id_ficha,e,"RRHH_AUSMED").then(function(i){i.forEach(function(a,e,o){a.primera_baja?a.baja="Si":a.baja="No",e===o.length-1&&(T.historialEmpleadoAusencias=i)})})},T.obtenerHistorialEmpleadoOtrasAusencias=function(a){null!=a.tipo_ausencia&&null!=a.tipo_ausencia||(a.tipo_ausencia=0);var e={inicio:0,fin:0,tipo_ausencia:a.tipo_ausencia};a.inicio&&(e.inicio=new Date(T.convertirFecha(a.inicio)),e.fin=new Date(T.convertirFecha(a.fin))),K(T.empleado.id_ficha,e,"RRHH_OTRAUS").then(function(a){T.historialEmpleadoOtrasAusencias=a})},T.obtenerHistorialEmpresaAusenciasMedicas=function(a){null!=a.tipo_ausencia&&null!=a.tipo_ausencia||(a.tipo_ausencia=0);var e={inicio:0,fin:0,tipo_ausencia:a.tipo_ausencia};a.inicio&&(e.inicio=new Date(T.convertirFecha(a.inicio)),e.fin=new Date(T.convertirFecha(a.fin))),Q(T.usuario.id_empresa,e,"RRHH_AUSMED").then(function(a){T.historialEmpresaAusencias=a})},T.obtenerHistorialEmpresaOtrasAusencias=function(a){null!=a.tipo_ausencia&&null!=a.tipo_ausencia||(a.tipo_ausencia=0);var e={inicio:0,fin:0,tipo_ausencia:a.tipo_ausencia};a.inicio&&(e.inicio=new Date(T.convertirFecha(a.inicio)),e.fin=new Date(T.convertirFecha(a.fin))),Q(T.usuario.id_empresa,e,"RRHH_OTRAUS").then(function(a){T.historialEmpresaOtrasAusencias=a})},T.agregarTipoAusencia=function(a,e){1==a.edit?T.guardarModificado(a):e.push(a)},T.ModificarTipoAusencia=function(a){T.clase={},a.edit=!0,T.clase=a},T.guardarModificado=function(a){a.edit=!1,T.clase={}},T.guardarClasesAusencias=function(a,e){ta(a,e).then(function(a){T.cerrarDialogTipoBaja(),T.cerrarDialogTipoAusencia(),T.obtenertiposAusenciaMedica(),T.obtenerTiposOtrasAusencias(),T.mostrarMensaje(a.mensaje)})},T.obtenerConfiguracionVacaciones=function(){ca().then(function(a){T.configuracionesVacacion=a})},T.obtenerHistorialGestionesVacacion=function(r,c,s){sa(r.id_ficha).then(function(a){T.historialGestionesVacacion=a;var e=new Date;r.fecha_Retiro_beneficio&&(e=new Date(r.fecha_Retiro_beneficio));var o=new Date(r.fecha_inicio),i=T.diferenciaEntreDiasEnDias(o,e),t=Math.round(i/365);if(T.vacacion.aniosDisponibles=t,T.vacacion.historial=T.historialGestionesVacacion,T.diasDisponibles=0,T.historialGestionesVacacion.forEach(function(a,e,o){a.anio<=t&&(T.diasDisponibles+=a.aplicadas-a.tomadas)}),365<i?(T.usarVacacion=!0,c&&T.abrirPopup(T.idModalAusenciasVacaciones)):(T.usarVacacion=!1,c&&(T.abrirPopup(T.idModalAusenciasVacaciones),setTimeout(function(){T.$apply(function(){T.mostrarMensaje("El empleado no cuenta con la antiguedad para asignar vacaciones")})},2e3))),s){var n=new Date(T.empleado.fecha_expiracion).getFullYear();T.beneficio.totalV=0,T.historialGestionesVacacion.forEach(function(a,e,o){if(a.gestion<n)a.tomadas<a.aplicadas&&(T.beneficio.totalV+=a.aplicadas-a.tomadas,T.beneficio.anios++);else if(a.gestion==n){T.beneficio.meses=T.tiempoTrabajado.meses,T.beneficio.dias=T.tiempoTrabajado.dias;var i=T.beneficio.meses*(a.aplicadas-a.tomadas)/12;T.beneficio.totalV+=i;var t=T.beneficio.dias*(a.aplicadas-a.tomadas)/365;T.beneficio.totalV+=t,0==T.beneficio.meses?(T.beneficio.anios++,a.gestion<=n&&a.tomadas<a.aplicadas&&(T.beneficio.totalV+=a.aplicadas-a.tomadas)):T.beneficio.anios--,T.beneficio.totalV=Math.round(T.beneficio.totalV)}})}})},T.agregarConceptoEdicion=function(a){a.nombre&&a.nombre_corto&&(-1==T.tipo_edicion.clases.indexOf(a)&&T.tipo_edicion.clases.push(a),T.clase={})},T.agregarConductor=function(a){a.habilitado=!0,T.choferesViaje.push(a),T.conductor={}},T.editarConductor=function(a){T.conductor=a},T.filtrarConductor=function(a){T.tipoConductor=a?{id_empleado:a}:{}},T.guardarConductores=function(){Ba(T.usuario.id_empresa,T.choferesViaje).then(function(a){T.mostrarMensaje(a.mensaje),T.obtenerChoferesViaje(),T.cerrarDialogConductoresViaje()})},T.modificarConceptoEdicion=function(a){T.clase=a},T.modificarConceptoEdicionVehiculo=function(a){var e=a.nombre.split("-");a.vehiculo=e[0],a.placa=e[1],T.clase=a},T.removerConceptoEdicion=function(a){a.eliminado=!0},T.guardarConceptoEdicion=function(e){M.start(),na.update({id_tipo:e.id},e,function(a){_(e.nombre_corto).then(function(a){e=a,M.stop(),T.cerrarDialogConceptoEdicion(),T.mostrarMensaje("Guardado Exitosamente!")})})},T.guardarConceptoEdicionVehiculo=function(e){M.start(),na.update({id_tipo:e.id},e,function(a){_(e.nombre_corto).then(function(a){e=a,M.stop(),T.cerrarDialogVehiculosViaje(),T.mostrarMensaje("Guardado Exitosamente!")})})},T.CalcularDiferenciaDiasVacacion=function(t){t.dias=0,t.dias_descuento=0,t.domingos=0,t.sabados=0;var a=t.fecha_inicio,e=t.fecha_fin;if(a&&(a=new Date(T.convertirFecha(a))),e&&(e=new Date(T.convertirFecha(e))),a&&e){if(9<=t.fecha_inicio.length&&9<=t.fecha_fin.length)var o=getDates(a,e);o.forEach(function(a,e,o){var i;t.sabado?(0==(i=new Date(a)).getDay()&&(t.domingos+=1),-1!=T.ListaDiasFeriado.indexOf(a)&&(t.dias_descuento+=1),e===o.length-1&&T.CalcularDiferenciaDiasV(t)):(0==(i=new Date(a)).getDay()&&(t.domingos+=1),6==i.getDay()&&(t.sabados+=1),-1!=T.ListaDiasFeriado.indexOf(a)&&(t.dias_descuento+=1),e===o.length-1&&T.CalcularDiferenciaDiasV(t))})}},T.CalcularDiferenciaDiasV=function(a){if(a.fecha_inicio&&a.fecha_fin){var e=new Date(T.convertirFecha(a.fecha_inicio)),o=new Date(T.convertirFecha(a.fecha_fin)),i=T.diferenciaEntreDiasEnDias(e,o);0==i&&(i=1),a.dias=i+1-(a.dias_descuento+a.domingos+a.sabados),a.inicio_tipo||a.fin_tipo?a.inicio_tipo&&!a.fin_tipo?a.dias=a.dias-.5:!a.inicio_tipo&&a.fin_tipo?a.dias=a.dias-.5:a.inicio_tipo&&a.fin_tipo&&(a.dias=a.dias):a.dias=a.dias-1;var t=(new Date).setTime(new Date(T.convertirFecha(a.fecha_fin)).getTime()+864e5);a.fecha_Retorno=a.fin_tipo?T.fechaATexto(t):a.fecha_fin,a.dias_reales=i+1}},T.crearNuevaVacacion=function(e){e.dias<=T.diasDisponibles?(e.fecha_inicio=new Date(T.convertirFecha(e.fecha_inicio)),e.fecha_fin=new Date(T.convertirFecha(e.fecha_fin)),Z(T.empleado.id_ficha,e).then(function(a){T.imprimirReciboVacacion(e,T.empleado.nombre_completo,T.empleado.fecha_inicio,a.gestiones,a.restantes),T.cerrarDialogAusenciasVacaciones(),T.mostrarMensaje(a.mensaje)})):T.mostrarMensaje("El empleado solo cuenta con "+T.diasDisponibles+" dias disponbles para asignar vacaciones")},T.obtenerHistorialEmpleadVacacion=function(a){var e={inicio:0,fin:0};a.inicio&&(e.inicio=new Date(T.convertirFecha(a.inicio)),e.fin=new Date(T.convertirFecha(a.fin))),aa(T.empleado.id_ficha,e).then(function(a){T.historialEmpleadoVacaciones=a})},T.obtenerHistorialEmpresaVacacion=function(a){var e={inicio:0,fin:0,estado:2};a.inicio&&(e.inicio=new Date(T.convertirFecha(a.inicio)),e.fin=new Date(T.convertirFecha(a.fin))),a.estado&&(e.estado=a.estado),ea(T.usuario.id_empresa,e).then(function(n){n.forEach(function(a,e,o){for(var i=a.diasRestantes=0;i<a.ficha.historialVacaciones.length;i++){var t=a.ficha.historialVacaciones[i];a.diasRestantes+=t.aplicadas-t.tomadas}e===o.length-1&&(T.historialEmpresaVacaciones=n)})})},T.selecionarEmpleados=function(a,e,o){o?(T.paginator.itemsPerPage="0",T.empleadosSeleccionados=[]):T.paginator.itemsPerPage="10",e?T.buscarRecursosHumanos(!0,a,e,o):0==a.select?(a.select=!1,T.empleadosSeleccionados.splice(T.empleadosSeleccionados.indexOf(a))):(a.select=!0,T.empleadosSeleccionados.push(a),console.log(T.empleadosSeleccionados))},T.generarExcelEmpleados=function(a,e){for(var o=[["N°","ACTIVO","CODIGO","NOMBRE COMPLETO","EMPLEADO","CI","EXTENCÓN","TIPO CONTRATO","CAMPO","CARGO"]],i=[],t=0;t<a.length;t++){var n=[];n.push(t+1),n.push(a[t].eliminado),n.push(a[t].codigo),n.push(a[t].nombre_completo),n.push(a[t].designacion_empresa),n.push(a[t].ci),n.push(a[t].extension),n.push(a[t].tipoContrato),n.push(a[t].campo);var r=a[t].cargos;i.push(t),n.push(r),o.push(n)}var c="SheetJS",s=new Workbook,l=sheet_from_array_of_arrays(o);s.SheetNames.push(c),s.Sheets[c]=l;var d=XLSX.write(s,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(d)],{type:"application/octet-stream"}),"EMPLEADO RRHH.xlsx"),M.stop()},T.obtenerGestiones=function(){M.start(),_("GTN").then(function(a){T.gestiones=a.clases,M.stop()})},T.abrirModalVerificarCuentaRrhh=function(a){T.empleado=a,T.abrirPopup(T.IdModalVerificarCuentaRrhh)},T.cerrarModalVerificarCuentaRrhh=function(a){a&&(T.empleado.activo=1!=T.empleado.activo),T.cerrarPopup(T.IdModalVerificarCuentaRrhh)},T.abrirModalVerificacion=function(a){1==a.activo?(T.funcionCerrar=T.cerrarModalReingresoEmpleado,T.funcionArealizar=T.ActivarCuentaRrhh,T.abrirModalVerificarCuentaRrhh(a)):(T.funcionCerrar=T.cerrarMensajeConfirmacion,T.funcionArealizar=T.verificarCuentaAdminRrhh,T.abrirModalVerificarCuentaRrhh(a),setTimeout(function(){aplicarDatePickers()},300))},T.abrirMensajeConfirmacion=function(a){T.cuenta=a,T.abrirPopup(T.idModalConfirmarDesabilitacion)},T.abrirModalReingresoEmpleado=function(){T.abrirPopup(T.idModalReingresoEmpleado)},T.cerrarModalReingresoEmpleado=function(a){a&&(T.empleado.activo=1!=T.empleado.activo),T.cerrarPopup(T.idModalReingresoEmpleado),T.empleado.tipoReincorporacion&&"NREING"==T.empleado.tipoReincorporacion.nombre_corto&&T.abrirDialogEmpleado(T.empleado)},T.cerrarMensajeConfirmacion=function(a){a&&(T.empleado.activo=1!=T.empleado.activo),T.cerrarPopup(T.idModalConfirmarDesabilitacion)},T.verificarCuentaAdminRrhh=function(e){O.save({id_empresa:T.usuario.id_empresa},e,function(a){a.type?(e.fecha?T.empleado.nueva_fecha_expiracion=new Date(T.convertirFecha(T.cuenta.fecha)):T.empleado.nueva_fecha_expiracion=null,T.empleado.motivo_retiro=T.cuenta.motivo_retiro,T.abrirMensajeConfirmacion(e),T.cerrarModalVerificarCuentaRrhh()):T.mostrarMensaje(a.message)})},T.ActivarCuentaRrhh=function(e){O.save({id_empresa:T.usuario.id_empresa},e,function(a){a.type?(T.empleado.nueva_fecha_expiracion=null,T.abrirModalReingresoEmpleado(e),T.cerrarModalVerificarCuentaRrhh()):T.mostrarMensaje(a.message)})},T.changeActivoEmpleado=function(e){e.activo=0==e.activo,u(e).then(function(a){T.funcionCerrar(),T.cuenta={},T.mostrarMensaje(a.mensaje),e.tipoReincorporacion?(e.activo=0==e.activo,"NREING"==e.tipoReincorporacion.nombre_corto?(T.primeroGuardarParaCerrar=!0,T.obtenerRecursosHumanos(),T.abrirDialogEmpleado(e,!0)):T.obtenerRecursosHumanos()):T.obtenerRecursosHumanos()})},T.EliminarUsuarioRh=function(a){a.activo&&(a.activo=!1,T.abrirModalVerificacion(a))},T.obtenerTiposBaja=function(){M.start(),ba("RRHH_TPRE",T.usuario.id_empresa).then(function(a){T.tiposBajas=a,M.stop()})},T.obtenerTiposOtrosingresosYDeduccion=function(){M.start(),ba("RRHH_TPDOI",T.usuario.id_empresa).then(function(a){T.tiposOtrosingresosYDeduccion=a,T.tiposOtrosingresosYDeduccion.clases.forEach(function(a,e,o){"OTRING"==a.nombre_corto?T.tipoOtrosIngresos=a:T.tipoDeducciones=a}),M.stop()})},T.obtenerMotivosRetiro=function(){M.start(),ba("RRHH_TPMR",T.usuario.id_empresa).then(function(a){T.tipoMotivo=a,M.stop()})},T.agregarOtroIngreso=function(a){a.tipo=T.tipoOtrosIngresos,T.beneficio.ingresos.push(a),T.ingreso={motivo:"",monto:""},T.sumartotalOtrosIngresos(T.beneficio)},T.eliminarOtroIngreso=function(a,e){e.id?(e.eliminado=!0,e.motivo=""):(T.beneficio.ingresos.splice(a,1),T.sumartotalOtrosIngresos(T.beneficio))},T.agregarDeduccion=function(a){a.tipo=T.tipoDeducciones,T.beneficio.deducciones.push(a),T.deduccion={motivo:"",monto:""},T.sumarTotalDeducciones(T.beneficio)},T.sumarTotalDeducciones=function(i){i.total_deducciones=0,i.deducciones.forEach(function(a,e,o){i.total_deducciones+=a.monto})},T.eliminarDeduccion=function(a,e){e.id?(e.eliminado=!0,e.motivo=""):(T.beneficio.deducciones.splice(a,1),T.sumarTotalDeducciones(T.beneficio))},T.guardarBeneficioSocial=function(e){e.fecha_elaboracion=new Date(T.convertirFecha(e.fecha_elaboracion)),e.fecha_asistensia=new Date(T.convertirFecha(e.fecha_asistensia)),e.fecha_ingreso=new Date(T.convertirFecha(e.fecha_ingreso)),e.fecha_retiro?e.fecha_retiro=new Date(T.convertirFecha(e.fecha_retiro)):e.fecha_retiro=new Date,pa(e,T.empleado.id_ficha).then(function(a){T.imprimirFiniquito(e,!1),T.mostrarMensaje(a.mensaje),T.cerrarDialogBeneficiosSociales()}).catch(function(a){var e=void 0!==a.data&&null!==a.data?a.data:a.message;T.mostrarMensaje("Se produjo un error! > "+e),M.stop()})},T.seleccionarMesesFiniquito=function(a){10==a.mes_uno.id?(a.mes_dos=T.meses[11],a.mes_tres=T.meses[0]):11==a.mes_uno.id?(a.mes_dos=T.meses[0],a.mes_tres=T.meses[1]):(a.mes_dos=T.meses[a.mes_uno.id+1],a.mes_tres=T.meses[a.mes_uno.id+2])},T.agregarQuinquenioAdelantado=function(i){var t=0;if(i.quinquenio_adelantado){var n={monto:t=i.quinquenio_adelantado,motivo:"Quinquenio Adelantado",tipo:T.tipoDeducciones};if(0<i.deducciones.length){var r=!1;i.deducciones.forEach(function(a,e,o){"Quinquenio Adelantado"==a.motivo&&(a.monto=t,r=!0),e===o.length-1&&(r||i.deducciones.push(n),T.sumarTotalDeducciones(i))})}else i.deducciones.push(n)}else i.deducciones.forEach(function(a,e,o){r=!1,"Quinquenio Adelantado"==a.motivo&&(i.deducciones.splice(e,1),T.sumarTotalDeducciones(i))})},T.CalcularAguinaldoNavidad2=function(a){var e=new Date(T.convertirFecha(a.fecha_retiro)),o=new Date(T.convertirFecha(a.fecha_retiro)).getMonth()+1,i=new Date(T.convertirFecha(a.fecha_retiro)).getDate();i===new Date(e.getFullYear(),e.getMonth()+1,0).getDate()?(a.diasAguinaldo=0,a.mesesAguinaldo=o):(a.mesesAguinaldo=o-1,a.diasAguinaldo=i);var t=a.promedio/12,n=t/30;return t*a.mesesAguinaldo+n*a.diasAguinaldo},T.obtenerCuentasBancos=function(){M.start(),ra(T.usuario.id_empresa).then(function(a){T.cuentasBancos=a,M.stop()})},T.calcularPromedioFiniquito=function(n){if(n.promedio=(n.primer_mes+n.segundo_mes+n.tercer_mes)/3,n.tipo_beneficio)if(isNaN(n.promedio)){var r=[];n.ingresos.forEach(function(a,e,o){if("Vacacion"==a.motivo&&r.push(e),"indemnizacion años"==a.motivo&&r.push(e),"indemnizacion meses"==a.motivo&&r.push(e),"indemnizacion dias"==a.motivo&&r.push(e),"Desahucio"==a.motivo&&r.push(e),e===o.length-1)for(var i=r.length-1;0<=i;i--){var t=r[i];n.ingresos.splice(t,1),T.sumartotalOtrosIngresos(n)}})}else{n.desahucio&&T.calcularDesaucio(n,!1),n.totalAguinaldo=T.CalcularAguinaldoNavidad2(n);var i=T.añosRestantes*n.promedio,t=n.promedio/12*T.tiempoTrabajado.meses,c=n.promedio/365*T.tiempoTrabajado.dias,s={monto:i,motivo:"indemnizacion años",tipo:T.tipoOtrosIngresos},l={monto:t,motivo:"indemnizacion meses",tipo:T.tipoOtrosIngresos},d={monto:c,motivo:"indemnizacion dias",tipo:T.tipoOtrosIngresos},u={monto:n.promedio/30*n.totalV,motivo:"Vacacion",tipo:T.tipoOtrosIngresos},p={monto:n.totalAguinaldo,motivo:"Aguinaldo de navidad",tipo:T.tipoOtrosIngresos};if(0<n.ingresos.length){var f=!1,m=!1,h=!1,g=!1,b=!1;n.ingresos.forEach(function(a,e,o){"indemnizacion años"==a.motivo&&(a.monto=i,f=!0),"indemnizacion meses"==a.motivo&&(a.monto=t,m=!0),"indemnizacion dias"==a.motivo&&(a.monto=c,h=!0),"Vacacion"==a.motivo&&(a.monto=n.promedio/30*n.totalV,g=!0),"Aguinaldo de navidad"==a.motivo&&(a.monto=n.totalAguinaldo,b=!0),e===o.length-1&&(f||n.ingresos.push(s),m||n.ingresos.push(l),h||n.ingresos.push(d),g||n.ingresos.push(u),b||n.ingresos.push(p),T.sumartotalOtrosIngresos(n))})}else n.ingresos.push(s),n.ingresos.push(l),n.ingresos.push(d),n.ingresos.push(u),n.ingresos.push(p),T.sumartotalOtrosIngresos(n)}},T.sumartotalOtrosIngresos=function(i){i.total_ingresos=0,i.ingresos.forEach(function(a,e,o){i.total_ingresos+=a.monto})},T.calcularTotalQuiquenio=function(a){a.total_quinquenio=a.promedio*(5*a.numero_quinquenio),a.total_por_quinquenio=a.total_quinquenio/a.numero_quinquenio},T.calcularDesaucio=function(i,a){if(isNaN(i.promedio))i.ingresos.forEach(function(a,e,o){"Desahucio"==a.motivo&&(i.ingresos.splice(e,1),T.sumartotalOtrosIngresos(i))});else if(i.desahucio){if(i.total_desahucio=3*i.promedio,i.total_desahucio=parseFloat(i.total_desahucio.toFixed(2)),i.tipo_beneficio){var t={monto:i.total_desahucio,motivo:"Desahucio",tipo:T.tipoOtrosIngresos};if(!a)if(0<i.ingresos.length){var n=!1;i.ingresos.forEach(function(a,e,o){"Desahucio"==a.motivo&&(a.monto=i.total_desahucio,n=!0),e===o.length-1&&(n||(i.ingresos.push(t),T.sumartotalOtrosIngresos(i)))})}else i.ingresos.push(t),T.sumartotalOtrosIngresos(i)}}else{n=!1;var r=0;i.ingresos.forEach(function(a,e,o){"Desahucio"==a.motivo&&(n=!0,r=e),e===o.length-1&&n&&(i.ingresos.splice(r,1),T.sumartotalOtrosIngresos(i))})}},T.listaRopaTrabajoPorCargo=function(a){_a(a).then(function(a){T.listaRopasDeTrabajo=a})},T.GuardarlistaRopaTrabajoPorCargo=function(a){"Siguiente"!=$("#siguiente-ca").text().trim()&&va(T.listaRopasDeTrabajo,a).then(function(a){T.mostrarMensaje(a.mensaje),T.cerrarModalConfiguracionRopaDeTrabajo(),T.listaRopasDeTrabajo=[],T.recargarItemsTabla()})},T.agregarRopaTrabajo=function(i){var t=!0;i.edit?(i.edit=!1,T.ropaTrabajo={}):0<T.listaRopasDeTrabajo.length?T.listaRopasDeTrabajo.forEach(function(a,e,o){i.ropaTrabajo.nombre==a.ropaTrabajo.nombre&&(t=!1,1==a.eliminado&&(a.eliminado=!1)),e===o.length-1&&t&&(T.listaRopasDeTrabajo.push(i),T.ropaTrabajo={})}):(T.listaRopasDeTrabajo.push(i),T.ropaTrabajo={})},T.editarRopaTrabajo=function(a){T.ropaTrabajo=a,T.ropaTrabajo.edit=!0},T.eliminarRopaTrabajo=function(a){a.eliminado=!0},T.generarPdfRopaTrabajo=function(){Da(T.usuario.id_empresa).then(function(u){var p=[];u.forEach(function(a,e,o){var i={nombre:a.cargo.nombre,detalle:[]};if(0<p.length)for(var t=!0,n=0;n<p.length;n++){i={nombre:a.cargo.nombre,detalle:[]},p[n].nombre==a.cargo.nombre&&(t=!1),n===p.length-1&&t&&p.push(i)}else p.push(i);e===o.length-1&&u.forEach(function(a,e,o){for(var i=0;i<p.length;i++){var t=p[i];t.nombre==a.cargo.nombre&&t.detalle.push(a)}e===o.length-1&&convertUrlToBase64Image(T.usuario.empresa.imagen,function(a){var e=a,o=new PDFDocument({compress:!1,size:"letter",margin:10}),i=o.pipe(blobStream()),t=100,n=0,r=1,c=Math.ceil((2*p.length+u.length)/25);T.DibujarCabeceraPDFConfigRopa(o,r,c,p,e),o.font("Helvetica",10);for(var s=0;s<p.length&&n<=25;s++){ropaTrabajo=p[s],o.text(s+1,45,t),o.text(ropaTrabajo.nombre,80,t),t+=30,25==++n&&(o.addPage({margin:0,bufferPages:!0}),t=100,n=0,r+=1,T.DibujarCabeceraPDFConfigRopa(o,r,c,p,e),o.font("Helvetica",10)),o.font("Helvetica-Bold",10),o.text("ROPA",80,t),o.text("CANTIDAD",250,t,{width:70}),o.font("Helvetica",10),t+=30,25==++n&&(o.addPage({margin:0,bufferPages:!0}),t=100,n=0,r+=1,T.DibujarCabeceraPDFConfigRopa(o,r,c,p,e),o.font("Helvetica",10));for(var l=0;l<ropaTrabajo.detalle.length;l++){var d=ropaTrabajo.detalle[l];o.text(d.ropaTrabajo.nombre,80,t),o.text(d.cantidad,250,t,{width:70}),t+=30,25==++n&&(o.addPage({margin:0,bufferPages:!0}),t=100,n=0,r+=1,T.DibujarCabeceraPDFConfigRopa(o,r,c,p,e),o.font("Helvetica",10))}25==++n&&(o.addPage({margin:0,bufferPages:!0}),t=100,n=0,r+=1,T.DibujarCabeceraPDFConfigRopa(o,r,c,p,e),o.font("Helvetica",10))}o.end(),i.on("finish",function(){var a=i.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),M.stop()})})})})},T.DibujarCabeceraPDFConfigRopa=function(a,e,o,i,t){a.font("Helvetica-Bold",14),a.text("ROPA DE TRABAJO - POR CARGOS",0,20,{align:"center"}),a.image(t,30,10,{fit:[80,80]}),a.rect(0,65,620,0).stroke(),a.rect(130,40,500,0).stroke(),a.rect(130,0,0,65).stroke(),a.rect(460,0,0,65).stroke(),a.font("Helvetica-Bold",8),a.text("Revicion:",480,20),a.text("Fecha de aprobación:",480,45),a.text("Código .",0,45,{align:"center"}),a.font("Helvetica",8);var n=new Date;a.text("Usuario: "+T.usuario.persona.nombre_completo+"      Fecha :  "+T.fechaATexto(n)+"   Hrs. "+n.getHours()+":"+n.getMinutes(),15,765),a.font("Helvetica-Bold",8),a.text("PÁGINA "+e+" DE "+o,0,740,{align:"center"})},T.generarExcelRopaTrabajo=function(){Da(T.usuario.id_empresa).then(function(a){for(var e=[["N°","CARGO","ROPA","CANTIDAD"]],o=0;o<a.length;o++){var i=[];i.push(o+1),i.push(a[o].cargo.nombre),i.push(a[o].ropaTrabajo.nombre),i.push(a[o].cantidad),e.push(i)}var t="SheetJS",n=new Workbook,r=sheet_from_array_of_arrays(e);n.SheetNames.push(t),n.Sheets[t]=r;var c=XLSX.write(n,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(c)],{type:"application/octet-stream"}),"REPORTES CONFIGURACION ROPA DE TRABAJO.xlsx"),M.stop()})},T.obtenerCargosRopaTrabajo=function(){M.start(),ba("RRHH_CARGO",T.usuario.id_empresa).then(function(a){var e=a.clases;T.listaCargos=a,T.llenarCargos(e),M.stop()})},T.obtenerCargosEmpleado=function(s,n,l){Aa(T.empleado.id_ficha).then(function(i){T.cargosEmpleado=i;var r=[];i.forEach(function(a,e,o){a.cargo.ConfiguracionesCargo.forEach(function(a,e,o){var i={nombre:a.cargo.nombre,detalle:[]};if(0<r.length)for(var t=!0,n=0;n<r.length;n++){i={nombre:a.cargo.nombre,detalle:[]},r[n].nombre==a.cargo.nombre&&(t=!1),n===r.length-1&&t&&r.push(i)}else r.push(i);o.length}),e===o.length-1&&i.forEach(function(a,e,o){a.cargo.ConfiguracionesCargo.forEach(function(a,e,o){for(var i=0;i<r.length;i++){var t=r[i];t.nombre==a.cargo.nombre&&t.detalle.push(a)}}),e===o.length-1&&(T.dotacionItems=[],i.forEach(function(a,e,o){if(a.cargo.ConfiguracionesCargo.forEach(function(a,e,o){if(0<T.dotacionItems.length)for(var i=!0,t=0;t<T.dotacionItems.length;t++){T.dotacionItems[t].ropaTrabajo.nombre==a.ropaTrabajo.nombre&&(i=!1),t===T.dotacionItems.length-1&&i&&(a.editable=!0,a.modificable=!0,a.entregado=!1,T.dotacionItems.push(a))}else a.editable=!0,a.modificable=!0,a.entregado=!1,T.dotacionItems.push(a)}),e===o.length-1){var c=[];if(s){i=T.listaDotaciones.length-1;null!=n&&(i=n),T.dotacionRopa.dotacionItems=T.listaDotaciones[i].dotacionItems;t=new Date;T.dotacionRopa.fecha=T.fechaATexto(t),T.dotacionRopa.fecha_vencimiento=T.fechaATexto(T.dotacionRopa.fecha_vencimiento)}else{if(0<T.listaDotaciones.length&&!l){var r=[],i=T.listaDotaciones.length-1;n&&(i=n),console.log(T.listaDotaciones[i].dotacionItems.length),console.log(T.dotacionItems.length),T.listaDotaciones[i].dotacionItems.forEach(function(a,e,o){for(var i=!1,t=0;t<T.dotacionItems.length;t++){var n=T.dotacionItems[t];n.id_cargo==a.id_cargo&&n.id_ropa_trabajo==a.id_ropa_trabajo?(n.producto=a.producto,n.cantidad=a.cantidad,n.entregado=a.entregado,n.entregado&&(n.modificable=!1),s&&(n.modificable=!0),r.push(a.id)):i=!0}i&&c.push(a),e===o.length-1&&r.forEach(function(a,e,o){for(var i=0;i<c.length;i++){var t=c[i];t.id==a?c.splice(i,1):t.editable=!1}if(e===o.length-1){var r=[];T.dotacionItems.forEach(function(a,e,o){for(var i=0;i<c.length;i++){var t=c[i];a.id_ropa_trabajo==t.id_ropa_trabajo&&(a.producto=t.producto,a.cantidad=t.cantidad,a.entregado=t.entregado,r.push(t.id))}if(e===o.length-1)if(0<r.length)r.forEach(function(a,e,o){for(var i=0;i<c.length;i++){var t=c[i];t.id==a?c.splice(i,1):t.editable=!1}if(e===o.length-1){T.dotacionItemsDetalle=T.dotacionItems.concat(c),T.dotacionRopa.dotacionItems=T.dotacionItemsDetalle;var n=new Date;T.dotacionRopa.fecha=T.fechaATexto(n),T.dotacionRopa.fecha_vencimiento=T.fechaATexto(T.dotacionRopa.fecha_vencimiento)}});else{T.dotacionItemsDetalle=T.dotacionItems.concat(c),T.dotacionRopa.dotacionItems=T.dotacionItemsDetalle;var n=new Date;T.dotacionRopa.fecha=T.fechaATexto(n),T.dotacionRopa.fecha_vencimiento=T.fechaATexto(T.dotacionRopa.fecha_vencimiento)}})}})})}else{T.dotacionRopa.dotacionItems=T.dotacionItems;var t=new Date;T.dotacionRopa.fecha=T.fechaATexto(t)}}}}))})})})},T.obtenerEstadoDotacion=function(){M.start(),ba("RRHH_EDRT",T.usuario.id_empresa).then(function(a){T.estadoDotacion=a,M.stop()})},T.obtenerCumplimientoDotacion=function(){M.start(),ba("RRHH_CDRT",T.usuario.id_empresa).then(function(a){T.cumplimientoDotacion=a,M.stop()})},T.obtenerPeriodosDotacion=function(){M.start(),ba("RRHH_PDR",T.usuario.id_empresa).then(function(a){T.periodoDotacion=a,M.stop()})},T.obtenerListaRopaTrabajoProductos=function(){M.start();var i="";T.dotacionRopa.dotacionItems.forEach(function(a,e,o){e===o.length-1?(i+=a.id_ropa_trabajo,Ra(i).then(function(a){T.productosRopaTrabajo=a,T.dotacionRopa.dotacionItems.forEach(function(a){a.producto&&T.calularInventarioItem(a)}),M.stop()})):i+=a.id_ropa_trabajo+","})},T.calularInventarioItem=function(i){(i.cantidad_disponible=0)<i.producto.inventarios.length&&i.producto.inventarios.forEach(function(a,e,o){i.cantidad_disponible+=a.cantidad})},T.seleccionarItem=function(a){a.editable?a.modificable&&(a.entregado?a.entregado=!a.entregado:a.entregado=!0):a.anterior||(a.entregado?a.entregado=!a.entregado:a.entregado=!0)},T.guardarDotacionRopa=function(e){(M.start(),T.actualizarDotacion)?(e.fecha=new Date(T.convertirFecha(e.fecha)),e.fecha_vencimiento=new Date(T.convertirFecha(e.fecha_vencimiento)),ja(T.empleado.id,e).then(function(a){T.mostrarMensaje(a.mensaje),T.obtenerRecursosHumanos(),T.ObtenerDotacionesRopa(T.empleado),e.numero=a.numero,T.imprimirRopaTrabajo(e),T.cerrarModalNuevaRopaTrabajo(),M.stop()}),M.stop()):(e.fecha=new Date(T.convertirFecha(e.fecha)),e.fecha_vencimiento=new Date(T.convertirFecha(e.fecha_vencimiento)),Ma(T.empleado.id,e).then(function(a){T.mostrarMensaje(a.mensaje),T.ObtenerDotacionesRopa(T.empleado),e.numero=a.numero,T.imprimirRopaTrabajo(e),T.cerrarModalNuevaRopaTrabajo(),M.stop()}))},T.ObtenerDotacionesRopa=function(a,e,i){var o={inicio:0,fin:0};e&&null!=e.inicio&&(o.inicio=e.inicio,o.fin=e.fin),xa(a.id,o).then(function(o){0<o.length?o.forEach(function(n,a,e){n.cargos=[],n.ropas=[],n.dotacionItems.forEach(function(a,e,o){if(0<n.cargos.length){for(var i=!0,t=0;t<n.cargos.length;t++){n.cargos[t].nombre==a.cargo.nombre&&(i=!1)}i&&n.cargos.push(a.cargo)}else n.cargos.push(a.cargo);if(0<n.ropas.length){for(i=!0,t=0;t<n.ropas.length;t++){n.ropas[t].nombre==a.ropaTrabajo.nombre&&(i=!1)}i&&n.ropas.push(a.ropaTrabajo)}else n.ropas.push(a.ropaTrabajo)}),a===e.length-1&&(T.listaDotaciones=o,i&&T.abrirModalNuevaRopaTrabajo(T.empleado,!1))}):(T.listaDotaciones=o,i&&T.abrirModalNuevaRopaTrabajo(T.empleado,!1)),M.stop()})},T.abrirDialogEliminarRopaTrabajo=function(){T.abrirPopup(T.idModalEliminarRopaTrabajo)},T.cerrarDialogEliminarRopaTrabajo=function(){T.dato={},T.cerrarPopup(T.idModalEliminarRopaTrabajo)},T.eliminarRopaTrabajoEmpleado=function(a){Ta(a).then(function(a){T.mostrarMensaje(a.mensaje),T.ObtenerDotacionesRopa(T.empleado),T.cerrarDialogEliminarRopaTrabajo()})},T.imprimirRopaTrabajo=function(a){var e=new PDFDocument({compress:!1,size:"letter",margin:10}),o=e.pipe(blobStream()),i=215,t=0,n=1,r=Math.ceil(a.dotacionItems.length/18);T.DibujarCabeceraPDFRopaTrabajo(e,n,r,a),e.font("Helvetica",10);for(var c=0;c<a.dotacionItems.length&&t<=18;c++){if(item=a.dotacionItems[c],item.entregado)!item.anterior&&(e.text(item.producto.codigo,45,i,{width:70}),codigo,e.text(item.ropaTrabajo.nombre,175,i,{width:70}),e.text(item.producto.unidad_medida,345,i,{width:100}),e.text(item.cantidad,485,i,{width:100}),i+=30,t++);18==t&&(e.addPage({margin:0,bufferPages:!0}),i=215,t=0,n+=1,T.DibujarCabeceraPDFAnticipoRegular(e,n,r,a))}e.font("Helvetica",10);var s=new Date;i<400?i=335:i+=30,e.rect(85,i-5,85,0).dash(5,{space:10}).stroke(),e.rect(300,i-5,85,0).dash(5,{space:10}).stroke(),e.rect(455,i-5,85,0).dash(5,{space:10}).stroke(),e.text("encargado Área",85,i),e.text("Supervisor",315,i),e.text("Recibó conforme",455,i),i+=30,e.text("USUARIO: "+T.usuario.persona.nombre_completo+" FECHA:"+T.fechaATexto(s),15,i),e.end(),o.on("finish",function(){var a=o.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),M.stop()},T.DibujarCabeceraPDFRopaTrabajo=function(i,a,e,o){i.font("Helvetica-Bold",12),i.text("DOTACIÓN ROPA DE TRABAJO",0,45,{align:"center"}),i.font("Helvetica",10),i.text("Nro. "+o.numero,0,65,{align:"center"}),i.text(T.fechaATexto(new Date(o.fecha)),0,85,{align:"center"}),i.font("Helvetica-Bold",10),i.text("Empleado: ",45,100),i.text("Cargo: ",400,100),i.text("Campamento: ",45,120),i.text("Periodo: ",45,140),i.text("Estado: ",400,140),i.text("Retrasado",45,160),i.rect(35,175,535,0).dash(5,{space:10}).stroke(),i.rect(35,200,535,0).dash(5,{space:10}).stroke(),i.text("Código",45,185,{width:70}),i.text("Descripcion",175,185,{width:70}),i.text("Unidad",345,185,{width:70}),i.text("Cant",485,185,{width:70}),i.font("Helvetica",10),i.text(T.empleado.nombre_completo,100,100),i.text(o.periodo.nombre,100,140),T.empleado.campamento&&i.text(T.empleado.campamento,120,120),i.text(o.estado.nombre,440,140);var t="";o.cargos?o.cargos.forEach(function(a,e,o){e===o.length-1?(t+=a.nombre,i.text(t,440,100)):t+=a.nombre+", "}):T.cargosEmpleado.forEach(function(a,e,o){e===o.length-1?(t+=a.cargo.nombre,i.text(t,440,100)):t+=a.nombre+", "})},T.generarReporteRopaTrabajo=function(a,e){"pdf"==a?T.generarpdfRopaTrabajoEmpleados(e):T.generarExcelRopaTrabajoEmpleados(e)},T.generarExcelRopaTrabajoEmpleados=function(l){l.inicio?(l.inicio=new Date(T.convertirFecha(l.inicio)),l.fin=new Date(T.convertirFecha(l.fin))):(l.inicio=0,l.fin=0),Pa(T.usuario.id_empresa,l).then(function(a){0==l.inicio&&(l.inicio="",l.fin="");for(var e=1,o=[["N°","Asignado a:","Codigo de Artículo","Descripción","unidad","cantidad","PU","TOTAL","N° de Documento","Fecha de Entrega"]],i=0;i<a.length;i++)if(a[i].dotacionRopa.empleado.id_campo==l.campo){var t=[];t.push(e++),t.push(a[i].dotacionRopa.empleado.persona.nombre_completo),t.push(a[i].producto.codigo),t.push(a[i].producto.nombre),t.push(a[i].producto.unidad_medida),t.push(a[i].cantidad),t.push(a[i].producto.precio_unitario),t.push(a[i].producto.precio_unitario*a[i].cantidad),t.push(a[i].dotacionRopa.numero),t.push(new Date(a[i].dotacionRopa.fecha)),o.push(t)}var n="SheetJS",r=new Workbook,c=sheet_from_array_of_arrays(o);r.SheetNames.push(n),r.Sheets[n]=c;var s=XLSX.write(r,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(s)],{type:"application/octet-stream"}),"REPORTES CONFIGURACION ROPA DE TRABAJO.xlsx"),M.stop()})},T.generarpdfRopaTrabajoEmpleados=function(d){d.inicio?(d.inicio=new Date(T.convertirFecha(d.inicio)),d.fin=new Date(T.convertirFecha(d.fin))):(d.inicio=0,d.fin=0),Pa(T.usuario.id_empresa,d).then(function(l){arregloNombres=[],l.forEach(function(a,e,o){if(0==e)arregloNombres.push(a.dotacionRopa.empleado.persona.nombre_completo);else{for(var i=!1,t=0;t<arregloNombres.length;t++){arregloNombres[t]===a.dotacionRopa.empleado.persona.nombre_completo&&(i=!0)}i||arregloNombres.push(a.dotacionRopa.empleado.persona.nombre_completo)}e===o.length-1&&convertUrlToBase64Image(T.usuario.empresa.imagen,function(a){var e=a;0==d.inicio&&(d.inicio="",d.fin="");var o=new PDFDocument({compress:!1,size:"letter",margin:10}),i=o.pipe(blobStream()),t=110,n=0,r=1,c=Math.ceil((l.length+arregloNombres.length)/20);T.DibujarCabeceraPDFRopaTrabajoEmpleados(o,r,c,l,e),o.font("Helvetica",10);for(var s=0;s<l.length&&n<=20;s++)item=l[s],0==s&&(o.font("Helvetica-Bold",10),o.text("Asignado a:",45,t),o.font("Helvetica",10),o.text(item.dotacionRopa.empleado.persona.nombre_completo,105,t),t+=30,o.rect(30,t-15,550,0).stroke(),o.rect(30,t-15,0,30).stroke(),o.rect(580,t-15,0,30).stroke(),n++),0<s&&(item.dotacionRopa.empleado.persona.nombre_completo===l[s-1].dotacionRopa.empleado.persona.nombre_completo?(o.rect(30,t-15,0,30).stroke(),o.rect(580,t-15,0,30).stroke()):(o.rect(30,t-15,550,0).stroke(),o.font("Helvetica-Bold",10),o.text("Asignado a:",45,t),o.font("Helvetica",10),o.text(item.dotacionRopa.empleado.persona.nombre_completo,105,t),t+=30,o.rect(30,t-15,550,0).stroke(),o.rect(30,t-15,0,30).stroke(),o.rect(580,t-15,0,30).stroke(),n++)),o.text(s+1,35,t),o.text(item.producto.codigo,85,t),o.text(item.producto.nombre,145,t),o.text(item.producto.unidad_medida,245,t),o.text(item.cantidad,295,t),o.text(item.producto.precio_unitario,345,t),o.text(item.producto.precio_unitario*item.cantidad,400,t),o.text(item.dotacionRopa.numero,480,t),o.text(T.fechaATexto(new Date(item.dotacionRopa.fecha)),500,t),t+=30,20==++n&&(o.rect(30,t-15,550,0).stroke(),o.addPage({margin:0,bufferPages:!0}),t=110,n=0,r+=1,T.DibujarCabeceraPDFRopaTrabajoEmpleados(o,r,c,l,e),l[s+1].dotacionRopa.empleado.persona.nombre_completo===l[s].dotacionRopa.empleado.persona.nombre_completo&&(o.rect(30,t-15,550,0).stroke(),o.font("Helvetica-Bold",10),o.text("Asignado a:",45,t),o.font("Helvetica",10),o.text(item.dotacionRopa.empleado.persona.nombre_completo,105,t),t+=30,o.rect(30,t-15,550,0).stroke(),o.rect(30,t-15,0,30).stroke(),o.rect(580,t-15,0,30).stroke(),n++));o.rect(30,t-15,550,0).stroke(),o.end(),i.on("finish",function(){var a=i.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),M.stop()})})})},T.DibujarCabeceraPDFRopaTrabajoEmpleados=function(a,e,o,i,t){a.font("Helvetica-Bold",12),a.text("DOTACION DE ROPA E IMPLEMENTOS DE TRABAJO",0,50,{align:"center"}),a.image(t,40,40,{fit:[80,80]}),a.rect(30,35,550,0).stroke(),a.rect(30,95,550,0).stroke(),a.rect(130,70,450,0).stroke(),a.rect(130,35,0,60).stroke(),a.rect(460,35,0,60).stroke(),a.rect(30,35,0,60).stroke(),a.rect(580,35,0,60).stroke(),a.font("Helvetica-Bold",8),a.text("Revicion:",470,50),a.text("Fecha de aprobación:",470,75),a.text("Código .",0,75,{align:"center"}),a.font("Helvetica",8);var n=new Date;a.text("Usuario: "+T.usuario.persona.nombre_completo+"      Fecha :  "+T.fechaATexto(n)+"   Hrs. "+n.getHours()+":"+n.getMinutes(),15,765),a.font("Helvetica-Bold",8),a.text("PÁGINA "+e+" DE "+o,0,740,{align:"center"})},T.imprimirFiniquito=function(E,A,R){if(R){T.vacacion={},T.beneficio=E,T.empleado=E.ficha.empleado,T.empleado.id_ficha=E.ficha.id,T.empleado.haber_basico=E.ficha.haber_basico,T.empleado.fecha_inicio=E.ficha.fecha_inicio,T.empleado.fecha_Retiro_beneficio=new Date(E.fecha_retiro),T.empleado.nombre_completo=E.ficha.empleado.persona.nombre_completo,T.empleado.estado=E.ficha.empleado.persona.estadoCivil.nombre,T.empleado.direccion=E.ficha.empleado.persona.direccion_zona,T.empleado.fecha_nacimiento=E.ficha.empleado.persona.fecha_nacimiento,T.empleado.ci=E.ficha.empleado.persona.ci,T.empleado.extension=E.ficha.empleado.extension.nombre,T.obtenerHistorialGestionesVacacion(T.empleado,!1,!0);var a=new Date;E.fecha_retiro&&(a=new Date(E.fecha_retiro));var e=new Date(E.fecha_ingreso);T.tiempoTrabajado=duration(e,a),E.mes_uno=T.meses[E.mes_uno],E.mes_dos=T.meses[E.mes_dos],E.mes_tres=T.meses[E.mes_tres],E.fecha_retiro&&(E.fecha_retiro=T.fechaATexto(E.fecha_retiro),E.totalAguinaldo=T.CalcularAguinaldoNavidad2(E)),E.ingresos=[],E.deducciones=[],E.deduccionEingresos.forEach(function(a,e,o){"OTRING"==a.tipo.nombre_corto?E.ingresos.push(a):E.deducciones.push(a),e===o.length-1&&T.calcularDesaucio(E,!0)})}convertUrlToBase64Image("./img/finiquito.png",function(D){convertUrlToBase64Image("./img/finiquito2.png",function(a){var e=D,o=a,i=new PDFDocument({compress:!1,size:[612,936],margin:10}),t=198,n=i.pipe(blobStream());if(A){var r=new Date;E.fecha_retiro&&(r=new Date(E.fecha_retiro));var c=new Date(E.fecha_ingreso);T.tiempoTrabajado=duration(c,r),E.mes_uno=T.meses[E.mes_uno],E.mes_dos=T.meses[E.mes_dos],E.mes_tres=T.meses[E.mes_tres]}i.image(e,30,30,{fit:[572,876]}),i.font("Helvetica",10),i.fillColor("#4183C4"),t=50<T.usuario.empresa.razon_social.length?182:187,i.text(T.usuario.empresa.razon_social,280,t,{width:250}),t=29<T.usuario.empresa.direccion.length?206:211,i.text("Servicios",230,t,{width:170}),i.text(T.usuario.empresa.direccion,387,t,{width:170}),t=29<T.usuario.empresa.direccion.length?231:236,i.text(T.empleado.nombre_completo,280,t,{width:250}),T.empleado.direccion&&(t=24<T.empleado.direccion.length?255:260,i.text(T.empleado.direccion,453,t,{width:250})),i.text(T.empleado.estado,160,260,{width:250}),i.text(T.empleado.cargos.split(",")[0],220,280,{width:250});r=new Date;var s=new Date(T.empleado.fecha_nacimiento),l=T.diferenciaEntreDiasEnDias(s,r);l=Math.trunc(l/365),i.text(l+" años",325,260,{width:250}),i.text(T.empleado.ci+" "+T.empleado.extension,130,298,{width:250}),i.text(T.fechaATexto(E.fecha_ingreso),325,298,{width:250});var d=(new Date).getMonth(),u=(new Date).getFullYear();if(E.fecha_retiro&&(d=new Date(E.fecha_retiro).getMonth(),u=new Date(E.fecha_retiro).getFullYear(),E.tipo_beneficio&&i.text(T.fechaATexto(E.fecha_retiro),490,298,{width:250})),E.motivo?(t=18<E.motivo.nombre.length?315:320,i.text(E.motivo.nombre,178,t,{width:120})):i.text("QUINQUENIO",180,320,{width:250}),i.text(T.number_format(E.promedio,2),490,320,{width:250}),E.tipo_beneficio?(i.text(T.tiempoTrabajado.anios,195,343,{width:250}),i.text(T.tiempoTrabajado.meses,290,343,{width:250}),i.text(T.tiempoTrabajado.dias,400,343,{width:250})):i.text(5*E.numero_quinquenio,195,343,{width:250}),E.mes_uno.id>E.mes_tres.id)var p=u-1;else p=u;if(E.mes_dos.id>E.mes_tres.id)var f=u-1;else f=u;if(i.text(E.mes_uno.nombre.toUpperCase()+" "+p,210,403),i.text(E.mes_dos.nombre.toUpperCase()+" "+f,300,403),i.text(E.mes_tres.nombre.toUpperCase()+" "+u,390,403),i.text(T.number_format(E.primer_mes,2),225,421),i.text(T.number_format(E.segundo_mes,2),315,421),i.text(T.number_format(E.tercer_mes,2),405,421),i.text(T.number_format(E.promedio,2),500,421),i.text(T.number_format(E.promedio,2),500,551),E.tipo_beneficio){for(var m=0,h="",g=0,b=0;b<E.ingresos.length;b++){"Desahucio"===(v=E.ingresos[b]).motivo?i.text(T.number_format(E.total_desahucio,2),503,580):"indemnizacion años"===v.motivo?(E.numero_quinquenio=null!=E.numero_quinquenio?E.numero_quinquenio:0,i.text(T.tiempoTrabajado.anios-5*E.numero_quinquenio,325,600),i.text(T.number_format(v.monto,2),435,600),g+=v.monto):"indemnizacion meses"===v.motivo?(i.text(T.tiempoTrabajado.meses,325,620),i.text(T.number_format(v.monto,2),435,620),g+=v.monto):"indemnizacion dias"===v.motivo?(i.text(T.tiempoTrabajado.dias,325,638),i.text(T.number_format(v.monto,2),435,638),g+=v.monto,i.text(T.number_format(g,2),503,638)):"Vacacion"===v.motivo?(i.text(E.totalV,415,672),i.text(T.number_format(v.monto,2),503,672)):"Aguinaldo de navidad"===v.motivo?(i.text(E.mesesAguinaldo,325,654),i.text(E.diasAguinaldo,415,654),i.text(T.number_format(v.monto,2),503,654)):(m+=v.monto,h+=v.motivo+", "),b===E.ingresos.length-1&&(72<h.length?(h=h.substring(0,72),h+="..."):i.text(h,110,603),i.text(T.number_format(m,2),503,709))}if(i.text(T.number_format(E.total_ingresos,2),503,745),0<E.deducciones.length){t=777;for(b=0;b<E.deducciones.length;b++){var v=E.deducciones[b];i.text(T.number_format(v.monto,2),365,t),i.text(v.motivo,155,t),t+=18,E.total_ingresos=E.total_ingresos-v.monto,b===E.deducciones.length-1&&i.text(T.number_format(E.total_ingresos,2),503,885)}}else i.text(T.number_format(E.total_ingresos,2),503,885)}else i.text(T.number_format(5*E.numero_quinquenio,0),325,600),i.text(T.number_format(E.promedio,2),435,600),i.text(T.number_format(E.total_quinquenio,2),503,600),i.text(T.number_format(E.total_quinquenio,2),503,745),i.text(T.number_format(E.total_quinquenio,2),503,885);i.addPage({margin:0,size:[612,936],bufferPages:!0}),i.image(o,30,30,{fit:[572,876]}),i.font("Helvetica",10),i.fillColor("#4183C4"),i.text(T.empleado.nombre_completo,70,130),i.text(T.empleado.ci+" "+T.empleado.extension,215,148),E.tipo_beneficio?(i.text("                                                                         "+ConvertirALiteral(E.total_ingresos.toFixed(2)),50,73,{width:470,lineGap:8}),i.text("Bs. "+T.number_format(E.total_ingresos,2),220,167)):(i.text("                                                                         "+ConvertirALiteral(E.total_quinquenio.toFixed(2)),50,73,{width:470,lineGap:8}),i.text("Bs. "+T.number_format(E.total_quinquenio,2),220,167)),null==E.cuenta?i.text("X",215,53):(i.text("X",315,53),i.text(E.cuenta.numero,500,53)),i.text(T.usuario.empresa.departamento.nombre,155,240);var _=(new Date).getDate();i.text(_,255,240),i.text(T.meses[d].nombre.toUpperCase(),330,240);u=(new Date).getFullYear();i.text(u.toString().substr(-2),515,240),i.text(T.empleado.nombre_completo.toUpperCase(),65,325,{width:250,align:"center"}),i.text(E.empleado_cargo_impresion.toUpperCase(),320,325,{width:250,align:"center"}),i.fillColor("#000000"),i.text(E.cargo_imprecion.toUpperCase(),400,335),i.end(),n.on("finish",function(){var a=n.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),R&&T.paginator.getSearch(T.paginator.search,T.filtroBeneficioEmpresa,null),M.stop()})})};T.obtenerChoferesViaje=function(){Sa(T.usuario.id_empresa).then(function(a){T.choferesViaje=a})},T.CargarEmpleadosViaje=function(h){var g=0;T.tiposViaje.clases.forEach(function(a,e,o){"INGRESO"==a.nombre&&(g=a),e==o.length-1&&(T.viaje.empleadosEntrada=[],T.empleadosRolTurnoE.forEach(function(i,a,e){for(var o=0;o<T.tiposPasajerosViaje.length;o++){if("HABILITADO"==(p=T.tiposPasajerosViaje[o]).nombre&&(i.estado=p),o===T.tiposPasajerosViaje.length-1){i.habilitado=!0,i.tipoViaje=g,i.id_ficha=i.empleadosFichas[i.empleadosFichas.length-1].id;for(var t=0;t<i.empleadosFichas[i.empleadosFichas.length-1].rolesTurno.length;t++)for(var n=i.empleadosFichas[i.empleadosFichas.length-1].rolesTurno[t],r=T.fechaATexto(n.fecha_inicio),c=new Date(T.convertirFecha(r)),s=new Date(T.convertirFecha(h));c.getTime()<=s.getTime();){if(c.getTime()===s.getTime()){if(0<i.empleadosFichas[i.empleadosFichas.length-1].ausencias.length)for(var l=0;l<i.empleadosFichas[i.empleadosFichas.length-1].ausencias.length;l++){(f=i.empleadosFichas[i.empleadosFichas.length-1].ausencias[l]).fechas=getDates(new Date(f.fecha_inicio),new Date(f.fecha_fin));for(var d=0;d<f.fechas.length;d++){var u=new Date(T.convertirFecha(T.formatofecha(f.fechas[d])));if(s.getTime()===u.getTime()){for(o=0;o<T.tiposPasajerosViaje.length;o++){var p=T.tiposPasajerosViaje[o];f.horas?"OTRA AUSENCIA"==p.nombre&&(i.estado=p):"AUSENCIA MEDICA"==p.nombre&&(i.estado=p)}i.habilitado=!1}}}if(0<i.empleadosFichas[i.empleadosFichas.length-1].vacaciones.length)for(l=0;l<i.empleadosFichas[i.empleadosFichas.length-1].vacaciones.length;l++){var f;(f=i.empleadosFichas[i.empleadosFichas.length-1].vacaciones[l]).fechas=getDates(new Date(f.fecha_inicio),new Date(f.fecha_fin));for(d=0;d<f.fechas.length;d++){u=new Date(T.convertirFecha(T.formatofecha(f.fechas[d])));if(s.getTime()===u.getTime()){for(o=0;o<T.tiposPasajerosViaje.length;o++){"VACACION"==(p=T.tiposPasajerosViaje[o]).nombre&&(i.estado=p)}i.habilitado=!1}}}if(i.eliminado){for(o=0;o<T.tiposPasajerosViaje.length;o++){"INHABILITADO"==(p=T.tiposPasajerosViaje[o]).nombre&&(i.estado=p)}i.habilitado=!1}i.campo=i.empleadosFichas[i.empleadosFichas.length-1].rolesTurno[0].campo;var m=!1;T.viaje.destinos.forEach(function(a,e,o){n.campo.id==a.id&&(m=!0),e===o.length-1&&1==m&&(i.campo=Object.assign({},n.campo),n.fecha_fin?new Date(T.convertirFecha(h)).getTime()<new Date(n.fecha_fin).getTime()&&T.viaje.empleadosEntrada.push(Object.assign({},i)):T.viaje.empleadosEntrada.push(Object.assign({},i)))})}r=T.fechaATexto(T.sumaFecha(n.dias_trabajado+n.dias_descanso,T.convertirFecha(r))),c=new Date(T.convertirFecha(r))}}}a===e.length-1&&console.log(T.viaje.empleadosEntrada)}))})},T.localStorageSpace=function(){var a="";for(var e in console.log("Current local storage: "),window.localStorage)window.localStorage.hasOwnProperty(e)&&(a+=window.localStorage[e],console.log(e+" = "+(16*window.localStorage[e].length/8192).toFixed(2)+" KB"));console.log(a?"\nTotal space used: "+(16*a.length/8192).toFixed(2)+" KB":"Empty (0 KB)"),console.log(a?"Approx. space remaining: "+(5120-(16*a.length/8192).toFixed(2))+" KB":"5 MB")},T.CargarEmpleadosViajeSalida=function(g){T.viaje.empleadosSalida=[];var b=0;T.tiposViaje.clases.forEach(function(a,e,o){"SALIDA"==a.nombre&&(b=a),e==o.length-1&&T.empleadosRolTurnoE.forEach(function(i,a,e){for(var o=0;o<T.tiposPasajerosViaje.length;o++){"HABILITADO"==(h=T.tiposPasajerosViaje[o]).nombre&&(i.estado=h)}i.tipoViaje=b,i.id_ficha=i.empleadosFichas[i.empleadosFichas.length-1].id;for(var t=0;t<i.empleadosFichas[i.empleadosFichas.length-1].rolesTurno.length;t++)for(var n=i.empleadosFichas[i.empleadosFichas.length-1].rolesTurno[t],r=T.fechaATexto(n.fecha_inicio),c=new Date(T.convertirFecha(r)),s=new Date(T.convertirFecha(g)),l=0;c.getTime()<=s.getTime();){if(c.getTime()===s.getTime()){if(0<i.empleadosFichas[i.empleadosFichas.length-1].ausencias.length)for(var d=0;d<i.empleadosFichas[i.empleadosFichas.length-1].ausencias.length;d++){(f=i.empleadosFichas[i.empleadosFichas.length-1].ausencias[d]).fechas=getDates(new Date(f.fecha_inicio),new Date(f.fecha_fin));for(var u=0;u<f.fechas.length;u++){var p=new Date(T.convertirFecha(T.formatofecha(f.fechas[u])));if(s.getTime()===p.getTime()){for(o=0;o<T.tiposPasajerosViaje.length;o++){"AUSENCIA"==(h=T.tiposPasajerosViaje[o]).nombre&&(i.estado=h)}i.habilitado=!1}}}if(0<i.empleadosFichas[i.empleadosFichas.length-1].vacaciones.length)for(d=0;d<i.empleadosFichas[i.empleadosFichas.length-1].vacaciones.length;d++){var f;(f=i.empleadosFichas[i.empleadosFichas.length-1].vacaciones[d]).fechas=getDates(new Date(f.fecha_inicio),new Date(f.fecha_fin));for(u=0;u<f.fechas.length;u++){p=new Date(T.convertirFecha(T.formatofecha(f.fechas[u])));if(s.getTime()===p.getTime()){for(o=0;o<T.tiposPasajerosViaje.length;o++){"VACACION"==(h=T.tiposPasajerosViaje[o]).nombre&&(i.estado=h)}i.habilitado=!1}}}i.campo=i.empleadosFichas[i.empleadosFichas.length-1].rolesTurno[0].campo;var m=!1;if(i.eliminado){for(o=0;o<T.tiposPasajerosViaje.length;o++){var h;"INHABILITADO"==(h=T.tiposPasajerosViaje[o]).nombre&&(i.estado=h)}i.habilitado=!1}T.viaje.destinos.forEach(function(a,e,o){i.campo.id==a.id&&(m=!0),e===o.length-1&&1==m&&T.viaje.empleadosSalida.push(Object.assign({},i))})}r=0==l?T.fechaATexto(T.sumaFecha(n.dias_trabajado,T.convertirFecha(r))):T.fechaATexto(T.sumaFecha(n.dias_trabajado+n.dias_descanso,T.convertirFecha(r))),c=new Date(T.convertirFecha(r)),l++}a===e.length-1&&console.log(T.viaje.empleadosSalida)})})},T.CopiarEmpleadosViaje=function(){T.viaje.empleadosSalida=[],T.viaje.empleadosSalida=T.viaje.empleadosEntrada.map(function(a){return Object.assign({},a)}),T.viaje.empleadosSalida.forEach(function(a,e,o){for(var i=0;i<T.tiposViaje.clases.length;i++){var t=T.tiposViaje.clases[i];"SALIDA"==t.nombre&&(a.tipoViaje=t)}})},T.cambiarEstadoPasajero=function(a){a.activo=0==a.eliminado,a.fecha_inicio=a.empleadosFichas[a.empleadosFichas.length-1].fecha_inicio,a.nombre_completo=a.persona.nombre_completo,T.cerrarModalDesabilitarPasajero(),T.abriirmodelAusenciasVacas(a),"OTRA AUSENCIA"==a.estado.nombre&&$("#otra-ausencia").click(),"AUSENCIA MEDICA"==a.estado.nombre&&$("#ausencia-medica").click(),"VACACION"==a.estado.nombre&&$("vacacion").click()},T.realizarCalendarioTrabajo=function(i){var t=[];if(i){if(i.inicio)for(var a=new Date(T.convertirFecha(i.inicio)).getFullYear(),e=new Date(T.convertirFecha(i.fin)).getFullYear();a<=e;)t.push(a),a++}else t.push((new Date).getFullYear());T.diasAnio=T.CalendarioRolTurnos(t,i),T.diasAnioPieTrabajos=T.CalendarioRolTurnos(t,i),T.diasAnioPieAusencias=T.CalendarioRolTurnos(t,i),T.diasAnioPieVacaciones=T.CalendarioRolTurnos(t,i),T.empleadosRolTurno.forEach(function(a,e,o){a.diasAnio=T.CalendarioRolTurnos(t,i),e==o.length-1&&T.empleadosRolTurno.forEach(function(a,e,o){var i=a,t="";i.fecha_fin&&(t=T.fechaATexto(i.fecha_fin));for(var n=!1,r=1,c=0;c<a.diasAnio.length;c++){var s=a.diasAnio[c];s.fecha==T.fechaATexto(i.fecha_inicio)?n=!0:new Date(T.convertirFecha(s.fecha)).getFullYear()>new Date(i.fecha_inicio).getFullYear()&&new Date(T.convertirFecha(s.fecha)).getDate()>=new Date(i.fecha_inicio).getDate()&&(n=!0),n&&(r<=i.dias_trabajado?(i.fecha_fin&&t==s.fecha&&(c=a.diasAnio.length),s.texto="T",r++):r<=i.dias_trabajado+i.dias_descanso&&(i.fecha_fin&&t==s.fecha&&(c=a.diasAnio.length),s.texto="D",r===i.dias_trabajado+i.dias_descanso&&(r=0),r++))}e==o.length-1&&T.empleadosRolTurno.forEach(function(a,e,o){for(var i=0;i<a.ficha.ausencias.length;i++){var t=a.ficha.ausencias[i];t.fechas=getDates(new Date(t.fecha_inicio),new Date(t.fecha_fin))}e==o.length-1&&T.empleadosRolTurno.forEach(function(a,e,o){for(var i=0;i<a.ficha.ausencias.length;i++)for(var t=a.ficha.ausencias[i],n=0;n<t.fechas.length;n++)for(var r=t.fechas[n],c=0;c<a.diasAnio.length;c++){var s=a.diasAnio[c];r==T.formatofecha(s.fecha)&&(s.mensaje=l.trustAsHtml(t.tipoAusencia.tipo.nombre+"<br> motivo:"+t.tipoAusencia.nombre),"D"==s.texto?t.horas?s.texto+="OA":s.texto+="BD":"T"==s.texto&&(t.horas?s.texto+="OA":s.texto+="BM"))}e==o.length-1&&T.empleadosRolTurno.forEach(function(a,e,o){for(var i=0;i<a.ficha.vacaciones.length;i++){var t=a.ficha.vacaciones[i];t.fechas=getDates(new Date(t.fecha_inicio),new Date(t.fecha_fin))}e==o.length-1&&T.empleadosRolTurno.forEach(function(a,e,o){for(var i=0;i<a.ficha.vacaciones.length;i++)for(var t=a.ficha.vacaciones[i],n=0;n<t.fechas.length;n++)for(var r=t.fechas[n],c=0;c<a.diasAnio.length;c++){var s=a.diasAnio[c];r==T.formatofecha(s.fecha)&&(s.mensaje=l.trustAsHtml("vacacion del <br>"+T.fechaATexto(t.fecha_inicio)+" al "+T.fechaATexto(t.fecha_fin)),s.texto,s.texto+="V")}e===o.length-1&&(T.diasAnioPieTrabajos.forEach(function(a,e,o){a.texto=parseInt(0);for(var i=0;i<T.empleadosRolTurno.length;i++)for(var t=T.empleadosRolTurno[i],n=0;n<t.diasAnio.length;n++){var r=t.diasAnio[n];a.fecha==r.fecha&&"T"==r.texto&&(a.texto+=1)}}),T.diasAnioPieAusencias.forEach(function(a,e,o){a.texto=parseInt(0);for(var i=0;i<T.empleadosRolTurno.length;i++)for(var t=T.empleadosRolTurno[i],n=0;n<t.diasAnio.length;n++){var r=t.diasAnio[n];a.fecha==r.fecha&&("A"!=r.texto&&"TBM"!=r.texto&&"DBD"!=r.texto||(a.texto+=1))}}),T.diasAnioPieVacaciones.forEach(function(a,e,o){a.texto=parseInt(0);for(var i=0;i<T.empleadosRolTurno.length;i++)for(var t=T.empleadosRolTurno[i],n=0;n<t.diasAnio.length;n++){var r=t.diasAnio[n];a.fecha==r.fecha&&("V"!=r.texto&&"TV"!=r.texto&&"DV"!=r.texto||(a.texto+=1))}o.length}))})})})})})})},T.CalendarioRolTurnos=function(a,d){T.mesesRolTurno=[];var u=[];if(d&&d.inicio){var p=new Date(T.convertirFecha(d.inicio)).getMonth(),f=new Date(T.convertirFecha(d.fin)).getMonth(),m=new Date(T.convertirFecha(d.inicio)).getDate(),h=new Date(T.convertirFecha(d.fin)).getDate();if(d.inicio2&&(p=new Date(T.convertirFecha(d.inicio2)).getMonth(),m=new Date(T.convertirFecha(d.inicio2)).getDate()),d.fin2)f=new Date(T.convertirFecha(d.fin2)).getMonth(),h=new Date(T.convertirFecha(d.fin2)).getDate()}for(var e=0;e<a.length;e++){var g=a[e];Object.assign([],T.meses).forEach(function(a,e,o){var i=Object.assign({},a);if(i.dias=[],i.anio=g,d&&d.inicio?i.id>p-1&&i.id<=f?i.visible=!0:i.visible=!1:i.visible=!0,T.mesesRolTurno.push(i),e===o.length-1)for(var t=1;t<366;t++){var n=T.fechaPorDia(g,t),r=(a=n.getMonth(),n.getDate()),c=(n.getDay(),{id:t,dia:r,visible:!0,texto:"",fecha:T.fechaATexto(n),mes:T.mesesRolTurno[a]});a==p?m<=r||(c.visible=!1):a==f&&(r<=h||(c.visible=!1)),u.push(c);for(var s=0;s<T.mesesRolTurno.length;s++){var l=T.mesesRolTurno[s];l.anio==g&&l.id==a&&(l.id==p?m<=r&&l.dias.push(r):l.id==f?r<=h&&l.dias.push(r):l.dias.push(r))}}})}return u},T.guardarViaje=function(e){e.fecha=new Date,e.fecha_ingreso=new Date(T.convertirFecha(e.fecha_ingreso)),e.fecha_salida&&(e.fecha_salida=new Date(T.convertirFecha(e.fecha_salida))),Va(e,T.usuario.id_empresa).then(function(a){T.cerrarDialogViajes(),T.imprimirReporteViaje(e),T.mostrarMensaje(a.mensaje)})},T.listaViajesPasajero=function(){0!=T.paginator.filter.inicio&&(T.paginator.filter.inicio=new Date(T.convertirFecha(T.paginator.filter.inicio)),T.paginator.filter.fin=new Date(T.convertirFecha(T.paginator.filter.fin))),Fa(T.paginator).then(function(a){0!=T.paginator.filter.inicio&&(T.paginator.filter.inicio=T.fechaATexto(T.paginator.filter.inicio),T.paginator.filter.fin=T.fechaATexto(T.paginator.filter.fin)),T.paginator.setPages(a.paginas),T.viajesEmpresa=a.viajes})},T.listaViajes=function(){0!=T.paginator.filter.inicio&&(T.paginator.filter.inicio=new Date(T.convertirFecha(T.paginator.filter.inicio)),T.paginator.filter.fin=new Date(T.convertirFecha(T.paginator.filter.fin))),Oa(T.paginator).then(function(a){0!=T.paginator.filter.inicio&&(T.paginator.filter.inicio=T.fechaATexto(T.paginator.filter.inicio),T.paginator.filter.fin=T.fechaATexto(T.paginator.filter.fin)),T.paginator.setPages(a.paginas),T.viajesEmpresa=a.viajes})},T.obtenerViajesPasajeros=function(){T.paginator=c(),T.paginator.column="id",T.paginator.direccion="asc",T.filtroViaje={empresa:T.usuario.id_empresa,inicio:"",fin:"",tipoPasajero:"",destino:"",vehiculo:"",conductor:"",tipoViaje:""},T.paginator.callBack=T.listaViajesPasajero,T.paginator.getSearch("",T.filtroViaje,null)},T.obtenerViajes=function(){T.paginator=c(),T.paginator.column="id",T.paginator.direccion="asc",T.filtroViaje={empresa:T.usuario.id_empresa,inicio:"",fin:"",destino:"",vehiculo:"",conductor:"",relevo:""},T.paginator.callBack=T.listaViajes,T.paginator.getSearch("",T.filtroViaje,null)},T.imprimirDesteHistorialReporteVIaje=function(i){i.empleadosEntrada=[],i.empleadosSalida=[];var t=[],n=Object.assign([],i.destinos);i.destinos.forEach(function(a,e,o){t.push(a.destino),e===o.length-1&&(i.destinos=t,i.viajeDetalles.forEach(function(a,e,o){a.persona=a.ficha.empleado.persona,"INGRESO"==a.tipoViaje.nombre?i.empleadosEntrada.push(a):i.empleadosSalida.push(a),e===o.length-1&&(T.imprimirReporteViaje(i),i.destinos=n)}))})},T.imprimirReporteViaje=function(i){if(0<i.empleadosEntrada.length){for(var a=[],e=i.destinos.map(function(a){return Object.assign({},a)}),t=i.empleadosEntrada,n=" (Ingreso)";destinos2=e.slice(0,6),a.push(destinos2),6<(e=e.slice(6,e.length)).length-1;);0<e.length&&a.push(e),a.forEach(function(a,e,o){T.generarPdfViaje(i,t,a,n)})}if(0<i.empleadosSalida.length){for(a=[],e=i.destinos.map(function(a){return Object.assign({},a)}),t=i.empleadosSalida,n=" (Salida)";destinos2=e.slice(0,6),a.push(destinos2),6<(e=e.slice(6,e.length)).length-1;);0<e.length&&a.push(e),a.forEach(function(a,e,o){T.generarPdfViaje(i,t,a,n)})}},T.generarPdfViaje=function(l,d,u,p){u.forEach(function(a,e,o){a.y=215,e===o.length-1&&convertUrlToBase64Image(T.usuario.empresa.imagen,function(a){var e=a,o=new PDFDocument({compress:!1,size:"letter",margin:10}),i=o.pipe(blobStream());T.dibujarCabeceraPDFViaje(o,l,1,e,u,p),o.font("Helvetica",5),itemsPorPagina=12,items=0,pagina=1;for(var t=0;t<d.length;t++)for(var n=35,r=d[t],c=0;c<u.length;c++){var s=u[c];u.length,r.campo.id===s.id&&(o.text(r.persona.nombre_completo,n,s.y,{width:91,align:"center"}),s.y+=10),n+=91}o.end(),i.on("finish",function(){var a=i.toBlobURL("application/pdf");window.open(a,"_blank","location=no")})})})},T.dibujarCabeceraPDFViaje=function(i,a,e,o,t,n){i.font("Helvetica-Bold",12),i.text("LISTA DE PASAJEROS",0,50,{align:"center"}),i.image(o,40,40,{fit:[80,80]}),i.rect(30,35,550,0).stroke(),i.rect(30,95,550,0).stroke(),i.rect(130,70,450,0).stroke(),i.rect(130,35,0,60).stroke(),i.rect(440,35,0,60).stroke(),i.rect(30,35,0,60).stroke(),i.rect(580,35,0,60).stroke(),i.font("Helvetica",10),i.text("Revición:",450,50),i.text("Fecha de aprobación:",450,72),i.text("Código .",0,75,{align:"center"}),i.font("Helvetica-Bold",10),i.rect(30,105,550,0).stroke(),i.text("Conductor 1:",35,110),i.text("licencia 1:",345,110),i.rect(30,120,550,0).stroke(),i.text("Conductor 2:",35,125),i.text("licencia 2:",345,125),i.rect(30,135,550,0).stroke(),i.text("Vehículo:",35,140),i.text("Placa:",345,140),i.rect(30,150,550,0).stroke(),i.text("Fecha:",35,160),i.font("Helvetica",10),i.text(a.conductor.nombre,135,110),i.text(a.relevo.nombre,135,125);var r=a.vehiculo.nombre.split("-");i.text(r[0],135,140),i.text(a.conductor.licencia+" "+a.conductor.tipoLicencia.nombre,415,110),i.text(a.relevo.licencia+" "+a.relevo.tipoLicencia.nombre,415,125),i.text(r[1],415,140),i.text(T.fechaATexto(a.fecha)+n,135,160),i.rect(30,105,0,45).stroke(),i.rect(115,105,0,45).stroke(),i.rect(340,105,0,45).stroke(),i.rect(410,105,0,45).stroke(),i.rect(580,105,0,45).stroke(),i.rect(30,170,550,590).stroke(),i.rect(30,190,550,0).stroke(),i.font("Helvetica-Bold",8),i.text("Campamentos",0,177,{align:"center"});var c=125,s=30,l=125;t.forEach(function(a,e,o){i.rect(c,190,0,570).stroke(),0==e?(i.text(a.nombre,s,195,{width:91,align:"center"}),i.rect(s,212,95,0).stroke()):(i.text(a.nombre,c-91,195,{width:91,align:"center"}),i.rect(l,212,91,0).stroke(),l+=91),c+=91,s+=95})},T.obtenerbeneficiosSocialesEmpresa=function(){T.paginator=c(),T.paginator.column="id",T.paginator.direccion="asc",T.filtroBeneficioEmpresa={empresa:T.usuario.id_empresa,inicio:"",fin:"",motivo:"",tipo:0},T.paginator.callBack=T.listaBeneficiosEmpresa,T.paginator.getSearch("",T.filtroBeneficioEmpresa,null)},T.listaBeneficiosEmpresa=function(){0!=T.paginator.filter.inicio&&(T.paginator.filter.inicio=new Date(T.convertirFecha(T.paginator.filter.inicio)),T.paginator.filter.fin=new Date(T.convertirFecha(T.paginator.filter.fin))),Na(T.paginator).then(function(a){0!=T.paginator.filter.inicio&&(T.paginator.filter.inicio=T.fechaATexto(T.paginator.filter.inicio),T.paginator.filter.fin=T.fechaATexto(T.paginator.filter.fin)),T.paginator.setPages(a.paginas),T.beneficiosEmpresa=a.beneficios})},T.imprimirReciboVacacion=function(l,d,u,p,f){convertUrlToBase64Image(T.usuario.empresa.imagen,function(a){var e=new PDFDocument({compress:!1,size:"letter",margin:10}),o=e.pipe(blobStream()),i=new Date(l.createdAt),t=30,n=new Date;T.dibujarCabeceraPDFImpresionVacacion(e,l,a,t,d),e.font("Helvetica",10),e.text(T.fechaATexto(l.createdAt),80,t+80),e.text(d,90,t+110),e.text(T.fechaATexto(u),410,t+110);var r="";if(l.detalleDescuentosVacacionHistorial){for(var c=0;c<l.detalleDescuentosVacacionHistorial.length;c++){r=(s=l.detalleDescuentosVacacionHistorial[c]).historialVacacion.gestion+"-"+(s.historialVacacion.gestion+1)}0<l.detalleDescuentosVacacionHistorial.length&&e.text(l.detalleDescuentosVacacionHistorial[l.detalleDescuentosVacacionHistorial.length-1].historialVacacion.aplicadas-l.detalleDescuentosVacacionHistorial[l.detalleDescuentosVacacionHistorial.length-1].historialVacacion.tomadas+" días de la Gestion "+l.detalleDescuentosVacacionHistorial[l.detalleDescuentosVacacionHistorial.length-1].historialVacacion.gestion+"-"+(l.detalleDescuentosVacacionHistorial[l.detalleDescuentosVacacionHistorial.length-1].historialVacacion.gestion+1),430,t+140)}else e.text(f,430,t+140);null!=p?e.text(p,100,t+140):e.text(r,100,t+140),e.text(l.inicio_tipo?T.fechaATexto(l.fecha_inicio)+" (dia)":T.fechaATexto(l.fecha_inicio)+" (medio dia)",60,t+170),e.text(l.fin_tipo?T.fechaATexto(l.fecha_fin)+" (dia)":T.fechaATexto(l.fecha_fin)+" (medio dia)",370,t+170),e.text(l.dias+" días",70,t+200),e.text(l.domingos,305,t+200),null!=l.feriados?e.text(l.feriados,410,t+200):e.text(l.dias_descuento,410,t+200),e.text(l.observacion,40,t+260),e.font("Helvetica",5),e.text("EMISIÓN: "+i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear(),200,375),e.text("IMPRESIÓN: "+n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear(),260,375),e.text("USUARIO: "+T.usuario.persona.nombre_completo,40,375),e.font("Helvetica",8),e.rect(3,400,600,0).dash(1,{space:5}).stroke(),t=430,T.dibujarCabeceraPDFImpresionVacacion(e,l,a,430,d),e.font("Helvetica",10),e.text(T.fechaATexto(n),80,t+80),e.text(d,90,t+110),e.text(T.fechaATexto(u),410,t+110);r="";if(l.detalleDescuentosVacacionHistorial){for(c=0;c<l.detalleDescuentosVacacionHistorial.length;c++){var s;r=(s=l.detalleDescuentosVacacionHistorial[c]).historialVacacion.gestion+"-"+(s.historialVacacion.gestion+1)}0<l.detalleDescuentosVacacionHistorial.length&&e.text(l.detalleDescuentosVacacionHistorial[l.detalleDescuentosVacacionHistorial.length-1].historialVacacion.aplicadas-l.detalleDescuentosVacacionHistorial[l.detalleDescuentosVacacionHistorial.length-1].historialVacacion.tomadas+" días de la Gestion "+l.detalleDescuentosVacacionHistorial[l.detalleDescuentosVacacionHistorial.length-1].historialVacacion.gestion+"-"+(l.detalleDescuentosVacacionHistorial[l.detalleDescuentosVacacionHistorial.length-1].historialVacacion.gestion+1),430,t+140)}else e.text(f,430,t+140);null!=p?e.text(p,100,t+140):e.text(r,100,t+140),e.text(l.inicio_tipo?T.fechaATexto(l.fecha_inicio)+" (dia)":T.fechaATexto(l.fecha_inicio)+" (medio dia)",60,t+170),e.text(l.fin_tipo?T.fechaATexto(l.fecha_fin)+" (dia)":T.fechaATexto(l.fecha_fin)+" (medio dia)",370,t+170),e.text(l.dias+" días",70,t+200),e.text(l.domingos,305,t+200),null!=l.feriados?e.text(l.feriados,410,t+200):e.text(l.dias_descuento,410,t+200),e.text(l.observacion,40,t+260),e.font("Helvetica",5),e.text("EMISIÓN: "+i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear(),200,775),e.text("IMPRESIÓN: "+n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear(),260,775),e.text("USUARIO: "+T.usuario.persona.nombre_completo,40,775),e.end(),o.on("finish",function(){var a=o.toBlobURL("application/pdf");window.open(a,"_blank","location=no")})})},T.dibujarCabeceraPDFImpresionVacacion=function(a,e,o,i,t){a.font("Helvetica-Bold",16),a.text("BOLETA DE PERMISO",0,i,{align:"center"}),a.text("VACACIONES",0,i+30,{align:"center"}),a.rect(0,i+65,630,0).dash(0,{space:0}).stroke(),a.image(o,40,i-20,{fit:[80,80]}),a.font("Helvetica-Bold",10),a.text("Fecha:",40,i+80),a.text("Nombre:",40,i+110),a.text("F. Ingreso:",350,i+110),a.text("Gestiones:",40,i+140),a.text("Días restantes:",350,i+140),a.text("del:",40,i+170),a.text("Al:",350,i+170),a.text("Total:",40,i+200),a.text("OBSERVACIÓN",40,i+230),a.text("Domingos:",240,i+200),a.text("Feriados:",350,i+200),a.font("Helvetica",10),a.text(t,40,i+320),a.text("EMPLEADO",100,i+330),a.text("JEFE DE AREA",280,i+320),a.text("JEFE DE R.R.H.H.",440,i+320)},T.fechaPorDia=function(a,e){var o=new Date(a,0);return new Date(o.setDate(e))},T.generarPdfEstadoVacacionEmpresa=function(a,e){M.start();var o=new PDFDocument({size:"letter",margin:10}),i=o.pipe(blobStream()),t=120,n=0,r=Math.ceil(a.length/28);T.dibujarCabeceraPDFVacacionEmpresa(o,1,r,a,e),o.font("Helvetica",8);for(var c=0;c<a.length&&n<=28;c++){var s=a[c];o.text(s.ficha.empleado.persona.nombre_completo,45,t),o.text(T.fechaATexto(s.fecha_inicio),220,t,{width:50}),o.text(T.fechaATexto(s.fecha_fin),290,t,{width:60}),o.text(s.dias,370,t,{width:50}),o.text(s.observacion,420,t,{width:200}),t+=20,28==++n&&(o.addPage({margin:0,bufferPages:!0}),t=120,n=0,1,T.dibujarCabeceraPDFVacacionEmpresa(o,1,r,a,e),o.font("Helvetica",8))}o.font("Helvetica",5);var l=new Date,d=l.getMinutes();d<10&&(d="0"+d);new Date;o.text("IMPRESIÓN: "+T.fechaATexto(l)+" Hr. "+l.getHours()+":"+d,180,775),o.text("USUARIO: "+T.usuario.persona.nombre_completo,40,775),o.font("Helvetica-Bold",8),o.end(),i.on("finish",function(){var a=i.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),M.stop()},T.generarPdfHistorialVacacionEmpresa=function(a,e){M.start();var o=new PDFDocument({size:"letter",margin:10}),i=o.pipe(blobStream()),t=120,n=0,r=Math.ceil(a.length/28);T.dibujarCabeceraPDFHistorialVacacionEmpresa(o,1,r,a,e),o.font("Helvetica",8);for(var c=0;c<a.length;c++){var s=a[c];if(!s.ficha.fecha_expiracion){for(var l=0;l<s.ficha.historialVacaciones.length&&n<=28;l++){var d=s.ficha.historialVacaciones[l];o.text(s.ficha.empleado.persona.nombre_completo,45,t),o.text(d.aplicadas,250,t,{width:50}),o.text(d.tomadas,350,t,{width:60}),o.text(d.aplicadas-d.tomadas,450,t,{width:50}),t+=20,n++}28==n&&(o.addPage({margin:0,bufferPages:!0}),t=120,n=0,1,T.dibujarCabeceraPDFHistorialVacacionEmpresa(o,1,r,a,e),o.font("Helvetica",8))}}o.font("Helvetica",5);var u=new Date,p=u.getMinutes();p<10&&(p="0"+p);new Date;o.text("IMPRESIÓN: "+T.fechaATexto(u)+" Hr. "+u.getHours()+":"+p,180,775),o.text("USUARIO: "+T.usuario.persona.nombre_completo,40,775),o.font("Helvetica-Bold",8),o.end(),i.on("finish",function(){var a=i.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),M.stop()},T.generarExcelEstadoVacacionEmpresa=function(a){for(var e=[["","","REPORTE DE VACACIONES"],["Nombre","Desde","Hasta","Días","Observacion","Sabado","Gestión","Dias Rest.","Estado","Fecha Baja"]],o=0;o<a.length;o++){var i=[],t=a[o];if(!t.ficha.fecha_expiracion){i.push(t.ficha.empleado.persona.nombre_completo),i.push(new Date(t.fecha_inicio)),i.push(new Date(t.fecha_fin)),i.push(t.dias),i.push(t.observacion),i.push(t.sabado?"Si":"No");for(var n="",r=0;r<t.detalleDescuentosVacacionHistorial.length;r++){0<r&&(n+=", ");var c=t.detalleDescuentosVacacionHistorial[r],s=c.historialVacacion.gestion+1;n+=c.historialVacacion.gestion+"-"+s}i.push(n),i.push(t.diasRestantes),i.push(t.ficha.empleado.eliminado?"Incantivo":"Activo"),i.push(new Date(t.ficha.fecha_expiracion)),e.push(i)}}var l="SheetJS",d=new Workbook,u=sheet_from_array_of_arrays(e);d.SheetNames.push(l),d.Sheets[l]=u;var p=XLSX.write(d,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(p)],{type:"application/octet-stream"}),"REPORTE-VACACIONES.xlsx"),M.stop()},T.generarExcelHistorialVacacionEmpresa=function(a){for(var e=[["Nombre","Cargo","Campo","Gestión","Aplicadas","Todamas","Restantes"]],o=0;o<a.length;o++)for(var i=[],t=a[o],n=0;n<t.ficha.historialVacaciones.length;n++){i=[];var r=t.ficha.historialVacaciones[n];i.push(t.ficha.empleado.persona.nombre_completo);for(var c="",s=0;s<t.ficha.cargos.length;s++){0<s&&(c+=", "),c+=t.ficha.cargos[s].cargo.nombre}i.push(c),i.push(t.ficha.empleado.campo.nombre);var l=r.gestion+1,d=r.gestion+"-"+l;i.push(d),i.push(r.aplicadas),i.push(r.tomadas),i.push(r.aplicadas-r.tomadas),e.push(i)}var u="SheetJS",p=new Workbook,f=sheet_from_array_of_arrays(e);p.SheetNames.push(u),p.Sheets[u]=f;var m=XLSX.write(p,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(m)],{type:"application/octet-stream"}),"REPORTE-VACACIONES-RESTANTES.xlsx"),M.stop()},T.dibujarCabeceraPDFVacacionEmpresa=function(a,e,o,i,t){a.font("Helvetica-Bold",12),a.text("REPORTE DE VACACIONES",0,25,{align:"center"}),t?(a.text(T.empleado.nombre_completo,0,45,{align:"center"}),a.text("PERIODO: TODOS",0,65,{align:"center"})):a.text("PERIODO: TODOS",0,45,{align:"center"}),a.font("Helvetica-Bold",8),a.text("NOMBRE",45,90),a.text("DESDE",220,90),a.text("HASTA",290,90),a.text("DÍAS",370,90),a.text("OBSERVACIÓN",420,90),a.font("Helvetica-Bold",8),a.text("PÁGINA "+e+" DE "+o,0,740,{align:"center"})},T.dibujarCabeceraPDFHistorialVacacionEmpresa=function(a,e,o,i,t){a.font("Helvetica-Bold",12),a.text("REPORTE DE VACACIONES RESTANTES",0,25,{align:"center"}),t?(a.text(T.empleado.nombre_completo,0,45,{align:"center"}),a.text("PERIODO: TODOS",0,65,{align:"center"})):a.text("PERIODO: TODOS",0,45,{align:"center"}),a.font("Helvetica-Bold",8),a.text("EMPLEADO",45,90),a.text("APLICADAS",250,90),a.text("TOMADAS",350,90),a.text("RESTANTES",450,90),a.font("Helvetica-Bold",8),a.text("PÁGINA "+e+" DE "+o,0,740,{align:"center"})},T.AgregarProrreteo=function(a){if(1==a)for(var e=(new Date).getFullYear(),o=(new Date).getMonth(),i=0;i<T.historialEmpresaVacacionesGestion.length;i++)for(var t=T.historialEmpresaVacacionesGestion[i],n=0;n<t.ficha.historialVacaciones.length;n++){var r=t.ficha.historialVacaciones[n];r.gestion==e&&(r.aplicadas=Math.round(r.aplicadas*o/12))}else{T.obtenerHistorialEmpresaVacacionGestion({})}},T.obtenerHistorialEmpresaVacacionGestion=function(a){var e={inicio:0,fin:0,estado:2};a.inicio&&(e.inicio=new Date(T.convertirFecha(a.inicio)),e.fin=new Date(T.convertirFecha(a.fin))),a.estado&&(e.estado=a.estado),ea(T.usuario.id_empresa,e).then(function(n){n.forEach(function(a,e,o){for(var i=a.diasRestantes=0;i<a.ficha.historialVacaciones.length;i++){var t=a.ficha.historialVacaciones[i];a.diasRestantes+=t.aplicadas-t.tomadas}e===o.length-1&&(T.historialEmpresaVacacionesGestion=n)})})},T.ReporteDehijos=function(c,s,l){La(T.usuario.id_empresa).then(function(t){var n=new Date,r=[];t.forEach(function(a,e,o){console.log("falta funcionalidad"),fechaNacimiento=new Date(a.persona.fecha_nacimiento);var i=T.diferenciaEntreDiasEnDias(fechaNacimiento,n);a.edad=Math.trunc(i/365),e===o.length-1&&t.forEach(function(a,e,o){l?a.edad>=c&&a.edad<=s&&r.push(a):0==a.empleado.eliminado&&a.edad>=c&&a.edad<=s&&r.push(a),e===o.length-1&&T.generarReproteHijos(r)})}),console.log(t)})},T.generarReproteHijos=function(a){for(var e=[["CODIGO","EMPLEADO","L_APORTE","DEPARTAMENTO","PROVINCIA","LOCALIDAD","RECIDENCIA","CAMPO","ESTADO","NOMBRES","APELLIDO PATERNO","APELLIDO MATERNO","FECHA_NAC","SEXO","EDAD","AFILIADO","RELACION"]],o=[],i=0;i<a.length;i++){var t=[];t.push(a[i].empleado.codigo),t.push(a[i].empleado.persona.nombre_completo),t.push(a[i].empleado.empleadosFichas[a[i].empleado.empleadosFichas.length-1].aporteSeguroLargoPlazo.nombre),t.push(a[i].empleado.persona.ciudad?a[i].empleado.persona.ciudad.nombre:""),t.push(a[i].empleado.persona.provincia?a[i].empleado.persona.provincia.nombre:""),t.push(a[i].empleado.persona.localidad?a[i].empleado.persona.localidad.nombre:""),t.push(a[i].empleado.persona.direccion_numero),t.push(a[i].empleado.campo.nombre),t.push(""),t.push(a[i].persona.nombres),t.push(a[i].persona.apellido_paterno),t.push(a[i].persona.apellido_materno),t.push(new Date(a[i].persona.fecha_nacimiento)),t.push(a[i].persona.genero.nombre),t.push(a[i].edad),t.push(null!=a[i].afiliado&&a[i].afiliado?"si":"no"),t.push(a[i].relacion.nombre),o.push(i),e.push(t)}var n="SheetJS",r=new Workbook,c=sheet_from_array_of_arrays(e);r.SheetNames.push(n),r.Sheets[n]=c;var s=XLSX.write(r,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(s)],{type:"application/octet-stream"}),"EMPLEADO RRHH.xlsx"),M.stop()},T.inicio()}]);