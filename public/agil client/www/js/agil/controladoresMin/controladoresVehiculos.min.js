angular.module("agil.controladores").controller("ControladorVehiculos",["$scope","blockUI","$localStorage","$location","$templateCache","$route","$timeout","Diccionario","ClasesTipo","$window","Paginator","VehiculosPaginador","FieldViewer","ListaMantenimientoVehiculo","ClasesTipo","ListaMantenimientoEncargado","ProductosPanel","ListaProductosEmpresa","ListaInventariosProducto","GuardarNuevaOrdendeTrabajo","ActualizarOrdendeTrabajo","DatosFechasVehiculos","ObtenerDatosVehiculo",function(c,i,n,a,e,o,r,t,l,d,u,s,m,p,l,v,f,h,M,b,g,P,E){c.usuario=JSON.parse(n.usuario),c.modalNuevoMantenimiento="dialog-iniciar-mantenimiento",c.modalReportarIncidente="modal-reportar-incidente",c.modalCheckListDiario="modal-checklist-diario",c.modalCheckListMensual="modal-checklist-mensual",c.modalEditarHistorico="dialog-editar-historico",c.modalOTEdicionCorrectivo="dialog-edicion-correctivo",c.modalMantenimientoCorrectivo="dialog-mantenimiento-correctivo",c.modalBusquedaProducto="dialog-busqueda-producto",c.modalBusquedaEncargado="dialog-busqueda-encargado",c.modalLogin="dialog-login",c.modalNuevoMantenimientoMaquinaria="dialog-iniciar-mantenimiento-maquinaria",c.modalCheckListMensualMaquinaria="modal-checklist-mensual-maquinaria",c.modalEditarItemList="dialog-editar-item-list",c.modalProxMantenimientoMaquinaria="dialog-prox-mantenimiento-maquinaria",c.modalProxMantenimientoVehiculo="dialog-prox-mantenimiento-vehiculo",c.modalCalendar="dialog-calendar",c.modalFichaVehiculo="dialog-ficha-vehiculo",c.modalEditarCheckList="modal-editar-checklist",c.modalBuscarMaquinaria="dialog-buscar-maquinaria",c.modalReportarIncidenteMaquinaria="modal-reportar-incidente-maquinaria",c.idModalInicioMantenimiento="dialog-iniciar-mantenimiento",c.idModalOTNuevo="dialog-ot-nuevo",c.idModalFacturaServicioExterno="dialog-factura-servicioExterno",c.idModaRepuestosOT="panel-repuestos-ot",c.idModalwizardContainerOTNuevo="modal-wizard-ot-nuevo-container",c.idModalEventoCalendario="dialog-evento-calendario",c.idModalEditarEventoCalendario="dialog-editar-evento-calendario",console.log(a.path()),c.$on("$viewContentLoaded",function(){resaltarPestaña(a.path().substring(1)),ejecutarScriptsVehiculos(c.modalNuevoMantenimiento,c.modalReportarIncidente,c.modalCheckListDiario,c.modalCheckListMensual,c.modalEditarHistorico,c.modalOTEdicionCorrectivo,c.modalMantenimientoCorrectivo,c.modalBusquedaProducto,c.modalBusquedaEncargado,c.modalLogin,c.modalNuevoMantenimientoMaquinaria,c.modalCheckListMensualMaquinaria,c.modalEditarItemList,c.modalProxMantenimientoMaquinaria,c.modalProxMantenimientoVehiculo,c.modalCalendar,c.modalFichaVehiculo,c.modalEditarCheckList,c.modalBuscarMaquinaria,c.modalReportarIncidenteMaquinaria,c.idModalInicioMantenimiento,c.idModalOTNuevo,c.idModalwizardContainerOTNuevo,c.idModalFacturaServicioExterno,c.idModaRepuestosOT,c.idModalEventoCalendario,c.idModalEditarEventoCalendario),c.buscarAplicacion(c.usuario.aplicacionesUsuario,a.path().substring(1)),c.obtenerColumnasAplicacion()}),c.$on("$routeChangeStart",function(a,e){c.eliminarPopup(c.modalNuevoMantenimiento),c.eliminarPopup(c.modalReportarIncidente),c.eliminarPopup(c.modalCheckListDiario),c.eliminarPopup(c.modalCheckListMensual),c.eliminarPopup(c.modalEditarHistorico),c.eliminarPopup(c.modalMantenimientoCorrectivo),c.eliminarPopup(c.modalOTEdicionCorrectivo),c.eliminarPopup(c.modalBusquedaProducto),c.eliminarPopup(c.modalBusquedaEncargado),c.eliminarPopup(c.modalLogin),c.eliminarPopup(c.modalNuevoMantenimientoMaquinaria),c.eliminarPopup(c.modalCheckListMensualMaquinaria),c.eliminarPopup(c.modalEditarItemList),c.eliminarPopup(c.modalProxMantenimientoMaquinaria),c.eliminarPopup(c.modalProxMantenimientoVehiculo),c.eliminarPopup(c.modalCalendar),c.eliminarPopup(c.modalFichaVehiculo),c.eliminarPopup(c.modalEditarCheckList),c.eliminarPopup(c.modalBuscarMaquinaria),c.eliminarPopup(c.modalReportarIncidenteMaquinaria),c.eliminarPopup(c.idModalOTNuevo),c.eliminarPopup(c.idModalEventoCalendario),c.eliminarPopup(c.idModalEditarEventoCalendario),c.eliminarPopup(c.idModaRepuestosOT)}),c.inicio=function(){c.ObteneVehiculos(),c.obtenerTiposMantenimiento(),c.obtenerTiposSistemasOrdenTrabajo(),c.obtenerTiposPrioridad(),c.obtenerTiposEspecialidad(),c.aplicarCalendario(),c.sucursales=c.obtenerSucursales()},c.abrirReportarIncidenteMaquinaria=function(){abrirPopup(c.modalReportarIncidenteMaquinaria)},c.abrirEventoCalendario=function(){abrirPopup(c.idModalEventoCalendario)},c.abrirEditarEventoCalendario=function(){abrirPopup(c.idModalEditarEventoCalendario)},c.abrirBuscarMaquinaria=function(){abrirPopup(c.modalBuscarMaquinaria)},c.abrirEditarCheckList=function(){abrirPopup(c.modalEditarCheckList)},c.abrirFichaVehiculo=function(){abrirPopup(c.modalFichaVehiculo)},c.abrirOTCalendar=function(){c.calendario={id_empresa:c.usuario.id_empresa,correctivo:!1,preventivo:!1,rutina:!1,entrega:!1},abrirPopup(c.modalCalendar)},c.abrirProxMantenimientoVehiculos=function(){abrirPopup(c.modalProxMantenimientoVehiculo)},c.abrirProxMantenimientoMaquinaria=function(){abrirPopup(c.modalProxMantenimientoMaquinaria)},c.abrirEditarItemList=function(){abrirPopup(c.modalEditarItemList)},c.abrirCheckListMensualMaquinaria=function(){abrirPopup(c.modalCheckListMensualMaquinaria)},c.abrirNuevoMantenimientoMaquinaria=function(){abrirPopup(c.modalNuevoMantenimientoMaquinaria)},c.abrirModalLogin=function(){abrirPopup(c.modalLogin)},c.abrirBusquedaEncargado=function(){abrirPopup(c.modalBusquedaEncargado)},c.abrirBusquedaProducto=function(){abrirPopup(c.modalBusquedaProducto)},c.abrirMantenimientoCorrectivo=function(){abrirPopup(c.modalMantenimientoCorrectivo)},c.abrirOTEdicionCorrectivo=function(e){promesa=E(c.usuario.id_empresa,e.id),promesa.then(function(a){c.editOt=!0,c.vehiculo=a.mantenimiento,c.vehiculo.fecha_hora_inicio=moment(e.fecha_hora_inicio).format("MM/DD/YYYY h:mm A"),c.vehiculo.fecha_hora_fin=moment(e.fecha_hora_inicio).format("MM/DD/YYYY h:mm A"),c.vehiculo.fecha_hora_aviso=moment(e.fecha_hora_inicio).format("MM/DD/YYYY h:mm A"),c.vehiculo.manosDeObra.forEach(function(a){a.horas=24*c.diferenciaEntreDiasEnDias(new Date(a.fecha_inicio),new Date(a.fecha_fin))},this),console.log(c.vehiculo),abrirPopup(c.modalOTEdicionCorrectivo)})},c.abrirEditarHistorico=function(){abrirPopup(c.modalEditarHistorico)},c.abrirCheckListMensual=function(){abrirPopup(c.modalCheckListMensual)},c.abrirCheckListDiario=function(){abrirPopup(c.modalCheckListDiario)},c.abrirReportarIncidente=function(){abrirPopup(c.modalReportarIncidente)},c.abrirNuevoMantenimiento=function(){abrirPopup(c.modalNuevoMantenimiento)},c.abrirPopup=function(a){abrirPopup(a)},c.cerrarPopup=function(a){ocultarPopup(a)},c.cerrarEventoCalendario=function(){c.cerrarPopup(c.idModalEventoCalendario)},c.cerrarEditarEventoCalendario=function(){c.cerrarPopup(c.idModalEditarEventoCalendario)},c.cerrarReportarIncidenteMaquinaria=function(){c.cerrarPopup(c.modalReportarIncidenteMaquinaria)},c.cerrarBuscarMaquinaria=function(){c.cerrarPopup(c.modalBuscarMaquinaria)},c.cerrarEditarCheckList=function(){c.cerrarPopup(c.modalEditarCheckList)},c.cerrarFichaVehiculo=function(){c.cerrarPopup(c.modalFichaVehiculo)},c.cerrarOTCalendar=function(){c.cerrarPopup(c.modalCalendar)},c.cerrarProxMantenimientoVehiculos=function(){c.cerrarPopup(c.modalProxMantenimientoVehiculo)},c.cerrarProxMantenimientoMaquinaria=function(){c.cerrarPopup(c.modalProxMantenimientoMaquinaria)},c.cerrarEditarItemList=function(){c.cerrarPopup(c.modalEditarItemList)},c.cerrarCheckListMensualMaquinaria=function(){c.cerrarPopup(c.modalCheckListMensualMaquinaria)},c.cerrarNuevoMantenimientoMaquinaria=function(){c.cerrarPopup(c.modalNuevoMantenimientoMaquinaria)},c.cerrarModalLogin=function(){c.cerrarPopup(c.modalLogin)},c.cerrarBusquedaEncargado=function(){c.cerrarPopup(c.modalBusquedaEncargado)},c.cerrarBusquedaProducto=function(){c.cerrarPopup(c.modalBusquedaProducto)},c.cerrarMantenimientoCorrectivo=function(){c.cerrarPopup(c.modalMantenimientoCorrectivo)},c.cerrarOTEdicionCorrectivo=function(){c.editOt=!1,c.cerrarPopup(c.modalOTEdicionCorrectivo)},c.cerrarEditarHistorico=function(){c.cerrarPopup(c.modalEditarHistorico)},c.cerrarCheckListMensual=function(){c.cerrarPopup(c.modalCheckListMensual)},c.cerrarCheckListDiario=function(){c.cerrarPopup(c.modalCheckListDiario)},c.cerrarReportarIncidente=function(){c.cerrarPopup(c.modalReportarIncidente)},c.cerrarNuevoMantenimiento=function(){c.cerrarPopup(c.modalNuevoMantenimiento)},c.eliminarPopup=function(a){eliminarPopup(a)},c.enfocar=function(a){r(function(){$("#"+a).focus()},0)},c.abrirDialogInicioMantenimiento=function(){c.nuevoOt={tipo_mantenimiento:"",ordenTrabajoManoObra:[],servicioExterno:[]},c.abrirPopup(c.idModalInicioMantenimiento)},c.cerrarPopUpInicioMantenimiento=function(){c.cerrarPopup(c.idModalInicioMantenimiento)},c.abrirDialogOTnuevo=function(a){a&&(c.ordenTrabajoManoObra={edit:!1},console.log(c.ordenTrabajoManoObra),c.cerrarPopUpInicioMantenimiento(),c.abrirPopup(c.idModalOTNuevo))},c.cerrarOTnuevo=function(){c.cerrarPopup(c.idModalOTNuevo)},c.abrirDialogFacturaServicioExterno=function(){c.abrirPopup(c.idModalFacturaServicioExterno)},c.cerrarDialogFacturaServicioExterno=function(){c.cerrarPopup(c.idModalFacturaServicioExterno)},c.abrirDialogRepuestosOT=function(){c.venta={detallesVenta:[]},c.abrirPopup(c.idModaRepuestosOT)},c.cerrarDialogRepuestosOT=function(){c.cerrarPopup(c.idModaRepuestosOT)},c.interceptarTecla=function(a,e,o){13===a.which&&(o?c.enfocar(e):r(function(){$("#"+e).trigger("click")},0))},c.obtenerListaVehiculos=function(){if(i.start(),0!=c.paginator.filter.inicio&&null!=c.paginator.filter.inicio){var e=c.paginator.filter.inicio,o=c.paginator.filter.fin;c.paginator.filter.inicio=new Date(c.convertirFecha(c.paginator.filter.inicio)),c.paginator.filter.fin=new Date(c.convertirFecha(c.paginator.filter.fin))}else c.paginator.filter.inicio=0,c.paginator.filter.fin=0;var a=s(c.paginator);c.totalImporte=0,a.then(function(a){c.paginator.setPages(a.paginas),c.vehiculos=a.vehiculos,c.filtro={empresa:c.usuario.id_empresa,inicio:"",fin:"",tipo_activo:"",placa:"",marca:"",modelo:"",anio:"",tipo_mantenimiento:"",numero_ot:"",estado_ot:"",campamento:""},c.paginator.filter.inicio=e,c.paginator.filter.fin=o,i.stop()})},c.ObteneVehiculos=function(){c.paginator=u(),c.paginator.column="diagnostico",c.paginator.callBack=c.obtenerListaVehiculos,c.filtro={empresa:c.usuario.id_empresa,inicio:"",fin:"",tipo_activo:"",placa:"",marca:"",modelo:"",anio:"",tipo_mantenimiento:"",numero_ot:"",estado_ot:"",campamento:""},null!=c.filtro.inicio&&c.paginator.getSearch("",c.filtro)},c.obtenerColumnasAplicacion=function(){c.fieldViewer=m({crear:!0,id_empresa:c.usuario.id_empresa,configuracion:{cod_usuario:{value:"Cod-Usuario",show:!0},fecha:{value:"Fecha.",show:!0},anio:{value:"año",show:!0},imagen:{value:"Imagen",show:!0},ot:{value:"OT",show:!0},estado_OT:{value:"Estado-OT",show:!0},Tipo_de_activo:{value:"Tipo-de-activo",show:!0},km:{value:"Km",show:!0},usuario:{value:"Usuario",show:!0},marca:{value:"Marca",show:!0},modelo:{value:"Modelo",show:!0},mantenimiento:{value:"Manteniminto",show:!0},campamento:{value:"Campamento",show:!0}}},c.aplicacion.aplicacion.id),c.fieldViewer.updateObject()},c.establecervehiculo=function(a){c.nuevoOt.vehiculo=a},c.establecerEncargado=function(a){c.ordenTrabajoManoObra.encargado=a},c.buscarVehiculos=function(a){if(""!=a&&null!=a)return p(c.usuario.id_empresa,a)},c.buscarEncargado=function(a){if(""!=a&&null!=a)return v(c.usuario.id_empresa,a)},c.buscarProducto=function(a){if(""!=a&&null!=a)return h(c.usuario.id_empresa,a)},c.establecerProducto=function(i){i.tipoProducto=null==i.tipoProducto?{id:i["tipoProducto.id"],nombre:i["tipoProducto.nombre"],nombre_corto:i["tipoProducto.nombre_corto"]}:i.tipoProducto,c.editar_precio=!1,M(i.id,c.venta.almacen.id).then(function(a){i.inventarios=a;for(var e=0;e<i.inventarios.length;e++)i.inventarios[e].fecha_vencimiento=i.inventarios[e].fecha_vencimiento?new Date(i.inventarios[e].fecha_vencimiento):null,i.inventarios[e].fechaVencimientoTexto=i.inventarios[e].fecha_vencimiento?i.inventarios[e].fecha_vencimiento.getDate()+"/"+(i.inventarios[e].fecha_vencimiento.getMonth()+1)+"/"+i.inventarios[e].fecha_vencimiento.getFullYear():"",i.inventarios[e].detallesMovimiento[0].movimiento.fecha=new Date(i.inventarios[e].detallesMovimiento[0].movimiento.fecha),i.inventarios[e].detallesMovimiento[0].movimiento.fechaTexto=i.inventarios[e].detallesMovimiento[0].movimiento.fecha.getDate()+"/"+(i.inventarios[e].detallesMovimiento[0].movimiento.fecha.getMonth()+1)+"/"+i.inventarios[e].detallesMovimiento[0].movimiento.fecha.getFullYear();c.inventariosDisponibleProducto=[],c.inventariosDisponibleProducto.push({id:0,fecha_vencimiento:"TODOS",fechaVencimientoTexto:"TODOS"}),c.inventariosDisponibleProducto=c.inventariosDisponibleProducto.concat(i.inventarios);var o=c.obtenerInventarioTotal(i);c.detalleVenta={producto:i,precio_unitario:i.precio_unitario,inventarioProducto:c.inventariosDisponibleProducto[0],inventario_disponible:o,costos:i.activar_inventario?i.inventarios:[],cantidad:1,descuento:i.descuento,recargo:0,ice:0,excento:0,tipo_descuento:0<i.descuento,tipo_recargo:!1},c.colorearInventarioDisponible(o,i),c.calcularImporte(),c.cerrarPopup(c.idModalInventario),c.enfocar("cantidad")})},c.obtenerInventarioTotalPorFechaVencimiento=function(a){for(var e=a.inventarioProducto.cantidad,o=0;o<c.venta.detallesVenta.length;o++)c.venta.detallesVenta[o].producto.id==a.producto.id&&c.venta.detallesVenta[o].costos[0].id==a.inventarioProducto.id&&(e-=c.venta.detallesVenta[o].cantidad);return e},c.sumarTotal=function(){for(var a=0,e=0;e<c.venta.detallesVenta.length;e++)a+=c.venta.detallesVenta[e].total;c.venta.total=Math.round(1e3*a)/1e3},c.calcularSaldo=function(){c.venta.saldo=c.venta.total-c.venta.a_cuenta},c.calcularCambio=function(){c.esContado?(c.venta.cambio=Math.round(100*(c.venta.pagado-c.venta.total))/100,c.pagoMinimo=c.venta.total):(c.venta.cambio=0,c.pagoMinimo=0)},c.GuardarDetalleMateriales=function(a){c.editOt?a.forEach(function(a){c.vehiculo.materiales.push(a)},this):(c.nuevoOt.materiales=a,c.nuevoOt.totalMaterial=c.venta.total),c.cerrarDialogRepuestosOT()},c.eliminarDetalleVenta=function(a){c.venta.detallesVenta.splice(c.venta.detallesVenta.indexOf(a),1),c.sumarTotal(),c.sumarTotalImporte(),c.calcularSaldo(),c.calcularCambio()},c.sumarTotalImporte=function(){for(var a=0,e=0;e<c.venta.detallesVenta.length;e++)a+=c.venta.detallesVenta[e].importe;c.venta.importe=Math.round(1e3*a)/1e3},c.agregarDetalleVenta=function(a){if(a.producto.activar_inventario)if(1<a.costos.length)for(var e=a.cantidad,o=0,i=JSON.parse(JSON.stringify(a));o<a.costos.length&&0<e;){a.inventarioProducto=a.costos[o];var n=c.obtenerInventarioTotalPorFechaVencimiento(a);if(0<n){var r,t=JSON.parse(JSON.stringify(i));0<o&&(t.descuento=0,t.recargo=0,t.ice=0,t.excento=0),n<e?e-=r=n:(r=e,e=0),(c.detalleVenta=t).cantidad=r,t.fecha_vencimiento=a.costos[o].fecha_vencimiento,t.lote=a.costos[o].lote,t.costos=[],t.costos.push(a.costos[o]),t.inventario=a.costos[o],c.calcularImporte(),c.venta.detallesVenta.push(t)}o++}else a.fecha_vencimiento=a.costos[0].fecha_vencimiento,a.lote=a.costos[0].lote,a.inventario=a.costos[0],c.venta.detallesVenta.push(a);else c.venta.detallesVenta.push(a);c.inventariosDisponibleProducto=[],c.sumarTotal(),c.sumarTotalImporte(),c.calcularSaldo(),c.calcularCambio(),c.detalleVenta={producto:{activar_inventario:!0},cantidad:1,descuento:0,recargo:0,ice:0,excento:0,tipo_descuento:!1,tipo_recargo:!1},c.enfocar("id_producto")},c.calcularImporte=function(){var a,e;c.detalleVenta.importe=Math.round(c.detalleVenta.cantidad*c.detalleVenta.precio_unitario*1e3)/1e3,a=c.detalleVenta.tipo_descuento?c.detalleVenta.importe*(c.detalleVenta.descuento/100):c.detalleVenta.descuento,e=c.detalleVenta.tipo_recargo?c.detalleVenta.importe*(c.detalleVenta.recargo/100):c.detalleVenta.recargo,c.detalleVenta.total=Math.round(1e3*(c.detalleVenta.importe-a+e-c.detalleVenta.ice-c.detalleVenta.excento))/1e3},c.colorearInventarioDisponible=function(a,e){0==a?(c.porcentaje="100",c.color="red"):a>3*e.inventario_minimo+1?(c.porcentaje="100",c.color="green"):a>2*e.inventario_minimo+1?(c.porcentaje="75",c.color="green"):a>1.5*e.inventario_minimo+1?(c.porcentaje="50",c.color="green"):a==e.inventario_minimo+1?(c.porcentaje="38",c.color="yellow"):a==e.inventario_minimo?(c.porcentaje="25",c.color="red"):a<e.inventario_minimo&&0<a&&(c.porcentaje="12",c.color="red")},c.obtenerInventarioTotal=function(a){var e=0;if(a.activar_inventario){for(var o=0;o<a.inventarios.length;o++)e+=a.inventarios[o].cantidad;for(var i=0;i<c.venta.detallesVenta.length;i++)c.venta.detallesVenta[i].producto.id==a.id&&(e-=c.venta.detallesVenta[i].cantidad)}else e=5e5;return e},c.obtenerTiposMantenimiento=function(){i.start(),l("MTM").then(function(a){c.tiposMantenimiento=a.clases,i.stop()})},c.obtenerTiposSistemasOrdenTrabajo=function(){i.start(),l("SOT").then(function(a){c.tiposSistemas=a.clases,i.stop()})},c.obtenerTiposPrioridad=function(){i.start(),l("TPM").then(function(a){c.tiposPrioridad=a.clases,i.stop()})},c.obtenerTiposEspecialidad=function(){i.start(),l("TEM").then(function(a){c.tiposEspecialidad=a.clases,i.stop()})},c.obtenerSucursales=function(){for(var a=[],e=0;e<c.usuario.sucursalesUsuario.length;e++)a.push(c.usuario.sucursalesUsuario[e].sucursal);return a},c.obtenerAlmacenesActividades=function(a){c.obtenerAlmacenes(a),c.obtenerActividades(a)},c.obtenerAlmacenes=function(e){c.almacenes=[];var a=$.grep(c.sucursales,function(a){return a.id==e})[0];c.almacenes=a.almacenes,c.venta.almacen=1==c.almacenes.length?c.almacenes[0]:null,c.venta.almacen&&c.cargarProductos()},c.obtenerActividades=function(e){c.actividades=[];var a=$.grep(c.sucursales,function(a){return a.id==e})[0];c.actividadesDosificaciones=a.actividadesDosificaciones,c.actividades=[];for(var o=0;o<c.actividadesDosificaciones.length;o++)c.actividades.push(c.actividadesDosificaciones[o].actividad);c.venta.actividad=1==c.actividades.length?c.actividades[0]:null},c.cargarProductos=function(){f(c.usuario.id_empresa,c.venta.almacen.id).then(function(a){for(var e=0;e<a.length;e++)a[e].activar_inventario&&(a[e].inventario_disponible=c.obtenerInventarioTotal(a[e]));if(c.productos=a,angular.isDefined(n.productosProcesados)){c.productosProcesados=a;for(e=0;e<n.productosProcesados.length;e++)for(var o=0;o<c.productosProcesados.length;o++)n.productosProcesados[e].id==c.productosProcesados[o].id&&(c.productosProcesados[o].rankin=n.productosProcesados[e].rankin)}else c.productosProcesados=a;setTimeout(function(){aplicarSwiper(4,3,!0,2)},1e3)})},c.obtenerInventarioTotal=function(a){var e=0;if(a.activar_inventario){for(var o=0;o<a.inventarios.length;o++)e+=a.inventarios[o].cantidad;for(var i=0;i<c.venta.detallesVenta.length;i++)c.venta.detallesVenta[i].producto.id==a.id&&(e-=c.venta.detallesVenta[i].cantidad)}else e=5e5;return e},c.diferenciaEntreDiasEnDias=function(a,e){var o=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),i=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate());return Math.floor((i-o)/864e5)},c.agregarManoDeObra=function(a){a.horas=24*c.diferenciaEntreDiasEnDias(new Date(a.fecha_inicio),new Date(a.fecha_fin)),a.eliminado=!1,c.nuevoOt.ordenTrabajoManoObra.push(a),c.ordenTrabajoManoObra={edit:!1}},c.agregarManoDeObraVehiculo=function(a){a.horas=24*c.diferenciaEntreDiasEnDias(new Date(a.fecha_inicio),new Date(a.fecha_fin)),a.eliminado=!1,c.vehiculo.manosDeObra.push(a),c.ordenTrabajoManoObra={edit:!1}},c.agregarServicioExterno=function(a){a.eliminado=!1,c.nuevoOt.servicioExterno.push(a),c.servicioExterno={}},c.agregarServicioExternoVehiculo=function(a){a.eliminado=!1,c.vehiculo.serviciosExternos.push(a),c.servicioExterno={}},c.eliminarProductoVehiculo=function(a){c.vehiculo.materiales.splice(c.vehiculo.materiales.indexOf(a),1)},c.eliminarManoDeObra=function(a){c.nuevoOt.ordenTrabajoManoObra.splice(c.nuevoOt.ordenTrabajoManoObra.indexOf(a),1)},c.eliminarManoDeObraVehiculo=function(a){c.vehiculo.manosDeObra.splice(c.vehiculo.manosDeObra.indexOf(a),1)},c.eliminarServicioExterno=function(a){c.nuevoOt.servicioExterno.splice(c.nuevoOt.ordenTrabajoManoObra.indexOf(a),1)},c.eliminarServicioExternoVehiculo=function(a){c.vehiculo.serviciosExternos.splice(c.vehiculo.serviciosExternos.indexOf(a),1)},c.saveFormNuevoOt=function(){var a=$("#siguiente").text().trim();console.log(c.paciente),"Siguiente"!=a&&(promesa=b(c.nuevoOt),promesa.then(function(a){c.cerrarOTnuevo(),c.mostrarMensaje(a.message),c.recargarItemsTabla()}))},c.GuardarOtActializado=function(){promesa=g(c.vehiculo),promesa.then(function(a){c.cerrarOTEdicionCorrectivo(),c.mostrarMensaje(a.message),c.recargarItemsTabla()})},c.editarManoObra=function(a,e){c.ordenTrabajoManoObra=a,c.ordenTrabajoManoObra.especialidad=a.especialidad,c.ordenTrabajoManoObra.fecha_inicio=moment(a.fecha_inicio).format("MM/DD/YYYY h:mm A"),c.ordenTrabajoManoObra.fecha_fin=moment(a.fecha_fin).format("MM/DD/YYYY h:mm A"),c.ordenTrabajoManoObra.edit=!0,c.ordenTrabajoManoObra.index=e,console.log(c.ordenTrabajoManoObra)},c.guardarManoObraEditada=function(a){c.nuevoOt.ordenTrabajoManoObra[a.index]=a,c.ordenTrabajoManoObra={edit:!1}},c.guardarManoObraEditadaVehiculo=function(a){c.vehiculo.manosDeObra[a.index]=a,c.vehiculo.manosDeObra[a.index].horas=24*c.diferenciaEntreDiasEnDias(new Date(c.vehiculo.manosDeObra[a.index].fecha_inicio),new Date(c.vehiculo.manosDeObra[a.index].fecha_fin)),c.ordenTrabajoManoObra={edit:!1}},c.editarServicioExterno=function(a,e){c.servicioExterno=a,c.servicioExterno.fecha_inicio=moment(c.servicioExterno.fecha_inicio).format("MM/DD/YYYY h:mm A"),c.servicioExterno.fecha_fin=moment(c.servicioExterno.fecha_fin).format("MM/DD/YYYY h:mm A"),c.servicioExterno.edit=!0,c.servicioExterno.index=e},c.guardarServicioExternoEditado=function(a){c.nuevoOt.servicioExterno[a.index]=a,c.servicioExterno={edit:!1}},c.obtenerFechasCalendario=function(){promesa=P(c.calendario),promesa.then(function(a){c.FechasCalendario=a,console.log(a)})},c.obtenerFechasCalendarioS=function(a){$("#calendar").fullCalendar("removeEvents"),promesa=P(a),promesa.then(function(a){c.FechasCalendario=a,console.log(a);var n=[];a.forEach(function(a,e,o){var i={id:a.id,title:a.observacion,start:a.fecha_hora_inicio,end:a.fecha_hora_fin};n.push(i),e===o.length-1&&c.cal(n)},this)})},c.EditEventoCalendario=function(){console.log(c.evento),c.calendar.fullCalendar("updateEvent",c.evento),c.cerrarEditarEventoCalendario()},c.DeleteEventoCalendario=function(){c.calendar.fullCalendar("removeEvents",function(a){return a._id==c.evento._id}),c.cerrarEditarEventoCalendario()},c.cal=function(a){c.calendar.fullCalendar("addEventSource",a)},c.GuardarEventoCalendario=function(a){a&&(c.calendar.fullCalendar("renderEvent",c.evento,!0),c.evento={title:null,start:null,end:null,allDay:null,className:"label-info"},c.cerrarEventoCalendario())},c.aplicarCalendario=function(){var a=new Date;a.getDate(),a.getMonth(),a.getFullYear();c.calendar=$("#calendar").fullCalendar({buttonHtml:{prev:'<i class="ace-icon fa fa-chevron-left"></i>',next:'<i class="ace-icon fa fa-chevron-right"></i>'},header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},events:[],editable:!0,droppable:!0,drop:function(a){var e=$(this).data("eventObject"),o=$(this).attr("data-class"),i=$.extend({},e);i.start=a,i.allDay=!1,o&&(i.className=[o]),c.calendar.fullCalendar("renderEvent",i,!0),$("#drop-remove").is(":checked")&&$(this).remove()},selectable:!0,selectHelper:!0,select:function(a,e,o){c.evento={title:"",start:a,end:e,allDay:o,className:"label-info"},c.abrirEventoCalendario(),c.calendar.fullCalendar("unselect")},eventClick:function(a,e,o){c.evento=a,c.abrirEditarEventoCalendario()}})},c.inicio()}]);