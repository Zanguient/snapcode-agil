angular.module("agil.controladores").controller("ControladorContabilidadCuenta",["$scope","blockUI","$localStorage","$location","$templateCache","$window","CuentasPaginador","ContabilidadCuenta","CuentasClasificaciones","ClasesTipo","lasClasificaciones","losSaldos","losMovimientos","losTiposDeCuentas","lasOperacionesCalculos","CuentaContabilidad","Paginator","CuentasEmpresaCreacion","ClientesNit","ProveedoresNit","$timeout","Tipos","ConfiguracionCuentaEmpresa","ListaContabilidadCuentas","ListaCuentasComprobanteContabilidad","ConfiguracionCuentas","CuentasClasificacionesEdicion","Diccionario","VistaColumnasAplicacion","FieldViewer","ValidarCodigoCuenta","ClaseTexto","ClasesTipoEmpresa",function(l,c,a,e,i,n,o,r,t,s,u,d,p,C,f,g,m,v,b,P,E,I,B,_,T,M,h,z,G,j,N,A,S){l.usuario=JSON.parse(a.usuario),l.idModalWizardCuentaEdicion="modal-wizard-cuenta-edicion",l.idModalWizardContainerCuentaEdicion="modal-wizard-container-cuenta-edicion",l.idModalWizardCuentaVer="modal-wizard-cuenta-ver",l.idModalWizardContainerCuentaVer="modal-wizard-container-cuenta-ver",l.idModalWizardClasificacionNueva="modal-wizard-agregar-clasificacion-cuenta",l.idModalWizardClasificacionVer="modal-wizard-ver-clasificacion",l.idModalWizardContainerClasificacionNueva="modal-wizard-container-agregar-clasificacion",l.idModalEliminarCuenta="dialog-eliminar-cuenta",l.idModalWizardPlantillaIngreso="modal-wizard-plantilla-ingreso",l.idModalWizardConceptoEdicion="modal-wizard-concepto-edicion",l.idModalWizardClasificacionEdicion="modal-wizard-clasificacion-edicion",l.$on("$viewContentLoaded",function(){resaltarPestaña(e.path().substring(1)),ejecutarScriptsContabilidadCuentas(l.idModalWizardCuentaEdicion,l.idModalWizardContainerCuentaEdicion,l.idModalWizardClasificacionNueva,l.idModalWizardContainerClasificacionNueva,l.idModalWizardClasificacionVer,l.idModalWizardCuentaVer,l.idModalWizardContainerCuentaVer,l.idModalEliminarCuenta,l.idModalWizardPlantillaIngreso,l.idModalWizardConceptoEdicion,l.idModalWizardClasificacionEdicion),l.buscarAplicacion(l.usuario.aplicacionesUsuario,e.path().substring(1)),l.obtenerColumnasAplicacion(),c.stop()}),l.inicio=function(){l.obtenerCuentas(),l.obtenerTiposCuenta(),l.obtenerTiposCuentasAuxilires(),l.obtenerClasificacionCuenta(),l.obtenerClasificacionSaldos(),l.obtenerClasificacionTipos(),l.obtenerClasificacionMovimientos(),l.obtenerOperacionesCalculo(),l.obtenerTotalesGeneral(),l.sucursalesUsuario="";for(var a=0;a<l.usuario.sucursalesUsuario.length;a++)l.sucursalesUsuario=l.sucursalesUsuario+l.usuario.sucursalesUsuario[a].sucursal.id,a+1!=l.usuario.sucursalesUsuario.length&&(l.sucursalesUsuario=l.sucursalesUsuario+",")},l.agregarTipoCuenta=function(){c.start(),S("TCC",l.usuario.id_empresa).then(function(a){l.tipo=a,c.stop()}),l.abrirPopup(l.idModalWizardConceptoEdicion)},l.obtenerColumnasAplicacion=function(){l.fieldViewer=j({crear:!0,id_empresa:l.usuario.id_empresa,configuracion:{codigo:{value:"Codigo",show:!0},nombre:{value:"Nombre",show:!0},debe:{value:"Debe",show:!0},haber:{value:"Haber",show:!0},saldo:{value:"Saldo",show:!0},clasificacion:{value:"Clasificacion",show:!0},tipo_cuenta:{value:"Tipo Cuenta",show:!0}}},l.aplicacion.aplicacion.id),l.fieldViewer.updateObject()},l.adicionarTipoCuenta=function(a){a.nombre&&a.nombre_corto&&(a.id||l.tipo.clases.push(a),l.clase={})},l.adicionarClasificacionCuenta=function(a){a.nombre&&a.saldo.id&&a.movimiento.id&&(a.id||l.cuentaClasificaciones.push(a),l.clasificacionEdicion={})},l.modificarClasificacionEdicionCuenta=function(a){l.clasificacionEdicion=a},l.guardarTipoCuenta=function(a,e){a&&(c.start(),I.update({id_tipo:e.id},e,function(a){c.stop(),l.cerrarPopPupTipoCuenta(),l.mostrarMensaje("Guardado Exitosamente!"),l.obtenerTiposCuenta()}))},l.guardarClasificacionCuenta=function(a,e){a&&(c.start(),h.update({id_empresa:l.usuario.id_empresa},e,function(a){c.stop(),l.cerrarPopPupCalsificacionEdicionCuenta(),l.mostrarMensaje("Guardado Exitosamente!"),l.obtenerClasificacionCuenta()}))},l.modificarTipoCuenta=function(a){l.clase=a},l.removerTipoCuenta=function(a){a.eliminado=!0},l.removerClasificacionCuenta=function(a){a.eliminado=!0},l.cerrarPopPupTipoCuenta=function(){l.cerrarPopup(l.idModalWizardConceptoEdicion)},l.cerrarPopPupCalsificacionEdicionCuenta=function(){l.cerrarPopup(l.idModalWizardClasificacionEdicion)},l.guardarPlantillaIngreso=function(a,e){l.visible.verPlantillaIngreso=!0,l.visible.verPlantillaEgreso=!0,l.visible.verPlantillarRetencionBien=!0,l.visible.verPlantillarRetencionBienGasto=!0,e.ingreso.ivadf.cuenta&&e.ingreso.ivadf.cuenta.id?(l.verPlantillaIngreso=!1,l.errorIvadf=null):(l.visible.verPlantillaIngreso=!0,l.errorIvadf="sdf"),a.asignarCuentaIvaDf&&(a.asignarCuentaIvaDf.$error.cuenta=!1),e.ingreso.it.cuenta&&e.ingreso.it.cuenta.id?(l.verPlantillaIngreso=!1,l.errorIT=null):(l.visible.verPlantillaIngreso=!0,l.errorIT="sdf"),a.asignarCuentaIt&&(a.asignarCuentaIt.$error.cuenta=!1),e.ingreso.itPorPagar.cuenta&&e.ingreso.itPorPagar.cuenta.id?(l.verPlantillaIngreso=!1,l.errorItPorPagar=null):(l.visible.verPlantillaIngreso=!0,l.errorItPorPagar="sdf"),a.asignarCuentaItPorPagar&&(a.asignarCuentaItPorPagar.$error.cuenta=!1),e.ingreso.cajaBanco.cuenta&&e.ingreso.cajaBanco.cuenta.id?(l.verPlantillaIngreso=!1,l.errorIngresoCaja=null):(l.visible.verPlantillaIngreso=!0,l.errorIngresoCaja="sdf"),a.asignarCuentaIngresoCaja&&(a.asignarCuentaIngresoCaja.$error.cuenta=!1),e.egreso.ivacf.cuenta&&e.egreso.ivacf.cuenta.id?(l.verPlantillaEgreso=!1,l.errorIvacf=null):(l.visible.verPlantillaEgreso=!0,l.errorIvacf="sdf"),a.asignarCuentaIvaCf&&(a.asignarCuentaIvaCf.$error.cuenta=!1),e.egreso.cajaBanco.cuenta&&e.egreso.cajaBanco.cuenta.id?(l.verPlantillaEgreso=!1,l.errorEgresoCaja=null):(l.visible.verPlantillaEgreso=!0,l.errorEgresoCaja="sdf"),a.asignarCuentaEgresoCaja&&(a.asignarCuentaEgresoCaja.$error.cuenta=!1),l.usuario.empresa.usar_funciones_erp?(e.retencionBienes.almacen.cuenta&&e.retencionBienes.almacen.cuenta.id?(l.verPlantillarRetencionBien=!1,l.errorEgresoBienAlmacen=null):(l.visible.verPlantillarRetencionBien=!0,l.errorEgresoBienAlmacen="sdf"),a.asignarAlmacenBienes&&(a.asignarAlmacenBienes.$error.cuenta=!1),e.retencionBienes.it.cuenta&&e.retencionBienes.it.cuenta.id?(l.verPlantillarRetencionBien=!1,l.errorEgresoBienIt=null):(l.visible.verPlantillarRetencionBien=!0,l.errorEgresoBienIt="sdf"),a.asignarItBienes&&(a.asignarItBienes.$error.cuenta=!1),e.retencionBienes.iue.cuenta&&e.retencionBienes.iue.cuenta.id?(l.verPlantillarRetencionBien=!1,l.errorEgresoBienIue=null):(l.visible.verPlantillarRetencionBien=!0,l.errorEgresoBienIue="sdf"),a.asignarIueBienes&&(a.asignarIueBienes.$error.cuenta=!1),e.retencionBienesGasto.gasto.cuenta&&e.retencionBienesGasto.gasto.cuenta.id?(l.verPlantillarRetencionBienGasto=!1,l.errorEgresoBienGasto=null):(l.visible.verPlantillarRetencionBienGasto=!0,l.errorEgresoBienGasto="sdf"),a.asignarGastoBienes&&(a.asignarGastoBienes.$error.cuenta=!1),e.retencionBienesGasto.it.cuenta&&e.retencionBienesGasto.it.cuenta.id?(l.verPlantillarRetencionBienGasto=!1,l.errorEgresoBienGastoIt=null):(l.visible.verPlantillarRetencionBienGasto=!0,l.errorEgresoBienGastoIt="sdf"),a.asignarGastoItBienes&&(a.asignarGastoItBienes.$error.cuenta=!1),e.retencionBienesGasto.iue.cuenta&&e.retencionBienesGasto.iue.cuenta.id?(l.verPlantillarRetencionBienGasto=!1,l.errorEgresoBienGastoIue=null):(l.visible.verPlantillarRetencionBienGasto=!0,l.errorEgresoBienGastoIue="sdf"),a.asignarGastoIueBienes&&(a.asignarGastoIueBienes.$error.cuenta=!1)):(l.errorEgresoBienAlmacen=null,l.errorEgresoBienIt=null,l.errorEgresoBienIue=null,l.errorEgresoBienGasto=null,l.errorEgresoBienGastoIt=null,l.errorEgresoBienGastoIue=null),null==l.errorEgresoBienGasto&&null==l.errorEgresoBienGastoIt&&null==l.errorEgresoBienGastoIue&&null==l.errorEgresoBienIue&&null==l.errorEgresoBienIt&&null==l.errorEgresoBienAlmacen&&null==l.errorIvacf&&null==l.errorEgresoCaja&&null==l.errorIvadf&&null==l.errorIT&&null==l.errorItPorPagar&&(e.usar_funciones_erp=l.usuario.empresa.usar_funciones_erp,M.update({id_empresa:l.usuario.id_empresa},e,function(a){l.mostrarMensaje(a.menssage),l.cerrarPlantillaIngreso()}))},l.BoscarOcrearPlantillaIngreso=function(){l.plantilla={retencionServicios:{it:{},iue:{},servicio:{}},retencionBienesGasto:{it:{},iue:{},gasto:{}},retencionBienes:{it:{},iue:{},almacen:{}},egreso:{ivacf:{},cajaBanco:{}},ingreso:{ivadf:{},it:{},itPorPagar:{},cajaBanco:{}}},B(l.usuario.id_empresa).then(function(a){console.log(a.lista),a.lista.forEach(function(a){z.IVA_DF==a.nombre&&(l.plantilla.ingreso.ivadf={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IT==a.nombre&&(l.plantilla.ingreso.it={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IT_POR_PAGAR==a.nombre&&(l.plantilla.ingreso.itPorPagar={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.CAJA_BANCOS==a.nombre&&(l.plantilla.ingreso.cajaBanco={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IVA_CF==a.nombre&&(l.plantilla.egreso.ivacf={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.CAJA_BANCOS==a.nombre&&(l.plantilla.egreso.cajaBanco={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IT_RETENCION_BIEN==a.nombre&&(l.plantilla.retencionBienes.it={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IUE_RETENCION_BIEN==a.nombre&&(l.plantilla.retencionBienes.iue={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.CUENTA_ALMACEN_RETENCION_BIEN==a.nombre&&(l.plantilla.retencionBienes.almacen={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IT_RETENCION_BIEN_GASTO==a.nombre&&(l.plantilla.retencionBienesGasto.it={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IUE_RETENCION_BIEN_GASTO==a.nombre&&(l.plantilla.retencionBienesGasto.iue={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.CUENTA_GASTO_RETENCION_BIEN==a.nombre&&(l.plantilla.retencionBienesGasto.gasto={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IT_RETENCION_SERVICIO==a.nombre&&(l.plantilla.retencionServicios.it={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IUE_RETENCION_SERVICIO==a.nombre&&(l.plantilla.retencionServicios.iue={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.CUENTA_RETENCION_SERVICIO==a.nombre&&(l.plantilla.retencionServicios.servicio={porsentaje:parseFloat(a.valor),cuenta:a.cuenta})},this),c.stop()})},l.buscarCuentas=function(a){if(""!=a&&null!=a){var e=T(l.usuario.id_empresa,a);return console.log(e),e}},l.obtenerConfigCuentas=function(){_(l.usuario.id_empresa).then(function(a){l.ListaCuentas=a,console.log(l.ListaCuentas),c.stop()})},l.updateFiltro=function(a){l.filtro=a},l.abrirPlantillaIngreso=function(){l.visible={},l.visible.verPlantillaIngreso=!0,l.visible.verPlantillaEgreso=!0,l.visible.verPlantillarRetencionBien=!0,l.visible.verPlantillarRetencionBienGasto=!0,l.visible.verPlantillarRetencionServicio=!0,l.BoscarOcrearPlantillaIngreso(),l.obtenerConfigCuentas(),l.abrirPopup(l.idModalWizardPlantillaIngreso)},l.cerrarPlantillaIngreso=function(){l.cerrarPopup(l.idModalWizardPlantillaIngreso)},l.agregarClasificacionCuenta=function(){l.clasificacion=new t({saldo:{},movimiento:{}}),l.abrirPopup(l.idModalWizardClasificacionNueva)},l.modificarClasificacionCuenta=function(a){l.clasificacion=a,l.abrirPopup(l.idModalWizardClasificacionNueva)},l.guardarClasificacion=function(a,e){a&&(l.ocultarMensajesValidacion(),c.start(),e.id?t.update({id:e.id},e,function(a){c.stop(),l.cerrarPopPupAgregarClasificacion(),l.obtenerClasificacionCuenta(),l.mostrarMensaje("Actualizado exitosamente!")}):(e.id_empresa=l.usuario.id_empresa,e.$save(function(a){c.stop(),l.mostrarMensaje("Clasificacion registrada exitosamente!",a),l.cerrarPopPupAgregarClasificacion(),l.obtenerClasificacionCuenta()},function(a){c.stop(),l.mostrarMensaje("Ocurrio un problema al momento de guardar!"),l.obtenerClasificacionCuenta()})))},l.mostrarConfirmacionEliminacion=function(a){l.cuenta=new r({id_empresa:l.usuario.id_empresa,id_usuario:l.usuario.id,tipoCuenta:{},clasificacion:{},eliminado:!1,bimonetaria:!1,aplicar_calculo:!1}),l.cuenta=a,l.abrirPopup(l.idModalEliminarCuenta)},l.cerrarPopPupConfirmacionEliminacion=function(){l.cerrarPopup(l.idModalEliminarCuenta)},l.eliminarCuenta=function(a){a.eliminado=!0,l.cuenta=a,l.cuenta.eliminado=!0,r.update({id:a.id,eliminado:!0},a,function(a){c.stop(),l.cerrarPopPupConfirmacionEliminacion(),l.recargarItemsTabla(),l.mostrarMensaje("Borrado exitosamente!")},function(a){c.stop(),l.mostrarMensaje("Ocurrio un problema al momento de guardar!"),l.recargarItemsTabla()})},l.crearNuevaCuenta=function(){l.cuenta=new r({id_empresa:l.usuario.id_empresa,id_usuario:l.usuario.id,tipoCuenta:{},clasificacion:{},eliminado:!1,bimonetaria:!1,especifica_texto1:"",especifica_texto2:"",especifica_texto3:""});var a=new Date;l.cuenta.fechaTexto=a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear(),l.abrirPopup(l.idModalWizardCuentaEdicion)},l.optenerCfDf=function(a,e){e?a?(A("CF_TEXTO_1").then(function(a){l.cuenta.especifica_texto1=a.clase}),A("CF_TEXTO_2").then(function(a){l.cuenta.especifica_texto2=a.clase}),A("CF_TEXTO_3").then(function(a){l.cuenta.especifica_texto3=a.clase})):(A("DF_TEXTO_1").then(function(a){l.cuenta.especifica_texto1=a.clase}),A("DF_TEXTO_2").then(function(a){l.cuenta.especifica_texto2=a.clase}),A("DF_TEXTO_3").then(function(a){l.cuenta.especifica_texto3=a.clase})):(l.cuenta.tipo_especifica=!1,l.cuenta.especifica_texto1="",l.cuenta.especifica_texto2="",l.cuenta.especifica_texto3="")},l.modificarCuenta=function(a){(l.cuenta=a).especifica&&l.optenerCfDf(a.tipo_especifica,a.especifica),l.abrirPopup(l.idModalWizardCuentaEdicion)},l.modificarClasificacionesCuenta=function(){l.abrirPopup(l.idModalWizardClasificacionEdicion)},l.verCuenta=function(a){l.cuenta=a,l.abrirPopup(l.idModalWizardCuentaVer)},l.validarCodigoCuenta=function(a){""!=a&&E(function(){l.validar=new N,l.validar.codigo=a,l.validar.$save(function(a){l.data=a})},1500)},l.guardarCuenta=function(a,e){a&&("Siguiente"!=$("#siguiente").text().trim()&&(l.ocultarMensajesValidacion(),c.start(),e.id?r.update({id:e.id},e,function(a){c.stop(),l.cerrarPopPupEdicion(),l.recargarItemsTabla(),l.mostrarMensaje("Actualizado exitosamente!")}):e.$save(function(a){c.stop(),l.mostrarMensaje("Cuenta registrada exitosamente!",a),l.cerrarPopPupEdicion(),l.recargarItemsTabla()},function(a){c.stop(),l.mostrarMensaje("Ocurrio un problema al momento de guardar!"),l.recargarItemsTabla()})))},l.obtenerCuentas=function(){l.paginator=m(),l.paginator.column="codigo",l.paginator.callBack=l.obtenerLista,l.filtro={empresa:l.usuario.id_empresa,clasificacion:"",tipo_cuenta:"",monto:""},l.paginator.getSearch("",l.filtro,null)},l.cerrarPopPupCuentaVer=function(){l.cerrarPopup(l.idModalWizardCuentaVer)},l.cerrarPopPupEdicion=function(){l.obtenerCuentas(),l.cerrarPopup(l.idModalWizardCuentaEdicion)},l.cerrarPopPupVerClasificacion=function(){l.cerrarPopup(l.idModalWizardClasificacionVer)},l.cerrarPopPupAgregarClasificacion=function(){l.cerrarPopup(l.idModalWizardClasificacionNueva)},l.obtenerClasificacionCuenta=function(){c.start(),u(l.usuario.id_empresa).then(function(a){l.cuentaClasificaciones=a.clasificaciones,c.stop()})},l.obtenerClasificacionSaldos=function(){c.start(),s("CONTCLSSAL").then(function(a){l.cuentaSaldos=a.clases,c.stop()})},l.obtenerClasificacionTipos=function(){c.start(),s("TIPOS_CLAS_CUENTA").then(function(a){l.tiposClasificaciones=a.clases,c.stop()})},l.obtenerClasificacionMovimientos=function(){c.start(),s("CONTCLSMOV").then(function(a){l.cuentaMovimientos=a.clases,c.stop()})},l.obtenerTiposCuenta=function(){c.start(),S("TCC",l.usuario.id_empresa).then(function(a){l.cuentaTipos=[{id:0,nombre:"TODOS"}],l.cuentaTipos=l.cuentaTipos.concat(a.clases),c.stop()})},l.obtenerTiposCuentasAuxilires=function(){c.start(),s("AUXCU").then(function(a){console.log(a),l.tiposCuentasAuxiliares=a.clases,c.stop()})},l.obtenerOperacionesCalculo=function(){c.start(),s("OPE").then(function(a){l.operacionesCalculo=a.clases,c.stop()})},l.obtenerLista=function(){c.start(),l.sumaTotales={debe:0,haber:0,saldo:0},g(l.paginator).then(function(a){l.paginator.setPages(a.paginas),a.cuentas.forEach(function(a,e,i){l.sumaTotales.debe+=a.debe,l.sumaTotales.haber+=a.haber,l.sumaTotales.saldo+=a.saldo}),c.stop(),l.Cuentas=a.cuentas})},l.obtenerTotalesGeneral=function(){l.sumaTotalesGenerales={debe:0,haber:0,saldo:0};var a={filter:{empresa:l.usuario.id_empresa,clasificacion:0,tipo_cuenta:0,monto:0},currentPage:1,itemsPerPage:0,search:0,column:"codigo",direction:"asc"};g(a).then(function(a){a.cuentas.forEach(function(a,e,i){l.sumaTotalesGenerales.debe+=a.debe,l.sumaTotalesGenerales.haber+=a.haber,l.sumaTotalesGenerales.saldo+=a.saldo,c.stop()})})},l.subirExcelCuentas=function(a){var e,i,n=a.target.files;for(i=n[e=0];e!=n.length;++e){var o=new FileReader;i.name;o.onload=function(a){c.start();var e=a.target.result,i=XLSX.read(e,{type:"binary"}),n=i.SheetNames[0],o=2,r=i.Sheets[n],t=[];do{var s={clasificacion:{},tipoCuenta:{}};s.codigo=null!=r["A"+o]&&""!=r["A"+o]?r["A"+o].v.toString():null,s.nombre=null!=r["B"+o]&&""!=r["B"+o]?r["B"+o].v.toString():null,s.descripcion=null!=r["C"+o]&&""!=r["C"+o]?r["C"+o].v.toString():null,s.clasificacion.nombre=null!=r["D"+o]&&""!=r["D"+o]?r["D"+o].v.toString():null,s.tipoCuenta.nombre=null!=r["E"+o]&&""!=r["E"+o]?r["E"+o].v.toString():null,s.debe=null!=r["F"+o]&&""!=r["F"+o]?parseFloat(r["F"+o].v.toString()):null,s.haber=null!=r["G"+o]&&""!=r["G"+o]?parseFloat(r["G"+o].v.toString()):null,s.saldo=null!=r["H"+o]&&""!=r["H"+o]?parseFloat(r["H"+o].v.toString()):null,s.bimonetaria=null!=r["I"+o]&&""!=r["I"+o]?r["I"+o].v.toString():null,"SI"!=s.bimonetaria?s.bimonetaria=0:s.bimonetaria=1,t.push(s),o++,0}while(null!=r["A"+o]);l.guardarCuentas(t),console.log(t),c.stop()},o.readAsBinaryString(i)}},l.guardarCuentas=function(a){new v({cuentas:a,id_empresa:l.usuario.id_empresa}).$save(function(a){c.stop(),l.mostrarMensaje("Guardado Exitosamente!"),l.recargarItemsTabla()},function(a){c.stop(),l.mostrarMensaje("Ocurrio un problema al momento de guardar!"),l.recargarItemsTabla()})},l.establecerCliente=function(a){l.cuenta.cliente=a},l.interceptarTecla=function(a,e,i){13===a.which&&(i?l.enfocar(e):E(function(){$("#"+e).trigger("click")},0))},l.buscarCliente=function(a){if(""!=a&&null!=a)return b(l.usuario.id_empresa,a)},l.establecerProveedor=function(a){l.cuenta.proveedor=a},l.buscarProveedor=function(a){if(""!=a&&null!=a)return P(l.usuario.id_empresa,a)},l.$on("$routeChangeStart",function(a,e){l.eliminarPopup(l.idModalWizardCuentaEdicion),l.eliminarPopup(l.idModalWizardClasificacionNueva),l.eliminarPopup(l.idModalWizardCuentaVer),l.eliminarPopup(l.idModalEliminarCuenta),l.eliminarPopup(l.idModalWizardPlantillaIngreso),l.eliminarPopup(l.idModalWizardClasificacionEdicion),l.eliminarPopup(l.idModalWizardConceptoEdicion)}),l.inicio()}]),angular.module("agil.controladores").controller("ControladorContabilidadCuenta",["$scope","blockUI","$localStorage","$location","$templateCache","$window","CuentasPaginador","ContabilidadCuenta","CuentasClasificaciones","ClasesTipo","lasClasificaciones","losSaldos","losMovimientos","losTiposDeCuentas","lasOperacionesCalculos","CuentaContabilidad","Paginator","CuentasEmpresaCreacion","ClientesNit","ProveedoresNit","$timeout","Tipos","ConfiguracionCuentaEmpresa","ListaContabilidadCuentas","ListaCuentasComprobanteContabilidad","ConfiguracionCuentas","CuentasClasificacionesEdicion","Diccionario","VistaColumnasAplicacion","FieldViewer","ValidarCodigoCuenta","ClaseTexto","ClasesTipoEmpresa",function(l,c,a,e,i,n,o,r,t,s,u,d,p,C,f,g,m,v,b,P,E,I,B,_,T,M,h,z,G,j,N,A,S){l.usuario=JSON.parse(a.usuario),l.idModalWizardCuentaEdicion="modal-wizard-cuenta-edicion",l.idModalWizardContainerCuentaEdicion="modal-wizard-container-cuenta-edicion",l.idModalWizardCuentaVer="modal-wizard-cuenta-ver",l.idModalWizardContainerCuentaVer="modal-wizard-container-cuenta-ver",l.idModalWizardClasificacionNueva="modal-wizard-agregar-clasificacion-cuenta",l.idModalWizardClasificacionVer="modal-wizard-ver-clasificacion",l.idModalWizardContainerClasificacionNueva="modal-wizard-container-agregar-clasificacion",l.idModalEliminarCuenta="dialog-eliminar-cuenta",l.idModalWizardPlantillaIngreso="modal-wizard-plantilla-ingreso",l.idModalWizardConceptoEdicion="modal-wizard-concepto-edicion",l.idModalWizardClasificacionEdicion="modal-wizard-clasificacion-edicion",l.$on("$viewContentLoaded",function(){resaltarPestaña(e.path().substring(1)),ejecutarScriptsContabilidadCuentas(l.idModalWizardCuentaEdicion,l.idModalWizardContainerCuentaEdicion,l.idModalWizardClasificacionNueva,l.idModalWizardContainerClasificacionNueva,l.idModalWizardClasificacionVer,l.idModalWizardCuentaVer,l.idModalWizardContainerCuentaVer,l.idModalEliminarCuenta,l.idModalWizardPlantillaIngreso,l.idModalWizardConceptoEdicion,l.idModalWizardClasificacionEdicion),l.buscarAplicacion(l.usuario.aplicacionesUsuario,e.path().substring(1)),l.obtenerColumnasAplicacion(),c.stop()}),l.inicio=function(){l.obtenerCuentas(),l.obtenerTiposCuenta(),l.obtenerTiposCuentasAuxilires(),l.obtenerClasificacionCuenta(),l.obtenerClasificacionSaldos(),l.obtenerClasificacionTipos(),l.obtenerClasificacionMovimientos(),l.obtenerOperacionesCalculo(),l.obtenerTotalesGeneral(),l.sucursalesUsuario="";for(var a=0;a<l.usuario.sucursalesUsuario.length;a++)l.sucursalesUsuario=l.sucursalesUsuario+l.usuario.sucursalesUsuario[a].sucursal.id,a+1!=l.usuario.sucursalesUsuario.length&&(l.sucursalesUsuario=l.sucursalesUsuario+",")},l.agregarTipoCuenta=function(){c.start(),S("TCC",l.usuario.id_empresa).then(function(a){l.tipo=a,c.stop()}),l.abrirPopup(l.idModalWizardConceptoEdicion)},l.obtenerColumnasAplicacion=function(){l.fieldViewer=j({crear:!0,id_empresa:l.usuario.id_empresa,configuracion:{codigo:{value:"Codigo",show:!0},nombre:{value:"Nombre",show:!0},debe:{value:"Debe",show:!0},haber:{value:"Haber",show:!0},saldo:{value:"Saldo",show:!0},clasificacion:{value:"Clasificacion",show:!0},tipo_cuenta:{value:"Tipo Cuenta",show:!0}}},l.aplicacion.aplicacion.id),l.fieldViewer.updateObject()},l.adicionarTipoCuenta=function(a){a.nombre&&a.nombre_corto&&(a.id||l.tipo.clases.push(a),l.clase={})},l.adicionarClasificacionCuenta=function(a){a.nombre&&a.saldo.id&&a.movimiento.id&&(a.id||l.cuentaClasificaciones.push(a),l.clasificacionEdicion={})},l.modificarClasificacionEdicionCuenta=function(a){l.clasificacionEdicion=a},l.guardarTipoCuenta=function(a,e){a&&(c.start(),I.update({id_tipo:e.id},e,function(a){c.stop(),l.cerrarPopPupTipoCuenta(),l.mostrarMensaje("Guardado Exitosamente!"),l.obtenerTiposCuenta()}))},l.guardarClasificacionCuenta=function(a,e){a&&(c.start(),h.update({id_empresa:l.usuario.id_empresa},e,function(a){c.stop(),l.cerrarPopPupCalsificacionEdicionCuenta(),l.mostrarMensaje("Guardado Exitosamente!"),l.obtenerClasificacionCuenta()}))},l.modificarTipoCuenta=function(a){l.clase=a},l.removerTipoCuenta=function(a){a.eliminado=!0},l.removerClasificacionCuenta=function(a){a.eliminado=!0},l.cerrarPopPupTipoCuenta=function(){l.cerrarPopup(l.idModalWizardConceptoEdicion)},l.cerrarPopPupCalsificacionEdicionCuenta=function(){l.cerrarPopup(l.idModalWizardClasificacionEdicion)},l.guardarPlantillaIngreso=function(a,e){l.visible.verPlantillaIngreso=!0,l.visible.verPlantillaEgreso=!0,l.visible.verPlantillarRetencionBien=!0,l.visible.verPlantillarRetencionBienGasto=!0,e.ingreso.ivadf.cuenta&&e.ingreso.ivadf.cuenta.id?(l.verPlantillaIngreso=!1,l.errorIvadf=null):(l.visible.verPlantillaIngreso=!0,l.errorIvadf="sdf"),a.asignarCuentaIvaDf&&(a.asignarCuentaIvaDf.$error.cuenta=!1),e.ingreso.it.cuenta&&e.ingreso.it.cuenta.id?(l.verPlantillaIngreso=!1,l.errorIT=null):(l.visible.verPlantillaIngreso=!0,l.errorIT="sdf"),a.asignarCuentaIt&&(a.asignarCuentaIt.$error.cuenta=!1),e.ingreso.itPorPagar.cuenta&&e.ingreso.itPorPagar.cuenta.id?(l.verPlantillaIngreso=!1,l.errorItPorPagar=null):(l.visible.verPlantillaIngreso=!0,l.errorItPorPagar="sdf"),a.asignarCuentaItPorPagar&&(a.asignarCuentaItPorPagar.$error.cuenta=!1),e.ingreso.cajaBanco.cuenta&&e.ingreso.cajaBanco.cuenta.id?(l.verPlantillaIngreso=!1,l.errorIngresoCaja=null):(l.visible.verPlantillaIngreso=!0,l.errorIngresoCaja="sdf"),a.asignarCuentaIngresoCaja&&(a.asignarCuentaIngresoCaja.$error.cuenta=!1),e.egreso.ivacf.cuenta&&e.egreso.ivacf.cuenta.id?(l.verPlantillaEgreso=!1,l.errorIvacf=null):(l.visible.verPlantillaEgreso=!0,l.errorIvacf="sdf"),a.asignarCuentaIvaCf&&(a.asignarCuentaIvaCf.$error.cuenta=!1),e.egreso.cajaBanco.cuenta&&e.egreso.cajaBanco.cuenta.id?(l.verPlantillaEgreso=!1,l.errorEgresoCaja=null):(l.visible.verPlantillaEgreso=!0,l.errorEgresoCaja="sdf"),a.asignarCuentaEgresoCaja&&(a.asignarCuentaEgresoCaja.$error.cuenta=!1),l.usuario.empresa.usar_funciones_erp?(e.retencionBienes.almacen.cuenta&&e.retencionBienes.almacen.cuenta.id?(l.verPlantillarRetencionBien=!1,l.errorEgresoBienAlmacen=null):(l.visible.verPlantillarRetencionBien=!0,l.errorEgresoBienAlmacen="sdf"),a.asignarAlmacenBienes&&(a.asignarAlmacenBienes.$error.cuenta=!1),e.retencionBienes.it.cuenta&&e.retencionBienes.it.cuenta.id?(l.verPlantillarRetencionBien=!1,l.errorEgresoBienIt=null):(l.visible.verPlantillarRetencionBien=!0,l.errorEgresoBienIt="sdf"),a.asignarItBienes&&(a.asignarItBienes.$error.cuenta=!1),e.retencionBienes.iue.cuenta&&e.retencionBienes.iue.cuenta.id?(l.verPlantillarRetencionBien=!1,l.errorEgresoBienIue=null):(l.visible.verPlantillarRetencionBien=!0,l.errorEgresoBienIue="sdf"),a.asignarIueBienes&&(a.asignarIueBienes.$error.cuenta=!1),e.retencionBienesGasto.gasto.cuenta&&e.retencionBienesGasto.gasto.cuenta.id?(l.verPlantillarRetencionBienGasto=!1,l.errorEgresoBienGasto=null):(l.visible.verPlantillarRetencionBienGasto=!0,l.errorEgresoBienGasto="sdf"),a.asignarGastoBienes&&(a.asignarGastoBienes.$error.cuenta=!1),e.retencionBienesGasto.it.cuenta&&e.retencionBienesGasto.it.cuenta.id?(l.verPlantillarRetencionBienGasto=!1,l.errorEgresoBienGastoIt=null):(l.visible.verPlantillarRetencionBienGasto=!0,l.errorEgresoBienGastoIt="sdf"),a.asignarGastoItBienes&&(a.asignarGastoItBienes.$error.cuenta=!1),e.retencionBienesGasto.iue.cuenta&&e.retencionBienesGasto.iue.cuenta.id?(l.verPlantillarRetencionBienGasto=!1,l.errorEgresoBienGastoIue=null):(l.visible.verPlantillarRetencionBienGasto=!0,l.errorEgresoBienGastoIue="sdf"),a.asignarGastoIueBienes&&(a.asignarGastoIueBienes.$error.cuenta=!1)):(l.errorEgresoBienAlmacen=null,l.errorEgresoBienIt=null,l.errorEgresoBienIue=null,l.errorEgresoBienGasto=null,l.errorEgresoBienGastoIt=null,l.errorEgresoBienGastoIue=null),null==l.errorEgresoBienGasto&&null==l.errorEgresoBienGastoIt&&null==l.errorEgresoBienGastoIue&&null==l.errorEgresoBienIue&&null==l.errorEgresoBienIt&&null==l.errorEgresoBienAlmacen&&null==l.errorIvacf&&null==l.errorEgresoCaja&&null==l.errorIvadf&&null==l.errorIT&&null==l.errorItPorPagar&&(e.usar_funciones_erp=l.usuario.empresa.usar_funciones_erp,M.update({id_empresa:l.usuario.id_empresa},e,function(a){l.mostrarMensaje(a.menssage),l.cerrarPlantillaIngreso()}))},l.BoscarOcrearPlantillaIngreso=function(){l.plantilla={retencionServicios:{it:{},iue:{},servicio:{}},retencionBienesGasto:{it:{},iue:{},gasto:{}},retencionBienes:{it:{},iue:{},almacen:{}},egreso:{ivacf:{},cajaBanco:{}},ingreso:{ivadf:{},it:{},itPorPagar:{},cajaBanco:{}}},B(l.usuario.id_empresa).then(function(a){console.log(a.lista),a.lista.forEach(function(a){z.IVA_DF==a.nombre&&(l.plantilla.ingreso.ivadf={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IT==a.nombre&&(l.plantilla.ingreso.it={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IT_POR_PAGAR==a.nombre&&(l.plantilla.ingreso.itPorPagar={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.CAJA_BANCOS==a.nombre&&(l.plantilla.ingreso.cajaBanco={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IVA_CF==a.nombre&&(l.plantilla.egreso.ivacf={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.CAJA_BANCOS==a.nombre&&(l.plantilla.egreso.cajaBanco={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IT_RETENCION_BIEN==a.nombre&&(l.plantilla.retencionBienes.it={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IUE_RETENCION_BIEN==a.nombre&&(l.plantilla.retencionBienes.iue={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.CUENTA_ALMACEN_RETENCION_BIEN==a.nombre&&(l.plantilla.retencionBienes.almacen={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IT_RETENCION_BIEN_GASTO==a.nombre&&(l.plantilla.retencionBienesGasto.it={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IUE_RETENCION_BIEN_GASTO==a.nombre&&(l.plantilla.retencionBienesGasto.iue={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.CUENTA_GASTO_RETENCION_BIEN==a.nombre&&(l.plantilla.retencionBienesGasto.gasto={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IT_RETENCION_SERVICIO==a.nombre&&(l.plantilla.retencionServicios.it={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.IUE_RETENCION_SERVICIO==a.nombre&&(l.plantilla.retencionServicios.iue={porsentaje:parseFloat(a.valor),cuenta:a.cuenta}),z.CUENTA_RETENCION_SERVICIO==a.nombre&&(l.plantilla.retencionServicios.servicio={porsentaje:parseFloat(a.valor),cuenta:a.cuenta})},this),c.stop()})},l.buscarCuentas=function(a){if(""!=a&&null!=a){var e=T(l.usuario.id_empresa,a);return console.log(e),e}},l.obtenerConfigCuentas=function(){_(l.usuario.id_empresa).then(function(a){l.ListaCuentas=a,console.log(l.ListaCuentas),c.stop()})},l.updateFiltro=function(a){l.filtro=a},l.abrirPlantillaIngreso=function(){l.visible={},l.visible.verPlantillaIngreso=!0,l.visible.verPlantillaEgreso=!0,l.visible.verPlantillarRetencionBien=!0,l.visible.verPlantillarRetencionBienGasto=!0,l.visible.verPlantillarRetencionServicio=!0,l.BoscarOcrearPlantillaIngreso(),l.obtenerConfigCuentas(),l.abrirPopup(l.idModalWizardPlantillaIngreso)},l.cerrarPlantillaIngreso=function(){l.cerrarPopup(l.idModalWizardPlantillaIngreso)},l.agregarClasificacionCuenta=function(){l.clasificacion=new t({saldo:{},movimiento:{}}),l.abrirPopup(l.idModalWizardClasificacionNueva)},l.modificarClasificacionCuenta=function(a){l.clasificacion=a,l.abrirPopup(l.idModalWizardClasificacionNueva)},l.guardarClasificacion=function(a,e){a&&(l.ocultarMensajesValidacion(),c.start(),e.id?t.update({id:e.id},e,function(a){c.stop(),l.cerrarPopPupAgregarClasificacion(),l.obtenerClasificacionCuenta(),l.mostrarMensaje("Actualizado exitosamente!")}):(e.id_empresa=l.usuario.id_empresa,e.$save(function(a){c.stop(),l.mostrarMensaje("Clasificacion registrada exitosamente!",a),l.cerrarPopPupAgregarClasificacion(),l.obtenerClasificacionCuenta()},function(a){c.stop(),l.mostrarMensaje("Ocurrio un problema al momento de guardar!"),l.obtenerClasificacionCuenta()})))},l.mostrarConfirmacionEliminacion=function(a){l.cuenta=new r({id_empresa:l.usuario.id_empresa,id_usuario:l.usuario.id,tipoCuenta:{},clasificacion:{},eliminado:!1,bimonetaria:!1,aplicar_calculo:!1}),l.cuenta=a,l.abrirPopup(l.idModalEliminarCuenta)},l.cerrarPopPupConfirmacionEliminacion=function(){l.cerrarPopup(l.idModalEliminarCuenta)},l.eliminarCuenta=function(a){a.eliminado=!0,l.cuenta=a,l.cuenta.eliminado=!0,r.update({id:a.id,eliminado:!0},a,function(a){c.stop(),l.cerrarPopPupConfirmacionEliminacion(),l.recargarItemsTabla(),l.mostrarMensaje("Borrado exitosamente!")},function(a){c.stop(),l.mostrarMensaje("Ocurrio un problema al momento de guardar!"),l.recargarItemsTabla()})},l.crearNuevaCuenta=function(){l.cuenta=new r({id_empresa:l.usuario.id_empresa,id_usuario:l.usuario.id,tipoCuenta:{},clasificacion:{},eliminado:!1,bimonetaria:!1,especifica_texto1:"",especifica_texto2:"",especifica_texto3:""});var a=new Date;l.cuenta.fechaTexto=a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear(),l.abrirPopup(l.idModalWizardCuentaEdicion)},l.optenerCfDf=function(a,e){e?a?(A("CF_TEXTO_1").then(function(a){l.cuenta.especifica_texto1=a.clase}),A("CF_TEXTO_2").then(function(a){l.cuenta.especifica_texto2=a.clase}),A("CF_TEXTO_3").then(function(a){l.cuenta.especifica_texto3=a.clase})):(A("DF_TEXTO_1").then(function(a){l.cuenta.especifica_texto1=a.clase}),A("DF_TEXTO_2").then(function(a){l.cuenta.especifica_texto2=a.clase}),A("DF_TEXTO_3").then(function(a){l.cuenta.especifica_texto3=a.clase})):(l.cuenta.tipo_especifica=!1,l.cuenta.especifica_texto1="",l.cuenta.especifica_texto2="",l.cuenta.especifica_texto3="")},l.modificarCuenta=function(a){(l.cuenta=a).especifica&&l.optenerCfDf(a.tipo_especifica,a.especifica),l.abrirPopup(l.idModalWizardCuentaEdicion)},l.modificarClasificacionesCuenta=function(){l.abrirPopup(l.idModalWizardClasificacionEdicion)},l.verCuenta=function(a){l.cuenta=a,l.abrirPopup(l.idModalWizardCuentaVer)},l.validarCodigoCuenta=function(a){""!=a&&E(function(){l.validar=new N,l.validar.codigo=a,l.validar.$save(function(a){l.data=a})},1500)},l.guardarCuenta=function(a,e){a&&("Siguiente"!=$("#siguiente").text().trim()&&(l.ocultarMensajesValidacion(),c.start(),e.id?r.update({id:e.id},e,function(a){c.stop(),l.cerrarPopPupEdicion(),l.recargarItemsTabla(),l.mostrarMensaje("Actualizado exitosamente!")}):e.$save(function(a){c.stop(),l.mostrarMensaje("Cuenta registrada exitosamente!",a),l.cerrarPopPupEdicion(),l.recargarItemsTabla()},function(a){c.stop(),l.mostrarMensaje("Ocurrio un problema al momento de guardar!"),l.recargarItemsTabla()})))},l.obtenerCuentas=function(){l.paginator=m(),l.paginator.column="codigo",l.paginator.callBack=l.obtenerLista,l.filtro={empresa:l.usuario.id_empresa,clasificacion:"",tipo_cuenta:"",monto:""},l.paginator.getSearch("",l.filtro,null)},l.cerrarPopPupCuentaVer=function(){l.cerrarPopup(l.idModalWizardCuentaVer)},l.cerrarPopPupEdicion=function(){l.obtenerCuentas(),l.cerrarPopup(l.idModalWizardCuentaEdicion)},l.cerrarPopPupVerClasificacion=function(){l.cerrarPopup(l.idModalWizardClasificacionVer)},l.cerrarPopPupAgregarClasificacion=function(){l.cerrarPopup(l.idModalWizardClasificacionNueva)},l.obtenerClasificacionCuenta=function(){c.start(),u(l.usuario.id_empresa).then(function(a){l.cuentaClasificaciones=a.clasificaciones,c.stop()})},l.obtenerClasificacionSaldos=function(){c.start(),s("CONTCLSSAL").then(function(a){l.cuentaSaldos=a.clases,c.stop()})},l.obtenerClasificacionTipos=function(){c.start(),s("TIPOS_CLAS_CUENTA").then(function(a){l.tiposClasificaciones=a.clases,c.stop()})},l.obtenerClasificacionMovimientos=function(){c.start(),s("CONTCLSMOV").then(function(a){l.cuentaMovimientos=a.clases,c.stop()})},l.obtenerTiposCuenta=function(){c.start(),S("TCC",l.usuario.id_empresa).then(function(a){l.cuentaTipos=[{id:0,nombre:"TODOS"}],l.cuentaTipos=l.cuentaTipos.concat(a.clases),c.stop()})},l.obtenerTiposCuentasAuxilires=function(){c.start(),s("AUXCU").then(function(a){console.log(a),l.tiposCuentasAuxiliares=a.clases,c.stop()})},l.obtenerOperacionesCalculo=function(){c.start(),s("OPE").then(function(a){l.operacionesCalculo=a.clases,c.stop()})},l.obtenerLista=function(){c.start(),l.sumaTotales={debe:0,haber:0,saldo:0},g(l.paginator).then(function(a){l.paginator.setPages(a.paginas),a.cuentas.forEach(function(a,e,i){l.sumaTotales.debe+=a.debe,l.sumaTotales.haber+=a.haber,l.sumaTotales.saldo+=a.saldo}),c.stop(),l.Cuentas=a.cuentas})},l.obtenerTotalesGeneral=function(){l.sumaTotalesGenerales={debe:0,haber:0,saldo:0};var a={filter:{empresa:l.usuario.id_empresa,clasificacion:0,tipo_cuenta:0,monto:0},currentPage:1,itemsPerPage:0,search:0,column:"codigo",direction:"asc"};g(a).then(function(a){a.cuentas.forEach(function(a,e,i){l.sumaTotalesGenerales.debe+=a.debe,l.sumaTotalesGenerales.haber+=a.haber,l.sumaTotalesGenerales.saldo+=a.saldo,c.stop()})})},l.subirExcelCuentas=function(a){var e,i,n=a.target.files;for(i=n[e=0];e!=n.length;++e){var o=new FileReader;i.name;o.onload=function(a){c.start();var e=a.target.result,i=XLSX.read(e,{type:"binary"}),n=i.SheetNames[0],o=2,r=i.Sheets[n],t=[];do{var s={clasificacion:{},tipoCuenta:{}};s.codigo=null!=r["A"+o]&&""!=r["A"+o]?r["A"+o].v.toString():null,s.nombre=null!=r["B"+o]&&""!=r["B"+o]?r["B"+o].v.toString():null,s.descripcion=null!=r["C"+o]&&""!=r["C"+o]?r["C"+o].v.toString():null,s.clasificacion.nombre=null!=r["D"+o]&&""!=r["D"+o]?r["D"+o].v.toString():null,s.tipoCuenta.nombre=null!=r["E"+o]&&""!=r["E"+o]?r["E"+o].v.toString():null,s.debe=null!=r["F"+o]&&""!=r["F"+o]?parseFloat(r["F"+o].v.toString()):null,s.haber=null!=r["G"+o]&&""!=r["G"+o]?parseFloat(r["G"+o].v.toString()):null,s.saldo=null!=r["H"+o]&&""!=r["H"+o]?parseFloat(r["H"+o].v.toString()):null,s.bimonetaria=null!=r["I"+o]&&""!=r["I"+o]?r["I"+o].v.toString():null,"SI"!=s.bimonetaria?s.bimonetaria=0:s.bimonetaria=1,t.push(s),o++,0}while(null!=r["A"+o]);l.guardarCuentas(t),console.log(t),c.stop()},o.readAsBinaryString(i)}},l.guardarCuentas=function(a){new v({cuentas:a,id_empresa:l.usuario.id_empresa}).$save(function(a){c.stop(),l.mostrarMensaje("Guardado Exitosamente!"),l.recargarItemsTabla()},function(a){c.stop(),l.mostrarMensaje("Ocurrio un problema al momento de guardar!"),l.recargarItemsTabla()})},l.establecerCliente=function(a){l.cuenta.cliente=a},l.interceptarTecla=function(a,e,i){13===a.which&&(i?l.enfocar(e):E(function(){$("#"+e).trigger("click")},0))},l.buscarCliente=function(a){if(""!=a&&null!=a)return b(l.usuario.id_empresa,a)},l.establecerProveedor=function(a){l.cuenta.proveedor=a},l.buscarProveedor=function(a){if(""!=a&&null!=a)return P(l.usuario.id_empresa,a)},l.$on("$routeChangeStart",function(a,e){l.eliminarPopup(l.idModalWizardCuentaEdicion),l.eliminarPopup(l.idModalWizardClasificacionNueva),l.eliminarPopup(l.idModalWizardCuentaVer),l.eliminarPopup(l.idModalEliminarCuenta),l.eliminarPopup(l.idModalWizardPlantillaIngreso),l.eliminarPopup(l.idModalWizardClasificacionEdicion),l.eliminarPopup(l.idModalWizardConceptoEdicion)}),l.inicio()}]);