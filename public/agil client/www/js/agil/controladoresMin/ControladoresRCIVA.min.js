angular.module("agil.controladores").controller("ControladoresRCIVA",["$scope","$localStorage","$location","$templateCache","$route","blockUI","RecursosHumanosEmpleados","RecursosHumanosEmpleadosHorasExtras","ClasesTipo","Parametros","ObtenerCambioMoneda","RecursosHumanosPlanillaRCIVA","RRHHlistaPlanillaRCIVA","ListaRRHHPlanillaRCIVA",function(O,a,o,e,l,U,s,t,i,n,r,u,d,c){function m(a,o){return Number(Math.round(a+"e"+o)+"e-"+o)}O.$on("$viewContentLoaded",function(){O.idModalNuevoPlanillaRCIVA="dialog-nueva-planilla-rc-iva",O.idModalFormulario110="dialog-formulario-110",O.idModalFormularioGeneral110="dialog-formulario-general-110",O.idModalArchivosTXT="dialog-archivos-txt",O.idModalEditarPlanillaRCIVA="dialog-editar-planilla-rc-iva",ejecutarScriptsPlanillaRCIVA(O.idModalNuevoPlanillaRCIVA,O.idModalFormulario110,O.idModalFormularioGeneral110,O.idModalArchivosTXT,O.idModalEditarPlanillaRCIVA)}),O.$on("$routeChangeStart",function(a,o){O.eliminarPopup(O.idModalNuevoPlanillaRCIVA,O.idModalFormulario110,O.idModalFormularioGeneral110,O.idModalArchivosTXT,O.idModalEditarPlanillaRCIVA)}),O.usuario=JSON.parse(a.usuario),O.fechaATexto=function(a){return fech=new Date(a),a=fech.getDate()+"/"+(fech.getMonth()+1)+"/"+fech.getFullYear()},O.obtenerGestiones=function(){U.start(),i("GTN").then(function(a){O.gestiones=a.clases,U.stop()})},O.obtenerGestiones(),O.obtenerPlanillaRcIva=function(a){console.log("la cabezeraaa ",a),c(O.usuario.id_empresa,a.gestion,a.mes).then(function(a){console.log("la cabezeraaa ",a),O.planillasRcIva=a.planillas,O.sumarTotalesPlanillaRcIva(O.planillasRcIva)})},O.sumarTotalesPlanillaRcIva=function(a){if(O.sumaNetoImponible=0,O.sumaDosSmn=0,O.sumaDiferencia=0,O.sumaRcIva=0,O.sumaDosSmn13=0,O.sumaF110=0,O.sumaRcIvaFisico=0,O.sumaSaldoDependiente=0,O.sumaSaldoAnterior=0,O.sumaActualizacion=0,O.sumaSaldoActualizado=0,O.sumaSaldoTotal=0,O.sumaSaldoUtilizado=0,O.sumaRcIvaMes=0,O.sumaNuevoSaldo=0,null!=a)for(var o=0;o<a.length;o++)O.sumaNetoImponible=O.sumaNetoImponible+a[o].neto_imponible,O.sumaDosSmn=O.sumaDosSmn+a[o].dos_smn,O.sumaDiferencia=O.sumaDiferencia+a[o].diferencia,O.sumaRcIva=O.sumaRcIva+a[o].rc_iva,O.sumaDosSmn13=O.sumaDosSmn13+a[o].dos_smn13,O.sumaF110=O.sumaF110+a[o].f110,O.sumaRcIvaFisico=O.sumaRcIvaFisico+a[o].rc_iva_fisico,O.sumaSaldoDependiente=m(O.sumaSaldoDependiente+a[o].saldo_dependiente,2),O.sumaSaldoAnterior=m(O.sumaSaldoAnterior+a[o].saldo_anterior,2),O.sumaActualizacion=m(O.sumaActualizacion+a[o].actualizacion,2),O.sumaSaldoActualizado=m(O.sumaSaldoActualizado+a[o].saldo_actualizado,2),O.sumaSaldoTotal=m(O.sumaSaldoTotal+a[o].saldo_total,2),O.sumaSaldoUtilizado=m(O.sumaSaldoUtilizado+a[o].saldo_utilizado,2),O.sumaRcIvaMes=m(O.sumaRcIvaMes+a[o].rc_iva_mes,2),O.sumaNuevoSaldo=m(O.sumaNuevoSaldo+a[o].nuevo_saldo,2);O.planillaRcIva.sumaNetoImponible=O.sumaNetoImponible,O.planillaRcIva.sumaRcIva=O.sumaRcIva,O.planillaRcIva.sumaDosSmn=O.sumaDosSmn,O.planillaRcIva.sumaDiferencia=O.sumaDiferencia,O.planillaRcIva.sumaDosSmn13=O.sumaDosSmn13,O.planillaRcIva.sumaF110=O.sumaF110,O.planillaRcIva.sumaRcIvaFisico=O.sumaRcIvaFisico,O.planillaRcIva.sumaSaldoDependiente=O.sumaSaldoDependiente,O.planillaRcIva.sumaSaldoAnterior=O.sumaSaldoAnterior,O.planillaRcIva.sumaActualizacion=O.sumaActualizacion,O.planillaRcIva.sumaSaldoActualizado=O.sumaSaldoActualizado,O.planillaRcIva.sumaSaldoTotal=O.sumaSaldoTotal,O.planillaRcIva.sumaSaldoUtilizado=O.sumaSaldoUtilizado,O.planillaRcIva.sumaRcIvaMes=O.sumaRcIvaMes,O.planillaRcIva.sumaNuevoSaldo=O.sumaNuevoSaldo},O.EditarRciva=function(a){console.log("llego a editar ",a),O.planillaEdit=a,O.abrirPopup(O.idModalEditarPlanillaRCIVA)},O.cerrarDialogEditarPlanillaRCIVA=function(){O.cerrarPopup(O.idModalEditarPlanillaRCIVA)},O.nuevaPlanillaRcIva=function(){O.planilla=new u({id_empresa:O.usuario.id_empresa}),O.sumarTotales(O.planilla)},O.abrirDialogNuevoPlanillaRCIVA=function(){O.nuevaPlanillaRcIva(),O.abrirPopup(O.idModalNuevoPlanillaRCIVA)},O.cerrarDialogNuevoPlanillaRCIVA=function(){O.cerrarPopup(O.idModalNuevoPlanillaRCIVA)},O.generarPdfPLanillaRCIVA=function(B){U.start(),c(O.usuario.id_empresa,B.gestion,B.mes).then(function(a){var o=a.planillas,e=new PDFDocument({compress:!1,margin:10,size:"A4",layout:"landscape"}),l=e.pipe(blobStream());O.dibujarCabeceraPDFPlanillaRCIVA(e,O.usuario,B,1),e.font("Helvetica",8);for(var s=150,t=0,i=1,n=0,r=0,u=0,d=0,c=0,m=0,p=0,v=0,f=0,h=0,_=0,I=0,S=0,A=0,R=0,M=0,g=0,F=0,x=0,b=0,D=0,E=0,z=0,N=0,C=0,T=0,H=0,P=0,w=0,V=0;V<o.length&&t<=12;V++)e.rect(40,s-10,760,30).stroke(),e.text(V+1,45,s),e.text(o[V].anio,60,s),e.text(o[V].mes.split("-")[1],90,s),e.text(o[V].neto_imponible,140,s),e.text(o[V].dos_smn,190,s),e.text(o[V].diferencia,230,s),e.text(o[V].rc_iva,283,s),e.text(o[V].dos_smn13,325,s),e.text(o[V].f110,365,s),e.text(o[V].rc_iva_fisico,400,s),e.text(o[V].saldo_dependiente,440,s),e.text(o[V].saldo_anterior,490,s),e.text(o[V].actualizacion,530,s),e.text(o[V].saldo_actualizado,580,s),e.text(o[V].saldo_total,625,s),e.text(o[V].saldo_utilizado,665,s),e.text(o[V].rc_iva_mes,705,s),e.text(o[V].nuevo_saldo,740,s),s+=30,x+=o[V].neto_imponible,g+=o[V].dos_smn,F+=o[V].diferencia,r+=o[V].rc_iva,b+=o[V].dos_smn13,D+=o[V].f110,E+=o[V].rc_iva_fisico,z+=o[V].saldo_dependiente,M+=o[V].saldo_anterior,N+=o[V].actualizacion,C+=o[V].saldo_actualizado,T+=o[V].saldo_total,H+=o[V].saldo_utilizado,P+=o[V].rc_iva_mes,w+=o[V].nuevo_saldo,n+=o[V].neto_imponible,u+=o[V].dos_smn,d+=o[V].diferencia,c+=o[V].dos_smn13,m+=o[V].f110,p+=o[V].rc_iva_fisico,v+=o[V].saldo_dependiente,f+=o[V].saldo_anterior,h+=o[V].actualizacion,_+=o[V].saldo_actualizado,I+=o[V].saldo_total,S+=o[V].saldo_utilizado,A+=o[V].rc_iva_mes,R+=o[V].nuevo_saldo,12!=++t&&V+1!=o.length||(e.font("Helvetica-Bold",8),e.text("SUBTOTALES",75,s),e.text(Math.round(100*x)/100,140,s),e.text(Math.round(100*g)/100,190,s),e.text(Math.round(100*F)/100,230,s),e.text(Math.round(100*r)/100,283,s),e.text(Math.round(100*b)/100,325,s),e.text(Math.round(100*D)/100,365,s),e.text(Math.round(100*E)/100,400,s),e.text(Math.round(100*z)/100,440,s),e.text(Math.round(100*M)/100,490,s),e.text(Math.round(100*N)/100,530,s),e.text(Math.round(100*C)/100,580,s),e.text(Math.round(100*T)/100,625,s),e.text(Math.round(100*H)/100,665,s),e.text(Math.round(100*P)/100,705,s),e.text(Math.round(100*w)/100,740,s),e.rect(40,s-10,760,30).stroke(),e.font("Helvetica",8),V+1==o.length?(e.font("Helvetica-Bold",8),e.text("TOTALES",75,s+30),e.text(Math.round(100*n)/100,140,s+30),e.text(Math.round(100*u)/100,190,s+30),e.text(Math.round(100*d)/100,230,s+30),e.text(Math.round(100*r)/100,283,s+30),e.text(Math.round(100*c)/100,325,s+30),e.text(Math.round(100*m)/100,365,s+30),e.text(Math.round(100*p)/100,400,s+30),e.text(Math.round(100*v)/100,440,s+30),e.text(Math.round(100*f)/100,490,s+30),e.text(Math.round(100*h)/100,530,s+30),e.text(Math.round(100*_)/100,580,s+30),e.text(Math.round(100*I)/100,625,s+30),e.text(Math.round(100*S)/100,665,s+30),e.text(Math.round(100*A)/100,705,s+30),e.text(Math.round(100*R)/100,740,s+30),e.rect(40,s-10+30,760,30).stroke()):(e.addPage({margin:0,bufferPages:!0,layout:"landscape"}),s=170,t=0,i+=1,O.dibujarCabeceraPDFLibroVentas(e,a,reporte,i)),e.font("Helvetica",8));e.end(),l.on("finish",function(){var a=l.toBlobURL("application/pdf");window.open(a,"_blank","location=no")}),U.stop()})},O.dibujarCabeceraPDFPlanillaRCIVA=function(a,o,e,l){a.font("Helvetica-Bold",12),a.text("PLANILLAS RC-IVA",0,25,{align:"center"}),a.font("Helvetica-Bold",8),a.text("FOLIO "+l,760,25),a.rect(40,60,760,40).stroke(),a.text("PERIÓDO FISCAL : ",65,70),a.text("NOMBRE O RAZÓN SOCIAL : ",65,85),a.text("NIT : ",440,85),a.font("Helvetica",8),a.text("AÑO "+e.gestion,140,70);var s=e.mes.split("-")[1];"TODOS"==e.mes&&(s=e.mes),a.text("MES "+s,200,70),a.text(o.empresa.razon_social,195,85),a.text(o.empresa.nit,460,85),a.rect(40,100,760,40).stroke(),a.font("Helvetica-Bold",8),a.text("Nº",45,110),a.text("Año",60,110,{width:20}),a.text("Mes",90,110,{width:50}),a.text("Neto Imponible",140,110,{width:50}),a.text("2 SMN",190,110,{width:35}),a.text("Diferencia",230,110,{width:50}),a.text("RC-IVA 13%",280,110,{width:35}),a.text("13% de 2 SMN",325,110,{width:35}),a.text("F-110",365,110,{width:35}),a.text("RC-IVA Fisco",400,110,{width:42}),a.text("Saldo Dependiente",440,110,{width:42}),a.text("Saldo Anterior",490,110,{width:40}),a.text("Actualización",530,110,{width:37}),a.text("Saldo Actualizado",580,110,{width:35}),a.text("Saldo Total",625,110,{width:35}),a.text("Saldo Utilizado",665,110,{width:35}),a.text("RC-IVA Mes",705,110,{width:35}),a.text("Saldo Nuevo",740,110)},O.generarExcelPlanillaRcIva=function(a){U.start(),c(O.usuario.id_empresa,a.gestion,a.mes).then(function(a){for(var o=a.planillas,e=[["N°","Año","Mes","Neto Imponible","2 SMN","Diferencia","RC-IVA 13%","13% de 2 SMN","F-110","RC-IVA Fisco","Saldo Dependiente","Saldo Anterior","Actualización","Saldo Actualizado","Saldo Total","Saldo Utilizado","RC-IVA Mes","Saldo Nuevo"]],l=0,s=0,t=0,i=0,n=0,r=0,u=0,d=0,c=0,m=0,p=0,v=0,f=0,h=0,_=0;_<o.length;_++){var I=[];I.push(_+1),I.push(o[_].anio),I.push(o[_].mes.split("-")[1]),I.push(o[_].neto_imponible),I.push(o[_].dos_smn),I.push(o[_].diferencia),I.push(o[_].rc_iva),I.push(o[_].dos_smn13),I.push(o[_].f110),I.push(o[_].rc_iva_fisico),I.push(o[_].saldo_dependiente),I.push(o[_].saldo_anterior),I.push(o[_].actualizacion),I.push(o[_].saldo_actualizado),I.push(o[_].saldo_total),I.push(o[_].saldo_utilizado),I.push(o[_].rc_iva_mes),I.push(o[_].nuevo_saldo),l+=o[_].neto_imponible,s+=o[_].dos_smn,t+=o[_].diferencia,i+=o[_].dos_smn13,n+=o[_].f110,r+=o[_].rc_iva_fisico,u+=o[_].saldo_dependiente,d+=o[_].saldo_anterior,c+=o[_].actualizacion,m+=o[_].saldo_actualizado,p+=o[_].saldo_total,v+=o[_].saldo_utilizado,f+=o[_].rc_iva_mes,h+=o[_].nuevo_saldo,e.push(I),_+1==o.length&&((I=[]).push(""),I.push(""),I.push("TOTALES"),I.push(Math.round(100*l)/100),I.push(Math.round(100*s)/100),I.push(Math.round(100*t)/100),I.push(Math.round(0)/100),I.push(Math.round(100*i)/100),I.push(Math.round(100*n)/100),I.push(Math.round(100*r)/100),I.push(Math.round(100*u)/100),I.push(Math.round(100*d)/100),I.push(Math.round(100*c)/100),I.push(Math.round(100*m)/100),I.push(Math.round(100*p)/100),I.push(Math.round(100*v)/100),I.push(Math.round(100*f)/100),I.push(Math.round(100*h)/100),e.push(I))}var S="SheetJS",A=new Workbook,R=sheet_from_array_of_arrays(e);A.SheetNames.push(S),A.Sheets[S]=R;var M=XLSX.write(A,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(M)],{type:"application/octet-stream"}),"PLANILLA-RCIVA.xlsx"),U.stop()})},O.filtrarSueldos=function(n){console.log("cabezera",n);var a=new Date(n.gestion,parseInt(n.mes)-1,0),o=new Date(n.gestion,parseInt(n.mes),0);console.log("fechaUFVAnterior ===========",a),console.log("fechaUFVActual ===========",o),Promise.all([r(o),r(a),d(O.usuario.id_empresa,n.gestion,n.mes)]).then(function(a){console.log("del mel planillaaaaaaaaaaaasss ",a[2].planillas.length),O.ufvActual=null==a[0].monedaCambio?0:a[0].monedaCambio.ufv,console.log("$scope.ufvActual ==== ",O.ufvActual),O.ufvAnterior=null==a[1].monedaCambio?0:a[1].monedaCambio.ufv;if(0==a[2].planillas.length)if(0<O.ufvActual&&0<O.ufvAnterior){var o=s(O.usuario.id_empresa);o.then(function(a){n.RecursosHumanosEmpleados=a.empleados,n.RecursosHumanosEmpleados.forEach(function(i){(o=t(i.id_ficha,n.gestion,n.mes.split("-")[0],i.id)).then(function(a){var o,e;i.sueldoBasico=i.haber_basico,O.antiguedad=(o=i.fecha_inicio,e=+new Date(o),~~((Date.now()-e)/315576e5)),O.bonoFrontera=0,O.otrosBonos=0,i.horasExtras=a.totalHoras,i.totalHorasExtras=m(i.sueldoBasico/30/8*i.horasExtras*2,2),i.recargoNocturno=m(i.sueldoBasico/30/8*i.horasExtras*1.5,2),i.bonoAntiguedad=O.calcularBonoAntiguedad(O.antiguedad),i.bonoFrontera=O.bonoFrontera,i.otrosBonos=O.otrosBonos,i.totalGanado=i.sueldoBasico+i.totalHorasExtras+i.recargoNocturno+i.bonoAntiguedad+i.bonoFrontera+i.otrosBonos,i.afp=m(12.71*i.totalGanado/100,2),i.montoDeclarado=0,i.muneroFacturas=0,i.ivaCF=0,i.netoImponible=m(i.totalGanado-i.afp,2),i.dos_SMN=2*O.parametros.salario_minimo,i.diferencia=0,i.netoImponible>i.dos_SMN&&(i.diferencia=m(i.netoImponible-i.dos_SMN,2)),i.rcIva13=m(.13*i.diferencia,2),i.dos_SMN13=2*O.parametros.salario_minimo*.13,i.f110=i.ivaCF;var l=i.rcIva13-i.dos_SMN13,s=l-i.f110;(i.rcIvaFisco=0)<=s&&(i.rcIvaFisco=m(s,2)),i.saldoDependiente=0<=s?0:m(i.f110-l,2),null==i.nuevo_saldo&&(i.nuevo_saldo=0),i.saldoAnterior=i.nuevo_saldo,i.actualizacion=m(i.saldoAnterior/O.ufvAnterior*O.ufvActual-i.saldoAnterior,2),i.saldoActualizado=i.saldoAnterior+i.actualizacion,i.saldoTotal=m(i.saldoDependiente+i.saldoActualizado,2);var t=i.rcIvaFisco-i.saldoActualizado;i.saldoUtilizado=0<t?m(i.rcIvaFisco-t,2):i.rcIvaFisco,i.rcIvaMes=0,i.rcIvaFisco>i.saldoTotal&&(i.rcIvaMes=m(i.rcIvaFisco-i.saldoTotal,2)),0<i.rcIvaMes?i.saldoNuevo=0:i.saldoNuevo=i.saldoTotal-i.rcIvaFisco,O.sumarTotales(n)})})})}else O.$apply(function(){O.message="Falta las UFVs para poder crear nuevas planillas",O.mostrarMensaje(O.message)});else O.$apply(function(){O.message="Ya se creo planilla para este periodo '"+n.mes.split("-")[1]+"-"+n.gestion+"'",O.mostrarMensaje(O.message)});U.stop()})},O.calcularRCIVA=function(){var a=13*O.sueldo.montoDeclarado/100;O.valido=!1,a!=O.sueldo.ivaCF&&(O.mensage="ddfsfsdfsdf",O.valido=!0),O.sueldo.f110=O.sueldo.ivaCF;var o=O.sueldo.rcIva13-O.sueldo.dos_SMN13,e=o-O.sueldo.f110;(O.sueldo.rcIvaFisco=0)<=e&&(O.sueldo.rcIvaFisco=m(e,2)),O.sueldo.saldoDependiente=0<=e?0:m(O.sueldo.f110-o,2),O.sueldo.saldoAnterior=10,O.sueldo.actualizacion=m(O.sueldo.saldoAnterior/O.ufvAnterior*O.ufvActual-O.sueldo.saldoAnterior,2),O.sueldo.saldoActualizado=O.sueldo.saldoAnterior+O.sueldo.actualizacion,O.sueldo.saldoTotal=m(O.sueldo.saldoDependiente+O.sueldo.saldoActualizado,2);var l=O.sueldo.rcIvaFisco-O.sueldo.saldoActualizado;O.sueldo.saldoUtilizado=0<l?m(O.sueldo.rcIvaFisco-l,2):O.sueldo.rcIvaFisco,O.sueldo.rcIvaMes=0,O.sueldo.rcIvaFisco>O.sueldo.saldoTotal&&(O.sueldo.rcIvaMes=m(O.sueldo.rcIvaFisco-O.sueldo.saldoTotal,2)),0<O.sueldo.rcIvaMes?O.sueldo.saldoNuevo=0:O.sueldo.saldoNuevo=O.sueldo.saldoTotal-O.sueldo.rcIvaFisco},O.calcularRCIVA2=function(a,o){a.f110=o.ivaCF;var e=a.rcIva13-a.dos_SMN13,l=e-a.f110;(a.rcIvaFisco=0)<=l&&(a.rcIvaFisco=m(l,2)),a.saldoDependiente=0<=l?0:m(a.f110-e,2),a.saldoAnterior=10,a.actualizacion=m(a.saldoAnterior/O.ufvAnterior*O.ufvActual-a.saldoAnterior,2),a.saldoActualizado=a.saldoAnterior+a.actualizacion,a.saldoTotal=m(a.saldoDependiente+a.saldoActualizado,2);var s=a.rcIvaFisco-a.saldoActualizado;a.saldoUtilizado=0<s?m(a.rcIvaFisco-s,2):a.rcIvaFisco,a.rcIvaMes=0,a.rcIvaFisco>a.saldoTotal&&(a.rcIvaMes=m(a.rcIvaFisco-a.saldoTotal,2)),0<a.rcIvaMes?a.saldoNuevo=0:a.saldoNuevo=a.saldoTotal-a.rcIvaFisco},O.sumarTotales=function(a){O.netoImponible=0,O.sumaDos_SMN=0,O.sumaDiferencia=0,O.sumarcIva13=0,O.sumaDos_SMN13=0,O.sumaF110=0,O.sumaRcIvaFisco=0,O.sumaSaldoDependiente=0,O.sumaSaldoAnterior=0,O.sumaActualizacion=0,O.sumaSaldoActualizado=0,O.sumaSaldoTotal=0,O.sumaSaldoUtilizado=0,O.sumaRcIvaMes=0;var o=O.sumaSaldoNuevo=0;if(null!=a.RecursosHumanosEmpleados)for(var e=0;e<a.RecursosHumanosEmpleados.length;e++)o+=1,O.netoImponible=O.netoImponible+a.RecursosHumanosEmpleados[e].netoImponible,O.sumaDos_SMN=O.sumaDos_SMN+a.RecursosHumanosEmpleados[e].dos_SMN,O.sumaDiferencia=O.sumaDiferencia+a.RecursosHumanosEmpleados[e].diferencia,O.sumarcIva13=O.sumarcIva13+a.RecursosHumanosEmpleados[e].rcIva13,O.sumaDos_SMN13=O.sumaDos_SMN13+a.RecursosHumanosEmpleados[e].dos_SMN13,O.sumaF110=O.sumaF110+a.RecursosHumanosEmpleados[e].f110,O.sumaRcIvaFisco=O.sumaRcIvaFisco+a.RecursosHumanosEmpleados[e].rcIvaFisco,O.sumaSaldoDependiente=m(O.sumaSaldoDependiente+a.RecursosHumanosEmpleados[e].saldoDependiente,2),O.sumaSaldoAnterior=m(O.sumaSaldoAnterior+a.RecursosHumanosEmpleados[e].saldoAnterior,2),O.sumaActualizacion=m(O.sumaActualizacion+a.RecursosHumanosEmpleados[e].actualizacion,2),O.sumaSaldoActualizado=m(O.sumaSaldoActualizado+a.RecursosHumanosEmpleados[e].saldoActualizado,2),O.sumaSaldoTotal=m(O.sumaSaldoTotal+a.RecursosHumanosEmpleados[e].saldoTotal,2),O.sumaSaldoUtilizado=m(O.sumaSaldoUtilizado+a.RecursosHumanosEmpleados[e].saldoUtilizado,2),O.sumaRcIvaMes=m(O.sumaRcIvaMes+a.RecursosHumanosEmpleados[e].rcIvaMes,2),O.sumaSaldoNuevo=m(O.sumaSaldoNuevo+a.RecursosHumanosEmpleados[e].saldoNuevo,2);a.totalEmpleados=o,a.netoImponible=O.netoImponible,a.sumaDos_SMN=O.sumaDos_SMN,a.sumaDiferencia=O.sumaDiferencia,a.sumarcIva13=O.sumarcIva13,a.sumaDos_SMN13=O.sumaDos_SMN13,a.sumaF110=O.sumaF110,a.sumaRcIvaFisco=O.sumaRcIvaFisco,a.sumaSaldoDependiente=O.sumaSaldoDependiente,a.sumaSaldoAnterior=O.sumaSaldoAnterior,a.sumaActualizacion=O.sumaActualizacion,a.sumaSaldoActualizado=O.sumaSaldoActualizado,a.sumaSaldoTotal=O.sumaSaldoTotal,a.sumaSaldoUtilizado=O.sumaSaldoUtilizado,a.sumaRcIvaMes=O.sumaRcIvaMes,a.sumaSaldoNuevo=O.sumaSaldoNuevo},O.obtenerParametros=function(a){U.start(),null==a&&(a=0),n(a).then(function(a){O.parametros=a,U.stop()})},O.calcularBonoAntiguedad=function(a){return 0<=a&&a<=2?3*O.parametros.salario_base_antiguedad*O.parametros.antiguedad_cero_dos/100:2<a&&a<=5?3*O.parametros.salario_base_antiguedad*O.parametros.antiguedad_dos_cinco/100:5<a&&a<=8?3*O.parametros.salario_base_antiguedad*O.parametros.antiguedad_cinco_ocho/100:8<a&&a<=11?3*O.parametros.salario_base_antiguedad*O.parametros.antiguedad_ocho_once/100:11<a&&a<=15?3*O.parametros.salario_base_antiguedad*O.parametros.antiguedad_once_quince/100:15<a&&a<=20?3*O.parametros.salario_base_antiguedad*O.parametros.antiguedad_quice_veinte/100:20<a&&a<=25?3*O.parametros.salario_base_antiguedad*O.parametros.antiguedad_veinte_veinticinco/100:25<a?3*O.parametros.salario_base_antiguedad*O.parametros.antiguedad_mas_veinticinco/100:void 0},O.calculoR=function(){O.sueldo.f110=O.sueldo.ivaCF},O.modificarFormulario110=function(a){O.empleado=angular.extend(O.empleado,a),O.sumarTotales(O.planilla),O.cerrarDialogFormulario110(),console.log("el empleadofff ===== ",a)},O.EmpleadosSeleccionados=[],O.checkEmpleado=function(a,o,e){var l=O.EmpleadosSeleccionados.indexOf(o);console.log("idx ===========",l),O.selectAll=!1,0<=l&&!e&&O.EmpleadosSeleccionados.splice(l,1),l<0&&!e&&O.EmpleadosSeleccionados.splice(a,1),l<0&&e&&O.EmpleadosSeleccionados.push(o),console.log("los seleccionadossssss ===== ",O.EmpleadosSeleccionados)},O.checkAll=function(a,o){O.EmpleadosSeleccionados=o?angular.copy(a):[],angular.forEach(a,function(a){a.checked=o})},O.abrirDialogFormulario110=function(a){O.empleado=a,O.sueldo=angular.copy(a),console.log("$scope.sueldo ==== ",O.sueldo),O.abrirPopup(O.idModalFormulario110)},O.generarExcelFormulario110=function(a){var o=[["CODIGO","NOMBRE COMPLETO","MONTO DECLARADO","IVA CF","NUMERO DE FACTURAS"]];if(a)for(var e=0;e<a.RecursosHumanosEmpleados.length;e++){var l=[];l.push(a.RecursosHumanosEmpleados[e].codigo),l.push(a.RecursosHumanosEmpleados[e].nombre_completo),l.push(0),l.push(0),l.push(0),o.push(l)}var s="SheetJS",t=new Workbook,i=sheet_from_array_of_arrays(o);i["!cols"]=[{wch:12},{wch:25},{wch:17},{wch:10},{wch:20}],t.SheetNames.push(s),t.Sheets[s]=i;var n=XLSX.write(t,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(n)],{type:"application/octet-stream"}),"datos_formulario11o.xlsx"),U.stop()},O.subirExcelFormulario110=function(a){var o,e,l=a.target.files;for(e=l[o=0];o!=l.length;++o){var s=new FileReader;e.name;s.onload=function(a){U.start();var o=a.target.result,e=XLSX.read(o,{type:"binary"}),l=e.SheetNames[0],s=2,t=e.Sheets[l];O.selectEdit=function(a){var o=function(a){for(var o=0;o<O.planilla.RecursosHumanosEmpleados.length;o++)if(O.planilla.RecursosHumanosEmpleados[o].codigo==a)return o;return-1}(a.codigo);O.planilla.RecursosHumanosEmpleados[o].ivaCF=a.ivaCF,O.planilla.RecursosHumanosEmpleados[o].montoDeclarado=a.montoDeclarado,O.planilla.RecursosHumanosEmpleados[o].muneroFacturas=a.muneroFacturas,O.calcularRCIVA2(O.planilla.RecursosHumanosEmpleados[o],a)};do{var i={};i.codigo=null!=t["A"+s]&&""!=t["A"+s]?t["A"+s].v.toString():null,i.nombre_completo=null!=t["B"+s]&&""!=t["B"+s]?t["B"+s].v.toString():null,i.montoDeclarado=null!=t["C"+s]&&""!=t["C"+s]?Number(t["C"+s].v):null,i.ivaCF=null!=t["D"+s]&&""!=t["D"+s]?Number(t["D"+s].v):null,i.muneroFacturas=null!=t["E"+s]&&""!=t["E"+s]?Number(t["E"+s].v):null,O.selectEdit(i),s++,0}while(null!=t["A"+s]);O.sumarTotales(O.planilla),O.cerrarDialogFormularioGeneral110(),U.stop()},s.readAsBinaryString(e)}},O.cerrarDialogFormulario110=function(){O.cerrarPopup(O.idModalFormulario110)},O.abrirDialogFormularioGeneral110=function(){O.abrirPopup(O.idModalFormularioGeneral110)},O.modificarFormularioGeneral110=function(a){O.selectEdit=function(a){var o=function(a){for(var o=0;o<O.planilla.RecursosHumanosEmpleados.length;o++)if(O.planilla.RecursosHumanosEmpleados[o].id==a)return o;return-1}(a.id);console.log("index empleado",o),O.planilla.RecursosHumanosEmpleados[o].ivaCF=a.ivaCF,O.planilla.RecursosHumanosEmpleados[o].montoDeclarado=a.montoDeclarado,O.planilla.RecursosHumanosEmpleados[o].muneroFacturas=a.muneroFacturas,O.calcularRCIVA2(O.planilla.RecursosHumanosEmpleados[o],a)},a.forEach(function(a){O.selectEdit(a)}),console.log("empleado generalllllllll ====== ",O.planilla.RecursosHumanosEmpleados),O.sumarTotales(O.planilla),O.cerrarDialogFormularioGeneral110()},O.generar=function(a){a.$save(function(a){O.nuevaPlanillaRcIva(),U.stop(),O.mostrarMensaje("Planilla registrada exitosamente!")},function(a){U.stop(),console.log("fallo ",a)}),console.log("los datos  de planilla rc ivaaa ",a)},O.cerrarDialogFormularioGeneral110=function(){O.cerrarPopup(O.idModalFormularioGeneral110)},O.abrirDialogArchivosTXT=function(){O.abrirPopup(O.idModalArchivosTXT)},O.cerrarDialogArchivosTXT=function(){O.cerrarPopup(O.idModalArchivosTXT)},O.obtenerParametros(O.usuario.id_empresa)}]);