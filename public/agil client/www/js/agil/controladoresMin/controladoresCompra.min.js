angular.module("agil.controladores").controller("ControladorCompras",["$scope","$localStorage","$location","$templateCache","$route","blockUI","DatosCompra","$timeout","Compra","Compras","Proveedores","ProveedoresNit","ListaProductosEmpresaUsuario","ClasesTipo","CompraDatos","ConfiguracionCompraVistaDatos","ConfiguracionCompraVista","ConfiguracionesCuentasEmpresa","ClasesTipoEmpresa","Tipos","SaveCompra","ListaCompraPedidosEmpresa","EliminarPedidoEmpresa","EliminarDetallePedidoEmpresa",function(u,e,o,a,t,C,r,i,n,p,c,l,s,d,m,v,f,g,_,P,E,b,x,h){C.start(),u.usuario=JSON.parse(e.usuario),u.idModalPago="dialog-pago",u.idModalWizardCompraEdicion="modal-wizard-compra-edicion",u.idModalWizardCompraVista="modal-wizard-compra-vista",u.idModalEliminarCompra="dialog-eliminar-compra",u.idModalContenedorCompraEdicion="modal-wizard-container-compra-edicion",u.idModalContenedorCompraVista="modal-wizard-container-compra-vista",u.idInputCompletar="nit",u.idModalServicios="dialog-servicios",u.idModalPedidos="dialog-pedidos",u.idModalDetallePedidos="dialog-detalle-pedidos",u.idModalEliminarPedido="dialog-eliminar-pedido",u.idModalEliminarProductoPedido="dialog-eliminar-producto-pedido",u.url=restServer+"/proveedores/empresa/"+u.usuario.id_empresa+"/texto/",u.inicio=function(){u.esContado=!0,u.obtenerProveedores(),u.obtenerTiposDePago(),u.obtenerConfiguracionCompraVista(),u.obtenerCentrosDeCosto(),u.sucursales=u.obtenerSucursales(),u.obtenerCompras(),u.busquedaProductoHabilidato=!1,u.usuario.empresa.usar_funciones_erp&&(u.obtenerMovimientosIngreso(),u.obtenerconfiuracionCuentas()),u.detalleCompra={producto:{},centroCosto:{},cantidad:1,descuento:0,recargo:0,ice:0,excento:0,tipo_descuento:!1,tipo_recargo:!1}},u.obtenerconfiuracionCuentas=function(){var e=g(u.usuario.id_empresa);u.plantilla={retencionServicios:{it:{},iue:{},servicio:{}},retencionBienesGasto:{it:{},iue:{},gasto:{}},retencionBienes:{it:{},iue:{},almacen:{}},egreso:{ivacf:{},cajaBanco:{}},ingreso:{ivadf:{},it:{},itPorPagar:{},cajaBanco:{}}},e.then(function(e){e.lista.forEach(function(e){u.diccionario.IVA_DF==e.nombre&&(u.plantilla.ingreso.ivadf={porsentaje:parseFloat(e.valor),cuenta:e.cuenta}),u.diccionario.IT==e.nombre&&(u.plantilla.ingreso.it={porsentaje:parseFloat(e.valor),cuenta:e.cuenta}),u.diccionario.IT_POR_PAGAR==e.nombre&&(u.plantilla.ingreso.itPorPagar={porsentaje:parseFloat(e.valor),cuenta:e.cuenta}),u.diccionario.CAJA_BANCOS==e.nombre&&(u.plantilla.ingreso.cajaBanco={porsentaje:parseFloat(e.valor),cuenta:e.cuenta}),u.diccionario.IVA_CF==e.nombre&&(u.plantilla.egreso.ivacf={porsentaje:parseFloat(e.valor),cuenta:e.cuenta}),u.diccionario.CAJA_BANCOS==e.nombre&&(u.plantilla.egreso.cajaBanco={porsentaje:parseFloat(e.valor),cuenta:e.cuenta}),u.diccionario.IT_RETENCION_BIEN==e.nombre&&(u.plantilla.retencionBienes.it={porsentaje:parseFloat(e.valor),cuenta:e.cuenta}),u.diccionario.IUE_RETENCION_BIEN==e.nombre&&(u.plantilla.retencionBienes.iue={porsentaje:parseFloat(e.valor),cuenta:e.cuenta}),u.diccionario.CUENTA_ALMACEN_RETENCION_BIEN==e.nombre&&(u.plantilla.retencionBienes.almacen={porsentaje:parseFloat(e.valor),cuenta:e.cuenta}),u.diccionario.IT_RETENCION_BIEN_GASTO==e.nombre&&(u.plantilla.retencionBienesGasto.it={porsentaje:parseFloat(e.valor),cuenta:e.cuenta}),u.diccionario.IUE_RETENCION_BIEN_GASTO==e.nombre&&(u.plantilla.retencionBienesGasto.iue={porsentaje:parseFloat(e.valor),cuenta:e.cuenta}),u.diccionario.CUENTA_GASTO_RETENCION_BIEN==e.nombre&&(u.plantilla.retencionBienesGasto.gasto={porsentaje:parseFloat(e.valor),cuenta:e.cuenta}),u.diccionario.IT_RETENCION_SERVICIO==e.nombre&&(u.plantilla.retencionServicios.it={porsentaje:parseFloat(e.valor),cuenta:e.cuenta}),u.diccionario.IUE_RETENCION_SERVICIO==e.nombre&&(u.plantilla.retencionServicios.iue={porsentaje:parseFloat(e.valor),cuenta:e.cuenta}),u.diccionario.CUENTA_RETENCION_SERVICIO==e.nombre&&(u.plantilla.retencionServicios.servicio={porsentaje:parseFloat(e.valor),cuenta:e.cuenta})},this)})},u.obtenerConfiguracionCompraVista=function(){C.start(),v(u.usuario.id_empresa).then(function(e){u.configuracionCompraVista=e,C.stop()})},u.guardarConfiguracionCompraVista=function(){f.update({id_empresa:u.usuario.id_empresa},u.configuracionCompraVista,function(e){})},u.obtenerTiposDePago=function(){C.start(),d("TIPA").then(function(e){u.tiposPago=e.clases,C.stop()})},u.obtenerCentrosDeCosto=function(){C.start(),d("CCO").then(function(e){if(u.centrosCosto=e.clases,u.usuario.empresa.usar_funciones_erp){var t=[];u.centrosCosto.forEach(function(e,o,a){"ALM"==e.nombre_corto||"VR"==e.nombre_corto||t.push(o)}),t.reverse().forEach(function(e,o,a){u.centrosCosto.splice(e,1)})}C.stop()})},u.obtenerProveedores=function(){c(u.usuario.id_empresa).then(function(e){for(var o=0;o<e.length;o++)e[o].nit=e[o].nit.toString();u.proveedores=e})},u.modificarCompra=function(e){m(e.id).then(function(e){""!=e.observacion&&(e.usarObservacion=!0),u.compra=e,u.compra.fecha=new Date(u.compra.fecha),u.compra.fechaTexto=u.compra.fecha.getDate()+"/"+(u.compra.fecha.getMonth()+1)+"/"+u.compra.fecha.getFullYear(),null==u.compra.sucursal&&(u.compra.sucursal=e.almacen.sucursal),null==u.compra.movimiento&&(u.compra.movimiento={clase:{}},u.compra.movimiento.clase=u.compra.tipoMovimiento),u.compra.movimiento.clase.nombre==u.diccionario.MOVING_POR_RETENCION_BIENES||u.compra.movimiento.clase.nombre==u.diccionario.MOVING_POR_RETENCION_SERVICIOS?(u.configuracionCompraVista.mostrar_it_retencion=!0,u.configuracionCompraVista.mostrar_iue=!0,u.configuracionCompraVista.mostrar_pagado=!0):(u.configuracionCompraVista.mostrar_it_retencion=!1,u.configuracionCompraVista.mostrar_iue=!1,u.configuracionCompraVista.mostrar_pagado=!1),u.obtenerAlmacenes(u.compra.sucursal.id),u.cambiarTipoPago(u.compra.tipoPago),u.usuario.empresa.usar_vencimientos&&u.compra.usar_producto&&u.aplicarFechaTextoDetalleCompra(u.compra),u.abrirPopup(u.idModalWizardCompraEdicion)})},u.aplicarFechaTextoDetalleCompra=function(e){for(var o=0;o<e.detallesCompra.length;o++)"ALM"==e.detallesCompra[o].centroCosto.nombre_corto&&(e.detallesCompra[o].inventario.fecha_vencimiento=new Date(e.detallesCompra[o].inventario.fecha_vencimiento),e.detallesCompra[o].inventario.fechaVencimientoTexto=e.detallesCompra[o].inventario.fecha_vencimiento.getDate()+"/"+(e.detallesCompra[o].inventario.fecha_vencimiento.getMonth()+1)+"/"+e.detallesCompra[o].inventario.fecha_vencimiento.getFullYear())},u.buscarProveedor=function(e){if(""!=e&&null!=e)return l(u.usuario.id_empresa,e)},u.establecerProveedor=function(e){u.compra.proveedor=e},u.buscarProducto=function(e){if(""!=e&&null!=e&&u.busquedaProductoHabilidato)return s(u.usuario.id_empresa,e,u.usuario.id,u.compra.almacen.id)},u.verificarProducto=function(e){e.centroCosto.nombre.nombre==u.diccionario.CENTRO_COSTO_ALMACEN?e.producto.id?(null!=u.compra.movimiento.clase&&u.compra.movimiento.clase.nombre==u.diccionario.MOVING_POR_RETENCION_BIENES&&(e.descuento=0,e.ice=0,e.recargo=0,e.excento=0,u.configuracionCompraVista.mostrar_it_retencion=!0,u.configuracionCompraVista.mostrar_iue=!0,u.configuracionCompraVista.mostrar_pagado=!0),u.agregarDetalleCompra(e)):u.mostrarMensaje("El producto no se encuentra en el catalogo"):(null!=u.compra.movimiento.clase&&u.compra.movimiento.clase.nombre==u.diccionario.MOVING_POR_RETENCION_BIENES&&(e.descuento=0,e.ice=0,e.recargo=0,e.excento=0,u.configuracionCompraVista.mostrar_it_retencion=!0,u.configuracionCompraVista.mostrar_iue=!0,u.configuracionCompraVista.mostrar_pagado=!0),u.agregarDetalleCompra(e))},u.verificarServicio=function(e){e.servicio.id?(null!=u.compra.movimiento.clase&&u.compra.movimiento.clase.nombre==u.diccionario.MOVING_POR_RETENCION_SERVICIOS&&(e.descuento=0,e.ice=0,e.recargo=0,e.excento=0,u.configuracionCompraVista.mostrar_it_retencion=!0,u.configuracionCompraVista.mostrar_iue=!0,u.configuracionCompraVista.mostrar_pagado=!0),u.agregarDetalleCompraServicio(e)):u.mostrarMensaje("El producto no se encuentra en el catalogo")},u.agregarDetalleCompra=function(e){if(e.producto.nombre.id&&(e.producto=e.producto.nombre),e.centroCosto.nombre.id)e.centroCosto=e.centroCosto.nombre;else if(e.centroCosto.nombre==u.diccionario.CENTRO_COSTO_ALMACEN){var o=$.grep(u.centrosCosto,function(e){return e.nombre==u.diccionario.CENTRO_COSTO_ALMACEN})[0];e.centroCosto=o}e.fechaVencimientoTexto&&(e.fecha_vencimiento=new Date(u.convertirFecha(e.fechaVencimientoTexto))),u.compra.detallesCompra.push(e),u.sumarTotal(),u.sumarTotalImporte(),u.compra.descuento_general&&u.calcularImporteGeneral(),u.compra.tipoPago.nombre==u.diccionario.TIPO_PAGO_CREDITO?u.calcularSaldo():(u.compra.a_cuenta=null,u.compra.saldo=null,u.compra.dias_credito=null),u.detalleCompra={producto:{},centroCosto:{},cantidad:1,descuento:0,recargo:0,ice:0,excento:0,tipo_descuento:!1,tipo_recargo:!1},u.enfocar("centro_costo")},u.agregarDetalleCompraServicio=function(e){u.compra.detallesCompra.push(e),u.sumarTotal(),u.sumarTotalImporte(),u.compra.descuento_general&&u.calcularImporteGeneral(),u.compra.tipoPago.nombre==u.diccionario.TIPO_PAGO_CREDITO?u.calcularSaldo():(u.compra.a_cuenta=null,u.compra.saldo=null,u.compra.dias_credito=null),u.detalleCompra={producto:{},centroCosto:{},cantidad:1,descuento:0,recargo:0,ice:0,excento:0,tipo_descuento:!1,tipo_recargo:!1},u.enfocar("centro_costo")},u.eliminarDetalleCompra=function(e){u.compra.id?e.eliminado=!0:u.compra.detallesCompra.splice(u.compra.detallesCompra.indexOf(e),1),u.sumarTotal(),u.sumarTotalImporte(),u.compra.descuento_general&&u.calcularImporteGeneral(),u.compra.tipoPago.nombre==u.diccionario.TIPO_PAGO_CREDITO?u.calcularSaldo():(u.compra.a_cuenta=null,u.compra.saldo=null,u.compra.dias_credito=null)},u.cambiarTipoPago=function(o){o=$.grep(u.tiposPago,function(e){return e.id==o.id})[0];u.esContado="CONT"==o.nombre_corto,u.compra.id_tipo_pago=o.id,u.esContado?(u.compra.a_cuenta=null,u.compra.saldo=null,u.compra.dias_credito=null):u.calcularSaldo()},u.recalcular=function(){u.calcularImporteGeneral(),u.calcularImporte()},u.calcularImporteGeneral=function(){var e,o;e=u.compra.tipo_descuento?u.compra.importe*(u.compra.descuento/100):u.compra.descuento,o=u.compra.tipo_recargo?u.compra.importe*(u.compra.recargo/100):u.compra.recargo,u.compra.total=Math.round(1e3*(u.compra.importe-e+o-u.compra.ice-u.compra.excento))/1e3},u.calcularImportePedido=function(e){var o,a;e.importe=Math.round(e.cantidad*e.costo_unitario*1e3)/1e3,u.compra.movimiento.clase.nombre==u.diccionario.MOVING_POR_RETENCION_BIENES?u.compra.tipo_retencion?e.centroCosto.nombre.nombre==u.diccionario.CENTRO_COSTO_ALMACEN?(e.total=e.importe,e.importe=e.total*(u.plantilla.retencionBienes.it.porsentaje+u.plantilla.retencionBienes.iue.porsentaje)/(100-(u.plantilla.retencionBienes.it.porsentaje+u.plantilla.retencionBienes.iue.porsentaje))+e.total,e.it=e.importe*u.plantilla.retencionBienes.it.porsentaje/100,e.iue=e.importe*u.plantilla.retencionBienes.iue.porsentaje/100):(e.total=e.importe,e.importe=e.total*(u.plantilla.retencionBienesGasto.it.porsentaje+u.plantilla.retencionBienesGasto.iue.porsentaje)/(100-(u.plantilla.retencionBienesGasto.it.porsentaje+u.plantilla.retencionBienesGasto.iue.porsentaje))+e.total,e.it=e.importe*u.plantilla.retencionBienesGasto.it.porsentaje/100,e.iue=e.importe*u.plantilla.retencionBienesGasto.iue.porsentaje/100):e.centroCosto.nombre.nombre==u.diccionario.CENTRO_COSTO_ALMACEN?(e.it=e.importe*u.plantilla.retencionBienes.it.porsentaje/100,e.iue=e.importe*u.plantilla.retencionBienes.iue.porsentaje/100,e.total=e.importe*u.plantilla.retencionBienes.almacen.porsentaje/100):(e.it=e.importe*u.plantilla.retencionBienesGasto.it.porsentaje/100,e.iue=e.importe*u.plantilla.retencionBienesGasto.iue.porsentaje/100,e.total=e.importe*u.plantilla.retencionBienesGasto.gasto.porsentaje/100):u.compra.movimiento.clase.nombre==u.diccionario.MOVING_POR_IMPORTACION?e.total=e.importe:u.compra.movimiento.clase.nombre==u.diccionario.MOVING_POR_RETENCION_SERVICIOS?u.compra.tipo_retencion?(e.total=e.importe,e.importe=e.total*(u.plantilla.retencionServicios.it.porsentaje+u.plantilla.retencionServicios.iue.porsentaje)/(100-(u.plantilla.retencionServicios.it.porsentaje+u.plantilla.retencionServicios.iue.porsentaje))+e.total,e.it=e.importe*u.plantilla.retencionServicios.it.porsentaje/100,e.iue=e.importe*u.plantilla.retencionServicios.iue.porsentaje/100):(e.it=e.importe*u.plantilla.retencionServicios.it.porsentaje/100,e.iue=e.importe*u.plantilla.retencionServicios.iue.porsentaje/100,e.total=e.importe*u.plantilla.retencionServicios.servicio.porsentaje/100):u.compra.descuento_general?(o=u.compra.tipo_descuento?e.importe*(u.compra.descuento/100):u.compra.descuento,a=u.compra.tipo_recargo?e.importe*(u.compra.recargo/100):u.compra.recargo,e.total=e.importe-o+a-u.compra.ice-u.compra.excento):(o=e.tipo_descuento?e.importe*(e.descuento/100):e.descuento,a=e.tipo_recargo?e.importe*(e.recargo/100):e.recargo,e.total=e.importe-o+a-e.ice-e.excento)},u.calcularImporte=function(){var e,o;u.detalleCompra.importe=Math.round(u.detalleCompra.cantidad*u.detalleCompra.costo_unitario*1e3)/1e3,u.compra.movimiento.clase.nombre==u.diccionario.MOVING_POR_RETENCION_BIENES?u.compra.tipo_retencion?u.detalleCompra.centroCosto.nombre.nombre==u.diccionario.CENTRO_COSTO_ALMACEN?(u.detalleCompra.total=u.detalleCompra.importe,u.detalleCompra.importe=u.detalleCompra.total*(u.plantilla.retencionBienes.it.porsentaje+u.plantilla.retencionBienes.iue.porsentaje)/(100-(u.plantilla.retencionBienes.it.porsentaje+u.plantilla.retencionBienes.iue.porsentaje))+u.detalleCompra.total,u.detalleCompra.it=u.detalleCompra.importe*u.plantilla.retencionBienes.it.porsentaje/100,u.detalleCompra.iue=u.detalleCompra.importe*u.plantilla.retencionBienes.iue.porsentaje/100):(u.detalleCompra.total=u.detalleCompra.importe,u.detalleCompra.importe=u.detalleCompra.total*(u.plantilla.retencionBienesGasto.it.porsentaje+u.plantilla.retencionBienesGasto.iue.porsentaje)/(100-(u.plantilla.retencionBienesGasto.it.porsentaje+u.plantilla.retencionBienesGasto.iue.porsentaje))+u.detalleCompra.total,u.detalleCompra.it=u.detalleCompra.importe*u.plantilla.retencionBienesGasto.it.porsentaje/100,u.detalleCompra.iue=u.detalleCompra.importe*u.plantilla.retencionBienesGasto.iue.porsentaje/100):u.detalleCompra.centroCosto.nombre.nombre==u.diccionario.CENTRO_COSTO_ALMACEN?(u.detalleCompra.it=u.detalleCompra.importe*u.plantilla.retencionBienes.it.porsentaje/100,u.detalleCompra.iue=u.detalleCompra.importe*u.plantilla.retencionBienes.iue.porsentaje/100,u.detalleCompra.total=u.detalleCompra.importe*u.plantilla.retencionBienes.almacen.porsentaje/100):(u.detalleCompra.it=u.detalleCompra.importe*u.plantilla.retencionBienesGasto.it.porsentaje/100,u.detalleCompra.iue=u.detalleCompra.importe*u.plantilla.retencionBienesGasto.iue.porsentaje/100,u.detalleCompra.total=u.detalleCompra.importe*u.plantilla.retencionBienesGasto.gasto.porsentaje/100):u.compra.movimiento.clase.nombre==u.diccionario.MOVING_POR_IMPORTACION?u.detalleCompra.total=u.detalleCompra.importe:u.compra.movimiento.clase.nombre==u.diccionario.MOVING_POR_RETENCION_SERVICIOS?u.compra.tipo_retencion?(u.detalleCompra.total=u.detalleCompra.importe,u.detalleCompra.importe=u.detalleCompra.total*(u.plantilla.retencionServicios.it.porsentaje+u.plantilla.retencionServicios.iue.porsentaje)/(100-(u.plantilla.retencionServicios.it.porsentaje+u.plantilla.retencionServicios.iue.porsentaje))+u.detalleCompra.total,u.detalleCompra.it=u.detalleCompra.importe*u.plantilla.retencionServicios.it.porsentaje/100,u.detalleCompra.iue=u.detalleCompra.importe*u.plantilla.retencionServicios.iue.porsentaje/100):(u.detalleCompra.it=u.detalleCompra.importe*u.plantilla.retencionServicios.it.porsentaje/100,u.detalleCompra.iue=u.detalleCompra.importe*u.plantilla.retencionServicios.iue.porsentaje/100,u.detalleCompra.total=u.detalleCompra.importe*u.plantilla.retencionServicios.servicio.porsentaje/100):u.compra.descuento_general?(e=u.compra.tipo_descuento?u.detalleCompra.importe*(u.compra.descuento/100):u.compra.descuento,o=u.compra.tipo_recargo?u.detalleCompra.importe*(u.compra.recargo/100):u.compra.recargo,u.detalleCompra.total=u.detalleCompra.importe-e+o-u.compra.ice-u.compra.excento):(e=u.detalleCompra.tipo_descuento?u.detalleCompra.importe*(u.detalleCompra.descuento/100):u.detalleCompra.descuento,o=u.detalleCompra.tipo_recargo?u.detalleCompra.importe*(u.detalleCompra.recargo/100):u.detalleCompra.recargo,u.detalleCompra.total=u.detalleCompra.importe-e+o-u.detalleCompra.ice-u.detalleCompra.excento)},u.calcularImporteDetalleEdicion=function(e){var o,a;e.importe=Math.round(e.cantidad*e.costo_unitario*1e3)/1e3,o=e.tipo_descuento?e.importe*(e.descuento/100):e.descuento,a=e.tipo_recargo?e.importe*(e.recargo/100):e.recargo,e.total=e.importe-o+a-e.ice-e.excento,u.sumarTotal(),u.sumarTotalImporte(),u.compra.descuento_general&&u.calcularImporteGeneral(),u.compra.tipoPago.nombre==u.diccionario.TIPO_PAGO_CREDITO?u.calcularSaldo():(u.compra.a_cuenta=null,u.compra.saldo=null,u.compra.dias_credito=null)},u.sumarMonto=function(e){for(var o=0,a=0;a<e.length;a++)o+=e[a].total;return Math.round(100*o)/100},u.sumarTotalImporte=function(){for(var e=0,o=0;o<u.compra.detallesCompra.length;o++)u.compra.detallesCompra[o].eliminado||(e+=u.compra.detallesCompra[o].importe);u.compra.importe=Math.round(1e3*e)/1e3},u.sumarTotal=function(){for(var e=0,o=0;o<u.compra.detallesCompra.length;o++)u.compra.detallesCompra[o].eliminado||(e+=u.compra.detallesCompra[o].total);u.compra.total=Math.round(1e3*e)/1e3},u.calcularSaldo=function(){u.compra.saldo=u.compra.total-u.compra.a_cuenta},u.obtenerSucursales=function(){for(var e=[],o=0;o<u.usuario.sucursalesUsuario.length;o++)e.push(u.usuario.sucursalesUsuario[o].sucursal);return e},u.mostrarDescuentos=function(){"none"==$(".des-datos").css("display")?$(".des-datos").css("display",""):$(".des-datos").css("display","none")},u.enfocar=function(e){i(function(){$("#"+e).focus()},0)},u.interceptarTecla=function(e,o,a){13===e.which&&(a?u.enfocar(o):i(function(){$("#"+o).trigger("click")},0))},u.obtenerMovimientosIngreso=function(e){C.start(),d("MOVING").then(function(e){u.movimientosIngreso=e.clases;var t=[];u.movimientosIngreso.forEach(function(e,o,a){e.nombre!==u.diccionario.MOVING_INVENTARIO_INICIAL&&e.nombre!==u.diccionario.MOVING_POR_TRASPASO&&e.nombre!==u.diccionario.MOVING_POR_DEVOLUCION&&e.nombre!==u.diccionario.MOVING_POR_AJUSTE||t.push(o)}),t.reverse().forEach(function(e){u.movimientosIngreso.splice(e,1)}),C.stop()})},u.verificarMomivmiento=function(e){e.movimiento.clase.nombre==u.diccionario.MOVING_POR_RETENCION_SERVICIOS?e.usar_producto=!1:e.movimiento.clase.nombre==u.diccionario.MOVING_POR_RETENCION_BIENES?e.usar_producto=!0:e.movimiento.clase.nombre==u.diccionario.MOVING_POR_IMPORTACION&&(e.factura=0,e.autorizacion=3,e.codigo_control=0,e.descuento_general=!1,e.usar_producto=!0)},u.obtenerAlmacenes=function(o){u.almacenes=[];var e=$.grep(u.sucursales,function(e){return e.id==o})[0];u.almacenes=e.almacenes,null==u.compra.id&&(u.compra.almacen=1==u.almacenes.length?u.almacenes[0]:null)},u.$on("$viewContentLoaded",function(){resaltarPestaña(o.path().substring(1)),ejecutarScriptsCompra(u.idModalWizardCompraEdicion,u.idModalWizardCompraVista,u.idModalEliminarCompra,u.idModalContenedorCompraEdicion,u.idModalContenedorCompraVista,u.idInputCompletar,u.url,u.idModalPago,u.idModalServicios,u.idModalPedidos,u.idModalDetallePedidos,u.idModalEliminarPedido,u.idModalEliminarProductoPedido),u.buscarAplicacion(u.usuario.aplicacionesUsuario,o.path().substring(1)),$("#formularioCompra").ketchup({validateEvents:"blur focus keyup change submit"}),C.stop()}),u.formatearCodigoControl=function(e){for(var o="",a=0;a<e.length;a++)a%2==0&&(o+=e.substring(a,a+2),2<e.length-a&&(o+="-"));return o},u.obtenerCompras=function(){u.sucursalesUsuario="";for(var e=0;e<u.usuario.sucursalesUsuario.length;e++)u.sucursalesUsuario=u.sucursalesUsuario+u.usuario.sucursalesUsuario[e].sucursal.id,e+1!=u.usuario.sucursalesUsuario.length&&(u.sucursalesUsuario=u.sucursalesUsuario+",");var o=new Date,a=o.getDate()+"/"+(o.getMonth()+1)+"/"+o.getFullYear();u.filtrarCompras(u.sucursalesUsuario,a,a)},u.filtrarCompras=function(e,o,a,t,r,i,n,c,l,s){t=""==t||null==t?0:t,r=null==r||null==r?0:r,i=null==i||null==i?0:i,n=null==n?0:n,s=null==s?0:s,c=null==c||null==c?0:c,l=0<$.grep(u.usuario.rolesUsuario,function(e){return e.rol.nombre==u.diccionario.ROL_ADMINISTRADOR}).length?""==l||null==l?0:l:u.usuario.nombre_usuario,C.start(),o=new Date(u.convertirFecha(o)),a=new Date(u.convertirFecha(a)),p(e,o,a,t,r,i,n,c,l,u.usuario.id,s).then(function(e){u.compras=e,C.stop()})},u.abrirPopupPago=function(e){u.compra=e,u.pago=null,u.abrirPopup(u.idModalPago)},u.cerrarPopupPago=function(){u.cerrarPopup(u.idModalPago)},u.abrirDialogServicios=function(e){u.tipo_edicion=e,u.clase={},u.abrirPopup(u.idModalServicios)},u.cerrarDialogServicios=function(){u.cerrarPopup(u.idModalServicios)},u.abrirDialogPedidos=function(){u.obtenerPedidosEmpresa(),u.abrirPopup(u.idModalPedidos)},u.cerrarDialogPedidos=function(){u.cerrarPopup(u.idModalPedidos)},u.abrirDialogDetallePedidos=function(e){u.pedido=e,u.cerrarDialogPedidos(),u.obtenerAlmacenes(e.sucursal.id),u.compra.proveedor=e.proveedor,u.compra.almacen=e.almacen,u.compra.sucursal=e.sucursal,u.pedido.detallesPedido.forEach(function(e){var o=0;0<e.producto.inventarios.length&&(o=e.producto.inventarios[e.producto.inventarios.length-1].costo_unitario?e.producto.inventarios[e.producto.inventarios.length-1].costo_unitario:0),e.producto.costoanterior=o,u.establecerProductoPedido(e,e.producto,o)}),u.abrirPopup(u.idModalDetallePedidos)},u.guardarDetalleCompraDePedido=function(e){u.compra.generado_por_pedido=!0,u.compra.pedido=u.pedido,e.forEach(function(e){1!=e.eliminado&&u.verificarProducto(e.detalleCompra)}),u.cerrarDialogDetallePedidos()},u.establecerProductoPedido=function(t,r,i){r.tipoProducto=null==r.tipoProducto?{id:r["tipoProducto.id"],nombre:r["tipoProducto.nombre"],nombre_corto:r["tipoProducto.nombre_corto"]}:r.tipoProducto;var n={};u.centrosCosto.forEach(function(e,o,a){"ALM"==e.nombre_corto&&(n=e),o===a.length-1&&(t.detalleCompra={centroCosto:n,producto:r,costo_unitario:i,cantidad:1,descuento:r.descuento,recargo:0,ice:0,excento:0,tipo_descuento:0<r.descuento,tipo_recargo:!1})}),u.cerrarPopup(u.idModalInventario),u.enfocar("cantidad")},u.cerrarDialogDetallePedidos=function(){u.cerrarPopup(u.idModalDetallePedidos)},u.cerrarDialogEliminarPedido=function(){u.cerrarPopup(u.idModalEliminarPedido)},u.abrirDialogEliminarPedido=function(e){u.pedido=e,u.abrirPopup(u.idModalEliminarPedido)},u.cerrarDialogEliminarDetallePedido=function(){u.cerrarPopup(u.idModalEliminarProductoPedido)},u.abrirDialogEliminarDetallePedido=function(e){u.detalle=e,u.abrirPopup(u.idModalEliminarProductoPedido)},u.obtenerPedidosEmpresa=function(){b(u.usuario.id_empresa).then(function(e){u.pedidos=e.pedidos})},u.obtenerServicios=function(){C.start(),_("SERVICIOS_COMPRA",u.usuario.id_empresa).then(function(e){u.datosServicios=e,C.stop()})},u.agregarConceptoEdicion=function(e){e.nombre&&e.nombre_corto&&(-1==u.tipo_edicion.clases.indexOf(e)&&u.tipo_edicion.clases.push(e),u.clase={})},u.modificarConceptoEdicion=function(e){u.clase=e},u.removerConceptoEdicion=function(e){e.eliminado=!0},u.guardarConceptoEdicion=function(o){C.start(),P.update({id_tipo:o.id},o,function(e){d(o.nombre_corto).then(function(e){o=e,C.stop(),u.cerrarDialogServicios(),u.mostrarMensaje("Guardado Exitosamente!")})})},u.efectuarPago=function(o){C.start(),n.update({id:u.compra.id},{pago:o,id_usuario_cajero:u.usuario.id},function(e){u.mostrarMensaje(e.mensaje),u.cerrarPopup(u.idModalPago),u.obtenerCompras(),u.imprimirRecibo(e,e.compra,o),C.stop()},function(e){u.mostrarMensaje(e),u.cerrarPopup(u.idModalPago),u.obtenerCompras(),C.stop()})},u.imprimirRecibo=function(e,o,a){C.start();var t=new PDFDocument({size:[227,353],margin:10}),r=t.pipe(blobStream());t.moveDown(2),t.font("Helvetica-Bold",8),t.text(u.usuario.empresa.razon_social.toUpperCase(),{align:"center"}),t.moveDown(.4),t.font("Helvetica",7),t.text(o.almacen.sucursal.nombre.toUpperCase(),{align:"center"}),t.moveDown(.4),t.text(o.almacen.sucursal.direccion.toUpperCase(),{align:"center"}),t.moveDown(.4);var i=(null!=o.almacen.sucursal.telefono1?o.almacen.sucursal.telefono1:"")+(null!=o.almacen.sucursal.telefono2?"-"+o.almacen.sucursal.telefono2:"")+(null!=o.almacen.sucursal.telefono3?"-"+o.almacen.sucursal.telefono3:"");t.text("TELF.: "+i,{align:"center"}),t.moveDown(.4),t.text("COCHABAMBA - BOLIVIA",{align:"center"}),t.moveDown(.5),t.font("Helvetica-Bold",8),t.text("PAGO",{align:"center"}),t.font("Helvetica",7),t.moveDown(.4),t.text("------------------------------------",{align:"center"}),t.moveDown(.4),t.moveDown(.4),t.text(o.almacen.sucursal.nota_recibo_correlativo,{align:"center"}),t.moveDown(.4),t.moveDown(.4),t.text("------------------------------------",{align:"center"}),t.moveDown(.4),t.moveDown(.6);var n=new Date;t.text("FECHA : "+n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear(),{align:"left"}),t.moveDown(.4),t.text("Pagado a : "+u.compra.proveedor.razon_social,{align:"left"}),t.moveDown(.4),t.text("---------------------------------------------------------------------------------",{align:"center"}),t.moveDown(.2),t.text("       CONCEPTO                                   ",{align:"left"}),t.moveDown(.2),t.text("---------------------------------------------------------------------------------",{align:"center"}),t.moveDown(.4),o.fecha=new Date(o.fecha),t.text("Fecha: "+o.fecha.getDate()+"/"+(o.fecha.getMonth()+1)+"/"+o.fecha.getFullYear(),15,210);var c=u.compra.factura;t.text(c,105,210,{width:100}),t.text("Bs "+a+".-",170,210,{width:100}),t.text("--------------",10,230,{align:"right"}),t.moveDown(.3),t.text("TOTAL Bs.              "+a.toFixed(2),{align:"right"}),t.moveDown(.4),t.moveDown(.4),t.text("SON: "+e.pago,{align:"left"}),t.moveDown(.6),t.moveDown(.4),t.moveDown(.4),t.moveDown(.4),t.moveDown(.4),t.moveDown(.4),t.moveDown(.4),t.moveDown(.4),t.moveDown(.4),t.moveDown(.4),t.moveDown(.4),t.moveDown(.4),t.moveDown(.4),t.moveDown(.4),t.text("-------------------------                       -------------------------",{align:"center"}),t.text("ENTREGUE CONFORME            RECIBI CONFORME",{align:"center"}),t.end(),r.on("finish",function(){var e=r.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),C.stop()},u.establecerCentroCosto=function(e){console.log(e),(e.nombre?e.nombre:e)==u.diccionario.CENTRO_COSTO_ALMACEN?u.busquedaProductoHabilidato=!0:u.busquedaProductoHabilidato=!1},u.crearNuevaCompra=function(){u.obtenerServicios(),u.verDescuento=!1,u.compra=new n({generado_por_pedido:!1,usar_producto:!0,movimiento:{clase:{}},tipo_retencion:!0,id_empresa:u.usuario.id_empresa,id_usuario:u.usuario.id,proveedor:{},id_tipo_pago:u.tiposPago[0].id,tipoPago:u.tiposPago[0],detallesCompra:[],descuento_general:!1,tipo_descuento:!1,codigo_control:0,autorizacion:0,tipo_recargo:!1,descuento:0,recargo:0,ice:0,excento:0}),u.usuario.empresa.usar_funciones_erp&&(u.compra.movimiento.clase=u.movimientosIngreso[0]),u.compra.sucursal=1==u.sucursales.length?u.sucursales[0]:null,u.compra.sucursal&&u.obtenerAlmacenes(u.compra.sucursal.id);var e=new Date;u.compra.fechaTexto=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear(),u.abrirPopup(u.idModalWizardCompraEdicion),u.enfocar("nit")},u.verCompra=function(e){u.compra=e,u.abrirPopup(u.idModalWizardCompraVista)},u.cerrarPopupVista=function(){u.cerrarPopup(u.idModalWizardCompraVista)},u.cerrarPopupEdicion=function(){u.ocultarMensajesValidacion(),u.cerrarPopup(u.idModalWizardCompraEdicion)},u.verificarDescuentos=function(e){for(var o=!1,a=0;a<e.length;a++)(0<e[a].descuento||0<e[a].recargo||0<e[a].ice||0<e[a].excento)&&(o=!0);return o},u.dibujarCabeceraImpresionCompra=function(e,o,a,t,r){100<u.usuario.empresa.imagen.length&&e.image(u.usuario.empresa.imagen,60,50,{width:50,height:50}),e.font("Helvetica-Bold",8),e.text(u.usuario.empresa.razon_social.toUpperCase(),60,105),e.font("Helvetica",7),e.text(o.sucursal.nombre.toUpperCase(),60,113),e.text(o.sucursal.direccion.toUpperCase(),60,121);var i=(null!=o.sucursal.telefono1?o.sucursal.telefono1:"")+(null!=o.sucursal.telefono2?"-"+o.sucursal.telefono2:"")+(null!=o.sucursal.telefono3?"-"+o.sucursal.telefono3:"");e.text("TELF.: "+i,60,129),e.text("COCHABAMBA - BOLIVIA",60,137),e.font("Helvetica-Bold",16),e.text("NOTA DE COMPRA",150,50),e.font("Helvetica-Bold",8),e.rect(380,50,190,50).stroke(),e.text("NIT : ",390,60),e.text("FACTURA No : ",390,70),e.text("AUTORIZACIÓN No : ",390,80),e.text(u.usuario.empresa.nit,500,60),e.text(o.factura,500,70),e.text(o.autorizacion,500,80),e.rect(50,150,540,50).stroke(),e.text("FECHA : ",60,165),e.text("SEÑOR(ES) : ",60,175),e.text("NIT : ",360,165),e.text(o.fechaTexto,120,165),e.text(o.proveedor.razon_social,120,175),e.text(o.proveedor.nit,400,165),e.rect(50,200,540,25).stroke(),e.rect(50,225,540,449).stroke(),r?u.usuario.empresa.usar_vencimientos?(e.font("Helvetica-Bold",7),e.text("CODIGO",55,210),e.text("CANT.",105,210),e.text("UNID.",135,210),e.text("DETALLE",170,210),e.text("P. UNIT.",280,210),e.text("IMPORTE",315,210),e.text("DESC.",365,210),e.text("REC.",395,210),e.text("ICE",425,210),e.text("EXC.",455,210),e.text("F. VENC.",485,210,{width:50}),e.text("LOTE",525,210),e.text("TOTAL",555,210)):(e.font("Helvetica-Bold",8),e.text("CODIGO",55,210),e.text("CANT.",105,210),e.text("UNID.",135,210),e.text("DETALLE",170,210),e.text("P. UNIT.",300,210),e.text("IMPORTE",335,210),e.text("DESC.",385,210),e.text("REC.",420,210),e.text("ICE",455,210),e.text("EXC.",490,210),e.text("TOTAL",520,210)):(e.font("Helvetica-Bold",8),e.text("CODIGO",55,210),e.text("CANT.",135,210),e.text("UNID.",165,210),u.usuario.empresa.usar_vencimientos?(e.text("DETALLE",210,210),e.text("FECHA VENC.",400,205,{width:50}),e.text("LOTE",450,210)):e.text("DETALLE",210,210),e.text("P.UNIT.",495,210),e.text("TOTAL",540,210)),e.font("Helvetica",6);var n=new Date;e.text("Usuario: "+u.usuario.nombre_usuario+"   Fecha:"+n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear()+"   Hr:"+n.getHours()+":"+n.getMinutes(),50,750)},u.imprimirCompra=function(m){r(m.id,u.usuario.id_empresa).then(function(e){(m=e.compra).sucursal=e.sucursal,m.numero_literal=e.numero_literal,m.fecha=new Date(m.fecha),m.fechaTexto=m.fecha.getDate()+"/"+(m.fecha.getMonth()+1)+"/"+m.fecha.getFullYear(),m.configuracion=e.configuracion;var o=new PDFDocument({size:[612,792],margin:10}),a=o.pipe(blobStream()),t=240,r=0,i=0,n=1,c=Math.ceil(m.detallesCompra.length/15),l=u.verificarDescuentos(m.detallesCompra);u.dibujarCabeceraImpresionCompra(o,m,n,c,l);t=240;for(var s=0;s<m.detallesCompra.length;s++){if(l)if(u.usuario.empresa.usar_vencimientos){o.font("Helvetica",7);var p=(d=m.detallesCompra[s].producto.codigo.length)<=11?t:11<d&&d<=22?t-4:t-11;m.detallesCompra[s].producto&&o.text(m.detallesCompra[s].producto.codigo,55,p,{width:50}),o.text(m.detallesCompra[s].cantidad,110,t),m.detallesCompra[s].producto&&o.text(m.detallesCompra[s].producto.unidad_medida,135,t),m.detallesCompra[s].producto?o.text(m.detallesCompra[s].producto.nombre,170,t-6,{width:130}):o.text(m.detallesCompra[s].servicio.nombre,170,t-6,{width:130}),o.text(m.detallesCompra[s].costo_unitario.toFixed(2),280,t),o.text(m.detallesCompra[s].importe.toFixed(2),315,t),o.text(m.detallesCompra[s].tipo_descuento?"%":"Bs",365,t-10),o.text(m.detallesCompra[s].descuento.toFixed(2),365,t),o.text(m.detallesCompra[s].tipo_recargo?"%":"Bs",395,t-10),o.text(m.detallesCompra[s].recargo.toFixed(2),395,t),o.text(m.detallesCompra[s].ice.toFixed(2),425,t),o.text(m.detallesCompra[s].excento.toFixed(2),455,t),o.text(m.detallesCompra[s].total.toFixed(2),555,t),m.detallesCompra[s].inventario&&(m.detallesCompra[s].inventario.fecha_vencimiento=new Date(m.detallesCompra[s].inventario.fecha_vencimiento),m.detallesCompra[s].inventario.fechaVencimientoTexto=m.detallesCompra[s].inventario.fecha_vencimiento.getDate()+"/"+(m.detallesCompra[s].inventario.fecha_vencimiento.getMonth()+1)+"/"+m.detallesCompra[s].inventario.fecha_vencimiento.getYear(),o.text(m.detallesCompra[s].inventario.fechaVencimientoTexto,485,t),o.text(m.detallesCompra[s].inventario.lote?m.detallesCompra[s].inventario.lote:"",525,t))}else{o.font("Helvetica",8);p=(d=m.detallesCompra[s].producto.codigo.length)<=11?t:11<d&&d<=22?t-4:t-11;m.detallesCompra[s].producto&&o.text(m.detallesCompra[s].producto.codigo,55,p,{width:70}),o.text(m.detallesCompra[s].cantidad,110,t),m.detallesCompra[s].producto&&o.text(m.detallesCompra[s].producto.unidad_medida,135,t),m.detallesCompra[s].producto?o.text(m.detallesCompra[s].producto.nombre,170,t-6,{width:130}):o.text(m.detallesCompra[s].servicio.nombre,170,t-6,{width:130}),o.text(m.detallesCompra[s].costo_unitario.toFixed(2),300,t),o.text(m.detallesCompra[s].importe.toFixed(2),335,t),o.text(m.detallesCompra[s].tipo_descuento?"%":"Bs",385,t-10),o.text(m.detallesCompra[s].descuento.toFixed(2),385,t),o.text(m.detallesCompra[s].tipo_recargo?"%":"Bs",420,t-10),o.text(m.detallesCompra[s].recargo.toFixed(2),420,t),o.text(m.detallesCompra[s].ice.toFixed(2),455,t),o.text(m.detallesCompra[s].excento.toFixed(2),490,t),o.text(m.detallesCompra[s].total.toFixed(2),520,t)}else{if(o.font("Helvetica",8),m.detallesCompra[s].producto&&o.text(m.detallesCompra[s].producto.codigo,55,t,{width:70}),o.text(m.detallesCompra[s].cantidad,140,t),m.detallesCompra[s].producto&&o.text(m.detallesCompra[s].producto.unidad_medida,160,t),m.detallesCompra[s].producto)p=(d=m.detallesCompra[s].producto.nombre.length)<=45?t:45<d&&d<=90?t-4:t-11;else{var d;p=(d=m.detallesCompra[s].servicio.nombre.length)<=45?t:45<d&&d<=90?t-4:t-11}u.usuario.empresa.usar_vencimientos?(m.detallesCompra[s].inventario&&(m.detallesCompra[s].inventario.fecha_vencimiento=new Date(m.detallesCompra[s].inventario.fecha_vencimiento),m.detallesCompra[s].inventario.fechaVencimientoTexto=m.detallesCompra[s].inventario.fecha_vencimiento.getDate()+"/"+(m.detallesCompra[s].inventario.fecha_vencimiento.getMonth()+1)+"/"+m.detallesCompra[s].inventario.fecha_vencimiento.getFullYear(),o.text(m.detallesCompra[s].inventario.fechaVencimientoTexto,400,t),o.text(m.detallesCompra[s].inventario.lote,460,t)),m.detallesCompra[s].producto?o.text(m.detallesCompra[s].producto.nombre,210,p-11.5,{width:185}):o.text(m.detallesCompra[s].servicio.nombre,210,p-11.5,{width:185})):m.detallesCompra[s].producto?o.text(m.detallesCompra[s].producto.nombre,210,p-11.5,{width:225}):o.text(m.detallesCompra[s].servicio.nombre,210,p-11.5,{width:185}),o.text(m.detallesCompra[s].costo_unitario.toFixed(2),500,t),o.text(m.detallesCompra[s].total.toFixed(2),540,t)}o.rect(50,t-15,540,30).stroke(),t+=30,15==++i&&(r+=i)!=m.detallesCompra.length&&(o.addPage({size:[612,792],margin:10}),t=240,i=0,n+=1,u.dibujarCabeceraImpresionCompra(o,m,n,c,l))}o.font("Helvetica-Bold",8),o.text("TOTAL",455,695),o.font("Helvetica",8),o.text(m.total.toFixed(2),520,695),o.text("SON : "+m.numero_literal,55,695),o.text("CÓDIGO DE CONTROL : "+m.codigo_control,55,730),o.rect(50,685,540,30).stroke(),o.rect(50,720,400,20).stroke(),o.end(),a.on("finish",function(){var e=a.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),C.stop()})},u.guardarCompra=function(e,o){if(e){u.ocultarMensajesValidacion(),o.proveedor.nit.id&&(o.proveedor=o.proveedor.nit),o.usar_peps=u.usuario.empresa.usar_peps;var a=new Date;if(o.fecha=new Date(u.convertirFecha(o.fechaTexto)),o.fecha.setHours(a.getHours()),o.fecha.setMinutes(a.getMinutes()),o.fecha.setSeconds(a.getSeconds()),C.start(),o.id)o.esModificacion=!0,n.update({id:o.id},o,function(e){C.stop(),u.cerrarPopPupEdicion(),u.mostrarMensaje(e.mensaje),u.recargarItemsTabla()});else E(o).then(function(e){u.cerrarPopPupEdicion(),u.mostrarMensaje(e.mensaje),u.recargarItemsTabla(),e.compra&&u.imprimirCompra(e.compra)})}},u.establecerProducto=function(e){e.tipoProducto=null==e.tipoProducto?{id:e["tipoProducto.id"],nombre:e["tipoProducto.nombre"],nombre_corto:e["tipoProducto.nombre_corto"]}:e.tipoProducto;var o=u.detalleCompra.centroCosto;u.precio_inventario,0<e.inventarios.length?u.precio_inventario=e.inventarios.pop().costo_unitario+" Bs":u.precio_inventario="Sin histórico",u.detalleCompra={centroCosto:o,producto:e,precio_unitario:e.precio_unitario,cantidad:1,descuento:0,recargo:0,ice:0,excento:0,tipo_descuento:0<e.descuento,tipo_recargo:!1},u.cerrarPopup(u.idModalInventario),u.enfocar("cantidad")},u.verDescuentosPedido=function(){u.verDescuento=0==u.verDescuento},u.establecerServicioSeleccionado=function(e){u.establecerServicio(e),u.cerrarDialogServicios()},u.establecerServicio=function(e){e.tipoProducto=null==e.tipoProducto?{id:e["tipoProducto.id"],nombre:e["tipoProducto.nombre"],nombre_corto:e["tipoProducto.nombre_corto"]}:e.tipoProducto;u.detalleCompra.centroCosto;u.detalleCompra={centroCosto:null,servicio:e,precio_unitario:e.precio_unitario,cantidad:1,descuento:0,recargo:0,ice:0,excento:0,tipo_descuento:!1,tipo_recargo:!1},u.cerrarPopup(u.idModalInventario),u.enfocar("cantidad")},u.cerrarPopPupEdicion=function(){u.cerrarPopup(u.idModalWizardCompraEdicion)},u.generarCompraDePedido=function(e){e.detallesPedido.forEach(function(e,o,a){})},u.EliminarPedido=function(e){x(e.id).then(function(e){u.mostrarMensaje(e.mensaje),u.obtenerPedidosEmpresa(),u.cerrarDialogEliminarPedido()})},u.EliminarPedidoDetalle=function(e){e.eliminado=!0,h(e.id).then(function(e){u.mostrarMensaje(e.mensaje),u.cerrarDialogEliminarDetallePedido()})},u.$on("$routeChangeStart",function(e,o){u.eliminarPopup(u.idModalWizardCompraEdicion),u.eliminarPopup(u.idModalWizardCompraVista),u.eliminarPopup(u.idModalEliminarCompra),u.eliminarPopup(u.idModalPago),u.eliminarPopup(u.idModalServicios),u.eliminarPopup(u.idModalPedidos),u.eliminarPopup(u.idModalDetallePedidos),u.eliminarPopup(u.idModalEliminarPedido),u.eliminarPopup(u.idModalEliminarProductoPedido)}),u.inicio()}]);