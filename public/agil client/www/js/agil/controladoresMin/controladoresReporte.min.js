angular.module("agil.controladores").controller("ControladorEstadoCuentasProveedores",["$scope","$localStorage","$location","$templateCache","$route","blockUI","$timeout","uiGmapGoogleMapApi","$cordovaGeolocation","ReportEstadoCuentasProveedoresDatos","InventariosCosto",function(l,e,t,a,o,u,n,r,i,s,c){u.start(),l.usuario=JSON.parse(e.usuario),l.inicio=function(){l.proveedores=s.show({id_empresa:l.usuario.id_empresa}),setTimeout(function(){ejecutarScriptsTabla("tabla-estadoCuentaProveedores",10)},2e3),r.then(function(e){l.map={center:{latitude:-17.403800007775388,longitude:-66.11349012184144},zoom:17,bounds:{northeast:{latitude:-17.403800007775388,longitude:-66.11349012184144}}},l.options={scrollwheel:!1,mapTypeId:google.maps.MapTypeId.SATELLITE}})},l.$on("$viewContentLoaded",function(){resaltarPestaña(t.path().substring(1)),ejecutarScriptsProveedor("modal-wizard-proveedor","modal-wizard-proveedor-vista","dialog-eliminar-proveedor","modal-wizard-container-proveedor-edicion","modal-wizard-container-proveedor-vista"),l.buscarAplicacion(l.usuario.aplicacionesUsuario,t.path().substring(1)),u.stop()}),l.generarPdfEstadoCuentasProveedor=function(e){u.start();var t=new PDFDocument({size:"letter",margin:10}),a=t.pipe(blobStream()),o=0,n=120,r=0,i=1,s=Math.ceil(e.compras.length/33);l.dibujarCabeceraPDFEstadoCuentasProveedor(t,1,s,e),t.font("Helvetica",8);for(var c=0;c<e.compras.length&&r<=33;c++)t.rect(30,n-10,555,20).stroke(),e.compras[c].fecha=new Date(e.compras[c].fecha),t.text(e.compras[c].fecha.getDate()+"/"+(e.compras[c].fecha.getMonth()+1)+"/"+e.compras[c].fecha.getFullYear(),45,n),t.text(e.compras[c].id_movimiento,170,n,{width:45,align:"right"}),null==e.compras[c].factura?t.text("PROFORMA",240,n):t.text("Factura nro. "+e.compras[c].factura,240,n),t.text(e.compras[c].saldo,445,n,{width:50,align:"right"}),o+=e.compras[c].saldo,t.text(o,500,n,{width:50,align:"right"}),n+=20,33==++r&&(t.addPage({margin:0,bufferPages:!0}),n=120,r=0,i+=1,l.dibujarCabeceraPDFEstadoCuentasProveedor(t,i,s,Proveedor),t.font("Helvetica",8));t.rect(30,n-10,555,20).stroke(),t.font("Helvetica-Bold",8),t.text("Total General",350,n),t.text(o,446,n,{width:50,align:"right"}),t.end(),a.on("finish",function(){var e=a.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),u.stop()},l.generarExcelEstadoCuentasProveedor=function(e){for(var t=[["","","ESTADO CUENTAS PROVEEDOR"],["Deudor :"+e.razon_social],["Fecha","N Recibo","Descripción","monto","total","total General"]],a=0,o=0;o<e.compras.length;o++){var n=[];a+=e.compras[o].saldo,e.compras[o].fecha=new Date(e.compras[o].fecha),n.push(e.compras[o].fecha.getDate()+"/"+(e.compras[o].fecha.getMonth()+1)+"/"+e.compras[o].fecha.getFullYear()),n.push(e.compras[o].id_movimiento),null==e.compras[o].factura?n.push("PROFORMA"):n.push("factura : "+e.compras[o].factura),n.push(e.compras[o].saldo),n.push(a),n.push(a),t.push(n)}var r="SheetJS",i=new Workbook,s=sheet_from_array_of_arrays(t);i.SheetNames.push(r),i.Sheets[r]=s;var c=XLSX.write(i,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(c)],{type:"application/octet-stream"}),"REPORTE-ESTADO-CUENTA-PROVEEDOR.xlsx"),u.stop()},l.dibujarCabeceraPDFEstadoCuentasProveedor=function(e,t,a,o){e.font("Helvetica-Bold",12),e.text("ESTADO DE CUENTAS",0,25,{align:"center"}),e.font("Helvetica-Bold",8),e.text("PÁGINA "+t+" DE "+a,0,740,{align:"center"}),e.rect(30,50,555,30).stroke(),e.font("Helvetica-Bold",8),e.text("Acreedor : ",45,60),e.font("Helvetica",8),e.text(o.razon_social,140,60),e.rect(30,80,555,30).stroke(),e.font("Helvetica-Bold",8),e.text("Fecha",45,90),e.text("Nro. Recibo",170,90,{width:50}),e.text("Descripción",240,90,{width:60}),e.text("Monto",470,90,{width:50}),e.text("Total",530,90,{width:50}),e.font("Helvetica",8)},l.inicio()}]).controller("ControladorEstadoCuentasClientes",["$scope","$window","$localStorage","$location","$templateCache","$route","blockUI","$timeout","Paginator","uiGmapGoogleMapApi","$cordovaGeolocation","ReportEstadoCuentasClientesDatos","InventariosCosto","ReporteClientesPaginador",function(d,e,t,a,o,n,h,r,i,s,c,l,u,p){h.start(),d.idModalTablaEstadoCuenta="tabla-estado-cuenta",d.usuario=JSON.parse(t.usuario),d.inicio=function(){d.obtenerClientes(),s.then(function(e){d.map={center:{latitude:-17.403800007775388,longitude:-66.11349012184144},zoom:17,bounds:{northeast:{latitude:-17.403800007775388,longitude:-66.11349012184144}}},d.options={scrollwheel:!1,mapTypeId:google.maps.MapTypeId.SATELLITE}})},d.$on("$viewContentLoaded",function(){ejecutarScriptsCliente(d.idModalTablaEstadoCuenta),h.stop()}),d.obtenerClientes=function(){d.paginator=i(),d.paginator.column="codigo",d.paginator.callBack=d.obtenerLista,d.filtro={empresa:d.usuario.id_empresa,cuentas_liquidadas:0},d.paginator.getSearch("",d.filtro,null)},d.obtenerLista=function(){h.start(),p(d.paginator).then(function(e){d.paginator.setPages(e.paginas),d.clientes=e.clientes,h.stop()})},d.generarExcelEstadoCuentasClientesSeleccionados=function(e){for(var t=[],a=0;a<e.length;a++)(t=t.concat(d.generarExcelCliente(e[a],0))).push([]);var o="SheetJS",n=new Workbook,r=sheet_from_array_of_arrays(t);n.SheetNames.push(o),n.Sheets[o]=r;var i=XLSX.write(n,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(i)],{type:"application/octet-stream"}),"REPORTE-ESTADO-CUENTA-CLIENTES.xlsx"),h.stop()},d.generarExcelCliente=function(e,t){for(var a=[["","","ESTADO CUENTAS CLIENTE"],["Deudor :"+e.razon_social],["Fecha","N Recibo","Descripción","monto","total","total General"]],o=0,n=0;n<e.ventas.length;n++){var r=[];if(o+=e.ventas[n].saldo,e.ventas[n].fecha=new Date(e.ventas[n].fecha),r.push(e.ventas[n].fecha.getDate()+"/"+(e.ventas[n].fecha.getMonth()+1)+"/"+e.ventas[n].fecha.getFullYear()),r.push(e.ventas[n].id_movimiento),"FACT"!=e.ventas[n].movimiento.clase.nombre_corto?r.push("PROFORMA :"+e.ventas[n].factura):r.push("Factura : "+e.ventas[n].factura),r.push(e.ventas[n].saldo),r.push(o),r.push(o),a.push(r),0!=t&&0!=e.ventas[n].pagosVenta.length)for(var i=0;i<e.ventas[n].pagosVenta.length;i++){var s=[];date=new Date(e.ventas[n].pagosVenta[i].createdAt),s.push(""),s.push(date.getDate()+"/"+(date.getMonth()+1)+"/"+date.getFullYear()),s.push(e.ventas[n].pagosVenta[i].numero_documento),s.push("Pago a/c Factura nro.  "+e.ventas[n].factura+"("+e.ventas[n].pagosVenta[i].total+" -)"),s.push(e.ventas[n].pagosVenta[i].total),a.push(s)}}return a},d.verificarPulso=function(e,t){13===e.keyCode&&d.buscarClientes(1,d.itemsPorPagina,t)},d.generarPdfEstadoCuentasCliente=function(e,t){h.start();var a=new PDFDocument({size:"letter",margin:10}),o=a.pipe(blobStream()),n=0,r=120,i=0,s=1,c=Math.ceil(e.ventas.length/33);d.dibujarCabeceraPDFEstadoCuentasCliente(a,1,c,e),a.font("Helvetica",8);for(var l=0;l<e.ventas.length&&i<=33;l++){if(a.rect(30,r-10,555,20).stroke(),e.ventas[l].fecha=new Date(e.ventas[l].fecha),a.text(e.ventas[l].fecha.getDate()+"/"+(e.ventas[l].fecha.getMonth()+1)+"/"+e.ventas[l].fecha.getFullYear(),45,r),a.text(e.ventas[l].id_movimiento,170,r,{width:45,align:"right"}),"FACT"!=e.ventas[l].movimiento.clase.nombre_corto?a.text("PROFORMA nro. "+e.ventas[l].factura+"  (Bs. "+e.ventas[l].total+")",240,r):a.text("Factura nro. "+e.ventas[l].factura+" (Bs. "+e.ventas[l].total+")",240,r),a.text(e.ventas[l].saldo,475,r,{width:50,align:"right"}),a.text(e.ventas[l].fecha_vencimiento.getDate()+"/"+(e.ventas[l].fecha_vencimiento.getMonth()+1)+"/"+e.ventas[l].fecha_vencimiento.getFullYear(),425,r,{width:50,align:"right"}),n+=e.ventas[l].saldo,a.text(n,530,r,{width:50,align:"right"}),0!=t&&0!=e.ventas[l].pagosVenta.length)for(var u=0;u<e.ventas[l].pagosVenta.length;u++)r+=20,a.rect(30,r-10,0,20).stroke(),a.rect(585,r-10,0,20).stroke(),date=new Date(e.ventas[l].pagosVenta[u].createdAt),a.text(date.getDate()+"/"+(date.getMonth()+1)+"/"+date.getFullYear(),100,r,{width:50,align:"right"}),a.text(e.ventas[l].pagosVenta[u].numero_documento,170,r,{width:50,align:"right"}),"FACT"!=e.ventas[l].movimiento.clase.nombre_corto?a.text("Pago a/c Proforma nro.  "+e.ventas[l].factura+" ("+e.ventas[l].pagosVenta[u].total+" -)  (Bs. "+e.ventas[l].pagosVenta[u].monto_pagado+")",240,r):a.text("Pago a/c Factura nro.  "+e.ventas[l].factura+" ("+e.ventas[l].pagosVenta[u].total+" -)  (Bs. "+e.ventas[l].pagosVenta[u].monto_pagado+")",240,r),a.text(e.ventas[l].pagosVenta[u].total,475,r,{width:50,align:"right"});r+=20,33==++i&&(a.addPage({margin:0,bufferPages:!0}),r=120,i=0,s+=1,d.dibujarCabeceraPDFEstadoCuentasCliente(a,s,c,e),a.font("Helvetica",8))}a.rect(30,r-10,555,20).stroke(),a.font("Helvetica-Bold",8),a.text("Total General",380,r),a.text(n,475,r,{width:50,align:"right"});var p=new Date;a.font("Helvetica",6),a.text("EMISIÓN: "+p.getDate()+"/"+(p.getMonth()+1)+"/"+p.getFullYear(),180,r+15),a.text("IMPRESIÓN: "+p.getDate()+"/"+(p.getMonth()+1)+"/"+p.getFullYear(),240,r+15),a.text("USUARIO: "+d.usuario.persona.nombre_completo,35,r+15),c<s||a.text(s+" de "+c,560,r+15),a.end(),o.on("finish",function(){var e=o.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),h.stop()},d.generarExcelEstadoCuentasCliente=function(e,t){var a=d.generarExcelCliente(e,t),o="SheetJS",n=new Workbook,r=sheet_from_array_of_arrays(a);n.SheetNames.push(o),n.Sheets[o]=r;var i=XLSX.write(n,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(i)],{type:"application/octet-stream"}),"REPORTE-ESTADO-CUENTA-CLIENTES.xlsx"),h.stop()},d.click=function(){setTimeout(function(){angular.element(document.getElementsByClassName("verDetallePago")).triggerHandler("click")},0)},d.dibujarCabeceraPDFEstadoCuentasCliente=function(e,t,a,o){e.font("Helvetica-Bold",8),e.text(d.usuario.empresa.razon_social,35,10),e.font("Helvetica",8),e.text(d.usuario.empresa.direccion,35,20);var n=(null!=d.usuario.empresa.telefono1?d.usuario.empresa.telefono1:"")+(null!=d.usuario.empresa.telefono2?"-"+d.usuario.empresa.telefono2:"")+(null!=d.usuario.empresa.telefono3?"-"+d.usuario.empresa.telefono3:"");e.text("TELF. :"+n,35,30),e.text("COCHABAMBA - BOLIVIA ",35,40),e.font("Helvetica",8),e.font("Helvetica-Bold",12),e.text("ESTADO DE CUENTAS",0,25,{align:"center"}),e.font("Helvetica-Bold",8),e.text("PÁGINA "+t+" DE "+a,0,740,{align:"center"}),e.rect(30,50,555,30).stroke(),e.font("Helvetica-Bold",8),e.text("Deudor : ",45,60),e.font("Helvetica",8),e.text(o.razon_social,140,60),e.rect(30,80,555,30).stroke(),e.font("Helvetica-Bold",8),e.text("Fecha",45,90),e.text("Nro. Recibo",170,90,{width:50}),e.text("Descripción",240,90,{width:60}),e.text("F.Venc",440,90,{width:50}),e.text("Saldo",500,90,{width:50}),e.text("Total",560,90,{width:50}),e.font("Helvetica",8)},d.abrirEstadoCuentaCliente=function(e){for(var t=d.totalPagado=0;t<e.ventas.length;t++){var a=new Date(e.ventas[t].fecha);e.ventas[t].totalgeneral=0,e.ventas[t].totalPago=0,e.ventas[t].totalgeneral=0==t?e.ventas[t].totalgeneral+e.ventas[t].saldo:e.ventas[t-1].totalgeneral+e.ventas[t].saldo;for(var o=0;o<e.ventas[t].pagosVenta.length;o++)e.ventas[t].pagosVenta[o].total=e.ventas[t].pagosVenta[o].saldo_anterior-e.ventas[t].pagosVenta[o].monto_pagado,e.ventas[t].totalPago=e.ventas[t].totalPago+e.ventas[t].pagosVenta[o].monto_pagado;e.ventas[t].fecha_vencimiento=d.sumaFecha(e.ventas[t].dias_credito,a)}t=e.ventas.length-1;d.totalgeneral=0,d.totalgeneral=e.ventas[t].totalgeneral,d.clienteVentas=e,d.abrirPopup(d.idModalTablaEstadoCuenta)},d.verDetallePagos=function(e){"none"==$("#"+e.id_movimiento).css("display")?$("#"+e.id_movimiento).css("display",""):$("#"+e.id_movimiento).css("display","none")},d.cerrarEstadoCuentaCliente=function(){d.cerrarPopup(d.idModalTablaEstadoCuenta)},d.abrirPopup=function(e){abrirPopup(e)},d.cerrarPopup=function(e){ocultarPopup(e)},d.eliminarPopup=function(e){eliminarPopup(e)},d.imprimirRecibo=function(e,t){h.start();var a=new PDFDocument({size:[227,353],margin:10}),o=a.pipe(blobStream());a.moveDown(2),a.font("Helvetica-Bold",8),a.text(d.usuario.empresa.razon_social.toUpperCase(),{align:"center"}),a.moveDown(.4),a.font("Helvetica",7),a.text(t.almacen.sucursal.nombre.toUpperCase(),{align:"center"}),a.moveDown(.4),a.text(t.almacen.sucursal.direccion.toUpperCase(),{align:"center"}),a.moveDown(.4);var n=(null!=t.almacen.sucursal.telefono1?t.almacen.sucursal.telefono1:"")+(null!=t.almacen.sucursal.telefono2?"-"+t.almacen.sucursal.telefono2:"")+(null!=t.almacen.sucursal.telefono3?"-"+t.almacen.sucursal.telefono3:"");a.text("TELF.: "+n,{align:"center"}),a.moveDown(.4),a.text("COCHABAMBA - BOLIVIA",{align:"center"}),a.moveDown(.5),a.font("Helvetica-Bold",8),a.text("RECIBO",{align:"center"}),a.font("Helvetica",7),a.moveDown(.4),a.text("------------------------------------",{align:"center"}),a.moveDown(.4),a.text(e.numero_documento,{align:"center"}),a.moveDown(.4),a.moveDown(.4),a.text("------------------------------------",{align:"center"}),a.moveDown(.4),a.moveDown(.6);var r=new Date;a.text("FECHA : "+r.getDate()+"/"+(r.getMonth()+1)+"/"+r.getFullYear(),{align:"left"}),a.moveDown(.4),a.text("He recibido de : "+d.clienteVentas.razon_social,{align:"left"}),a.moveDown(.4),a.text("---------------------------------------------------------------------------------",{align:"center"}),a.moveDown(.2),a.text("CONCEPTO",{align:"left"}),a.moveDown(.2),a.text("---------------------------------------------------------------------------------",{align:"center"}),a.moveDown(.4),t.fecha=new Date(t.fecha),a.text("Fecha: "+t.fecha.getDate()+"/"+(t.fecha.getMonth()+1)+"/"+t.fecha.getFullYear(),15,210);var i=t.movimiento.clase.nombre_corto==d.diccionario.EGRE_FACTURACION?"Factura nro. "+t.factura:"Proforma nro. "+t.factura;a.text(i,105,210,{width:100}),a.text("Saldo Bs "+e.saldo_anterior+".-",105,220,{width:100}),a.text("Bs "+e.monto_pagado+".-",170,210,{width:100}),a.text("--------------",10,230,{align:"right"}),a.moveDown(.3),a.text("TOTAL Bs.              "+e.monto_pagado,{align:"right"}),a.moveDown(.4),a.moveDown(.4),a.moveDown(.6),a.moveDown(.4),a.moveDown(.4),a.moveDown(.4),a.moveDown(.4),a.moveDown(.4),a.moveDown(.4),a.moveDown(.4),a.moveDown(.4),a.moveDown(.4),a.moveDown(.4),a.moveDown(.4),a.moveDown(.4),a.moveDown(.4),a.text("-------------------------                       -------------------------",{align:"center"}),a.text("ENTREGUE CONFORME            RECIBI CONFORME",{align:"center"}),a.end(),o.on("finish",function(){var e=o.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),h.stop()},d.$on("$routeChangeStart",function(e,t){d.eliminarPopup(d.idModalTablaEstadoCuenta)}),d.inicio()}]).controller("ControladorLibroVentas",["$scope","$localStorage","$location","$templateCache","$route","blockUI","ClasesTipo","ReporteLibroVentasDatos",function(O,e,t,a,o,T,n,i){O.usuario=JSON.parse(e.usuario),O.inicio=function(){O.obtenerGestiones(),O.obtenerMovimientosEgreso()},O.obtenerGestiones=function(){T.start(),n("GTN").then(function(e){O.gestiones=e.clases,T.stop()})},O.obtenerMovimientosEgreso=function(){T.start(),n("MOVEGR").then(function(e){O.movimientosEgreso=e.clases,T.stop()})},O.generarTXTLibroVentas=function(r){T.start(),i(O.usuario.id_empresa,r.gestion,r.mes.split("-")[0]).then(function(e){for(var t=e.ventas,a="",o=0;o<t.length;o++)t[o].fecha=new Date(t[o].fecha),a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=a+t[o].fecha.getDate()+"/"+(t[o].fecha.getMonth()+1)+"/"+t[o].fecha.getFullYear()+"|")+t[o].factura+"|")+t[o].autorizacion+"|")+(t[o].activa?"V":"A")+"|")+t[o].cliente.nit+"|")+t[o].cliente.razon_social+"|")+t[o].importe+"|")+0+"|")+0+"|")+0+"|")+t[o].importe+"|")+0+"|")+t[o].total+"|")+Math.round(.13*t[o].total*100)/100+"|",a+=t[o].codigo_control,a+="\n";var n=new Blob([a.replace(/\n/g,"\r\n")],{type:"text/plain"});saveAs(n,"ventas_"+r.mes.split("-")[0]+r.gestion+"_"+e.empresa.nit+".txt"),T.stop()})},O.generarExcelLibroVentas=function(e){T.start(),i(O.usuario.id_empresa,e.gestion,e.mes.split("-")[0]).then(function(e){for(var t=e.ventas,a=[["N°","FECHA DE LA FACTURA","N° DE LA FACTURA","N° DE AUTORIZACION","ESTADO","NIT/CI CLIENTE","NOMBRE O RAZON SOCIAL","IMPORTE TOTAL DE LA VENTA","IMPORTE ICE/IEHD/TASAS","EXPORTACIONES Y OPERACIONES EXENTAS","VENTAS GRAVADAS A TASA CERO","SUBTOTAL","DESCUENTOS, BONIFICACIONES Y REBAJAS OBTENIDAS","IMPORTE BASE PARA DEBITO FISCAL","DEBITO FISCAL","CODIGO DE CONTROL"]],o=0,n=0,r=0,i=0,s=0,c=0,l=0,u=0,p=0;p<t.length;p++){var d=[];t[p].fecha=new Date(t[p].fecha),d.push(p+1),d.push(t[p].fecha.getDate()+"/"+(t[p].fecha.getMonth()+1)+"/"+t[p].fecha.getFullYear()),d.push(t[p].factura),d.push(t[p].autorizacion?t[p].autorizacion:""),d.push(t[p].activa?"V":"A"),d.push(t[p].cliente.nit),d.push(t[p].cliente.razon_social),d.push(t[p].importe),d.push(0),d.push(0),d.push(0),d.push(t[p].importe),d.push(0),d.push(t[p].total),d.push(Math.round(.13*t[p].total*100)/100),d.push(t[p].codigo_control?t[p].codigo_control:""),o+=t[p].importe,i=r=n=0,s+=t[p].importe,c+=0,l+=t[p].total,u+=Math.round(.13*t[p].total*100)/100,a.push(d),p+1==t.length&&((d=[]).push(""),d.push(""),d.push(""),d.push(""),d.push(""),d.push(""),d.push("TOTALES"),d.push(Math.round(100*o)/100),d.push(Math.round(100*n)/100),d.push(Math.round(100*r)/100),d.push(Math.round(100*i)/100),d.push(Math.round(100*s)/100),d.push(Math.round(100*c)/100),d.push(Math.round(100*l)/100),d.push(Math.round(100*u)/100),a.push(d))}var h="SheetJS",m=new Workbook,v=sheet_from_array_of_arrays(a);m.SheetNames.push(h),m.Sheets[h]=v;var f=XLSX.write(m,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(f)],{type:"application/octet-stream"}),"LIBRO-VENTAS.xlsx"),T.stop()})},O.generarPdfLibroVentas=function(S){T.start(),i(O.usuario.id_empresa,S.gestion,S.mes.split("-")[0],S.movimiento).then(function(e){var t=e.ventas,a=new PDFDocument({compress:!1,margin:10,layout:"landscape"}),o=a.pipe(blobStream());O.dibujarCabeceraPDFLibroVentas(a,e,S,1),a.font("Helvetica",8);for(var n=170,r=0,i=1,s=0,c=0,l=0,u=0,p=0,d=0,h=0,m=0,v=0,f=0,g=0,x=0,b=0,E=0,A=0,C=0,D=0;D<t.length&&r<=12;D++)a.rect(40,n-10,720,30).stroke(),t[D].fecha=new Date(t[D].fecha),a.text(D+1,45,n),a.text(t[D].fecha.getDate()+"/"+(t[D].fecha.getMonth()+1)+"/"+t[D].fecha.getFullYear(),65,n),a.text(t[D].factura,110,n),a.text(t[D].autorizacion,145,n),a.text(t[D].activa?"V":"A",210,n),a.text(t[D].cliente.nit,235,n),a.text(t[D].cliente.razon_social,283,n-6,{width:100}),a.text(t[D].importe,385,n),a.text(0,430,n),a.text(0,465,n),a.text(0,507,n),a.text(t[D].importe,540,n),a.text(0,580,n),a.text(t[D].total,615,n),a.text(Math.round(.13*t[D].total*100)/100,650,n),a.text(t[D].codigo_control,685,n),n+=30,v+=t[D].importe,x=g=f=0,b+=t[D].importe,E+=0,A+=t[D].total,C+=Math.round(.13*t[D].total*100)/100,s+=t[D].importe,u=l=c=0,p+=t[D].importe,d+=0,h+=t[D].total,m+=Math.round(.13*t[D].total*100)/100,12!=++r&&D+1!=t.length||(a.font("Helvetica-Bold",8),a.text("SUBTOTALES",283,n),a.text(Math.round(100*v)/100,385,n),a.text(Math.round(100*f)/100,430,n),a.text(Math.round(100*g)/100,465,n),a.text(Math.round(100*x)/100,507,n),a.text(Math.round(100*b)/100,540,n),a.text(Math.round(100*E)/100,580,n),a.text(Math.round(100*A)/100,615,n),a.text(Math.round(100*C)/100,650,n),a.rect(40,n-10,720,30).stroke(),a.font("Helvetica",8),v=0,C=A=E=b=sumaSubImporteNo=0,D+1==t.length?(a.font("Helvetica-Bold",8),a.text("TOTALES",283,n+30),a.text(Math.round(100*s)/100,385,n+30),a.text(Math.round(100*c)/100,430,n+30),a.text(Math.round(100*l)/100,465,n+30),a.text(Math.round(100*u)/100,507,n+30),a.text(Math.round(100*p)/100,540,n+30),a.text(Math.round(100*d)/100,580,n+30),a.text(Math.round(100*h)/100,615,n+30),a.text(Math.round(100*m)/100,650,n+30),a.rect(40,n-10+30,720,30).stroke()):(a.addPage({margin:0,bufferPages:!0,layout:"landscape"}),n=170,r=0,i+=1,O.dibujarCabeceraPDFLibroVentas(a,e,S,i)),a.font("Helvetica",8));a.end(),o.on("finish",function(){var e=o.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),T.stop()})},O.dibujarCabeceraPDFLibroVentas=function(e,t,a,o){e.font("Helvetica-Bold",12),e.text("LIBRO DE VENTAS IVA ESTÁNDAR",0,25,{align:"center"}),e.font("Helvetica-Bold",8),e.text("FOLIO "+o,720,25),e.rect(40,60,720,40).stroke(),e.text("PERIÓDO FISCAL : ",65,70),e.text("NOMBRE O RAZÓN SOCIAL : ",65,85),e.text("NIT : ",440,85),e.font("Helvetica",8),e.text("AÑO "+a.gestion,140,70),e.text("MES "+a.mes.split("-")[1],200,70),e.text(t.empresa.razon_social,195,85),e.text(t.empresa.nit,460,85),e.rect(40,100,720,60).stroke(),e.font("Helvetica-Bold",8),e.text("Nº",45,110),e.text("Fecha de la Factura",65,110,{width:40}),e.text("Nº de la Factura",110,110,{width:50}),e.text("Nº de Autorización",145,110,{width:50}),e.text("Estado",205,110,{width:35}),e.text("NIT / CI Cliente",235,110,{width:50}),e.text("Nombre o Razón Social",280,110),e.text("Importe Total de la Venta",385,110,{width:35}),e.text("Importe ICE IE HD/T",425,110,{width:35}),e.text("Exp. y Op. exentas",460,110,{width:42}),e.text("Ventas grabadas a Tasa Cero",502,110,{width:42}),e.text("Subtotal",540,110,{width:40}),e.text("Desc., Bonif. y Rebajas",575,110,{width:42}),e.text("Importe Base para Débito Fiscal",615,110,{width:35}),e.text("Débito Fiscal I.V.A.",650,110,{width:35}),e.text("Código de Control",685,110)},O.inicio()}]).controller("ControladorLibroCompras",["$scope","$localStorage","$location","$templateCache","$route","blockUI","ClasesTipo","ReporteLibroComprasDatos",function(D,e,t,a,o,S,n,r){D.usuario=JSON.parse(e.usuario),D.inicio=function(){D.obtenerGestiones()},D.obtenerGestiones=function(){S.start(),n("GTN").then(function(e){D.gestiones=e.clases,S.stop()})},D.generarTXTLibroCompras=function(i){S.start(),r(D.usuario.id_empresa,i.gestion,i.mes.split("-")[0]).then(function(e){for(var t=e.compras,a="",o=1,n=0;n<t.length;n++){if(t[n].movimiento.clase.nombre!==D.diccionario.MOVING_POR_COMPRA_SIN_FACTURA&&t[n].movimiento.clase.nombre!==D.diccionario.MOVING_POR_RETENCION_BIENES)t[n].fecha=new Date(t[n].fecha),a=(a=(a=(a=(a=(a+="1|")+o+"|")+(t[n].fecha.getDate()<10?"0"+t[n].fecha.getDate():t[n].fecha.getDate())+"/"+(t[n].fecha.getMonth()+1<10?"0"+(t[n].fecha.getMonth()+1):t[n].fecha.getMonth()+1)+"/"+t[n].fecha.getFullYear()+"|")+t[n].proveedor.nit+"|")+t[n].proveedor.razon_social+"|")+t[n].factura+"|",a=(a=(a=(a=(a=(a=(a=(a=(a+="0|")+t[n].autorizacion+"|")+t[n].importe+"|")+0+"|")+t[n].importe+"|")+(t[n].descuento-t[n].recargo+t[n].ice+t[n].excento)+"|")+t[n].total+"|")+Math.round(.13*t[n].total*100)/100+"|")+t[n].codigo_control+"|",a+="1\n",o++}var r=new Blob([a.replace(/\n/g,"\r\n")],{type:"text/plain"});saveAs(r,"compras_"+i.mes.split("-")[0]+i.gestion+"_"+e.empresa.nit+".txt"),S.stop()})},D.generarExcelLibroCompras=function(e){S.start(),r(D.usuario.id_empresa,e.gestion,e.mes.split("-")[0]).then(function(e){for(var t=e.compras,a=[["N°","FECHA DE LA FACTURA O DUI","NIT PROVEEDOR","NOMBRE Y APELLIDOS/RAZON SOCIAL","N° DE LA FACTURA","N° DE DUI","N° DE AUTORIZACION","IMPORTE TOTAL DE LA COMPRA","IMPORTE NO SUJETO A CREDITO FISCAL","SUBTOTAL","DESCUENTOS, BONIFICACIONES Y REBAJAS OBTENIDAS","IMPORTE BASE PARA CREDITO FISCAL","CREDITO FISCAL","CODIGO DE CONTROL","TIPO DE COMPRA"]],o=0,n=0,r=0,i=0,s=0,c=0,l=1,u=0;u<t.length;u++){var p=[];if(t[u].movimiento.clase.nombre!==D.diccionario.MOVING_POR_COMPRA_SIN_FACTURA&&t[u].movimiento.clase.nombre!==D.diccionario.MOVING_POR_RETENCION_BIENES){t[u].fecha=new Date(t[u].fecha),p.push(l),p.push(t[u].fecha.getDate()+"/"+(t[u].fecha.getMonth()+1)+"/"+t[u].fecha.getFullYear()),p.push(t[u].proveedor.nit),p.push(t[u].proveedor.razon_social),p.push(t[u].factura),p.push(0),p.push(t[u].autorizacion),p.push(t[u].importe),p.push(0),p.push(t[u].importe);var d=t[u].descuento-t[u].recargo+t[u].ice+t[u].excento;p.push(d),p.push(t[u].total),p.push(Math.round(.13*t[u].total*100)/100),p.push(t[u].codigo_control),p.push(1),o+=t[u].importe,n=0,r+=t[u].importe,i+=d,s+=t[u].total,c+=Math.round(.13*t[u].total*100)/100,a.push(p),u+1==t.length&&((p=[]).push(""),p.push(""),p.push(""),p.push(""),p.push(""),p.push(""),p.push("TOTALES"),p.push(Math.round(100*o)/100),p.push(Math.round(100*n)/100),p.push(Math.round(100*r)/100),p.push(Math.round(100*i)/100),p.push(Math.round(100*s)/100),p.push(Math.round(100*c)/100),a.push(p)),l++}}var h="SheetJS",m=new Workbook,v=sheet_from_array_of_arrays(a);m.SheetNames.push(h),m.Sheets[h]=v;var f=XLSX.write(m,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(f)],{type:"application/octet-stream"}),"LIBRO-COMPRAS.xlsx"),S.stop()})},D.generarPdfLibroCompras=function(C){S.start(),r(D.usuario.id_empresa,C.gestion,C.mes.split("-")[0]).then(function(e){var t=e.compras,a=new PDFDocument({margin:10,layout:"landscape"}),o=a.pipe(blobStream());D.dibujarCabeceraPDFLibroCompras(a,e,C,1),a.font("Helvetica",8);for(var n=1,r=170,i=0,s=1,c=0,l=0,u=0,p=0,d=0,h=0,m=0,v=0,f=0,g=0,x=0,b=0,E=0;E<t.length&&i<=12;E++)if(t[E].movimiento.clase.nombre!==D.diccionario.MOVING_POR_COMPRA_SIN_FACTURA&&t[E].movimiento.clase.nombre!==D.diccionario.MOVING_POR_RETENCION_BIENES){a.rect(40,r-10,720,30).stroke(),t[E].fecha=new Date(t[E].fecha),a.text(n,45,r),a.text(t[E].fecha.getDate()+"/"+(t[E].fecha.getMonth()+1)+"/"+t[E].fecha.getFullYear(),65,r),a.text(t[E].proveedor.nit,110,r),a.text(t[E].proveedor.razon_social,165,r-6,{width:100}),a.text(t[E].factura,275,r),a.text(0,320,r),a.text(t[E].autorizacion,335,r),a.text(t[E].importe,410,r),a.text(0,450,r),a.text(t[E].importe,480,r);var A=t[E].descuento-t[E].recargo+t[E].ice+t[E].excento;a.text(A,520,r),a.text(t[E].total,565,r),a.text(Math.round(.13*t[E].total*100)/100,605,r),a.text(t[E].codigo_control,640,r),a.text(1,740,r),r+=30,m+=t[E].importe,v=0,f+=t[E].importe,g+=A,x+=t[E].total,b+=Math.round(.13*t[E].total*100)/100,c+=t[E].importe,l=0,u+=t[E].importe,p+=A,d+=t[E].total,h+=Math.round(.13*t[E].total*100)/100,12!=++i&&E+1!=t.length||(a.font("Helvetica-Bold",8),a.text("SUBTOTALES",320,r),a.text(Math.round(100*m)/100,400,r),a.text(Math.round(100*v)/100,450,r),a.text(Math.round(100*f)/100,480,r),a.text(Math.round(100*g)/100,520,r),a.text(Math.round(100*x)/100,565,r),a.text(Math.round(100*b)/100,605,r),a.rect(40,r-10,720,30).stroke(),a.font("Helvetica",8),b=x=g=f=v=m=0,E+1==t.length?(a.font("Helvetica-Bold",8),a.text("TOTALES",320,r+30),a.text(Math.round(100*c)/100,400,r+30),a.text(Math.round(100*l)/100,450,r+30),a.text(Math.round(100*u)/100,480,r+30),a.text(Math.round(100*p)/100,520,r+30),a.text(Math.round(100*d)/100,565,r+30),a.text(Math.round(100*h)/100,605,r+30),a.rect(40,r-10+30,720,30).stroke()):(a.addPage({margin:0,bufferPages:!0,layout:"landscape"}),r=170,i=0,s+=1,D.dibujarCabeceraPDFLibroCompras(a,e,C,s)),a.font("Helvetica",8)),n++}a.end(),o.on("finish",function(){var e=o.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),S.stop()})},D.dibujarCabeceraPDFLibroCompras=function(e,t,a,o){e.font("Helvetica-Bold",12),e.text("LIBRO DE COMPRAS IVA ESTÁNDAR",0,25,{align:"center"}),e.font("Helvetica-Bold",8),e.text("FOLIO "+o,720,25),e.rect(40,60,720,40).stroke(),e.text("PERIÓDO FISCAL : ",65,70),e.text("NOMBRE O RAZÓN SOCIAL : ",65,85),e.text("NIT : ",440,85),e.font("Helvetica",8),e.text("AÑO "+a.gestion,140,70),e.text("MES "+a.mes.split("-")[1],200,70),e.text(t.empresa.razon_social,195,85),e.text(t.empresa.nit,460,85),e.rect(40,100,720,60).stroke(),e.font("Helvetica-Bold",8),e.text("Nº",45,110),e.text("Fecha de la Factura o DUI",65,110,{width:40}),e.text("NIT Proveedor",110,110,{width:50}),e.text("Nombre o Razón Social",165,110),e.text("Nº de la Factura",275,110,{width:50}),e.text("Nº de DUI",320,110,{width:30}),e.text("Nº de Autorización",345,110,{width:50}),e.text("Importe Total de la Compra",400,110,{width:35}),e.text("Importe No Sujeto a Crédito Fiscal",440,110,{width:35}),e.text("Subtotal",480,110),e.text("Descuentos, Bonificaciones y Rebajas",520,110,{width:40}),e.text("Importe Base para Crédito Fiscal",565,110,{width:35}),e.text("Crédito Fiscal I.V.A.",605,110,{width:35}),e.text("Código de Control",640,110),e.text("Tipo de Compra",720,110,{width:35})},D.inicio()}]).controller("ControladorReporteAlmacenes",["$scope","$window","$localStorage","$location","$templateCache","$route","blockUI","InventariosCosto","InventarioPaginadorAlmacen","InventarioReporteAlmacen",function(d,e,t,a,o,n,h,r,s,m){d.usuario=JSON.parse(t.usuario),d.inicio=function(){d.sucursales=d.obtenerSucursales(),d.reporte={},d.itemsPorPagina=10,d.paginaActual=1,d.columna="cantidad",d.direccion="asc",d.textoBusqueda="",d.reporte.sucursal=1==d.sucursales.length?d.sucursales[0]:null,1==d.sucursales.length&&(d.obtenerAlmacenes(d.sucursales[0].id),d.reporte.almacen=1==d.almacenes.length?d.almacenes[0]:null)},d.obtenerAlmacenes=function(t){if(d.almacenes=[],null!=t){var e=$.grep(d.sucursales,function(e){return e.id==t})[0];d.almacenes=d.almacenes.concat(e.almacenes),d.reporte.almacen=1==d.almacenes.length?d.almacenes[0]:null}d.obtenerInventarios()},d.obtenerSucursales=function(){for(var e=[],t=0;t<d.usuario.sucursalesUsuario.length;t++)e.push(d.usuario.sucursalesUsuario[t].sucursal);return e},d.establecerAlmacenBusqueda=function(e){d.almacenBusqueda=e.almacen,d.sucursalBusqueda=e.sucursal,d.obtenerInventarios()},d.obtenerInventarios=function(){d.abs=e.Math.abs,void 0!==d.reporte.sucursal&&null!==d.reporte.sucursal?(d.sucursalBusqueda=d.reporte.sucursal,void 0!==d.reporte.almacen&&d.reporte.almacen?(d.almacenBusqueda=d.reporte.almacen,d.buscarInventarios(d.sucursalBusqueda.id,d.almacenBusqueda.id,d.paginaActual,d.itemsPorPagina,d.textoBusqueda,d.columna,d.direccion)):d.buscarInventarios(d.sucursalBusqueda.id,0,d.paginaActual,d.itemsPorPagina,d.textoBusqueda,d.columna,d.direccion)):(1==d.sucursales.length&&(d.reporte.sucursal=1==d.sucursales.length?d.sucursales[0]:null,1==d.sucursales.length&&(d.obtenerAlmacenes(d.sucursales[0].id),d.reporte.almacen=2==d.almacenes.length?d.almacenes[1]:null)),d.buscarInventarios(d.sucursalBusqueda.id,d.almacenBusqueda.id,d.paginaActual,d.itemsPorPagina,d.textoBusqueda,d.columna,d.direccion))},d.clasificarColumna=function(e){d.columna==e?"asc"==d.direccion?(d.direccion="desc",$("#"+e).removeClass("fa-caret-up"),$("#"+e).addClass("fa-caret-down")):(d.direccion="asc",$("#"+e).removeClass("fa-caret-down"),$("#"+e).addClass("fa-caret-up")):(d.direccion="asc",$(".sort").removeClass("fa-caret-up"),$(".sort").removeClass("fa-caret-down"),$(".sort").addClass("fa-sort"),$("#"+e).addClass("fa-caret-up"),$("#"+e).removeClass("fa-sort")),d.columna=e,void 0!==d.reporte.sucursal?(void 0!==d.reporte.almacen?d.almacenBusqueda=d.reporte.almacen:d.almacenBusqueda={id:0},d.buscarInventarios(d.reporte.sucursal.id,d.almacenBusqueda.id,d.paginaActual,d.itemsPorPagina,d.textoBusqueda,d.columna,d.direccion)):d.reporte.sucursal},d.buscarInventarios=function(e,t,a,o,n,r,i){h.start(),d.itemsPorPagina="TODOS"!==o?o:0,null!=e&&null!=e||(e=0),null!=t&&null!=t||(t=0),""==n||null==n?n=0:d.textoBusqueda=n,"todos"==o&&(o=d.inventarios.length*d.inventarios.paginas),d.paginaActual=a!=d.paginaActual?a:1,s(d.usuario.id_empresa,e,t,d.paginaActual,o,n,r,i,d.usuario.id).then(function(e){var t=e.inventario;d.paginas=[];for(var a=1;a<=e.paginas;a++)d.paginas.push(a);d.inventarios=t,d.inventarios.paginas=e.paginas,h.stop()}).catch(function(e){var t=void 0!==e.stack&&null!==e.stack?e.stack:void 0!==e.data&&null!==e.data?e.data:void 0!==e.message&&null!==e.message?e.message:" Error desconocido al buscar inventarios en reportes almacen,";d.mostrarMensaje("ERROR. "+t),h.stop()})},d.generarPdfAlmacenes=function(e){if(h.start(),e.solo_pagina_actual){var t=d.inventarios,a=new PDFDocument({margin:10,compress:!1}),o=a.pipe(blobStream()),n=0,r=90,i=0,s=1,c=Math.ceil(t.length/33);d.dibujarCabeceraPDFAlmacenes(a,1,c),a.font("Helvetica",7);for(var l=0;l<t.length&&i<=33;l++){var u,p;if(a.rect(30,r-10,555,20).stroke(),a.text(t[l].codigo,35,r),a.text(t[l].cantidad,110,r),a.text(t[l].unidad_medida,160,r),d.usuario.empresa.usar_vencimientos?(35<t[l].nombre.length?a.text(t[l].nombre,210,r-6,{width:170}):a.text(t[l].nombre,210,r,{width:170}),t[l].fecha_vencimiento=new Date(t[l].fecha_vencimiento),a.text(t[l].fecha_vencimiento.getDate()+"/"+(t[l].fecha_vencimiento.getMonth()+1)+"/"+t[l].fecha_vencimiento.getFullYear(),380,r),a.text(null==t[l].lote?"No definido.":t[l].lote,430,r)):a.text(t[l].nombre,210,r),a.text(t[l].costo_unitario.toFixed(2),470,r),a.text(t[l].costo_total.toFixed(2),530,r),r+=20,i++,n+=t[l].costo_total,33==i)(p=(u=new Date).getMinutes())<10&&(p="0"+p),a.text("USUARIO: "+d.usuario.nombre_usuario,45,r),a.text("EMISIÓN : "+u.getDate()+"/"+(u.getMonth()+1)+"/"+u.getFullYear()+" Hr. "+u.getHours()+":"+p,450,r),a.addPage({margin:0,bufferPages:!0}),r=90,i=0,s+=1,d.dibujarCabeceraPDFAlmacenes(a,s,c),a.font("Helvetica",7)}a.rect(30,r-10,555,20).stroke(),a.font("Helvetica-Bold",8),a.text("Total General",400,r),a.text(Math.round(100*n)/100,530,r),(p=(u=new Date).getMinutes())<10&&(p="0"+p),a.font("Helvetica",7),a.text("USUARIO: "+d.usuario.nombre_usuario,45,r+20),a.text("EMISIÓN : "+u.getDate()+"/"+(u.getMonth()+1)+"/"+u.getFullYear()+" Hr. "+u.getHours()+":"+p,450,r+20),a.end(),o.on("finish",function(){var e=o.toBlobURL("application/pdf");window.open(e,"_blank","location=no")})}else{m(d.usuario.id_empresa,e.sucursal.id,null!==e.almacen&&void 0!==e.almacen&&0!==e.almacen?e.almacen.id:0,d.usuario.id).then(function(e){var t=e.inventario,a=new PDFDocument({margin:10,compress:!1}),o=a.pipe(blobStream()),n=0,r=90,i=0,s=1,c=Math.ceil(t.length/33);d.dibujarCabeceraPDFAlmacenes(a,1,c),a.font("Helvetica",7);for(var l=0;l<t.length&&i<=33;l++){var u,p;if(a.rect(30,r-10,555,20).stroke(),a.text(t[l].codigo,35,r),a.text(t[l].cantidad,110,r),a.text(t[l].unidad_medida,160,r),d.usuario.empresa.usar_vencimientos?(35<t[l].nombre.length?a.text(t[l].nombre,210,r-6,{width:170}):a.text(t[l].nombre,210,r,{width:170}),t[l].fecha_vencimiento=new Date(t[l].fecha_vencimiento),a.text(t[l].fecha_vencimiento.getDate()+"/"+(t[l].fecha_vencimiento.getMonth()+1)+"/"+t[l].fecha_vencimiento.getFullYear(),380,r),a.text(null==t[l].lote?"No definido.":t[l].lote,430,r)):a.text(t[l].nombre,210,r),a.text(t[l].costo_unitario.toFixed(2),470,r),a.text(t[l].costo_total.toFixed(2),530,r),r+=20,i++,n+=t[l].costo_total,33==i)(p=(u=new Date).getMinutes())<10&&(p="0"+p),a.text("USUARIO: "+d.usuario.nombre_usuario,45,r),a.text("EMISIÓN : "+u.getDate()+"/"+(u.getMonth()+1)+"/"+u.getFullYear()+" Hr. "+u.getHours()+":"+p,450,r),a.addPage({margin:0,bufferPages:!0}),r=90,i=0,s+=1,d.dibujarCabeceraPDFAlmacenes(a,s,c),a.font("Helvetica",7)}a.rect(30,r-10,555,20).stroke(),a.font("Helvetica-Bold",8),a.text("Total General",400,r),a.text(Math.round(100*n)/100,530,r),(p=(u=new Date).getMinutes())<10&&(p="0"+p),a.font("Helvetica",7),a.text("USUARIO: "+d.usuario.nombre_usuario,45,r+20),a.text("EMISIÓN : "+u.getDate()+"/"+(u.getMonth()+1)+"/"+u.getFullYear()+" Hr. "+u.getHours()+":"+p,450,r+20),a.end(),o.on("finish",function(){var e=o.toBlobURL("application/pdf");window.open(e,"_blank","location=no")})})}h.stop()},d.generarExcelAlmacenes=function(e){if(h.start(),e.solo_pagina_actual){for(var t=d.inventarios,a=[["Código","Nombre","Unidad de Medida","Precio Unitario","Descripción","Inventario Mínimo","Grupo","Sub-Grupo","Carac. Esp. 1","Carac. Esp. 2","Codigo de fabrica","Cant.","Costo Unitario","Total General","Fecha Vencimiento","Lote","Sucursal","Almacen"]],o=0;o<t.length;o++){t[o].fecha_vencimiento=t[o].fecha_vencimiento?new Date(t[o].fecha_vencimiento):null;var n=[];n.push(t[o].codigo),n.push(t[o].nombre),n.push(t[o].unidad_medida),n.push(t[o].precio_unitario),n.push(t[o].descripcion),n.push(t[o].inventario_minimo),n.push(t[o].grupo),n.push(t[o].subgrupo),n.push(t[o].caracteristica_especial1),n.push(t[o].caracteristica_especial2),n.push(t[o].codigo_fabrica),n.push(t[o].cantidad),n.push(t[o].costo_unitario),n.push(t[o].costo_total),n.push(t[o].fecha_vencimiento),n.push(t[o].lote),n.push(t[o].nombre_sucursal),n.push(t[o].nombre_almacen),a.push(n)}var r="SheetJS",i=new Workbook,s=sheet_from_array_of_arrays(a);i.SheetNames.push(r),i.Sheets[r]=s;var c=XLSX.write(i,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(c)],{type:"application/octet-stream"}),"REPORTE-ALMACENES.xlsx")}else{m(d.usuario.id_empresa,e.sucursal.id,e.almacen&&null!==e.almacen&&0!==e.almacen?e.almacen.id:0,d.usuario.id).then(function(e){for(var t=e.inventario,a=[["Código","Nombre","Unidad de Medida","Precio Unitario","Descripción","Inventario Mínimo","Grupo","Sub-Grupo","Carac. Esp. 1","Carac. Esp. 2","Codigo de fabrica","Cant.","Costo Unitario","Total General","Fecha Vencimiento","Lote","Sucursal","Almacen"]],o=0;o<t.length;o++){t[o].fecha_vencimiento=t[o].fecha_vencimiento?new Date(t[o].fecha_vencimiento):null;var n=[];n.push(t[o].codigo),n.push(t[o].nombre),n.push(t[o].unidad_medida),n.push(t[o].precio_unitario),n.push(t[o].descripcion),n.push(t[o].inventario_minimo),n.push(t[o].grupo),n.push(t[o].subgrupo),n.push(t[o].caracteristica_especial1),n.push(t[o].caracteristica_especial2),n.push(t[o].codigo_fabrica),n.push(t[o].cantidad),n.push(t[o].costo_unitario),n.push(t[o].costo_total),n.push(t[o].fecha_vencimiento),n.push(t[o].lote),n.push(t[o].nombre_sucursal),n.push(t[o].nombre_almacen),a.push(n)}var r="SheetJS",i=new Workbook,s=sheet_from_array_of_arrays(a);i.SheetNames.push(r),i.Sheets[r]=s;var c=XLSX.write(i,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(c)],{type:"application/octet-stream"}),"REPORTE-ALMACENES.xlsx")})}h.stop()},d.dibujarCabeceraPDFAlmacenes=function(e,t,a){e.font("Helvetica-Bold",12),e.text("REPORTE ALMACENES",0,25,{align:"center"}),e.font("Helvetica-Bold",10),e.text("SUCURSAL:"+d.reporte.sucursal.nombre+" - ALMACEN:"+(null!==d.reporte.almacen&&void 0!==d.reporte.almacen&&0!==d.reporte.almacen?d.reporte.almacen.nombre:"TODOS LOS ALMACENES"),0,38,{align:"center"}),e.font("Helvetica-Bold",8),e.text("PÁGINA "+t+" DE "+a,0,750,{align:"center"}),e.rect(30,50,555,30).stroke(),e.font("Helvetica-Bold",8),e.text("Código",45,60),e.text("Cant.",110,60,{width:50}),e.text("Unid.",160,60,{width:50}),e.text("Descripción",210,60,{width:170}),d.usuario.empresa.usar_vencimientos&&(e.text("Venc.",380,60),e.text("Lote",430,60)),e.text("Costo Unitario",470,60,{width:50}),e.text("Total General",530,60,{width:50})},d.inicio()}]).controller("ControladorVentasMensuales",["$scope","$localStorage","$location","$templateCache","$route","blockUI","ClasesTipo","ReporteVentasMensualesDatos",function(p,e,t,a,o,d,n,r){p.usuario=JSON.parse(e.usuario),p.inicio=function(){p.obtenerGestiones(),p.sucursales=p.obtenerSucursales(),p.reporte={},p.reporte.sucursal=1==p.sucursales.length?p.sucursales[0]:null,ejecutarScriptsVentasMensuales()},p.obtenerSucursales=function(){var e=[];1<p.usuario.sucursalesUsuario.length&&e.push({id:0,nombre:"TODOS"});for(var t=0;t<p.usuario.sucursalesUsuario.length;t++)e.push(p.usuario.sucursalesUsuario[t].sucursal);return e},p.obtenerGestiones=function(){d.start(),n("GTN").then(function(e){p.gestiones=e.clases,d.stop()})},p.generarExcelVentasMensuales=function(e){d.start(),inicio=new Date(p.convertirFecha(e.fechaInicioTexto)),fin=new Date(p.convertirFecha(e.fechaFinTexto)),r(p.usuario.id_empresa,e.sucursal.id,inicio,fin).then(function(e){var t=JSON.parse(e.detallesVenta);console.log("ventasssss ===== ",t);var a=[["FECHA DE LA FACTURA","N° DE LA FACTURA","N° DE AUTORIZACION","NIT/CI CLIENTE","NOMBRE O RAZON SOCIAL","UBICACION CLIENTE","CODIGO","DETALLE","UNIDAD","GRUPO","CANTIDAD","PU","TOTAL","IMPORTE ICE/IEHD/TASAS","EXPORTACIONES Y OPERACIONES EXENTAS","VENTAS GRAVADAS A TASA CERO","SUBTOTAL","DESCUENTOS, BONIFICACIONES Y REBAJAS OBTENIDAS","IMPORTE BASE PARA DEBITO FISCAL","DEBITO FISCAL","SUCURSAL","USUARIO","TIPO DE PAGO"]];p.usuario.empresa.usar_vencimientos&&(a[0].push("FECHA VENCIMIENTO"),a[0].push("LOTE")),a[0].push("VENDEDOR");for(var o=0;o<t.length;o++){var n=[];t[o].venta.fecha=new Date(t[o].venta.fecha),n.push(t[o].venta.fecha),n.push(t[o].venta.factura),n.push(t[o].venta.autorizacion),n.push(t[o].venta.cliente.nit),n.push(t[o].venta.cliente.razon_social),n.push(t[o].venta.cliente.ubicacion_geografica),n.push(t[o].producto.codigo),n.push(t[o].producto.nombre),n.push(t[o].producto.unidad_medida),t[o].producto.grupo?n.push(t[o].producto.grupo.nombre):n.push(""),n.push(t[o].cantidad),n.push(t[o].precio_unitario),n.push(t[o].importe),n.push(t[o].ice),n.push(0),n.push(0),n.push(t[o].importe-t[o].ice);var r=t[o].importe-t[o].ice-t[o].excento+t[o].recargo;n.push(r),n.push(t[o].total),n.push(Math.round(.13*t[o].total*100)/100),n.push(t[o].venta.almacen.sucursal.nombre),n.push(t[o].venta.usuario.nombre_usuario),n.push(t[o].venta.tipoPago.nombre),p.usuario.empresa.usar_vencimientos&&(t[o].inventario?(t[o].inventario.fecha_vencimiento=new Date(t[o].inventario.fecha_vencimiento),n.push(t[o].inventario.fecha_vencimiento),n.push(t[o].inventario.lote)):null!=t[o].lote?(t[o].fecha_vencimiento=new Date(t[o].fecha_vencimiento),n.push(t[o].fecha_vencimiento),n.push(t[o].lote)):(n.push(""),n.push(""))),n.push(t[o].venta.vendedor?t[o].venta.vendedor.persona.nombre_completo:""),a.push(n)}var i="SheetJS",s=new Workbook,c=sheet_from_array_of_arrays(a);s.SheetNames.push(i),s.Sheets[i]=c;var l=XLSX.write(s,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(l)],{type:"application/octet-stream"}),"VENTAS-MENSUALES.xlsx"),d.stop()})},p.generarPdfVentasMensuales=function(u){d.start(),inicio=new Date(p.convertirFecha(u.fechaInicioTexto)),fin=new Date(p.convertirFecha(u.fechaFinTexto)),r(p.usuario.id_empresa,u.sucursal.id,inicio,fin).then(function(e){var t=JSON.parse(e.detallesVenta),a=new PDFDocument({compress:!1,margin:10}),o=a.pipe(blobStream());a.font("Helvetica",8);var n=150,r=0,i=1;p.dibujarCabeceraPDFVentasMensuales(a,e,u,i);for(var s=0;s<t.length&&r<=15;s++)a.rect(40,n-10,540,40).stroke(),a.font("Helvetica",8),t[s].venta.fecha=new Date(t[s].venta.fecha),a.text(t[s].venta.fecha.getDate()+"/"+(t[s].venta.fecha.getMonth()+1)+"/"+t[s].venta.fecha.getFullYear().toString().substr(-2),45,n),a.text(t[s].venta.factura?t[s].venta.factura:"",80,n),a.font("Helvetica",7),a.text(t[s].venta.cliente.razon_social,115,n-2,{width:80}),a.text(t[s].producto.nombre,205,n-2,{width:80}),a.font("Helvetica",8),a.text(t[s].cantidad,300,n,{width:50}),a.text(t[s].producto.unidad_medida,330,n,{width:50}),p.usuario.empresa.usar_vencimientos&&t[s].inventario&&(t[s].inventario.fecha_vencimiento=new Date(t[s].inventario.fecha_vencimiento),a.text(t[s].inventario.fecha_vencimiento.getDate()+"/"+(t[s].inventario.fecha_vencimiento.getMonth()+1)+"/"+t[s].inventario.fecha_vencimiento.getFullYear().toString().substr(-2),385,n),a.text(t[s].inventario.lote,435,n)),a.text(t[s].descuento,475,n),a.text(t[s].recargo,505,n),a.text(t[s].total,535,n),n+=40,15!=++r&&s+1!=t.length||s+1==t.length||(a.addPage({margin:0,bufferPages:!0}),n=150,r=0,i+=1,p.dibujarCabeceraPDFVentasMensuales(a,e,u,i),a.font("Helvetica",8));var c=new Date,l=c.getMinutes();l<10&&(l="0"+l),a.text("USUARIO: "+p.usuario.nombre_usuario,45,n),a.text("IMPRESION : "+c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear()+" Hr. "+c.getHours()+":"+l,175,n),a.end(),o.on("finish",function(){var e=o.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),d.stop()})},p.dibujarCabeceraPDFVentasMensuales=function(e,t,a,o){e.font("Helvetica-Bold",12),e.text("REPORTE DE VENTAS",0,25,{align:"center"}),e.font("Helvetica",8),e.text("Desde  "+a.fechaInicioTexto,-70,40,{align:"center"}),e.text("Hasta "+a.fechaFinTexto,70,40,{align:"center"}),e.text("FOLIO "+o,550,25),e.rect(40,60,540,40).stroke(),e.font("Helvetica-Bold",8),e.text("NOMBRE O RAZÓN SOCIAL : ",65,75),e.text("NIT : ",440,75),e.font("Helvetica",8),e.text(t.empresa.razon_social,195,75),e.text(t.empresa.nit,460,75),e.rect(40,100,540,40).stroke(),e.font("Helvetica-Bold",8),e.text("Fecha",45,110,{width:40}),e.text("Nº De Nota",80,110,{width:30}),e.text("Cliente",115,110),e.text("Producto",205,110),e.text("Cant.",290,110),e.text("Unidad",330,110),e.text("Fecha Venc",385,110,{width:30}),e.text("Lote",435,110,{width:35}),e.text("Desc.",470,110),e.text("Rec.",500,110),e.text("Total",535,110)},p.inicio()}]).controller("ControladorEstadoResultadosNoContable",["$scope","$localStorage","$location","$templateCache","$route","blockUI","GastosVariosLista","ReporteEstadoResultadosNoContableDatos",function(O,e,t,a,o,T,n,r){O.usuario=JSON.parse(e.usuario),O.idModalGastos="dialog-gastos",O.$on("$viewContentLoaded",function(){resaltarPestaña(t.path().substring(1)),ejecutarScriptsEstadoResultadosNoContable(O.idModalGastos),O.buscarAplicacion(O.usuario.aplicacionesUsuario,t.path().substring(1)),T.stop()}),O.abrirPopupGastos=function(){O.gasto=null,O.abrirPopup(O.idModalGastos)},O.cerrarPopupGastos=function(){O.cerrarPopup(O.idModalGastos)},O.inicio=function(){},O.generarEstadoResultadosNoContable=function(S,e,t){O.cerrarPopupGastos(),T.start(),e=new Date(O.convertirFecha(e)),t=new Date(O.convertirFecha(t));var a=r(O.usuario.id_empresa,e,t);a.then(function(D){(a=n(O.usuario.id_empresa,e,t)).then(function(e){for(var t=0,a=0,o=0,n=0,r=0,i=0,s=0,c=0,l=0,u=0,p=0;p<D.length;p++)if(D[p].movimiento){if(D[p].movimiento.clase.nombre_corto==O.diccionario.EGRE_FACTURACION||D[p].movimiento.clase.nombre_corto==O.diccionario.EGRE_PROFORMA){D[p].movimiento.clase.nombre_corto==O.diccionario.EGRE_FACTURACION?(l+=.87*D[p].total,t+=.87*D[p].total,null!=D[p].tipoPago&&(D[p].tipoPago.nombre==O.diccionario.TIPO_PAGO_CREDITO?(o+=.87*D[p].total,r+=.87*D[p].total):D[p].tipoPago.nombre==O.diccionario.TIPO_PAGO_CONTADO&&(n+=.87*D[p].total,c+=.87*D[p].total))):(l+=D[p].total,t+=D[p].total,null!=D[p].tipoPago&&(D[p].tipoPago.nombre==O.diccionario.TIPO_PAGO_CREDITO?(o+=D[p].total,r+=D[p].total):D[p].tipoPago.nombre==O.diccionario.TIPO_PAGO_CONTADO&&(n+=D[p].total,c+=D[p].total)));for(var d=0;d<D[p].movimiento.detallesMovimiento.length;d++)u+=D[p].movimiento.detallesMovimiento[d].total}}else l+=.87*D[p].total,a+=.87*D[p].total,null!=D[p].tipoPago&&(D[p].tipoPago.nombre==O.diccionario.TIPO_PAGO_CREDITO?(o+=.87*D[p].total,s+=.87*D[p].total):D[p].tipoPago.nombre==O.diccionario.TIPO_PAGO_CONTADO&&(n+=.87*D[p].total,i+=.87*D[p].total));l=Math.round(100*l)/100,u=Math.round(100*u)/100,t=Math.round(100*t)/100,a=Math.round(100*a)/100,r=Math.round(100*r)/100,i=Math.round(100*i)/100,s=Math.round(100*s)/100,c=Math.round(100*c)/100;var h=Math.round(100*(l-u))/100,m=0;for(p=0;p<e.length;p++)for(d=0;d<e[p].detallesCompra.length;d++)m+=e[p].detallesCompra[d].total;var v=h-(m=Math.round(100*(m-.13*m))/100+S),f=new PDFDocument({margin:10}),g=f.pipe(blobStream()),x=O.filtro.fechaInicioTexto,b=O.filtro.fechaFinTexto;f.font("Helvetica-Bold",16),f.text("ESTADO DE RESULTADOS NO CONTABLE",0,60,{align:"center"}),f.font("Helvetica-Bold",10),f.text("Desde "+x+" al "+b,0,80,{align:"center"}),f.font("Helvetica-Bold",8),f.text("VENTAS",100,100),f.text(l,300,100),f.font("Helvetica",8),f.text("PRODUCTO",100,110),f.text(t,170,110),f.text("SERVICIO",100,120),f.text(a,170,120),f.font("Helvetica-Bold",8),f.text("COSTO DE VENTAS",100,200),f.text(u,300,200),f.text("UTILIDAD BRUTA EN VENTAS",100,250),f.text(h,300,250),f.text("GASTOS",100,300),f.text(m,300,300),f.font("Helvetica-Bold",8),f.text("VENTAS CONTADO",150,130),f.text(Math.round(100*n)/100,250,130),f.font("Helvetica",8),f.text("PRODUCTOS",150,140),f.text(c,250,140),f.text("SERVICIOS",150,150),f.text(i,250,150),f.font("Helvetica-Bold",8),f.text("VENTAS CREDITO",150,160),f.text(Math.round(100*o)/100,250,160),f.font("Helvetica",8),f.text("PRODUCTOS",150,170),f.text(r,250,170),f.text("SERVICIOS",150,180),f.text(s,250,180),f.font("Helvetica-Bold",8);var E=330,A=0;for(p=0;p<e.length;p++){f.text(e[p].nombre,130,E);for(d=A=0;d<e[p].detallesCompra.length;d++)A+=e[p].detallesCompra[d].total;f.text(Math.round(100*(A-.13*A))/100,280,E),E+=25}f.text("OTROS GASTOS",130,E),f.text(S,280,E),f.font("Helvetica-Bold",8);var C=0<=v?"UTILIDAD DEL PERIODO":"PÉRDIDA DEL PERIODO";f.text(C,100,E+25),f.text(v,300,E+25),f.end(),g.on("finish",function(){var e=g.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),T.stop()})})},O.generarExcelAlmacenes=function(){T.start(),InventariosCosto(O.usuario.id_empresa).then(function(e){for(var t=[["Código","Cant.","Unid.","Descripción","Costo Unitario","Total General"]],a=0;a<e.length;a++){var o=[];o.push(e[a].producto.codigo),o.push(e[a].cantidad),o.push(e[a].producto.unidad_medida),o.push(e[a].producto.nombre),o.push(e[a].costo_unitario),o.push(e[a].costo_total),t.push(o)}var n="SheetJS",r=new Workbook,i=sheet_from_array_of_arrays(t);r.SheetNames.push(n),r.Sheets[n]=i;var s=XLSX.write(r,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(s)],{type:"application/octet-stream"}),"REPORTE-ALMACENES.xlsx"),T.stop()})},O.dibujarCabeceraPDFAlmacenes=function(e,t,a){e.font("Helvetica-Bold",12),e.text("REPORTE ALMACENES",0,25,{align:"center"}),e.font("Helvetica-Bold",8),e.text("PÁGINA "+t+" DE "+a,0,750,{align:"center"}),e.rect(30,50,555,30).stroke(),e.font("Helvetica-Bold",8),e.text("Código",45,60),e.text("Cant.",110,60,{width:50}),e.text("Unid.",160,60,{width:50}),e.text("Descripción",210,60,{width:300}),e.text("Costo Unitario",470,60,{width:50}),e.text("Total General",530,60,{width:50})},O.inicio()}]).controller("ControladorComprasMensuales",["$scope","$localStorage","$location","$templateCache","$route","blockUI","ClasesTipo","ReporteComprasMensualesDatos",function(p,e,t,a,o,d,n,r){p.usuario=JSON.parse(e.usuario),p.inicio=function(){p.obtenerGestiones(),p.sucursales=p.obtenerSucursales(),p.reporte={},p.reporte.sucursal=1==p.sucursales.length?p.sucursales[0]:null,ejecutarScriptsVentasMensuales()},p.obtenerSucursales=function(){var e=[];1<p.usuario.sucursalesUsuario.length&&e.push({id:0,nombre:"TODOS"});for(var t=0;t<p.usuario.sucursalesUsuario.length;t++)e.push(p.usuario.sucursalesUsuario[t].sucursal);return e},p.obtenerGestiones=function(){d.start(),n("GTN").then(function(e){p.gestiones=e.clases,d.stop()})},p.generarExcelComprasMensuales=function(e){d.start(),inicio=new Date(p.convertirFecha(e.fechaInicioTexto)),fin=new Date(p.convertirFecha(e.fechaFinTexto)),r(p.usuario.id_empresa,e.sucursal.id,inicio,fin).then(function(e){for(var t=e.detallesCompra,a=[["FECHA DE LA FACTURA","N° DE LA FACTURA","N° DE AUTORIZACION","NIT/CI CLIENTE","NOMBRE O RAZON SOCIAL","CODIGO","DETALLE","UNIDAD","GRUPO","CANTIDAD","PU","TOTAL","IMPORTE ICE/IEHD/TASAS","EXENTOS","SUBTOTAL","DESCUENTOS, BONIFICACIONES Y REBAJAS OBTENIDAS","IMPORTE BASE PARA DEBITO FISCAL","CREDITO FISCAL","FECHA DE VENCIMIENTO","LOTE","SUCURSAL","USUARIO","CENTRO DE COSTOS"]],o=0;o<t.length;o++){var n=[];t[o].compra.fecha=new Date(t[o].compra.fecha),n.push(t[o].compra.fecha),n.push(t[o].compra.factura),n.push(t[o].compra.autorizacion),n.push(t[o].compra.proveedor.nit),n.push(t[o].compra.proveedor.razon_social),n.push(t[o].producto.codigo),n.push(t[o].producto.nombre),n.push(t[o].producto.unidad_medida),t[o].producto.grupo?n.push(t[o].producto.grupo.nombre):n.push(""),n.push(t[o].cantidad),n.push(t[o].costo_unitario),n.push(t[o].importe),n.push(t[o].ice),n.push(t[o].excento),n.push(t[o].importe-t[o].ice);var r=t[o].importe-t[o].ice-t[o].excento+t[o].recargo;n.push(r),n.push(t[o].total),n.push(Math.round(.13*t[o].total*100)/100),t[o].inventario?(n.push(new Date(t[o].inventario.fecha_vencimiento)),n.push(t[o].inventario.lote)):(n.push(""),n.push("")),console.log(o),n.push(t[o].compra.almacen.sucursal?t[o].compra.almacen.sucursal.nombre:""),n.push(p.usuario.nombre_usuario),n.push(t[o].centroCosto.nombre_corto),a.push(n)}var i="SheetJS",s=new Workbook,c=sheet_from_array_of_arrays(a);s.SheetNames.push(i),s.Sheets[i]=c;var l=XLSX.write(s,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(l)],{type:"application/octet-stream"}),"COMPRAS-MENSUALES.xlsx"),d.stop()})},p.generarPdfComprasMensuales=function(u){d.start(),inicio=new Date(p.convertirFecha(u.fechaInicioTexto)),fin=new Date(p.convertirFecha(u.fechaFinTexto)),r(p.usuario.id_empresa,u.sucursal.id,inicio,fin).then(function(e){var t=e.detallesCompra,a=new PDFDocument({margin:10}),o=a.pipe(blobStream());a.font("Helvetica",8);var n=150,r=0,i=1;p.dibujarCabeceraPDFcomprasMensuales(a,e,u,i);for(var s=0;s<t.length&&r<=15;s++)a.rect(40,n-10,540,40).stroke(),t[s].compra.fecha=new Date(t[s].compra.fecha),a.text(t[s].compra.fecha.getDate()+"/"+(t[s].compra.fecha.getMonth()+1)+"/"+t[s].compra.fecha.getFullYear(),45,n),a.text(t[s].compra.factura?t[s].compra.factura:"",90,n),a.text(t[s].compra.proveedor?t[s].compra.proveedor.razon_social:"",135,n-6,{width:80}),console.log(s),a.text(t[s].producto?t[s].producto.nombre:t[s].servicio?t[s].servicio.nombre:"",225,n-6,{width:80}),a.text(t[s].producto?t[s].producto.unidad_medida:"",300,n,{width:50}),t[s].inventario&&(t[s].inventario.fecha_vencimiento=new Date(t[s].inventario.fecha_vencimiento),a.text(t[s].inventario.fecha_vencimiento.getDate()+"/"+(t[s].inventario.fecha_vencimiento.getMonth()+1)+"/"+t[s].inventario.fecha_vencimiento.getFullYear(),345,n),a.text(t[s].inventario.lote,405,n)),a.text(t[s].descuento,445,n),a.text(t[s].recargo,495,n),a.text(t[s].total,535,n),n+=40,15!=++r&&s+1!=t.length||s+1==t.length||(a.addPage({margin:0,bufferPages:!0}),n=150,r=0,i+=1,p.dibujarCabeceraPDFcomprasMensuales(a,e,u,i),a.font("Helvetica",8));var c=new Date,l=c.getMinutes();l<10&&(l="0"+l),a.text("USUARIO: "+p.usuario.nombre_usuario,45,n),a.text("IMPRESION : "+c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear()+" Hr. "+c.getHours()+":"+l,175,n),a.end(),o.on("finish",function(){var e=o.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),d.stop()})},p.dibujarCabeceraPDFcomprasMensuales=function(e,t,a,o){e.font("Helvetica-Bold",12),e.text("REPORTE DE COMPRAS",0,25,{align:"center"}),e.font("Helvetica",8),e.text("Desde  "+a.fechaInicioTexto,-70,40,{align:"center"}),e.text("Hasta "+a.fechaFinTexto,70,40,{align:"center"}),e.text("FOLIO "+o,550,25),e.rect(40,60,540,40).stroke(),e.font("Helvetica-Bold",8),e.text("NOMBRE O RAZÓN SOCIAL : ",65,75),e.text("NIT : ",440,75),e.font("Helvetica",8),e.text(t.empresa.razon_social,195,75),e.text(t.empresa.nit,460,75),e.rect(40,100,540,40).stroke(),e.font("Helvetica-Bold",8),e.text("Fecha",45,110,{width:40}),e.text("Nº De Nota",80,110),e.text("Proveedor",135,110),e.text("Producto",225,110),e.text("Unidad",300,110),e.text("Fecha Venc",345,110),e.text("Lote",405,110,{width:35}),e.text("Descuento",440,110),e.text("Recargo",490,110),e.text("Total",535,110),e.font("Helvetica",8)},p.inicio()}]);