angular.module("agil.controladores").controller("ControladorFacturas",["$scope","$localStorage","$location","$templateCache","$route","blockUI","ConfiguracionesFactura","ConfiguracionGeneralFacturaDato","ClasesTipo","ConfiguracionFacturaSucursal","ConfiguracionFacturaEmpresa",function(n,o,a,i,r,t,e,c,u,s,d){t.start(),n.idModalWizardConfiguracionEdicion="modal-wizard-configuracion-edicion",n.idModalWizardConfiguracionGeneralEdicion="modal-wizard-configuracion-general-edicion",n.idModalContenedorConfiguracionEdicion="modal-wizard-container-configuracion-edicion",n.idModalContenedorConfiguracionGeneralEdicion="modal-wizard-container-configuracion-general-edicion",n.usuario=JSON.parse(o.usuario),n.obtenerImpresionesFactura=function(){t.start(),u("IMPFACT").then(function(o){n.impresionesFactura=o.clases,t.stop()})},n.obtenerTiposFacturacion=function(){t.start(),u("TIPOFACT").then(function(o){n.tiposFacturacion=o.clases,t.stop()})},n.obtenerTamanosPapelFactura=function(){t.start(),u("TAMPAPFACT").then(function(o){n.tamanosPapelFactura=o.clases,t.stop()})},n.obtenerTitulosFactura=function(){t.start(),u("TITFACT").then(function(o){n.titulosFactura=o.clases,t.stop()})},n.obtenerSubtitulosFactura=function(){t.start(),u("SUBTITFACT").then(function(o){n.subTitulosFactura=o.clases,t.stop()})},n.obtenerPiesFactura=function(){t.start(),u("PIÉFACT").then(function(o){n.piesFactura=o.clases,t.stop()})},n.obtenerFormatoFactura=function(){t.start(),u("FORM_IMP_FAC").then(function(o){n.formatosFactura=o.clases,t.stop()})},n.obtenerFormatoFacturaColor=function(){t.start(),u("FORM_IMP_FAC_COL").then(function(o){n.formatosFacturaColor=o.clases,t.stop()})},n.obtenerConfiguracionesFactura=function(){t.start(),e(n.usuario.id_empresa).then(function(o){n.sucursales=o,t.stop()})},n.obtenerConfiguracionGeneralFactura=function(){t.start(),c(n.usuario.id_empresa).then(function(o){n.configuracion_general=o,console.log(n.configuracion_general),t.stop()})},n.$on("$routeChangeStart",function(o,a){n.eliminarPopup(n.idModalWizardConfiguracionEdicion),n.eliminarPopup(n.idModalWizardConfiguracionGeneralEdicion)}),n.inicio=function(){n.obtenerConfiguracionesFactura(),n.obtenerConfiguracionGeneralFactura(),n.obtenerImpresionesFactura(),n.obtenerTiposFacturacion(),n.obtenerTamanosPapelFactura(),n.obtenerTitulosFactura(),n.obtenerSubtitulosFactura(),n.obtenerPiesFactura(),n.obtenerFormatoFactura(),n.obtenerFormatoFacturaColor(),setTimeout(function(){ejecutarScriptsTabla("tabla-configuraciones",7),ejecutarScriptsTabla("tabla-configuracion-general",7)},2e3)},n.$on("$viewContentLoaded",function(){resaltarPestaña(a.path().substring(1)),ejecutarScriptsConfiguracionFactura(n.idModalWizardConfiguracionEdicion,n.idModalContenedorConfiguracionEdicion,n.idModalWizardConfiguracionGeneralEdicion,n.idModalContenedorConfiguracionGeneralEdicion),n.buscarAplicacion(n.usuario.aplicacionesUsuario,a.path().substring(1)),t.stop()}),n.cerrarPopPupEdicion=function(){n.cerrarPopup(n.idModalWizardConfiguracionEdicion)},n.cerrarPopPupEdicionGeneral=function(){n.cerrarPopup(n.idModalWizardConfiguracionGeneralEdicion)},n.modificarConfiguracionSucursal=function(o){n.sucursal=o,n.abrirPopup(n.idModalWizardConfiguracionEdicion)},n.modificarConfiguracionGeneralFactura=function(o){n.abrirPopup(n.idModalWizardConfiguracionGeneralEdicion)},n.guardarConfiguracion=function(o){"Siguiente"!=$("#siguiente").text().trim()&&(t.start(),s.update({id_configuracion:o.configuracionFactura.id},o,function(o){t.stop(),n.cerrarPopPupEdicion(),n.mostrarMensaje(o.mensaje),n.recargarItemsTabla()}))},n.guardarConfiguracionGeneral=function(o){console.log($("#siguiente-g").text().trim()),"Siguiente"!=$("#siguiente-g").text().trim()&&(t.start(),d.update({id_configuracion:o.id},o,function(o){t.stop(),n.cerrarPopPupEdicionGeneral(),n.mostrarMensaje(o.mensaje),n.recargarItemsTabla()}))},n.inicio()}]);