angular.module("agil.controladores").controller("ControladorGtmGeoLocalizacion",["$scope","$localStorage","$location","$templateCache","$route","blockUI","Paginator","FieldViewer","ClasesTipo","ClasesTipoEmpresa","GtmDespachosUbicacion","uiGmapGoogleMapApi","$timeout","BuscarDespachosVendedor","FiltrarVendedorEmpresa",function(r,a,o,e,t,i,n,l,d,c,s,p,u,g,h){i.start(),r.usuario=JSON.parse(a.usuario),r.ModalVendedorMapa="dialog-vendedor-mapa",r.ModalFiltroMapa="dialog-mapa-despachos",r.$on("$viewContentLoaded",function(){resaltarPesta√±a(o.path().substring(1)),ejecutarScriptGeoLocalizacion(r.ModalVendedorMapa,r.ModalFiltroMapa),r.buscarAplicacion(r.usuario.aplicacionesUsuario,o.path().substring(1))}),r.inicio=function(){r.obtenerDespachados(),r.map={center:{latitude:-17.40380000777538,longitude:-66.1134901218414},zoom:10,bounds:{northeast:{latitude:-17.403800007775388,longitude:-66.11349012184144}}},r.options={scrollwheel:!1,mapTypeId:google.maps.MapTypeId.SATELLITE}},r.abrirDialogVendedorMapa=function(){u(function(){r.$apply(function(){google.maps.event.trigger(r.map,"resize")})},2e3),r.abrirPopup(r.ModalVendedorMapa)},r.cerrarDialogVendedorMapa=function(){r.cerrarPopup(r.ModalVendedorMapa)},r.abrirDialogFiltroMapa=function(){r.abrirPopup(r.ModalFiltroMapa)},r.cerrarDialogFiltroMapa=function(){r.cerrarPopup(r.ModalFiltroMapa)},r.obtenerDespachados=function(){i.start(),r.paginator=n(),r.paginator.column="id",r.paginator.direccion="asc";var a={id_empresa:r.usuario.id_empresa,inicio:0,fin:0,cliente:0,vendedor:0};r.paginator.callBack=r.buscarDespachados,r.paginator.getSearch("",a,null),i.stop()},r.buscarDespachados=function(){i.start(),s(r.paginator).then(function(a){r.paginator.setPages(a.paginas),r.despachos=a.detallesDespacho,r.totalesDespachos={producto:0,servicio_transporte:0,total:0},r.despachos.forEach(function(a,o,e){r1=dec2gms(a.latitud,"LATITUD"),r2=dec2gms(a.latitud,"LONGITUD"),a.cordenada_latitud=r1.valor,a.cordenada_longitud=r2.valor}),i.stop()})},r.interceptarTecla=function(a,o,e){13===a.which&&(e?r.enfocar(o):u(function(){$("#"+o).trigger("click")},0))},r.buscarVendedor=function(a){if(""!=a&&null!=a)return h(r.usuario.id_empresa,a)},r.verUbicacionDespacho=function(a){r.markers=[];var o={id:1,coords:{latitude:a.latitud,longitude:a.longitud},window:{title:a.despacho.cliente.razon_social}};r.markers.push(o),r.map={center:{latitude:a.latitud,longitude:a.longitud},zoom:13,bounds:{northeast:{latitude:a.latitud,longitude:a.longitud}}},r.abrirDialogVendedorMapa()},r.GenerarMapaDespachosVendedor=function(a){r.markers=[],a.fechaBusqueda=new Date(r.convertirFecha(a.fecha)),g(a).then(function(t){var i={};t.detallesDespacho.forEach(function(a,o,e){i={id:o,coords:{latitude:a.latitud,longitude:a.longitud},window:{title:a.despacho.cliente.razon_social}},r.markers.push(i),o===e.length-1&&(r.map={center:{latitude:t.detallesDespacho[0].latitud,longitude:t.detallesDespacho[0].longitud},zoom:13,bounds:{northeast:{latitude:t.detallesDespacho[0].latitud,longitude:t.detallesDespacho[0].longitud}}},r.abrirDialogVendedorMapa(),r.cerrarDialogFiltroMapa())})})},r.$on("$routeChangeStart",function(a,o){r.eliminarPopup(r.ModalVendedorMapa),scope.eliminarPopup(r.ModalFiltroMapa)}),r.inicio()}]);