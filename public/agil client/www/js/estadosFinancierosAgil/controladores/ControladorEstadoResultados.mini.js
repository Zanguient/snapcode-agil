angular.module("agil.controladores").controller("ControladorEstadoResultados",function(o,e,n,a,r,t,i,c,u,s,m){o.usuario=JSON.parse(e.usuario),o.inicio=function(){o.obtenerTiposPeriodos(),o.obtenerGestiones(),o.obtenerTiposCuenta(),o.obtenerConfiguracionImpresion(),o.obtenerGestionesImpresion()},o.$on("$viewContentLoaded",function(){resaltarPestaña(n.path().substring(1)),o.buscarAplicacion(o.usuario.aplicacionesUsuario,n.path().substring(1)),t.stop()}),o.obtenerTiposPeriodos=function(){t.start(),c("EEFF_TP").then(function(e){o.TiposPeriodos=e,t.stop()})},o.obtenerGestiones=function(){t.start(),c("GTN").then(function(e){o.gestiones=e.clases,t.stop()})},o.obtenerConfiguracionImpresion=function(){u(o.usuario.id_empresa).then(function(e){o.configuracionImpresion=e,o.configuracionImpresion.bimonetario=!0,o.configuracionImpresion.tioPeriodo="",o.configuracionImpresion.gestion="",o.configuracionImpresion.gestion_fin="",o.configuracionImpresion.mes="",o.configuracionImpresion.fecha_inicio=null,o.configuracionImpresion.fecha_fin=null,t.stop()})},o.cargarFechasFiltro=function(o){"FECHAS"==o&&setTimeout(function(){aplicarDatePickers()},300)},o.obtenerTiposCuenta=function(){t.start(),c("TCC").then(function(e){o.cuentaTipos=[{id:0,nombre:"PREESTABLECIDO"}],o.cuentaTipos=o.cuentaTipos.concat(e.clases),t.stop()})},o.obtenerGestionesImpresion=function(){t.start(),o.gestionesEF=[],m(o.usuario.id_empresa).then(function(e){t.stop(),e.forEach(function(e){e.habilitado&&(o.fechasImpresion=e)})})},o.generarPdfBalanceGeneral=function(){t.start(),o.configuracionImpresion.fecha_inicio&&(o.configuracionImpresion.inicio2=new Date(o.convertirFecha(o.configuracionImpresion.fecha_inicio)),o.configuracionImpresion.fin2=new Date(o.convertirFecha(o.configuracionImpresion.fecha_fin))),o.configuracionImpresion.fechasImpresion=o.fechasImpresion,s(o.configuracionImpresion,o.usuario.id_empresa).then(function(e){e.monedaCambio?o.moneda=e.monedaCambio:o.moneda={ufv:"--",dolar:"--"};var n=0,a=0;e.cuentasSubGrupoEstadoResultado.forEach(function(o,e,r){for(var t=0;t<o.cuentasEstadoResultado.length;t++){o.cuentasEstadoResultado[t];"INGRESO"==o.clasificacion.nombre.toUpperCase()?n+=o.cuentasEstadoResultado[t].saldo:a+=o.cuentasEstadoResultado[t].saldo}});if("COMPARATIVO"!=o.configuracionImpresion.tipoPeriodo.nombre){var r=o.configuracionImpresion.bimonetario?400:530;"PREESTABLECIDO"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarPdfPreestablecido(e,r,e.cuentasGrupo,e.cuentasSubGrupo,e.cuentasGenericas,e.cuentasApropiacion,e.cuentasSubGrupoEstadoResultado,n,a):"GENERICA"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarPdfPreestablecido(e,r,e.cuentasGrupo,e.cuentasSubGrupo,e.cuentasGenericas,e.cuentasApropiacion,e.cuentasSubGrupoEstadoResultado,n,a):"GRUPO"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarPdfGrupo(e,r,e.cuentasSubGrupoEstadoResultado,n,a):"SUB GRUPO"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarPdfsubGrupo(e,r,e.cuentasSubGrupoEstadoResultado,n,a):"APROPIACION"==o.configuracionImpresion.tipo_cuenta.nombre&&o.generarPdfApropiacion(e,r,e.cuentasSubGrupoEstadoResultado,n,a)}else{var i=[],c=[],u=[],s=[],m=[],f=[],d=[];e.primero.cuentasGrupo.forEach(function(o,n,a){var r={};r.primerAno=o,i.push(r),n===a.length-1&&e.segundo.cuentasGrupo.forEach(function(o,e,n){for(var a=0;a<i.length;a++){var r=i[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),e.primero.cuentasSubGrupo.forEach(function(o,n,a){var r={};r.primerAno=o,c.push(r),n===a.length-1&&e.segundo.cuentasSubGrupo.forEach(function(o,e,n){for(var a=0;a<c.length;a++){var r=c[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),e.primero.cuentasGenericas.forEach(function(o,n,a){var r={};r.primerAno=o,u.push(r),n===a.length-1&&e.segundo.cuentasGenericas.forEach(function(o,e,n){for(var a=0;a<u.length;a++){var r=u[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),e.primero.cuentasApropiacion.forEach(function(o,n,a){var r={};r.primerAno=o,s.push(r),n===a.length-1&&e.segundo.cuentasApropiacion.forEach(function(o,e,n){for(var a=0;a<s.length;a++){var r=s[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),e.primero.cuentasSubGrupoFijo.forEach(function(o,n,a){var r={};r.primerAno=o,m.push(r),n===a.length-1&&e.segundo.cuentasSubGrupoFijo.forEach(function(o,e,n){for(var a=0;a<m.length;a++){var r=m[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),e.primero.cuentasGenericasFijo.forEach(function(o,n,a){var r={};r.primerAno=o,f.push(r),n===a.length-1&&e.segundo.cuentasGenericasFijo.forEach(function(o,e,n){for(var a=0;a<f.length;a++){var r=f[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),e.primero.cuentasApropiacionFijo.forEach(function(o,n,a){var r={};r.primerAno=o,d.push(r),n===a.length-1&&e.segundo.cuentasApropiacionFijo.forEach(function(o,e,n){for(var a=0;a<d.length;a++){var r=d[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})});r=o.configuracionImpresion.bimonetario?290:310;"PREESTABLECIDO"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarPdfComprobantePreestablecido(e,r,i,c,u,s,m,f,d):"GENERICA"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarPdfComprobantePreestablecido(e,r,i,c,u,cuentasApropiacioncuentasSubGrupoFijo,f,d):"GRUPO"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarPdfComparativoGrupo(e,r,i,c,u,cuentasApropiacioncuentasSubGrupoFijo,f,d):"SUB GRUPO"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarPdfComparativosubGrupo(e,r,i,c,u,cuentasApropiacioncuentasSubGrupoFijo,f,d):"APROPIACION"==o.configuracionImpresion.tipo_cuenta.nombre&&o.generarPdfComparativoApropiacion(e,r,i,c,u,cuentasApropiacioncuentasSubGrupoFijo,f,d),t.stop()}})},o.generarExelBalanceGeneral=function(){t.start(),o.configuracionImpresion.fecha_inicio&&(o.configuracionImpresion.inicio2=new Date(o.convertirFecha(o.configuracionImpresion.fecha_inicio)),o.configuracionImpresion.fin2=new Date(o.convertirFecha(o.configuracionImpresion.fecha_fin))),o.configuracionImpresion.fechasImpresion=o.fechasImpresion,s(o.configuracionImpresion,o.usuario.id_empresa).then(function(e){e.monedaCambio?o.moneda=e.monedaCambio:o.moneda={ufv:"--",dolar:"--"},e.arregloActivos=[],e.arregloActivosFijos=[],e.arregloPasivos=[],e.arregloPatrimonio=[],e.arregloIngreso=[],e.arregloEgreso=[],e.arregleCostos=[];if("COMPARATIVO"!=o.configuracionImpresion.tipoPeriodo.nombre){e.arregloPasivos=e.arregloPasivos.concat(e.arregloPatrimonio);var n=o.configuracionImpresion.bimonetario?400:530;"PREESTABLECIDO"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarExelAPreestablecido(e,n,e.cuentasGrupo,e.cuentasSubGrupo,e.cuentasGenericas,e.cuentasApropiacion):"GENERICA"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarExelAPreestablecido(e,n,e.cuentasGrupo,e.cuentasSubGrupo,e.cuentasGenericas,e.cuentasApropiacion):"GRUPO"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarExelGrupo(e,n,e.cuentasGrupo,e.cuentasSubGrupo,e.cuentasGenericas,e.cuentasApropiacion):"SUB GRUPO"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarExelSubGrupo(e,n,e.cuentasGrupo,e.cuentasSubGrupo,e.cuentasGenericas,e.cuentasApropiacion):"APROPIACION"==o.configuracionImpresion.tipo_cuenta.nombre&&o.generarExelApropiacion(e,n,e.cuentasGrupo,e.cuentasSubGrupo,e.cuentasGenericas,e.cuentasApropiacion)}else{var a=[],r=[],i=[],c=[],u=[],s=[],m=[];e.primero.cuentasGrupo.forEach(function(o,n,r){var t={};t.primerAno=o,a.push(t),n===r.length-1&&e.segundo.cuentasGrupo.forEach(function(o,e,n){for(var r=0;r<a.length;r++){var t=a[r];t.primerAno.id==o.id&&(t.segundoAno=o)}})}),e.primero.cuentasSubGrupo.forEach(function(o,n,a){var t={};t.primerAno=o,r.push(t),n===a.length-1&&e.segundo.cuentasSubGrupo.forEach(function(o,e,n){for(var a=0;a<r.length;a++){var t=r[a];t.primerAno.id==o.id&&(t.segundoAno=o)}})}),e.primero.cuentasGenericas.forEach(function(o,n,a){var r={};r.primerAno=o,i.push(r),n===a.length-1&&e.segundo.cuentasGenericas.forEach(function(o,e,n){for(var a=0;a<i.length;a++){var r=i[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),e.primero.cuentasApropiacion.forEach(function(o,n,a){var r={};r.primerAno=o,c.push(r),n===a.length-1&&e.segundo.cuentasApropiacion.forEach(function(o,e,n){for(var a=0;a<c.length;a++){var r=c[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),e.primero.cuentasSubGrupoFijo.forEach(function(o,n,a){var r={};r.primerAno=o,u.push(r),n===a.length-1&&e.segundo.cuentasSubGrupoFijo.forEach(function(o,e,n){for(var a=0;a<u.length;a++){var r=u[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),e.primero.cuentasGenericasFijo.forEach(function(o,n,a){var r={};r.primerAno=o,s.push(r),n===a.length-1&&e.segundo.cuentasGenericasFijo.forEach(function(o,e,n){for(var a=0;a<s.length;a++){var r=s[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),e.primero.cuentasApropiacionFijo.forEach(function(o,n,a){var r={};r.primerAno=o,m.push(r),n===a.length-1&&e.segundo.cuentasApropiacionFijo.forEach(function(o,e,n){for(var a=0;a<m.length;a++){var r=m[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})});n=o.configuracionImpresion.bimonetario?290:310;"PREESTABLECIDO"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarExelComprobantePreestablecido(e,n,a,r,i,c,u,s,m):"GENERICA"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarExelComprobantePreestablecido(e,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,m):"GRUPO"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarExelComparativoGrupo(e,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,m):"SUB GRUPO"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarExelComparativosubGrupo(e,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,m):"APROPIACION"==o.configuracionImpresion.tipo_cuenta.nombre&&o.generarExelComparativoApropiacion(e,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,m),t.stop()}})},o.generarWordBalanceGeneral=function(){t.start(),o.configuracionImpresion.fecha_inicio&&(o.configuracionImpresion.inicio2=new Date(o.convertirFecha(o.configuracionImpresion.fecha_inicio)),o.configuracionImpresion.fin2=new Date(o.convertirFecha(o.configuracionImpresion.fecha_fin))),o.configuracionImpresion.fechasImpresion=o.fechasImpresion,s(o.configuracionImpresion,o.usuario.id_empresa).then(function(e){if(e.monedaCambio?o.moneda=e.monedaCambio:o.moneda={ufv:"--",dolar:"--"},"COMPARATIVO"!=o.configuracionImpresion.tipoPeriodo.nombre){var n=o.configuracionImpresion.bimonetario?400:530;"PREESTABLECIDO"==o.configuracionImpresion.tipo_cuenta.nombre?o.descargarArchivo(o.generarWordPreestablecido(e,n,e.cuentasGrupo,e.cuentasSubGrupo,e.cuentasGenericas,e.cuentasApropiacion),"reporte-balance-general.doc"):"GENERICA"==o.configuracionImpresion.tipo_cuenta.nombre?o.descargarArchivo(o.generarWordPreestablecido(e,n,e.cuentasGrupo,e.cuentasSubGrupo,e.cuentasGenericas,e.cuentasApropiacion),"reporte-balance-general.doc"):"GRUPO"==o.configuracionImpresion.tipo_cuenta.nombre?o.descargarArchivo(o.generarWordGrupo(e,n,e.cuentasGrupo,e.cuentasSubGrupo,e.cuentasGenericas,e.cuentasApropiacion),"reporte-balance-general.doc"):"SUB GRUPO"==o.configuracionImpresion.tipo_cuenta.nombre?o.descargarArchivo(o.generarWordSubGrupo(e,n,e.cuentasGrupo,e.cuentasSubGrupo,e.cuentasGenericas,e.cuentasApropiacion),"reporte-balance-general.doc"):"APROPIACION"==o.configuracionImpresion.tipo_cuenta.nombre&&o.descargarArchivo(o.generarWordApropiacion(e,n,e.cuentasGrupo,e.cuentasSubGrupo,e.cuentasGenericas,e.cuentasApropiacion),"reporte-balance-general.doc")}else{var a=[],r=[],i=[],c=[],u=[],s=[],m=[];e.primero.cuentasGrupo.forEach(function(o,n,r){var t={};t.primerAno=o,a.push(t),n===r.length-1&&e.segundo.cuentasGrupo.forEach(function(o,e,n){for(var r=0;r<a.length;r++){var t=a[r];t.primerAno.id==o.id&&(t.segundoAno=o)}})}),e.primero.cuentasSubGrupo.forEach(function(o,n,a){var t={};t.primerAno=o,r.push(t),n===a.length-1&&e.segundo.cuentasSubGrupo.forEach(function(o,e,n){for(var a=0;a<r.length;a++){var t=r[a];t.primerAno.id==o.id&&(t.segundoAno=o)}})}),e.primero.cuentasGenericas.forEach(function(o,n,a){var r={};r.primerAno=o,i.push(r),n===a.length-1&&e.segundo.cuentasGenericas.forEach(function(o,e,n){for(var a=0;a<i.length;a++){var r=i[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),e.primero.cuentasApropiacion.forEach(function(o,n,a){var r={};r.primerAno=o,c.push(r),n===a.length-1&&e.segundo.cuentasApropiacion.forEach(function(o,e,n){for(var a=0;a<c.length;a++){var r=c[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),e.primero.cuentasSubGrupoFijo.forEach(function(o,n,a){var r={};r.primerAno=o,u.push(r),n===a.length-1&&e.segundo.cuentasSubGrupoFijo.forEach(function(o,e,n){for(var a=0;a<u.length;a++){var r=u[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),e.primero.cuentasGenericasFijo.forEach(function(o,n,a){var r={};r.primerAno=o,s.push(r),n===a.length-1&&e.segundo.cuentasGenericasFijo.forEach(function(o,e,n){for(var a=0;a<s.length;a++){var r=s[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})}),e.primero.cuentasApropiacionFijo.forEach(function(o,n,a){var r={};r.primerAno=o,m.push(r),n===a.length-1&&e.segundo.cuentasApropiacionFijo.forEach(function(o,e,n){for(var a=0;a<m.length;a++){var r=m[a];r.primerAno.id==o.id&&(r.segundoAno=o)}})});n=o.configuracionImpresion.bimonetario?290:310;"PREESTABLECIDO"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarWordComprobantePreestablecido(e,n,a,r,i,c,u,s,m):"GENERICA"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarWordComprobantePreestablecido(e,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,m):"GRUPO"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarWordComparativoGrupo(e,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,m):"SUB GRUPO"==o.configuracionImpresion.tipo_cuenta.nombre?o.generarWordComparativosubGrupo(e,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,m):"APROPIACION"==o.configuracionImpresion.tipo_cuenta.nombre&&o.generarWordComparativoApropiacion(e,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,m),t.stop()}})},o.generarPdfApropiacion=function(e,n,a,r,i,c){var u=new PDFDocument({size:"letter",margin:10}),s=u.pipe(blobStream()),m=r.length+i.length+c.length,f=130,d=0,p=o.configuracionImpresion.usar_empesar_numeracion?o.configuracionImpresion.empesar_numeracion:1,g=o.configuracionImpresion.usar_empesar_numeracion?o.configuracionImpresion.empesar_numeracion-1+Math.ceil(m/28):Math.ceil(m/28),l=0;o.dibujarCabeceraPDFEstadoResultado(u,p,g,"ACTIVO"),u.font("Helvetica",8);for(var b=0;b<r.length&&d<=28;b++)if(cuenta=r[b],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){28==d&&(u.addPage({margin:0,bufferPages:!0}),f=140,d=0,p+=1,o.dibujarCabeceraPDFEstadoResultado(u,p,g,"ACTIVO"),u.font("Helvetica",8)),u.text(cuenta.nombre,30,f),f+=20,d++;for(var A=0;A<i.length&&d<=28;A++){cuenta3=i[A];var v=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==v){if(c.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e})){u.text(cuenta3.nombre,40,f),f+=20,d++;for(var P=0;P<c.length&&d<=28;P++){cuenta2=c[P];v=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==v){u.text(cuenta2.nombre,60,f),u.text(number_format(cuenta2.saldo,2),n,f);var I=cuenta2.saldo/o.moneda.dolar;o.configuracionImpresion.bimonetario&&u.text(number_format(I,2),n+130,f),cuenta.total+=cuenta2.saldo,l+=cuenta2.saldo,f+=20,28==++d&&(u.addPage({margin:0,bufferPages:!0}),f=140,d=0,p+=1,o.dibujarCabeceraPDFEstadoResultado(u,p,g,"ACTIVO"),u.font("Helvetica",8))}else 28==d&&(u.addPage({margin:0,bufferPages:!0}),f=140,d=0,p+=1,o.dibujarCabeceraPDFEstadoResultado(u,p,g,"ACTIVO"),u.font("Helvetica",8))}}}else 28==d&&(u.addPage({margin:0,bufferPages:!0}),f=140,d=0,p+=1,o.dibujarCabeceraPDFEstadoResultado(u,p,g,"ACTIVO"),u.font("Helvetica",8))}u.text("TOTAL "+cuenta.nombre,90,f),u.text(number_format(cuenta.total,2),n,f);var h=cuenta.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&u.text(number_format(h,2),n+130,f),f+=20,d++,b===r.length-1&&o.DibujarFijoApropiacion(e,l,u,f,d,p,g,28,n)}else b===r.length-1&&o.DibujarFijoApropiacion(e,l,u,f,d,p,g,28,n);o.configuracionImpresion.usar_firma_uno&&(u.text(o.configuracionImpresion.firma_uno,170,720),u.text(o.configuracionImpresion.cargo_uno,170,730)),o.configuracionImpresion.usar_firma_dos&&(u.text(o.configuracionImpresion.firma_dos,370,720),u.text(o.configuracionImpresion.cargo_dos,370,730)),u.end(),s.on("finish",function(){var o=s.toBlobURL("application/pdf");window.open(o,"_blank","location=no")}),t.stop()},o.DibujarFijoApropiacion=function(e,n,a,r,t,i,c,u,s){if("COMPARATIVO"!=o.configuracionImpresion.tipoPeriodo.nombre){a.font("Helvetica",8);for(var m=0;m<e.cuentasSubGrupoFijo.length&&t<=u;m++)if(cuenta=e.cuentasSubGrupoFijo[m],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8)),a.text(cuenta.nombre,30,r),r+=20,t++;for(var f=0;f<e.cuentasGenericasFijo.length&&t<=u;f++)if(cuenta3=e.cuentasGenericasFijo[f],"3"===cuenta3.tipoCuenta.nombre_corto){var d=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==d){if(e.cuentasApropiacionFijo.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e})){a.text(cuenta3.nombre,40,r),r+=20,t++;for(var p=0;p<e.cuentasApropiacionFijo.length&&t<=u;p++)if(cuenta2=e.cuentasApropiacionFijo[p],"4"===cuenta2.tipoCuenta.nombre_corto){d=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==d){a.text(cuenta2.nombre,60,r),a.text(number_format(cuenta2.saldo,2),s-80,r);var g=cuenta2.saldo/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(g,2),s+65,r),r+=20,t++;for(var l=0;l<e.cuentasApropiacionFijo.length&&t<=u;l++)if(cuenta5=e.cuentasApropiacionFijo[l],"4"===cuenta5.tipoCuenta.nombre_corto){d=String(cuenta5.codigo).substr(4);if(String(cuenta2.codigo).substr(4)==d&&"Pasivo"===cuenta5.clasificacion.nombre){a.text(cuenta5.nombre,60,r),a.text("("+number_format(cuenta5.saldo,2)+")",s-80,r);var b=cuenta2.saldo-cuenta5.saldo;a.text(number_format(b,2),s,r);g=cuenta5.saldo/o.moneda.dolar;var A=b/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(g,2),s+65,r),o.configuracionImpresion.bimonetario&&a.text(number_format(A,2),s+130,r),cuenta.total+=b,n+=b,r+=20,++t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8));t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8));a.text("TOTAL "+cuenta.nombre,90,r),a.text(number_format(cuenta.total,2),s,r);var v=cuenta.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(v,2),s+130,r),r+=20,t++,m===e.cuentasSubGrupoFijo.length-1&&o.dibujarPatrimonio(e,n,a,r,t,i,c,u,s)}else m===e.cuentasSubGrupoFijo.length-1&&o.dibujarPatrimonio(e,n,a,r,t,i,c,u,s)}},o.DibujarFijoPreestablecido=function(e,n,a,r,t,i,c,u,s){a.font("Helvetica",8);for(var m=0;m<e.cuentasSubGrupoFijo.length&&t<=u;m++)if(cuenta=e.cuentasSubGrupoFijo[m],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8)),a.text(cuenta.nombre,30,r),r+=20,t++;for(var f=0;f<e.cuentasGenericasFijo.length&&t<=u;f++)if(cuenta3=e.cuentasGenericasFijo[f],cuenta3.total=0,"3"===cuenta3.tipoCuenta.nombre_corto){var d=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==d){if(e.cuentasApropiacionFijo.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e})){a.text(cuenta3.nombre,40,r),r+=20,t++;for(var p=0;p<e.cuentasGenericasFijo.length&&t<=u;p++){cuenta6=e.cuentasGenericasFijo[p],cuenta6.total=0;d=String(cuenta6.codigo).substr(3);if(String(cuenta3.codigo).substr(3)==d&&"Pasivo"===cuenta6.clasificacion.nombre&&(a.text(cuenta6.nombre,40,r),r+=20,t++),p==e.cuentasGenericasFijo.length-1){for(var g=0;g<e.cuentasApropiacionFijo.length&&t<=u;g++)if(cuenta2=e.cuentasApropiacionFijo[g],"4"===cuenta2.tipoCuenta.nombre_corto){d=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==d){cuenta3.total+=cuenta2.saldo;for(var l=cuenta2.saldo/o.moneda.dolar,b=0;b<e.cuentasApropiacionFijo.length&&t<=u;b++)if(cuenta5=e.cuentasApropiacionFijo[b],"4"===cuenta5.tipoCuenta.nombre_corto){d=String(cuenta5.codigo).substr(4);if(String(cuenta2.codigo).substr(4)==d&&"Pasivo"===cuenta5.clasificacion.nombre){cuenta6.total+=cuenta5.saldo;var A=cuenta2.saldo-cuenta5.saldo;l=cuenta5.saldo/o.moneda.dolar,o.moneda.dolar;cuenta.total+=A,n+=A,t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8));t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8));a.text(number_format(cuenta3.total,2),s-80,r-40);l=cuenta3.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(l,2),s+65,r-40),a.text("("+number_format(cuenta6.total,2)+")",s-80,r-20);l=cuenta6.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text("("+number_format(l,2)+")",s+65,r-20);var v=cuenta3.total-cuenta6.total,P=v/o.moneda.dolar;a.text(number_format(v,2),s,r-20),o.configuracionImpresion.bimonetario&&a.text(number_format(P,2),s+130,r-20)}}}}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8));a.text("TOTAL "+cuenta.nombre,90,r),a.text(number_format(cuenta.total,2),s,r);var I=cuenta.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(I,2),s+130,r),r+=20,t++,m===e.cuentasSubGrupoFijo.length-1&&o.dibujarPatrimonioPredefinido(e,n,a,r,t,i,c,u,s)}else m===e.cuentasSubGrupoFijo.length-1&&o.dibujarPatrimonioPredefinido(e,n,a,r,t,i,c,u,s)},o.DibujarFijoComparativoPreestablecido=function(e,n,a,r,t,i,c,u,s,m,f,d,p,g,l,b){a.font("Helvetica",8);for(var A=0;A<g.length&&t<=u;A++)if(cuenta=g[A],cuenta.primerAno.total=0,cuenta.segundoAno.total=0,"Activo"===cuenta.primerAno.clasificacion.nombre){t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8)),a.text(cuenta.primerAno.nombre,30,r),r+=20,t++;for(var v=0;v<l.length&&t<=u;v++){cuenta3=l[v],cuenta3.primerAno.total=0,cuenta3.segundoAno.total=0;var P=String(cuenta3.primerAno.codigo).substr(0,3);if(cuenta.primerAno.codigo==P){if(b.some(function(o){var e=String(o.primerAno.codigo).substr(0,5);return cuenta3.primerAno.codigo==e})){a.text(cuenta3.primerAno.nombre,40,r),r+=20,t++;for(var I=0;I<l.length&&t<=u;I++){cuenta6=l[I],cuenta6.primerAno.total=0,cuenta6.segundoAno.total=0;P=String(cuenta6.primerAno.codigo).substr(3);if(String(cuenta3.primerAno.codigo).substr(3)==P&&"Pasivo"===cuenta6.primerAno.clasificacion.nombre&&(a.text(cuenta6.primerAno.nombre,40,r),r+=20,t++),I==l.length-1){for(var h=0;h<b.length&&t<=u;h++)if(cuenta2=b[h],"4"===cuenta2.primerAno.tipoCuenta.nombre_corto){P=String(cuenta2.primerAno.codigo).substr(0,5);if(cuenta3.primerAno.codigo==P){cuenta3.primerAno.total+=cuenta2.primerAno.saldo,cuenta3.segundoAno.total+=cuenta2.segundoAno.saldo;for(var _=0;_<b.length&&t<=u;_++)if(cuenta5=b[_],"4"===cuenta5.primerAno.tipoCuenta.nombre_corto){P=String(cuenta5.primerAno.codigo).substr(4);if(String(cuenta2.primerAno.codigo).substr(4)==P&&"Pasivo"===cuenta5.primerAno.clasificacion.nombre){cuenta6.primerAno.total+=cuenta5.primerAno.saldo,cuenta6.segundoAno.total+=cuenta5.segundoAno.saldo;var S=cuenta2.primerAno.saldo-cuenta5.primerAno.saldo,G=cuenta2.segundoAno.saldo-cuenta5.segundoAno.saldo;cuenta.primerAno.total+=S,n.totalActivosPrimerAnio+=S,cuenta.segundoAno.total+=G,n.totalActivosSegundoAnio+=G,t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8));t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8));a.text(cuenta3.primerAno.total.toFixed(2),s-80,r-40),a.text(cuenta3.segundoAno.total.toFixed(2),s+130,r-40);cuenta3.primerAno.total,o.moneda.dolar;a.text("("+cuenta6.primerAno.total.toFixed(2)+")",s-80,r-20),a.text("("+cuenta6.segundoAno.total.toFixed(2)+")",s+130,r-20);cuenta6.primerAno.total,o.moneda.dolar;var x=(C=cuenta3.primerAno.total-cuenta6.primerAno.total)/o.moneda.dolar;a.text(number_format(C,2),s,r-20),o.configuracionImpresion.bimonetario&&a.text(number_format(x,2),s+80,r-20);var C;x=(C=cuenta3.segundoAno.total-cuenta6.segundoAno.total)/o.moneda.dolar;a.text(number_format(C,2),s+180,r-20),o.configuracionImpresion.bimonetario&&a.text(number_format(x,2),s+260,r-20)}}}}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}a.text("TOTAL "+cuenta.primerAno.nombre,90,r),a.text(number_format(cuenta.primerAno.total,2),s,r);var E=cuenta.primerAno.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(E,2),s+80,r),a.text(number_format(cuenta.segundoAno.total,2),s+180,r);E=cuenta.segundoAno.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(E,2),s+260,r),r+=20,t++,A===g.length-1&&o.dibujarPatrimonioComparativoPredefinido(e,n,a,r,t,i,c,u,s,m,f,d,p)}else A===g.length-1&&o.dibujarPatrimonioComparativoPredefinido(e,n,a,r,t,i,c,u,s,m,f,d,p)},o.DibujarFijoSubGrupo=function(e,n,a,r,t,i,c,u,s){if("COMPARATIVO"!=o.configuracionImpresion.tipoPeriodo.nombre){a.font("Helvetica",8);for(var m=0;m<e.cuentasSubGrupoFijo.length&&t<=u;m++)if(cuenta=e.cuentasSubGrupoFijo[m],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8)),a.text(cuenta.nombre,30,r),r+=20,t++;for(var f=0;f<e.cuentasGenericasFijo.length&&t<=u;f++){cuenta3=e.cuentasGenericasFijo[f],cuenta3.total=0;var d=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==d){if(e.cuentasApropiacionFijo.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e}))for(var p=0;p<e.cuentasGenericasFijo.length&&t<=u;p++){cuenta6=e.cuentasGenericasFijo[p],cuenta6.total=0;d=String(cuenta6.codigo).substr(3),String(cuenta3.codigo).substr(3);if(p==e.cuentasGenericasFijo.length-1)for(var g=0;g<e.cuentasApropiacionFijo.length&&t<=u;g++){cuenta2=e.cuentasApropiacionFijo[g];d=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==d){cuenta3.total+=cuenta2.saldo;for(var l=0;l<e.cuentasApropiacionFijo.length&&t<=u;l++){cuenta5=e.cuentasApropiacionFijo[l];d=String(cuenta5.codigo).substr(4);if(String(cuenta2.codigo).substr(4)==d&&"Pasivo"===cuenta5.clasificacion.nombre){cuenta6.total+=cuenta5.saldo;var b=cuenta2.saldo-cuenta5.saldo;cuenta.total+=b,n+=b}}}}}}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8))}a.text("TOTAL "+cuenta.nombre,90,r),a.text(number_format(cuenta.total,2),s,r);var A=cuenta.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(A,2),s+130,r),r+=20,t++,m===e.cuentasSubGrupoFijo.length-1&&o.dibujarPatrimonioSubGrupo(e,n,a,r,t,i,c,u,s)}else m===e.cuentasSubGrupoFijo.length-1&&o.dibujarPatrimonioSubGrupo(e,n,a,r,t,i,c,u,s)}},o.DibujarFijoGrupo=function(e,n,a,r,t,i,c,u,s){if("COMPARATIVO"!=o.configuracionImpresion.tipoPeriodo.nombre){a.font("Helvetica",8);for(var m=0;m<e.cuentasSubGrupoFijo.length&&t<=u;m++)if(cuenta=e.cuentasSubGrupoFijo[m],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8));for(var f=0;f<e.cuentasGenericasFijo.length&&t<=u;f++){cuenta3=e.cuentasGenericasFijo[f],cuenta3.total=0;var d=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==d&&e.cuentasApropiacionFijo.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e}))for(var p=0;p<e.cuentasGenericasFijo.length&&t<=u;p++){cuenta6=e.cuentasGenericasFijo[p],cuenta6.total=0;d=String(cuenta6.codigo).substr(3);if(String(cuenta3.codigo).substr(3)==d&&cuenta6.clasificacion.nombre,p==e.cuentasGenericasFijo.length-1)for(var g=0;g<e.cuentasApropiacionFijo.length&&t<=u;g++){cuenta2=e.cuentasApropiacionFijo[g];d=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==d){cuenta3.total+=cuenta2.saldo;cuenta2.saldo,o.moneda.dolar;for(var l=0;l<e.cuentasApropiacionFijo.length&&t<=u;l++){cuenta5=e.cuentasApropiacionFijo[l];d=String(cuenta5.codigo).substr(4);if(String(cuenta2.codigo).substr(4)==d&&"Pasivo"===cuenta5.clasificacion.nombre){cuenta6.total+=cuenta5.saldo;var b=cuenta2.saldo-cuenta5.saldo;cuenta.total+=b,n+=b}}}}}}a.text("TOTAL "+cuenta.nombre,90,r),a.text(number_format(cuenta.total,2),s,r);var A=cuenta.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(A,2),s+130,r),r+=20,t++,m===e.cuentasSubGrupoFijo.length-1&&o.dibujarPatrimonioGrupo(e,n,a,r,t,i,c,u,s)}else m===e.cuentasSubGrupoFijo.length-1&&o.dibujarPatrimonioGrupo(e,n,a,r,t,i,c,u,s)}},o.dibujarPatrimonio=function(e,n,a,r,t,i,c,u,s){if("COMPARATIVO"!=o.configuracionImpresion.tipoPeriodo.nombre){var m=0;a.font("Helvetica-Bold",8),a.text("TOTAL Gastos de Operación :  ",30,r),a.text(number_format(n,2),s,r);var f=n/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(f,2),s+130,r),r+=20,a.text("PASIVO Y PATRIMONIO",0,r,{align:"center"}),r+=20;for(var d=0;d<e.cuentasSubGrupo.length&&t<=u;d++){var p=e.cuentasSubGrupo[d];if("Pasivo"===p.clasificacion.nombre){t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8)),a.text(p.nombre,30,r),p.total=0,r+=20,t++;for(var g=0;g<e.cuentasGenericas.length&&t<=u;g++){var l=e.cuentasGenericas[g];if("3"===l.tipoCuenta.nombre_corto){var b=String(l.codigo).substr(0,3);if(p.codigo==b){if(e.cuentasApropiacion.some(function(o){var e=String(o.codigo).substr(0,5);return l.codigo==e})){a.text(l.nombre,40,r),r+=20,t++;for(var A=0;A<e.cuentasApropiacion.length&&t<=u;A++){var v=e.cuentasApropiacion[A];if("4"===v.tipoCuenta.nombre_corto){b=String(v.codigo).substr(0,5);if(l.codigo==b){a.text(v.nombre,60,r),a.text(number_format(v.saldo,2),s,r);var P=v.saldo/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(P,2),s+130,r),p.total+=v.saldo,m+=v.saldo,r+=20,++t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}}}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}a.text("TOTAL "+p.nombre,90,r),a.text(number_format(p.total,2),s,r);P=Math.round(p.total/o.moneda.dolar*1e4)/1e4;o.configuracionImpresion.bimonetario&&a.text(number_format(P,2),s+130,r),r+=20,t++}if(d===e.cuentasSubGrupo.length-1){a.font("Helvetica-Bold",8),a.text("TOTAL PASIVO:  ",30,r),a.text(number_format(m,2),s,r);P=Math.round(m/o.moneda.dolar*1e4)/1e4;o.configuracionImpresion.bimonetario&&a.text(number_format(P,2),s+130,r)}}}},o.dibujarPatrimonioComparativoPredefinido=function(e,n,a,r,t,i,c,u,s,m,f,d,p){var g={totalPasivoPrimerAnio:0,totalPasivoSegundoAnio:0};a.font("Helvetica-Bold",8),a.text("TOTAL ACTIVOS  ",30,r),a.text(number_format(n.totalActivosPrimerAnio,2),s,r);var l=n.totalActivosPrimerAnio/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(l,2),s+130,r),r+=20,t++,a.text("PASIVO Y PATRIMONIO",0,r,{align:"center"}),t++,r+=20;for(var b=0;b<f.length&&t<=u;b++){a.font("Helvetica",8);var A=f[b];if("Pasivo"===A.primerAno.clasificacion.nombre||"Capital"==A.primerAno.clasificacion.nombre){t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8)),a.text(A.primerAno.nombre,30,r),A.primerAno.total=0,A.segundoAno.total=0,r+=20,t++;for(var v=0;v<d.length&&t<=u;v++){var P=d[v],I=String(P.primerAno.codigo).substr(0,3);if(A.primerAno.codigo==I){if(p.some(function(o){var e=String(o.primerAno.codigo).substr(0,5);return P.primerAno.codigo==e})){a.text(P.primerAno.nombre,40,r),P.primerAno.total=0,P.primerAno.totalSus=0,P.segundoAno.total=0,P.segundoAno.totalSus=0;for(var h=0;h<p.length&&t<=u;h++){var _=p[h];if("4"===_.primerAno.tipoCuenta.nombre_corto){I=String(_.primerAno.codigo).substr(0,5);P.primerAno.codigo==I?(P.primerAno.total+=_.primerAno.saldo,P.primerAno.totalSus+=_.primerAno.saldo/o.moneda.dolar,A.primerAno.total+=_.primerAno.saldo,P.segundoAno.total+=_.segundoAno.saldo,P.segundoAno.totalSus+=_.segundoAno.saldo/o.moneda.dolar,A.segundoAno.total+=_.segundoAno.saldo,g.totalPasivoPrimerAnio+=_.primerAno.saldo,g.totalPasivoSegundoAnio+=_.segundoAno.saldo,t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))):t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}a.text(P.primerAno.total,s,r),o.configuracionImpresion.bimonetario&&a.text(number_format(P.primerAno.totalSus,2),s+80,r),a.text(P.segundoAno.total,s+180,r),o.configuracionImpresion.bimonetario&&a.text(number_format(P.segundoAno.totalSus,2),s+260,r),r+=20,t++}}else t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}a.text("TOTAL "+A.primerAno.nombre,90,r),a.text(number_format(A.primerAno.total,2),s,r),a.text(number_format(A.segundoAno.total,2),s+180,r);var S=Math.round(A.primerAno.total/o.moneda.dolar*1e4)/1e4;o.configuracionImpresion.bimonetario&&a.text(number_format(S,2),s+80,r);S=Math.round(A.segundoAno.total/o.moneda.dolar*1e4)/1e4;o.configuracionImpresion.bimonetario&&a.text(number_format(S,2),s+260,r),r+=20,t++}if(b===f.length-1){a.font("Helvetica-Bold",8),a.text("TOTAL PASIVO:  ",30,r),a.text(number_format(g.totalPasivoPrimerAnio,2),s,r);S=Math.round(g.totalPasivoPrimerAnio/o.moneda.dolar*1e4)/1e4;o.configuracionImpresion.bimonetario&&a.text(number_format(S,2),s+80,r),a.text(number_format(g.totalPasivoSegundoAnio,2),s+180,r);S=Math.round(g.totalPasivoSegundoAnio/o.moneda.dolar*1e4)/1e4;o.configuracionImpresion.bimonetario&&a.text(number_format(S,2),s+260,r)}}},o.dibujarIngresoEgresoPredefinido=function(e,n,a,r,t,i,c,u,s){var m=0;a.font("Helvetica-Bold",8),a.text("TOTAL GASTOS DE OPERACIÓN  ",30,r),a.text(number_format(n,2),s,r);var f=n/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(f,2),s+130,r),r+=20,t++,a.text("Otro Ingresos y Egresos:",30,r),a.font("Helvetica",8),r+=20,t++;for(var d=0;d<e.cuentasPasivosPatrimonios.length&&t<=u;d++){if(cuentaGrupo=e.cuentasPasivosPatrimonios[d],cuentaGrupo.hijos.length>0)for(var p=0;p<cuentaGrupo.hijos.length&&t<=u;p++){cuentaSubGrupo=cuentaGrupo.hijos[p],cuentaSubGrupo.total=0,a.text(cuentaSubGrupo.nombre,30,r),r+=20,++t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFBalanceGeneral(a,i,c,"Otro Ingresos y Egresos:"),a.font("Helvetica",8));for(var g=0;g<cuentaSubGrupo.hijos.length&&t<=u;g++){cuentaGenerica=cuentaSubGrupo.hijos[g],cuentaGenerica.total=0,a.text(cuentaGenerica.nombre,40,r);for(var l=0;l<cuentaGenerica.hijos.length&&t<=u;l++)cuentasApropiacion=cuentaGenerica.hijos[l],cuentaGenerica.total+=cuentasApropiacion.saldo,cuentaSubGrupo.total+=cuentasApropiacion.saldo,m+=cuentasApropiacion.saldo;a.text(number_format(cuentaGenerica.total,2),s,r),r+=20,++t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFBalanceGeneral(a,i,c,"Otro Ingresos y Egresos:"),a.font("Helvetica",8))}a.text("TOTAL "+cuentaSubGrupo.nombre,90,r);f=cuentaSubGrupo.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(f,2),s+130,r),a.text(number_format(cuentaSubGrupo.total,2),s,r),r+=20,++t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFBalanceGeneral(a,i,c,"Otro Ingresos y Egresos:"),a.font("Helvetica",8))}if(d===e.cuentasPasivosPatrimonios.length-1){a.font("Helvetica-Bold",8),a.text("TOTAL Otros ingresos y Egresos:  ",30,r),a.text(number_format(m,2),s,r);var b=Math.round(m/o.moneda.dolar*1e4)/1e4;o.configuracionImpresion.bimonetario&&a.text(number_format(b,2),s+130,r)}}},o.dibujarPatrimonioSubGrupo=function(e,n,a,r,t,i,c,u,s){if("COMPARATIVO"!=o.configuracionImpresion.tipoPeriodo.nombre){var m=0;a.font("Helvetica-Bold",8),a.text("TOTAL ACTIVOS  ",30,r),a.text(number_format(n,2),s,r);var f=n/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(f,2),s+130,r),r+=20,t++,a.text("PASIVO Y PATRIMONIO",0,r,{align:"center"}),r+=20,t++;for(var d=0;d<e.cuentasSubGrupo.length&&t<=u;d++){a.font("Helvetica",8);var p=e.cuentasSubGrupo[d];if("Pasivo"===p.clasificacion.nombre||"Capital"==p.clasificacion.nombre){t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8)),a.text(p.nombre,30,r),p.total=0,p.totalSus=0;for(var g=0;g<e.cuentasGenericas.length&&t<=u;g++){var l=e.cuentasGenericas[g];if("3"===l.tipoCuenta.nombre_corto){var b=String(l.codigo).substr(0,3);if(p.codigo==b&&e.cuentasApropiacion.some(function(o){var e=String(o.codigo).substr(0,5);return l.codigo==e}))for(var A=0;A<e.cuentasApropiacion.length&&t<=u;A++){var v=e.cuentasApropiacion[A];if("4"===v.tipoCuenta.nombre_corto){b=String(v.codigo).substr(0,5);l.codigo==b&&(p.totalSus+=v.saldo/o.moneda.dolar,p.total+=v.saldo,m+=v.saldo)}}}}a.text(p.total,s,r),o.configuracionImpresion.bimonetario&&a.text(number_format(p.totalSus,2),s+130,r),r+=20,t++,a.text("TOTAL "+p.nombre,90,r),a.text(number_format(p.total,2),s,r);var P=Math.round(p.total/o.moneda.dolar*1e4)/1e4;o.configuracionImpresion.bimonetario&&a.text(number_format(P,2),s+130,r),r+=20,t++}if(d===e.cuentasSubGrupo.length-1){a.font("Helvetica-Bold",8),a.text("TOTAL PASIVO:  ",30,r),a.text(number_format(m,2),s,r);P=Math.round(m/o.moneda.dolar*1e4)/1e4;o.configuracionImpresion.bimonetario&&a.text(number_format(P,2),s+130,r)}}}},o.dibujarPatrimonioGrupo=function(e,n,a,r,t,i,c,u,s){if("COMPARATIVO"!=o.configuracionImpresion.tipoPeriodo.nombre){var m=0;a.font("Helvetica-Bold",8),a.text("TOTAL ACTIVOS  ",30,r),a.text(number_format(n,2),s,r);var f=n/o.moneda.dolar;o.configuracionImpresion.bimonetario&&a.text(number_format(f,2),s+130,r),r+=20,t++,a.text("PASIVO Y PATRIMONIO",0,r,{align:"center"}),r+=20,t++;for(var d=0;d<e.cuentasGrupo.length&&t<=u;d++){if(cuenta=e.cuentasGrupo[d],cuenta.total=0,cuenta.totalSus=0,"Pasivo"===cuenta.clasificacion.nombre||"Capital"===cuenta.clasificacion.nombre){t==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,t=0,i+=1,o.dibujarCabeceraPDFEstadoResultado(a,i,c,"ACTIVO"),a.font("Helvetica",8)),a.text(cuenta.nombre,30,r);for(var p=0;p<e.cuentasSubGrupo.length&&t<=u;p++)if(cuenta4=e.cuentasSubGrupo[p],"2"===cuenta4.tipoCuenta.nombre_corto){var g=String(cuenta4.codigo).substr(0,1);if(cuenta.codigo==g)for(var l=0;l<e.cuentasGenericas.length&&t<=u;l++)if(cuenta3=e.cuentasGenericas[l],"3"===cuenta3.tipoCuenta.nombre_corto){g=String(cuenta3.codigo).substr(0,3);if(cuenta4.codigo==g&&e.cuentasApropiacion.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e}))for(var b=0;b<e.cuentasApropiacion.length&&t<=u;b++)if(cuenta2=e.cuentasApropiacion[b],"4"===cuenta2.tipoCuenta.nombre_corto){g=String(cuenta2.codigo).substr(0,5);cuenta3.codigo==g&&(cuenta.total+=cuenta2.saldo,cuenta.totalSus+=cuenta2.saldo,m+=cuenta2.saldo)}}}a.text(cuenta.total,s,r),o.configuracionImpresion.bimonetario&&a.text(number_format(cuenta.totalSus,2),s+130,r),r+=20,t++,a.text("TOTAL "+cuenta.nombre,90,r),a.text(number_format(cuenta.total,2),s,r);var A=Math.round(cuenta.total/o.moneda.dolar*1e4)/1e4;o.configuracionImpresion.bimonetario&&a.text(number_format(A,2),s+130,r),r+=20,t++}if(d===e.cuentasGrupo.length-1){a.font("Helvetica-Bold",8),a.text("TOTAL PASIVO:  ",30,r),a.text(number_format(m,2),s,r);A=Math.round(m/o.moneda.dolar*1e4)/1e4;o.configuracionImpresion.bimonetario&&a.text(number_format(A,2),s+130,r)}}}},o.generarPdfPreComparativo=function(o,e,n,a,r,t,i,c,u){},o.generarPdfGrupo=function(e,n,a,r,i,c){if("COMPARATIVO"!=o.configuracionImpresion.tipoPeriodo.nombre){var u=new PDFDocument({size:"letter",margin:10}),s=u.pipe(blobStream()),m=[],f=[],d=130,p=0,g=o.configuracionImpresion.usar_empesar_numeracion?o.configuracionImpresion.empesar_numeracion:1,l=o.configuracionImpresion.usar_empesar_numeracion?o.configuracionImpresion.empesar_numeracion-1+Math.ceil((m.length+f.length)/28):Math.ceil((m.length+f.length)/28),b=0;o.dibujarCabeceraPDFEstadoResultado(u,g,l,"ACTIVO"),u.font("Helvetica",8);for(var A=0;A<a.length&&p<=28;A++)if(cuenta=a[A],cuenta.total=0,cuenta.totalSus=0,"Activo"===cuenta.clasificacion.nombre){28==p&&(u.addPage({margin:0,bufferPages:!0}),d=140,p=0,g+=1,o.dibujarCabeceraPDFEstadoResultado(u,g,l,"ACTIVO"),u.font("Helvetica",8)),u.text(cuenta.nombre,30,d);for(var v=0;v<r.length&&p<=28;v++)if(cuenta4=r[v],"2"===cuenta4.tipoCuenta.nombre_corto){var P=String(cuenta4.codigo).substr(0,1);if(cuenta.codigo==P)for(var I=0;I<i.length&&p<=28;I++)if(cuenta3=i[I],"3"===cuenta3.tipoCuenta.nombre_corto){P=String(cuenta3.codigo).substr(0,3);if(cuenta4.codigo==P&&c.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e}))for(var h=0;h<c.length&&p<=28;h++)if(cuenta2=c[h],"4"===cuenta2.tipoCuenta.nombre_corto){P=String(cuenta2.codigo).substr(0,5);cuenta3.codigo==P&&(cuenta.total+=cuenta2.saldo,cuenta.totalSus+=cuenta2.saldo,b+=cuenta2.saldo)}}}o.configuracionImpresion.bimonetario&&u.text(number_format(cuenta.totalSus,2),n+130,d),u.text(number_format(cuenta.total,2),n,d),d+=20,p++,u.text("TOTAL "+cuenta.nombre,90,d),u.text(number_format(cuenta.total,2),n,d);var _=cuenta.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&u.text(number_format(_,2),n+130,d),d+=20,p++,A===a.length-1&&o.DibujarFijoGrupo(e,b,u,d,p,g,l,28,n)}else A===a.length-1&&o.DibujarFijoGrupo(e,b,u,d,p,g,l,28,n);o.configuracionImpresion.usar_firma_uno&&(u.text(o.configuracionImpresion.firma_uno,170,720),u.text(o.configuracionImpresion.cargo_uno,170,730)),o.configuracionImpresion.usar_firma_dos&&(u.text(o.configuracionImpresion.firma_dos,370,720),u.text(o.configuracionImpresion.cargo_dos,370,730)),u.end(),s.on("finish",function(){var o=s.toBlobURL("application/pdf");window.open(o,"_blank","location=no")}),t.stop()}},o.generarPdfsubGrupo=function(e,n,a,r,i,c){if("COMPARATIVO"!=o.configuracionImpresion.tipoPeriodo.nombre){var u=new PDFDocument({size:"letter",margin:10}),s=u.pipe(blobStream()),m=[],f=[],d=130,p=0,g=o.configuracionImpresion.usar_empesar_numeracion?o.configuracionImpresion.empesar_numeracion:1,l=o.configuracionImpresion.usar_empesar_numeracion?o.configuracionImpresion.empesar_numeracion-1+Math.ceil((m.length+f.length)/28):Math.ceil((m.length+f.length)/28),b=0;o.dibujarCabeceraPDFEstadoResultado(u,g,l,"ACTIVO"),u.font("Helvetica",8);for(var A=0;A<r.length&&p<=28;A++)if(cuenta=r[A],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){28==p&&(u.addPage({margin:0,bufferPages:!0}),d=140,p=0,g+=1,o.dibujarCabeceraPDFEstadoResultado(u,g,l,"ACTIVO"),u.font("Helvetica",8)),u.text(cuenta.nombre,30,d);for(var v=0;v<i.length&&p<=28;v++)if(cuenta3=i[v],"3"===cuenta3.tipoCuenta.nombre_corto){var P=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==P&&c.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e}))for(var I=0;I<c.length&&p<=28;I++)if(cuenta2=c[I],"4"===cuenta2.tipoCuenta.nombre_corto){P=String(cuenta2.codigo).substr(0,5);cuenta3.codigo==P&&(cuenta.total+=cuenta2.saldo,cuenta.totalSus+=cuenta2.saldo,b+=cuenta2.saldo)}}o.configuracionImpresion.bimonetario&&u.text(number_format(cuenta.totalSus,2),n+130,d),u.text(number_format(cuenta.total,2),n,d),d+=20,p++,u.text("TOTAL "+cuenta.nombre,90,d),u.text(number_format(cuenta.total,2),n,d);var h=cuenta.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&u.text(number_format(h,2),n+130,d),d+=20,p++,A===r.length-1&&o.DibujarFijoSubGrupo(e,b,u,d,p,g,l,28,n)}else A===r.length-1&&o.DibujarFijoSubGrupo(e,b,u,d,p,g,l,28,n);o.configuracionImpresion.usar_firma_uno&&(u.text(o.configuracionImpresion.firma_uno,170,720),u.text(o.configuracionImpresion.cargo_uno,170,730)),o.configuracionImpresion.usar_firma_dos&&(u.text(o.configuracionImpresion.firma_dos,370,720),u.text(o.configuracionImpresion.cargo_dos,370,730)),u.end(),s.on("finish",function(){var o=s.toBlobURL("application/pdf");window.open(o,"_blank","location=no")}),t.stop()}},o.generarPdfPreestablecido=function(e,n,a,r,i,c,u,s,m){var f=new PDFDocument({size:"letter",margin:10}),d=f.pipe(blobStream()),p=130,g=0,l=o.configuracionImpresion.usar_empesar_numeracion?o.configuracionImpresion.empesar_numeracion:1,b=o.configuracionImpresion.usar_empesar_numeracion?o.configuracionImpresion.empesar_numeracion-1+Math.ceil(20/28):Math.ceil(20/28),A=0;o.dibujarCabeceraPDFEstadoResultado(f,l,b,""),f.font("Helvetica",8),f.text("VENTAS  ",40,115),f.text(s.toFixed(2),500,115),f.text("COSTO DE VENTAS  ",40,125),f.text(m.toFixed(2),500,125),f.text("UTILIDAD BRUTA SOBRE VENTAS",40,135);var v=s-m;f.text(v.toFixed(2),500,135),f.text("TOTAL  ",70,145),f.font("Helvetica-Bold",8),f.text("Gastos de Operación :",30,155),f.font("Helvetica",8);f.text((0).toFixed(2),500,155),p+=40;for(var P=0;P<e.cuentasActivos.length&&g<=28;P++){if(cuentaGrupo=e.cuentasActivos[P],cuentaGrupo.hijos.length>0)for(var I=0;I<cuentaGrupo.hijos.length&&g<=28;I++){cuentaSubGrupo=cuentaGrupo.hijos[I],cuentaSubGrupo.total=0,f.text(cuentaSubGrupo.nombre,30,p),p+=20,28==++g&&(f.addPage({margin:0,bufferPages:!0}),p=140,g=0,l+=1,o.dibujarCabeceraPDFBalanceGeneral(f,l,b,"ACTIVO"),f.font("Helvetica",8));for(var h=0;h<cuentaSubGrupo.hijos.length&&g<=28;h++){cuentaGenerica=cuentaSubGrupo.hijos[h],cuentaGenerica.total=0,f.text(cuentaGenerica.nombre,40,p);for(var _=0;_<cuentaGenerica.hijos.length&&g<=28;_++)c=cuentaGenerica.hijos[_],cuentaGenerica.total+=c.saldo,cuentaSubGrupo.total+=c.saldo,A+=c.saldo;f.text(number_format(cuentaGenerica.total,2),n,p),p+=20,28==++g&&(f.addPage({margin:0,bufferPages:!0}),p=140,g=0,l+=1,o.dibujarCabeceraPDFBalanceGeneral(f,l,b,"ACTIVO"),f.font("Helvetica",8))}f.text("TOTAL "+cuentaSubGrupo.nombre,90,p);var S=cuentaSubGrupo.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&f.text(number_format(S,2),n+130,p),f.text(number_format(cuentaSubGrupo.total,2),n,p),p+=20,28==++g&&(f.addPage({margin:0,bufferPages:!0}),p=140,g=0,l+=1,o.dibujarCabeceraPDFBalanceGeneral(f,l,b,"ACTIVO"),f.font("Helvetica",8))}P===e.cuentasActivos.length-1&&o.dibujarIngresoEgresoPredefinido(e,A,f,p,g,l,b,28,n)}o.configuracionImpresion.usar_firma_uno&&(f.text(o.configuracionImpresion.firma_uno,170,720),f.text(o.configuracionImpresion.cargo_uno,170,730)),o.configuracionImpresion.usar_firma_dos&&(f.text(o.configuracionImpresion.firma_dos,370,720),f.text(o.configuracionImpresion.cargo_dos,370,730)),f.end(),d.on("finish",function(){var o=d.toBlobURL("application/pdf");window.open(o,"_blank","location=no")}),t.stop()},o.generarPdfComprobantePreestablecido=function(e,n,a,r,i,c,u,s,m){var f=new PDFDocument({size:"letter",margin:10}),d=f.pipe(blobStream()),p=r.length+i.length,g=130,l=0,b=o.configuracionImpresion.usar_empesar_numeracion?o.configuracionImpresion.empesar_numeracion:1,A=o.configuracionImpresion.usar_empesar_numeracion?o.configuracionImpresion.empesar_numeracion-1+Math.ceil(p/28):Math.ceil(p/28),v={totalActivosPrimerAnio:0,totalActivosSegundoAnio:0};o.dibujarCabeceraPDFEstadoResultado(f,b,A,"ACTIVO"),f.font("Helvetica",8);for(var P=0;P<r.length&&l<=28;P++)if(cuenta=r[P],cuenta.total=0,"Activo"===cuenta.primerAno.clasificacion.nombre){28==l&&(f.addPage({margin:0,bufferPages:!0}),g=140,l=0,b+=1,o.dibujarCabeceraPDFEstadoResultado(f,b,A,"ACTIVO"),f.font("Helvetica",8)),f.text(cuenta.primerAno.nombre,30,g),cuenta.primerAno.total=0,cuenta.primerAno.totalSus=0,cuenta.segundoAno.total=0,cuenta.segundoAno.totalSus=0,g+=20,l++;for(var I=0;I<i.length&&l<=28;I++)if(cuenta3=i[I],"3"===cuenta3.primerAno.tipoCuenta.nombre_corto){var h=String(cuenta3.primerAno.codigo).substr(0,3);if(cuenta.primerAno.codigo==h){if(c.some(function(o){var e=String(o.primerAno.codigo).substr(0,5);return cuenta3.primerAno.codigo==e})){f.text(cuenta3.primerAno.nombre,40,g),cuenta3.primerAno.total=0,cuenta3.primerAno.totalSus=0,cuenta3.segundoAno.total=0,cuenta3.segundoAno.totalSus=0;for(var _=0;_<c.length&&l<=28;_++)if(cuenta2=c[_],"4"===cuenta2.primerAno.tipoCuenta.nombre_corto){h=String(cuenta2.primerAno.codigo).substr(0,5);cuenta3.primerAno.codigo==h?(cuenta3.primerAno.totalSus+=cuenta2.primerAno.saldo/o.moneda.dolar,cuenta3.segundoAno.totalSus+=cuenta2.segundoAno.saldo/o.moneda.dolar,cuenta3.primerAno.total+=cuenta2.primerAno.saldo,cuenta.primerAno.total+=cuenta2.primerAno.saldo,cuenta3.segundoAno.total+=cuenta2.segundoAno.saldo,cuenta.segundoAno.total+=cuenta2.segundoAno.saldo,v.totalActivosPrimerAnio+=cuenta2.primerAno.saldo,v.totalActivosSegundoAnio+=cuenta2.segundoAno.saldo,28==l&&(f.addPage({margin:0,bufferPages:!0}),g=140,l=0,b+=1,o.dibujarCabeceraPDFEstadoResultado(f,b,A,"ACTIVO"),f.font("Helvetica",8))):28==l&&(f.addPage({margin:0,bufferPages:!0}),g=140,l=0,b+=1,o.dibujarCabeceraPDFEstadoResultado(f,b,A,"ACTIVO"),f.font("Helvetica",8))}else 28==l&&(f.addPage({margin:0,bufferPages:!0}),g=140,l=0,b+=1,o.dibujarCabeceraPDFEstadoResultado(f,b,A,"ACTIVO"),f.font("Helvetica",8));o.configuracionImpresion.bimonetario&&f.text(number_format(cuenta3.primerAno.totalSus,2),n+80,g),f.text(number_format(cuenta3.primerAno.total,2),n+180,g),o.configuracionImpresion.bimonetario&&f.text(number_format(cuenta3.segundoAno.totalSus,2),n+260,g),f.text(number_format(cuenta3.segundoAno.total,2),n,g),g+=20,l++}}else 28==l&&(f.addPage({margin:0,bufferPages:!0}),g=140,l=0,b+=1,o.dibujarCabeceraPDFEstadoResultado(f,b,A,"ACTIVO"),f.font("Helvetica",8))}else 28==l&&(f.addPage({margin:0,bufferPages:!0}),g=140,l=0,b+=1,o.dibujarCabeceraPDFEstadoResultado(f,b,A,"ACTIVO"),f.font("Helvetica",8));f.text("TOTAL "+cuenta.primerAno.nombre,90,g),f.text(number_format(cuenta.primerAno.total,2),n,g),f.text(number_format(cuenta.segundoAno.total,2),n+180,g);var S=cuenta.primerAno.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&f.text(number_format(S,2),n+80,g);S=cuenta.segundoAno.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&f.text(number_format(S,2),n+260,g),g+=20,l++,P===r.length-1&&o.DibujarFijoComparativoPreestablecido(e,v,f,g,l,b,A,28,n,a,r,i,c,u,s,m)}else P===r.length-1&&o.DibujarFijoComparativoPreestablecido(e,v,f,g,l,b,A,28,n,a,r,i,c,u,s,m);o.configuracionImpresion.usar_firma_uno&&(f.text(o.configuracionImpresion.firma_uno,170,720),f.text(o.configuracionImpresion.cargo_uno,170,730)),o.configuracionImpresion.usar_firma_dos&&(f.text(o.configuracionImpresion.firma_dos,370,720),f.text(o.configuracionImpresion.cargo_dos,370,730)),f.end(),d.on("finish",function(){var o=d.toBlobURL("application/pdf");window.open(o,"_blank","location=no")}),t.stop()},o.dibujarCabeceraPDFEstadoResultado=function(e,n,a,r){if(e.font("Helvetica-Bold",8),e.text(o.usuario.empresa.razon_social,40,30,{width:220}),e.text("DE : ",40,40),e.text("NIT : ",40,50),e.text(o.usuario.empresa.direccion,40,60,{width:220}),e.text(o.usuario.empresa.nit,55,50),e.font("Helvetica-Bold",12),e.text("ESTADO DE RESULTADOS",0,75,{align:"center"}),e.font("Helvetica-Bold",8),"GES"==o.configuracionImpresion.tipoPeriodo.nombre_corto){var t=(new Date).getFullYear(),i=(new Date).getMonth(),c=new Date(t,i-1,0).getDate();o.configuracionImpresion.gestion.nombre<t?e.text("Al 31 de Diciembre de "+o.configuracionImpresion.gestion.nombre,0,85,{align:"center"}):e.text("Al "+c+" de "+o.meses[i].nombre+" de "+o.configuracionImpresion.gestion.nombre,0,85,{align:"center"})}else if("MES"==o.configuracionImpresion.tipoPeriodo.nombre_corto)e.text(o.configuracionImpresion.mes.nombre+" de "+o.configuracionImpresion.gestion.nombre,0,85,{align:"center"});else if("FECHAS"==o.configuracionImpresion.tipoPeriodo.nombre_corto){var u=new Date(o.convertirFecha(o.configuracionImpresion.fecha_inicio)),s=new Date(o.convertirFecha(o.configuracionImpresion.fecha_fin));e.text("Desde el "+u.getDate()+" de "+o.meses[u.getMonth()].nombre+" "+u.getFullYear()+" al "+s.getDate()+" de "+o.meses[s.getMonth()].nombre+" de "+s.getFullYear(),0,85,{align:"center"})}else"COMP"==o.configuracionImpresion.tipoPeriodo.nombre_corto&&e.text("Gestión "+o.configuracionImpresion.gestion.nombre+"- Gestión "+o.configuracionImpresion.gestion_fin.nombre,0,85,{align:"center"});o.configuracionImpresion.bimonetario?(e.text("Expresado en Bolivianos y Dólares",0,95,{align:"center"}),"COMPARATIVO"!=o.configuracionImpresion.tipoPeriodo.nombre||(e.text(o.configuracionImpresion.gestion.nombre,340,115),e.text(o.configuracionImpresion.gestion_fin.nombre,525,115))):e.text("Expresado en Bolivianos",0,95,{align:"center"}),e.font("Helvetica-Bold",8),e.text(r,30,145),e.font("Helvetica",8),"SAD"==o.configuracionImpresion.tipoNumeracion.nombre_corto?e.text("PÁGINA "+n,540,740):"SAI"==o.configuracionImpresion.tipoNumeracion.nombre_corto?e.text("PÁGINA "+n,0,740,{align:"center"}):"SSD"==o.configuracionImpresion.tipoNumeracion.nombre_corto?e.text("PÁGINA "+n,540,20):"PPD"==o.configuracionImpresion.tipoNumeracion.nombre_corto?e.text("PÁGINA "+n+" DE "+a,520,740):"PPC"==o.configuracionImpresion.tipoNumeracion.nombre_corto?e.text("PÁGINA "+n+" DE "+a,0,740,{align:"center"}):"PPSD"==o.configuracionImpresion.tipoNumeracion.nombre_corto&&e.text("PÁGINA "+n+" DE "+a,520,20),e.font("Helvetica",5),e.text(o.configuracionImpresion.usar_frase_pie_pagina?o.configuracionImpresion.frase_pie_pagina+", ":"",40,740),e.text((o.configuracionImpresion.usar_lugar_emision?o.configuracionImpresion.lugar_emision+", ":"")+(o.configuracionImpresion.usar_fecha_emision?o.fechaATexto(o.configuracionImpresion.fecha_emision):""),40,750)},o.generarExcelBalanceGeneral=function(e){s(o.configuracionImpresion,o.usuario.id_empresa).then(function(e){o.Cuentas=e.cuentas;for(var n=[["","","ESTADO CUENTAS PROVEEDOR"],["Deudor :"+proveedor.razon_social],["Fecha","N Recibo","Descripción","monto","total","total General"]],a=0,r=0;r<proveedor.compras.length;r++){var i=[];a+=proveedor.compras[r].saldo,proveedor.compras[r].fecha=new Date(proveedor.compras[r].fecha),i.push(proveedor.compras[r].fecha.getDate()+"/"+(proveedor.compras[r].fecha.getMonth()+1)+"/"+proveedor.compras[r].fecha.getFullYear()),i.push(proveedor.compras[r].id_movimiento),null==proveedor.compras[r].factura?i.push("PROFORMA"):i.push("factura : "+proveedor.compras[r].factura),i.push(proveedor.compras[r].saldo),i.push(a),i.push(a),n.push(i)}var c="SheetJS",u=new Workbook,s=sheet_from_array_of_arrays(n);u.SheetNames.push(c),u.Sheets[c]=s;var m=XLSX.write(u,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(m)],{type:"application/octet-stream"}),"REPORTE-ESTADO-CUENTA-PROVEEDOR.xlsx"),t.stop()})},o.dibujarCabeceraExelBalanceGeneral=function(){var e="",n="";if("GES"==o.configuracionImpresion.tipoPeriodo.nombre_corto){var a=(new Date).getFullYear(),r=(new Date).getMonth(),t=new Date(a,r-1,0).getDate();e=o.configuracionImpresion.gestion.nombre<a?"Al 31 de Diciembre de "+o.configuracionImpresion.gestion.nombre:"Al "+t+" de "+o.meses[r].nombre+" de "+o.configuracionImpresion.gestion.nombre}else if("MES"==o.configuracionImpresion.tipoPeriodo.nombre_corto)e=o.configuracionImpresion.mes.nombre+" de "+o.configuracionImpresion.gestion.nombre;else if("FECHAS"==o.configuracionImpresion.tipoPeriodo.nombre_corto){var i=new Date(o.convertirFecha(o.configuracionImpresion.fecha_inicio)),c=new Date(o.convertirFecha(o.configuracionImpresion.fecha_fin));e="Desde el "+i.getDate()+" de "+o.meses[i.getMonth()].nombre+" "+i.getFullYear()+" al "+c.getDate()+" de "+o.meses[c.getMonth()].nombre+" de "+c.getFullYear()}else"COMP"==o.configuracionImpresion.tipoPeriodo.nombre_corto&&(e="Gestión "+o.configuracionImpresion.gestion.nombre+"- Gestión "+o.configuracionImpresion.gestion_fin.nombre);if(o.configuracionImpresion.bimonetario){n="Expresado en Bolivianos y Dólares";var u=["GRUPO","SUB GRUPO","GENERICO","APROPIACION","","BOLIVIANOS","","DOLARES"]}else{u=["GRUPO","SUB GRUPO","GENERICO","APROPIACION","","BOLIVIANOS"];n="Expresado en Bolivianos"}return[["","","","BALANCE GENERAL"],["","","",e],["","","",n],u]},o.generarExelApropiacion=function(e,n,a,r,i,c){for(var u=o.dibujarCabeceraExelBalanceGeneral(),s=0;s<r.length;s++){var m=[];if(cuenta=r[s],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){m.push(""),m.push(cuenta.nombre),u.push(m);for(var f=0;f<i.length;f++){m=[],cuenta3=i[f];var d=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==d&&c.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e})){m.push(""),m.push(""),m.push(cuenta3.nombre),u.push(m);for(var p=0;p<c.length;p++){m=[],cuenta2=c[p];d=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==d){m.push(""),m.push(""),m.push(""),m.push(cuenta2.nombre),m.push(""),m.push(number_format(cuenta2.saldo,2));var g=cuenta2.saldo/o.moneda.dolar;o.configuracionImpresion.bimonetario&&m.push(""),m.push(number_format(g,2)),cuenta.total+=cuenta2.saldo,cuenta2.saldo,u.push(m)}}}}m=[],r.length}else r.length}o.configuracionImpresion.usar_firma_uno,o.configuracionImpresion.usar_firma_dos;var l="SheetJS",b=new Workbook,A=sheet_from_array_of_arrays(u);b.SheetNames.push(l),b.Sheets[l]=A;var v=XLSX.write(b,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(v)],{type:"application/octet-stream"}),"REPORTE-BALANCE-GENERAL.xlsx"),t.stop()},o.descargarArchivo=function(o,e){var n=new FileReader;n.onload=function(o){var n=document.createElement("a");n.href=o.target.result,n.target="_blank",n.download=e||"archivo.dat";var a=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});n.dispatchEvent(a),(window.URL||window.webkitURL).revokeObjectURL(n.href)},n.readAsDataURL(o)},o.dibujarCabeceraWordBalanceGeneral=function(){var e="",n="";if("GES"==o.configuracionImpresion.tipoPeriodo.nombre_corto){var a=(new Date).getFullYear(),r=(new Date).getMonth(),t=new Date(a,r-1,0).getDate();e=o.configuracionImpresion.gestion.nombre<a?"Al 31 de Diciembre de "+o.configuracionImpresion.gestion.nombre:"Al "+t+" de "+o.meses[r].nombre+" de "+o.configuracionImpresion.gestion.nombre}else if("MES"==o.configuracionImpresion.tipoPeriodo.nombre_corto)e=o.configuracionImpresion.mes.nombre+" de "+o.configuracionImpresion.gestion.nombre;else if("FECHAS"==o.configuracionImpresion.tipoPeriodo.nombre_corto){var i=new Date(o.convertirFecha(o.configuracionImpresion.fecha_inicio)),c=new Date(o.convertirFecha(o.configuracionImpresion.fecha_fin));e="Desde el "+i.getDate()+" de "+o.meses[i.getMonth()].nombre+" "+i.getFullYear()+" al "+c.getDate()+" de "+o.meses[c.getMonth()].nombre+" de "+c.getFullYear()}else"COMP"==o.configuracionImpresion.tipoPeriodo.nombre_corto&&(e="Gestión "+o.configuracionImpresion.gestion.nombre+"- Gestión "+o.configuracionImpresion.gestion_fin.nombre);if(o.configuracionImpresion.bimonetario){n="Expresado en Bolivianos y Dólares"}else{n="Expresado en Bolivianos"}return"\t\t\t\t\tBALANCE GENERAL\r\n\t\t\t\t\t"+e+"\r\n\t\t\t\t"+n+"\r\n"},o.generarWordApropiacion=function(e,n,a,r,i,c){var u=o.dibujarCabeceraWordBalanceGeneral(),s=[];s.push(u);o.dibujarCabeceraExelBalanceGeneral();for(var m=r.length+i.length+c.length,f=0,d=(o.configuracionImpresion.usar_empesar_numeracion&&o.configuracionImpresion.empesar_numeracion,o.configuracionImpresion.usar_empesar_numeracion?(o.configuracionImpresion.empesar_numeracion,Math.ceil(m/51)):Math.ceil(m/51),0);d<r.length&&f<=51;d++)if(cuenta=r[d],cuenta.total=0,"Activo"===cuenta.clasificacion.nombre){51==f&&(f=0,1,s.push(u)),s.push(cuenta.nombre+"\r\n"),f++;for(var p=0;p<i.length&&f<=51;p++){cuenta3=i[p];var g=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==g&&c.some(function(o){var e=String(o.codigo).substr(0,5);return cuenta3.codigo==e})){s.push("\t"),s.push(cuenta3.nombre+"\r\n"),51==++f&&(f=0,1,s.push(u));for(var l=0;l<c.length&&f<=51;l++){cuenta2=c[l];g=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==g){s.push("\t\t"),cuenta2.nombre.length>22?(text1=String(cuenta2.nombre).substr(0,22),text2=String(cuenta2.nombre).substr(22),s.push(text1),s.push("\n\r\t\t"),f++,s.push(text2),s.push("\t")):(s.push(cuenta2.nombre),s.push("\t")),s.push(number_format(cuenta2.saldo,2));var b=cuenta2.saldo/o.moneda.dolar;o.configuracionImpresion.bimonetario&&s.push("\t\t"+number_format(b,2)),cuenta.total+=cuenta2.saldo,cuenta2.saldo,s.push("\r\n"),51==++f&&(f=0,1,s.push(u))}}}}s.push("\t"),s.push("TOTAL "+cuenta.nombre),s.push("\t\t\t\t"),s.push(number_format(cuenta.total,2));var A=cuenta.total/o.moneda.dolar;o.configuracionImpresion.bimonetario&&s.push("\t\t\t\t"),s.push(number_format(A,2)),r.length}else r.length;return o.configuracionImpresion.usar_firma_uno,o.configuracionImpresion.usar_firma_dos,t.stop(),new Blob(s,{type:"text/plain"})},o.$on("$routeChangeStart",function(o,e){}),o.inicio()});