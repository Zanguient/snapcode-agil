angular.module("agil.controladores").controller("ControladorBalanceGeneral",function(e,o,n,a,r,t,c,u,s,p,m){e.usuario=JSON.parse(o.usuario),e.inicio=function(){e.obtenerTiposPeriodos(),e.obtenerGestiones(),e.obtenerTiposCuenta(),e.obtenerConfiguracionImpresion(),e.obtenerGestionesImpresion()},e.$on("$viewContentLoaded",function(){resaltarPesta√±a(n.path().substring(1)),e.buscarAplicacion(e.usuario.aplicacionesUsuario,n.path().substring(1)),t.stop()}),e.obtenerTiposPeriodos=function(){t.start(),u("EEFF_TP").then(function(o){e.TiposPeriodos=o,t.stop()})},e.obtenerGestiones=function(){t.start(),u("GTN").then(function(o){e.gestiones=o.clases,t.stop()})},e.obtenerConfiguracionImpresion=function(){s(e.usuario.id_empresa).then(function(o){e.configuracionImpresion=o,e.configuracionImpresion.bimonetario=!0,e.configuracionImpresion.tioPeriodo="",e.configuracionImpresion.gestion="",e.configuracionImpresion.gestion_fin="",e.configuracionImpresion.mes="",e.configuracionImpresion.fecha_inicio=null,e.configuracionImpresion.fecha_fin=null,t.stop()})},e.cargarFechasFiltro=function(e){"FECHAS"==e&&setTimeout(function(){aplicarDatePickers()},300)},e.obtenerTiposCuenta=function(){t.start(),u("TCC").then(function(o){e.cuentaTipos=[{id:0,nombre:"PREESTABLECIDO"}],e.cuentaTipos=e.cuentaTipos.concat(o.clases),t.stop()})},e.obtenerGestionesImpresion=function(){t.start(),e.gestionesEF=[],m(e.usuario.id_empresa).then(function(o){t.stop(),o.forEach(function(o){o.habilitado&&(e.fechasImpresion=o)})})},e.generarPdfBalanceGeneral=function(){t.start(),e.configuracionImpresion.fecha_inicio&&(e.configuracionImpresion.inicio2=new Date(e.convertirFecha(e.configuracionImpresion.fecha_inicio)),e.configuracionImpresion.fin2=new Date(e.convertirFecha(e.configuracionImpresion.fecha_fin))),e.configuracionImpresion.fechasImpresion=e.fechasImpresion,p(e.configuracionImpresion,e.usuario.id_empresa).then(function(o){o.monedaCambio?e.moneda=o.monedaCambio:e.moneda={ufv:"--",dolar:"--"},o.arregloActivos=[],o.arregloActivosFijos=[],o.arregloPasivos=[],o.arregloPatrimonio=[],o.arregloIngreso=[],o.arregloEgreso=[],o.arregleCostos=[];if("COMPARATIVO"!=e.configuracionImpresion.tipoPeriodo.nombre){o.arregloPasivos=o.arregloPasivos.concat(o.arregloPatrimonio);var n=e.configuracionImpresion.bimonetario?400:530;"PREESTABLECIDO"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarPdfPreestablecido(o,n):"GENERICA"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarPdfPreestablecido(o,n):"GRUPO"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarPdfGrupo(o,n):"SUB GRUPO"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarPdfsubGrupo(o,n,o.cuentasGrupo,o.cuentasSubGrupo,o.cuentasGenericas,o.cuentasApropiacion):"APROPIACION"==e.configuracionImpresion.tipo_cuenta.nombre&&e.generarPdfApropiacion(o,n)}else{var a=[],r=[],i=[],c=[],u=[],s=[],p=[];o.primero.cuentasGrupo.forEach(function(e,n,r){var i={};i.primerAno=e,a.push(i),n===r.length-1&&o.segundo.cuentasGrupo.forEach(function(e,o,n){for(var r=0;r<a.length;r++){var i=a[r];i.primerAno.id==e.id&&(i.segundoAno=e)}})}),o.primero.cuentasSubGrupo.forEach(function(e,n,a){var i={};i.primerAno=e,r.push(i),n===a.length-1&&o.segundo.cuentasSubGrupo.forEach(function(e,o,n){for(var a=0;a<r.length;a++){var i=r[a];i.primerAno.id==e.id&&(i.segundoAno=e)}})}),o.primero.cuentasGenericas.forEach(function(e,n,a){var r={};r.primerAno=e,i.push(r),n===a.length-1&&o.segundo.cuentasGenericas.forEach(function(e,o,n){for(var a=0;a<i.length;a++){var r=i[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),o.primero.cuentasApropiacion.forEach(function(e,n,a){var r={};r.primerAno=e,c.push(r),n===a.length-1&&o.segundo.cuentasApropiacion.forEach(function(e,o,n){for(var a=0;a<c.length;a++){var r=c[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),o.primero.cuentasSubGrupoFijo.forEach(function(e,n,a){var r={};r.primerAno=e,u.push(r),n===a.length-1&&o.segundo.cuentasSubGrupoFijo.forEach(function(e,o,n){for(var a=0;a<u.length;a++){var r=u[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),o.primero.cuentasGenericasFijo.forEach(function(e,n,a){var r={};r.primerAno=e,s.push(r),n===a.length-1&&o.segundo.cuentasGenericasFijo.forEach(function(e,o,n){for(var a=0;a<s.length;a++){var r=s[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),o.primero.cuentasApropiacionFijo.forEach(function(e,n,a){var r={};r.primerAno=e,p.push(r),n===a.length-1&&o.segundo.cuentasApropiacionFijo.forEach(function(e,o,n){for(var a=0;a<p.length;a++){var r=p[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})});n=e.configuracionImpresion.bimonetario?290:310;"PREESTABLECIDO"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarPdfComprobantePreestablecido(o,n,a,r,i,c,u,s,p):"GENERICA"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarPdfComprobantePreestablecido(o,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,p):"GRUPO"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarPdfComparativoGrupo(o,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,p):"SUB GRUPO"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarPdfComparativosubGrupo(o,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,p):"APROPIACION"==e.configuracionImpresion.tipo_cuenta.nombre&&e.generarPdfComparativoApropiacion(o,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,p),t.stop()}})},e.generarExelBalanceGeneral=function(){t.start(),e.configuracionImpresion.fecha_inicio&&(e.configuracionImpresion.inicio2=new Date(e.convertirFecha(e.configuracionImpresion.fecha_inicio)),e.configuracionImpresion.fin2=new Date(e.convertirFecha(e.configuracionImpresion.fecha_fin))),e.configuracionImpresion.fechasImpresion=e.fechasImpresion,p(e.configuracionImpresion,e.usuario.id_empresa).then(function(o){o.monedaCambio?e.moneda=o.monedaCambio:e.moneda={ufv:"--",dolar:"--"},o.arregloActivos=[],o.arregloActivosFijos=[],o.arregloPasivos=[],o.arregloPatrimonio=[],o.arregloIngreso=[],o.arregloEgreso=[],o.arregleCostos=[];if("COMPARATIVO"!=e.configuracionImpresion.tipoPeriodo.nombre){o.arregloPasivos=o.arregloPasivos.concat(o.arregloPatrimonio);var n=e.configuracionImpresion.bimonetario?400:530;"PREESTABLECIDO"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarExelAPreestablecido(o,n,o.cuentasGrupo,o.cuentasSubGrupo,o.cuentasGenericas,o.cuentasApropiacion):"GENERICA"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarExelAPreestablecido(o,n,o.cuentasGrupo,o.cuentasSubGrupo,o.cuentasGenericas,o.cuentasApropiacion):"GRUPO"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarExelGrupo(o,n,o.cuentasGrupo,o.cuentasSubGrupo,o.cuentasGenericas,o.cuentasApropiacion):"SUB GRUPO"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarExelSubGrupo(o,n,o.cuentasGrupo,o.cuentasSubGrupo,o.cuentasGenericas,o.cuentasApropiacion):"APROPIACION"==e.configuracionImpresion.tipo_cuenta.nombre&&e.generarExelApropiacion(o,n,o.cuentasGrupo,o.cuentasSubGrupo,o.cuentasGenericas,o.cuentasApropiacion)}else{var a=[],r=[],i=[],c=[],u=[],s=[],p=[];o.primero.cuentasGrupo.forEach(function(e,n,r){var i={};i.primerAno=e,a.push(i),n===r.length-1&&o.segundo.cuentasGrupo.forEach(function(e,o,n){for(var r=0;r<a.length;r++){var i=a[r];i.primerAno.id==e.id&&(i.segundoAno=e)}})}),o.primero.cuentasSubGrupo.forEach(function(e,n,a){var i={};i.primerAno=e,r.push(i),n===a.length-1&&o.segundo.cuentasSubGrupo.forEach(function(e,o,n){for(var a=0;a<r.length;a++){var i=r[a];i.primerAno.id==e.id&&(i.segundoAno=e)}})}),o.primero.cuentasGenericas.forEach(function(e,n,a){var r={};r.primerAno=e,i.push(r),n===a.length-1&&o.segundo.cuentasGenericas.forEach(function(e,o,n){for(var a=0;a<i.length;a++){var r=i[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),o.primero.cuentasApropiacion.forEach(function(e,n,a){var r={};r.primerAno=e,c.push(r),n===a.length-1&&o.segundo.cuentasApropiacion.forEach(function(e,o,n){for(var a=0;a<c.length;a++){var r=c[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),o.primero.cuentasSubGrupoFijo.forEach(function(e,n,a){var r={};r.primerAno=e,u.push(r),n===a.length-1&&o.segundo.cuentasSubGrupoFijo.forEach(function(e,o,n){for(var a=0;a<u.length;a++){var r=u[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),o.primero.cuentasGenericasFijo.forEach(function(e,n,a){var r={};r.primerAno=e,s.push(r),n===a.length-1&&o.segundo.cuentasGenericasFijo.forEach(function(e,o,n){for(var a=0;a<s.length;a++){var r=s[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),o.primero.cuentasApropiacionFijo.forEach(function(e,n,a){var r={};r.primerAno=e,p.push(r),n===a.length-1&&o.segundo.cuentasApropiacionFijo.forEach(function(e,o,n){for(var a=0;a<p.length;a++){var r=p[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})});n=e.configuracionImpresion.bimonetario?290:310;"PREESTABLECIDO"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarExelComprobantePreestablecido(o,n,a,r,i,c,u,s,p):"GENERICA"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarExelComprobantePreestablecido(o,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,p):"GRUPO"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarExelComparativoGrupo(o,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,p):"SUB GRUPO"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarExelComparativosubGrupo(o,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,p):"APROPIACION"==e.configuracionImpresion.tipo_cuenta.nombre&&e.generarExelComparativoApropiacion(o,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,p),t.stop()}})},e.generarWordBalanceGeneral=function(){t.start(),e.configuracionImpresion.fecha_inicio&&(e.configuracionImpresion.inicio2=new Date(e.convertirFecha(e.configuracionImpresion.fecha_inicio)),e.configuracionImpresion.fin2=new Date(e.convertirFecha(e.configuracionImpresion.fecha_fin))),e.configuracionImpresion.fechasImpresion=e.fechasImpresion,p(e.configuracionImpresion,e.usuario.id_empresa).then(function(o){if(o.monedaCambio?e.moneda=o.monedaCambio:e.moneda={ufv:"--",dolar:"--"},"COMPARATIVO"!=e.configuracionImpresion.tipoPeriodo.nombre){var n=e.configuracionImpresion.bimonetario?400:530;"PREESTABLECIDO"==e.configuracionImpresion.tipo_cuenta.nombre?e.descargarArchivo(e.generarWordPreestablecido(o,n,o.cuentasGrupo,o.cuentasSubGrupo,o.cuentasGenericas,o.cuentasApropiacion),"reporte-balance-general.doc"):"GENERICA"==e.configuracionImpresion.tipo_cuenta.nombre?e.descargarArchivo(e.generarWordPreestablecido(o,n,o.cuentasGrupo,o.cuentasSubGrupo,o.cuentasGenericas,o.cuentasApropiacion),"reporte-balance-general.doc"):"GRUPO"==e.configuracionImpresion.tipo_cuenta.nombre?e.descargarArchivo(e.generarWordGrupo(o,n,o.cuentasGrupo,o.cuentasSubGrupo,o.cuentasGenericas,o.cuentasApropiacion),"reporte-balance-general.doc"):"SUB GRUPO"==e.configuracionImpresion.tipo_cuenta.nombre?e.descargarArchivo(e.generarWordSubGrupo(o,n,o.cuentasGrupo,o.cuentasSubGrupo,o.cuentasGenericas,o.cuentasApropiacion),"reporte-balance-general.doc"):"APROPIACION"==e.configuracionImpresion.tipo_cuenta.nombre&&e.descargarArchivo(e.generarWordApropiacion(o,n,o.cuentasGrupo,o.cuentasSubGrupo,o.cuentasGenericas,o.cuentasApropiacion),"reporte-balance-general.doc")}else{var a=[],r=[],i=[],c=[],u=[],s=[],p=[];o.primero.cuentasGrupo.forEach(function(e,n,r){var i={};i.primerAno=e,a.push(i),n===r.length-1&&o.segundo.cuentasGrupo.forEach(function(e,o,n){for(var r=0;r<a.length;r++){var i=a[r];i.primerAno.id==e.id&&(i.segundoAno=e)}})}),o.primero.cuentasSubGrupo.forEach(function(e,n,a){var i={};i.primerAno=e,r.push(i),n===a.length-1&&o.segundo.cuentasSubGrupo.forEach(function(e,o,n){for(var a=0;a<r.length;a++){var i=r[a];i.primerAno.id==e.id&&(i.segundoAno=e)}})}),o.primero.cuentasGenericas.forEach(function(e,n,a){var r={};r.primerAno=e,i.push(r),n===a.length-1&&o.segundo.cuentasGenericas.forEach(function(e,o,n){for(var a=0;a<i.length;a++){var r=i[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),o.primero.cuentasApropiacion.forEach(function(e,n,a){var r={};r.primerAno=e,c.push(r),n===a.length-1&&o.segundo.cuentasApropiacion.forEach(function(e,o,n){for(var a=0;a<c.length;a++){var r=c[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),o.primero.cuentasSubGrupoFijo.forEach(function(e,n,a){var r={};r.primerAno=e,u.push(r),n===a.length-1&&o.segundo.cuentasSubGrupoFijo.forEach(function(e,o,n){for(var a=0;a<u.length;a++){var r=u[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),o.primero.cuentasGenericasFijo.forEach(function(e,n,a){var r={};r.primerAno=e,s.push(r),n===a.length-1&&o.segundo.cuentasGenericasFijo.forEach(function(e,o,n){for(var a=0;a<s.length;a++){var r=s[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})}),o.primero.cuentasApropiacionFijo.forEach(function(e,n,a){var r={};r.primerAno=e,p.push(r),n===a.length-1&&o.segundo.cuentasApropiacionFijo.forEach(function(e,o,n){for(var a=0;a<p.length;a++){var r=p[a];r.primerAno.id==e.id&&(r.segundoAno=e)}})});n=e.configuracionImpresion.bimonetario?290:310;"PREESTABLECIDO"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarWordComprobantePreestablecido(o,n,a,r,i,c,u,s,p):"GENERICA"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarWordComprobantePreestablecido(o,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,p):"GRUPO"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarWordComparativoGrupo(o,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,p):"SUB GRUPO"==e.configuracionImpresion.tipo_cuenta.nombre?e.generarWordComparativosubGrupo(o,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,p):"APROPIACION"==e.configuracionImpresion.tipo_cuenta.nombre&&e.generarWordComparativoApropiacion(o,n,a,r,i,cuentasApropiacioncuentasSubGrupoFijo,s,p),t.stop()}})},e.generarPdfApropiacion=function(o,n){var a=new PDFDocument({size:"letter",margin:10}),r=a.pipe(blobStream()),i=130,c=0,u=e.configuracionImpresion.usar_empesar_numeracion?e.configuracionImpresion.empesar_numeracion:1,s=e.configuracionImpresion.usar_empesar_numeracion?e.configuracionImpresion.empesar_numeracion-1+Math.ceil(80):Math.ceil(80),p=0;e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8);for(var m=0;m<o.cuentasActivos.length&&c<=25;m++)if(cuentaGrupo=o.cuentasActivos[m],cuentaGrupo.hijos.length>0)for(var l=0;l<cuentaGrupo.hijos.length&&c<=25;l++){cuentaSubGrupo=cuentaGrupo.hijos[l],cuentaSubGrupo.total=0,a.text(cuentaSubGrupo.nombre,30,i),i+=20,25==++c&&(a.addPage({margin:0,bufferPages:!0}),i=140,c=0,u+=1,e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8));for(var f=0;f<cuentaSubGrupo.hijos.length&&c<=25;f++){cuentaGenerica=cuentaSubGrupo.hijos[f],cuentaGenerica.total=0,a.text(cuentaGenerica.nombre,40,i),i+=20,25==++c&&(a.addPage({margin:0,bufferPages:!0}),i=140,c=0,u+=1,e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8));for(var g=0;g<cuentaGenerica.hijos.length&&c<=25;g++)cuentasApropiacion=cuentaGenerica.hijos[g],cuentaGenerica.total+=cuentasApropiacion.saldo,cuentaSubGrupo.total+=cuentasApropiacion.saldo,p+=cuentasApropiacion.saldo,a.text(cuentasApropiacion.nombre,50,i),a.text(number_format(cuentasApropiacion.saldo,2),n,i),i+=20,25==++c&&(a.addPage({margin:0,bufferPages:!0}),i=140,c=0,u+=1,e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8));a.text("TOTAL "+cuentaGenerica.nombre,90,i);var b=cuentaGenerica.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(b,2),n+130,i),a.text(number_format(cuentaGenerica.total,2),n,i),i+=20,25==++c&&(a.addPage({margin:0,bufferPages:!0}),i=140,c=0,u+=1,e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8))}a.text("TOTAL "+cuentaSubGrupo.nombre,90,i);b=cuentaSubGrupo.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(b,2),n+130,i),a.text(number_format(cuentaSubGrupo.total,2),n,i),i+=20,25==++c&&(a.addPage({margin:0,bufferPages:!0}),i=140,c=0,u+=1,e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8)),l===cuentaGrupo.hijos.length-1&&e.DibujarFijoApropiacion(o,p,a,i,c,u,s,25,n)}e.configuracionImpresion.usar_firma_uno&&(a.text(e.configuracionImpresion.firma_uno,170,720),a.text(e.configuracionImpresion.cargo_uno,170,730)),e.configuracionImpresion.usar_firma_dos&&(a.text(e.configuracionImpresion.firma_dos,370,720),a.text(e.configuracionImpresion.cargo_dos,370,730)),a.end(),r.on("finish",function(){var e=r.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),t.stop()},e.DibujarFijoApropiacion=function(o,n,a,r,i,t,c,u,s){if(a.font("Helvetica",8),o.cuentasFijos.length>0)for(var p=0;p<o.cuentasFijos.length&&i<=u;p++){if(cuentaGrupo=o.cuentasFijos[p],cuentaGrupo.hijos.length>0)for(var m=0;m<cuentaGrupo.hijos.length&&i<=u;m++){cuentaSubGrupo=cuentaGrupo.hijos[m],cuentaSubGrupo.total=0,a.text(cuentaSubGrupo.nombre,30,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8));for(var l=0;l<cuentaSubGrupo.hijos.length&&i<=u;l++){cuentaGenerica=cuentaSubGrupo.hijos[l],cuentaGenerica.total=0,a.text(cuentaGenerica.nombre,40,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8));for(var f=0;f<cuentaSubGrupo.hijos.length&&i<=u;f++){cuentaGenericaDepre=cuentaSubGrupo.hijos[f];var g=String(cuentaGenericaDepre.codigo).substr(2);if(String(cuentaGenerica.codigo).substr(2)==g&&cuentaGenerica.id!=cuentaGenericaDepre.id&&(a.text(cuentaGenericaDepre.nombre,40,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8))),f==cuentaSubGrupo.hijos.length-1)for(var b=0;b<cuentaGenerica.hijos.length&&i<=u;b++)cuentasApropiacion=cuentaGenerica.hijos[b],cuentaGenerica.total+=cuentasApropiacion.saldo,cuentaSubGrupo.total+=cuentasApropiacion.saldo,n+=cuentasApropiacion.saldo,a.text(cuentasApropiacion.nombre,50,r),a.text(cuentasApropiacion.saldo,s,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8))}a.text("TOTAL "+cuentaGenerica.nombre,90,r);var d=cuentaGenerica.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(d,2),s+130,r),a.text(number_format(cuentaGenerica.total,2),s,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8))}a.text("TOTAL "+cuentaSubGrupo.nombre,90,r);d=cuentaSubGrupo.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(d,2),s+130,r),a.text(number_format(cuentaSubGrupo.total,2),s,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8))}p===o.cuentasFijos.length-1&&e.dibujarPatrimonioApropiacion(o,n,a,r,i,t,c,u,s)}else e.dibujarPatrimonioApropiacion(o,n,a,r,i,t,c,u,s)},e.DibujarFijoPreestablecido=function(o,n,a,r,i,t,c,u,s){if(a.font("Helvetica",8),o.cuentasFijos.length>0)for(var p=0;p<o.cuentasFijos.length&&i<=u;p++){if(cuentaGrupo=o.cuentasFijos[p],cuentaGrupo.hijos.length>0)for(var m=0;m<cuentaGrupo.hijos.length&&i<=u;m++){cuentaSubGrupo=cuentaGrupo.hijos[m],cuentaSubGrupo.total=0,a.text(cuentaSubGrupo.nombre,30,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8));for(var l=0;l<cuentaSubGrupo.hijos.length&&i<=u;l++){cuentaGenerica=cuentaSubGrupo.hijos[l],cuentaGenerica.total=0,a.text(cuentaGenerica.nombre,40,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8));for(var f=0;f<cuentaSubGrupo.hijos.length&&i<=u;f++){cuentaGenericaDepre=cuentaSubGrupo.hijos[f];var g=String(cuentaGenericaDepre.codigo).substr(2);if(String(cuentaGenerica.codigo).substr(2)==g&&(a.font("Helvetica",8),cuentaGenerica.id!=cuentaGenericaDepre.id&&(a.text(cuentaGenericaDepre.nombre,40,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8)))),f==cuentaSubGrupo.hijos.length-1)for(var b=0;b<cuentaGenerica.hijos.length&&i<=u;b++)cuentasApropiacion=cuentaGenerica.hijos[b],cuentaGenerica.total+=cuentasApropiacion.saldo,cuentaSubGrupo.total+=cuentasApropiacion.saldo,n+=cuentasApropiacion.saldo}a.text(number_format(cuentaGenerica.total,2),s,r-20)}a.text("TOTAL "+cuentaSubGrupo.nombre,90,r);var d=cuentaSubGrupo.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(d,2),s+130,r),a.text(number_format(cuentaSubGrupo.total,2),s,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8))}p===o.cuentasFijos.length-1&&e.dibujarPatrimonioPredefinido(o,n,a,r,i,t,c,u,s)}else e.dibujarPatrimonioPredefinido(o,n,a,r,i,t,c,u,s)},e.DibujarFijoComparativoPreestablecido=function(o,n,a,r,i,t,c,u,s,p,m,l,f,g,b,d){a.font("Helvetica",8);for(var A=0;A<g.length&&i<=u;A++)if(cuenta=g[A],cuenta.primerAno.total=0,cuenta.segundoAno.total=0,"Activo"===cuenta.primerAno.clasificacion.nombre){i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8)),a.text(cuenta.primerAno.nombre,30,r),r+=20,i++;for(var h=0;h<b.length&&i<=u;h++){cuenta3=b[h],cuenta3.primerAno.total=0,cuenta3.segundoAno.total=0;var G=String(cuenta3.primerAno.codigo).substr(0,3);if(cuenta.primerAno.codigo==G){if(d.some(function(e){var o=String(e.primerAno.codigo).substr(0,5);return cuenta3.primerAno.codigo==o})){a.text(cuenta3.primerAno.nombre,40,r),r+=20,i++;for(var P=0;P<b.length&&i<=u;P++){cuenta6=b[P],cuenta6.primerAno.total=0,cuenta6.segundoAno.total=0;G=String(cuenta6.primerAno.codigo).substr(3);if(String(cuenta3.primerAno.codigo).substr(3)==G&&"Pasivo"===cuenta6.primerAno.clasificacion.nombre&&(a.text(cuenta6.primerAno.nombre,40,r),r+=20,i++),P==b.length-1){for(var v=0;v<d.length&&i<=u;v++)if(cuenta2=d[v],"4"===cuenta2.primerAno.tipoCuenta.nombre_corto){G=String(cuenta2.primerAno.codigo).substr(0,5);if(cuenta3.primerAno.codigo==G){cuenta3.primerAno.total+=cuenta2.primerAno.saldo,cuenta3.segundoAno.total+=cuenta2.segundoAno.saldo;for(var I=0;I<d.length&&i<=u;I++)if(cuenta5=d[I],"4"===cuenta5.primerAno.tipoCuenta.nombre_corto){G=String(cuenta5.primerAno.codigo).substr(4);if(String(cuenta2.primerAno.codigo).substr(4)==G&&"Pasivo"===cuenta5.primerAno.clasificacion.nombre){cuenta6.primerAno.total+=cuenta5.primerAno.saldo,cuenta6.segundoAno.total+=cuenta5.segundoAno.saldo;var S=cuenta2.primerAno.saldo-cuenta5.primerAno.saldo,_=cuenta2.segundoAno.saldo-cuenta5.segundoAno.saldo;cuenta.primerAno.total+=S,n.totalActivosPrimerAnio+=S,cuenta.segundoAno.total+=_,n.totalActivosSegundoAnio+=_,i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8))}else i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8))}else i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8));i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8))}else i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8))}else i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8));a.text(cuenta3.primerAno.total.toFixed(2),s-80,r-40),a.text(cuenta3.segundoAno.total.toFixed(2),s+130,r-40);cuenta3.primerAno.total,e.moneda.dolar;a.text("("+cuenta6.primerAno.total.toFixed(2)+")",s-80,r-20),a.text("("+cuenta6.segundoAno.total.toFixed(2)+")",s+130,r-20);cuenta6.primerAno.total,e.moneda.dolar;var j=(x=cuenta3.primerAno.total-cuenta6.primerAno.total)/e.moneda.dolar;a.text(number_format(x,2),s,r-20),e.configuracionImpresion.bimonetario&&a.text(number_format(j,2),s+80,r-20);var x;j=(x=cuenta3.segundoAno.total-cuenta6.segundoAno.total)/e.moneda.dolar;a.text(number_format(x,2),s+180,r-20),e.configuracionImpresion.bimonetario&&a.text(number_format(j,2),s+260,r-20)}}}}else i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8))}a.text("TOTAL "+cuenta.primerAno.nombre,90,r),a.text(number_format(cuenta.primerAno.total,2),s,r);var O=cuenta.primerAno.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(O,2),s+80,r),a.text(number_format(cuenta.segundoAno.total,2),s+180,r);O=cuenta.segundoAno.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(O,2),s+260,r),r+=20,i++,A===g.length-1&&e.dibujarPatrimonioComparativoPredefinido(o,n,a,r,i,t,c,u,s,p,m,l,f)}else A===g.length-1&&e.dibujarPatrimonioComparativoPredefinido(o,n,a,r,i,t,c,u,s,p,m,l,f)},e.DibujarFijoSubGrupo=function(o,n,a,r,i,t,c,u,s){if(a.font("Helvetica",8),o.cuentasFijos.length>0)for(var p=0;p<o.cuentasFijos.length&&i<=u;p++){if(cuentaGrupo=o.cuentasFijos[p],cuentaGrupo.hijos.length>0)for(var m=0;m<cuentaGrupo.hijos.length&&i<=u;m++){cuentaSubGrupo=cuentaGrupo.hijos[m],cuentaSubGrupo.total=0,a.text(cuentaSubGrupo.nombre,30,r);for(var l=0;l<cuentaSubGrupo.hijos.length&&i<=u;l++){cuentaGenerica=cuentaSubGrupo.hijos[l],cuentaGenerica.total=0;for(var f=0;f<cuentaSubGrupo.hijos.length&&i<=u;f++)if(cuentaGenericaDepre=cuentaSubGrupo.hijos[f],f==cuentaSubGrupo.hijos.length-1)for(var g=0;g<cuentaGenerica.hijos.length&&i<=u;g++)cuentasApropiacion=cuentaGenerica.hijos[g],cuentaGenerica.total+=cuentasApropiacion.saldo,cuentaSubGrupo.total+=cuentasApropiacion.saldo,n+=cuentasApropiacion.saldo}a.text(number_format(cuentaSubGrupo.total,2),s,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8)),a.text("TOTAL "+cuentaSubGrupo.nombre,90,r);var b=cuentaSubGrupo.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(b,2),s+130,r),a.text(number_format(cuentaSubGrupo.total,2),s,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"ACTIVO"),a.font("Helvetica",8))}p===o.cuentasFijos.length-1&&e.dibujarPatrimonioSubGrupo(o,n,a,r,i,t,c,u,s)}else e.dibujarPatrimonioSubGrupo(o,n,a,r,i,t,c,u,s)},e.DibujarFijoGrupo=function(o,n,a,r,i,t,c,u,s){if(a.font("Helvetica",8),o.cuentasFijos.length>0)for(var p=0;p<o.cuentasFijos.length&&i<=u;p++){if(cuentaGrupo=o.cuentasFijos[p],cuentaGrupo.total=0,cuentaGrupo.hijos.length>0)for(var m=0;m<cuentaGrupo.hijos.length&&i<=u;m++){cuentaSubGrupo=cuentaGrupo.hijos[m];for(var l=0;l<cuentaSubGrupo.hijos.length&&i<=u;l++){cuentaGenerica=cuentaSubGrupo.hijos[l],cuentaGenerica.total=0;for(var f=0;f<cuentaSubGrupo.hijos.length&&i<=u;f++)if(cuentaGenericaDepre=cuentaSubGrupo.hijos[f],f==cuentaSubGrupo.hijos.length-1)for(var g=0;g<cuentaGenerica.hijos.length&&i<=u;g++)cuentasApropiacion=cuentaGenerica.hijos[g],cuentaGenerica.total+=cuentasApropiacion.saldo,cuentaGrupo.total+=cuentasApropiacion.saldo,n+=cuentasApropiacion.saldo}}p===o.cuentasFijos.length-1&&e.dibujarPatrimonioGrupo(o,n,a,r,i,t,c,u,s)}else e.dibujarPatrimonioGrupo(o,n,a,r,i,t,c,u,s)},e.dibujarPatrimonioApropiacion=function(o,n,a,r,i,t,c,u,s){var p=0;a.font("Helvetica-Bold",8),a.text("TOTAL ACTIVOS  ",30,r),a.text(number_format(n,2),s,r);var m=n/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(m,2),s+130,r),r+=20,i++,a.text("PASIVO Y PATRIMONIO",0,r,{align:"center"}),a.font("Helvetica",8),r+=20,i++;for(var l=0;l<o.cuentasPasivosPatrimonios.length&&i<=u;l++){if(cuentaGrupo=o.cuentasPasivosPatrimonios[l],cuentaGrupo.hijos.length>0)for(var f=0;f<cuentaGrupo.hijos.length&&i<=u;f++){cuentaSubGrupo=cuentaGrupo.hijos[f],cuentaSubGrupo.total=0,a.text(cuentaSubGrupo.nombre,30,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8));for(var g=0;g<cuentaSubGrupo.hijos.length&&i<=u;g++){cuentaGenerica=cuentaSubGrupo.hijos[g],cuentaGenerica.total=0,a.text(cuentaGenerica.nombre,40,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8));for(var b=0;b<cuentaGenerica.hijos.length&&i<=u;b++)cuentasApropiacion=cuentaGenerica.hijos[b],cuentaGenerica.total+=cuentasApropiacion.saldo,cuentaSubGrupo.total+=cuentasApropiacion.saldo,p+=cuentasApropiacion.saldo,a.text(cuentasApropiacion.nombre,50,r),a.text(cuentasApropiacion.saldo,s,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8));a.text("TOTAL "+cuentaGenerica.nombre,90,r);m=cuentaGenerica.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(m,2),s+130,r),a.text(number_format(cuentaGenerica.total,2),s,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}a.text("TOTAL "+cuentaSubGrupo.nombre,90,r);m=cuentaSubGrupo.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(m,2),s+130,r),a.text(number_format(cuentaSubGrupo.total,2),s,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}if(l===o.cuentasPasivosPatrimonios.length-1){a.font("Helvetica-Bold",8),a.text("TOTAL PASIVO Y PATRIMONIO:  ",30,r),a.text(number_format(p,2),s,r);var d=Math.round(p/e.moneda.dolar*1e4)/1e4;e.configuracionImpresion.bimonetario&&a.text(number_format(d,2),s+130,r)}}},e.dibujarPatrimonioComparativoPredefinido=function(o,n,a,r,i,t,c,u,s,p,m,l,f){var g={totalPasivoPrimerAnio:0,totalPasivoSegundoAnio:0};a.font("Helvetica-Bold",8),a.text("TOTAL ACTIVOS  ",30,r),a.text(number_format(n.totalActivosPrimerAnio,2),s,r);var b=n.totalActivosPrimerAnio/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(b,2),s+130,r),r+=20,i++,a.text("PASIVO Y PATRIMONIO",0,r,{align:"center"}),i++,r+=20;for(var d=0;d<m.length&&i<=u;d++){a.font("Helvetica",8);var A=m[d];if("Pasivo"===A.primerAno.clasificacion.nombre||"Capital"==A.primerAno.clasificacion.nombre){i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8)),a.text(A.primerAno.nombre,30,r),A.primerAno.total=0,A.segundoAno.total=0,r+=20,i++;for(var h=0;h<l.length&&i<=u;h++){var G=l[h],P=String(G.primerAno.codigo).substr(0,3);if(A.primerAno.codigo==P){if(f.some(function(e){var o=String(e.primerAno.codigo).substr(0,5);return G.primerAno.codigo==o})){a.text(G.primerAno.nombre,40,r),G.primerAno.total=0,G.primerAno.totalSus=0,G.segundoAno.total=0,G.segundoAno.totalSus=0;for(var v=0;v<f.length&&i<=u;v++){var I=f[v];if("4"===I.primerAno.tipoCuenta.nombre_corto){P=String(I.primerAno.codigo).substr(0,5);G.primerAno.codigo==P?(G.primerAno.total+=I.primerAno.saldo,G.primerAno.totalSus+=I.primerAno.saldo/e.moneda.dolar,A.primerAno.total+=I.primerAno.saldo,G.segundoAno.total+=I.segundoAno.saldo,G.segundoAno.totalSus+=I.segundoAno.saldo/e.moneda.dolar,A.segundoAno.total+=I.segundoAno.saldo,g.totalPasivoPrimerAnio+=I.primerAno.saldo,g.totalPasivoSegundoAnio+=I.segundoAno.saldo,i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))):i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}else i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}a.text(G.primerAno.total,s,r),e.configuracionImpresion.bimonetario&&a.text(number_format(G.primerAno.totalSus,2),s+80,r),a.text(G.segundoAno.total,s+180,r),e.configuracionImpresion.bimonetario&&a.text(number_format(G.segundoAno.totalSus,2),s+260,r),r+=20,i++}}else i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}a.text("TOTAL "+A.primerAno.nombre,90,r),a.text(number_format(A.primerAno.total,2),s,r),a.text(number_format(A.segundoAno.total,2),s+180,r);var S=Math.round(A.primerAno.total/e.moneda.dolar*1e4)/1e4;e.configuracionImpresion.bimonetario&&a.text(number_format(S,2),s+80,r);S=Math.round(A.segundoAno.total/e.moneda.dolar*1e4)/1e4;e.configuracionImpresion.bimonetario&&a.text(number_format(S,2),s+260,r),r+=20,i++}if(d===m.length-1){a.font("Helvetica-Bold",8),a.text("TOTAL PASIVO Y PATRIMONIO:  ",30,r),a.text(number_format(g.totalPasivoPrimerAnio,2),s,r);S=Math.round(g.totalPasivoPrimerAnio/e.moneda.dolar*1e4)/1e4;e.configuracionImpresion.bimonetario&&a.text(number_format(S,2),s+80,r),a.text(number_format(g.totalPasivoSegundoAnio,2),s+180,r);S=Math.round(g.totalPasivoSegundoAnio/e.moneda.dolar*1e4)/1e4;e.configuracionImpresion.bimonetario&&a.text(number_format(S,2),s+260,r)}}},e.dibujarPatrimonioPredefinido=function(o,n,a,r,i,t,c,u,s){var p=0;a.font("Helvetica-Bold",8),a.text("TOTAL ACTIVOS  ",30,r),a.text(number_format(n,2),s,r);var m=n/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(m,2),s+130,r),r+=20,i++,a.text("PASIVO Y PATRIMONIO",0,r,{align:"center"}),a.font("Helvetica",8),r+=20,i++;for(var l=0;l<o.cuentasPasivosPatrimonios.length&&i<=u;l++){if(cuentaGrupo=o.cuentasPasivosPatrimonios[l],cuentaGrupo.hijos.length>0)for(var f=0;f<cuentaGrupo.hijos.length&&i<=u;f++){cuentaSubGrupo=cuentaGrupo.hijos[f],cuentaSubGrupo.total=0,a.text(cuentaSubGrupo.nombre,30,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8));for(var g=0;g<cuentaSubGrupo.hijos.length&&i<=u;g++){cuentaGenerica=cuentaSubGrupo.hijos[g],cuentaGenerica.total=0,a.text(cuentaGenerica.nombre,40,r);for(var b=0;b<cuentaGenerica.hijos.length&&i<=u;b++)cuentasApropiacion=cuentaGenerica.hijos[b],cuentaGenerica.total+=cuentasApropiacion.saldo,cuentaSubGrupo.total+=cuentasApropiacion.saldo,p+=cuentasApropiacion.saldo;a.text(number_format(cuentaGenerica.total,2),s,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}a.text("TOTAL "+cuentaSubGrupo.nombre,90,r);m=cuentaSubGrupo.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(m,2),s+130,r),a.text(number_format(cuentaSubGrupo.total,2),s,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}if(l===o.cuentasPasivosPatrimonios.length-1){a.font("Helvetica-Bold",8),a.text("TOTAL PASIVO Y PATRIMONIO:  ",30,r),a.text(number_format(p,2),s,r);var d=Math.round(p/e.moneda.dolar*1e4)/1e4;e.configuracionImpresion.bimonetario&&a.text(number_format(d,2),s+130,r)}}},e.dibujarPatrimonioSubGrupo=function(o,n,a,r,i,t,c,u,s){var p=0;a.font("Helvetica-Bold",8),a.text("TOTAL ACTIVOS  ",30,r),a.text(number_format(n,2),s,r);var m=n/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(m,2),s+130,r),r+=20,i++,a.text("PASIVO Y PATRIMONIO",0,r,{align:"center"}),a.font("Helvetica",8),r+=20,i++;for(var l=0;l<o.cuentasPasivosPatrimonios.length&&i<=u;l++){if(cuentaGrupo=o.cuentasPasivosPatrimonios[l],cuentaGrupo.hijos.length>0)for(var f=0;f<cuentaGrupo.hijos.length&&i<=u;f++){cuentaSubGrupo=cuentaGrupo.hijos[f],cuentaSubGrupo.total=0,a.text(cuentaSubGrupo.nombre,30,r);for(var g=0;g<cuentaSubGrupo.hijos.length&&i<=u;g++){cuentaGenerica=cuentaSubGrupo.hijos[g],cuentaGenerica.total=0;for(var b=0;b<cuentaGenerica.hijos.length&&i<=u;b++)cuentasApropiacion=cuentaGenerica.hijos[b],cuentaGenerica.total+=cuentasApropiacion.saldo,cuentaSubGrupo.total+=cuentasApropiacion.saldo,p+=cuentasApropiacion.saldo}a.text(number_format(cuentaSubGrupo.total,2),s,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8)),a.text("TOTAL "+cuentaSubGrupo.nombre,90,r);m=cuentaSubGrupo.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(m,2),s+130,r),a.text(number_format(cuentaSubGrupo.total,2),s,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}if(l===o.cuentasPasivosPatrimonios.length-1){a.font("Helvetica-Bold",8),a.text("TOTAL PASIVO Y PATRIMONIO:  ",30,r),a.text(number_format(p,2),s,r);var d=Math.round(p/e.moneda.dolar*1e4)/1e4;e.configuracionImpresion.bimonetario&&a.text(number_format(d,2),s+130,r)}}},e.dibujarPatrimonioGrupo=function(o,n,a,r,i,t,c,u,s){var p=0;a.font("Helvetica-Bold",8),a.text("TOTAL ACTIVOS  ",30,r),a.text(number_format(n,2),s,r);var m=n/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(m,2),s+130,r),r+=20,i++,a.text("PASIVO Y PATRIMONIO",0,r,{align:"center"}),a.font("Helvetica",8),r+=20,i++;for(var l=0;l<o.cuentasPasivosPatrimonios.length&&i<=u;l++){if(cuentaGrupo=o.cuentasPasivosPatrimonios[l],cuentaGrupo.total=0,a.text(cuentaGrupo.nombre,30,r),cuentaGrupo.hijos.length>0){for(var f=0;f<cuentaGrupo.hijos.length&&i<=u;f++){cuentaSubGrupo=cuentaGrupo.hijos[f];for(var g=0;g<cuentaSubGrupo.hijos.length&&i<=u;g++){cuentaGenerica=cuentaSubGrupo.hijos[g],cuentaGenerica.total=0;for(var b=0;b<cuentaGenerica.hijos.length&&i<=u;b++)cuentasApropiacion=cuentaGenerica.hijos[b],cuentaGenerica.total+=cuentasApropiacion.saldo,cuentaGrupo.total+=cuentasApropiacion.saldo,p+=cuentasApropiacion.saldo}}a.text(number_format(cuentaGrupo.total,2),s,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8)),a.text("TOTAL "+cuentaGrupo.nombre,90,r);m=cuentaGrupo.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(m,2),s+130,r),a.text(number_format(cuentaGrupo.total,2),s,r),r+=20,++i==u&&(a.addPage({margin:0,bufferPages:!0}),r=140,i=0,t+=1,e.dibujarCabeceraPDFBalanceGeneral(a,t,c,"PASIVO Y PATRIMONIO"),a.font("Helvetica",8))}if(l===o.cuentasPasivosPatrimonios.length-1){a.font("Helvetica-Bold",8),a.text("TOTAL PASIVO Y PATRIMONIO:  ",30,r),a.text(number_format(p,2),s,r);var d=Math.round(p/e.moneda.dolar*1e4)/1e4;e.configuracionImpresion.bimonetario&&a.text(number_format(d,2),s+130,r)}}},e.generarPdfPreComparativo=function(e,o,n,a,r,i,t,c,u){},e.generarPdfGrupo=function(o,n){var a=new PDFDocument({size:"letter",margin:10}),r=a.pipe(blobStream()),i=130,c=0,u=e.configuracionImpresion.usar_empesar_numeracion?e.configuracionImpresion.empesar_numeracion:1,s=e.configuracionImpresion.usar_empesar_numeracion?e.configuracionImpresion.empesar_numeracion-1+Math.ceil(2e3/28):Math.ceil(2e3/28),p=0;e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8);for(var m=0;m<o.cuentasActivos.length&&c<=28;m++){if(cuentaGrupo=o.cuentasActivos[m],cuentaGrupo.total=0,a.text(cuentaGrupo.nombre,30,i),cuentaGrupo.hijos.length>0){for(var l=0;l<cuentaGrupo.hijos.length&&c<=28;l++){cuentaSubGrupo=cuentaGrupo.hijos[l];for(var f=0;f<cuentaSubGrupo.hijos.length&&c<=28;f++){cuentaGenerica=cuentaSubGrupo.hijos[f],cuentaGenerica.total=0;for(var g=0;g<cuentaGenerica.hijos.length&&c<=28;g++)cuentasApropiacion=cuentaGenerica.hijos[g],cuentaGrupo.total+=cuentasApropiacion.saldo,p+=cuentasApropiacion.saldo}}a.text(number_format(cuentaGrupo.total,2),n,i),i+=20,28==++c&&(a.addPage({margin:0,bufferPages:!0}),i=140,c=0,u+=1,e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8)),a.text("TOTAL "+cuentaGrupo.nombre,90,i);var b=cuentaGrupo.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(b,2),n+130,i),a.text(number_format(cuentaGrupo.total,2),n,i),i+=20,28==++c&&(a.addPage({margin:0,bufferPages:!0}),i=140,c=0,u+=1,e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8))}m===o.cuentasActivos.length-1&&e.DibujarFijoGrupo(o,p,a,i,c,u,s,28,n)}e.configuracionImpresion.usar_firma_uno&&(a.text(e.configuracionImpresion.firma_uno,170,720),a.text(e.configuracionImpresion.cargo_uno,170,730)),e.configuracionImpresion.usar_firma_dos&&(a.text(e.configuracionImpresion.firma_dos,370,720),a.text(e.configuracionImpresion.cargo_dos,370,730)),a.end(),r.on("finish",function(){var e=r.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),t.stop()},e.obtenercodigoCuenta=function(e){var o="123456789",n=e,a="";for(i=0;i<n.length;i++)for(ch=n.charAt(i),j=0;j<o.length;j++)ch==o.charAt(j)&&(a+=ch);return a},e.generarPdfsubGrupo=function(o,n){var a=new PDFDocument({size:"letter",margin:10}),r=a.pipe(blobStream()),i=130,c=0,u=e.configuracionImpresion.usar_empesar_numeracion?e.configuracionImpresion.empesar_numeracion:1,s=e.configuracionImpresion.usar_empesar_numeracion?e.configuracionImpresion.empesar_numeracion-1+Math.ceil(2e3/28):Math.ceil(2e3/28),p=0;e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8);for(var m=0;m<o.cuentasActivos.length&&c<=28;m++)if(cuentaGrupo=o.cuentasActivos[m],cuentaGrupo.hijos.length>0)for(var l=0;l<cuentaGrupo.hijos.length&&c<=28;l++){cuentaSubGrupo=cuentaGrupo.hijos[l],cuentaSubGrupo.total=0,a.text(cuentaSubGrupo.nombre,30,i);for(var f=0;f<cuentaSubGrupo.hijos.length&&c<=28;f++){cuentaGenerica=cuentaSubGrupo.hijos[f],cuentaGenerica.total=0;for(var g=0;g<cuentaGenerica.hijos.length&&c<=28;g++)cuentasApropiacion=cuentaGenerica.hijos[g],cuentaSubGrupo.total+=cuentasApropiacion.saldo,p+=cuentasApropiacion.saldo}a.text(number_format(cuentaSubGrupo.total,2),n,i),i+=20,28==++c&&(a.addPage({margin:0,bufferPages:!0}),i=140,c=0,u+=1,e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8)),a.text("TOTAL "+cuentaSubGrupo.nombre,90,i);var b=cuentaSubGrupo.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(b,2),n+130,i),a.text(number_format(cuentaSubGrupo.total,2),n,i),i+=20,28==++c&&(a.addPage({margin:0,bufferPages:!0}),i=140,c=0,u+=1,e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8)),l===cuentaGrupo.hijos.length-1&&e.DibujarFijoSubGrupo(o,p,a,i,c,u,s,28,n)}e.configuracionImpresion.usar_firma_uno&&(a.text(e.configuracionImpresion.firma_uno,170,720),a.text(e.configuracionImpresion.cargo_uno,170,730)),e.configuracionImpresion.usar_firma_dos&&(a.text(e.configuracionImpresion.firma_dos,370,720),a.text(e.configuracionImpresion.cargo_dos,370,730)),a.end(),r.on("finish",function(){var e=r.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),t.stop()},e.generarPdfPreestablecido=function(o,n){var a=new PDFDocument({size:"letter",margin:10}),r=a.pipe(blobStream()),i=130,c=0,u=e.configuracionImpresion.usar_empesar_numeracion?e.configuracionImpresion.empesar_numeracion:1,s=e.configuracionImpresion.usar_empesar_numeracion?e.configuracionImpresion.empesar_numeracion-1+Math.ceil(2e3/28):Math.ceil(2e3/28),p=0;e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8);for(var m=0;m<o.cuentasActivos.length&&c<=28;m++)if(cuentaGrupo=o.cuentasActivos[m],cuentaGrupo.hijos.length>0)for(var l=0;l<cuentaGrupo.hijos.length&&c<=28;l++){cuentaSubGrupo=cuentaGrupo.hijos[l],cuentaSubGrupo.total=0,a.text(cuentaSubGrupo.nombre,30,i),i+=20,28==++c&&(a.addPage({margin:0,bufferPages:!0}),i=140,c=0,u+=1,e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8));for(var f=0;f<cuentaSubGrupo.hijos.length&&c<=28;f++){cuentaGenerica=cuentaSubGrupo.hijos[f],cuentaGenerica.total=0,a.text(cuentaGenerica.nombre,40,i);for(var g=0;g<cuentaGenerica.hijos.length&&c<=28;g++)cuentasApropiacion=cuentaGenerica.hijos[g],cuentaGenerica.total+=cuentasApropiacion.saldo,cuentaSubGrupo.total+=cuentasApropiacion.saldo,p+=cuentasApropiacion.saldo;a.text(number_format(cuentaGenerica.total,2),n,i),i+=20,28==++c&&(a.addPage({margin:0,bufferPages:!0}),i=140,c=0,u+=1,e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8))}a.text("TOTAL "+cuentaSubGrupo.nombre,90,i);var b=cuentaSubGrupo.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&a.text(number_format(b,2),n+130,i),a.text(number_format(cuentaSubGrupo.total,2),n,i),i+=20,28==++c&&(a.addPage({margin:0,bufferPages:!0}),i=140,c=0,u+=1,e.dibujarCabeceraPDFBalanceGeneral(a,u,s,"ACTIVO"),a.font("Helvetica",8)),l===cuentaGrupo.hijos.length-1&&e.DibujarFijoPreestablecido(o,p,a,i,c,u,s,28,n)}e.configuracionImpresion.usar_firma_uno&&(a.text(e.configuracionImpresion.firma_uno,170,720),a.text(e.configuracionImpresion.cargo_uno,170,730)),e.configuracionImpresion.usar_firma_dos&&(a.text(e.configuracionImpresion.firma_dos,370,720),a.text(e.configuracionImpresion.cargo_dos,370,730)),a.end(),r.on("finish",function(){var e=r.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),t.stop()},e.generarPdfComprobantePreestablecido=function(o,n,a,r,i,c,u,s,p){var m=new PDFDocument({size:"letter",margin:10}),l=m.pipe(blobStream()),f=r.length+i.length,g=130,b=0,d=e.configuracionImpresion.usar_empesar_numeracion?e.configuracionImpresion.empesar_numeracion:1,A=e.configuracionImpresion.usar_empesar_numeracion?e.configuracionImpresion.empesar_numeracion-1+Math.ceil(f/28):Math.ceil(f/28),h={totalActivosPrimerAnio:0,totalActivosSegundoAnio:0};e.dibujarCabeceraPDFBalanceGeneral(m,d,A,"ACTIVO"),m.font("Helvetica",8);for(var G=0;G<r.length&&b<=28;G++)if(cuenta=r[G],cuenta.total=0,"Activo"===cuenta.primerAno.clasificacion.nombre){28==b&&(m.addPage({margin:0,bufferPages:!0}),g=140,b=0,d+=1,e.dibujarCabeceraPDFBalanceGeneral(m,d,A,"ACTIVO"),m.font("Helvetica",8)),m.text(cuenta.primerAno.nombre,30,g),cuenta.primerAno.total=0,cuenta.primerAno.totalSus=0,cuenta.segundoAno.total=0,cuenta.segundoAno.totalSus=0,g+=20,b++;for(var P=0;P<i.length&&b<=28;P++)if(cuenta3=i[P],"3"===cuenta3.primerAno.tipoCuenta.nombre_corto){var v=String(cuenta3.primerAno.codigo).substr(0,3);if(cuenta.primerAno.codigo==v){if(c.some(function(e){var o=String(e.primerAno.codigo).substr(0,5);return cuenta3.primerAno.codigo==o})){m.text(cuenta3.primerAno.nombre,40,g),cuenta3.primerAno.total=0,cuenta3.primerAno.totalSus=0,cuenta3.segundoAno.total=0,cuenta3.segundoAno.totalSus=0;for(var I=0;I<c.length&&b<=28;I++)if(cuenta2=c[I],"4"===cuenta2.primerAno.tipoCuenta.nombre_corto){v=String(cuenta2.primerAno.codigo).substr(0,5);cuenta3.primerAno.codigo==v?(cuenta3.primerAno.totalSus+=cuenta2.primerAno.saldo/e.moneda.dolar,cuenta3.segundoAno.totalSus+=cuenta2.segundoAno.saldo/e.moneda.dolar,cuenta3.primerAno.total+=cuenta2.primerAno.saldo,cuenta.primerAno.total+=cuenta2.primerAno.saldo,cuenta3.segundoAno.total+=cuenta2.segundoAno.saldo,cuenta.segundoAno.total+=cuenta2.segundoAno.saldo,h.totalActivosPrimerAnio+=cuenta2.primerAno.saldo,h.totalActivosSegundoAnio+=cuenta2.segundoAno.saldo,28==b&&(m.addPage({margin:0,bufferPages:!0}),g=140,b=0,d+=1,e.dibujarCabeceraPDFBalanceGeneral(m,d,A,"ACTIVO"),m.font("Helvetica",8))):28==b&&(m.addPage({margin:0,bufferPages:!0}),g=140,b=0,d+=1,e.dibujarCabeceraPDFBalanceGeneral(m,d,A,"ACTIVO"),m.font("Helvetica",8))}else 28==b&&(m.addPage({margin:0,bufferPages:!0}),g=140,b=0,d+=1,e.dibujarCabeceraPDFBalanceGeneral(m,d,A,"ACTIVO"),m.font("Helvetica",8));e.configuracionImpresion.bimonetario&&m.text(number_format(cuenta3.primerAno.totalSus,2),n+80,g),m.text(number_format(cuenta3.primerAno.total,2),n+180,g),e.configuracionImpresion.bimonetario&&m.text(number_format(cuenta3.segundoAno.totalSus,2),n+260,g),m.text(number_format(cuenta3.segundoAno.total,2),n,g),g+=20,b++}}else 28==b&&(m.addPage({margin:0,bufferPages:!0}),g=140,b=0,d+=1,e.dibujarCabeceraPDFBalanceGeneral(m,d,A,"ACTIVO"),m.font("Helvetica",8))}else 28==b&&(m.addPage({margin:0,bufferPages:!0}),g=140,b=0,d+=1,e.dibujarCabeceraPDFBalanceGeneral(m,d,A,"ACTIVO"),m.font("Helvetica",8));m.text("TOTAL "+cuenta.primerAno.nombre,90,g),m.text(number_format(cuenta.primerAno.total,2),n,g),m.text(number_format(cuenta.segundoAno.total,2),n+180,g);var S=cuenta.primerAno.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&m.text(number_format(S,2),n+80,g);S=cuenta.segundoAno.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&m.text(number_format(S,2),n+260,g),g+=20,b++,G===r.length-1&&e.DibujarFijoComparativoPreestablecido(o,h,m,g,b,d,A,28,n,a,r,i,c,u,s,p)}else G===r.length-1&&e.DibujarFijoComparativoPreestablecido(o,h,m,g,b,d,A,28,n,a,r,i,c,u,s,p);e.configuracionImpresion.usar_firma_uno&&(m.text(e.configuracionImpresion.firma_uno,170,720),m.text(e.configuracionImpresion.cargo_uno,170,730)),e.configuracionImpresion.usar_firma_dos&&(m.text(e.configuracionImpresion.firma_dos,370,720),m.text(e.configuracionImpresion.cargo_dos,370,730)),m.end(),l.on("finish",function(){var e=l.toBlobURL("application/pdf");window.open(e,"_blank","location=no")}),t.stop()},e.dibujarCabeceraPDFBalanceGeneral=function(o,n,a,r){if(o.font("Helvetica-Bold",8),o.text(e.usuario.empresa.razon_social,40,30,{width:220}),o.text("DE : ",40,40),o.text("NIT : ",40,50),o.text(e.usuario.empresa.direccion,40,60,{width:220}),o.text(e.usuario.empresa.nit,55,50),o.font("Helvetica-Bold",12),o.text("BALANCE GENERAL",0,75,{align:"center"}),o.font("Helvetica-Bold",8),"GES"==e.configuracionImpresion.tipoPeriodo.nombre_corto){var i=(new Date).getFullYear(),t=(new Date).getMonth(),c=new Date(i,t-1,0).getDate();e.configuracionImpresion.gestion.nombre<i?o.text("Al 31 de Diciembre de "+e.configuracionImpresion.gestion.nombre,0,85,{align:"center"}):o.text("Al "+c+" de "+e.meses[t].nombre+" de "+e.configuracionImpresion.gestion.nombre,0,85,{align:"center"})}else if("MES"==e.configuracionImpresion.tipoPeriodo.nombre_corto)o.text(e.configuracionImpresion.mes.nombre+" de "+e.configuracionImpresion.gestion.nombre,0,85,{align:"center"});else if("FECHAS"==e.configuracionImpresion.tipoPeriodo.nombre_corto){var u=new Date(e.convertirFecha(e.configuracionImpresion.fecha_inicio)),s=new Date(e.convertirFecha(e.configuracionImpresion.fecha_fin));o.text("Desde el "+u.getDate()+" de "+e.meses[u.getMonth()].nombre+" "+u.getFullYear()+" al "+s.getDate()+" de "+e.meses[s.getMonth()].nombre+" de "+s.getFullYear(),0,85,{align:"center"})}else"COMP"==e.configuracionImpresion.tipoPeriodo.nombre_corto&&o.text("Gesti√≥n "+e.configuracionImpresion.gestion.nombre+"- Gesti√≥n "+e.configuracionImpresion.gestion_fin.nombre,0,85,{align:"center"});e.configuracionImpresion.bimonetario?(o.text("Expresado en Bolivianos y D√≥lares",0,95,{align:"center"}),"COMPARATIVO"!=e.configuracionImpresion.tipoPeriodo.nombre?(o.text("Bolivianos",400,115),o.text("Dolares",520,115)):(o.text(e.configuracionImpresion.gestion.nombre,340,115),o.text("Bolivianos",290,125),o.text("Dolares",370,125),o.text(e.configuracionImpresion.gestion_fin.nombre,525,115),o.text("Bolivianos",473,125),o.text("Dolares",553,125))):o.text("Expresado en Bolivianos",0,95,{align:"center"}),o.text(r,0,105,{align:"center"}),"SAD"==e.configuracionImpresion.tipoNumeracion.nombre_corto?o.text("P√ÅGINA "+n,540,740):"SAI"==e.configuracionImpresion.tipoNumeracion.nombre_corto?o.text("P√ÅGINA "+n,0,740,{align:"center"}):"SSD"==e.configuracionImpresion.tipoNumeracion.nombre_corto?o.text("P√ÅGINA "+n,540,20):"PPD"==e.configuracionImpresion.tipoNumeracion.nombre_corto?o.text("P√ÅGINA "+n+" DE "+a,520,740):"PPC"==e.configuracionImpresion.tipoNumeracion.nombre_corto?o.text("P√ÅGINA "+n+" DE "+a,0,740,{align:"center"}):"PPSD"==e.configuracionImpresion.tipoNumeracion.nombre_corto&&o.text("P√ÅGINA "+n+" DE "+a,520,20),o.font("Helvetica",5),o.text(e.configuracionImpresion.usar_frase_pie_pagina?e.configuracionImpresion.frase_pie_pagina+", ":"",40,740),o.text((e.configuracionImpresion.usar_lugar_emision?e.configuracionImpresion.lugar_emision+", ":"")+(e.configuracionImpresion.usar_fecha_emision?e.fechaATexto(e.configuracionImpresion.fecha_emision):""),40,750)},e.generarExcelBalanceGeneral=function(o){p(e.configuracionImpresion,e.usuario.id_empresa).then(function(o){e.Cuentas=o.cuentas;for(var n=[["","","ESTADO CUENTAS PROVEEDOR"],["Deudor :"+proveedor.razon_social],["Fecha","N Recibo","Descripci√≥n","monto","total","total General"]],a=0,r=0;r<proveedor.compras.length;r++){var i=[];a+=proveedor.compras[r].saldo,proveedor.compras[r].fecha=new Date(proveedor.compras[r].fecha),i.push(proveedor.compras[r].fecha.getDate()+"/"+(proveedor.compras[r].fecha.getMonth()+1)+"/"+proveedor.compras[r].fecha.getFullYear()),i.push(proveedor.compras[r].id_movimiento),null==proveedor.compras[r].factura?i.push("PROFORMA"):i.push("factura : "+proveedor.compras[r].factura),i.push(proveedor.compras[r].saldo),i.push(a),i.push(a),n.push(i)}var c="SheetJS",u=new Workbook,s=sheet_from_array_of_arrays(n);u.SheetNames.push(c),u.Sheets[c]=s;var p=XLSX.write(u,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(p)],{type:"application/octet-stream"}),"REPORTE-ESTADO-CUENTA-PROVEEDOR.xlsx"),t.stop()})},e.dibujarCabeceraExelBalanceGeneral=function(){var o="",n="";if("GES"==e.configuracionImpresion.tipoPeriodo.nombre_corto){var a=(new Date).getFullYear(),r=(new Date).getMonth(),i=new Date(a,r-1,0).getDate();o=e.configuracionImpresion.gestion.nombre<a?"Al 31 de Diciembre de "+e.configuracionImpresion.gestion.nombre:"Al "+i+" de "+e.meses[r].nombre+" de "+e.configuracionImpresion.gestion.nombre}else if("MES"==e.configuracionImpresion.tipoPeriodo.nombre_corto)o=e.configuracionImpresion.mes.nombre+" de "+e.configuracionImpresion.gestion.nombre;else if("FECHAS"==e.configuracionImpresion.tipoPeriodo.nombre_corto){var t=new Date(e.convertirFecha(e.configuracionImpresion.fecha_inicio)),c=new Date(e.convertirFecha(e.configuracionImpresion.fecha_fin));o="Desde el "+t.getDate()+" de "+e.meses[t.getMonth()].nombre+" "+t.getFullYear()+" al "+c.getDate()+" de "+e.meses[c.getMonth()].nombre+" de "+c.getFullYear()}else"COMP"==e.configuracionImpresion.tipoPeriodo.nombre_corto&&(o="Gesti√≥n "+e.configuracionImpresion.gestion.nombre+"- Gesti√≥n "+e.configuracionImpresion.gestion_fin.nombre);if(e.configuracionImpresion.bimonetario){n="Expresado en Bolivianos y D√≥lares";var u=["GRUPO","SUB GRUPO","GENERICO","APROPIACION","","BOLIVIANOS","","DOLARES"]}else{u=["GRUPO","SUB GRUPO","GENERICO","APROPIACION","","BOLIVIANOS"];n="Expresado en Bolivianos"}return[["","","","BALANCE GENERAL"],["","","",o],["","","",n],u]},e.generarExelApropiacion=function(o,n,a,r,i,c){for(var u=e.dibujarCabeceraExelBalanceGeneral(),s=0;s<r.length;s++){var p=[];if(cuenta=r[s],cuenta.total=0,"ACTIVO"===cuenta.clasificacionTipoClasificacionNombre){p.push(""),p.push(cuenta.nombre),u.push(p);for(var m=0;m<i.length;m++){p=[],cuenta3=i[m];var l=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==l&&c.some(function(e){var o=String(e.codigo).substr(0,5);return cuenta3.codigo==o})){p.push(""),p.push(""),p.push(cuenta3.nombre),u.push(p);for(var f=0;f<c.length;f++){p=[],cuenta2=c[f];l=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==l){p.push(""),p.push(""),p.push(""),p.push(cuenta2.nombre),p.push(""),p.push(number_format(cuenta2.saldo,2));var g=cuenta2.saldo/e.moneda.dolar;e.configuracionImpresion.bimonetario&&p.push(""),p.push(number_format(g,2)),cuenta.total+=cuenta2.saldo,cuenta2.saldo,u.push(p)}}}}p=[],r.length}else r.length}e.configuracionImpresion.usar_firma_uno,e.configuracionImpresion.usar_firma_dos;var b="SheetJS",d=new Workbook,A=sheet_from_array_of_arrays(u);d.SheetNames.push(b),d.Sheets[b]=A;var h=XLSX.write(d,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([s2ab(h)],{type:"application/octet-stream"}),"REPORTE-BALANCE-GENERAL.xlsx"),t.stop()},e.descargarArchivo=function(e,o){var n=new FileReader;n.onload=function(e){var n=document.createElement("a");n.href=e.target.result,n.target="_blank",n.download=o||"archivo.dat";var a=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});n.dispatchEvent(a),(window.URL||window.webkitURL).revokeObjectURL(n.href)},n.readAsDataURL(e)},e.dibujarCabeceraWordBalanceGeneral=function(){var o="",n="";if("GES"==e.configuracionImpresion.tipoPeriodo.nombre_corto){var a=(new Date).getFullYear(),r=(new Date).getMonth(),i=new Date(a,r-1,0).getDate();o=e.configuracionImpresion.gestion.nombre<a?"Al 31 de Diciembre de "+e.configuracionImpresion.gestion.nombre:"Al "+i+" de "+e.meses[r].nombre+" de "+e.configuracionImpresion.gestion.nombre}else if("MES"==e.configuracionImpresion.tipoPeriodo.nombre_corto)o=e.configuracionImpresion.mes.nombre+" de "+e.configuracionImpresion.gestion.nombre;else if("FECHAS"==e.configuracionImpresion.tipoPeriodo.nombre_corto){var t=new Date(e.convertirFecha(e.configuracionImpresion.fecha_inicio)),c=new Date(e.convertirFecha(e.configuracionImpresion.fecha_fin));o="Desde el "+t.getDate()+" de "+e.meses[t.getMonth()].nombre+" "+t.getFullYear()+" al "+c.getDate()+" de "+e.meses[c.getMonth()].nombre+" de "+c.getFullYear()}else"COMP"==e.configuracionImpresion.tipoPeriodo.nombre_corto&&(o="Gesti√≥n "+e.configuracionImpresion.gestion.nombre+"- Gesti√≥n "+e.configuracionImpresion.gestion_fin.nombre);if(e.configuracionImpresion.bimonetario){n="Expresado en Bolivianos y D√≥lares"}else{n="Expresado en Bolivianos"}return"\t\t\t\t\tBALANCE GENERAL\r\n\t\t\t\t\t"+o+"\r\n\t\t\t\t"+n+"\r\n"},e.generarWordApropiacion=function(o,n,a,r,i,c){var u=e.dibujarCabeceraWordBalanceGeneral(),s=[];s.push(u);e.dibujarCabeceraExelBalanceGeneral();for(var p=r.length+i.length+c.length,m=0,l=(e.configuracionImpresion.usar_empesar_numeracion&&e.configuracionImpresion.empesar_numeracion,e.configuracionImpresion.usar_empesar_numeracion?(e.configuracionImpresion.empesar_numeracion,Math.ceil(p/51)):Math.ceil(p/51),0);l<r.length&&m<=51;l++)if(cuenta=r[l],cuenta.total=0,"ACTIVO"===cuenta.clasificacionTipoClasificacionNombre){51==m&&(m=0,1,s.push(u)),s.push(cuenta.nombre+"\r\n"),m++;for(var f=0;f<i.length&&m<=51;f++){cuenta3=i[f];var g=String(cuenta3.codigo).substr(0,3);if(cuenta.codigo==g&&c.some(function(e){var o=String(e.codigo).substr(0,5);return cuenta3.codigo==o})){s.push("\t"),s.push(cuenta3.nombre+"\r\n"),51==++m&&(m=0,1,s.push(u));for(var b=0;b<c.length&&m<=51;b++){cuenta2=c[b];g=String(cuenta2.codigo).substr(0,5);if(cuenta3.codigo==g){s.push("\t\t"),cuenta2.nombre.length>22?(text1=String(cuenta2.nombre).substr(0,22),text2=String(cuenta2.nombre).substr(22),s.push(text1),s.push("\n\r\t\t"),m++,s.push(text2),s.push("\t")):(s.push(cuenta2.nombre),s.push("\t")),s.push(number_format(cuenta2.saldo,2));var d=cuenta2.saldo/e.moneda.dolar;e.configuracionImpresion.bimonetario&&s.push("\t\t"+number_format(d,2)),cuenta.total+=cuenta2.saldo,cuenta2.saldo,s.push("\r\n"),51==++m&&(m=0,1,s.push(u))}}}}s.push("\t"),s.push("TOTAL "+cuenta.nombre),s.push("\t\t\t\t"),s.push(number_format(cuenta.total,2));var A=cuenta.total/e.moneda.dolar;e.configuracionImpresion.bimonetario&&s.push("\t\t\t\t"),s.push(number_format(A,2)),r.length}else r.length;return e.configuracionImpresion.usar_firma_uno,e.configuracionImpresion.usar_firma_dos,t.stop(),new Blob(s,{type:"text/plain"})},e.$on("$routeChangeStart",function(e,o){}),e.inicio()});